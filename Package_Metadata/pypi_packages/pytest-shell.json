{"info": {"author": "Daniel Murray", "author_email": "daniel@darkdisco.net", "bugtrack_url": null, "classifiers": ["Framework :: Pytest", "Intended Audience :: Developers", "License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python :: 2", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.5", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7", "Programming Language :: Python :: 3.8", "Topic :: Software Development :: Testing"], "description": "============\npytest-shell\n============\n\nA plugin for testing shell scripts and line-based processes with pytest.\n\nYou could use it to test shell scripts, or other commands that can be run\nthrough the shell that you want to test the usage of.\n\nNot especially feature-complete or even well-tested, but works for what I\nwanted it for. If you use it please feel free to file bug reports or feature\nrequests.\n\nFeatures\n--------\n\n* Easy access to a bash shell through a pytest fixture.\n* Set and check environment variables through Python code.\n* Automatically fail test on nonzero return codes by default.\n* Helpers for running shell scripts.\n* Mostly, all the great stuff pytest gives you with a few helpers to make it\n  work for bash.\n\n\nInstallation\n------------\n\nYou can install \"pytest-shell\" via `pip`_ from `PyPI`_::\n\n    $ pip install pytest-shell\n\nUsage\n-----\n\nYou can use a fixture called 'bash' to get a shell process you can interact\nwith.\n\nTest a bash function::\n\n    def test_something(bash):\n        assert bash.run_function('test') == 'expected output'\n\nSet environment variables, run a .sh file and check results::\n\n    def test_something(bash):\n        with bash(envvars={'SOMEDIR': '/home/blah'}) as s:\n            s.run_script('dostuff.sh', ['arg1', 'arg2'])\n            assert s.path_exists('/home/blah/newdir')\n            assert s.file_contents('/home/blah/newdir/test.txt') == 'test text'\n\nRun some inline script, check an environment variable was set::\n\n    def test_something(bash):\n        bash.run_script_inline(['touch /tmp/blah.txt', './another_script.sh'])\n        assert bash.envvars.get('AVAR') == 'success'\n\nUse context manager to set environment variables::\n\n    def test_something(bash):\n        with bash(envvars={'BLAH2': 'something'}):\n            assert bash.envvars['BLAH2'] == 'something'\n\nYou can run things other than bash (ssh for example), but there aren't specific\nfixtures and the communication with the process is very bash-specific.\n\nCreating file and directory structures\n--------------------------------------\n\npytest_shell.fs.create_files() is a helper to assemble a structure of files and\ndirectories. It is best used with the tmpdir pytest fixture so you don't have\nto clean up. It is used like so::\n\n    structure = ['/a/directory',\n                 {'/a/directory/and/a/file.txt': {'content': 'blah'}},\n                 {'/a/directory/and': {'mode': 0o600}]\n    create_files(structure)\n\nwhich should create something like this::\n\n    |\n    + a\n       \\\n        + directory\n         \\\n          + and              # mode 600\n           \\\n            + a\n               \\\n                file.txt    # content equal to 'blah'\n\nchroot helper\n-------------\n\nA context manager that creates a chroot environment is available through\nthe bash fixture::\n\n    with bash.chroot(tmpdir):\n        bash.send('mkdir /blah')\n\nThe only reason to use this is if you need to test something that relies on a\ncertain path structure anchored at root. It is fairly flimsy, and of course\nrequires sudo. The best way to use it is with the tmpdir fixture provided by\npytest as no cleanup is done.\n\n/bin, /usr/bin, /lib and /lib64 are mounted into the chroot using a bind mount,\notherwise most things don't work. The chroot commands is called with --userspec\nfor the current user so the commands you run in there won't be run as root,\nbut nevertheless be careful and aware that the directories mounted in there are\nyour real system directories. There is no safety or security, it's just a\nhelper to test something that would be otherwise hard to test.\n\n\nTODO\n----\n\n* Helpers for piping, streaming.\n* Fixtures and helpers for docker and ssh.\n* Support for non-bash shells.\n* Shell instance in setup for e.g. basepath.\n\n\nRefactoring TODO\n----------------\n\n* Make Connection class just handle bytes, move line-based stuff into an\n  intermediary.\n* Make pattern stuff work line-based or on multiline streams (in a more\n  obvious way than just crafting the right regexes).\n* Make pattern stuff work on part of line if desired, leaving the rest.\n\nLicense\n-------\n\nDistributed under the terms of the `MIT`_ license, \"pytest-shell\" is free and\nopen source software\n\n.. _`MIT`: http://opensource.org/licenses/MIT\n.. _`pytest`: https://github.com/pytest-dev/pytest\n.. _`tox`: https://tox.readthedocs.io/en/latest/\n.. _`pip`: https://pypi.org/project/pip/\n.. _`PyPI`: https://pypi.org/project\n", "description_content_type": "text/x-rst", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://hg.sr.ht/~danmur/pytest-shell", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "pytest-shell", "package_url": "https://pypi.org/project/pytest-shell/", "platform": "", "project_url": "https://pypi.org/project/pytest-shell/", "project_urls": {"Documentation": "https://hg.sr.ht/~danmur/pytest-shell/browse/default/README.rst", "Homepage": "https://hg.sr.ht/~danmur/pytest-shell"}, "release_url": "https://pypi.org/project/pytest-shell/0.2.3/", "requires_dist": null, "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "summary": "A pytest plugin for testing shell scripts and line-based processes", "version": "0.2.3", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p>A plugin for testing shell scripts and line-based processes with pytest.</p>\n<p>You could use it to test shell scripts, or other commands that can be run\nthrough the shell that you want to test the usage of.</p>\n<p>Not especially feature-complete or even well-tested, but works for what I\nwanted it for. If you use it please feel free to file bug reports or feature\nrequests.</p>\n<div id=\"features\">\n<h2>Features</h2>\n<ul>\n<li>Easy access to a bash shell through a pytest fixture.</li>\n<li>Set and check environment variables through Python code.</li>\n<li>Automatically fail test on nonzero return codes by default.</li>\n<li>Helpers for running shell scripts.</li>\n<li>Mostly, all the great stuff pytest gives you with a few helpers to make it\nwork for bash.</li>\n</ul>\n</div>\n<div id=\"installation\">\n<h2>Installation</h2>\n<p>You can install \u201cpytest-shell\u201d via <a href=\"https://pypi.org/project/pip/\" rel=\"nofollow\">pip</a> from <a href=\"https://pypi.org/project\" rel=\"nofollow\">PyPI</a>:</p>\n<pre>$ pip install pytest-shell\n</pre>\n</div>\n<div id=\"usage\">\n<h2>Usage</h2>\n<p>You can use a fixture called \u2018bash\u2019 to get a shell process you can interact\nwith.</p>\n<p>Test a bash function:</p>\n<pre>def test_something(bash):\n    assert bash.run_function('test') == 'expected output'\n</pre>\n<p>Set environment variables, run a .sh file and check results:</p>\n<pre>def test_something(bash):\n    with bash(envvars={'SOMEDIR': '/home/blah'}) as s:\n        s.run_script('dostuff.sh', ['arg1', 'arg2'])\n        assert s.path_exists('/home/blah/newdir')\n        assert s.file_contents('/home/blah/newdir/test.txt') == 'test text'\n</pre>\n<p>Run some inline script, check an environment variable was set:</p>\n<pre>def test_something(bash):\n    bash.run_script_inline(['touch /tmp/blah.txt', './another_script.sh'])\n    assert bash.envvars.get('AVAR') == 'success'\n</pre>\n<p>Use context manager to set environment variables:</p>\n<pre>def test_something(bash):\n    with bash(envvars={'BLAH2': 'something'}):\n        assert bash.envvars['BLAH2'] == 'something'\n</pre>\n<p>You can run things other than bash (ssh for example), but there aren\u2019t specific\nfixtures and the communication with the process is very bash-specific.</p>\n</div>\n<div id=\"creating-file-and-directory-structures\">\n<h2>Creating file and directory structures</h2>\n<p>pytest_shell.fs.create_files() is a helper to assemble a structure of files and\ndirectories. It is best used with the tmpdir pytest fixture so you don\u2019t have\nto clean up. It is used like so:</p>\n<pre>structure = ['/a/directory',\n             {'/a/directory/and/a/file.txt': {'content': 'blah'}},\n             {'/a/directory/and': {'mode': 0o600}]\ncreate_files(structure)\n</pre>\n<p>which should create something like this:</p>\n<pre>|\n+ a\n   \\\n    + directory\n     \\\n      + and              # mode 600\n       \\\n        + a\n           \\\n            file.txt    # content equal to 'blah'\n</pre>\n</div>\n<div id=\"chroot-helper\">\n<h2>chroot helper</h2>\n<p>A context manager that creates a chroot environment is available through\nthe bash fixture:</p>\n<pre>with bash.chroot(tmpdir):\n    bash.send('mkdir /blah')\n</pre>\n<p>The only reason to use this is if you need to test something that relies on a\ncertain path structure anchored at root. It is fairly flimsy, and of course\nrequires sudo. The best way to use it is with the tmpdir fixture provided by\npytest as no cleanup is done.</p>\n<p>/bin, /usr/bin, /lib and /lib64 are mounted into the chroot using a bind mount,\notherwise most things don\u2019t work. The chroot commands is called with \u2013userspec\nfor the current user so the commands you run in there won\u2019t be run as root,\nbut nevertheless be careful and aware that the directories mounted in there are\nyour real system directories. There is no safety or security, it\u2019s just a\nhelper to test something that would be otherwise hard to test.</p>\n</div>\n<div id=\"todo\">\n<h2>TODO</h2>\n<ul>\n<li>Helpers for piping, streaming.</li>\n<li>Fixtures and helpers for docker and ssh.</li>\n<li>Support for non-bash shells.</li>\n<li>Shell instance in setup for e.g. basepath.</li>\n</ul>\n</div>\n<div id=\"refactoring-todo\">\n<h2>Refactoring TODO</h2>\n<ul>\n<li>Make Connection class just handle bytes, move line-based stuff into an\nintermediary.</li>\n<li>Make pattern stuff work line-based or on multiline streams (in a more\nobvious way than just crafting the right regexes).</li>\n<li>Make pattern stuff work on part of line if desired, leaving the rest.</li>\n</ul>\n</div>\n<div id=\"license\">\n<h2>License</h2>\n<p>Distributed under the terms of the <a href=\"http://opensource.org/licenses/MIT\" rel=\"nofollow\">MIT</a> license, \u201cpytest-shell\u201d is free and\nopen source software</p>\n</div>\n\n          </div>"}, "last_serial": 6477331, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "84a1db5f43b7f5421b16307dd8ac5143", "sha256": "0839d3c35bde19e4cc63139e256f12c48b6c786229d61ba2316fdadee12a0695"}, "downloads": -1, "filename": "pytest_shell-0.1.0-py2-none-any.whl", "has_sig": false, "md5_digest": "84a1db5f43b7f5421b16307dd8ac5143", "packagetype": "bdist_wheel", "python_version": "py2", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*", "size": 11463, "upload_time": "2018-08-06T13:24:30", "upload_time_iso_8601": "2018-08-06T13:24:30.906601Z", "url": "https://files.pythonhosted.org/packages/be/dc/1821a7bde3f49da8089a751f21a56fd4c65ae4e7f9c28284e9fcafdb4bdb/pytest_shell-0.1.0-py2-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "633702e702e0945987074034f7a57613", "sha256": "0fd616625714749dda56677705e533ecf30f9559c8fd4468f6d6d2777db55e6f"}, "downloads": -1, "filename": "pytest-shell-0.1.0.tar.gz", "has_sig": false, "md5_digest": "633702e702e0945987074034f7a57613", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*", "size": 9442, "upload_time": "2018-08-06T13:24:32", "upload_time_iso_8601": "2018-08-06T13:24:32.428621Z", "url": "https://files.pythonhosted.org/packages/f6/03/c53885b44ecf3700a867b1c8df8fa6a6971731e538864edabce3a08b9eb7/pytest-shell-0.1.0.tar.gz", "yanked": false}], "0.1.1": [{"comment_text": "", "digests": {"md5": "e5c817a5cdf87aa5c7f7fe2543b20be7", "sha256": "f669bf6fd17055457bffb32a8ae17bf0eb787e926201b5b17215a8afb761ccc9"}, "downloads": -1, "filename": "pytest_shell-0.1.1-py3-none-any.whl", "has_sig": false, "md5_digest": "e5c817a5cdf87aa5c7f7fe2543b20be7", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*", "size": 11942, "upload_time": "2018-10-18T04:19:44", "upload_time_iso_8601": "2018-10-18T04:19:44.531061Z", "url": "https://files.pythonhosted.org/packages/a8/71/530e9b491ed3f29bcd35085d2e89b007c24cd78162814112ce9166d7ee78/pytest_shell-0.1.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "5fc17b182d69a5e37df00c6182ac74b2", "sha256": "13433a4fc8494518aa2dabb75d4a27e53bce6f9e2cfffa933e62627f27a1044b"}, "downloads": -1, "filename": "pytest-shell-0.1.1.tar.gz", "has_sig": false, "md5_digest": "5fc17b182d69a5e37df00c6182ac74b2", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*", "size": 9338, "upload_time": "2018-10-18T04:19:46", "upload_time_iso_8601": "2018-10-18T04:19:46.264622Z", "url": "https://files.pythonhosted.org/packages/34/75/a560a6086ef5a73d8f7c2f3789f5483f7db5f62cf55b0e53d9fd3bb41196/pytest-shell-0.1.1.tar.gz", "yanked": false}], "0.2.0": [{"comment_text": "", "digests": {"md5": "03e5e0185338a22a09400e22adfacf8c", "sha256": "5268678e09d9d72892697b03d5f9eb0c3b47bc3335d507c9da82391429d9384b"}, "downloads": -1, "filename": "pytest-shell-0.2.0.linux-x86_64.tar.gz", "has_sig": false, "md5_digest": "03e5e0185338a22a09400e22adfacf8c", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*", "size": 20774, "upload_time": "2019-06-15T02:24:17", "upload_time_iso_8601": "2019-06-15T02:24:17.034538Z", "url": "https://files.pythonhosted.org/packages/75/3d/0f4370af99affba54750d7edf4286c0d59fd16012ade636687e6d03568ce/pytest-shell-0.2.0.linux-x86_64.tar.gz", "yanked": false}, {"comment_text": "", "digests": {"md5": "131cdcbe5f45315e5bcbe4173c93f41e", "sha256": "d3de5c73bdc196043885e769cc7a32347192308a770d4d99699858437e69a2e6"}, "downloads": -1, "filename": "pytest_shell-0.2.0-py3-none-any.whl", "has_sig": false, "md5_digest": "131cdcbe5f45315e5bcbe4173c93f41e", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*", "size": 14606, "upload_time": "2019-06-15T02:24:14", "upload_time_iso_8601": "2019-06-15T02:24:14.822069Z", "url": "https://files.pythonhosted.org/packages/7c/ab/4217a3a00018375a729283c459b2a0ac0a74d6973c2829d929c2aa3653e9/pytest_shell-0.2.0-py3-none-any.whl", "yanked": false}], "0.2.1": [{"comment_text": "", "digests": {"md5": "e9cf2a0a4a9c35547c2308ee85a45be3", "sha256": "6452add37a53ff55ccde47da245dedc103733e5ff239e35fc577a32832df6ea1"}, "downloads": -1, "filename": "pytest_shell-0.2.1-py2-none-any.whl", "has_sig": false, "md5_digest": "e9cf2a0a4a9c35547c2308ee85a45be3", "packagetype": "bdist_wheel", "python_version": "py2", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*", "size": 16961, "upload_time": "2019-08-28T11:22:47", "upload_time_iso_8601": "2019-08-28T11:22:47.692948Z", "url": "https://files.pythonhosted.org/packages/58/62/8450f440cad4240356f6a4cf63e7f14d1ba22c920a02e05461580af5119c/pytest_shell-0.2.1-py2-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "af6831d0bb5287a4c1af47ee0b52ecdd", "sha256": "e897aee66caeeed50836a16aaf813ad3399bdebaf048cece22bcd9d982b9b828"}, "downloads": -1, "filename": "pytest-shell-0.2.1.tar.gz", "has_sig": false, "md5_digest": "af6831d0bb5287a4c1af47ee0b52ecdd", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*", "size": 13882, "upload_time": "2019-08-28T11:22:50", "upload_time_iso_8601": "2019-08-28T11:22:50.242008Z", "url": "https://files.pythonhosted.org/packages/69/3e/2417001318aee58cd65f632cdf9623cc2188bd43f6e173a41399e50d2016/pytest-shell-0.2.1.tar.gz", "yanked": false}], "0.2.2": [{"comment_text": "", "digests": {"md5": "ac08b88a14eac7c707228289372f3ce3", "sha256": "487847798a0a95c6f6bbde828f5f3c4a7f1c11faf4091b03587fb4370aa43a6c"}, "downloads": -1, "filename": "pytest_shell-0.2.2-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "ac08b88a14eac7c707228289372f3ce3", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "size": 12182, "upload_time": "2020-01-18T08:14:40", "upload_time_iso_8601": "2020-01-18T08:14:40.025733Z", "url": "https://files.pythonhosted.org/packages/d8/1c/cb6a0317b5189731f136e3e4dd7d57625e58d26921eb4c0b7b8a0b2c4942/pytest_shell-0.2.2-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "befc4737ae1ed6dd3dcc83b77166bac2", "sha256": "81169f6272b5c59e7ecc53ef237457ed14d75ef6328507bc519f92f64b76613d"}, "downloads": -1, "filename": "pytest-shell-0.2.2.tar.gz", "has_sig": false, "md5_digest": "befc4737ae1ed6dd3dcc83b77166bac2", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "size": 9790, "upload_time": "2020-01-18T08:14:37", "upload_time_iso_8601": "2020-01-18T08:14:37.882330Z", "url": "https://files.pythonhosted.org/packages/23/dd/7abc7fbdad6d611a9e493169bb1126bde1329ad2366a4ac2e6a30d0e440c/pytest-shell-0.2.2.tar.gz", "yanked": false}], "0.2.3": [{"comment_text": "", "digests": {"md5": "74b44d6b16cb30c11855905cb004e6a1", "sha256": "aa396d5e8f4b3faa20fc28b66abe088139bef1c02a5d0674a5a2f2aacf778b1a"}, "downloads": -1, "filename": "pytest_shell-0.2.3-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "74b44d6b16cb30c11855905cb004e6a1", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "size": 14049, "upload_time": "2020-01-18T08:17:57", "upload_time_iso_8601": "2020-01-18T08:17:57.564320Z", "url": "https://files.pythonhosted.org/packages/ea/24/48bbd36e37f6c92ef81ab7cc4f4203688c9e1bd7ba66f94674faba6c22b2/pytest_shell-0.2.3-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "610ab1d5773b9dafb59e9b96b4793ffd", "sha256": "535178a527450371defbc00e542511300b6a8e3199abe537b31aae6eb3c94ded"}, "downloads": -1, "filename": "pytest-shell-0.2.3.tar.gz", "has_sig": false, "md5_digest": "610ab1d5773b9dafb59e9b96b4793ffd", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "size": 13918, "upload_time": "2020-01-18T08:17:55", "upload_time_iso_8601": "2020-01-18T08:17:55.420422Z", "url": "https://files.pythonhosted.org/packages/ad/ae/7f4dfcab9b74e272674315f4b9141185d2a9072569fa334dd1facebb2234/pytest-shell-0.2.3.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "74b44d6b16cb30c11855905cb004e6a1", "sha256": "aa396d5e8f4b3faa20fc28b66abe088139bef1c02a5d0674a5a2f2aacf778b1a"}, "downloads": -1, "filename": "pytest_shell-0.2.3-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "74b44d6b16cb30c11855905cb004e6a1", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "size": 14049, "upload_time": "2020-01-18T08:17:57", "upload_time_iso_8601": "2020-01-18T08:17:57.564320Z", "url": "https://files.pythonhosted.org/packages/ea/24/48bbd36e37f6c92ef81ab7cc4f4203688c9e1bd7ba66f94674faba6c22b2/pytest_shell-0.2.3-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "610ab1d5773b9dafb59e9b96b4793ffd", "sha256": "535178a527450371defbc00e542511300b6a8e3199abe537b31aae6eb3c94ded"}, "downloads": -1, "filename": "pytest-shell-0.2.3.tar.gz", "has_sig": false, "md5_digest": "610ab1d5773b9dafb59e9b96b4793ffd", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "size": 13918, "upload_time": "2020-01-18T08:17:55", "upload_time_iso_8601": "2020-01-18T08:17:55.420422Z", "url": "https://files.pythonhosted.org/packages/ad/ae/7f4dfcab9b74e272674315f4b9141185d2a9072569fa334dd1facebb2234/pytest-shell-0.2.3.tar.gz", "yanked": false}], "timestamp": "Fri May  8 02:54:42 2020"}