{"info": {"author": "Amazon Web Services", "author_email": "", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Intended Audience :: Developers", "License :: OSI Approved :: Apache Software License", "Natural Language :: English", "Programming Language :: Python", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7"], "description": "![SageMaker](https://github.com/aws/sagemaker-training-toolkit/raw/master/branding/icon/sagemaker-banner.png)\n\n# SageMaker Training Toolkit\n\n[![Latest Version](https://img.shields.io/pypi/v/sagemaker-training.svg)](https://pypi.python.org/pypi/sagemaker-training) [![Supported Python Versions](https://img.shields.io/pypi/pyversions/sagemaker-training.svg)](https://pypi.python.org/pypi/sagemaker-training) [![Code Style: Black](https://img.shields.io/badge/code_style-black-000000.svg)](https://github.com/python/black)\n\nTrain machine learning models within a Docker container using Amazon SageMaker.\n\n\n## :books: Background\n\n[Amazon SageMaker](https://aws.amazon.com/sagemaker/) is a fully managed service for data science and machine learning (ML) workflows.\nYou can use Amazon SageMaker to simplify the process of building, training, and deploying ML models.\n\nTo train a model, you can include your training script and dependencies in a [Docker container](https://www.docker.com/resources/what-container) that runs your training code.\nA container provides an effectively isolated environment, ensuring a consistent runtime and reliable training process. \n\nThe **SageMaker Training Toolkit** can be easily added to any Docker container, making it compatible with SageMaker for [training models](https://aws.amazon.com/sagemaker/train/).\nIf you use a [prebuilt SageMaker Docker image for training](https://docs.aws.amazon.com/sagemaker/latest/dg/pre-built-containers-frameworks-deep-learning.html), this library may already be included.\n\nFor more information, see the Amazon SageMaker Developer Guide sections on [using Docker containers for training](https://docs.aws.amazon.com/sagemaker/latest/dg/your-algorithms.html).\n\n## :hammer_and_wrench: Installation\n\nTo install this library in your Docker image, add the following line to your [Dockerfile](https://docs.docker.com/engine/reference/builder/):\n\n``` dockerfile\nRUN pip3 install sagemaker-training\n```\n\n## :computer: Usage\n\n### Create a Docker image and train a model \n\n1. Write a training script. (For example, this script named `train.py` uses Tensorflow.)\n\n    ``` python\n    import tensorflow as tf\n\n    mnist = tf.keras.datasets.mnist\n\n    (x_train, y_train), (x_test, y_test) = mnist.load_data()\n    x_train, x_test = x_train / 255.0, x_test / 255.0\n\n    model = tf.keras.models.Sequential([\n      tf.keras.layers.Flatten(input_shape=(28, 28)),\n      tf.keras.layers.Dense(128, activation='relu'),\n      tf.keras.layers.Dropout(0.2),\n      tf.keras.layers.Dense(10, activation='softmax')\n    ])\n\n    model.compile(optimizer='adam',\n                  loss='sparse_categorical_crossentropy',\n                  metrics=['accuracy'])\n\n    model.fit(x_train, y_train, epochs=1)\n\n    model.evaluate(x_test, y_test)\n    ```\n\n2. [Define a container with a Dockerfile](https://docs.docker.com/get-started/part2/#define-a-container-with-dockerfile) that includes the training script and any dependencies.\n\n    The training script must be located in the `/opt/ml/code` directory.\n    The environment variable `SAGEMAKER_PROGRAM` defines which file inside the `/opt/ml/code` directory to use as the training entry point.\n    When training starts, the interpreter executes the entry point defined by `SAGEMAKER_PROGRAM`.\n    Python and shell scripts are both supported.\n    \n    ``` docker\n    FROM tensorflow/tensorflow:2.1.0\n\n    RUN pip3 install sagemaker-training\n\n    # Copies the training script inside the container\n    COPY train.py /opt/ml/code/train.py\n\n    # Defines train.py as script entry point\n    ENV SAGEMAKER_PROGRAM train.py\n    ```\n\n3. Build and tag the Docker image.\n\n    ``` shell\n    docker build -t tf-2.0 .\n    ```\n\n4. Use the Docker image to start a training job using the [SageMaker Python SDK](https://github.com/aws/sagemaker-python-sdk).\n\n    ``` python\n    from sagemaker.estimator import Estimator\n\n    estimator = Estimator(image_name='tf-2.0',\n                          role='SageMakerRole',\n                          train_instance_count=1,\n                          train_instance_type='local')\n\n    estimator.fit()\n    ```\n    \n    To train a model using the image on SageMaker, [push the image to ECR](https://docs.aws.amazon.com/AmazonECR/latest/userguide/docker-push-ecr-image.html) and start a SageMaker training job with the image URI.\n    \n\n### Pass arguments to the entry point using hyperparameters\n\nAny hyperparameters provided by the training job will be passed to the entry point as script arguments. The SageMaker Python SDK uses this feature to pass special hyperparameters to the training job, including `sagemaker_program` and `sagemaker_submit_directory`. The complete list of SageMaker hyperparameters is available\n[here](https://github.com/aws/sagemaker-training-toolkit/blob/master/src/sagemaker_training/params.py).\n\n1. Implement an argument parser in the entry point script. For example, in a Python script:\n\n    ``` python\n    import argparse\n\n    if __name__ == '__main__':\n      parser = argparse.ArgumentParser()\n\n      parser.add_argument('--learning-rate', type=int, default=1)\n      parser.add_argument('--batch-size', type=int, default=64)\n      parser.add_argument('--communicator', type=str)\n      parser.add_argument('--frequency', type=int, default=20)\n\n      args = parser.parse_args()\n      ...\n    ```\n\n2. Start a training job with hyperparameters.\n\n    ``` python\n    {\"HyperParameters\": {\"batch-size\": 256, \"learning-rate\": 0.0001, \"communicator\": \"pure_nccl\"}}\n    ```\n\n### Read additional information using environment variables\n\nAn entry point often needs additional information not available in `hyperparameters`.\nThe SageMaker Training Toolkit writes this information as environment variables that are available from within the script.\nFor example, this training job includes the channels `training` and `testing`:\n\n``` python\nfrom sagemaker.pytorch import PyTorch\n\nestimator = PyTorch(entry_point='train.py', ...)\n\nestimator.fit({'training': 's3://bucket/path/to/training/data', \n               'testing': 's3://bucket/path/to/testing/data'})\n```\n\nThe environment variables `SM_CHANNEL_TRAINING` and `SM_CHANNEL_TESTING` provide the paths to the channels:\n\n``` python\nimport argparse\nimport os\n\nif __name__ == '__main__':\n  parser = argparse.ArgumentParser()\n\n  ...\n\n  # reads input channels training and testing from the environment variables\n  parser.add_argument('--training', type=str, default=os.environ['SM_CHANNEL_TRAINING'])\n  parser.add_argument('--testing', type=str, default=os.environ['SM_CHANNEL_TESTING'])\n\n  args = parser.parse_args()\n  ...\n```\n\nWhen training starts, SageMaker Training Toolkit will print all available environment variables. Please see the [reference on environment variables](https://github.com/aws/sagemaker-training-toolkit/blob/master/ENVIRONMENT_VARIABLES.md) for a full list of provided environment variables.\n\n### Get information about the container environment\n\nTo get information about the container environment, initialize an `Environment` object.\n`Environment` provides access to aspects of the environment relevant to training jobs, including hyperparameters, system characteristics, filesystem locations, environment variables and configuration settings.\nIt is a read-only snapshot of the container environment during training, and it doesn't contain any form of state.\n\n``` python\nfrom sagemaker_training import environment\n\nenv = environment.Environment()\n\n# get the path of the channel 'training' from the ``inputdataconfig.json`` file\ntraining_dir = env.channel_input_dirs['training']\n\n# get a the hyperparameter 'training_data_file' from ``hyperparameters.json`` file\nfile_name = env.hyperparameters['training_data_file']\n\n# get the folder where the model should be saved\nmodel_dir = env.model_dir\ndata = np.load(os.path.join(training_dir, file_name))\nx_train, y_train = data['features'], keras.utils.to_categorical(data['labels'])\nmodel = ResNet50(weights='imagenet')\n...\nmodel.fit(x_train, y_train)\n\n#save the model in the end of training\nmodel.save(os.path.join(model_dir, 'saved_model'))\n```\n\n### Execute the entry point\n\nTo execute the entry point, call `entry_point.run()`.\n\n``` python\nfrom sagemaker_training import entry_point, environment\n\nenv = environment.Environment()\n\n# read hyperparameters as script arguments\nargs = env.to_cmd_args()\n\n# get the environment variables\nenv_vars = env.to_env_vars()\n\n# execute the entry point\nentry_point.run(env.module_dir,\n                env.user_entry_point,\n                args,\n                env_vars)\n\n```\n\nIf the entry point execution fails, `trainer.train()` will write the error message to `/opt/ml/output/failure`. Otherwise, it will write to the file `/opt/ml/success`.\n\n## :scroll: License\n\nThis library is licensed under the [Apache 2.0 License](http://aws.amazon.com/apache2.0/).\nFor more details, please take a look at the [LICENSE](https://github.com/aws/sagemaker-training-toolkit/blob/master/LICENSE) file.\n\n## :handshake: Contributing\n\nContributions are welcome!\nPlease read our [contributing guidelines](https://github.com/aws/sagemaker-training-toolkit/blob/master/CONTRIBUTING.md)\nif you'd like to open an issue or submit a pull request.", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/aws/sagemaker-training-toolkit/", "keywords": "", "license": "Apache License 2.0", "maintainer": "", "maintainer_email": "", "name": "sagemaker-training", "package_url": "https://pypi.org/project/sagemaker-training/", "platform": "", "project_url": "https://pypi.org/project/sagemaker-training/", "project_urls": {"Homepage": "https://github.com/aws/sagemaker-training-toolkit/"}, "release_url": "https://pypi.org/project/sagemaker-training/3.5.0.post0/", "requires_dist": null, "requires_python": "", "summary": "Open source library for creating containers to run on Amazon SageMaker.", "version": "3.5.0.post0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><img alt=\"SageMaker\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/072833050a66f934f1f0f705126dfb7f745b2533/68747470733a2f2f6769746875622e636f6d2f6177732f736167656d616b65722d747261696e696e672d746f6f6c6b69742f7261772f6d61737465722f6272616e64696e672f69636f6e2f736167656d616b65722d62616e6e65722e706e67\"></p>\n<h1>SageMaker Training Toolkit</h1>\n<p><a href=\"https://pypi.python.org/pypi/sagemaker-training\" rel=\"nofollow\"><img alt=\"Latest Version\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/50c03d18dad7e3a77c8ee9bc36e6d2d87001e776/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f736167656d616b65722d747261696e696e672e737667\"></a> <a href=\"https://pypi.python.org/pypi/sagemaker-training\" rel=\"nofollow\"><img alt=\"Supported Python Versions\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/a22eff46c3f906ba73b02e0eba1dc4c853bea670/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f736167656d616b65722d747261696e696e672e737667\"></a> <a href=\"https://github.com/python/black\" rel=\"nofollow\"><img alt=\"Code Style: Black\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/60c9766d3e4743ac1ccc37cf3755aa6609b5ce47/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f64655f7374796c652d626c61636b2d3030303030302e737667\"></a></p>\n<p>Train machine learning models within a Docker container using Amazon SageMaker.</p>\n<h2>:books: Background</h2>\n<p><a href=\"https://aws.amazon.com/sagemaker/\" rel=\"nofollow\">Amazon SageMaker</a> is a fully managed service for data science and machine learning (ML) workflows.\nYou can use Amazon SageMaker to simplify the process of building, training, and deploying ML models.</p>\n<p>To train a model, you can include your training script and dependencies in a <a href=\"https://www.docker.com/resources/what-container\" rel=\"nofollow\">Docker container</a> that runs your training code.\nA container provides an effectively isolated environment, ensuring a consistent runtime and reliable training process.</p>\n<p>The <strong>SageMaker Training Toolkit</strong> can be easily added to any Docker container, making it compatible with SageMaker for <a href=\"https://aws.amazon.com/sagemaker/train/\" rel=\"nofollow\">training models</a>.\nIf you use a <a href=\"https://docs.aws.amazon.com/sagemaker/latest/dg/pre-built-containers-frameworks-deep-learning.html\" rel=\"nofollow\">prebuilt SageMaker Docker image for training</a>, this library may already be included.</p>\n<p>For more information, see the Amazon SageMaker Developer Guide sections on <a href=\"https://docs.aws.amazon.com/sagemaker/latest/dg/your-algorithms.html\" rel=\"nofollow\">using Docker containers for training</a>.</p>\n<h2>:hammer_and_wrench: Installation</h2>\n<p>To install this library in your Docker image, add the following line to your <a href=\"https://docs.docker.com/engine/reference/builder/\" rel=\"nofollow\">Dockerfile</a>:</p>\n<pre><span class=\"k\">RUN</span> pip3 install sagemaker-training\n</pre>\n<h2>:computer: Usage</h2>\n<h3>Create a Docker image and train a model</h3>\n<ol>\n<li>\n<p>Write a training script. (For example, this script named <code>train.py</code> uses Tensorflow.)</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">tensorflow</span> <span class=\"k\">as</span> <span class=\"nn\">tf</span>\n\n<span class=\"n\">mnist</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"o\">.</span><span class=\"n\">keras</span><span class=\"o\">.</span><span class=\"n\">datasets</span><span class=\"o\">.</span><span class=\"n\">mnist</span>\n\n<span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">mnist</span><span class=\"o\">.</span><span class=\"n\">load_data</span><span class=\"p\">()</span>\n<span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">=</span> <span class=\"n\">x_train</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span><span class=\"p\">,</span> <span class=\"n\">x_test</span> <span class=\"o\">/</span> <span class=\"mf\">255.0</span>\n\n<span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">tf</span><span class=\"o\">.</span><span class=\"n\">keras</span><span class=\"o\">.</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Sequential</span><span class=\"p\">([</span>\n  <span class=\"n\">tf</span><span class=\"o\">.</span><span class=\"n\">keras</span><span class=\"o\">.</span><span class=\"n\">layers</span><span class=\"o\">.</span><span class=\"n\">Flatten</span><span class=\"p\">(</span><span class=\"n\">input_shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">28</span><span class=\"p\">,</span> <span class=\"mi\">28</span><span class=\"p\">)),</span>\n  <span class=\"n\">tf</span><span class=\"o\">.</span><span class=\"n\">keras</span><span class=\"o\">.</span><span class=\"n\">layers</span><span class=\"o\">.</span><span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">128</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s1\">'relu'</span><span class=\"p\">),</span>\n  <span class=\"n\">tf</span><span class=\"o\">.</span><span class=\"n\">keras</span><span class=\"o\">.</span><span class=\"n\">layers</span><span class=\"o\">.</span><span class=\"n\">Dropout</span><span class=\"p\">(</span><span class=\"mf\">0.2</span><span class=\"p\">),</span>\n  <span class=\"n\">tf</span><span class=\"o\">.</span><span class=\"n\">keras</span><span class=\"o\">.</span><span class=\"n\">layers</span><span class=\"o\">.</span><span class=\"n\">Dense</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">activation</span><span class=\"o\">=</span><span class=\"s1\">'softmax'</span><span class=\"p\">)</span>\n<span class=\"p\">])</span>\n\n<span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">compile</span><span class=\"p\">(</span><span class=\"n\">optimizer</span><span class=\"o\">=</span><span class=\"s1\">'adam'</span><span class=\"p\">,</span>\n              <span class=\"n\">loss</span><span class=\"o\">=</span><span class=\"s1\">'sparse_categorical_crossentropy'</span><span class=\"p\">,</span>\n              <span class=\"n\">metrics</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'accuracy'</span><span class=\"p\">])</span>\n\n<span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">,</span> <span class=\"n\">epochs</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">evaluate</span><span class=\"p\">(</span><span class=\"n\">x_test</span><span class=\"p\">,</span> <span class=\"n\">y_test</span><span class=\"p\">)</span>\n</pre>\n</li>\n<li>\n<p><a href=\"https://docs.docker.com/get-started/part2/#define-a-container-with-dockerfile\" rel=\"nofollow\">Define a container with a Dockerfile</a> that includes the training script and any dependencies.</p>\n<p>The training script must be located in the <code>/opt/ml/code</code> directory.\nThe environment variable <code>SAGEMAKER_PROGRAM</code> defines which file inside the <code>/opt/ml/code</code> directory to use as the training entry point.\nWhen training starts, the interpreter executes the entry point defined by <code>SAGEMAKER_PROGRAM</code>.\nPython and shell scripts are both supported.</p>\n<pre><span class=\"k\">FROM</span> <span class=\"s\">tensorflow/tensorflow:2.1.0</span>\n\n<span class=\"k\">RUN</span> pip3 install sagemaker-training\n\n<span class=\"c\"># Copies the training script inside the container</span>\n<span class=\"k\">COPY</span> train.py /opt/ml/code/train.py\n\n<span class=\"c\"># Defines train.py as script entry point</span>\n<span class=\"k\">ENV</span> SAGEMAKER_PROGRAM train.py\n</pre>\n</li>\n<li>\n<p>Build and tag the Docker image.</p>\n<pre>docker build -t tf-2.0 .\n</pre>\n</li>\n<li>\n<p>Use the Docker image to start a training job using the <a href=\"https://github.com/aws/sagemaker-python-sdk\" rel=\"nofollow\">SageMaker Python SDK</a>.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">sagemaker.estimator</span> <span class=\"kn\">import</span> <span class=\"n\">Estimator</span>\n\n<span class=\"n\">estimator</span> <span class=\"o\">=</span> <span class=\"n\">Estimator</span><span class=\"p\">(</span><span class=\"n\">image_name</span><span class=\"o\">=</span><span class=\"s1\">'tf-2.0'</span><span class=\"p\">,</span>\n                      <span class=\"n\">role</span><span class=\"o\">=</span><span class=\"s1\">'SageMakerRole'</span><span class=\"p\">,</span>\n                      <span class=\"n\">train_instance_count</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\n                      <span class=\"n\">train_instance_type</span><span class=\"o\">=</span><span class=\"s1\">'local'</span><span class=\"p\">)</span>\n\n<span class=\"n\">estimator</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">()</span>\n</pre>\n<p>To train a model using the image on SageMaker, <a href=\"https://docs.aws.amazon.com/AmazonECR/latest/userguide/docker-push-ecr-image.html\" rel=\"nofollow\">push the image to ECR</a> and start a SageMaker training job with the image URI.</p>\n</li>\n</ol>\n<h3>Pass arguments to the entry point using hyperparameters</h3>\n<p>Any hyperparameters provided by the training job will be passed to the entry point as script arguments. The SageMaker Python SDK uses this feature to pass special hyperparameters to the training job, including <code>sagemaker_program</code> and <code>sagemaker_submit_directory</code>. The complete list of SageMaker hyperparameters is available\n<a href=\"https://github.com/aws/sagemaker-training-toolkit/blob/master/src/sagemaker_training/params.py\" rel=\"nofollow\">here</a>.</p>\n<ol>\n<li>\n<p>Implement an argument parser in the entry point script. For example, in a Python script:</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s1\">'__main__'</span><span class=\"p\">:</span>\n  <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span><span class=\"p\">()</span>\n\n  <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s1\">'--learning-rate'</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n  <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s1\">'--batch-size'</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">64</span><span class=\"p\">)</span>\n  <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s1\">'--communicator'</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n  <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s1\">'--frequency'</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n\n  <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span><span class=\"p\">()</span>\n  <span class=\"o\">...</span>\n</pre>\n</li>\n<li>\n<p>Start a training job with hyperparameters.</p>\n<pre><span class=\"p\">{</span><span class=\"s2\">\"HyperParameters\"</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">\"batch-size\"</span><span class=\"p\">:</span> <span class=\"mi\">256</span><span class=\"p\">,</span> <span class=\"s2\">\"learning-rate\"</span><span class=\"p\">:</span> <span class=\"mf\">0.0001</span><span class=\"p\">,</span> <span class=\"s2\">\"communicator\"</span><span class=\"p\">:</span> <span class=\"s2\">\"pure_nccl\"</span><span class=\"p\">}}</span>\n</pre>\n</li>\n</ol>\n<h3>Read additional information using environment variables</h3>\n<p>An entry point often needs additional information not available in <code>hyperparameters</code>.\nThe SageMaker Training Toolkit writes this information as environment variables that are available from within the script.\nFor example, this training job includes the channels <code>training</code> and <code>testing</code>:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">sagemaker.pytorch</span> <span class=\"kn\">import</span> <span class=\"n\">PyTorch</span>\n\n<span class=\"n\">estimator</span> <span class=\"o\">=</span> <span class=\"n\">PyTorch</span><span class=\"p\">(</span><span class=\"n\">entry_point</span><span class=\"o\">=</span><span class=\"s1\">'train.py'</span><span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">)</span>\n\n<span class=\"n\">estimator</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">({</span><span class=\"s1\">'training'</span><span class=\"p\">:</span> <span class=\"s1\">'s3://bucket/path/to/training/data'</span><span class=\"p\">,</span> \n               <span class=\"s1\">'testing'</span><span class=\"p\">:</span> <span class=\"s1\">'s3://bucket/path/to/testing/data'</span><span class=\"p\">})</span>\n</pre>\n<p>The environment variables <code>SM_CHANNEL_TRAINING</code> and <code>SM_CHANNEL_TESTING</code> provide the paths to the channels:</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n<span class=\"kn\">import</span> <span class=\"nn\">os</span>\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s1\">'__main__'</span><span class=\"p\">:</span>\n  <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span><span class=\"p\">()</span>\n\n  <span class=\"o\">...</span>\n\n  <span class=\"c1\"># reads input channels training and testing from the environment variables</span>\n  <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s1\">'--training'</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"p\">[</span><span class=\"s1\">'SM_CHANNEL_TRAINING'</span><span class=\"p\">])</span>\n  <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s1\">'--testing'</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"p\">[</span><span class=\"s1\">'SM_CHANNEL_TESTING'</span><span class=\"p\">])</span>\n\n  <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span><span class=\"p\">()</span>\n  <span class=\"o\">...</span>\n</pre>\n<p>When training starts, SageMaker Training Toolkit will print all available environment variables. Please see the <a href=\"https://github.com/aws/sagemaker-training-toolkit/blob/master/ENVIRONMENT_VARIABLES.md\" rel=\"nofollow\">reference on environment variables</a> for a full list of provided environment variables.</p>\n<h3>Get information about the container environment</h3>\n<p>To get information about the container environment, initialize an <code>Environment</code> object.\n<code>Environment</code> provides access to aspects of the environment relevant to training jobs, including hyperparameters, system characteristics, filesystem locations, environment variables and configuration settings.\nIt is a read-only snapshot of the container environment during training, and it doesn't contain any form of state.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">sagemaker_training</span> <span class=\"kn\">import</span> <span class=\"n\">environment</span>\n\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">environment</span><span class=\"o\">.</span><span class=\"n\">Environment</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># get the path of the channel 'training' from the ``inputdataconfig.json`` file</span>\n<span class=\"n\">training_dir</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">channel_input_dirs</span><span class=\"p\">[</span><span class=\"s1\">'training'</span><span class=\"p\">]</span>\n\n<span class=\"c1\"># get a the hyperparameter 'training_data_file' from ``hyperparameters.json`` file</span>\n<span class=\"n\">file_name</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">hyperparameters</span><span class=\"p\">[</span><span class=\"s1\">'training_data_file'</span><span class=\"p\">]</span>\n\n<span class=\"c1\"># get the folder where the model should be saved</span>\n<span class=\"n\">model_dir</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">model_dir</span>\n<span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">load</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">training_dir</span><span class=\"p\">,</span> <span class=\"n\">file_name</span><span class=\"p\">))</span>\n<span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s1\">'features'</span><span class=\"p\">],</span> <span class=\"n\">keras</span><span class=\"o\">.</span><span class=\"n\">utils</span><span class=\"o\">.</span><span class=\"n\">to_categorical</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s1\">'labels'</span><span class=\"p\">])</span>\n<span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">ResNet50</span><span class=\"p\">(</span><span class=\"n\">weights</span><span class=\"o\">=</span><span class=\"s1\">'imagenet'</span><span class=\"p\">)</span>\n<span class=\"o\">...</span>\n<span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">x_train</span><span class=\"p\">,</span> <span class=\"n\">y_train</span><span class=\"p\">)</span>\n\n<span class=\"c1\">#save the model in the end of training</span>\n<span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">model_dir</span><span class=\"p\">,</span> <span class=\"s1\">'saved_model'</span><span class=\"p\">))</span>\n</pre>\n<h3>Execute the entry point</h3>\n<p>To execute the entry point, call <code>entry_point.run()</code>.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">sagemaker_training</span> <span class=\"kn\">import</span> <span class=\"n\">entry_point</span><span class=\"p\">,</span> <span class=\"n\">environment</span>\n\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">environment</span><span class=\"o\">.</span><span class=\"n\">Environment</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># read hyperparameters as script arguments</span>\n<span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">to_cmd_args</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># get the environment variables</span>\n<span class=\"n\">env_vars</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">to_env_vars</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># execute the entry point</span>\n<span class=\"n\">entry_point</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">module_dir</span><span class=\"p\">,</span>\n                <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">user_entry_point</span><span class=\"p\">,</span>\n                <span class=\"n\">args</span><span class=\"p\">,</span>\n                <span class=\"n\">env_vars</span><span class=\"p\">)</span>\n</pre>\n<p>If the entry point execution fails, <code>trainer.train()</code> will write the error message to <code>/opt/ml/output/failure</code>. Otherwise, it will write to the file <code>/opt/ml/success</code>.</p>\n<h2>:scroll: License</h2>\n<p>This library is licensed under the <a href=\"http://aws.amazon.com/apache2.0/\" rel=\"nofollow\">Apache 2.0 License</a>.\nFor more details, please take a look at the <a href=\"https://github.com/aws/sagemaker-training-toolkit/blob/master/LICENSE\" rel=\"nofollow\">LICENSE</a> file.</p>\n<h2>:handshake: Contributing</h2>\n<p>Contributions are welcome!\nPlease read our <a href=\"https://github.com/aws/sagemaker-training-toolkit/blob/master/CONTRIBUTING.md\" rel=\"nofollow\">contributing guidelines</a>\nif you'd like to open an issue or submit a pull request.</p>\n\n          </div>"}, "last_serial": 7124582, "releases": {"3.0.0": [{"comment_text": "", "digests": {"md5": "8d669032778a7112653329a5ad079398", "sha256": "7b863364525a620ad1133b6ea2db441c6453be1f2284bfbebe411cd859cdd1c9"}, "downloads": -1, "filename": "sagemaker_training-3.0.0.tar.gz", "has_sig": true, "md5_digest": "8d669032778a7112653329a5ad079398", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 55326, "upload_time": "2020-02-11T16:23:33", "upload_time_iso_8601": "2020-02-11T16:23:33.198934Z", "url": "https://files.pythonhosted.org/packages/ee/97/988a323ba48f165e76f5a0c6d4d8b0d83d5051d0e5df5f6c097c118a07a6/sagemaker_training-3.0.0.tar.gz", "yanked": false}], "3.1.0": [{"comment_text": "", "digests": {"md5": "9fe670d65698d8b61d26cd1b133d9ebc", "sha256": "bf45226c6924534aec700bfe428f0f07f06e0b92cb9ccb68944ab7b481be8bd5"}, "downloads": -1, "filename": "sagemaker_training-3.1.0.tar.gz", "has_sig": true, "md5_digest": "9fe670d65698d8b61d26cd1b133d9ebc", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 54405, "upload_time": "2020-02-13T16:24:26", "upload_time_iso_8601": "2020-02-13T16:24:26.772506Z", "url": "https://files.pythonhosted.org/packages/2b/7c/84bf3a5a2af04fcf794f340bf3c3b9c35d928daf366c03a04a5c43bdcf13/sagemaker_training-3.1.0.tar.gz", "yanked": false}], "3.2.0": [{"comment_text": "", "digests": {"md5": "fa266dd48926d0f74d4dd04a77ad7eb2", "sha256": "071f030f4737dadbab227664e6e4451ea28f57ff1bfda6563623346fab15726d"}, "downloads": -1, "filename": "sagemaker_training-3.2.0.tar.gz", "has_sig": true, "md5_digest": "fa266dd48926d0f74d4dd04a77ad7eb2", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 48567, "upload_time": "2020-02-17T16:23:28", "upload_time_iso_8601": "2020-02-17T16:23:28.354985Z", "url": "https://files.pythonhosted.org/packages/1f/7e/6c9a638095bf4a4cb98db158df3abf704a2a9f757e7b6ed066b632590a7c/sagemaker_training-3.2.0.tar.gz", "yanked": false}], "3.3.0": [{"comment_text": "", "digests": {"md5": "27d4332ce721f807670ea5e90e5f0f1d", "sha256": "8f8aaf7128f3a3897963f83b12c1b42106d89bd553b45d10556c52cbedfc3ed4"}, "downloads": -1, "filename": "sagemaker_training-3.3.0.tar.gz", "has_sig": true, "md5_digest": "27d4332ce721f807670ea5e90e5f0f1d", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 48560, "upload_time": "2020-02-25T16:23:32", "upload_time_iso_8601": "2020-02-25T16:23:32.040316Z", "url": "https://files.pythonhosted.org/packages/dd/f9/cf4e2efb63dca7c176e37ffa07a120c4320fddd59ad437b6766889ef7d74/sagemaker_training-3.3.0.tar.gz", "yanked": false}], "3.3.1": [{"comment_text": "", "digests": {"md5": "28fe0a99742b05c43ac6d3b11b12c0a7", "sha256": "8a40b3b7680eed0ab76547492d53b2a3136d66d59262db133047f43d67e20318"}, "downloads": -1, "filename": "sagemaker_training-3.3.1.tar.gz", "has_sig": true, "md5_digest": "28fe0a99742b05c43ac6d3b11b12c0a7", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 45307, "upload_time": "2020-04-06T16:25:12", "upload_time_iso_8601": "2020-04-06T16:25:12.850419Z", "url": "https://files.pythonhosted.org/packages/19/bf/7ebd3ca4c00efdef21a36e398c3b395565b2de8ce1ea54aeac7a17273e13/sagemaker_training-3.3.1.tar.gz", "yanked": false}], "3.3.2": [{"comment_text": "", "digests": {"md5": "faca13d32abc204b192e84f7ef905a79", "sha256": "c2878a35cc0106a9a5945708d353cf732676ca65ad9d181263dcac2303de0d3f"}, "downloads": -1, "filename": "sagemaker_training-3.3.2.tar.gz", "has_sig": true, "md5_digest": "faca13d32abc204b192e84f7ef905a79", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 44068, "upload_time": "2020-04-08T16:24:43", "upload_time_iso_8601": "2020-04-08T16:24:43.335805Z", "url": "https://files.pythonhosted.org/packages/a2/52/2d77f7eceb9d57f84f3854c9d36d9ac9f9ab8bc820dc99b2a2f090d14831/sagemaker_training-3.3.2.tar.gz", "yanked": false}], "3.4.0": [{"comment_text": "", "digests": {"md5": "afccd1411e65117187c49985a85cff1f", "sha256": "1505310e28665c95a82b50a1b5297ac08137b1ae67d1b5dd242b06481fe5a6d0"}, "downloads": -1, "filename": "sagemaker_training-3.4.0.tar.gz", "has_sig": true, "md5_digest": "afccd1411e65117187c49985a85cff1f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 44965, "upload_time": "2020-04-16T16:24:55", "upload_time_iso_8601": "2020-04-16T16:24:55.245221Z", "url": "https://files.pythonhosted.org/packages/3b/38/ea4c6321dcb2ec91fb111a112d2db102c40666de09e830f312591f53c272/sagemaker_training-3.4.0.tar.gz", "yanked": false}], "3.4.1": [{"comment_text": "", "digests": {"md5": "0c66117d5ad8b35507b6e0ef3b250efa", "sha256": "ca463e4806535267a22d4c21b5597cac444b604cfbffd7dc527919daae2252c5"}, "downloads": -1, "filename": "sagemaker_training-3.4.1.tar.gz", "has_sig": true, "md5_digest": "0c66117d5ad8b35507b6e0ef3b250efa", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 44487, "upload_time": "2020-04-20T16:29:28", "upload_time_iso_8601": "2020-04-20T16:29:28.452288Z", "url": "https://files.pythonhosted.org/packages/f5/ef/be3dd9e0c5bf67fffd92933cd10905c10f08210af34bfc9b4e33c62294cb/sagemaker_training-3.4.1.tar.gz", "yanked": false}], "3.4.2": [{"comment_text": "", "digests": {"md5": "aaaf3369ae2d7eece1cc06766765dc07", "sha256": "759f9fe34c214338b8b62111441accb3d5a688eae88147a84776816a242125e6"}, "downloads": -1, "filename": "sagemaker_training-3.4.2.tar.gz", "has_sig": true, "md5_digest": "aaaf3369ae2d7eece1cc06766765dc07", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 41779, "upload_time": "2020-04-21T16:32:14", "upload_time_iso_8601": "2020-04-21T16:32:14.951219Z", "url": "https://files.pythonhosted.org/packages/c7/b3/8d9aea079f5fe22697ba719518748164a6f8dce5fd2f155d4b99fbd97513/sagemaker_training-3.4.2.tar.gz", "yanked": false}], "3.5.0": [{"comment_text": "", "digests": {"md5": "d6667212c78912f9bd1774b835af4d00", "sha256": "d53f1a0b79957747091bb97405ecbc07350cb9945f0bc8f4b4e3dbca9fdf98bb"}, "downloads": -1, "filename": "sagemaker_training-3.5.0.tar.gz", "has_sig": true, "md5_digest": "d6667212c78912f9bd1774b835af4d00", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 41778, "upload_time": "2020-04-27T18:05:09", "upload_time_iso_8601": "2020-04-27T18:05:09.184801Z", "url": "https://files.pythonhosted.org/packages/95/20/e4b33d7dda4af4ce74cd6638549c04066b1daaa3ce5a6dc808f7e43124fb/sagemaker_training-3.5.0.tar.gz", "yanked": false}], "3.5.0.post0": [{"comment_text": "", "digests": {"md5": "629d2b97905c066e12c50155700bf193", "sha256": "a9fc49e10c9b3b921daca2f4186f39852e5465d3b530fe953e7a4364a7d9ad2f"}, "downloads": -1, "filename": "sagemaker_training-3.5.0.post0.tar.gz", "has_sig": true, "md5_digest": "629d2b97905c066e12c50155700bf193", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 41797, "upload_time": "2020-04-29T00:22:30", "upload_time_iso_8601": "2020-04-29T00:22:30.180368Z", "url": "https://files.pythonhosted.org/packages/5c/eb/f34f25f3a1c04599f024fcb9bb025c74c5e1b6d1847358f4914f4957ad32/sagemaker_training-3.5.0.post0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "629d2b97905c066e12c50155700bf193", "sha256": "a9fc49e10c9b3b921daca2f4186f39852e5465d3b530fe953e7a4364a7d9ad2f"}, "downloads": -1, "filename": "sagemaker_training-3.5.0.post0.tar.gz", "has_sig": true, "md5_digest": "629d2b97905c066e12c50155700bf193", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 41797, "upload_time": "2020-04-29T00:22:30", "upload_time_iso_8601": "2020-04-29T00:22:30.180368Z", "url": "https://files.pythonhosted.org/packages/5c/eb/f34f25f3a1c04599f024fcb9bb025c74c5e1b6d1847358f4914f4957ad32/sagemaker_training-3.5.0.post0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 02:59:16 2020"}