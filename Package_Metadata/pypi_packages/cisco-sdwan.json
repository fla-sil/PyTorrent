{"info": {"author": "Marcelo Reis", "author_email": "mareis@cisco.com", "bugtrack_url": null, "classifiers": ["License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.6"], "description": "[![published](https://static.production.devnetcloud.com/codeexchange/assets/images/devnet-published.svg)](https://developer.cisco.com/codeexchange/github/repo/reismarcelo/sastre)\n\n# Sastre - Automation Tools for Cisco SD-WAN Powered by Viptela\n\nSastre provides functions to assist with managing configuration elements in Cisco vManage, including backup, restore and delete tasks.\n\n## Introduction\n\nSastre has a set of base parameters as well as task-specific arguments. \n\nThe command line is structured as follows:\n\n    sdwan <base parameters> <task> <task-specific parameters>\n\nCurrently available tasks: \n- Backup: Save vManage configuration items to a local backup.\n- Restore: Restore configuration items from a local backup to vManage.\n- Delete: Delete configuration items on vManage.\n- Certificate: Restore device certificate validity status from a backup or set to a desired value (i.e. valid, invalid or staging).\n- List: List configuration items or device certificate information from vManage or a local backup. Display as table or export as csv file.\n- Show-template: Show details about device templates on vManage or from a local backup. Display as table or export as csv file.\n\nNotes:\n- Either 'sdwan' or 'sastre' can be used as the main command.\n- The command line described above, and in all examples that follow, assume Sastre was installed from PyPI, via PIP. \n- If Sastre was download from GitHub, then 'sdwan.py' or 'sastre.py' should used instead. Please check the installation section for more details.\n\n### Base parameters\n\n    % sdwan -h\n    usage: sdwan.py [-h] [-a <vmanage-ip>] [-u <user>] [-p <password>] [--port <port>] [--timeout <timeout>] [--verbose] [--version] <task> ...\n\n    Sastre - Automation Tools for Cisco SD-WAN Powered by Viptela\n\n    positional arguments:\n      <task>                task to be performed (backup, restore, delete, certificate, list, show-template)\n      <arguments>           task parameters, if any\n\n    optional arguments:\n      -h, --help            show this help message and exit\n      -a <vmanage-ip>, --address <vmanage-ip>\n                            vManage IP address, can also be defined via VMANAGE_IP environment variable. If neither is provided user is prompted for an address.\n      -u <user>, --user <user>\n                            user name, can also be defined via VMANAGE_USER environment variable. If neither is provided user is prompted for a user name.\n      -p <password>, --password <password>\n                            password, can also be defined via VMANAGE_PASSWORD environment variable. If neither is provided user is prompted for a password.\n      --port <port>         vManage TCP port number (default is 8443)\n      --timeout <timeout>   REST API timeout (default is 300s)\n      --verbose             increase output verbosity\n      --version             show program's version number and exit\n\nvManage address (-a/--address), user name (-u/--user) and password (-p/--password) can also be provided via environment variables:\n- VMANAGE_IP\n- VMANAGE_USER\n- VMANAGE_PASSWORD\n\nA good approach to reduce the number of parameters that need to be provided at execution is to create rc text files exporting those environment variables for a particular vManage. This is demonstrated in the Getting Started section below.\n\nFor any of these arguments, vManage address, user and password; if they are not provided via the environment variables or command line arguments, the user is prompted for a value.\n\n### Task-specific parameters\n\nTask-specific parameters and options are defined after the task is provided. Each task has its own set of parameters.\n\n    % sdwan backup -h\n    usage: sdwan backup [-h] [--workdir <directory>] [--regex <regex>] <tag> [<tag> ...]\n\n    Sastre - Automation Tools for Cisco SD-WAN Powered by Viptela\n\n    Backup task:\n\n    positional arguments:\n      <tag>                 One or more tags for selecting items to be backed up. Multiple tags should be separated by space. Available\n                            tags: all, policy_definition, policy_list, policy_security, policy_vedge, policy_vsmart, template_device,\n                            template_feature. Special tag 'all' selects all items, including WAN edge certificates.\n\n    optional arguments:\n      -h, --help            show this help message and exit\n      --workdir <directory>\n                            Backup destination (default will be \"backup_198.18.1.10_20200226\").\n      --regex <regex>       Regular expression matching item names to be backed up, within selected tags.\n\n#### Important concepts:\n- vManage URL: Built from the provided vManage IP address and TCP port (default 8443). All operations target this vManage.\n- Workdir: Defines the location (in the local machine) where vManage data files are located. By default it follows the format \"backup_\\<vmanage-ip\\>_\\<yyyymmdd\\>\". The --workdir parameter can be used to specify a different location.  Workdir is under a 'data' directory. This 'data' directory is relative to the directory where Sastre is run.\n- Tag: vManage configuration items are grouped by tags, such as policy_apply, policy_definition, policy_list, template_device, etc. The special tag 'all' is used to refer to all configuration elements. Depending on the task, one or more tags can be specified in order to select groups of configuration elements.\n\n## Getting Started\n\nCreate a directory to serve as root for backup files, log files and rc files:\n\n    % mkdir sastre\n    % cd sastre\n\nWhen Sastre is executed, data/ and logs/ directories are created as needed to store backup files and application logs. These are created under the directory where Sastre is run.\n\nCreate an rc-example.sh file to include vManage details and source that file:\n\n    % cat <<EOF > rc-example.sh\n     export VMANAGE_IP='10.85.136.253'\n     export VMANAGE_USER='admin'\n    EOF\n    % source rc-example.sh\n\nNote that in this example the password was not defined, the user will be prompted for a password.\n\nTest vManage credentials by running a simple query listing configured device templates:\n\n    % sdwan list configuration template_device\n    vManage password: \n    +-----------------+--------------------------------------+-----------------+-----------------+\n    | Name            | ID                                   | Tag             | Type            |\n    +-----------------+--------------------------------------+-----------------+-----------------+\n    | DC_ADVANCED     | bf322748-8dfd-4cb0-a9e4-5d758be239a0 | template_device | device template |\n    | DC_BASIC        | 09c02518-9557-4ae2-9031-7e6b3e7323fc | template_device | device template |\n    | VSMART_v1       | 15c1962f-740e-4b89-a269-69f2cbfba296 | template_device | device template |\n    | BRANCH_ADVANCED | ad449106-7ed6-442f-9ba8-820612b85981 | template_device | device template |\n    | BRANCH_BASIC    | cc2f7a24-4c93-49ed-8e6b-1c107797ba95 | template_device | device template |\n    +-----------------+--------------------------------------+-----------------+-----------------+\n\nAny those vManage parameters can also be provided via command line:\n\n    % sdwan -p admin list configuration template_device\n\nPerform a backup:\n\n    % sdwan --verbose backup all\n    INFO: Starting backup: vManage URL: \"https://10.85.136.253:8443\" > Local workdir: \"backup_10.85.136.253_20191206\"\n    INFO: Saved vManage server information\n    INFO: Saved WAN edge certificates\n    INFO: Saved device template index\n    INFO: Done device template DC_ADVANCED\n    INFO: Done device template DC_BASIC\n    INFO: Done device template DC_BASIC attached devices\n    INFO: Done device template DC_BASIC values\n    <snip>\n    INFO: Done SLA-class list Realtime_Full_Mesh\n    INFO: Task completed successfully\n\nNote that '--verbose' was specified so that progress information is displayed. Without this option, only warning-level messages and above are displayed.\n\nThe backup is saved under data/backup_10.85.136.253_20191206:\n\n    % ls\n    data\t\tlogs\t\trc-example.sh\n    % ls data\n    backup_10.85.136.253_20191206\n\n## Additional Examples\n\n### Customizing backup destination:\n\n    % sdwan --verbose backup all --workdir \"my_custom_directory\"\n    INFO: Starting backup: vManage URL: \"https://10.85.136.253:8443\" > Local workdir: \"my_custom_directory\"\n    INFO: Saved vManage server information\n    INFO: Saved WAN edge certificates\n    INFO: Saved device template index\n    INFO: Done device template DC_ADVANCED\n    INFO: Done device template DC_BASIC\n    <snip>\n    INFO: Done SLA-class list Realtime_Full_Mesh\n    INFO: Task completed successfully\n\n### Restoring from backup:\n\n    % sdwan --verbose restore all        \n    INFO: Starting restore: Local workdir: \"backup_10.85.136.253_20191206\" > vManage URL: \"https://10.85.136.253:8443\"\n    INFO: Loading existing items from target vManage\n    INFO: Identifying items to be pushed\n    INFO: Inspecting template_device items\n    INFO: Inspecting template_feature items\n    INFO: Inspecting policy_vsmart items\n    INFO: Inspecting policy_vedge items\n    INFO: Inspecting policy_security items\n    INFO: Inspecting policy_definition items\n    INFO: Inspecting policy_list items\n    INFO: Pushing items to vManage\n    INFO: Done: Create SLA-class list Best_Effort\n    INFO: Done: Create SLA-class list Realtime_Full_Mesh\n    INFO: Done: Create site list All_Sites\n    INFO: Done: Create class list af2\n    <snip>\n    INFO: Done: Create device template BRANCH_ADVANCED\n    INFO: Done: Create device template BRANCH_BASIC\n    INFO: Task completed successfully\n\n#### Restoring from a backup in a different directory than the default:\n\n    % sdwan --verbose restore all --workdir my_custom_directory\n    INFO: Starting restore: Local workdir: \"my_custom_directory\" > vManage URL: \"https://10.85.136.253:8443\"\n    INFO: Loading existing items from target vManage\n    INFO: Identifying items to be pushed\n    INFO: Inspecting template_device items\n    INFO: Inspecting template_feature items\n    <snip>\n    INFO: Task completed successfully\n\n#### Restoring with template attachments and policy activation:\n\n    % sdwan --verbose restore all --attach\n    INFO: Starting restore: Local workdir: \"backup_10.85.136.253_20191206\" > vManage URL: \"https://10.85.136.253:8443\"\n    INFO: Loading existing items from target vManage\n    <snip>\n    INFO: Attaching WAN Edge templates\n    INFO: Waiting...\n    INFO: Waiting...\n    INFO: Waiting...\n    INFO: Waiting...\n    INFO: Completed DC_BASIC,BRANCH_BASIC\n    INFO: Completed attaching WAN Edge templates\n    INFO: Attaching vSmart template\n    INFO: Waiting...\n    INFO: Waiting...\n    INFO: Completed VSMART_v1\n    INFO: Completed attaching vSmart template\n    INFO: Activating vSmart policy\n    INFO: Waiting...\n    INFO: Waiting...\n    INFO: Completed Central_policy_v1\n    INFO: Completed activating vSmart policy\n    INFO: Task completed successfully\n\n#### Overwriting items with the --force option:\n- By default, when an item from backup has the same name as an existing item in vManage, it will be skipped by restore. Leaving the existing one intact.\n- When an item, say a device template, is modified in vManage. Performing a restore from a backup taken before the modification will skip that item.\n- With the --force option, items with the same name are updated with the info found in the backup.\n- Sastre only updates the item when its contents differ from what is in vManage.\n- If the item is associated with attached templates or activated policies, all necessary re-attach/re-activate actions are automatically performed.\n- Currently, the --force option does not apply to changes in template values. \n\nExample:\n\n    % sdwan --verbose restore all --workdir state_b --force\n    INFO: Starting restore: Local workdir: \"state_b\" > vManage URL: \"https://10.85.136.253:8443\"\n    INFO: Loading existing items from target vManage\n    INFO: Identifying items to be pushed\n    INFO: Inspecting template_device items\n    INFO: Inspecting template_feature items\n    INFO: Inspecting policy_vsmart items\n    INFO: Inspecting policy_vedge items\n    INFO: Inspecting policy_security items\n    INFO: Inspecting policy_definition items\n    INFO: Inspecting policy_list items\n    INFO: Pushing items to vManage\n    INFO: Done: Create community list LOCAL_DC_PREFIXES\n    INFO: Done: Create community list REMAINING_PREFIXES\n    INFO: Updating SLA-class list Best_Effort requires reattach of affected templates\n    INFO: Reattaching templates\n    INFO: Waiting...\n    INFO: Waiting...\n    INFO: Completed VSMART_v1\n    INFO: Completed reattaching templates\n    INFO: Done: Update SLA-class list Best_Effort\n    <snip>\n    INFO: Done: Update device template DC_BASIC\n    INFO: Task completed successfully\n\n### Deleting vManage items:\n\nDry-run, just list without deleting items matching the specified tag and regular expression:\n\n    % sdwan --verbose delete all --regex \"^DC\"  --dryrun\n    INFO: Starting delete, DRY-RUN mode: vManage URL: \"https://10.85.136.253:8443\"\n    INFO: Inspecting template_device items\n    INFO: DRY-RUN: Delete device template DC_BASIC\n    INFO: DRY-RUN: Delete device template DC_ADVANCED\n    INFO: Inspecting template_feature items\n    INFO: Inspecting policy_vsmart items\n    INFO: Inspecting policy_vedge items\n    INFO: Inspecting policy_security items\n    INFO: Inspecting policy_definition items\n    INFO: Inspecting policy_list items\n    INFO: Task completed successfully\n\nDeleting items:\n\n    % sdwan --verbose delete all --regex \"^DC\"\n    INFO: Starting delete: vManage URL: \"https://10.85.136.253:8443\"\n    INFO: Inspecting template_device items\n    INFO: Done: Delete device template DC_BASIC\n    INFO: Done: Delete device template DC_ADVANCED\n    INFO: Inspecting template_feature items\n    INFO: Inspecting policy_vsmart items\n    INFO: Inspecting policy_vedge items\n    INFO: Inspecting policy_security items\n    INFO: Inspecting policy_definition items\n    INFO: Inspecting policy_list items\n    INFO: Task completed successfully\n\n#### Deleting with detach:\nWhen vSmart policies are activated and device templates are attached the associated items cannot be deleted. \nThe --detach option performs the necessary template detach and vSmart policy deactivate before proceeding with the delete.\n\n    % sdwan --verbose delete all --detach\n    INFO: Starting delete: vManage URL: \"https://10.85.136.253:8443\"\n    INFO: Detaching WAN Edge templates\n    INFO: Waiting...\n    INFO: Completed BRANCH_BASIC\n    INFO: Completed DC_BASIC\n    INFO: Completed detaching WAN Edge templates\n    INFO: Deactivating vSmart policy\n    INFO: Waiting...\n    INFO: Completed Central_policy_v1\n    INFO: Completed deactivating vSmart policy\n    INFO: Detaching vSmart template\n    INFO: Waiting...\n    INFO: Completed VSMART_v1\n    INFO: Completed detaching vSmart template\n    INFO: Inspecting template_device items\n    INFO: Done: Delete device template vManage_template\n    <snip>\n    INFO: Task completed successfully\n\n### Listing items from vManage or from a backup:\n\nThe list task can be used to list items from a target vManage, or a backup directory, matching a criteria of item tag(s) and regular expression.\n\nList device templates and feature templates from target vManage:\n\n    % sdwan --verbose list configuration template_device template_feature\n    INFO: Starting list configuration: vManage URL: \"https://198.18.1.10:8443\"\n    INFO: List criteria matched 45 items\n    +---------------------------+--------------------------------------+------------------+------------------+\n    | Name                      | ID                                   | Tag              | Type             |\n    +---------------------------+--------------------------------------+------------------+------------------+\n    | BRANCH_ADVANCED           | 6ece1f27-fbfa-4730-9a8f-b61bfd380047 | template_device  | device template  |\n    | VSMART_v1                 | ba623cf6-5d2c-4676-a763-11b9cf866074 | template_device  | device template  |\n    | BRANCH_BASIC              | 5e362c85-8251-428a-b650-d364f8e15a22 | template_device  | device template  |\n    <snip>\n    | vSmart_VPN0_Interface_v1  | be09349e-308e-4ca5-a306-fb7bcd5bcb28 | template_feature | feature template |\n    +---------------------------+--------------------------------------+------------------+------------------+\n    INFO: Task completed successfully\n\n List all items from target vManage with name starting with 'DC':\n\n    % sdwan --verbose list configuration all --regex \"^DC\"\n    INFO: Starting list configuration: vManage URL: \"https://198.18.1.10:8443\"\n    INFO: List criteria matched 2 items\n    +-------------+--------------------------------------+-----------------+-----------------+\n    | Name        | ID                                   | Tag             | Type            |\n    +-------------+--------------------------------------+-----------------+-----------------+\n    | DC_BASIC    | 2ba8c66a-eadd-4a63-97c9-50d58a43b6b5 | template_device | device template |\n    | DC_ADVANCED | b042ed29-3875-4118-b800-a0b00542b58e | template_device | device template |\n    +-------------+--------------------------------------+-----------------+-----------------+\n    INFO: Task completed successfully\n\nList all items from backup directory with name starting with 'DC':\n\n    % sdwan --verbose list configuration all --regex \"^DC\" --workdir backup_10.85.136.253_20191206\n    INFO: Starting list configuration: Local workdir: \"backup_10.85.136.253_20191206\"\n    INFO: List criteria matched 2 items\n    +-------------+--------------------------------------+-----------------+-----------------+\n    | Name        | ID                                   | Tag             | Type            |\n    +-------------+--------------------------------------+-----------------+-----------------+\n    | DC_ADVANCED | bf322748-8dfd-4cb0-a9e4-5d758be239a0 | template_device | device template |\n    | DC_BASIC    | 09c02518-9557-4ae2-9031-7e6b3e7323fc | template_device | device template |\n    +-------------+--------------------------------------+-----------------+-----------------+\n    INFO: Task completed successfully\n\nList also allows displaying device certificate information.\n\n    % sdwan --verbose list certificate                     \n    INFO: Starting list certificates: vManage URL: \"https://198.18.1.10:8443\"\n    INFO: List criteria matched 5 items\n    +------------+------------------------------------------+----------------------------------+----------------------------+--------+\n    | Hostname   | Chassis                                  | Serial                           | State                      | Status |\n    +------------+------------------------------------------+----------------------------------+----------------------------+--------+\n    | DC1-VEDGE1 | ebdc8bd9-17e5-4eb3-a5e0-f438403a83de     | ee08f743                         | certificate installed      | valid  |\n    | -          | 52c7911f-c5b0-45df-b826-3155809a2a1a     | 24801375888299141d620fbdb02de2d4 | bootstrap config generated | valid  |\n    | DC1-VEDGE2 | f21dbb35-30b3-47f4-93bb-d2b2fe092d35     | b02445f6                         | certificate installed      | valid  |\n    | BR1-CEDGE2 | CSR-04ed104b-86bb-4cb3-bd2b-a0d0991f6872 | AAC6C8F0                         | certificate installed      | valid  |\n    | BR1-CEDGE1 | CSR-940ad679-a16a-48ea-9920-16278597d98e | 487D703A                         | certificate installed      | valid  |\n    +------------+------------------------------------------+----------------------------------+----------------------------+--------+\n    INFO: Task completed successfully\n\n\nSimilar to the list task, show tasks can be used to show items from a target vManage, or a backup. With show tasks, additional details about the selected items are displayed. The item id, name or a regular expression can be used to identify which item(s) to display.\n\n    % sdwan show-template values --name DC_BASIC\n    Device template DC_BASIC, values for vedge-dc1:\n    +-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n    | Name                              | Value                                | Variable                                                           |\n    +-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n    | Status                            | complete                             | csv-status                                                         |\n    | Chassis Number                    | b693be59-c03f-62d0-f9a4-2675374536b8 | csv-deviceId                                                       |\n    | System IP                         | 10.255.101.1                         | csv-deviceIP                                                       |\n    | Hostname                          | vedge-dc1                            | csv-host-name                                                      |\n    | Hostname(system_host_name)        | vedge-dc1                            | //system/host-name                                                 |\n    | System IP(system_system_ip)       | 10.255.101.1                         | //system/system-ip                                                 |\n    | Site ID(system_site_id)           | 101                                  | //system/site-id                                                   |\n    | IPv4 Address(vpn_if_ipv4_address) | 10.101.1.4/24                        | /10/ge0/2/interface/ip/address                                     |\n    | IPv4 Address(vpn_if_ipv4_address) | 5.254.4.110/24                       | /20/ge0/3/interface/ip/address                                     |\n    | AS Number(bgp_as_num)             | 65001                                | /20//router/bgp/as-num                                             |\n    | Address(bgp_neighbor_address)     | 5.254.4.1                            | /20//router/bgp/neighbor/bgp_neighbor_address/address              |\n    | Remote AS(bgp_neighbor_remote_as) | 65111                                | /20//router/bgp/neighbor/bgp_neighbor_address/remote-as            |\n    | Preference(transport1_preference) | 100                                  | /0/ge0/0/interface/tunnel-interface/encapsulation/ipsec/preference |\n    +-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n\n    Device template DC_BASIC, values for vedge-dc2:\n    +-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n    | Name                              | Value                                | Variable                                                           |\n    +-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n    | Status                            | complete                             | csv-status                                                         |\n    | Chassis Number                    | 0dd49ace-f6de-ce86-5d73-ca74d6db1747 | csv-deviceId                                                       |\n    | System IP                         | 10.255.102.1                         | csv-deviceIP                                                       |\n    | Hostname                          | vedge-dc2                            | csv-host-name                                                      |\n    | Hostname(system_host_name)        | vedge-dc2                            | //system/host-name                                                 |\n    | System IP(system_system_ip)       | 10.255.102.1                         | //system/system-ip                                                 |\n    | Site ID(system_site_id)           | 102                                  | //system/site-id                                                   |\n    | IPv4 Address(vpn_if_ipv4_address) | 10.102.1.3/24                        | /10/ge0/2/interface/ip/address                                     |\n    | IPv4 Address(vpn_if_ipv4_address) | 5.254.5.105/24                       | /20/ge0/3/interface/ip/address                                     |\n    | AS Number(bgp_as_num)             | 65002                                | /20//router/bgp/as-num                                             |\n    | Address(bgp_neighbor_address)     | 5.254.5.1                            | /20//router/bgp/neighbor/bgp_neighbor_address/address              |\n    | Remote AS(bgp_neighbor_remote_as) | 65222                                | /20//router/bgp/neighbor/bgp_neighbor_address/remote-as            |\n    | Preference(transport1_preference) | 0                                    | /0/ge0/0/interface/tunnel-interface/encapsulation/ipsec/preference |\n    +-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n\n### Modifying device certificate validity status:\n\nRestore certificate validity status from a backup:\n\n    % sdwan --verbose certificate restore --workdir test\n    INFO: Starting certificate: Restore status workdir: \"test\" > vManage URL: \"https://198.18.1.10:8443\"\n    INFO: Loading WAN edge certificate list from target vManage\n    INFO: Identifying items to be pushed\n    INFO: Will update DC1-VEDGE1 status: valid -> staging\n    INFO: Will update 52c7911f-c5b0-45df-b826-3155809a2a1a status: valid -> invalid\n    INFO: Will update DC1-VEDGE2 status: valid -> staging\n    INFO: Will update BR1-CEDGE2 status: valid -> staging\n    INFO: Will update BR1-CEDGE1 status: valid -> staging\n    INFO: Pushing certificate status changes to vManage\n    INFO: Certificate sync with controllers\n    INFO: Waiting...\n    INFO: Completed certificate sync with controllers\n    INFO: Task completed successfully\n\nSet certificate validity status to a desired value:\n\n     % sdwan --verbose certificate set valid             \n    INFO: Starting certificate: Set status to \"valid\" > vManage URL: \"https://198.18.1.10:8443\"\n    INFO: Loading WAN edge certificate list from target vManage\n    INFO: Identifying items to be pushed\n    INFO: Will update DC1-VEDGE1 status: staging -> valid\n    INFO: Will update 52c7911f-c5b0-45df-b826-3155809a2a1a status: invalid -> valid\n    INFO: Will update DC1-VEDGE2 status: staging -> valid\n    INFO: Will update BR1-CEDGE2 status: staging -> valid\n    INFO: Will update BR1-CEDGE1 status: staging -> valid\n    INFO: Pushing certificate status changes to vManage\n    INFO: Certificate sync with controllers\n    INFO: Waiting...\n    INFO: Completed certificate sync with controllers\n    INFO: Task completed successfully\n\n## Notes\n\n### Regular Expressions\n\nIt is recommended to always use double quotes when specifying a regular expression to --regex option:\n\n    sdwan --verbose restore all --regex \"VPN1\"\n\nThis is to prevent the shell from interpreting special characters that could be part of the pattern provided.\n\nMatching done by --regex is un-anchored. That is, unless anchor marks are provided (e.g. ^ or $), the specified pattern matches if present anywhere in the string. In other words, this is a search function.\n\nThe regular expression syntax supported is described in https://docs.python.org/3/library/re.html\n\n### Logs\n\nSastre logs messages to the terminal and to log files (under the logs directory).\n\nDebug-level and higher severity messages are always saved to the log files.\n\nThe --verbose flag controls the severity of messages printed to the terminal. If --verbose is not specified, only warning-level and higher messages are logged. When --verbose is specified, informational-level and higher messages are printed. \n\n### Restore behavior\n\nBy default, restore will skip items with the same name. If an existing item in vManage has the same name as an item in the backup this item is skipped from restore.\n\nAny references/dependencies on that item are properly updated. For instance, if a feature template is not pushed to vManage because an item with the same name is already present, device templates being pushed will now point to the feature template which was already in vManage.\n\nAdding the --force option to restore modifies this behavior. In this case Sastre will update existing items containing the same name as in the backup, but only if their content is different.\n\nWhen an existing vManage item is modified, device templates may need to be reattached or vSmart policies may need to be re-activated. This is handled by Sastre as follows:\n- Updating items associated with an active vSmart policy may require this policy to be re-activated. In this case, Sastre will request the policy reactivate automatically.\n- On updates to a master template (e.g. device template) containing attached devices, Sastre will re-attach this device template using attachment values (variables) from the backup to feed the attach request.\n- On Updates to a child template (e.g. feature template) associated with a master template containing attached devices, Sastre will re-attach the affected master template(s). In this case, Sastre will use the existing values in vManage to feed the attach request.\n\nThe implication is that if modified child templates (e.g. feature template) define new variables, re-attaching the master template will fail because not all variables will have values assigned. In this case, the recommended procedure is to detach the master template (i.e. change device to CLI mode in vManage), re-run \u201crestore --force\", then re-attach the device-template from vManage, where one would have a chance to supply any missing variable values.\n\n## Installing\n\nSastre requires Python 3.6 or newer. This can be verified by pasting the following to a terminal window:\n\n    % python3 -c \"import sys;assert sys.version_info>(3,6)\" && echo \"ALL GOOD\"\n\nIf 'ALL GOOD' is printed it means Python requirements are met. If not, download and install the latest 3.x version at Python.org (https://www.python.org/downloads/).\n\nThe recommended way to install Sastre is via pip. For development purposes, Sastre can be installed from the github repository. Both methods are described in this section.\n\n### PIP install (recommended)\n\nTo install Sastre:\n\n    % python3 -m pip install --upgrade cisco-sdwan\n\nVerify that Sastre can run:\n\n    % sdwan --version\n\n### Github install\n\nInstall required Python packages:\n\n    % python3 -m pip install --upgrade requests\n\nClone from the github repository:\n\n    % git clone https://github.com/reismarcelo/sastre\n\nMove to the clone directory:\n\n    % cd sastre\n\nVerify that Sastre can run:\n\n    % python3 sdwan.py --version\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/reismarcelo/sastre", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "cisco-sdwan", "package_url": "https://pypi.org/project/cisco-sdwan/", "platform": "", "project_url": "https://pypi.org/project/cisco-sdwan/", "project_urls": {"Homepage": "https://github.com/reismarcelo/sastre"}, "release_url": "https://pypi.org/project/cisco-sdwan/0.37/", "requires_dist": ["requests"], "requires_python": ">=3.6", "summary": "Automation Tools for Cisco SD-WAN Powered by Viptela", "version": "0.37", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><a href=\"https://developer.cisco.com/codeexchange/github/repo/reismarcelo/sastre\" rel=\"nofollow\"><img alt=\"published\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/4a9074a71b4ac5c0b3423a8718c6a99349de9bb5/68747470733a2f2f7374617469632e70726f64756374696f6e2e6465766e6574636c6f75642e636f6d2f636f646565786368616e67652f6173736574732f696d616765732f6465766e65742d7075626c69736865642e737667\"></a></p>\n<h1>Sastre - Automation Tools for Cisco SD-WAN Powered by Viptela</h1>\n<p>Sastre provides functions to assist with managing configuration elements in Cisco vManage, including backup, restore and delete tasks.</p>\n<h2>Introduction</h2>\n<p>Sastre has a set of base parameters as well as task-specific arguments.</p>\n<p>The command line is structured as follows:</p>\n<pre><code>sdwan &lt;base parameters&gt; &lt;task&gt; &lt;task-specific parameters&gt;\n</code></pre>\n<p>Currently available tasks:</p>\n<ul>\n<li>Backup: Save vManage configuration items to a local backup.</li>\n<li>Restore: Restore configuration items from a local backup to vManage.</li>\n<li>Delete: Delete configuration items on vManage.</li>\n<li>Certificate: Restore device certificate validity status from a backup or set to a desired value (i.e. valid, invalid or staging).</li>\n<li>List: List configuration items or device certificate information from vManage or a local backup. Display as table or export as csv file.</li>\n<li>Show-template: Show details about device templates on vManage or from a local backup. Display as table or export as csv file.</li>\n</ul>\n<p>Notes:</p>\n<ul>\n<li>Either 'sdwan' or 'sastre' can be used as the main command.</li>\n<li>The command line described above, and in all examples that follow, assume Sastre was installed from PyPI, via PIP.</li>\n<li>If Sastre was download from GitHub, then 'sdwan.py' or 'sastre.py' should used instead. Please check the installation section for more details.</li>\n</ul>\n<h3>Base parameters</h3>\n<pre><code>% sdwan -h\nusage: sdwan.py [-h] [-a &lt;vmanage-ip&gt;] [-u &lt;user&gt;] [-p &lt;password&gt;] [--port &lt;port&gt;] [--timeout &lt;timeout&gt;] [--verbose] [--version] &lt;task&gt; ...\n\nSastre - Automation Tools for Cisco SD-WAN Powered by Viptela\n\npositional arguments:\n  &lt;task&gt;                task to be performed (backup, restore, delete, certificate, list, show-template)\n  &lt;arguments&gt;           task parameters, if any\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -a &lt;vmanage-ip&gt;, --address &lt;vmanage-ip&gt;\n                        vManage IP address, can also be defined via VMANAGE_IP environment variable. If neither is provided user is prompted for an address.\n  -u &lt;user&gt;, --user &lt;user&gt;\n                        user name, can also be defined via VMANAGE_USER environment variable. If neither is provided user is prompted for a user name.\n  -p &lt;password&gt;, --password &lt;password&gt;\n                        password, can also be defined via VMANAGE_PASSWORD environment variable. If neither is provided user is prompted for a password.\n  --port &lt;port&gt;         vManage TCP port number (default is 8443)\n  --timeout &lt;timeout&gt;   REST API timeout (default is 300s)\n  --verbose             increase output verbosity\n  --version             show program's version number and exit\n</code></pre>\n<p>vManage address (-a/--address), user name (-u/--user) and password (-p/--password) can also be provided via environment variables:</p>\n<ul>\n<li>VMANAGE_IP</li>\n<li>VMANAGE_USER</li>\n<li>VMANAGE_PASSWORD</li>\n</ul>\n<p>A good approach to reduce the number of parameters that need to be provided at execution is to create rc text files exporting those environment variables for a particular vManage. This is demonstrated in the Getting Started section below.</p>\n<p>For any of these arguments, vManage address, user and password; if they are not provided via the environment variables or command line arguments, the user is prompted for a value.</p>\n<h3>Task-specific parameters</h3>\n<p>Task-specific parameters and options are defined after the task is provided. Each task has its own set of parameters.</p>\n<pre><code>% sdwan backup -h\nusage: sdwan backup [-h] [--workdir &lt;directory&gt;] [--regex &lt;regex&gt;] &lt;tag&gt; [&lt;tag&gt; ...]\n\nSastre - Automation Tools for Cisco SD-WAN Powered by Viptela\n\nBackup task:\n\npositional arguments:\n  &lt;tag&gt;                 One or more tags for selecting items to be backed up. Multiple tags should be separated by space. Available\n                        tags: all, policy_definition, policy_list, policy_security, policy_vedge, policy_vsmart, template_device,\n                        template_feature. Special tag 'all' selects all items, including WAN edge certificates.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --workdir &lt;directory&gt;\n                        Backup destination (default will be \"backup_198.18.1.10_20200226\").\n  --regex &lt;regex&gt;       Regular expression matching item names to be backed up, within selected tags.\n</code></pre>\n<h4>Important concepts:</h4>\n<ul>\n<li>vManage URL: Built from the provided vManage IP address and TCP port (default 8443). All operations target this vManage.</li>\n<li>Workdir: Defines the location (in the local machine) where vManage data files are located. By default it follows the format \"backup_&lt;vmanage-ip&gt;_&lt;yyyymmdd&gt;\". The --workdir parameter can be used to specify a different location.  Workdir is under a 'data' directory. This 'data' directory is relative to the directory where Sastre is run.</li>\n<li>Tag: vManage configuration items are grouped by tags, such as policy_apply, policy_definition, policy_list, template_device, etc. The special tag 'all' is used to refer to all configuration elements. Depending on the task, one or more tags can be specified in order to select groups of configuration elements.</li>\n</ul>\n<h2>Getting Started</h2>\n<p>Create a directory to serve as root for backup files, log files and rc files:</p>\n<pre><code>% mkdir sastre\n% cd sastre\n</code></pre>\n<p>When Sastre is executed, data/ and logs/ directories are created as needed to store backup files and application logs. These are created under the directory where Sastre is run.</p>\n<p>Create an rc-example.sh file to include vManage details and source that file:</p>\n<pre><code>% cat &lt;&lt;EOF &gt; rc-example.sh\n export VMANAGE_IP='10.85.136.253'\n export VMANAGE_USER='admin'\nEOF\n% source rc-example.sh\n</code></pre>\n<p>Note that in this example the password was not defined, the user will be prompted for a password.</p>\n<p>Test vManage credentials by running a simple query listing configured device templates:</p>\n<pre><code>% sdwan list configuration template_device\nvManage password: \n+-----------------+--------------------------------------+-----------------+-----------------+\n| Name            | ID                                   | Tag             | Type            |\n+-----------------+--------------------------------------+-----------------+-----------------+\n| DC_ADVANCED     | bf322748-8dfd-4cb0-a9e4-5d758be239a0 | template_device | device template |\n| DC_BASIC        | 09c02518-9557-4ae2-9031-7e6b3e7323fc | template_device | device template |\n| VSMART_v1       | 15c1962f-740e-4b89-a269-69f2cbfba296 | template_device | device template |\n| BRANCH_ADVANCED | ad449106-7ed6-442f-9ba8-820612b85981 | template_device | device template |\n| BRANCH_BASIC    | cc2f7a24-4c93-49ed-8e6b-1c107797ba95 | template_device | device template |\n+-----------------+--------------------------------------+-----------------+-----------------+\n</code></pre>\n<p>Any those vManage parameters can also be provided via command line:</p>\n<pre><code>% sdwan -p admin list configuration template_device\n</code></pre>\n<p>Perform a backup:</p>\n<pre><code>% sdwan --verbose backup all\nINFO: Starting backup: vManage URL: \"https://10.85.136.253:8443\" &gt; Local workdir: \"backup_10.85.136.253_20191206\"\nINFO: Saved vManage server information\nINFO: Saved WAN edge certificates\nINFO: Saved device template index\nINFO: Done device template DC_ADVANCED\nINFO: Done device template DC_BASIC\nINFO: Done device template DC_BASIC attached devices\nINFO: Done device template DC_BASIC values\n&lt;snip&gt;\nINFO: Done SLA-class list Realtime_Full_Mesh\nINFO: Task completed successfully\n</code></pre>\n<p>Note that '--verbose' was specified so that progress information is displayed. Without this option, only warning-level messages and above are displayed.</p>\n<p>The backup is saved under data/backup_10.85.136.253_20191206:</p>\n<pre><code>% ls\ndata\t\tlogs\t\trc-example.sh\n% ls data\nbackup_10.85.136.253_20191206\n</code></pre>\n<h2>Additional Examples</h2>\n<h3>Customizing backup destination:</h3>\n<pre><code>% sdwan --verbose backup all --workdir \"my_custom_directory\"\nINFO: Starting backup: vManage URL: \"https://10.85.136.253:8443\" &gt; Local workdir: \"my_custom_directory\"\nINFO: Saved vManage server information\nINFO: Saved WAN edge certificates\nINFO: Saved device template index\nINFO: Done device template DC_ADVANCED\nINFO: Done device template DC_BASIC\n&lt;snip&gt;\nINFO: Done SLA-class list Realtime_Full_Mesh\nINFO: Task completed successfully\n</code></pre>\n<h3>Restoring from backup:</h3>\n<pre><code>% sdwan --verbose restore all        \nINFO: Starting restore: Local workdir: \"backup_10.85.136.253_20191206\" &gt; vManage URL: \"https://10.85.136.253:8443\"\nINFO: Loading existing items from target vManage\nINFO: Identifying items to be pushed\nINFO: Inspecting template_device items\nINFO: Inspecting template_feature items\nINFO: Inspecting policy_vsmart items\nINFO: Inspecting policy_vedge items\nINFO: Inspecting policy_security items\nINFO: Inspecting policy_definition items\nINFO: Inspecting policy_list items\nINFO: Pushing items to vManage\nINFO: Done: Create SLA-class list Best_Effort\nINFO: Done: Create SLA-class list Realtime_Full_Mesh\nINFO: Done: Create site list All_Sites\nINFO: Done: Create class list af2\n&lt;snip&gt;\nINFO: Done: Create device template BRANCH_ADVANCED\nINFO: Done: Create device template BRANCH_BASIC\nINFO: Task completed successfully\n</code></pre>\n<h4>Restoring from a backup in a different directory than the default:</h4>\n<pre><code>% sdwan --verbose restore all --workdir my_custom_directory\nINFO: Starting restore: Local workdir: \"my_custom_directory\" &gt; vManage URL: \"https://10.85.136.253:8443\"\nINFO: Loading existing items from target vManage\nINFO: Identifying items to be pushed\nINFO: Inspecting template_device items\nINFO: Inspecting template_feature items\n&lt;snip&gt;\nINFO: Task completed successfully\n</code></pre>\n<h4>Restoring with template attachments and policy activation:</h4>\n<pre><code>% sdwan --verbose restore all --attach\nINFO: Starting restore: Local workdir: \"backup_10.85.136.253_20191206\" &gt; vManage URL: \"https://10.85.136.253:8443\"\nINFO: Loading existing items from target vManage\n&lt;snip&gt;\nINFO: Attaching WAN Edge templates\nINFO: Waiting...\nINFO: Waiting...\nINFO: Waiting...\nINFO: Waiting...\nINFO: Completed DC_BASIC,BRANCH_BASIC\nINFO: Completed attaching WAN Edge templates\nINFO: Attaching vSmart template\nINFO: Waiting...\nINFO: Waiting...\nINFO: Completed VSMART_v1\nINFO: Completed attaching vSmart template\nINFO: Activating vSmart policy\nINFO: Waiting...\nINFO: Waiting...\nINFO: Completed Central_policy_v1\nINFO: Completed activating vSmart policy\nINFO: Task completed successfully\n</code></pre>\n<h4>Overwriting items with the --force option:</h4>\n<ul>\n<li>By default, when an item from backup has the same name as an existing item in vManage, it will be skipped by restore. Leaving the existing one intact.</li>\n<li>When an item, say a device template, is modified in vManage. Performing a restore from a backup taken before the modification will skip that item.</li>\n<li>With the --force option, items with the same name are updated with the info found in the backup.</li>\n<li>Sastre only updates the item when its contents differ from what is in vManage.</li>\n<li>If the item is associated with attached templates or activated policies, all necessary re-attach/re-activate actions are automatically performed.</li>\n<li>Currently, the --force option does not apply to changes in template values.</li>\n</ul>\n<p>Example:</p>\n<pre><code>% sdwan --verbose restore all --workdir state_b --force\nINFO: Starting restore: Local workdir: \"state_b\" &gt; vManage URL: \"https://10.85.136.253:8443\"\nINFO: Loading existing items from target vManage\nINFO: Identifying items to be pushed\nINFO: Inspecting template_device items\nINFO: Inspecting template_feature items\nINFO: Inspecting policy_vsmart items\nINFO: Inspecting policy_vedge items\nINFO: Inspecting policy_security items\nINFO: Inspecting policy_definition items\nINFO: Inspecting policy_list items\nINFO: Pushing items to vManage\nINFO: Done: Create community list LOCAL_DC_PREFIXES\nINFO: Done: Create community list REMAINING_PREFIXES\nINFO: Updating SLA-class list Best_Effort requires reattach of affected templates\nINFO: Reattaching templates\nINFO: Waiting...\nINFO: Waiting...\nINFO: Completed VSMART_v1\nINFO: Completed reattaching templates\nINFO: Done: Update SLA-class list Best_Effort\n&lt;snip&gt;\nINFO: Done: Update device template DC_BASIC\nINFO: Task completed successfully\n</code></pre>\n<h3>Deleting vManage items:</h3>\n<p>Dry-run, just list without deleting items matching the specified tag and regular expression:</p>\n<pre><code>% sdwan --verbose delete all --regex \"^DC\"  --dryrun\nINFO: Starting delete, DRY-RUN mode: vManage URL: \"https://10.85.136.253:8443\"\nINFO: Inspecting template_device items\nINFO: DRY-RUN: Delete device template DC_BASIC\nINFO: DRY-RUN: Delete device template DC_ADVANCED\nINFO: Inspecting template_feature items\nINFO: Inspecting policy_vsmart items\nINFO: Inspecting policy_vedge items\nINFO: Inspecting policy_security items\nINFO: Inspecting policy_definition items\nINFO: Inspecting policy_list items\nINFO: Task completed successfully\n</code></pre>\n<p>Deleting items:</p>\n<pre><code>% sdwan --verbose delete all --regex \"^DC\"\nINFO: Starting delete: vManage URL: \"https://10.85.136.253:8443\"\nINFO: Inspecting template_device items\nINFO: Done: Delete device template DC_BASIC\nINFO: Done: Delete device template DC_ADVANCED\nINFO: Inspecting template_feature items\nINFO: Inspecting policy_vsmart items\nINFO: Inspecting policy_vedge items\nINFO: Inspecting policy_security items\nINFO: Inspecting policy_definition items\nINFO: Inspecting policy_list items\nINFO: Task completed successfully\n</code></pre>\n<h4>Deleting with detach:</h4>\n<p>When vSmart policies are activated and device templates are attached the associated items cannot be deleted.\nThe --detach option performs the necessary template detach and vSmart policy deactivate before proceeding with the delete.</p>\n<pre><code>% sdwan --verbose delete all --detach\nINFO: Starting delete: vManage URL: \"https://10.85.136.253:8443\"\nINFO: Detaching WAN Edge templates\nINFO: Waiting...\nINFO: Completed BRANCH_BASIC\nINFO: Completed DC_BASIC\nINFO: Completed detaching WAN Edge templates\nINFO: Deactivating vSmart policy\nINFO: Waiting...\nINFO: Completed Central_policy_v1\nINFO: Completed deactivating vSmart policy\nINFO: Detaching vSmart template\nINFO: Waiting...\nINFO: Completed VSMART_v1\nINFO: Completed detaching vSmart template\nINFO: Inspecting template_device items\nINFO: Done: Delete device template vManage_template\n&lt;snip&gt;\nINFO: Task completed successfully\n</code></pre>\n<h3>Listing items from vManage or from a backup:</h3>\n<p>The list task can be used to list items from a target vManage, or a backup directory, matching a criteria of item tag(s) and regular expression.</p>\n<p>List device templates and feature templates from target vManage:</p>\n<pre><code>% sdwan --verbose list configuration template_device template_feature\nINFO: Starting list configuration: vManage URL: \"https://198.18.1.10:8443\"\nINFO: List criteria matched 45 items\n+---------------------------+--------------------------------------+------------------+------------------+\n| Name                      | ID                                   | Tag              | Type             |\n+---------------------------+--------------------------------------+------------------+------------------+\n| BRANCH_ADVANCED           | 6ece1f27-fbfa-4730-9a8f-b61bfd380047 | template_device  | device template  |\n| VSMART_v1                 | ba623cf6-5d2c-4676-a763-11b9cf866074 | template_device  | device template  |\n| BRANCH_BASIC              | 5e362c85-8251-428a-b650-d364f8e15a22 | template_device  | device template  |\n&lt;snip&gt;\n| vSmart_VPN0_Interface_v1  | be09349e-308e-4ca5-a306-fb7bcd5bcb28 | template_feature | feature template |\n+---------------------------+--------------------------------------+------------------+------------------+\nINFO: Task completed successfully\n</code></pre>\n<p>List all items from target vManage with name starting with 'DC':</p>\n<pre><code>% sdwan --verbose list configuration all --regex \"^DC\"\nINFO: Starting list configuration: vManage URL: \"https://198.18.1.10:8443\"\nINFO: List criteria matched 2 items\n+-------------+--------------------------------------+-----------------+-----------------+\n| Name        | ID                                   | Tag             | Type            |\n+-------------+--------------------------------------+-----------------+-----------------+\n| DC_BASIC    | 2ba8c66a-eadd-4a63-97c9-50d58a43b6b5 | template_device | device template |\n| DC_ADVANCED | b042ed29-3875-4118-b800-a0b00542b58e | template_device | device template |\n+-------------+--------------------------------------+-----------------+-----------------+\nINFO: Task completed successfully\n</code></pre>\n<p>List all items from backup directory with name starting with 'DC':</p>\n<pre><code>% sdwan --verbose list configuration all --regex \"^DC\" --workdir backup_10.85.136.253_20191206\nINFO: Starting list configuration: Local workdir: \"backup_10.85.136.253_20191206\"\nINFO: List criteria matched 2 items\n+-------------+--------------------------------------+-----------------+-----------------+\n| Name        | ID                                   | Tag             | Type            |\n+-------------+--------------------------------------+-----------------+-----------------+\n| DC_ADVANCED | bf322748-8dfd-4cb0-a9e4-5d758be239a0 | template_device | device template |\n| DC_BASIC    | 09c02518-9557-4ae2-9031-7e6b3e7323fc | template_device | device template |\n+-------------+--------------------------------------+-----------------+-----------------+\nINFO: Task completed successfully\n</code></pre>\n<p>List also allows displaying device certificate information.</p>\n<pre><code>% sdwan --verbose list certificate                     \nINFO: Starting list certificates: vManage URL: \"https://198.18.1.10:8443\"\nINFO: List criteria matched 5 items\n+------------+------------------------------------------+----------------------------------+----------------------------+--------+\n| Hostname   | Chassis                                  | Serial                           | State                      | Status |\n+------------+------------------------------------------+----------------------------------+----------------------------+--------+\n| DC1-VEDGE1 | ebdc8bd9-17e5-4eb3-a5e0-f438403a83de     | ee08f743                         | certificate installed      | valid  |\n| -          | 52c7911f-c5b0-45df-b826-3155809a2a1a     | 24801375888299141d620fbdb02de2d4 | bootstrap config generated | valid  |\n| DC1-VEDGE2 | f21dbb35-30b3-47f4-93bb-d2b2fe092d35     | b02445f6                         | certificate installed      | valid  |\n| BR1-CEDGE2 | CSR-04ed104b-86bb-4cb3-bd2b-a0d0991f6872 | AAC6C8F0                         | certificate installed      | valid  |\n| BR1-CEDGE1 | CSR-940ad679-a16a-48ea-9920-16278597d98e | 487D703A                         | certificate installed      | valid  |\n+------------+------------------------------------------+----------------------------------+----------------------------+--------+\nINFO: Task completed successfully\n</code></pre>\n<p>Similar to the list task, show tasks can be used to show items from a target vManage, or a backup. With show tasks, additional details about the selected items are displayed. The item id, name or a regular expression can be used to identify which item(s) to display.</p>\n<pre><code>% sdwan show-template values --name DC_BASIC\nDevice template DC_BASIC, values for vedge-dc1:\n+-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n| Name                              | Value                                | Variable                                                           |\n+-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n| Status                            | complete                             | csv-status                                                         |\n| Chassis Number                    | b693be59-c03f-62d0-f9a4-2675374536b8 | csv-deviceId                                                       |\n| System IP                         | 10.255.101.1                         | csv-deviceIP                                                       |\n| Hostname                          | vedge-dc1                            | csv-host-name                                                      |\n| Hostname(system_host_name)        | vedge-dc1                            | //system/host-name                                                 |\n| System IP(system_system_ip)       | 10.255.101.1                         | //system/system-ip                                                 |\n| Site ID(system_site_id)           | 101                                  | //system/site-id                                                   |\n| IPv4 Address(vpn_if_ipv4_address) | 10.101.1.4/24                        | /10/ge0/2/interface/ip/address                                     |\n| IPv4 Address(vpn_if_ipv4_address) | 5.254.4.110/24                       | /20/ge0/3/interface/ip/address                                     |\n| AS Number(bgp_as_num)             | 65001                                | /20//router/bgp/as-num                                             |\n| Address(bgp_neighbor_address)     | 5.254.4.1                            | /20//router/bgp/neighbor/bgp_neighbor_address/address              |\n| Remote AS(bgp_neighbor_remote_as) | 65111                                | /20//router/bgp/neighbor/bgp_neighbor_address/remote-as            |\n| Preference(transport1_preference) | 100                                  | /0/ge0/0/interface/tunnel-interface/encapsulation/ipsec/preference |\n+-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n\nDevice template DC_BASIC, values for vedge-dc2:\n+-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n| Name                              | Value                                | Variable                                                           |\n+-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n| Status                            | complete                             | csv-status                                                         |\n| Chassis Number                    | 0dd49ace-f6de-ce86-5d73-ca74d6db1747 | csv-deviceId                                                       |\n| System IP                         | 10.255.102.1                         | csv-deviceIP                                                       |\n| Hostname                          | vedge-dc2                            | csv-host-name                                                      |\n| Hostname(system_host_name)        | vedge-dc2                            | //system/host-name                                                 |\n| System IP(system_system_ip)       | 10.255.102.1                         | //system/system-ip                                                 |\n| Site ID(system_site_id)           | 102                                  | //system/site-id                                                   |\n| IPv4 Address(vpn_if_ipv4_address) | 10.102.1.3/24                        | /10/ge0/2/interface/ip/address                                     |\n| IPv4 Address(vpn_if_ipv4_address) | 5.254.5.105/24                       | /20/ge0/3/interface/ip/address                                     |\n| AS Number(bgp_as_num)             | 65002                                | /20//router/bgp/as-num                                             |\n| Address(bgp_neighbor_address)     | 5.254.5.1                            | /20//router/bgp/neighbor/bgp_neighbor_address/address              |\n| Remote AS(bgp_neighbor_remote_as) | 65222                                | /20//router/bgp/neighbor/bgp_neighbor_address/remote-as            |\n| Preference(transport1_preference) | 0                                    | /0/ge0/0/interface/tunnel-interface/encapsulation/ipsec/preference |\n+-----------------------------------+--------------------------------------+--------------------------------------------------------------------+\n</code></pre>\n<h3>Modifying device certificate validity status:</h3>\n<p>Restore certificate validity status from a backup:</p>\n<pre><code>% sdwan --verbose certificate restore --workdir test\nINFO: Starting certificate: Restore status workdir: \"test\" &gt; vManage URL: \"https://198.18.1.10:8443\"\nINFO: Loading WAN edge certificate list from target vManage\nINFO: Identifying items to be pushed\nINFO: Will update DC1-VEDGE1 status: valid -&gt; staging\nINFO: Will update 52c7911f-c5b0-45df-b826-3155809a2a1a status: valid -&gt; invalid\nINFO: Will update DC1-VEDGE2 status: valid -&gt; staging\nINFO: Will update BR1-CEDGE2 status: valid -&gt; staging\nINFO: Will update BR1-CEDGE1 status: valid -&gt; staging\nINFO: Pushing certificate status changes to vManage\nINFO: Certificate sync with controllers\nINFO: Waiting...\nINFO: Completed certificate sync with controllers\nINFO: Task completed successfully\n</code></pre>\n<p>Set certificate validity status to a desired value:</p>\n<pre><code> % sdwan --verbose certificate set valid             \nINFO: Starting certificate: Set status to \"valid\" &gt; vManage URL: \"https://198.18.1.10:8443\"\nINFO: Loading WAN edge certificate list from target vManage\nINFO: Identifying items to be pushed\nINFO: Will update DC1-VEDGE1 status: staging -&gt; valid\nINFO: Will update 52c7911f-c5b0-45df-b826-3155809a2a1a status: invalid -&gt; valid\nINFO: Will update DC1-VEDGE2 status: staging -&gt; valid\nINFO: Will update BR1-CEDGE2 status: staging -&gt; valid\nINFO: Will update BR1-CEDGE1 status: staging -&gt; valid\nINFO: Pushing certificate status changes to vManage\nINFO: Certificate sync with controllers\nINFO: Waiting...\nINFO: Completed certificate sync with controllers\nINFO: Task completed successfully\n</code></pre>\n<h2>Notes</h2>\n<h3>Regular Expressions</h3>\n<p>It is recommended to always use double quotes when specifying a regular expression to --regex option:</p>\n<pre><code>sdwan --verbose restore all --regex \"VPN1\"\n</code></pre>\n<p>This is to prevent the shell from interpreting special characters that could be part of the pattern provided.</p>\n<p>Matching done by --regex is un-anchored. That is, unless anchor marks are provided (e.g. ^ or $), the specified pattern matches if present anywhere in the string. In other words, this is a search function.</p>\n<p>The regular expression syntax supported is described in <a href=\"https://docs.python.org/3/library/re.html\" rel=\"nofollow\">https://docs.python.org/3/library/re.html</a></p>\n<h3>Logs</h3>\n<p>Sastre logs messages to the terminal and to log files (under the logs directory).</p>\n<p>Debug-level and higher severity messages are always saved to the log files.</p>\n<p>The --verbose flag controls the severity of messages printed to the terminal. If --verbose is not specified, only warning-level and higher messages are logged. When --verbose is specified, informational-level and higher messages are printed.</p>\n<h3>Restore behavior</h3>\n<p>By default, restore will skip items with the same name. If an existing item in vManage has the same name as an item in the backup this item is skipped from restore.</p>\n<p>Any references/dependencies on that item are properly updated. For instance, if a feature template is not pushed to vManage because an item with the same name is already present, device templates being pushed will now point to the feature template which was already in vManage.</p>\n<p>Adding the --force option to restore modifies this behavior. In this case Sastre will update existing items containing the same name as in the backup, but only if their content is different.</p>\n<p>When an existing vManage item is modified, device templates may need to be reattached or vSmart policies may need to be re-activated. This is handled by Sastre as follows:</p>\n<ul>\n<li>Updating items associated with an active vSmart policy may require this policy to be re-activated. In this case, Sastre will request the policy reactivate automatically.</li>\n<li>On updates to a master template (e.g. device template) containing attached devices, Sastre will re-attach this device template using attachment values (variables) from the backup to feed the attach request.</li>\n<li>On Updates to a child template (e.g. feature template) associated with a master template containing attached devices, Sastre will re-attach the affected master template(s). In this case, Sastre will use the existing values in vManage to feed the attach request.</li>\n</ul>\n<p>The implication is that if modified child templates (e.g. feature template) define new variables, re-attaching the master template will fail because not all variables will have values assigned. In this case, the recommended procedure is to detach the master template (i.e. change device to CLI mode in vManage), re-run \u201crestore --force\", then re-attach the device-template from vManage, where one would have a chance to supply any missing variable values.</p>\n<h2>Installing</h2>\n<p>Sastre requires Python 3.6 or newer. This can be verified by pasting the following to a terminal window:</p>\n<pre><code>% python3 -c \"import sys;assert sys.version_info&gt;(3,6)\" &amp;&amp; echo \"ALL GOOD\"\n</code></pre>\n<p>If 'ALL GOOD' is printed it means Python requirements are met. If not, download and install the latest 3.x version at Python.org (<a href=\"https://www.python.org/downloads/\" rel=\"nofollow\">https://www.python.org/downloads/</a>).</p>\n<p>The recommended way to install Sastre is via pip. For development purposes, Sastre can be installed from the github repository. Both methods are described in this section.</p>\n<h3>PIP install (recommended)</h3>\n<p>To install Sastre:</p>\n<pre><code>% python3 -m pip install --upgrade cisco-sdwan\n</code></pre>\n<p>Verify that Sastre can run:</p>\n<pre><code>% sdwan --version\n</code></pre>\n<h3>Github install</h3>\n<p>Install required Python packages:</p>\n<pre><code>% python3 -m pip install --upgrade requests\n</code></pre>\n<p>Clone from the github repository:</p>\n<pre><code>% git clone https://github.com/reismarcelo/sastre\n</code></pre>\n<p>Move to the clone directory:</p>\n<pre><code>% cd sastre\n</code></pre>\n<p>Verify that Sastre can run:</p>\n<pre><code>% python3 sdwan.py --version\n</code></pre>\n\n          </div>"}, "last_serial": 7073132, "releases": {"0.33": [{"comment_text": "", "digests": {"md5": "6f594e942a70d17be817075a328fd75b", "sha256": "b667f606dc8f5ec2377472987c44977ae5e57228cc8d6d4320c440296c3cfb9e"}, "downloads": -1, "filename": "cisco_sdwan-0.33-py3-none-any.whl", "has_sig": false, "md5_digest": "6f594e942a70d17be817075a328fd75b", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 35238, "upload_time": "2019-12-07T21:29:55", "upload_time_iso_8601": "2019-12-07T21:29:55.616006Z", "url": "https://files.pythonhosted.org/packages/86/56/bbcce41d9a14b645c8474f701e300f96e234e4bd9a53d5b10f4637c8d5a8/cisco_sdwan-0.33-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "06eba889649d7427c9c44e57ecb3e559", "sha256": "3244be14421c04be1cfedd06e5295f03932be088c77f3f4814defe0370deb973"}, "downloads": -1, "filename": "cisco-sdwan-0.33.tar.gz", "has_sig": false, "md5_digest": "06eba889649d7427c9c44e57ecb3e559", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 38155, "upload_time": "2019-12-07T21:29:58", "upload_time_iso_8601": "2019-12-07T21:29:58.099679Z", "url": "https://files.pythonhosted.org/packages/3a/27/01d4b17aa40190458fa87e49d110705056a170a2fc0ba27a296d759d966e/cisco-sdwan-0.33.tar.gz", "yanked": false}], "0.34": [{"comment_text": "", "digests": {"md5": "3b1f53f10cb3ba1b3254d808cceea23d", "sha256": "85f19e065e9c1698d47615eadcb8ed1a2ca6beca8997f37a0e20192f7f2c46aa"}, "downloads": -1, "filename": "cisco_sdwan-0.34-py3-none-any.whl", "has_sig": false, "md5_digest": "3b1f53f10cb3ba1b3254d808cceea23d", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 36648, "upload_time": "2020-01-09T14:58:44", "upload_time_iso_8601": "2020-01-09T14:58:44.989080Z", "url": "https://files.pythonhosted.org/packages/d5/fc/f1eb90edf6ce11869fee579b7bd8307e87f0721e7cca6b842d8203396f95/cisco_sdwan-0.34-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "9586ad4989a5fc8e2692726b5c7e280b", "sha256": "a6ee9032ce7b653d09fd4ada6dde4c991fc4a3da6fa165e43d36ea3e95d23cf8"}, "downloads": -1, "filename": "cisco-sdwan-0.34.tar.gz", "has_sig": false, "md5_digest": "9586ad4989a5fc8e2692726b5c7e280b", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 39687, "upload_time": "2020-01-09T14:58:46", "upload_time_iso_8601": "2020-01-09T14:58:46.714692Z", "url": "https://files.pythonhosted.org/packages/c5/04/6882cbeb2e20cc49a8730e40fb5b3520eda0fe83bf1b6794aa411cbf977e/cisco-sdwan-0.34.tar.gz", "yanked": false}], "0.35": [{"comment_text": "", "digests": {"md5": "569b8b562559e4ce0f938090b577fa19", "sha256": "4a3319fe76d53d93e0eaebe31e78c74916121e54efbb21d8f98cba4a5b39c4ee"}, "downloads": -1, "filename": "cisco_sdwan-0.35-py3-none-any.whl", "has_sig": false, "md5_digest": "569b8b562559e4ce0f938090b577fa19", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 39857, "upload_time": "2020-03-04T14:22:25", "upload_time_iso_8601": "2020-03-04T14:22:25.026045Z", "url": "https://files.pythonhosted.org/packages/ef/eb/9355534047a07f94113b90e3fe196081553651ed6c46f75e955b431adf3e/cisco_sdwan-0.35-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "b045e81c7e1567d154b283599951f580", "sha256": "764a4d2f7c92113ab63597fa1baa82a4bf4aa08189bdcbc11cc12e06fc9c0382"}, "downloads": -1, "filename": "cisco-sdwan-0.35.tar.gz", "has_sig": false, "md5_digest": "b045e81c7e1567d154b283599951f580", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 48089, "upload_time": "2020-03-04T14:22:26", "upload_time_iso_8601": "2020-03-04T14:22:26.092899Z", "url": "https://files.pythonhosted.org/packages/5c/f8/f5ff46c4645825d7ef69d79474fd84fd39f7236e3dfddc2fc2ae076d8f1a/cisco-sdwan-0.35.tar.gz", "yanked": false}], "0.36": [{"comment_text": "", "digests": {"md5": "bbc1f5dbadc01107563da5cc5b9eefcf", "sha256": "ec4264f7f963e8eab50d74e0de231094615716453f08eaec86b70b277bee96a6"}, "downloads": -1, "filename": "cisco_sdwan-0.36-py3-none-any.whl", "has_sig": false, "md5_digest": "bbc1f5dbadc01107563da5cc5b9eefcf", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 41236, "upload_time": "2020-04-10T03:31:13", "upload_time_iso_8601": "2020-04-10T03:31:13.006935Z", "url": "https://files.pythonhosted.org/packages/72/45/c7c7a7b8e4890c1acdf2e50f7bf8ff8c7417fc167fa0cfc290f7db767a8c/cisco_sdwan-0.36-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "2ca5f513bb9c3b0bddd43c5ea1e84f0b", "sha256": "12be9e369399e974f0ec0f88a579e024f7f4f291b4f9cd5620ac572945e849df"}, "downloads": -1, "filename": "cisco-sdwan-0.36.tar.gz", "has_sig": false, "md5_digest": "2ca5f513bb9c3b0bddd43c5ea1e84f0b", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 49837, "upload_time": "2020-04-10T03:31:15", "upload_time_iso_8601": "2020-04-10T03:31:15.176136Z", "url": "https://files.pythonhosted.org/packages/e3/c5/5660491c3f509da3b11f0e8ae3673febe31fdc00a96862136a0f9966ead4/cisco-sdwan-0.36.tar.gz", "yanked": false}], "0.37": [{"comment_text": "", "digests": {"md5": "868be639c8ec28c2db1ba37c95d512af", "sha256": "833da850670bca397e8c47241e260a018f437ad0a1bb75d8996127a5faa04793"}, "downloads": -1, "filename": "cisco_sdwan-0.37-py3-none-any.whl", "has_sig": false, "md5_digest": "868be639c8ec28c2db1ba37c95d512af", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 41236, "upload_time": "2020-04-22T03:11:17", "upload_time_iso_8601": "2020-04-22T03:11:17.493952Z", "url": "https://files.pythonhosted.org/packages/60/bf/21c6bafb92838664ab003aecef9a7b0fc4f25856aba12e436925f4079b1f/cisco_sdwan-0.37-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "f6c3298860f1eaf134e4caf1a0e44922", "sha256": "a39b74ebbd843889b70d58c07ab03460760e4594281500bb57392a01acaabeea"}, "downloads": -1, "filename": "cisco-sdwan-0.37.tar.gz", "has_sig": false, "md5_digest": "f6c3298860f1eaf134e4caf1a0e44922", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 49850, "upload_time": "2020-04-22T03:11:19", "upload_time_iso_8601": "2020-04-22T03:11:19.956452Z", "url": "https://files.pythonhosted.org/packages/00/64/99689465c0db0df32fe9d855c3fd9d9a0a93a9e4f7e0300e7daa7d347b7e/cisco-sdwan-0.37.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "868be639c8ec28c2db1ba37c95d512af", "sha256": "833da850670bca397e8c47241e260a018f437ad0a1bb75d8996127a5faa04793"}, "downloads": -1, "filename": "cisco_sdwan-0.37-py3-none-any.whl", "has_sig": false, "md5_digest": "868be639c8ec28c2db1ba37c95d512af", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 41236, "upload_time": "2020-04-22T03:11:17", "upload_time_iso_8601": "2020-04-22T03:11:17.493952Z", "url": "https://files.pythonhosted.org/packages/60/bf/21c6bafb92838664ab003aecef9a7b0fc4f25856aba12e436925f4079b1f/cisco_sdwan-0.37-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "f6c3298860f1eaf134e4caf1a0e44922", "sha256": "a39b74ebbd843889b70d58c07ab03460760e4594281500bb57392a01acaabeea"}, "downloads": -1, "filename": "cisco-sdwan-0.37.tar.gz", "has_sig": false, "md5_digest": "f6c3298860f1eaf134e4caf1a0e44922", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 49850, "upload_time": "2020-04-22T03:11:19", "upload_time_iso_8601": "2020-04-22T03:11:19.956452Z", "url": "https://files.pythonhosted.org/packages/00/64/99689465c0db0df32fe9d855c3fd9d9a0a93a9e4f7e0300e7daa7d347b7e/cisco-sdwan-0.37.tar.gz", "yanked": false}], "timestamp": "Thu May  7 22:19:18 2020"}