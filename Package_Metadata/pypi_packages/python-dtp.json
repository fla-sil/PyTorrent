{"info": {"author": "yueshuaijie", "author_email": "ysj@love.com", "bugtrack_url": null, "classifiers": [], "description": "Python\u5206\u5e03\u5f0f\u4e8b\u52a1\u5b9e\u73b0:\n1. [***TX specification***](http://archive.opengroup.org/publications/archive/CDROM/c504.pdf)\n2. [***XA specification***](http://pubs.opengroup.org/onlinepubs/009680699/toc.pdf)\n\n\u8fd0\u884c\u73af\u5883\uff1apython2.7\uff0c\u6240\u652f\u6301\u7684db\u4e3a\uff1a\n1. mysql(>=5.7) + MySQLdb(>=1.2.3)\n2. mysql(>=5.7) + mysql-connector(>=2.1.0)\n3. postgresql(>=8.4) + psycopg2\n\n\n\u5b89\u88c5:\n\u83b7\u53d6\u6e90\u7801\uff0c\u5e76\u8fdb\u5165\u6e90\u7801\u76ee\u5f55\n```\n# python setup.py install\n```\n\n\u7528\u6cd5\uff1a\uff08\u6682\u4e0d\u652f\u6301\u7528unix_socket\u8fde\u63a5mysql\uff09\n```python\nimport MySQLdb\nfrom python_dtp import local_db, MySQLResourceManager, PostgreSQLResourceManager, TransactionManager\n\ndef test():\n    conn1, conn2 = MySQLdb.connect(**db1_conf), MySQLdb.connect(**db2_conf)\n    # conn1, conn2\u4e5f\u53ef\u4ee5\u662fmysql.connector.connection\u5bf9\u8c61\uff0c\u6216psycopg2.connection\u5bf9\u8c61\n\n    rm1, rm2 = MySQLResourceManager(conn1), MySQLResourceManager(conn2)\n    cursor1, cursor2 = conn1.cursor(), conn2.cursor()\n\n    local_db.path = '/path/to/dtp.sqlite3' # \u5f88\u91cd\u8981\uff0c\u8bb0\u5f55\u6267\u884c\u5931\u8d25\u7684\u4e8b\u52a1\u4fe1\u606f\uff0ccrash\u6062\u590d\n\n    tm = TransactionManager(rm1, rm2)\n    tm.tx_begin()\n    cursor1.execute('insert into test1 values(1, \"bbb\")', ())\n    cursor2.execute('insert into test2 values(NULL, \"aaa\")', ())\n    tm.tx_commit()\n```\n\n\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\uff0c\u8dd1\u5982\u4e0b\u811a\u672c\uff0c\u7528\u6765crash\u6062\u590d\uff1a\n```python\nfrom python_dtp import monitor, local_db\n\nlocal_db.path = '/path/to/dtp.sqlite3' # \u548c\u4e0a\u9762\u7684local_db.path\u4e00\u81f4\n\n# \u5b9a\u4e49db\u7684\u8fde\u63a5\u53c2\u6570\ndb1_conf = {'host':'xxx', 'port':3306, 'user':'xxx', 'passwd':'xxx', 'db':'xxx'} # for mysql, \u5fc5\u987b\u662fMySQLdb\u80fd\u8bc6\u522b\u7684\u53c2\u6570\ndb2_conf = {'host':'xxx', 'port':3306, 'user':'xxx', 'password':'xxx', 'dbname':'xxx'} # for postgresql\n\n# \u544a\u8bc9monitor\uff0c\u5982\u4f55\u53bb\u8fde\u63a5db\uff0c\u5176\u4e2dkey\u7684\u503c\u4e3a\u5f62\u5982(host, port)\u7684tuple\nmonitor.db_config = {\n    ('127.0.0.1', 60000) : db1_conf,\n    ('localhost', 3307) : db2_conf,\n    ('123.38.76.10', 3306) : db3_conf,\n    ('test_db.nease.net', 3306) : db4_conf,\n}\n\n\nmonitor.run() # \u542f\u52a8monitor\uff0c\u4e00\u76f4\u8fd0\u884c\n```\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/yueshuaijie/python_dtp", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "python-dtp", "package_url": "https://pypi.org/project/python-dtp/", "platform": "", "project_url": "https://pypi.org/project/python-dtp/", "project_urls": {"Homepage": "https://github.com/yueshuaijie/python_dtp"}, "release_url": "https://pypi.org/project/python-dtp/0.9.3/", "requires_dist": null, "requires_python": "", "summary": "Python implementation of distributed transaction processing with MySQL, MySQLdb", "version": "0.9.3", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p>Python\u5206\u5e03\u5f0f\u4e8b\u52a1\u5b9e\u73b0:</p>\n<ol>\n<li><a href=\"http://archive.opengroup.org/publications/archive/CDROM/c504.pdf\" rel=\"nofollow\"><em><strong>TX specification</strong></em></a></li>\n<li><a href=\"http://pubs.opengroup.org/onlinepubs/009680699/toc.pdf\" rel=\"nofollow\"><em><strong>XA specification</strong></em></a></li>\n</ol>\n<p>\u8fd0\u884c\u73af\u5883\uff1apython2.7\uff0c\u6240\u652f\u6301\u7684db\u4e3a\uff1a</p>\n<ol>\n<li>mysql(&gt;=5.7) + MySQLdb(&gt;=1.2.3)</li>\n<li>mysql(&gt;=5.7) + mysql-connector(&gt;=2.1.0)</li>\n<li>postgresql(&gt;=8.4) + psycopg2</li>\n</ol>\n<p>\u5b89\u88c5:\n\u83b7\u53d6\u6e90\u7801\uff0c\u5e76\u8fdb\u5165\u6e90\u7801\u76ee\u5f55</p>\n<pre><code># python setup.py install\n</code></pre>\n<p>\u7528\u6cd5\uff1a\uff08\u6682\u4e0d\u652f\u6301\u7528unix_socket\u8fde\u63a5mysql\uff09</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">MySQLdb</span>\n<span class=\"kn\">from</span> <span class=\"nn\">python_dtp</span> <span class=\"kn\">import</span> <span class=\"n\">local_db</span><span class=\"p\">,</span> <span class=\"n\">MySQLResourceManager</span><span class=\"p\">,</span> <span class=\"n\">PostgreSQLResourceManager</span><span class=\"p\">,</span> <span class=\"n\">TransactionManager</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">test</span><span class=\"p\">():</span>\n    <span class=\"n\">conn1</span><span class=\"p\">,</span> <span class=\"n\">conn2</span> <span class=\"o\">=</span> <span class=\"n\">MySQLdb</span><span class=\"o\">.</span><span class=\"n\">connect</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">db1_conf</span><span class=\"p\">),</span> <span class=\"n\">MySQLdb</span><span class=\"o\">.</span><span class=\"n\">connect</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">db2_conf</span><span class=\"p\">)</span>\n    <span class=\"c1\"># conn1, conn2\u4e5f\u53ef\u4ee5\u662fmysql.connector.connection\u5bf9\u8c61\uff0c\u6216psycopg2.connection\u5bf9\u8c61</span>\n\n    <span class=\"n\">rm1</span><span class=\"p\">,</span> <span class=\"n\">rm2</span> <span class=\"o\">=</span> <span class=\"n\">MySQLResourceManager</span><span class=\"p\">(</span><span class=\"n\">conn1</span><span class=\"p\">),</span> <span class=\"n\">MySQLResourceManager</span><span class=\"p\">(</span><span class=\"n\">conn2</span><span class=\"p\">)</span>\n    <span class=\"n\">cursor1</span><span class=\"p\">,</span> <span class=\"n\">cursor2</span> <span class=\"o\">=</span> <span class=\"n\">conn1</span><span class=\"o\">.</span><span class=\"n\">cursor</span><span class=\"p\">(),</span> <span class=\"n\">conn2</span><span class=\"o\">.</span><span class=\"n\">cursor</span><span class=\"p\">()</span>\n\n    <span class=\"n\">local_db</span><span class=\"o\">.</span><span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s1\">'/path/to/dtp.sqlite3'</span> <span class=\"c1\"># \u5f88\u91cd\u8981\uff0c\u8bb0\u5f55\u6267\u884c\u5931\u8d25\u7684\u4e8b\u52a1\u4fe1\u606f\uff0ccrash\u6062\u590d</span>\n\n    <span class=\"n\">tm</span> <span class=\"o\">=</span> <span class=\"n\">TransactionManager</span><span class=\"p\">(</span><span class=\"n\">rm1</span><span class=\"p\">,</span> <span class=\"n\">rm2</span><span class=\"p\">)</span>\n    <span class=\"n\">tm</span><span class=\"o\">.</span><span class=\"n\">tx_begin</span><span class=\"p\">()</span>\n    <span class=\"n\">cursor1</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"s1\">'insert into test1 values(1, \"bbb\")'</span><span class=\"p\">,</span> <span class=\"p\">())</span>\n    <span class=\"n\">cursor2</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"s1\">'insert into test2 values(NULL, \"aaa\")'</span><span class=\"p\">,</span> <span class=\"p\">())</span>\n    <span class=\"n\">tm</span><span class=\"o\">.</span><span class=\"n\">tx_commit</span><span class=\"p\">()</span>\n</pre>\n<p>\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\uff0c\u8dd1\u5982\u4e0b\u811a\u672c\uff0c\u7528\u6765crash\u6062\u590d\uff1a</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">python_dtp</span> <span class=\"kn\">import</span> <span class=\"n\">monitor</span><span class=\"p\">,</span> <span class=\"n\">local_db</span>\n\n<span class=\"n\">local_db</span><span class=\"o\">.</span><span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s1\">'/path/to/dtp.sqlite3'</span> <span class=\"c1\"># \u548c\u4e0a\u9762\u7684local_db.path\u4e00\u81f4</span>\n\n<span class=\"c1\"># \u5b9a\u4e49db\u7684\u8fde\u63a5\u53c2\u6570</span>\n<span class=\"n\">db1_conf</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">'host'</span><span class=\"p\">:</span><span class=\"s1\">'xxx'</span><span class=\"p\">,</span> <span class=\"s1\">'port'</span><span class=\"p\">:</span><span class=\"mi\">3306</span><span class=\"p\">,</span> <span class=\"s1\">'user'</span><span class=\"p\">:</span><span class=\"s1\">'xxx'</span><span class=\"p\">,</span> <span class=\"s1\">'passwd'</span><span class=\"p\">:</span><span class=\"s1\">'xxx'</span><span class=\"p\">,</span> <span class=\"s1\">'db'</span><span class=\"p\">:</span><span class=\"s1\">'xxx'</span><span class=\"p\">}</span> <span class=\"c1\"># for mysql, \u5fc5\u987b\u662fMySQLdb\u80fd\u8bc6\u522b\u7684\u53c2\u6570</span>\n<span class=\"n\">db2_conf</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">'host'</span><span class=\"p\">:</span><span class=\"s1\">'xxx'</span><span class=\"p\">,</span> <span class=\"s1\">'port'</span><span class=\"p\">:</span><span class=\"mi\">3306</span><span class=\"p\">,</span> <span class=\"s1\">'user'</span><span class=\"p\">:</span><span class=\"s1\">'xxx'</span><span class=\"p\">,</span> <span class=\"s1\">'password'</span><span class=\"p\">:</span><span class=\"s1\">'xxx'</span><span class=\"p\">,</span> <span class=\"s1\">'dbname'</span><span class=\"p\">:</span><span class=\"s1\">'xxx'</span><span class=\"p\">}</span> <span class=\"c1\"># for postgresql</span>\n\n<span class=\"c1\"># \u544a\u8bc9monitor\uff0c\u5982\u4f55\u53bb\u8fde\u63a5db\uff0c\u5176\u4e2dkey\u7684\u503c\u4e3a\u5f62\u5982(host, port)\u7684tuple</span>\n<span class=\"n\">monitor</span><span class=\"o\">.</span><span class=\"n\">db_config</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"p\">(</span><span class=\"s1\">'127.0.0.1'</span><span class=\"p\">,</span> <span class=\"mi\">60000</span><span class=\"p\">)</span> <span class=\"p\">:</span> <span class=\"n\">db1_conf</span><span class=\"p\">,</span>\n    <span class=\"p\">(</span><span class=\"s1\">'localhost'</span><span class=\"p\">,</span> <span class=\"mi\">3307</span><span class=\"p\">)</span> <span class=\"p\">:</span> <span class=\"n\">db2_conf</span><span class=\"p\">,</span>\n    <span class=\"p\">(</span><span class=\"s1\">'123.38.76.10'</span><span class=\"p\">,</span> <span class=\"mi\">3306</span><span class=\"p\">)</span> <span class=\"p\">:</span> <span class=\"n\">db3_conf</span><span class=\"p\">,</span>\n    <span class=\"p\">(</span><span class=\"s1\">'test_db.nease.net'</span><span class=\"p\">,</span> <span class=\"mi\">3306</span><span class=\"p\">)</span> <span class=\"p\">:</span> <span class=\"n\">db4_conf</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"n\">monitor</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">()</span> <span class=\"c1\"># \u542f\u52a8monitor\uff0c\u4e00\u76f4\u8fd0\u884c</span>\n</pre>\n\n          </div>"}, "last_serial": 6870916, "releases": {"0.9.3": [{"comment_text": "", "digests": {"md5": "b76db352fecf2f398a3b5c86a4f20640", "sha256": "46f0fe5a40f630b27ac2dba23fb45db96dec27995d9fae078939839b8138afcd"}, "downloads": -1, "filename": "python_dtp-0.9.3-py2-none-any.whl", "has_sig": false, "md5_digest": "b76db352fecf2f398a3b5c86a4f20640", "packagetype": "bdist_wheel", "python_version": "py2", "requires_python": null, "size": 11020, "upload_time": "2020-03-24T06:18:48", "upload_time_iso_8601": "2020-03-24T06:18:48.783203Z", "url": "https://files.pythonhosted.org/packages/87/2c/4e5db60d6be2dc2539a2e787c82baf20fceda47bf943e47e2c9b5e2baf72/python_dtp-0.9.3-py2-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "495647a6960377ec1fd219fc74971038", "sha256": "917ecbc4fb32918029bd31eca5fc1600d2fe0794ebb431d18147df74e3eec330"}, "downloads": -1, "filename": "python_dtp-0.9.3.tar.gz", "has_sig": false, "md5_digest": "495647a6960377ec1fd219fc74971038", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 8415, "upload_time": "2020-03-24T06:18:50", "upload_time_iso_8601": "2020-03-24T06:18:50.258584Z", "url": "https://files.pythonhosted.org/packages/ac/a0/8961cf6e2714dcd8ef0a3bc041474e028440c200055d8b4757ac84bf052e/python_dtp-0.9.3.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "b76db352fecf2f398a3b5c86a4f20640", "sha256": "46f0fe5a40f630b27ac2dba23fb45db96dec27995d9fae078939839b8138afcd"}, "downloads": -1, "filename": "python_dtp-0.9.3-py2-none-any.whl", "has_sig": false, "md5_digest": "b76db352fecf2f398a3b5c86a4f20640", "packagetype": "bdist_wheel", "python_version": "py2", "requires_python": null, "size": 11020, "upload_time": "2020-03-24T06:18:48", "upload_time_iso_8601": "2020-03-24T06:18:48.783203Z", "url": "https://files.pythonhosted.org/packages/87/2c/4e5db60d6be2dc2539a2e787c82baf20fceda47bf943e47e2c9b5e2baf72/python_dtp-0.9.3-py2-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "495647a6960377ec1fd219fc74971038", "sha256": "917ecbc4fb32918029bd31eca5fc1600d2fe0794ebb431d18147df74e3eec330"}, "downloads": -1, "filename": "python_dtp-0.9.3.tar.gz", "has_sig": false, "md5_digest": "495647a6960377ec1fd219fc74971038", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 8415, "upload_time": "2020-03-24T06:18:50", "upload_time_iso_8601": "2020-03-24T06:18:50.258584Z", "url": "https://files.pythonhosted.org/packages/ac/a0/8961cf6e2714dcd8ef0a3bc041474e028440c200055d8b4757ac84bf052e/python_dtp-0.9.3.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:17:55 2020"}