{"info": {"author": "", "author_email": "", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Intended Audience :: Developers", "License :: OSI Approved :: MIT License", "Operating System :: MacOS :: MacOS X", "Operating System :: Microsoft :: Windows", "Operating System :: POSIX", "Programming Language :: Python :: 2", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.5", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7"], "description": "winnan\n======\n\n    **winnan**\n\n    1. (verb) to struggle, suffer, contend\n\n    https://en.wiktionary.org/wiki/winnan\n\n*Because everything about managing files on Windows is terrible.*\n\n\nInstallation\n------------\n\n.. code-block:: console\n\n    $ python -m pip install --upgrade winnan\n\n\nUsage\n-----\n\nUse the ``winnan.open()`` function exactly like using |Python's built-in open() function|_. It aims\nto be a drop-in replacement.\n\n.. |Python's built-in open() function| replace:: Python's built-in ``open()`` function\n.. _Python's built-in open() function: https://docs.python.org/3/library/functions.html#open\n\n.. code-block:: python\n\n    import winnan\n\n    with winnan.open(\"myfile\") as fileobj:\n        pass\n\nThe file descriptor underlying the returned ``file`` object has the following two properties\n**on both POSIX and Windows systems**:\n\n1. The file descriptor is non-inheritable.\n\n2. The file can be *scheduled for deletion* while the file descriptor is still open.\n\n   Saying \"scheduled for deletion\" rather than \"deleted\" is to be pedantic about how the file is put\n   into a \"delete pending\" state on Windows until the last file handle is closed. See\n   `Mercurial's developer documentation`_ as a reference for the semantics of certain operations on\n   the file while it is in a \"delete pending\" state.\n\n.. _Mercurial's developer documentation: https://www.mercurial-scm.org/wiki/UnlinkingFilesOnWindows\n\n\nMotivation\n----------\n\nUnsurprisingly, the complications around managing files involve dealing with other processes.\nDepending on what the Python application is doing, there may be a need to deal with not only\nprocesses spawned by the Python application but also other processes running on the machine.\n\n1. As documented by PEP-446_, opening a file concurrently with spawning a subprocess may lead to the\n   file descriptor being inherited unintentionally.\n\n        The process cannot access the file because it is being used by another process.\n\n   is perhaps the most classic representation of this issue on Windows. In modern versions of\n   Python, the ``O_NOINHERIT`` flag is set by default when opening file descriptors on Windows.\n   Setting it on the opened file descriptor prevents it from being inherited by a child process. The\n   equivalent ``O_CLOEXEC`` flag is also set by default in modern versions of Python when opening\n   file descriptors on POSIX systems.\n\n   It is worth mentioning that due to limitations with being able to set ``close_fds=True`` when\n   redirecting ``stdin``, ``stdout``, or ``stderr`` in older versions of Python, setting the\n   ``O_NOINHERIT`` flag isn't sufficient for preventing files descriptors from being leaked when\n   spawning subprocesses concurrently. Consider guarding all calls to ``subprocess.Popen`` with a\n   ``threading.Lock`` instance to avoid this as an additional issue in older versions of Python.\n\n2. On POSIX systems, it is possible to ``unlink()`` a file while it is still open in another thread\n   or process. On Windows, in all versions of Python, non-``O_TEMPORARY`` files are opened with\n   ``FILE_SHARE_READ | FILE_SHARE_WRITE`` as their sharing mode. Omitting ``FILE_SHARE_DELETE``\n   prevents another thread or process from attempting to delete a file while it is still open.\n\nThe purpose of this library is to mask these behavioral differences across different platforms and\nin older versions of Python.\n\n.. _PEP-446: https://www.python.org/dev/peps/pep-0446/\n\n\nReferences\n----------\n\nThere have been multiple attempts to address the ``FILE_SHARE_DELETE`` issue within CPython itself\nbut they unfortunately never succeeded in being integrated.\n\n* bpo-12939_: ``tempfile.NamedTemporaryFile`` not particularly useful on Windows\n* bpo-14243_: Support for opening files with ``FILE_SHARE_DELETE`` on Windows\n* bpo-15244_: Add new ``io.FileIO`` using the native Windows API\n\n.. _bpo-12939: https://bugs.python.org/issue12939\n.. _bpo-14243: https://bugs.python.org/issue14243\n.. _bpo-15244: https://bugs.python.org/issue15244\n\nStarting in Python 3.7, ``close_fds=True`` is able to be set even when redirecting ``stdin``,\n``stdout``, or ``stderr``.\n\n* bpo-19575_: ``subprocess``: on Windows, unwanted file handles are inherited by child processes\n  in a multi-threaded application\n* bpo-19764_: ``subprocess``: use ``PROC_THREAD_ATTRIBUTE_HANDLE_LIST`` with ``STARTUPINFOEX`` on\n  Windows Vista\n* bpo-33369_: Removing ``Popen`` log files in threads is racy on Windows\n\n.. _bpo-19575: https://bugs.python.org/issue19575\n.. _bpo-19764: https://bugs.python.org/issue19764\n.. _bpo-33369: https://bugs.python.org/issue33369", "description_content_type": "", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/visemet/winnan", "keywords": "", "license": "MIT License", "maintainer": "Max Hirschhorn", "maintainer_email": "max.hirschhorn@mongodb.com", "name": "winnan", "package_url": "https://pypi.org/project/winnan/", "platform": "unix", "project_url": "https://pypi.org/project/winnan/", "project_urls": {"Homepage": "https://github.com/visemet/winnan"}, "release_url": "https://pypi.org/project/winnan/0.1.0/", "requires_dist": null, "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "summary": "More consistent file handling across POSIX and Windows systems", "version": "0.1.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <blockquote>\n<p><strong>winnan</strong></p>\n<ol>\n<li>(verb) to struggle, suffer, contend</li>\n</ol>\n<p><a href=\"https://en.wiktionary.org/wiki/winnan\" rel=\"nofollow\">https://en.wiktionary.org/wiki/winnan</a></p>\n</blockquote>\n<p><em>Because everything about managing files on Windows is terrible.</em></p>\n<div id=\"installation\">\n<h2>Installation</h2>\n<pre><span class=\"gp\">$</span> python -m pip install --upgrade winnan\n</pre>\n</div>\n<div id=\"usage\">\n<h2>Usage</h2>\n<p>Use the <tt>winnan.open()</tt> function exactly like using <a href=\"https://docs.python.org/3/library/functions.html#open\" rel=\"nofollow\">Python\u2019s built-in <tt>open()</tt> function</a>. It aims\nto be a drop-in replacement.</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">winnan</span>\n\n<span class=\"k\">with</span> <span class=\"n\">winnan</span><span class=\"o\">.</span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"s2\">\"myfile\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">fileobj</span><span class=\"p\">:</span>\n    <span class=\"k\">pass</span>\n</pre>\n<p>The file descriptor underlying the returned <tt>file</tt> object has the following two properties\n<strong>on both POSIX and Windows systems</strong>:</p>\n<ol>\n<li><p>The file descriptor is non-inheritable.</p>\n</li>\n<li><p>The file can be <em>scheduled for deletion</em> while the file descriptor is still open.</p>\n<p>Saying \u201cscheduled for deletion\u201d rather than \u201cdeleted\u201d is to be pedantic about how the file is put\ninto a \u201cdelete pending\u201d state on Windows until the last file handle is closed. See\n<a href=\"https://www.mercurial-scm.org/wiki/UnlinkingFilesOnWindows\" rel=\"nofollow\">Mercurial\u2019s developer documentation</a> as a reference for the semantics of certain operations on\nthe file while it is in a \u201cdelete pending\u201d state.</p>\n</li>\n</ol>\n</div>\n<div id=\"motivation\">\n<h2>Motivation</h2>\n<p>Unsurprisingly, the complications around managing files involve dealing with other processes.\nDepending on what the Python application is doing, there may be a need to deal with not only\nprocesses spawned by the Python application but also other processes running on the machine.</p>\n<ol>\n<li><p>As documented by <a href=\"https://www.python.org/dev/peps/pep-0446/\" rel=\"nofollow\">PEP-446</a>, opening a file concurrently with spawning a subprocess may lead to the\nfile descriptor being inherited unintentionally.</p>\n<blockquote>\n<p>The process cannot access the file because it is being used by another process.</p>\n</blockquote>\n<p>is perhaps the most classic representation of this issue on Windows. In modern versions of\nPython, the <tt>O_NOINHERIT</tt> flag is set by default when opening file descriptors on Windows.\nSetting it on the opened file descriptor prevents it from being inherited by a child process. The\nequivalent <tt>O_CLOEXEC</tt> flag is also set by default in modern versions of Python when opening\nfile descriptors on POSIX systems.</p>\n<p>It is worth mentioning that due to limitations with being able to set <tt>close_fds=True</tt> when\nredirecting <tt>stdin</tt>, <tt>stdout</tt>, or <tt>stderr</tt> in older versions of Python, setting the\n<tt>O_NOINHERIT</tt> flag isn\u2019t sufficient for preventing files descriptors from being leaked when\nspawning subprocesses concurrently. Consider guarding all calls to <tt>subprocess.Popen</tt> with a\n<tt>threading.Lock</tt> instance to avoid this as an additional issue in older versions of Python.</p>\n</li>\n<li><p>On POSIX systems, it is possible to <tt>unlink()</tt> a file while it is still open in another thread\nor process. On Windows, in all versions of Python, non-<tt>O_TEMPORARY</tt> files are opened with\n<tt>FILE_SHARE_READ | FILE_SHARE_WRITE</tt> as their sharing mode. Omitting <tt>FILE_SHARE_DELETE</tt>\nprevents another thread or process from attempting to delete a file while it is still open.</p>\n</li>\n</ol>\n<p>The purpose of this library is to mask these behavioral differences across different platforms and\nin older versions of Python.</p>\n</div>\n<div id=\"references\">\n<h2>References</h2>\n<p>There have been multiple attempts to address the <tt>FILE_SHARE_DELETE</tt> issue within CPython itself\nbut they unfortunately never succeeded in being integrated.</p>\n<ul>\n<li><a href=\"https://bugs.python.org/issue12939\" rel=\"nofollow\">bpo-12939</a>: <tt>tempfile.NamedTemporaryFile</tt> not particularly useful on Windows</li>\n<li><a href=\"https://bugs.python.org/issue14243\" rel=\"nofollow\">bpo-14243</a>: Support for opening files with <tt>FILE_SHARE_DELETE</tt> on Windows</li>\n<li><a href=\"https://bugs.python.org/issue15244\" rel=\"nofollow\">bpo-15244</a>: Add new <tt>io.FileIO</tt> using the native Windows API</li>\n</ul>\n<p>Starting in Python 3.7, <tt>close_fds=True</tt> is able to be set even when redirecting <tt>stdin</tt>,\n<tt>stdout</tt>, or <tt>stderr</tt>.</p>\n<ul>\n<li><a href=\"https://bugs.python.org/issue19575\" rel=\"nofollow\">bpo-19575</a>: <tt>subprocess</tt>: on Windows, unwanted file handles are inherited by child processes\nin a multi-threaded application</li>\n<li><a href=\"https://bugs.python.org/issue19764\" rel=\"nofollow\">bpo-19764</a>: <tt>subprocess</tt>: use <tt>PROC_THREAD_ATTRIBUTE_HANDLE_LIST</tt> with <tt>STARTUPINFOEX</tt> on\nWindows Vista</li>\n<li><a href=\"https://bugs.python.org/issue33369\" rel=\"nofollow\">bpo-33369</a>: Removing <tt>Popen</tt> log files in threads is racy on Windows</li>\n</ul>\n</div>\n\n          </div>"}, "last_serial": 4646804, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "3d6c6146e793989bfb030e3bb64cd8c1", "sha256": "d89ae0feb03a62ecca4dfef295daf801668cea3eb5034e296a2f2bb827c0e822"}, "downloads": -1, "filename": "winnan-0.1.0.tar.gz", "has_sig": false, "md5_digest": "3d6c6146e793989bfb030e3bb64cd8c1", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "size": 50384, "upload_time": "2018-12-30T19:42:04", "upload_time_iso_8601": "2018-12-30T19:42:04.721319Z", "url": "https://files.pythonhosted.org/packages/8d/7f/be635e9992297b636c7ccf3dd60ab60f95a4db499d8e0d77e182531a2c11/winnan-0.1.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "3d6c6146e793989bfb030e3bb64cd8c1", "sha256": "d89ae0feb03a62ecca4dfef295daf801668cea3eb5034e296a2f2bb827c0e822"}, "downloads": -1, "filename": "winnan-0.1.0.tar.gz", "has_sig": false, "md5_digest": "3d6c6146e793989bfb030e3bb64cd8c1", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*", "size": 50384, "upload_time": "2018-12-30T19:42:04", "upload_time_iso_8601": "2018-12-30T19:42:04.721319Z", "url": "https://files.pythonhosted.org/packages/8d/7f/be635e9992297b636c7ccf3dd60ab60f95a4db499d8e0d77e182531a2c11/winnan-0.1.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:28:54 2020"}