{"info": {"author": "Shuichiro MAKIGAKI", "author_email": "shuichiro.makigaki@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "# Splunk HEC Stream\n\nPython streaming logging handler for Splunk HEC\n\n---\n\nThis handler is NOT an event sender.\nThe handler itself does not involve forwarding to Splunk HEC endpoint.\n\nThis means that log sources don't have to be concerned about buffering, transforming and retrying.\nThese functions are responsible for log forwarding services (such as AWS Kinesis Firehose, Fluentd, Logstash, etc.).\n\n## Use case\n\n* Forward logs from AWS Lambda functions to Splunk \n    * Send events to Splunk HEC endpoint via AWS Kinesis Firehose and CloudWarch Logs\n* Use with log collector such as Fluentd and Logstash\n    * Read events from log files and process them by log collector\n\n## How to install\n\n```\npip3 install splunk-hec-stream\n```\n\n## Example\n\n```python\nimport logging\nimport json\nfrom datetime import datetime\n\nfrom splunk_hec_stream.logging import SplunkHECStreamHandler\n\n\nlogging.basicConfig(\n    level=logging.INFO,\n    handlers=[SplunkHECStreamHandler(\"main\", \"splunk-logger-test\", \"aws:lambda\", \"_json\")]\n)\n\nlogging.info({\"key1\": \"value1\"})\nlogging.info(\"test\")\nlogging.info('''test\nln''')\nlogging.info(json.dumps({\"key1\": \"value1\"}))\n# You can overwrite logged time by _time extra key (that must be float)\nlogging.info({\"key\": \"value\"}, extra={'_time': datetime.utcnow().timestamp()})\n```\n\nThis example codes put following logs to stdout:\n\n```json\n{\"loggingHandler\":\"SplunkHECStreamHandler\",\"time\":1557301830.617483,\"host\":\"aws:lambda\",\"index\":\"main\",\"source\":\"splunk-logger-test\",\"sourcetype\":\"_json\",\"event\":{\"key1\": \"value1\"}}\n{\"loggingHandler\":\"SplunkHECStreamHandler\",\"time\":1557301830.617758,\"host\":\"aws:lambda\",\"index\":\"main\",\"source\":\"splunk-logger-test\",\"sourcetype\":\"_json\",\"event\":{\"message\": \"test\"}}\n{\"loggingHandler\":\"SplunkHECStreamHandler\",\"time\":1557301830.617904,\"host\":\"aws:lambda\",\"index\":\"main\",\"source\":\"splunk-logger-test\",\"sourcetype\":\"_json\",\"event\":{\"message\": \"test\\nln\"}}\n{\"loggingHandler\":\"SplunkHECStreamHandler\",\"time\":1557301830.618075,\"host\":\"aws:lambda\",\"index\":\"main\",\"source\":\"splunk-logger-test\",\"sourcetype\":\"_json\",\"event\":{\"message\": \"{\\\"key1\\\": \\\"value1\\\"}\"}}\n{\"loggingHandler\":\"SplunkHECStreamHandler\",\"time\":1557269430.618213,\"host\":\"aws:lambda\",\"index\":\"main\",\"source\":\"splunk-logger-test\",\"sourcetype\":\"_json\",\"event\":{\"key\": \"value\"}}\n```\n\nBy forwarding these JSON lines to Splunk HEC endpoint, Splunk can read and store them as events.\n\n## Use with AWS Lambda\n\nThis package is useful to forward logs of AWS Lambda to Splunk.\n\n1. Lambda functions put logs to CloudWatch,\n2. Subscription Filter forwards them to Firehose,\n3. and the Firehose forwards them to Splunk.\n\n### How to\n\n1. Create a lambda layer that contains this library\n2. Configure Kinesis Firehose to send events to Splunk HEC endpoint\n    * `/contrib/aws_firehose_splunk_hec_stream_processor.py` can be used for event processor lambda.\n3. Configure CloudWatch Logs subscription filter, and send the filtered events to the Firehose stream\n    * `loggingHandler` key in JSON can be used to filter logs that forward to Splunk HEC endpoint.\n\n### Terraform\n\n`/contrib/terraform` directory contains Terraform modules for above forwarding system.\n\n```hcl-terraform\nprovider \"aws\" {}\n\nvariable \"python_lib_path\" {\n  default = \"/usr/local/lib/python3.7/site-packages/splunk_hec_stream\"\n}\n\nmodule \"handler_layer\" {\n  source     = \"github.com/shuichiro-makigaki/splunk_hec_stream//contrib/terraform/aws_lambda_layer\"\n  layer_name = \"splunk_hec_stream_handler\"\n  lib_path   = var.python_lib_path\n}\n\nmodule \"firehose_processor\" {\n  source                  = \"github.com/shuichiro-makigaki/splunk_hec_stream//contrib/terraform/aws_firehose\"\n  lib_path                = var.python_lib_path\n  hec_endpoint            = \"https://example.com\"\n  hec_token               = \"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n  layer_arn               = module.handler_layer.arn\n  s3_delivery_bucket_name = \"XXXXXXXX\"\n}\n```\n\nVariable `python_lib_path` should be replaced following your side.", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/shuichiro-makigaki/splunk_hec_stream", "keywords": "", "license": "MIT License", "maintainer": "", "maintainer_email": "", "name": "splunk-hec-stream", "package_url": "https://pypi.org/project/splunk-hec-stream/", "platform": "", "project_url": "https://pypi.org/project/splunk-hec-stream/", "project_urls": {"Homepage": "https://github.com/shuichiro-makigaki/splunk_hec_stream"}, "release_url": "https://pypi.org/project/splunk-hec-stream/0.3/", "requires_dist": null, "requires_python": "", "summary": "Splunk HEC Stream", "version": "0.3", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>Splunk HEC Stream</h1>\n<p>Python streaming logging handler for Splunk HEC</p>\n<hr>\n<p>This handler is NOT an event sender.\nThe handler itself does not involve forwarding to Splunk HEC endpoint.</p>\n<p>This means that log sources don't have to be concerned about buffering, transforming and retrying.\nThese functions are responsible for log forwarding services (such as AWS Kinesis Firehose, Fluentd, Logstash, etc.).</p>\n<h2>Use case</h2>\n<ul>\n<li>Forward logs from AWS Lambda functions to Splunk\n<ul>\n<li>Send events to Splunk HEC endpoint via AWS Kinesis Firehose and CloudWarch Logs</li>\n</ul>\n</li>\n<li>Use with log collector such as Fluentd and Logstash\n<ul>\n<li>Read events from log files and process them by log collector</li>\n</ul>\n</li>\n</ul>\n<h2>How to install</h2>\n<pre><code>pip3 install splunk-hec-stream\n</code></pre>\n<h2>Example</h2>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">logging</span>\n<span class=\"kn\">import</span> <span class=\"nn\">json</span>\n<span class=\"kn\">from</span> <span class=\"nn\">datetime</span> <span class=\"kn\">import</span> <span class=\"n\">datetime</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">splunk_hec_stream.logging</span> <span class=\"kn\">import</span> <span class=\"n\">SplunkHECStreamHandler</span>\n\n\n<span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">basicConfig</span><span class=\"p\">(</span>\n    <span class=\"n\">level</span><span class=\"o\">=</span><span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">INFO</span><span class=\"p\">,</span>\n    <span class=\"n\">handlers</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">SplunkHECStreamHandler</span><span class=\"p\">(</span><span class=\"s2\">\"main\"</span><span class=\"p\">,</span> <span class=\"s2\">\"splunk-logger-test\"</span><span class=\"p\">,</span> <span class=\"s2\">\"aws:lambda\"</span><span class=\"p\">,</span> <span class=\"s2\">\"_json\"</span><span class=\"p\">)]</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">({</span><span class=\"s2\">\"key1\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value1\"</span><span class=\"p\">})</span>\n<span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">\"test\"</span><span class=\"p\">)</span>\n<span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">'''test</span>\n<span class=\"s1\">ln'''</span><span class=\"p\">)</span>\n<span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">({</span><span class=\"s2\">\"key1\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value1\"</span><span class=\"p\">}))</span>\n<span class=\"c1\"># You can overwrite logged time by _time extra key (that must be float)</span>\n<span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">({</span><span class=\"s2\">\"key\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value\"</span><span class=\"p\">},</span> <span class=\"n\">extra</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'_time'</span><span class=\"p\">:</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">utcnow</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">timestamp</span><span class=\"p\">()})</span>\n</pre>\n<p>This example codes put following logs to stdout:</p>\n<pre><span class=\"p\">{</span><span class=\"nt\">\"loggingHandler\"</span><span class=\"p\">:</span><span class=\"s2\">\"SplunkHECStreamHandler\"</span><span class=\"p\">,</span><span class=\"nt\">\"time\"</span><span class=\"p\">:</span><span class=\"mf\">1557301830.617483</span><span class=\"p\">,</span><span class=\"nt\">\"host\"</span><span class=\"p\">:</span><span class=\"s2\">\"aws:lambda\"</span><span class=\"p\">,</span><span class=\"nt\">\"index\"</span><span class=\"p\">:</span><span class=\"s2\">\"main\"</span><span class=\"p\">,</span><span class=\"nt\">\"source\"</span><span class=\"p\">:</span><span class=\"s2\">\"splunk-logger-test\"</span><span class=\"p\">,</span><span class=\"nt\">\"sourcetype\"</span><span class=\"p\">:</span><span class=\"s2\">\"_json\"</span><span class=\"p\">,</span><span class=\"nt\">\"event\"</span><span class=\"p\">:{</span><span class=\"nt\">\"key1\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value1\"</span><span class=\"p\">}}</span>\n<span class=\"p\">{</span><span class=\"nt\">\"loggingHandler\"</span><span class=\"p\">:</span><span class=\"s2\">\"SplunkHECStreamHandler\"</span><span class=\"p\">,</span><span class=\"nt\">\"time\"</span><span class=\"p\">:</span><span class=\"mf\">1557301830.617758</span><span class=\"p\">,</span><span class=\"nt\">\"host\"</span><span class=\"p\">:</span><span class=\"s2\">\"aws:lambda\"</span><span class=\"p\">,</span><span class=\"nt\">\"index\"</span><span class=\"p\">:</span><span class=\"s2\">\"main\"</span><span class=\"p\">,</span><span class=\"nt\">\"source\"</span><span class=\"p\">:</span><span class=\"s2\">\"splunk-logger-test\"</span><span class=\"p\">,</span><span class=\"nt\">\"sourcetype\"</span><span class=\"p\">:</span><span class=\"s2\">\"_json\"</span><span class=\"p\">,</span><span class=\"nt\">\"event\"</span><span class=\"p\">:{</span><span class=\"nt\">\"message\"</span><span class=\"p\">:</span> <span class=\"s2\">\"test\"</span><span class=\"p\">}}</span>\n<span class=\"p\">{</span><span class=\"nt\">\"loggingHandler\"</span><span class=\"p\">:</span><span class=\"s2\">\"SplunkHECStreamHandler\"</span><span class=\"p\">,</span><span class=\"nt\">\"time\"</span><span class=\"p\">:</span><span class=\"mf\">1557301830.617904</span><span class=\"p\">,</span><span class=\"nt\">\"host\"</span><span class=\"p\">:</span><span class=\"s2\">\"aws:lambda\"</span><span class=\"p\">,</span><span class=\"nt\">\"index\"</span><span class=\"p\">:</span><span class=\"s2\">\"main\"</span><span class=\"p\">,</span><span class=\"nt\">\"source\"</span><span class=\"p\">:</span><span class=\"s2\">\"splunk-logger-test\"</span><span class=\"p\">,</span><span class=\"nt\">\"sourcetype\"</span><span class=\"p\">:</span><span class=\"s2\">\"_json\"</span><span class=\"p\">,</span><span class=\"nt\">\"event\"</span><span class=\"p\">:{</span><span class=\"nt\">\"message\"</span><span class=\"p\">:</span> <span class=\"s2\">\"test\\nln\"</span><span class=\"p\">}}</span>\n<span class=\"p\">{</span><span class=\"nt\">\"loggingHandler\"</span><span class=\"p\">:</span><span class=\"s2\">\"SplunkHECStreamHandler\"</span><span class=\"p\">,</span><span class=\"nt\">\"time\"</span><span class=\"p\">:</span><span class=\"mf\">1557301830.618075</span><span class=\"p\">,</span><span class=\"nt\">\"host\"</span><span class=\"p\">:</span><span class=\"s2\">\"aws:lambda\"</span><span class=\"p\">,</span><span class=\"nt\">\"index\"</span><span class=\"p\">:</span><span class=\"s2\">\"main\"</span><span class=\"p\">,</span><span class=\"nt\">\"source\"</span><span class=\"p\">:</span><span class=\"s2\">\"splunk-logger-test\"</span><span class=\"p\">,</span><span class=\"nt\">\"sourcetype\"</span><span class=\"p\">:</span><span class=\"s2\">\"_json\"</span><span class=\"p\">,</span><span class=\"nt\">\"event\"</span><span class=\"p\">:{</span><span class=\"nt\">\"message\"</span><span class=\"p\">:</span> <span class=\"s2\">\"{\\\"key1\\\": \\\"value1\\\"}\"</span><span class=\"p\">}}</span>\n<span class=\"p\">{</span><span class=\"nt\">\"loggingHandler\"</span><span class=\"p\">:</span><span class=\"s2\">\"SplunkHECStreamHandler\"</span><span class=\"p\">,</span><span class=\"nt\">\"time\"</span><span class=\"p\">:</span><span class=\"mf\">1557269430.618213</span><span class=\"p\">,</span><span class=\"nt\">\"host\"</span><span class=\"p\">:</span><span class=\"s2\">\"aws:lambda\"</span><span class=\"p\">,</span><span class=\"nt\">\"index\"</span><span class=\"p\">:</span><span class=\"s2\">\"main\"</span><span class=\"p\">,</span><span class=\"nt\">\"source\"</span><span class=\"p\">:</span><span class=\"s2\">\"splunk-logger-test\"</span><span class=\"p\">,</span><span class=\"nt\">\"sourcetype\"</span><span class=\"p\">:</span><span class=\"s2\">\"_json\"</span><span class=\"p\">,</span><span class=\"nt\">\"event\"</span><span class=\"p\">:{</span><span class=\"nt\">\"key\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value\"</span><span class=\"p\">}}</span>\n</pre>\n<p>By forwarding these JSON lines to Splunk HEC endpoint, Splunk can read and store them as events.</p>\n<h2>Use with AWS Lambda</h2>\n<p>This package is useful to forward logs of AWS Lambda to Splunk.</p>\n<ol>\n<li>Lambda functions put logs to CloudWatch,</li>\n<li>Subscription Filter forwards them to Firehose,</li>\n<li>and the Firehose forwards them to Splunk.</li>\n</ol>\n<h3>How to</h3>\n<ol>\n<li>Create a lambda layer that contains this library</li>\n<li>Configure Kinesis Firehose to send events to Splunk HEC endpoint\n<ul>\n<li><code>/contrib/aws_firehose_splunk_hec_stream_processor.py</code> can be used for event processor lambda.</li>\n</ul>\n</li>\n<li>Configure CloudWatch Logs subscription filter, and send the filtered events to the Firehose stream\n<ul>\n<li><code>loggingHandler</code> key in JSON can be used to filter logs that forward to Splunk HEC endpoint.</li>\n</ul>\n</li>\n</ol>\n<h3>Terraform</h3>\n<p><code>/contrib/terraform</code> directory contains Terraform modules for above forwarding system.</p>\n<pre>provider \"aws\" {}\n\nvariable \"python_lib_path\" {\n  default = \"/usr/local/lib/python3.7/site-packages/splunk_hec_stream\"\n}\n\nmodule \"handler_layer\" {\n  source     = \"github.com/shuichiro-makigaki/splunk_hec_stream//contrib/terraform/aws_lambda_layer\"\n  layer_name = \"splunk_hec_stream_handler\"\n  lib_path   = var.python_lib_path\n}\n\nmodule \"firehose_processor\" {\n  source                  = \"github.com/shuichiro-makigaki/splunk_hec_stream//contrib/terraform/aws_firehose\"\n  lib_path                = var.python_lib_path\n  hec_endpoint            = \"https://example.com\"\n  hec_token               = \"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n  layer_arn               = module.handler_layer.arn\n  s3_delivery_bucket_name = \"XXXXXXXX\"\n}\n</pre>\n<p>Variable <code>python_lib_path</code> should be replaced following your side.</p>\n\n          </div>"}, "last_serial": 5380653, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "286703c45c13a8f20b61340a7d01c9aa", "sha256": "c1b5e19bcb6ff945f0f9387a4504e9e44a882f2461687792d692ea92f481cf63"}, "downloads": -1, "filename": "splunk_hec_stream-0.1.tar.gz", "has_sig": false, "md5_digest": "286703c45c13a8f20b61340a7d01c9aa", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 2354, "upload_time": "2019-04-19T04:01:45", "upload_time_iso_8601": "2019-04-19T04:01:45.981313Z", "url": "https://files.pythonhosted.org/packages/e5/bf/d0091f1f8b9fa23d16ee488b4bd842eb3dedd57f3aac4f831ca3f98dfe17/splunk_hec_stream-0.1.tar.gz", "yanked": false}], "0.2": [{"comment_text": "", "digests": {"md5": "ef35e25a600312823ccd504f5ea86f53", "sha256": "ee57186e674b05e4466f06a22905211ac0813afc67892586b90db3860b450bce"}, "downloads": -1, "filename": "splunk_hec_stream-0.2.tar.gz", "has_sig": false, "md5_digest": "ef35e25a600312823ccd504f5ea86f53", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 2261, "upload_time": "2019-04-25T10:16:56", "upload_time_iso_8601": "2019-04-25T10:16:56.336681Z", "url": "https://files.pythonhosted.org/packages/74/88/d78fc464b9b5e364d26113126a6b4d675d756d2891fc7d867df68e437258/splunk_hec_stream-0.2.tar.gz", "yanked": false}], "0.3": [{"comment_text": "", "digests": {"md5": "2b816ac0d177627f70b905b27f41b4ee", "sha256": "52766da4f2fa82a268eea759c47966c4abe651fb6b323804b65121641ef8c2e7"}, "downloads": -1, "filename": "splunk_hec_stream-0.3.tar.gz", "has_sig": false, "md5_digest": "2b816ac0d177627f70b905b27f41b4ee", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3628, "upload_time": "2019-06-10T10:06:36", "upload_time_iso_8601": "2019-06-10T10:06:36.031231Z", "url": "https://files.pythonhosted.org/packages/81/d2/feb789b6884e880795d3a673684f4b4bf7400ffaa5ac03d90330381db4d8/splunk_hec_stream-0.3.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "2b816ac0d177627f70b905b27f41b4ee", "sha256": "52766da4f2fa82a268eea759c47966c4abe651fb6b323804b65121641ef8c2e7"}, "downloads": -1, "filename": "splunk_hec_stream-0.3.tar.gz", "has_sig": false, "md5_digest": "2b816ac0d177627f70b905b27f41b4ee", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3628, "upload_time": "2019-06-10T10:06:36", "upload_time_iso_8601": "2019-06-10T10:06:36.031231Z", "url": "https://files.pythonhosted.org/packages/81/d2/feb789b6884e880795d3a673684f4b4bf7400ffaa5ac03d90330381db4d8/splunk_hec_stream-0.3.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:04:40 2020"}