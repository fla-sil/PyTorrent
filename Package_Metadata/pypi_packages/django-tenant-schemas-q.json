{"info": {"author": "Rajesh Yogeshwar", "author_email": "rajesh.yogeshwar@gmail.com", "bugtrack_url": null, "classifiers": ["License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python :: 3"], "description": "\n# Django Tenant Schemas Q\n\n\n\nDjango Tenant Schemas Q is a custom implementation for Django-Q cluster for projects that make use Django Tenant Schemas package to achieve multi-tenancy in their Django projects with Postgres as database service. Using this package, developer can setup a Django project to be multi-tenant and setup Django-Q cluster to work per tenant/schema basis. This package works with any other broker apart from Django ORM.\n\n\n\n# Why the need for this package?\n\n\n\nAlthough there is package *tenant-schemas-celery* supporting celery for multi-tenancy, I was quite intrigued by the *django-q* project and was exploring the possibility of making *django-q* work with *django-tenant-schemas*.\n\n\n\n# Installation\n\n\n\npip install django-tenant-schemas-q\n\n\n\nThis should install *django-tenant-schemas* and *django-q*.\n\n\n\n# How to set this up?\n\nAs a developer I often find that setting up projects, packages and getting configurations right is sometimes a relatively tough job. In order to make this work nicely, just follow the steps below.\n\n\n\n- Refer to settings required by *django_tenant_schemas* mentioned [here](https://django-tenant-schemas.readthedocs.io/en/latest/install.html)\n\n- Setup *django_tenant_schemas* as per the instructions in the above mentioned link. This will take care of setting up of *django_tenant_schemas*.\n\n- Add *django_q* to TENANT_APPS setting. This will setup models like Task, Schedule on every tenant post migrations.\n\n- Follow it up with setting up the Django-Q cluster that needs to be run in order to process tasks and run our scheduler.\n\n- While setting up configuration for cluster, **make use of any other broker supported by Django-Q apart from Django ORM.**\n\n- Finally add a setting **SCHEMAS_TO_BE_EXCLUDED_BY_SCHEDULER** in your settings file. The value for this setting is a list of schema that you wish to exclude from scheduler, If not specified, scheduler will exclude a schema by name *public* by default.\n\n\n\n# How will this work\n\nAssuming you have followed the instructions perfectly, you should now have settings looking like\n\n\n\nSHARED_APPS = ['tenant_schemas', 'app_containing_tenant_model ', 'any_other_app_needed']\n\nTENANT_APPS = ['django_q', 'standard_django_apps', 'any_other_app_needed']\n\nINSTALLED_APPS = ['tenant_schemas', 'app_containing_tenant_model', 'django_q', 'standard_django_apps', 'any_other_app_needed']\n\nTENANT_MODEL = 'app_name.ModelName'\n\nSCHEMAS_TO_BE_EXCLUDED_BY_SCHEDULER = ['public']\n\nQ_CLUSTER = {} # Configuration for Q Cluster\n\n\n\nWhat these settings will do is simple. It will simply create *Task & Schedule* models per schema. Django-Q uses these modules to store the tasks and schedules. With these models now setup on per schema/tenant basis the things become a bit cleaner.\n\n\n\nTo run the cluster, use the command `python manage.py mscluster`\n\nOnce the command is fired, the cluster will start and accept the tasks and schedules.\n\n\n\nNow, given that are schedules are tasks that are executed as per the frequency having them per schema/tenant basis is something that I wanted to achieve. This would give me ability to configure same tasks with different times and the system will work as expected.\n\n\n# How to use it\n\nTo allow adding a task or schedule with database schema awareness, package contains utilities to make it is seamless.\n\nAdd the line `from django_tenant_schemas_q.utils import QUtilities` to the line from where you wish to add a `task` or a `schedule`\n\nTo add an async task you can use\n\n    QUtilities.add_async_task(func_name_as_string, *args, **kwargs)\n You can add `sync=True` in kwargs to run the task synchronously.\n\nTo create a new schedule you can use\n\n    QUtilities.create_schedule(func_name_as_string, *args, **kwargs)\n\nTo get a result of a single task\n\n    QUtilities.get_result(task_id, wait=0, cached=Conf.CACHED)\n\nTo get a result of a group\n\n    QUtilities.get_result_group(group_id, failures=False, wait=0, count=None, cached=Conf.CACHED)\n\nTo fetch a single task\n\n    QUtilities.fetch_task(task_id, wait=0, cached=Conf.CACHED)\n\nTo fetch a group of tasks\n\n    QUtilities.fetch_task_group(group_id, failures=True, wait=0, count=None, cached=Conf.CACHED)\n\nTo get count of groups\n\n    QUtilities.get_group_count(group_id, failures=False, cached=Conf.CACHED)\n\n To delete a group of tasks\n\n    QUtilities.delete_task_group(group_id, tasks=False, cached=Conf.CACHED)\n\nTo delete a task from cache\n\n    QUtilities.delete_task_from_cache(task_id, broker=None)\n\nTo get the size of the queue\n\n     QUtilities.get_queue_size(broker=None)\n\nTo add multiple async tasks using Iter\n\n    QUtilities.add_async_tasks_from_iter(func, args_iter, **kwargs)\n For this use `Iter` from `django_tenant_schemas_q.custom` module.\n\nTo create a chain of tasks using Chain\n\n    QUtilities.create_async_tasks_chain(chain, group=None, cached=Conf.CACHED, sync=Conf.SYNC, broker=None)\n For this use `Chain` from `django_tenant_schemas_q.custom` module.\n\n\n# Test the project\n\nThere is a test django project in the repository. \n- Clone the repository\n- Run `docker-compose -f test-compose.yml build`\n- Run `docker-compose -f test-compose.yml up -d`\n- Run `docker-compose -f test-compose.yml run backend python manage.py test --keepdb`\n\n\nFull credit to authors https://github.com/Koed00 of Django-Q and https://github.com/bernardopires of Django-Tenant-Schemas for two wonderful packages.\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/rajeshyogeshwar/django-tenant-schemas-q", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "django-tenant-schemas-q", "package_url": "https://pypi.org/project/django-tenant-schemas-q/", "platform": "", "project_url": "https://pypi.org/project/django-tenant-schemas-q/", "project_urls": {"Homepage": "https://github.com/rajeshyogeshwar/django-tenant-schemas-q"}, "release_url": "https://pypi.org/project/django-tenant-schemas-q/0.0.1/", "requires_dist": ["django-tenant-schemas (>=1.10.0)", "django-q (>=1.2.1)"], "requires_python": ">=3.7", "summary": "An integration package for Django-Q with Django Tenant Schemas", "version": "0.0.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>Django Tenant Schemas Q</h1>\n<p>Django Tenant Schemas Q is a custom implementation for Django-Q cluster for projects that make use Django Tenant Schemas package to achieve multi-tenancy in their Django projects with Postgres as database service. Using this package, developer can setup a Django project to be multi-tenant and setup Django-Q cluster to work per tenant/schema basis. This package works with any other broker apart from Django ORM.</p>\n<h1>Why the need for this package?</h1>\n<p>Although there is package <em>tenant-schemas-celery</em> supporting celery for multi-tenancy, I was quite intrigued by the <em>django-q</em> project and was exploring the possibility of making <em>django-q</em> work with <em>django-tenant-schemas</em>.</p>\n<h1>Installation</h1>\n<p>pip install django-tenant-schemas-q</p>\n<p>This should install <em>django-tenant-schemas</em> and <em>django-q</em>.</p>\n<h1>How to set this up?</h1>\n<p>As a developer I often find that setting up projects, packages and getting configurations right is sometimes a relatively tough job. In order to make this work nicely, just follow the steps below.</p>\n<ul>\n<li>\n<p>Refer to settings required by <em>django_tenant_schemas</em> mentioned <a href=\"https://django-tenant-schemas.readthedocs.io/en/latest/install.html\" rel=\"nofollow\">here</a></p>\n</li>\n<li>\n<p>Setup <em>django_tenant_schemas</em> as per the instructions in the above mentioned link. This will take care of setting up of <em>django_tenant_schemas</em>.</p>\n</li>\n<li>\n<p>Add <em>django_q</em> to TENANT_APPS setting. This will setup models like Task, Schedule on every tenant post migrations.</p>\n</li>\n<li>\n<p>Follow it up with setting up the Django-Q cluster that needs to be run in order to process tasks and run our scheduler.</p>\n</li>\n<li>\n<p>While setting up configuration for cluster, <strong>make use of any other broker supported by Django-Q apart from Django ORM.</strong></p>\n</li>\n<li>\n<p>Finally add a setting <strong>SCHEMAS_TO_BE_EXCLUDED_BY_SCHEDULER</strong> in your settings file. The value for this setting is a list of schema that you wish to exclude from scheduler, If not specified, scheduler will exclude a schema by name <em>public</em> by default.</p>\n</li>\n</ul>\n<h1>How will this work</h1>\n<p>Assuming you have followed the instructions perfectly, you should now have settings looking like</p>\n<p>SHARED_APPS = ['tenant_schemas', 'app_containing_tenant_model ', 'any_other_app_needed']</p>\n<p>TENANT_APPS = ['django_q', 'standard_django_apps', 'any_other_app_needed']</p>\n<p>INSTALLED_APPS = ['tenant_schemas', 'app_containing_tenant_model', 'django_q', 'standard_django_apps', 'any_other_app_needed']</p>\n<p>TENANT_MODEL = 'app_name.ModelName'</p>\n<p>SCHEMAS_TO_BE_EXCLUDED_BY_SCHEDULER = ['public']</p>\n<p>Q_CLUSTER = {} # Configuration for Q Cluster</p>\n<p>What these settings will do is simple. It will simply create <em>Task &amp; Schedule</em> models per schema. Django-Q uses these modules to store the tasks and schedules. With these models now setup on per schema/tenant basis the things become a bit cleaner.</p>\n<p>To run the cluster, use the command <code>python manage.py mscluster</code></p>\n<p>Once the command is fired, the cluster will start and accept the tasks and schedules.</p>\n<p>Now, given that are schedules are tasks that are executed as per the frequency having them per schema/tenant basis is something that I wanted to achieve. This would give me ability to configure same tasks with different times and the system will work as expected.</p>\n<h1>How to use it</h1>\n<p>To allow adding a task or schedule with database schema awareness, package contains utilities to make it is seamless.</p>\n<p>Add the line <code>from django_tenant_schemas_q.utils import QUtilities</code> to the line from where you wish to add a <code>task</code> or a <code>schedule</code></p>\n<p>To add an async task you can use</p>\n<pre><code>QUtilities.add_async_task(func_name_as_string, *args, **kwargs)\n</code></pre>\n<p>You can add <code>sync=True</code> in kwargs to run the task synchronously.</p>\n<p>To create a new schedule you can use</p>\n<pre><code>QUtilities.create_schedule(func_name_as_string, *args, **kwargs)\n</code></pre>\n<p>To get a result of a single task</p>\n<pre><code>QUtilities.get_result(task_id, wait=0, cached=Conf.CACHED)\n</code></pre>\n<p>To get a result of a group</p>\n<pre><code>QUtilities.get_result_group(group_id, failures=False, wait=0, count=None, cached=Conf.CACHED)\n</code></pre>\n<p>To fetch a single task</p>\n<pre><code>QUtilities.fetch_task(task_id, wait=0, cached=Conf.CACHED)\n</code></pre>\n<p>To fetch a group of tasks</p>\n<pre><code>QUtilities.fetch_task_group(group_id, failures=True, wait=0, count=None, cached=Conf.CACHED)\n</code></pre>\n<p>To get count of groups</p>\n<pre><code>QUtilities.get_group_count(group_id, failures=False, cached=Conf.CACHED)\n</code></pre>\n<p>To delete a group of tasks</p>\n<pre><code>QUtilities.delete_task_group(group_id, tasks=False, cached=Conf.CACHED)\n</code></pre>\n<p>To delete a task from cache</p>\n<pre><code>QUtilities.delete_task_from_cache(task_id, broker=None)\n</code></pre>\n<p>To get the size of the queue</p>\n<pre><code> QUtilities.get_queue_size(broker=None)\n</code></pre>\n<p>To add multiple async tasks using Iter</p>\n<pre><code>QUtilities.add_async_tasks_from_iter(func, args_iter, **kwargs)\n</code></pre>\n<p>For this use <code>Iter</code> from <code>django_tenant_schemas_q.custom</code> module.</p>\n<p>To create a chain of tasks using Chain</p>\n<pre><code>QUtilities.create_async_tasks_chain(chain, group=None, cached=Conf.CACHED, sync=Conf.SYNC, broker=None)\n</code></pre>\n<p>For this use <code>Chain</code> from <code>django_tenant_schemas_q.custom</code> module.</p>\n<h1>Test the project</h1>\n<p>There is a test django project in the repository.</p>\n<ul>\n<li>Clone the repository</li>\n<li>Run <code>docker-compose -f test-compose.yml build</code></li>\n<li>Run <code>docker-compose -f test-compose.yml up -d</code></li>\n<li>Run <code>docker-compose -f test-compose.yml run backend python manage.py test --keepdb</code></li>\n</ul>\n<p>Full credit to authors <a href=\"https://github.com/Koed00\" rel=\"nofollow\">https://github.com/Koed00</a> of Django-Q and <a href=\"https://github.com/bernardopires\" rel=\"nofollow\">https://github.com/bernardopires</a> of Django-Tenant-Schemas for two wonderful packages.</p>\n\n          </div>"}, "last_serial": 6889628, "releases": {"0.0.1": [{"comment_text": "", "digests": {"md5": "0ffe24cfe71f1bd87e91da2ff70370d4", "sha256": "09ea74a395e2e571fbc5688c095812bc5a17734addf920c19a0676abdb767ed3"}, "downloads": -1, "filename": "django_tenant_schemas_q-0.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "0ffe24cfe71f1bd87e91da2ff70370d4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 15283, "upload_time": "2020-03-26T17:08:52", "upload_time_iso_8601": "2020-03-26T17:08:52.483748Z", "url": "https://files.pythonhosted.org/packages/bf/99/ff8176e7f2b7f753a1d29ea059ae35de4cca58e59cdc40b14aa8392c155a/django_tenant_schemas_q-0.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "2bf321847cd6bf4f56653785a4576b15", "sha256": "523aaa00b0f63e474b057c7d78e584c0a9981b61fa6ef79ce486e73784b4dfaa"}, "downloads": -1, "filename": "django_tenant_schemas_q-0.0.1.tar.gz", "has_sig": false, "md5_digest": "2bf321847cd6bf4f56653785a4576b15", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 13301, "upload_time": "2020-03-26T17:08:55", "upload_time_iso_8601": "2020-03-26T17:08:55.557716Z", "url": "https://files.pythonhosted.org/packages/72/bb/fd671a0bee8698001655f62e956c85954a6d3dd78b1e1f4d0ee49f42a17e/django_tenant_schemas_q-0.0.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "0ffe24cfe71f1bd87e91da2ff70370d4", "sha256": "09ea74a395e2e571fbc5688c095812bc5a17734addf920c19a0676abdb767ed3"}, "downloads": -1, "filename": "django_tenant_schemas_q-0.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "0ffe24cfe71f1bd87e91da2ff70370d4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 15283, "upload_time": "2020-03-26T17:08:52", "upload_time_iso_8601": "2020-03-26T17:08:52.483748Z", "url": "https://files.pythonhosted.org/packages/bf/99/ff8176e7f2b7f753a1d29ea059ae35de4cca58e59cdc40b14aa8392c155a/django_tenant_schemas_q-0.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "2bf321847cd6bf4f56653785a4576b15", "sha256": "523aaa00b0f63e474b057c7d78e584c0a9981b61fa6ef79ce486e73784b4dfaa"}, "downloads": -1, "filename": "django_tenant_schemas_q-0.0.1.tar.gz", "has_sig": false, "md5_digest": "2bf321847cd6bf4f56653785a4576b15", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 13301, "upload_time": "2020-03-26T17:08:55", "upload_time_iso_8601": "2020-03-26T17:08:55.557716Z", "url": "https://files.pythonhosted.org/packages/72/bb/fd671a0bee8698001655f62e956c85954a6d3dd78b1e1f4d0ee49f42a17e/django_tenant_schemas_q-0.0.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:52:35 2020"}