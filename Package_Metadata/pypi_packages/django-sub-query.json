{"info": {"author": "Miroslav Shubernetskiy", "author_email": "UNKNOWN", "bugtrack_url": null, "classifiers": ["Development Status :: 2 - Pre-Alpha", "Intended Audience :: Developers", "License :: OSI Approved :: MIT License", "Natural Language :: English", "Programming Language :: Python", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.4"], "description": "===============\nDjango SubQuery\n===============\n\n.. image:: https://badge.fury.io/py/django-sub-query.png\n    :target: http://badge.fury.io/py/django-sub-query\n\n.. image:: https://travis-ci.org/miki725/django-sub-query.png?branch=master\n    :target: https://travis-ci.org/miki725/django-sub-query\n\nDjango app which uses SQL sub-queries to solve some ORM limitations\n\n* Free software: MIT license\n* GitHub: https://github.com/miki725/django-sub-query\n\nWhy?\n----\n\nDjango ORM is pretty awesome however it has some limitations.\nOne of such limitations is the ability to use sub-queries.\nActually thats not 100% true since Django ORM can use nested queries\nhowever those subqueries are for either aggregates or are manually\nprovided by the user via ``QuerySet.extra()``. Such types of subqueries\nhowever sometimes are not good enough. One such scenario is when\nyou need to sort by one column however and at the same time you need to use\ndistinct on a different column. The usual solution is to use subquery\nwhere inner query will use distinct and outer query will do the sorting::\n\n    SELECT *\n    FROM (\n      SELECT DISTINCT ON (\"table\".\"foo\") <lots of columns here>\n      FROM \"table\"\n    ) \"table\"\n    ORDER BY \"table\".\"bar\" ASC;\n\nThe above however is not supported by vanilla Django ORM.\nYou can of course use raw SQL queries however that is not desired since\nthen you loose all of the ORM power (e.g. pagination, etc).\n\nOne hack to still use ORM and yet use subquery is use Django ORM\nto construct inner query and then manually add outer query::\n\n    query = Model.objects.filter(...).distinct(...).query\n    sql, params = query.sql_with_params()\n    Model.objects.raw(\n        'SELECT * FROM ({}) \"table\" ORDER BY \"table\".\"foo\"'.format(sql),\n        params\n    )\n\nThis approach however is also not desired since due to:\n\n* not able to use ``select_related()`` when related table\n  has similar column name(s)\n* still difficult to do pagination\n* more logic required to be able to do ``.count()``\n\nSolution\n--------\n\nAs you saw above, currently it is difficult to use sub-queries in Django\nhowever conceptually the solution is pretty simply since we should be able\nto simply wrap SQL generated by Django ORM within an outer query.\nThis is exactly what this library does. It hooks up directly into Django's\n``as_sql()`` ORM method which is responsible for generating SQL and adds\nouter query when necessary conditions are met.\n\nInstalling\n----------\n\nYou can install ``django-sub-query`` using pip::\n\n    $ pip install django-sub-query\n\nUsing\n-----\n\nSince this library changes a few bits in inner-workings in Django ORM,\nthere is no simple way to use this library other then completely change\ndatabase engine::\n\n    DATABASES = {\n        'default': {\n            'ENGINE': 'sub_query.db.backends.postgis',\n            ...\n        },\n    }\n\nCurrently only ``postgis`` backend is supported however please feel free to\nopen an issue to add support for other backends (or contribute implementation!).\n\nOnce the database engine is changed, then you have to make sure the\nqueryset you are using is a subclass of ``SubQueryGeoQuerySet``::\n\n    class ExampleModel(models.Model):\n        ...\n        objects = SubQueryGeoQuerySet.as_manager()\n\nTesting\n-------\n\nTo run the tests you need to install testing requirements first::\n\n    $ make install\n\nThen to run tests, you can use ``manage.py`` or simply use Makefile command::\n\n    $ python manage.py test\n    # or\n    $ make test\n\n\n\n\nHistory\n-------\n\n0.1.0 (2015-01-25)\n~~~~~~~~~~~~~~~~~~~~~\n\n* First release on PyPI.\n\n\nCredits\n-------\n\nDevelopment Lead\n~~~~~~~~~~~~~~~~\n\n* Miroslav Shubernetskiy  - https://github.com/miki725\n\nContributors\n~~~~~~~~~~~~\n\nNone yet. Why not be the first?\n\n\nLicense\n-------\n\nThe MIT License (MIT)\n\nCopyright (c) 2015, Miroslav Shubernetskiy\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.", "description_content_type": null, "docs_url": null, "download_url": "UNKNOWN", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/miki725/django-sub-query", "keywords": "django", "license": "MIT", "maintainer": null, "maintainer_email": null, "name": "django-sub-query", "package_url": "https://pypi.org/project/django-sub-query/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/django-sub-query/", "project_urls": {"Download": "UNKNOWN", "Homepage": "https://github.com/miki725/django-sub-query"}, "release_url": "https://pypi.org/project/django-sub-query/0.1/", "requires_dist": null, "requires_python": null, "summary": "Django app which uses SQL sub-queries to solve some ORM limitations", "version": "0.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <a href=\"http://badge.fury.io/py/django-sub-query\" rel=\"nofollow\"><img alt=\"https://badge.fury.io/py/django-sub-query.png\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/ec456f2d184c5f7661541af45b3849a4c34c876b/68747470733a2f2f62616467652e667572792e696f2f70792f646a616e676f2d7375622d71756572792e706e67\"></a>\n<a href=\"https://travis-ci.org/miki725/django-sub-query\" rel=\"nofollow\"><img alt=\"https://travis-ci.org/miki725/django-sub-query.png?branch=master\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/2eef7ede2e4c691bf7f567d342aa94d64e7a8f12/68747470733a2f2f7472617669732d63692e6f72672f6d696b693732352f646a616e676f2d7375622d71756572792e706e673f6272616e63683d6d6173746572\"></a>\n<p>Django app which uses SQL sub-queries to solve some ORM limitations</p>\n<ul>\n<li>Free software: MIT license</li>\n<li>GitHub: <a href=\"https://github.com/miki725/django-sub-query\" rel=\"nofollow\">https://github.com/miki725/django-sub-query</a></li>\n</ul>\n<div id=\"why\">\n<h2>Why?</h2>\n<p>Django ORM is pretty awesome however it has some limitations.\nOne of such limitations is the ability to use sub-queries.\nActually thats not 100% true since Django ORM can use nested queries\nhowever those subqueries are for either aggregates or are manually\nprovided by the user via <tt>QuerySet.extra()</tt>. Such types of subqueries\nhowever sometimes are not good enough. One such scenario is when\nyou need to sort by one column however and at the same time you need to use\ndistinct on a different column. The usual solution is to use subquery\nwhere inner query will use distinct and outer query will do the sorting:</p>\n<pre>SELECT *\nFROM (\n  SELECT DISTINCT ON (\"table\".\"foo\") &lt;lots of columns here&gt;\n  FROM \"table\"\n) \"table\"\nORDER BY \"table\".\"bar\" ASC;\n</pre>\n<p>The above however is not supported by vanilla Django ORM.\nYou can of course use raw SQL queries however that is not desired since\nthen you loose all of the ORM power (e.g. pagination, etc).</p>\n<p>One hack to still use ORM and yet use subquery is use Django ORM\nto construct inner query and then manually add outer query:</p>\n<pre>query = Model.objects.filter(...).distinct(...).query\nsql, params = query.sql_with_params()\nModel.objects.raw(\n    'SELECT * FROM ({}) \"table\" ORDER BY \"table\".\"foo\"'.format(sql),\n    params\n)\n</pre>\n<p>This approach however is also not desired since due to:</p>\n<ul>\n<li>not able to use <tt>select_related()</tt> when related table\nhas similar column name(s)</li>\n<li>still difficult to do pagination</li>\n<li>more logic required to be able to do <tt>.count()</tt></li>\n</ul>\n</div>\n<div id=\"solution\">\n<h2>Solution</h2>\n<p>As you saw above, currently it is difficult to use sub-queries in Django\nhowever conceptually the solution is pretty simply since we should be able\nto simply wrap SQL generated by Django ORM within an outer query.\nThis is exactly what this library does. It hooks up directly into Django\u2019s\n<tt>as_sql()</tt> ORM method which is responsible for generating SQL and adds\nouter query when necessary conditions are met.</p>\n</div>\n<div id=\"installing\">\n<h2>Installing</h2>\n<p>You can install <tt><span class=\"pre\">django-sub-query</span></tt> using pip:</p>\n<pre>$ pip install django-sub-query\n</pre>\n</div>\n<div id=\"using\">\n<h2>Using</h2>\n<p>Since this library changes a few bits in inner-workings in Django ORM,\nthere is no simple way to use this library other then completely change\ndatabase engine:</p>\n<pre>DATABASES = {\n    'default': {\n        'ENGINE': 'sub_query.db.backends.postgis',\n        ...\n    },\n}\n</pre>\n<p>Currently only <tt>postgis</tt> backend is supported however please feel free to\nopen an issue to add support for other backends (or contribute implementation!).</p>\n<p>Once the database engine is changed, then you have to make sure the\nqueryset you are using is a subclass of <tt>SubQueryGeoQuerySet</tt>:</p>\n<pre>class ExampleModel(models.Model):\n    ...\n    objects = SubQueryGeoQuerySet.as_manager()\n</pre>\n</div>\n<div id=\"testing\">\n<h2>Testing</h2>\n<p>To run the tests you need to install testing requirements first:</p>\n<pre>$ make install\n</pre>\n<p>Then to run tests, you can use <tt>manage.py</tt> or simply use Makefile command:</p>\n<pre>$ python manage.py test\n# or\n$ make test\n</pre>\n</div>\n<div id=\"history\">\n<h2>History</h2>\n<h2 id=\"id1\"><span class=\"section-subtitle\">0.1.0 (2015-01-25)</span></h2>\n<ul>\n<li>First release on PyPI.</li>\n</ul>\n</div>\n<div id=\"credits\">\n<h2>Credits</h2>\n<div id=\"development-lead\">\n<h3>Development Lead</h3>\n<ul>\n<li>Miroslav Shubernetskiy  - <a href=\"https://github.com/miki725\" rel=\"nofollow\">https://github.com/miki725</a></li>\n</ul>\n</div>\n<div id=\"contributors\">\n<h3>Contributors</h3>\n<p>None yet. Why not be the first?</p>\n</div>\n</div>\n<div id=\"license\">\n<h2>License</h2>\n<p>The MIT License (MIT)</p>\n<p>Copyright (c) 2015, Miroslav Shubernetskiy</p>\n<p>Permission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \u201cSoftware\u201d), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:</p>\n<p>The above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.</p>\n<p>THE SOFTWARE IS PROVIDED \u201cAS IS\u201d, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.</p>\n</div>\n\n          </div>"}, "last_serial": 1396157, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "3e71b565a88e9922cf799dcefc150802", "sha256": "1fcc95fe2fd761045c490c9b364e4a26727ba6cee59e64b2454c13e957d5777f"}, "downloads": -1, "filename": "django-sub-query-0.1.tar.gz", "has_sig": false, "md5_digest": "3e71b565a88e9922cf799dcefc150802", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 16960, "upload_time": "2015-01-25T23:22:20", "upload_time_iso_8601": "2015-01-25T23:22:20.321527Z", "url": "https://files.pythonhosted.org/packages/12/55/3eb7e4d6c5be42c6467961931ca995aa45045de7fad36ac7ff4414a0525f/django-sub-query-0.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "3e71b565a88e9922cf799dcefc150802", "sha256": "1fcc95fe2fd761045c490c9b364e4a26727ba6cee59e64b2454c13e957d5777f"}, "downloads": -1, "filename": "django-sub-query-0.1.tar.gz", "has_sig": false, "md5_digest": "3e71b565a88e9922cf799dcefc150802", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 16960, "upload_time": "2015-01-25T23:22:20", "upload_time_iso_8601": "2015-01-25T23:22:20.321527Z", "url": "https://files.pythonhosted.org/packages/12/55/3eb7e4d6c5be42c6467961931ca995aa45045de7fad36ac7ff4414a0525f/django-sub-query-0.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:52:49 2020"}