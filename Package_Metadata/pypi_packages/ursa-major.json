{"info": {"author": "The Factory 2.0 Team", "author_email": "ursa-major-owner@fedoraproject.org", "bugtrack_url": null, "classifiers": ["Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3.6", "Topic :: Utilities"], "description": "Ursa-Major\n==========\n\n.. image:: https://img.shields.io/pypi/v/ursa-major.svg\n   :alt: PyPI\n\n.. image:: https://img.shields.io/pypi/l/ursa-major.svg\n   :alt: PyPI - License\n\n.. image:: https://img.shields.io/pypi/pyversions/ursa-major.svg\n   :alt: PyPI - Python Version\n\nUrsa-Major is a utility to help managing module's koji tags in koji's\ninheritance. It reads configuration for tags from a tag config file, then\nupdate koji's inheritance accordingly.\n\nTag Config File\n---------------\n\nThe tag config file used by Ursa-Major is in json format, the top level keys\nare koji tags which we should add module tags into their inheritance. For each\ntag, it contains a list of modules, owners can also be set for a tag.\n\nAn example tag config file is:\n\n.. code-block:: json\n\n    {\n        \"fedora-30-buildroot-modules\": {\n            \"modules\": [\n                {\n                    \"name\": \"httpd\",\n                    \"priority\": 10,\n                    \"buildrequires\": {\n                        \"platform\": \"f30\"\n                    },\n                    \"requires\": {\n                        \"platform\": \"f30\"\n                    },\n                    \"stream\": \"2.4\"\n                },\n                {\n                    \"name\": \"ruby\",\n                    \"priority\": 40,\n                    \"requires\": {\n                        \"platform\": \"f30\"\n                    },\n                    \"stream\": \"2.5\"\n                }\n            ],\n            \"owners\": [\n                \"foo@example.com\"\n            ]\n        },\n        \"fedora-30-test-build\": {\n            \"modules\": [\n                {\n                    \"name\": \"testmodule\",\n                    \"priority\": 150,\n                    \"stream\": \"f30\"\n                }\n            ],\n            \"owners\": [\n                \"bar@example.com\"\n            ]\n        }\n    }\n\n\nA valid module config should contains:\n\n* ``name`` (required): module name\n* ``stream`` (required): module stream\n* ``priority`` (required): add module's tag to tag inheritance with this priority\n* ``requires`` (optional): module's runtime dependencies.\n* ``buildrequires`` (optional): module's build time dependencies.\n\nFor each tag, ``owners`` can be set with email addresses.\n\nThe default tag config file used by Ursa-Major is ``ursa-major.json`` in current\nworking directory. You can change it with ``--tag-config-file``.\n\n\nKoji and MBS\n------------\n\nTags in tag config file are koji tags, Ursa-Major connects to koji hub and\nupdate tag inheritance per config, and connects to MBS to query module's\ninformation, especially the modulemd data.\n\nKoji and MBS servers are set in Ursa-Major's config files, the global config\nfile is ``/etc/ursa-major/ursa-major`` by default, and can be changed by\n``--config`` argument. The user config file is\n``~/.config/ursa-major/ursa-major.conf``, and can be changed by\n``--user-config``. User config file is optional, and values in global config\nfile will be overrided by user config file.\n\nAn example config file:\n\n.. code-block:: bash\n\n    $ cat /etc/ursa-major/ursa-major.conf\n\n    [main]\n    # See https://docs.python.org/3/library/logging.html#logging-levels\n    log_level = info\n\n    [koji]\n    profile = koji\n\n    [mbs]\n    server_url = https://mbs.fedoraproject.org/\n\n    [mail]\n    mail_processing = true\n    mail_log_level = info\n    mail_server = smtp.example.com\n    mail_from = ursa-major@example.com\n    mail_replyto = ursa-major@example.com\n    # email addresses seperated by ','\n    mail_always_cc = ursa-major-admin@example.com\n    mail_always_bcc =\n    mail_subject_prefix = [ursa-major]\n\n\nSub Commands\n============\n\nGlobal arguments of ``ursa-major``:\n\n* ``--debug`` (optional): print debug messages\n\n* ``--dry-run`` (optional): run in dry-run mode, not do any real change\n\n* ``--config`` (optional): default if ``/etc/ursa-major/ursa-major.conf``\n\n* ``--user-config`` (optional): default is ``~/.config/ursa-major/ursa-major.conf``\n\n* ``--tag-config-file`` (optional): default is ``$PWD/ursa-major.json``\n\n\nshow-config\n-----------\n\nThis just show the content of tag config file, or the content of a specified\ntag.\n\nArguments:\n\n* ``--tag`` (optional): only show config content under this tag\n\nExample:\n\n.. code-block:: bash\n\n    $ ursa-major show-config --tag-config-file ~/fedora-prod-ursa-major.json --tag fedora-30-test-build\n\ncheck-config\n------------\n\nCheck the tag config file to detect any invalid configuration:\n\n.. code-block:: bash\n\n    $ ursa-major check-config --tag-config-file ~/fedora-prod-ursa-major.json\n\nChecks include:\n\n* ``name``, ``stream`` and ``priority`` are required for a module\n* ``priority`` value should not conflict with other parent tags which not belong\n  to this module in tag's inheritance\n* ...\n\nremove-module\n-------------\n\nRemove a module from the tag config file.\n\nArguments:\n\n* ``--tag`` (required): remove module from this tag\n\n* ``--name`` (required): module name\n\n* ``--stream`` (required): module stream\n\n* ``--require`` (optional): module's runtime requires, can be specified multiple times\n\n* ``--buildrequire`` (optional): module's buildrequires, can be specified multiple times\n\n\nExample:\n\n.. code-block:: bash\n\n    $ ursa-major remove-module --tag fedora-30-test-build --name testmodule --stream f30\n\nThis will remove the module of ``testmodule:f30`` from tag config file if it's\ns present under tag ``fedora-30-test-build``.\n\nadd-module\n----------\n\nAdd a module to tag config file under the specified tag.\n\nArguments:\n\n* ``--tag`` (required): add module to this tag\n\n* ``--name`` (required): module name\n\n* ``--stream`` (required): module stream\n\n* ``--priority`` (required): priority value when add tag to inheritance\n\n* ``--require`` (optional): module's runtime requires, can be specified multiple times\n\n* ``--buildrequire`` (optional): module's buildrequires, can be specified multiple times\n\nExample:\n\n.. code-block:: bash\n\n    $ ursa-major add-module --tag fedora-30-test-build --name testmodule --stream f30 --priority 100\n\nIf the specified module with that ``name`` and ``stream`` already exists in tag\nconfig file, Ursa-Major will check whether ``requires`` or ``priority`` is\ndifferent from the value specified in command line, if true, the tag config\nfile will be updated to use the values specified.\n\nupdate-tag\n----------\n\nUpdate a tag's inheritance data with all latest module build tags of the\nmodules in tag's config.\n\nArguments:\n\n* ``--tag`` (required): the tag to update\n* ``--wait-regen-repo`` (optional): wait for regen-repo task to finish\n\nExample:\n\n.. code-block:: bash\n\n    $ ursa-major update-tag --tag fedora-30-test-build --wait-regen-repo\n\nThis will check the latest builds in MBS for all modules in config of tag\n'fedora-30-test-build', if there is any build's tag is missing from tag's\ninheritance data, the tag will be added into inheritance, and old tags\nwill be removed at the same time for the module.\n\nadd-tag\n-------\n\nReads module state change message from an environment variable and then add\nthe module's koji tag tag inheritance according to tag config file if the\nmodule build state is 'ready', and remove old tags of the module at the same\ntime. The module's state change message is generated by MBS.\n\nArguments:\n\n* ``--module-from-env`` (optional): the environment variable Ursa-Major read the\n  module state change message from, by default it's ``CI_MESSAGE``\n\n* ``--wait-regen-repo`` (optinal): wait for regen-repo tasks to finish, default is ``False``\n\n* ``--send-mail`` (optional): send mail to tag owners, default is ``False``\n\nExample:\n\n.. code-block:: bash\n\n    $ cat $CI_MESSAGE\n    {\n      \"state_reason\": null,\n      \"component_builds\": [\n        108146,\n        108145\n      ],\n      \"name\": \"testmodule\",\n      \"stream\": \"master\",\n      \"time_submitted\": \"2018-10-26T16:59:06Z\",\n      \"version\": \"20181026165847\",\n      \"time_modified\": \"2018-10-26T16:59:27Z\",\n      \"state_name\": \"ready\",\n      \"scmurl\": \"https://src.fedoraproject.org/modules/testmodule.git?#3f262deef9d79160ea229142aeb51eedcc956929\",\n      \"state\": 5,\n      \"time_completed\": \"2018-10-26T16:59:15Z\",\n      \"koji_tag\": \"module-testmodule-master-20181026165847-a5b0195c\",\n      \"context\": \"a5b0195c\",\n      \"owner\": \"foobar\",\n      \"siblings\": [],\n      \"id\": 2321,\n      \"rebuild_strategy\": \"only-changed\"\n    }\n\n    $ cat $PWD/ursa-major.json\n    {\n        \"fedora-30-test-build\": {\n            \"modules\": [\n                {\n                    \"name\": \"testmodule\",\n                    \"priority\": 150,\n                    \"stream\": \"master\"\n                }\n            ],\n            \"owners\": [\n                \"foobar@example.com\"\n            ]\n        }\n    }\n\n    $ ursa-major add-tag --wait-regen-repo --send-mail\n\nIn this example, Ursa-Major reads the module state change message from\nenviroment variable ``CI_MESSAGE``, the module build state name is \"ready\" and\nmodule is present under a tag \"fedora-30-test-build\" in tag config file.\nUrsa-Major will add the koji tag \"module-testmodule-master-20181026165847-a5b0195c\"\ninto \"fedora-30-test-build\"'s inheritance, and then regen-repo for build tags\nin \"fedora-30-test-build\"'s inheritance.\n\nWhen a tag is added to tag inheritance, Ursa-Major also submit ``regen-repo``\ntasks for the build tags in inheritance data. If the specified tag is a build\ntag, it's the only one build tag Ursa-Major will regen-repo for. Or Ursa-Major\nwill check the tag's inheritance data, if it reaches the first build tag in\neach inheritant path, it returns that build tag. And it stops at any tag that\nname starts with 'module-'.\n\nFor example, if we have tag inheritance data as below (tags with\n'*' marks are build tags):\n\nExample #1:\n\n::\n\n        my-example-tag\n          \u2514\u2500product-foo-temp-override\n             \u2514\u2500product-foo-override\n                \u2514\u2500product-foo-build (*)\n                   \u251c\u2500tmp-product-foo-build (*)\n                   \u2514\u2500alt-product-foo-build (*)\n\nIn this case, there is one build tag found for 'my-example-tag', it is:\n``product-foo-build``. Ursa-Major stops at 'product-foo-build', so\n'tmp-product-foo-build' and 'alt-product-foo-build' are not checked at all.\n\nExample #2:\n\n::\n\n    my-example-tag\n      \u251c\u2500module-345678-build\n      \u251c\u2500module-234567-build\n      \u251c\u2500module-123456-build\n      \u2502  \u2514\u2500product-foo-module-hotfix\n      \u2502     \u2514\u2500product-foo-module-hotfix-build (*)\n      \u251c\u2500tmp-product-foo-python-candidate\n      \u2502  \u2514\u2500tmp-product-foo-python-override\n      \u2502     \u2514\u2500tmp-product-foo-python-build (*)\n      \u251c\u2500product-foo-container-build (*)\n      \u2514\u2500product-foo-temp-override\n         \u2514\u2500product-foo-override\n            \u2514\u2500product-foo-build (*)\n               \u251c\u2500tmp-product-foo-build (*)\n               \u2514\u2500alt-product-foo-build (*)\n\nIn this case, there are 3 build tags found for ``my-example-tag``, they are:\n``tmp-product-foo-python-build``, ``product-foo-container-build`` and\n``product-foo-build``. ``product-foo-module-hotfix-build`` is a build tag, but\nUrsa-Major doesn't count it in, because it stops at tag 'module-123456-build'\nwhich name starts with 'module-'.\n\nUrsa-Major will send mail to tag owners if run with \"--send-mail\", mail\nconfiguration can be configured in global config file or user config file,\nunder the section of \"mail\".\n\n\nChange Logs\n===========\n0.4.1 (2020-02-11)\n------------------\n* Remove updating koji inheritance ability from add-module and remove-module (Qixiang Wan)\n\n0.3.3 (2019-08-23)\n------------------\n* Add new sub command update-tag (Qixiang Wan)\n\n0.3.2 (2019-06-26)\n------------------\n* Include garbaged module builds while checking existing module build tags (Qixiang Wan)\n* Refactor get_modules (Qixiang Wan)\n\n0.3.1 (2019-05-21)\n------------------\n\n* Not check requires/buildrequires for existing koji tags (Qixiang Wan)\n* Updating existing inheritance instead of removing and adding (Qixiang Wan)\n\n0.2.2 (2019-03-26)\n------------------\n\n* For adding tag, allow filtering on buildrequires to find out koji_tags from\n  tag inheritance (Chenxiong Qi)\n\n0.2.1 (2019-03-20)\n------------------\n\n* Make setup_method/teardown_method compatible with newer version of pytest (Chenxiong Qi)\n* Add missing file CHANGELOG.rst to sdist package (Chenxiong Qi)\n\n0.2.0 (2019-03-20)\n------------------\n\n* Add tests for AddModuleHandler methods (Chenxiong Qi)\n* Avoid long modulemd embedded into fake data for tests (Chenxiong Qi)\n* Fixes according to review comments (Chenxiong Qi)\n* Command check-config supports filtering modules on buildrequires (Chenxiong Qi)\n* Command add-module supports buildrequires now (Chenxiong Qi)\n* Command remove-module supports filtering modules on buildrequires (Chenxiong Qi)\n* Allow passing buildrequires to MBS.get_modules_with_requires (Chenxiong Qi)\n* Reword remove-module help and --tag option help text (Chenxiong Qi)\n* Allow filtering on buildrequires (Chenxiong Qi)", "description_content_type": "", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://pagure.io/ursa-major/", "keywords": "ursa-major modularity koji fedora", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "ursa-major", "package_url": "https://pypi.org/project/ursa-major/", "platform": "", "project_url": "https://pypi.org/project/ursa-major/", "project_urls": {"Homepage": "https://pagure.io/ursa-major/"}, "release_url": "https://pypi.org/project/ursa-major/0.4.1/", "requires_dist": null, "requires_python": "", "summary": "A utility for managing module tags in Koji's tag inheritance", "version": "0.4.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <div id=\"ursa-major\">\n<h2>Ursa-Major</h2>\n<img alt=\"PyPI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/273b04b0a6dd1b7ad9599dea7330f603a51a2a82/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f757273612d6d616a6f722e737667\">\n<img alt=\"PyPI - License\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/2911a3178f156d62ca40a0306450cc17d1cd7857/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f757273612d6d616a6f722e737667\">\n<img alt=\"PyPI - Python Version\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/6b8006e7f84c2009ebabf6db7cc871e36840396d/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f757273612d6d616a6f722e737667\">\n<p>Ursa-Major is a utility to help managing module\u2019s koji tags in koji\u2019s\ninheritance. It reads configuration for tags from a tag config file, then\nupdate koji\u2019s inheritance accordingly.</p>\n<div id=\"tag-config-file\">\n<h3>Tag Config File</h3>\n<p>The tag config file used by Ursa-Major is in json format, the top level keys\nare koji tags which we should add module tags into their inheritance. For each\ntag, it contains a list of modules, owners can also be set for a tag.</p>\n<p>An example tag config file is:</p>\n<pre><span class=\"p\">{</span>\n    <span class=\"nt\">\"fedora-30-buildroot-modules\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">\"modules\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"p\">{</span>\n                <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"httpd\"</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"priority\"</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"buildrequires\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                    <span class=\"nt\">\"platform\"</span><span class=\"p\">:</span> <span class=\"s2\">\"f30\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"nt\">\"requires\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                    <span class=\"nt\">\"platform\"</span><span class=\"p\">:</span> <span class=\"s2\">\"f30\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"nt\">\"stream\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2.4\"</span>\n            <span class=\"p\">},</span>\n            <span class=\"p\">{</span>\n                <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"ruby\"</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"priority\"</span><span class=\"p\">:</span> <span class=\"mi\">40</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"requires\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                    <span class=\"nt\">\"platform\"</span><span class=\"p\">:</span> <span class=\"s2\">\"f30\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"nt\">\"stream\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2.5\"</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">],</span>\n        <span class=\"nt\">\"owners\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"s2\">\"foo@example.com\"</span>\n        <span class=\"p\">]</span>\n    <span class=\"p\">},</span>\n    <span class=\"nt\">\"fedora-30-test-build\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">\"modules\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"p\">{</span>\n                <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"testmodule\"</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"priority\"</span><span class=\"p\">:</span> <span class=\"mi\">150</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"stream\"</span><span class=\"p\">:</span> <span class=\"s2\">\"f30\"</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">],</span>\n        <span class=\"nt\">\"owners\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"s2\">\"bar@example.com\"</span>\n        <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</pre>\n<p>A valid module config should contains:</p>\n<ul>\n<li><tt>name</tt> (required): module name</li>\n<li><tt>stream</tt> (required): module stream</li>\n<li><tt>priority</tt> (required): add module\u2019s tag to tag inheritance with this priority</li>\n<li><tt>requires</tt> (optional): module\u2019s runtime dependencies.</li>\n<li><tt>buildrequires</tt> (optional): module\u2019s build time dependencies.</li>\n</ul>\n<p>For each tag, <tt>owners</tt> can be set with email addresses.</p>\n<p>The default tag config file used by Ursa-Major is <tt><span class=\"pre\">ursa-major.json</span></tt> in current\nworking directory. You can change it with <tt><span class=\"pre\">--tag-config-file</span></tt>.</p>\n</div>\n<div id=\"koji-and-mbs\">\n<h3>Koji and MBS</h3>\n<p>Tags in tag config file are koji tags, Ursa-Major connects to koji hub and\nupdate tag inheritance per config, and connects to MBS to query module\u2019s\ninformation, especially the modulemd data.</p>\n<p>Koji and MBS servers are set in Ursa-Major\u2019s config files, the global config\nfile is <tt><span class=\"pre\">/etc/ursa-major/ursa-major</span></tt> by default, and can be changed by\n<tt><span class=\"pre\">--config</span></tt> argument. The user config file is\n<tt><span class=\"pre\">~/.config/ursa-major/ursa-major.conf</span></tt>, and can be changed by\n<tt><span class=\"pre\">--user-config</span></tt>. User config file is optional, and values in global config\nfile will be overrided by user config file.</p>\n<p>An example config file:</p>\n<pre>$ cat /etc/ursa-major/ursa-major.conf\n\n<span class=\"o\">[</span>main<span class=\"o\">]</span>\n<span class=\"c1\"># See https://docs.python.org/3/library/logging.html#logging-levels\n</span><span class=\"nv\">log_level</span> <span class=\"o\">=</span> info\n\n<span class=\"o\">[</span>koji<span class=\"o\">]</span>\n<span class=\"nv\">profile</span> <span class=\"o\">=</span> koji\n\n<span class=\"o\">[</span>mbs<span class=\"o\">]</span>\n<span class=\"nv\">server_url</span> <span class=\"o\">=</span> https://mbs.fedoraproject.org/\n\n<span class=\"o\">[</span>mail<span class=\"o\">]</span>\n<span class=\"nv\">mail_processing</span> <span class=\"o\">=</span> <span class=\"nb\">true</span>\n<span class=\"nv\">mail_log_level</span> <span class=\"o\">=</span> info\n<span class=\"nv\">mail_server</span> <span class=\"o\">=</span> smtp.example.com\n<span class=\"nv\">mail_from</span> <span class=\"o\">=</span> ursa-major@example.com\n<span class=\"nv\">mail_replyto</span> <span class=\"o\">=</span> ursa-major@example.com\n<span class=\"c1\"># email addresses seperated by ','\n</span><span class=\"nv\">mail_always_cc</span> <span class=\"o\">=</span> ursa-major-admin@example.com\n<span class=\"nv\">mail_always_bcc</span> <span class=\"o\">=</span>\n<span class=\"nv\">mail_subject_prefix</span> <span class=\"o\">=</span> <span class=\"o\">[</span>ursa-major<span class=\"o\">]</span>\n</pre>\n</div>\n</div>\n<div id=\"sub-commands\">\n<h2>Sub Commands</h2>\n<p>Global arguments of <tt><span class=\"pre\">ursa-major</span></tt>:</p>\n<ul>\n<li><tt><span class=\"pre\">--debug</span></tt> (optional): print debug messages</li>\n<li><tt><span class=\"pre\">--dry-run</span></tt> (optional): run in dry-run mode, not do any real change</li>\n<li><tt><span class=\"pre\">--config</span></tt> (optional): default if <tt><span class=\"pre\">/etc/ursa-major/ursa-major.conf</span></tt></li>\n<li><tt><span class=\"pre\">--user-config</span></tt> (optional): default is <tt><span class=\"pre\">~/.config/ursa-major/ursa-major.conf</span></tt></li>\n<li><tt><span class=\"pre\">--tag-config-file</span></tt> (optional): default is <tt><span class=\"pre\">$PWD/ursa-major.json</span></tt></li>\n</ul>\n<div id=\"show-config\">\n<h3>show-config</h3>\n<p>This just show the content of tag config file, or the content of a specified\ntag.</p>\n<p>Arguments:</p>\n<ul>\n<li><tt><span class=\"pre\">--tag</span></tt> (optional): only show config content under this tag</li>\n</ul>\n<p>Example:</p>\n<pre>$ ursa-major show-config --tag-config-file ~/fedora-prod-ursa-major.json --tag fedora-30-test-build\n</pre>\n</div>\n<div id=\"check-config\">\n<h3>check-config</h3>\n<p>Check the tag config file to detect any invalid configuration:</p>\n<pre>$ ursa-major check-config --tag-config-file ~/fedora-prod-ursa-major.json\n</pre>\n<p>Checks include:</p>\n<ul>\n<li><tt>name</tt>, <tt>stream</tt> and <tt>priority</tt> are required for a module</li>\n<li><tt>priority</tt> value should not conflict with other parent tags which not belong\nto this module in tag\u2019s inheritance</li>\n<li>\u2026</li>\n</ul>\n</div>\n<div id=\"remove-module\">\n<h3>remove-module</h3>\n<p>Remove a module from the tag config file.</p>\n<p>Arguments:</p>\n<ul>\n<li><tt><span class=\"pre\">--tag</span></tt> (required): remove module from this tag</li>\n<li><tt><span class=\"pre\">--name</span></tt> (required): module name</li>\n<li><tt><span class=\"pre\">--stream</span></tt> (required): module stream</li>\n<li><tt><span class=\"pre\">--require</span></tt> (optional): module\u2019s runtime requires, can be specified multiple times</li>\n<li><tt><span class=\"pre\">--buildrequire</span></tt> (optional): module\u2019s buildrequires, can be specified multiple times</li>\n</ul>\n<p>Example:</p>\n<pre>$ ursa-major remove-module --tag fedora-30-test-build --name testmodule --stream f30\n</pre>\n<p>This will remove the module of <tt>testmodule:f30</tt> from tag config file if it\u2019s\ns present under tag <tt><span class=\"pre\">fedora-30-test-build</span></tt>.</p>\n</div>\n<div id=\"add-module\">\n<h3>add-module</h3>\n<p>Add a module to tag config file under the specified tag.</p>\n<p>Arguments:</p>\n<ul>\n<li><tt><span class=\"pre\">--tag</span></tt> (required): add module to this tag</li>\n<li><tt><span class=\"pre\">--name</span></tt> (required): module name</li>\n<li><tt><span class=\"pre\">--stream</span></tt> (required): module stream</li>\n<li><tt><span class=\"pre\">--priority</span></tt> (required): priority value when add tag to inheritance</li>\n<li><tt><span class=\"pre\">--require</span></tt> (optional): module\u2019s runtime requires, can be specified multiple times</li>\n<li><tt><span class=\"pre\">--buildrequire</span></tt> (optional): module\u2019s buildrequires, can be specified multiple times</li>\n</ul>\n<p>Example:</p>\n<pre>$ ursa-major add-module --tag fedora-30-test-build --name testmodule --stream f30 --priority <span class=\"m\">100</span>\n</pre>\n<p>If the specified module with that <tt>name</tt> and <tt>stream</tt> already exists in tag\nconfig file, Ursa-Major will check whether <tt>requires</tt> or <tt>priority</tt> is\ndifferent from the value specified in command line, if true, the tag config\nfile will be updated to use the values specified.</p>\n</div>\n<div id=\"update-tag\">\n<h3>update-tag</h3>\n<p>Update a tag\u2019s inheritance data with all latest module build tags of the\nmodules in tag\u2019s config.</p>\n<p>Arguments:</p>\n<ul>\n<li><tt><span class=\"pre\">--tag</span></tt> (required): the tag to update</li>\n<li><tt><span class=\"pre\">--wait-regen-repo</span></tt> (optional): wait for regen-repo task to finish</li>\n</ul>\n<p>Example:</p>\n<pre>$ ursa-major update-tag --tag fedora-30-test-build --wait-regen-repo\n</pre>\n<p>This will check the latest builds in MBS for all modules in config of tag\n\u2018fedora-30-test-build\u2019, if there is any build\u2019s tag is missing from tag\u2019s\ninheritance data, the tag will be added into inheritance, and old tags\nwill be removed at the same time for the module.</p>\n</div>\n<div id=\"add-tag\">\n<h3>add-tag</h3>\n<p>Reads module state change message from an environment variable and then add\nthe module\u2019s koji tag tag inheritance according to tag config file if the\nmodule build state is \u2018ready\u2019, and remove old tags of the module at the same\ntime. The module\u2019s state change message is generated by MBS.</p>\n<p>Arguments:</p>\n<ul>\n<li><tt><span class=\"pre\">--module-from-env</span></tt> (optional): the environment variable Ursa-Major read the\nmodule state change message from, by default it\u2019s <tt>CI_MESSAGE</tt></li>\n<li><tt><span class=\"pre\">--wait-regen-repo</span></tt> (optinal): wait for regen-repo tasks to finish, default is <tt>False</tt></li>\n<li><tt><span class=\"pre\">--send-mail</span></tt> (optional): send mail to tag owners, default is <tt>False</tt></li>\n</ul>\n<p>Example:</p>\n<pre>$ cat <span class=\"nv\">$CI_MESSAGE</span>\n<span class=\"o\">{</span>\n  <span class=\"s2\">\"state_reason\"</span>: null,\n  <span class=\"s2\">\"component_builds\"</span>: <span class=\"o\">[</span>\n    <span class=\"m\">108146</span>,\n    <span class=\"m\">108145</span>\n  <span class=\"o\">]</span>,\n  <span class=\"s2\">\"name\"</span>: <span class=\"s2\">\"testmodule\"</span>,\n  <span class=\"s2\">\"stream\"</span>: <span class=\"s2\">\"master\"</span>,\n  <span class=\"s2\">\"time_submitted\"</span>: <span class=\"s2\">\"2018-10-26T16:59:06Z\"</span>,\n  <span class=\"s2\">\"version\"</span>: <span class=\"s2\">\"20181026165847\"</span>,\n  <span class=\"s2\">\"time_modified\"</span>: <span class=\"s2\">\"2018-10-26T16:59:27Z\"</span>,\n  <span class=\"s2\">\"state_name\"</span>: <span class=\"s2\">\"ready\"</span>,\n  <span class=\"s2\">\"scmurl\"</span>: <span class=\"s2\">\"https://src.fedoraproject.org/modules/testmodule.git?#3f262deef9d79160ea229142aeb51eedcc956929\"</span>,\n  <span class=\"s2\">\"state\"</span>: <span class=\"m\">5</span>,\n  <span class=\"s2\">\"time_completed\"</span>: <span class=\"s2\">\"2018-10-26T16:59:15Z\"</span>,\n  <span class=\"s2\">\"koji_tag\"</span>: <span class=\"s2\">\"module-testmodule-master-20181026165847-a5b0195c\"</span>,\n  <span class=\"s2\">\"context\"</span>: <span class=\"s2\">\"a5b0195c\"</span>,\n  <span class=\"s2\">\"owner\"</span>: <span class=\"s2\">\"foobar\"</span>,\n  <span class=\"s2\">\"siblings\"</span>: <span class=\"o\">[]</span>,\n  <span class=\"s2\">\"id\"</span>: <span class=\"m\">2321</span>,\n  <span class=\"s2\">\"rebuild_strategy\"</span>: <span class=\"s2\">\"only-changed\"</span>\n<span class=\"o\">}</span>\n\n$ cat <span class=\"nv\">$PWD</span>/ursa-major.json\n<span class=\"o\">{</span>\n    <span class=\"s2\">\"fedora-30-test-build\"</span>: <span class=\"o\">{</span>\n        <span class=\"s2\">\"modules\"</span>: <span class=\"o\">[</span>\n            <span class=\"o\">{</span>\n                <span class=\"s2\">\"name\"</span>: <span class=\"s2\">\"testmodule\"</span>,\n                <span class=\"s2\">\"priority\"</span>: <span class=\"m\">150</span>,\n                <span class=\"s2\">\"stream\"</span>: <span class=\"s2\">\"master\"</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">]</span>,\n        <span class=\"s2\">\"owners\"</span>: <span class=\"o\">[</span>\n            <span class=\"s2\">\"foobar@example.com\"</span>\n        <span class=\"o\">]</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n$ ursa-major add-tag --wait-regen-repo --send-mail\n</pre>\n<p>In this example, Ursa-Major reads the module state change message from\nenviroment variable <tt>CI_MESSAGE</tt>, the module build state name is \u201cready\u201d and\nmodule is present under a tag \u201cfedora-30-test-build\u201d in tag config file.\nUrsa-Major will add the koji tag \u201cmodule-testmodule-master-20181026165847-a5b0195c\u201d\ninto \u201cfedora-30-test-build\u201c\u2018s inheritance, and then regen-repo for build tags\nin \u201cfedora-30-test-build\u201c\u2018s inheritance.</p>\n<p>When a tag is added to tag inheritance, Ursa-Major also submit <tt><span class=\"pre\">regen-repo</span></tt>\ntasks for the build tags in inheritance data. If the specified tag is a build\ntag, it\u2019s the only one build tag Ursa-Major will regen-repo for. Or Ursa-Major\nwill check the tag\u2019s inheritance data, if it reaches the first build tag in\neach inheritant path, it returns that build tag. And it stops at any tag that\nname starts with \u2018module-\u2018.</p>\n<p>For example, if we have tag inheritance data as below (tags with\n\u2018*\u2019 marks are build tags):</p>\n<p>Example #1:</p>\n<pre>my-example-tag\n  \u2514\u2500product-foo-temp-override\n     \u2514\u2500product-foo-override\n        \u2514\u2500product-foo-build (*)\n           \u251c\u2500tmp-product-foo-build (*)\n           \u2514\u2500alt-product-foo-build (*)\n</pre>\n<p>In this case, there is one build tag found for \u2018my-example-tag\u2019, it is:\n<tt><span class=\"pre\">product-foo-build</span></tt>. Ursa-Major stops at \u2018product-foo-build\u2019, so\n\u2018tmp-product-foo-build\u2019 and \u2018alt-product-foo-build\u2019 are not checked at all.</p>\n<p>Example #2:</p>\n<pre>my-example-tag\n  \u251c\u2500module-345678-build\n  \u251c\u2500module-234567-build\n  \u251c\u2500module-123456-build\n  \u2502  \u2514\u2500product-foo-module-hotfix\n  \u2502     \u2514\u2500product-foo-module-hotfix-build (*)\n  \u251c\u2500tmp-product-foo-python-candidate\n  \u2502  \u2514\u2500tmp-product-foo-python-override\n  \u2502     \u2514\u2500tmp-product-foo-python-build (*)\n  \u251c\u2500product-foo-container-build (*)\n  \u2514\u2500product-foo-temp-override\n     \u2514\u2500product-foo-override\n        \u2514\u2500product-foo-build (*)\n           \u251c\u2500tmp-product-foo-build (*)\n           \u2514\u2500alt-product-foo-build (*)\n</pre>\n<p>In this case, there are 3 build tags found for <tt><span class=\"pre\">my-example-tag</span></tt>, they are:\n<tt><span class=\"pre\">tmp-product-foo-python-build</span></tt>, <tt><span class=\"pre\">product-foo-container-build</span></tt> and\n<tt><span class=\"pre\">product-foo-build</span></tt>. <tt><span class=\"pre\">product-foo-module-hotfix-build</span></tt> is a build tag, but\nUrsa-Major doesn\u2019t count it in, because it stops at tag \u2018module-123456-build\u2019\nwhich name starts with \u2018module-\u2018.</p>\n<p>Ursa-Major will send mail to tag owners if run with \u201c\u2013send-mail\u201d, mail\nconfiguration can be configured in global config file or user config file,\nunder the section of \u201cmail\u201d.</p>\n</div>\n</div>\n<div id=\"change-logs\">\n<h2>Change Logs</h2>\n<div id=\"id1\">\n<h3>0.4.1 (2020-02-11)</h3>\n<ul>\n<li>Remove updating koji inheritance ability from add-module and remove-module (Qixiang Wan)</li>\n</ul>\n</div>\n<div id=\"id2\">\n<h3>0.3.3 (2019-08-23)</h3>\n<ul>\n<li>Add new sub command update-tag (Qixiang Wan)</li>\n</ul>\n</div>\n<div id=\"id3\">\n<h3>0.3.2 (2019-06-26)</h3>\n<ul>\n<li>Include garbaged module builds while checking existing module build tags (Qixiang Wan)</li>\n<li>Refactor get_modules (Qixiang Wan)</li>\n</ul>\n</div>\n<div id=\"id4\">\n<h3>0.3.1 (2019-05-21)</h3>\n<ul>\n<li>Not check requires/buildrequires for existing koji tags (Qixiang Wan)</li>\n<li>Updating existing inheritance instead of removing and adding (Qixiang Wan)</li>\n</ul>\n</div>\n<div id=\"id5\">\n<h3>0.2.2 (2019-03-26)</h3>\n<ul>\n<li>For adding tag, allow filtering on buildrequires to find out koji_tags from\ntag inheritance (Chenxiong Qi)</li>\n</ul>\n</div>\n<div id=\"id6\">\n<h3>0.2.1 (2019-03-20)</h3>\n<ul>\n<li>Make setup_method/teardown_method compatible with newer version of pytest (Chenxiong Qi)</li>\n<li>Add missing file CHANGELOG.rst to sdist package (Chenxiong Qi)</li>\n</ul>\n</div>\n<div id=\"id7\">\n<h3>0.2.0 (2019-03-20)</h3>\n<ul>\n<li>Add tests for AddModuleHandler methods (Chenxiong Qi)</li>\n<li>Avoid long modulemd embedded into fake data for tests (Chenxiong Qi)</li>\n<li>Fixes according to review comments (Chenxiong Qi)</li>\n<li>Command check-config supports filtering modules on buildrequires (Chenxiong Qi)</li>\n<li>Command add-module supports buildrequires now (Chenxiong Qi)</li>\n<li>Command remove-module supports filtering modules on buildrequires (Chenxiong Qi)</li>\n<li>Allow passing buildrequires to MBS.get_modules_with_requires (Chenxiong Qi)</li>\n<li>Reword remove-module help and \u2013tag option help text (Chenxiong Qi)</li>\n<li>Allow filtering on buildrequires (Chenxiong Qi)</li>\n</ul>\n</div>\n</div>\n\n          </div>"}, "last_serial": 6607881, "releases": {"0.1.1": [{"comment_text": "", "digests": {"md5": "e9ae96a7d98f197f292a6780d1ed3a84", "sha256": "ea3506dc3526db93523736b543e09078a1746a75b0fee3dee99214a07be4cb0d"}, "downloads": -1, "filename": "ursa_major-0.1.1-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "e9ae96a7d98f197f292a6780d1ed3a84", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 35893, "upload_time": "2018-10-30T07:37:35", "upload_time_iso_8601": "2018-10-30T07:37:35.763283Z", "url": "https://files.pythonhosted.org/packages/9d/be/e38c87dd72e0881322bd1e9f0882f3576bbc7a4777946e9c9845abed91b8/ursa_major-0.1.1-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "c61a7f98b25c6519eff33c028ea8776e", "sha256": "87affca69d750fb28268977f7d4473cdb76e18cc430caefcb9cdf1df31a86ae1"}, "downloads": -1, "filename": "ursa-major-0.1.1.tar.gz", "has_sig": false, "md5_digest": "c61a7f98b25c6519eff33c028ea8776e", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 44645, "upload_time": "2018-10-30T07:37:38", "upload_time_iso_8601": "2018-10-30T07:37:38.010837Z", "url": "https://files.pythonhosted.org/packages/df/ac/08dc08e7c8332ef5916321455e55f10134405f1aa1f8f20a4f1a7e1c6262/ursa-major-0.1.1.tar.gz", "yanked": false}], "0.2.0": [{"comment_text": "", "digests": {"md5": "9737372264d3a8e634f04420c322ded8", "sha256": "15ad71ac48215f63f84773996ac8022ca59b1aaf44e01497dbe82b5d8d6fd9fd"}, "downloads": -1, "filename": "ursa-major-0.2.0.tar.gz", "has_sig": false, "md5_digest": "9737372264d3a8e634f04420c322ded8", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 54757, "upload_time": "2019-03-20T02:36:19", "upload_time_iso_8601": "2019-03-20T02:36:19.923664Z", "url": "https://files.pythonhosted.org/packages/ce/91/bbb6d4158c59f0fa4af1dcc1efe7519936dbcd9c4fdf1564ba35e30d2884/ursa-major-0.2.0.tar.gz", "yanked": false}], "0.2.1": [{"comment_text": "", "digests": {"md5": "16a520fbedfd2d51815f44cb4219fad3", "sha256": "7615f21f1b9a6d0951f8f26a4b6815cbb173e4397d7ab52be662343fe7879b0c"}, "downloads": -1, "filename": "ursa-major-0.2.1.tar.gz", "has_sig": false, "md5_digest": "16a520fbedfd2d51815f44cb4219fad3", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 54935, "upload_time": "2019-03-20T08:15:20", "upload_time_iso_8601": "2019-03-20T08:15:20.921289Z", "url": "https://files.pythonhosted.org/packages/91/f4/9c6e2eb348497a154a95a203e5fad23833b369856bb61c1e7aafa3035554/ursa-major-0.2.1.tar.gz", "yanked": false}], "0.3.1": [{"comment_text": "", "digests": {"md5": "4485fc607c47a5685f9a00e194b8fa4f", "sha256": "069b621d011a2da0b59d3d7d745a09b83c70c43b0f47054323aa84a839edf95c"}, "downloads": -1, "filename": "ursa-major-0.3.1.tar.gz", "has_sig": false, "md5_digest": "4485fc607c47a5685f9a00e194b8fa4f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 59074, "upload_time": "2019-05-21T08:41:23", "upload_time_iso_8601": "2019-05-21T08:41:23.141999Z", "url": "https://files.pythonhosted.org/packages/5b/18/f40a70510a5f742feb9d21426c671abefc7dec227bbaab29c8877d00f5b9/ursa-major-0.3.1.tar.gz", "yanked": false}], "0.3.2": [{"comment_text": "", "digests": {"md5": "f29f4d5c28b66cf76df85b734415e9d5", "sha256": "6f02e87075b6d83ed39121b173d33c76bfba95c725cd3ddf847e55e4f3ea05d2"}, "downloads": -1, "filename": "ursa-major-0.3.2.tar.gz", "has_sig": false, "md5_digest": "f29f4d5c28b66cf76df85b734415e9d5", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 58702, "upload_time": "2019-06-26T03:11:24", "upload_time_iso_8601": "2019-06-26T03:11:24.980010Z", "url": "https://files.pythonhosted.org/packages/59/0a/3f2d72b82d468257561a1dc290343c33464112e935bd38858bff6e7e50d8/ursa-major-0.3.2.tar.gz", "yanked": false}], "0.3.3": [{"comment_text": "", "digests": {"md5": "68ddaf4004f2b4e4ec542993f16d4d7f", "sha256": "123ebe36019f73481d0d086e2e3e8ecab20da4476fa6bdb98ce73d117b0e5a92"}, "downloads": -1, "filename": "ursa-major-0.3.3.tar.gz", "has_sig": false, "md5_digest": "68ddaf4004f2b4e4ec542993f16d4d7f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 61822, "upload_time": "2019-08-23T03:49:41", "upload_time_iso_8601": "2019-08-23T03:49:41.134805Z", "url": "https://files.pythonhosted.org/packages/b1/73/524391dfa4bb756cef263d21af4c4bab59bca0506bbf0bb4653e9ddce019/ursa-major-0.3.3.tar.gz", "yanked": false}], "0.4.1": [{"comment_text": "", "digests": {"md5": "ac642c8ee9d5c2672c377b5755841471", "sha256": "43825fb0026cdd13ef0c063158e721bd19e56f9846e6f0656d2efe7c671fb199"}, "downloads": -1, "filename": "ursa-major-0.4.1.tar.gz", "has_sig": false, "md5_digest": "ac642c8ee9d5c2672c377b5755841471", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 53099, "upload_time": "2020-02-11T08:26:34", "upload_time_iso_8601": "2020-02-11T08:26:34.405015Z", "url": "https://files.pythonhosted.org/packages/35/9e/464bc6aa6e599c0e5d6bb6204d40aa3e08fbe79b923518d334afeda0451c/ursa-major-0.4.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "ac642c8ee9d5c2672c377b5755841471", "sha256": "43825fb0026cdd13ef0c063158e721bd19e56f9846e6f0656d2efe7c671fb199"}, "downloads": -1, "filename": "ursa-major-0.4.1.tar.gz", "has_sig": false, "md5_digest": "ac642c8ee9d5c2672c377b5755841471", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 53099, "upload_time": "2020-02-11T08:26:34", "upload_time_iso_8601": "2020-02-11T08:26:34.405015Z", "url": "https://files.pythonhosted.org/packages/35/9e/464bc6aa6e599c0e5d6bb6204d40aa3e08fbe79b923518d334afeda0451c/ursa-major-0.4.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:39:16 2020"}