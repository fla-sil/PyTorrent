{"info": {"author": "\u5468\u7166\u6797 @metadef", "author_email": "voidzxl@163.com", "bugtrack_url": null, "classifiers": [], "description": "# UtilMeta\n\n\n\n## Feature:\n\nUtilMeta\u662f\u4e00\u4e2a\u57fa\u4e8edjango\u7684API\u6846\u67b6\uff0c\u5bf9API\u670d\u52a1\u8fdb\u884c\u4e86\u9ad8\u5ea6\u7684\u62bd\u8c61\u548c\u6574\u5408\uff0c\u6709\u4ee5\u4e0b\u4e3b\u8981\u529f\u80fd\u7279\u8272\n\n#### 1. \u72ec\u7279\u7684\u6570\u636e\u63a5\u53e3\u67b6\u6784\u6a21\u5f0f\n\nUtilMeta \u7684\u67b6\u6784\u4e3a\n\n* **Model**:  \u4e0edjango\u4e00\u81f4\u7684\u6a21\u578b\u5c42\uff0c\u4ec5\u7528\u4e8e\u8868\u7ed3\u6784\u548c\u8868\u5173\u7cfb\u7684\u5b9a\u4e49\n\n* **Module**:  \u529f\u80fd\u5f3a\u5927\u7684\u6a21\u5757\u5c42\uff0c\u9075\u5faaREST\u6807\u51c6\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u7528\u7ec4\u4ef6\u53c2\u6570\u914d\u7f6e\u7684\u65b9\u5f0f\u5b9a\u4e49\u5b57\u6bb5\u7684\u8bfb/\u5199\u6743\u9650\uff0c\u67e5\u8be2\u5b57\u6bb5\u548c\u67e5\u8be2\u65b9\u6cd5\uff0cget/put/post/patch/delete\u7684\u6743\u9650\uff0c\u6a21\u5757\u5728\u5b9a\u4e49\u597d\u4e4b\u540e\uff0c**\u65e0\u9700\u7f16\u5199\u4efb\u4f55ORM\u903b\u8f91**\uff0cUtilMeta\u4f1a\u63a5\u624b\u5bf9\u8d44\u6e90\u7684\u67e5\u8be2\uff0c\u64cd\u4f5c\uff0c\u63d0\u4f9b\u7684\u65b9\u4fbf\u7684\u94a9\u5b50\uff0c\u53ef\u4ee5\u5b9a\u5236\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\n     \u524d\u7aef\u53ef\u4ee5\u5728\u5141\u8bb8\u7684\u8303\u56f4\u5185\uff0c**\u901a\u8fc7\u53c2\u6570\u5b9a\u4e49\u8fd4\u56de\u7684\u5b57\u6bb5\uff0c\u683c\u5f0f\uff0c\u987a\u5e8f**\u7b49\uff0c\u8fd9\u4e9b\u529f\u80fd\u4e5f\u6709\u522b\u4e8e\u4f20\u7edf\u7684REST\uff0c\u540c\u6837\u6574\u5408\u5728Module\u7cfb\u7edf\u4e2d\u7531\u6846\u67b6\u81ea\u52a8\u5b8c\u6210\n\n* **API**\uff1a\u63a5\u53e3\u5c42\uff0c\u8d1f\u8d23\u5b9a\u4e49\u63a5\u53e3\u7684url\uff0c\u53c2\u6570\u7684\u7c7b\u578b\u548c\u9650\u5236\uff0c\u5e76\u63d0\u4f9b\u5f3a\u5927\u7684\u53c2\u6570\u6a21\u677f\u89e3\u6790\u7cfb\u7edf\uff0c\u8fc7\u6ee4\u810f\u8bf7\u6c42\uff0c\u4ee5\u72ec\u521b\u7684**\u7ec4\u4ef6\u6302\u8f7d**\u65b9\u5f0f\u66ff\u4ee3django\u7684urlpatterns\u65b9\u5f0f\u4f18\u96c5\u7684\u5b9a\u4e49url\u7ed3\u6784\uff0c\u5e76\u4e14\u63d0\u4f9b\u7075\u6d3b\u7684\u94a9\u5b50\uff0cAPI\uff0cModule\u548c\u51fd\u6570\u90fd\u53ef\u4ee5\u7528\u53d8\u91cf\u7684\u65b9\u5f0f\u6302\u8f7d\u5230\u7236API\u4e0a\uff0c\u5b9e\u73b0\u7ed3\u6784\u81ea\u76f8\u4f3c\u7684API\u6709\u5411\u56fe\uff0c\u7ed3\u6784\u6e05\u6670\n\n#### 2. \u7ec4\u4ef6\u5316\u5b9a\u4e49API\u670d\u52a1\uff1a\n\nUtilMeta\u63d0\u4f9b\u5927\u91cf\u529f\u80fd\u5f3a\u5927\u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982**\u53c2\u6570\u6a21\u677f/\u67e5\u8be2/\u6743\u9650/\u5a92\u4f53/\u5206\u9875/\u65e5\u5fd7**\u7b49\u7b49\uff0c\u901a\u8fc7\u53c2\u6570\u5b9a\u4e49\u7684\u65b9\u5f0f\u6253\u9020API\u7cfb\u7edf\uff0c\u53ef\u4ee5\u6e05\u6670\u6709\u6548\u7684\u7ec4\u7ec7\u4ee3\u7801\uff0c\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\uff0c\u589e\u52a0\u6e90\u7801\u53ef\u8bfb\u6027\uff0c\u501f\u52a9\u4ed6\u4eec\uff0c\u53ef\u4ee5\u5b9e\u73b0\n\n* **Config**: \u4ee3\u66ff\u5b9a\u4e49\u53d8\u91cf\u65b9\u5f0f\u7684settings\u914d\u7f6e\uff0c\u8fd0\u7528\u591a\u4e2a\u914d\u7f6e\u5b50\u7ec4\u4ef6\u4ee5\u53c2\u6570\u65b9\u5f0f\u8fdb\u884c\u9879\u76ee\u8bbe\u7f6e\uff0c\u65e2\u65b9\u4fbfIDE\u7ed9\u51fa\u63d0\u793a\u548c\u589e\u52a0\u53ef\u8bfb\u6027\uff0c\u4e5f\u53ef\u4ee5\u8fdb\u884c\u591a\u9879check\u4fdd\u8bc1\u914d\u7f6e\u6b63\u786e\n\n* **Auth**\uff1a**\u7ec6\u7c92\u5ea6\u7684\u7528\u6237\u6743\u9650\u914d\u7f6e**\uff0c\u4e00\u4e2a\u8bf7\u6c42\u7684\u72b6\u6001\uff08\u672a\u767b\u5f55\uff0c\u5df2\u767b\u5f55\uff09\uff0c\u7528\u6237\u7684\u72b6\u6001\uff08\u7ba1\u7406\u5458\uff0c\u666e\u901a\u7528\u6237\uff09\uff0c\u7528\u6237\u4e0e\u8bf7\u6c42\u8d44\u6e90\u7684\u5173\u7cfb\uff08\u5982\u7528\u6237\u662f\u8bf7\u6c42\u7684\u5185\u5bb9\u7684\u4f5c\u8005\uff09\u4ee5\u53ca\u8bf7\u6c42\u7684\u65b9\u6cd5\uff08GET/PUT/...\uff09\u5728\u8fd9\u4e9b\u7ef4\u5ea6\u4e0a\u90fd\u53ef\u4ee5\u6e05\u6670\u7b80\u6d01\u7684\u914d\u7f6e\u8bbf\u95ee\u6743\u9650\uff0c\u6ca1\u6709\u6743\u9650\u4f1a\u8fd4\u56de403\n\n* **Rule/Schema/Response**:  \u7075\u6d3b\u5730\u4e3a\u6bcf\u4e2aAPI\u5b9a\u5236**\u8bf7\u6c42\u53c2\u6570\u6a21\u677f**\uff0c**\u8fd4\u56de\u6a21\u677f**\u548c**\u53c2\u6570\u89c4\u5219**\n\n* **Relate**: \u5173\u8054\u8868\u7684\u548c\u4e2d\u95f4\u8868\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u914d\u7f6e\u7ec4\u4ef6\uff0c\u96c6\u6210\u5728Module\u4e2d\n\n* **Filter/Search**: \u67e5\u8be2\u641c\u7d22\u7ec4\u4ef6\uff0c\u65b9\u4fbf\u7684\u5b9e\u73b0\u6a21\u5757\u641c\u7d22\u548c\u5168\u7ad9\u641c\u7d22\n\n* **Media**: \u5a92\u4f53\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u5a92\u4f53\u6587\u4ef6\uff08\u97f3\u89c6\u9891\u56fe\u7247\u548c\u4e00\u822c\u6587\u4ef6\uff09\u7684\u5b58\u50a8\u548c\u6d41\u5f0f\u8fd4\u56de\n\n#### 3.  \u5f3a\u5927\u7684\u9879\u76ee\u7ba1\u7406\u540e\u53f0\n\nUtilMeta \u63d0\u4f9b\u4e00\u4e2a\u9879\u76ee\u7684\u7ba1\u7406\u540e\u53f0\uff0c\u9ed8\u8ba4\u5305\u62ec\u4ee5\u4e0b\u90e8\u5206\n\n* **\u81ea\u52a8\u7684API\u6587\u6863**\uff1aUtilMeta\u6846\u67b6\u4f1a\u6574\u5408\u4f60\u7684\u63a5\u53e3url\uff0c\u53c2\u6570\u6a21\u677f\uff0c\u8fd4\u56de\u6a21\u677f\u548c\u5355\u5143\u6587\u6863\uff08\u4f60\u5728\u51fd\u6570\u4e2d\u5199\u7684\u6587\u6863\uff09\u5230\u4e00\u4e2a\u81ea\u52a8\u7684\u4ea4\u4e92API\u6587\u6863\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u63a5\u53e3\u8fdb\u884c\u53c2\u6570\u6d4b\u8bd5\uff0c\u800c\u4e14\u540e\u7aef\u4ee3\u7801\u7684\u6539\u53d8\u5c06\u4f1a\u76f4\u63a5\u5bfc\u81f4API\u6587\u6863\u6539\u53d8\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7ef4\u62a4\u6587\u6863\uff0c\u524d\u540e\u7aef\u5f00\u53d1\u4eba\u5458\u90fd\u53ef\u4ee5\u53c2\u7167\u8fd9\u4efd\u6c38\u8fdc\u6700\u65b0\u7684\u6587\u6863\n* **\u65e5\u5fd7\u7cfb\u7edf**\uff1aUtilMeta\u7684\u65e5\u5fd7\u7cfb\u7edf\u9664\u4e86\u4f1a\u8bb0\u5f55\u6bcf\u4e00\u6b21\u8bbf\u95ee\u7684\u5404\u9879\u57fa\u672c\u6570\u636e\uff08\u65f6\u95f4\uff0chttp_method, status, ip, content_type, content_length\u548c\u8bf7\u6c42\u6beb\u79d2\u65f6\u95f4\uff09, \u8fd8\u4f1a\u7ed9\u51fa\u8bf7\u6c42\u7684\u7ec4\u4ef6 \uff08API/Module\u6216\u51fd\u6570\uff09\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u8bbe\u7f6e\u8bb0\u5f55\u8bf7\u6c42\u7684\u67e5\u8be2\u65f6\u95f4\u7ec6\u8282\uff0c\u5177\u4f53\u53c2\u6570\u548c\u7ecf\u8fc7\u7684\u94a9\u5b50\u51fd\u6570\uff0c\u65b9\u4fbf\u8fdb\u884c\u5206\u6790\u8c03\u8bd5\uff0cbug\u590d\u73b0\n* **\u81ea\u52a8\u6d4b\u8bd5\u7cfb\u7edf**\uff1a\u76f4\u63a5\u4ee5Web\u65b9\u5f0f\u7ba1\u7406\u548c\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\uff0c\u538b\u529b\u6d4b\u8bd5\uff0c\u5e76\u53cd\u9988\u6d4b\u8bd5\u62a5\u544a\uff0c\u6240\u6709\u6d4b\u8bd5\u81ea\u52a8\u8fdb\u884c\n* **\u7ba1\u7406\u5458\u7cfb\u7edf**\uff1a\u63d0\u4f9broot/manager/worker\u7684\u4e09\u7ea7\u6743\u9650\u7cfb\u7edf\uff0c\u8d1f\u8d23\u5bf9\u7ad9\u5185\u7684\u8d44\u6e90\u8fdb\u884c\u7ba1\u7406\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6269\u5c55\u52a0\u5165\u5982\u5185\u5bb9\u5ba1\u6838\u7b49\u529f\u80fd\n* **\u6570\u636e\u76d1\u63a7\u5206\u6790\u7cfb\u7edf**\uff1a\u901a\u8fc7\u914d\u7f6e\u5bf9\u7ad9\u5185\u8d44\u6e90\u7684\u6570\u636e\u8fdb\u884c\u5206\u6790\u7edf\u8ba1\uff08\u5982\u7528\u6237\u5728\u7ebf\u4eba\u6570\u6bcf\u5c0f\u65f6\u7edf\u8ba1\uff09\uff0c\u751f\u6210\u6570\u636e\u56fe\u8868\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u670d\u52a1\u5668\u8fd0\u884c\u6570\u636e\u8fdb\u884c\u76d1\u63a7\uff0c\u5206\u6790\n\n#### 4. \u81ea\u52a8\u5316\uff0c\u4e00\u952e\u5316\u7684\u90e8\u7f72\u670d\u52a1\n\n* **\u547d\u4ee4\u884c\u5de5\u5177meta**: \u6269\u5c55\u81eadjango\u7684manage.py\uff0c\u53ef\u4ee5\u7ed3\u5408\u591a\u79cd\u65b9\u6848\uff08uwsgi, gunicorn\uff09\u5b9e\u73b0\u81ea\u52a8\u90e8\u7f72\uff0c\u6839\u636e\u9879\u76ee\u8bbe\u7f6e\u81ea\u52a8\u751f\u6210nginx\u914d\u7f6e\u6587\u4ef6\n* **\u53ef\u6269\u5c55\u7684\u81ea\u52a8GET\u8bf7\u6c42\u7f13\u5b58**\n\nUtilMeta\u6839\u636e\u4f60\u5b9a\u4e49\u7684Module\uff0c\u5728\u914d\u7f6e\u7f13\u5b58\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u7f13\u5b58\u5927\u90e8\u5206GET\u8bf7\u6c42\u5e76\u4e14\u4e0d\u9700\u8981\u5f00\u53d1\u8005\u5173\u5fc3\u7f13\u5b58\u7ec6\u8282\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6839\u636e\u7cfb\u7edf\u5185\u5b58\u8c03\u6574\u7f13\u5b58\u91cf\uff0c\u5e76\u4e14\u53ef\u4ee5\u7075\u6d3b\u7684\u914d\u7f6e\u6269\u5c55\uff0c\u5982redis\u4e3b\u4ece\u7f13\u5b58\u96c6\u7fa4\u914d\u7f6e\uff0ctimeout\u65f6\u95f4,\nUtilMeta\u8fd8\u53ef\u4ee5\u8fdb\u884c\u542f\u52a8\u9884\u70ed\uff0c\u5c06\u6570\u636e\u5e93\u7684\u90e8\u5206\u6570\u636e\uff08\u53d6\u51b3\u4e8e\u4f60\u7684\u914d\u7f6e\u7a7a\u95f4\uff09\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\n\n\n\n## Quick Start\n\n\u6211\u4eec\u5c06\u5728\u8fd9\u91cc\u5feb\u901f\u5efa\u7acb\u4e00\u4e2a\u5c0f\u578b\u7684\u5185\u5bb9\u5e73\u53f0\u4f5c\u4e3aUtilMeta\u7684Quick Start\n\n### 1. \u5b89\u88c5\u4e0e\u521b\u5efa\u9879\u76ee\n\n\u4f7f\u7528pip\u5de5\u5177\u8fdb\u884c\u5b89\u88c5\n\n```shell\npip install utilmeta\n```\n\nUtilMeta\u4f1a\u540c\u6b65\u5b89\u88c5\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177meta\uff0cmeta\u662fdjango\u7684manage.py\u7684\u5c01\u88c5\uff0c\u52a0\u5165\u4e86\u81ea\u52a8\u90e8\u7f72\uff0c\u6d4b\u8bd5\uff0c\u76d1\u63a7\u7b49\u529f\u80fd\uff0c\u6211\u4eec\u7684\u5168\u90e8\u547d\u4ee4\u5c06\u7531\u5b83\u6765\u5b8c\u6210\uff0c\u4f7f\u7528\n\n```shell\nmeta setup example\n```\n\n\u521b\u5efa\u9879\u76ee\uff0c\u9ed8\u8ba4\u521b\u5efa\u7684\u6587\u4ef6\u5939\u7ed3\u6784\u4e3a\uff1a\n\n```\n example/\n  config/\n    __init__.py\n    conf.py\n    service.py\n  media/\n    image/\n  module/\n    __init__.py\n    modules.py\n  service/\n    __init__.py\n    api.py\n  __init__.py\n  main.py\n```\n\n\n\u8fd9\u6837\u7684\u9879\u76ee\u7ed3\u6784\u9002\u5408\u4e8e\u7eaf\u540e\u7aef\u5f00\u53d1\uff0c\u52a0\u5165\u53c2\u6570 -w \u5c06\u4f1a\u589e\u52a0\u4e00\u7ea7\u76ee\u5f55\n\n```shell\nmeta setup example -w\n```\n\n\u5f97\u5230\u76ee\u5f55\n\n```\nexample/\n  deploy/\t\t\n    config/\n      nginx.conf\n      uwsgi.ini\n    log/\n    run/\n    sql/\n  dev/\n    node_modules/\n  dist/\n    css/\n    img/\n    js/\n    index.html\n  media/\n    image/\n  www/\n    config/\n    module/\n    service/\n    main.py\n```\n\n\u8fd9\u6837\u7684\u7ed3\u6784\u9002\u5408\u4e8e\u4e2a\u4eba\u5168\u6808\u5316\u7684\u5f00\u53d1\uff0c\u7ed9\u51fa\u7684\u5206\u7c7b\u5efa\u8bae\u662f\uff1a\n\n* deploy \u4e2d\u5b58\u653e**\u90e8\u7f72**\u6709\u5173\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u65e5\u5fd7\u6587\u4ef6\u7b49\t\n* dev \u662f**\u524d\u7aef\u5de5\u4f5c**\u76ee\u5f55\uff0c\u5b58\u653e Vue\uff0cReact\u6216\u8005App\u7684\u524d\u7aef\u6587\u4ef6\uff0c\n* dist \u662f**\u524d\u7aef\u90e8\u7f72**\u76ee\u5f55\uff0c\u5404\u524d\u7aef\u6846\u67b6build production\u7684\u5b58\u653e\u76ee\u5f55\u6216app\u8f6f\u4ef6\u5b58\u653e\u76ee\u5f55\uff0c\n* media \u662f\u7528\u6237\u4e0a\u4f20\u7684**\u5a92\u4f53\u6587\u4ef6**\u5b58\u653e\u76ee\u5f55\uff0c\u56fe\u7247\uff0c\u97f3\u89c6\u9891\u7b49\n* www \u548c\u4e0a\u9762\u7b2c\u4e00\u6b21\u521b\u5efa\u7684\u76ee\u5f55\u7ed3\u6784\u4e00\u6837\uff0c\u662f**\u540e\u7aef\u6587\u4ef6**\u5b58\u653e\u76ee\u5f55\n\n### 2. \u521b\u5efa\u4e0e\u6dfb\u52a0\u6a21\u5757\n\n\u5728UtilMeta\u91cc\uff0c\u6a21\u5757\u662f\u6570\u636e\u6a21\u578b\u7684\u7ec4\u7ec7\u5355\u4f4d\uff0c\u7c7b\u8bd5\u4e8edjango\u4e2d\u7684app\uff0c\u6211\u4eec\u5148\u6dfb\u52a0\u4e00\u4e2a\u8d26\u6237\u6a21\u5757\uff0c\u7528\u4e8e\u5e73\u53f0\u7528\u6237\u7684\u7ba1\u7406\uff0c\u8fdb\u5165module\u6587\u4ef6\u5939\u5e76\u6dfb\u52a0\u6a21\u5757\n\n```shell\ncd module\nmeta add account\n```\n\n\u4f1a\u521b\u5efa\u4ee5\u4e0b\u7684\u76ee\u5f55\u7ed3\u6784\n\n```\nmodule/\n  account/\n    migrations/\n      __init__.py\n    __init__.py\n    models.py\n    module.py\n```\n\nmodels\u5c42\u7684\u7528\u6cd5\u4e0edjango\u4fdd\u6301\u4e00\u81f4\uff0c\u6211\u4eec\u6253\u5f00models.py\uff0c\u7f16\u5199\u6a21\u578b\n\n```python\nfrom utilmeta.fields import *\n\nclass Account(Model):\n   username = CharField(max_length=20, unique=True)\n   name = CharField(max_length=20, default='')\n   password = PasswordField(len=(6, 20))\n   intro = RichTextField(max_length=100, default='')\n   avatar = FileField(upload_to='avatar/', default=\"avatar/default.png\")\n   register_date = DateField(auto_now_add=True)\n```\n\nUtilMeta\u7684fields\u6587\u4ef6\u4e2d\u5bfc\u5165\u4e86django models\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\uff08\u5305\u62ecpostgresql\u5b57\u6bb5\uff09\uff0c\u4e00\u4e9b\u5e38\u7528\u7684callable\uff08CASCADE, PROTECT, SET_NULL\u7b49\uff09\uff0c\u4ee5\u53ca\u4e00\u4e9bUtilMeta\u81ea\u5b9a\u4e49\u7684\u5b57\u6bb5\uff0c\u5b83\u4eec\u7684\u547d\u540d\u90fd\u5f88\u89c4\u8303\uff0c\u5bfc\u5165\u5168\u90e8\u4e5f\u4e0d\u4f1a\u5bf9\u547d\u540d\u7a7a\u95f4\u9020\u6210\u5f88\u5927\u5f71\u54cd\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u53ea\u5bfc\u5165fields\n\n\u4ee5\u4e0a\u4ee3\u7801\u4e2d\u6709\u4e24\u4e2aUtilMeta\u5b9a\u4e49\u7684\u5b57\u6bb5\n\n**PasswordField**: \u81ea\u5e26\u54c8\u5e0c\u52a0\u5bc6\u7684\u5b57\u6bb5\uff0clen\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u5b9e\u9645\u5bc6\u7801\u7684\u957f\u5ea6\u8303\u56f4\n\n**RichTextFIeld**: \u7ee7\u627f\u81eaTextField\uff0c\u81ea\u5e26XSS\u8fc7\u6ee4\n\n\u9664\u6b64\u4e4b\u5916\u4e0edjango models\u7684\u7f16\u5199\u5e76\u65e0\u5dee\u5f02\n\n### 3.\u9879\u76ee\u914d\u7f6e\n\n\u6dfb\u52a0\u6a21\u5757\u540e\u9700\u8981\u5728\u8bbe\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0modules\uff0c\u6211\u4eec\u6253\u5f00config\u6587\u4ef6\u5939\u4e0b\u7684conf.py\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230\u914d\u7f6e\u9879\u6709\u522b\u4e8edjango\u7684\u53d8\u91cf\u5b9a\u4e49\u65b9\u6cd5\uff0c\u7528\u7c7b\u5b9e\u4f8b\u53c2\u6570\u7684\u65b9\u6cd5\u8fdb\u884c\u914d\u7f6e\uff0c\n\u53ef\u4ee5\u65b9\u4fbf\u7684\u501f\u52a9IDE\u7684\u81ea\u52a8\u63d0\u793a\u8865\u9f50\u627e\u5230\u76f8\u5e94\u7684\u914d\u7f6e\u9879\n\n```python\nconfig = conf.Config(\n   __name__,\n   ...\n   modules_dir='module',\n   auth=conf.Auth(\t\t      # new\n        user_model='account.Account',\n        login_fields=('username',)\n   ),\n   databases={\n        'default': conf.Database(\n            engine=conf.Database.SQLITE,\n            name='db',\n        ),\n    },\n   ...\n)\n```\nmodules_dir\u662f\u9879\u76ee\u5b58\u653e\u6a21\u578b\u7684\u76ee\u5f55\uff0c\u5176\u4e2d\u7684\u6587\u4ef6\u5939\u90fd\u4f1a\u88ab\u81ea\u52a8\u89c6\u4e3a\u4e00\u4e2adjango app\u8fdb\u884c\u5904\u7406\uff0c\nUtilMeta\u4f1a\u6839\u636e\u4f60\u7684\u914d\u7f6e (modules, session\uff0c\u662f\u5426\u4e3a\u751f\u4ea7\u73af\u5883\u7b49) \u751f\u6210INSTALLED_APPS\n\n\u800c\u4e0b\u9762\u914d\u7f6eauth\u662f\u4e3a\u4e86\u89c4\u5b9a\u6211\u4eec\u521b\u5efa\u7684Account\u7c7b\u662f\u9879\u76ee\u7684**\u7528\u6237\u7c7b**\uff0c\u5fc5\u987b\u914d\u7f6e\u8fd9\u9879\u624d\u80fd\u542f\u7528\u9488\u5bf9\u7528\u6237\u7684\u6743\u9650\u914d\u7f6e\u7b49\u5f88\u591a\u91cd\u8981\u529f\u80fd\uff0c\u5176\u4e2d\u53c2\u6570\u7684\u8981\u6c42\u662f\uff1a\n\n* login_fields: \u767b\u5f55\u5b57\u6bb5\uff0c\u9700\u8981\u4e3aunique\u7684\n* user_model\uff1a**\u5fc5\u987b\u9879**\uff0c\u5982\u679c\u4e0d\u6307\u5b9aauth_model\u5219\u5bf9\u5e94\u7684\u6a21\u578b\u4e2d\u5fc5\u987b\u5305\u542bPasswordFIeld\u4f5c\u4e3a\u5bc6\u7801\u5b57\u6bb5\n* auth_model:  \u5982\u679c\u9700\u8981\u7528\u6237\u6a21\u578b\u548c\u5bc6\u7801\u6a21\u578b\u5206\u79bb\uff0c\u53ef\u4ee5\u7528\u5b83\u6307\u5b9a\u4e00\u4e2a\u5bc6\u7801\u6a21\u578b\uff0c\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u6307\u5411user_model\u7684\u4e00\u5bf9\u4e00\u5b57\u6bb5\u548c\u4e00\u4e2aPasswordFIeld\uff0c\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u65e0\u9700\u914d\u7f6e\n\n\u6211\u4eec\u56de\u5230\u6709main.py\u7684\u76ee\u5f55\uff0c\u6267\u884c\n\n```shell\nmeta makemigrations\nmeta migrate\n```\n\u5982\u679c\u6211\u4eec\u4f7f\u7528sqlite\u6570\u636e\u5e93\uff0c\u4f1a\u770b\u5230\u5df2\u7ecf\u5728\u9879\u76ee\u6587\u4ef6\u5939\u521b\u5efa\u4e86db.sqlite3\u6587\u4ef6\n\n\n### 4. \u6a21\u5757\u5316\n\n\u8fd9\u4e00\u6b65\u5c31\u662f\u6709\u8da3\u7684\u5730\u65b9\u4e86\uff0c\u6211\u4eec\u5c06\u4f1a\u901a\u8fc7UtilMeta\u7684\u6a21\u5757\u7c7b\u5f00\u53d1\u4e00\u4e2a\u7528\u6237\u7684\u6570\u636e\u63a5\u53e3\uff0c\n\u4f60\u5c06\u770b\u5230\u4e00\u4e2a\u72ec\u7279\u800c\u5f3a\u5927\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u673a\u5236\uff0c\u6211\u4eec\u6253\u5f00module.py\uff0c\u7f16\u5199\n\n```python\nfrom utilmeta.utils import *\nfrom .models import Account\n\nclass AccountMain(Module):\n   @mod.proxy\n   class Meta:\n       model = Account\n       field = Field(\n           readonly=('username', 'register_date'),\n           writable=('name', 'intro', 'avatar')\n       )\n\n      method = Method(\n           get=Auth(state=\"login\"),\n           put=Auth(relate=\"self\"),\n           delete=Auth(require=Auth.admin)\n       )\n```\n\n\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2aAccountMain\u6a21\u5757\u7c7b\uff0c\u7ee7\u627f\u81eaModule\uff0c\u5728Meta\u7c7b\u4e2d\u6307\u5b9a\u4e86\u4e09\u4e2a\u91cd\u8981\u7684\u53c2\u6570\n\n* **model**: \u6a21\u5757\u7684\u6a21\u578b\uff0c\u4e3aAccount\n\n* **field**: \u6a21\u5757\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u8bbe\u7f6e\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u6307\u5b9areadonly\u7684\u5b57\u6bb5\uff08\u53ea\u8bfb\u7684\u5b57\u6bb5\uff0c\u53ea\u80fd\u88abget\u65b9\u6cd5\u83b7\u53d6\uff0c\u4e0d\u80fd\u88abput/patch\u65b9\u6cd5\u66f4\u6539\uff09\u548cwritable\u5b57\u6bb5\uff08\u53ef\u4ee5\u88ab\u4efb\u610f\u65b9\u6cd5\u64cd\u4f5c\uff09\n\n* **method**: \u6a21\u5757\u7684\u65b9\u6cd5\u8bbe\u7f6e\uff0c\u53c2\u6570\u540d\u4e3aHTTP_METHOD\uff0c\u503c\u4e3a\u6b64\u65b9\u6cd5\u5bf9\u5e94\u7684\u7ec4\u4ef6\u6216\u7ec4\u4ef6\u5217\u8868\uff0c\u5728\u8fd9\u91cc\u4e3a\u91cd\u8981\u7684Auth\u6743\u9650\u7ec4\u4ef6\uff0c\u7528\u4e8e\u6307\u5b9a\u5404\u65b9\u6cd5\u6240\u9700\u7684\u6743\u9650\uff0c\u4ee5\u4e0b\u662f\u8fd9\u4e9b\u53c2\u6570\u7684\u610f\u4e49\n\n  state='login' : \u5fc5\u987b\u4e3a\u767b\u5f55\u72b6\u6001\u624d\u80fd\u8fdb\u884c\n\n  relate='self':  \u8bf7\u6c42\u7684\u8d44\u6e90\u5fc5\u987b\u4e3a\u8bf7\u6c42\u8005\u672c\u8eab\uff0c\uff08\u5373\u53ea\u80fd\u81ea\u5df1\u4fee\u6539\u81ea\u5df1\u7684\u6570\u636e\uff09\n\n  require=Auth.admin \uff1a\u8bf7\u6c42\u8005\u5fc5\u987b\u4e3a\u7ba1\u7406\u5458\u7528\u6237\uff0cadmin\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u9ed8\u8ba4\u8fd4\u56deFalse\uff0c\u53ef\u4ee5\u88ab\u8986\u76d6\u4e3a\u4f60\u7684\u9879\u76ee\u7684\u5224\u65ad\u7ba1\u7406\u5458\u7684\u65b9\u6cd5\uff0c\u5982\n\n```python\nAuth.admin = lambda user: user.type == 'admin'\n```\n\nAuth\u6a21\u5757\u7684\u7528\u6cd5\u8fd8\u6709\u5f88\u591a\uff0c\u5c31\u5148\u4e0d\u5728\u8fd9\u91cc\u5c55\u5f00\u4e86\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u6837\u914d\u7f6e\u6743\u9650\u662f\u5f88\u6e05\u6670\u7b80\u6d01\u7684\n\n\u53e6\u5916\u6211\u4eec\u770b\u5230\uff0c\u5728Meta\u7c7b\u4e0a\u52a0\u4e86\u88c5\u9970\u5668@mod.proxy\uff0c\u88c5\u9970\u5668\u7236\u7c7b@mod\u662f\u670d\u52a1\u4e8e\u6a21\u5757\u7684\uff0c\u8fd9\u4e2a proxy\u5c06\u8fd9\u4e2a\u6a21\u5757\u53d8\u4e3a**\u4ee3\u7406\u6a21\u5757**\uff0c\u4ee3\u7406\u6a21\u5757\u4e0e\u666e\u901a\u6a21\u5757\u7684\u533a\u522b\u5728\u4e8e\u53ef\u4ee5\u914d\u7f6epost\u548c     delete\u65b9\u6cd5 (\u8fd9\u4e24\u79cd**\u589e/\u5220**\u7684\u65b9\u6cd5\u7684\u5b9e\u73b0\u4e0efield\u4e2d\u7684**\u8bfb/\u5199**\u7684\u5e8f\u5217\u5316\u914d\u7f6e\u65e0\u5173)\uff0c\u5e76\u4e14\uff0c**\u4e00\u4e2a\u6a21\u578b\u53ea\u80fd\u5bf9\u5e94\u4e00\u4e2a\u4ee3\u7406\u6a21\u5757**\uff0cUtilMeta\u8fd9\u6837\u9650\u5236\u7684\u76ee\u7684\u662f\u51cf\u5c11\u8868\u8bb0\u5f55\u7684\u589e\u5220\u6743\u9650\u7684\u6269\u6563\n\n\u7f16\u5199\u597d\u7684\u6a21\u5757\u53ef\u4ee5\u5bfc\u5165\u5230module/modules.py\u4e2d\uff0c\u65b9\u4fbfAPI\u7684\u5f15\u7528\n\n```python\nfrom .account.module import AccountMain\n```\n\n\n\n### 5. \u6302\u8f7d\u5230API\n\n\u8981\u60f3\u8ba9\u6211\u4eec\u5b9a\u4e49\u7684\u6a21\u5757\u53ef\u4ee5\u88ab\u8bbf\u95ee\uff0c\u9700\u8981\u5c06\u5176**\u6302\u8f7d**\u5230API\u4e0a\uff0c\u6211\u4eec\u6253\u5f00service\u6587\u4ef6\u5939\u4e2d\u7684api.py\uff0c\u9ed8\u8ba4\u6709\u4ee5\u4e0b\u5185\u5bb9\n\n```python\nfrom utilmeta.utils import *\nfrom module.modules import *\n\nclass RootAPI(API):\n   class Meta:\n       pass\n```\n\n\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6config/conf.py\u4e2d\uff0c\u6709\u8fd9\u4e48\u4e24\u884c\n\n```python\nroot_api='service.api.RootAPI',\nroot_name='api'\n```\n\n\u5c31\u662f\u7528\u6765\u6307\u5b9a**\u6839API**\u7684\uff0c\u4e00\u4e2a\u9879\u76ee\u6240\u6709\u7684API\u548c\u6a21\u5757\u90fd\u4f1a\u6700\u7ec8\u6302\u8f7d\u5230\u6839API\u4e0a\uff0c\u5426\u5219\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u5230\uff0c\u6839API\u9ed8\u8ba4\u89e3\u6790\u5230URL: /api\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7root_name\u6307\u5b9a\n\n\u6211\u4eec\u6dfb\u52a0\u4e00\u4e2a\u9488\u5bf9\u8d26\u6237\u7684API\n\n```python\nfrom utilmeta.utils import *\nfrom module.modules import *\n\nclass UserSchema(Schema):\n   username: str = Rule(len=(3, 20))\n   password: str = Rule(reg='[0-9a-zA-Z]{6,20}')\n\nclass SignupSchema(UserSchema):\n   name: str = Rule(len=(3, 10), default='name')\n\nclass AccountAPI(API):\n   class Meta:\n       module = AccountMain\n\n   @api.post\n   def signup(self, data: SignupSchema = Schema.Body):\n       user = Auth.register(data, self.request)\n       return self.module(instance=user).serialize()[0]\n\n   @api.post(require='!login')\n   def login(self, data: UserSchema = Schema.Body):\n       user = Auth.login(data.username, data.password, request=self.request)\n       if not user:\n           return self.fail('Username or Password wrong')\n       return self.success(user.pk)\n\n   @api.put(require='login')\n   def logout(self):\n       Auth.logout(self.request)\n       return self.success()\n\nclass RootAPI(API):\n    account = AccountAPI\n    class Meta:\n        response = Response(\n            result_key='result',\n            message_key='msg',\n            action_state_key='state'\n        )\n```\n\n\u8fd9\u4e2aAPI\u867d\u7136\u4ee3\u7801\u4e0d\u591a\uff0c\u4f46\u5df2\u7ecf\u5b8c\u6574\u7684\u5c06\u7528\u6237\u7684\u6ce8\u518c\uff0c\u767b\u5f55\uff0c\u767b\u51fa\u548c\u7528\u6237\u4fe1\u606f\u7684\u67e5\u8be2\uff0c\u4fee\u6539\u5b9e\u73b0\u4e86\n   \u6211\u4eec\u53ef\u4ee5\u5148\u770b\u4e00\u4e0b\u6548\u679c\u518d\u89e3\u91ca\u5176\u4e2d\u7684\u539f\u7406\n\n### 6. \u6d4b\u8bd5API\n\n\u4ee5\u4e0a\u6211\u4eec\u5df2\u7ecf\u901a\u8fc7\u7f16\u5199Model, Module\u548cAPI\u6210\u529f\u7684\u6784\u5efa\u4e86\u4e00\u4e2a\u9488\u5bf9\u7528\u6237\u6a21\u578b\u7684\u6570\u636e\u63a5\u53e3\u670d\u52a1\uff0c\u6211\u4eec\u5728\u9879\u76ee\u76ee\u5f55\u4f7f\u7528\n\n```shell\nmeta serve\n```\n\n\u542f\u52a8UtilMeta\u670d\u52a1\n\n\u6211\u4eec\u53ef\u4ee5\u6253\u5f00Postman\u6216\u8005\u4f7f\u7528\u7c7b\u4f3c\u8f6f\u4ef6\u5411 /api/account/signup \u53d1\u9001\u4e00\u4e2aPOST\u8bf7\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528form\u7684\u65b9\u5f0f\u6216\u53d1\u9001json\u6570\u636e\n\n<img src=\"C:\\Users\\void\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200414205953268.png\" alt=\"image-20200414205953268\" style=\"zoom:67%;\" />\n\n\n\u53ef\u4ee5\u770b\u5230UtilMeta\u521b\u5efa\u4e86\u7528\u6237\u5e76\u5c06\u7528\u6237\u7684\u6570\u636e\u8fdb\u884c\u5e8f\u5217\u5316\u540e\u8fd4\u56de\uff0c\u4f60\u53ef\u4ee5\u8fde\u63a5\u6570\u636e\u5e93\u5e76\u67e5\u770b\u65b0\u521b\u5efa\u7684\u7528\u6237\uff0c\u7528\u6237\u7684\u5bc6\u7801\u5df2\u7ecf\u7ecf\u8fc7PasswordField\u7684\u54c8\u5e0c\u52a0\u5bc6\n\n<img src=\"C:\\Users\\void\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200414210154204.png\" alt=\"image-20200414210154204\" style=\"zoom: 80%;\" />\n\n\u6211\u4eec\u53ef\u4ee5\u770b\u4e00\u4e0b\u8fd9\u4e2a\u8bf7\u6c42\u6240\u5bf9\u5e94\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u770b\u5230\u51fd\u6570\u7684\u903b\u8f91\u662f\u5f88\u7b80\u5355\u7684\uff0c\u901a\u8fc7Auth\u7ec4\u4ef6\u6ce8\u518c\u7528\u6237\uff0c\u5e76\u5c06\u8fd4\u56de\u7684\u7528\u6237\u5b9e\u4f8b\u4f20\u5165\u6a21\u5757\u4e2d\u8fdb\u884c\u5e8f\u5217\u5316\n\n```python\n@api.post\t# make this function an API for POST\ndef signup(self, data: SignupSchema = Schema.Body):\n\t\tuser = Auth.register(data, self.request)\t\t\t# create&register user\n\t\treturn self.module(instance=user).serialize()[0]\t# serialize \n```\n\n\u6211\u4eec\u518d\u6765\u8bd5\u4e00\u4e0b\u7528\u6237\u7684\u767b\u5f55\n\n<img src=\"C:\\Users\\void\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200414212320360.png\" alt=\"image-20200414212320360\" style=\"zoom: 80%;\" />\n\n\u7528\u6237\u901a\u8fc7username\u548cpassword\u767b\u5f55\uff0c\u6210\u529f\u540e (state: 1) \u8fd4\u56de\u4e86\u7528\u6237\u7684\u4e3b\u952e (result: 1)\n\n\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7account\u63a5\u53e3\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u8fd8\u8bb0\u5f97\u6211\u4eec\u5728\u7528\u6237\u6a21\u5757\u4e2d\u5b9a\u4e49\u4e86get\u65b9\u6cd5\u7684\u6743\u9650\u4e3a\u767b\u5f55Auth(state='login')\uff0c\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u767b\u5f55\u4e86\uff0c\u8bbf\u95ee GET /api/account?id=1\n\n<img src=\"C:\\Users\\void\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200414212736889.png\" alt=\"image-20200414212736889\" style=\"zoom:80%;\" />\n\n\u53ef\u4ee5\u770b\u5230\u5e8f\u5217\u5316\u7684\u6570\u636e\u88ab\u8fd4\u56de\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7528PUT\u65b9\u6cd5\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\u66ff\u6362\n\n<img src=\"C:\\Users\\void\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200414214710623.png\" alt=\"image-20200414214710623\" style=\"zoom:80%;\" />\n\n\u5176\u4e2d\u8bf7\u6c42\u53c2\u6570id=1\u662f\u67e5\u8be2\u53c2\u6570\uff0c\u67e5\u8be2\u5230id=1\u7684\u7528\u6237\uff0c\u5e76\u5c06\u8bf7\u6c42\u4f53\u4e2d\u7684\u6570\u636e\u5199\u5165\u6570\u636e\u5e93\uff0c\u671f\u95f4\u4f1a\u8fdb\u884c\u6570\u636e\u6821\u9a8c\uff0c\u5bf9\u4e0d\u7b26\u5408\u89c4\u8303\u7684\u8bf7\u6c42\u8fd4\u56de400\uff0c\u5bf9\u4e0d\u7b26\u5408\u8bf7\u6c42\u6743\u9650\u7684\u8bf7\u6c42\u8fd4\u56de403\uff0c\u5982\u679c\u67e5\u8be2\u5931\u8d25\u5219\u7ecf\u8fc7\u8fd9\u4e2aPUT\uff0c\u6211\u4eec\u7684\u6570\u636e\u5df2\u7ecf\u53d1\u751f\u6539\u53d8\n\n<img src=\"C:\\Users\\void\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200414214914409.png\" alt=\"image-20200414214914409\" style=\"zoom:80%;\" />\n\n\u8fd8\u53ef\u4ee5\u8fdb\u884c\u767b\u51fa\n\n<img src=\"C:\\Users\\void\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200414235118719.png\" alt=\"image-20200414235118719\" style=\"zoom:80%;\" />\n\n\u767b\u51fa\u4ee5\u540e\uff0c\u7531\u4e8e\u5df2\u7ecf\u4e0d\u5728\u767b\u5f55\u72b6\u6001\uff0c\u5982\u679c\u518d\u6b21\u8bf7\u6c42\u83b7\u53d6\u6570\u636e\u5c06\u4f1a\u5f97\u5230403\n\n<img src=\"C:\\Users\\void\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200414235203101.png\" alt=\"image-20200414235203101\" style=\"zoom:80%;\" />\n\n\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u540c\u6837\u5305\u62ec\u4e86\u6743\u9650\u63a7\u5236\n\n\n### 7. API\u7684\u5de5\u4f5c\u673a\u5236\nAPI\u901a\u8fc7**\u7c7b\u5185\u5b9a\u4e49\u53d8\u91cf\u7684\u65b9\u5f0f**\u8fdb\u884cURL\u5339\u914d\uff0c\u4ece\u914d\u7f6e\u4e2d\u53ef\u77e5RootAPI\u6302\u8f7d\u5230 /api, \u90a3\u4e48\u5728\u5176\u4e2d\u5b9a\u4e49\u53d8\u91cfaccount = AccountAPI \u4f1a\u5c06/api/account \u89e3\u6790\u5230 AccountAPI\u8fd9\u4e2aAPI\u4e0a\uff0c\u4ee5\u6b64\u7c7b\u63a8\u53ef\u4ee5\u8fdb\u884c\u6811\u72b6\u7684\u89e3\u6790\uff0c\u5728API\u5185\u90e8\uff0c \u6709\u51e0\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5c06\u7ec4\u4ef6**\u6302\u8f7d\u5230URL**\u4e0a\uff0c\u8fd9\u4e9b\u89c4\u5219\u975e\u5e38\u91cd\u8981\n\n1. \u4ee5\u5b9a\u4e49\u53d8\u91cf\u7684\u5f62\u5f0f\u6302\u8f7dAPI\uff0c\u5df2\u7ecf\u4ecb\u7ecd\n\n2. \u4ee5\u5b9a\u4e49\u53d8\u91cf\u7684\u5f62\u5f0f\u6302\u8f7dModule, \u4e0e\u6302\u8f7dAPI\u7c7b\u4f3c\uff0c\u5982\u679c\u65b0\u5f00\u53d1\u4e00\u4e2aAccountProfile\u6a21\u5757\uff0c\u5e76\u5728AccountAPI\u4e2d\u5b9a\u4e49 profile = AccountProfile, \u5c31\u4f1a\u4f7f /api/account/profile\u89e3\u6790\u5230\u8be5\u6a21\u5757\n\n3. \u5728API\u7c7b\u7684Meta\u7c7b\u4e2d\u7528module\u53d8\u91cf\u5b9a\u4e49**\u6838\u5fc3\u6a21\u5757**\uff0c\u6838\u5fc3\u6a21\u5757\u7684\u65b9\u6cd5\uff08\u5b9a\u4e49\u5728AccountMain\u7684Method\u4e2d\u7684GET/PUT/DELETE\u65b9\u6cd5\uff09\u5c06\u4f1a\u4f5c\u7528\u5230AccountAPI\u7684URL /api/account\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bf7\u6c42\n\n```json\nGET /api/account?id=1\n```\n\n\u5c06\u4f1a\u843d\u5728AccountMain\u7684get\u65b9\u6cd5\u4e0a\uff0c\u6839\u636e\u5176field\u7684\u914d\u7f6e\u8fd4\u56de\u5bf9\u5e94\u5b57\u6bb5\u548c\u503c\u7684json\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u4f1a\u7531Module\u4ee3\u4e3a\u5b8c\u6210\n\n4. \u5728API\u4e2d\u5b9a\u4e49\u51fd\u6570\uff0c\u4e0edjango\u7684\u7c7b\u89c6\u56fe\u7684\u89c4\u5219\u7c7b\u4f3c\uff0c\u4ee5\u5c0f\u5199HTTP_METHOD\u547d\u540d\u7684\u51fd\u6570get/put/post/patch/delete\u4f1a\u4f5c\u7528\u5230API\u5bf9\u5e94\u7684URL\u4e0a\uff0c\u5982\u679cAPI\u4e2d\u7684\u6838\u5fc3\u6a21\u5757\u5df2\u7ecf\u5b9a\u4e49\u4e86\u8be5\u65b9\u6cd5\uff0cAPI\u7684\u4e2d\u7684\u51fd\u6570\u4f1a\u5c06\u5176**\u8986\u76d6**\n\n5. \u540c\u6837\u5728API\u4e2d\u5b9a\u4e49\u5e76\u975e\u4ee5HTTP_METHOD\u547d\u540d\u7684\u51fd\u6570\uff0c\u9700\u8981\u7528@api\u7c7b\u4e0b\u7684\u88c5\u9970\u5668\uff0c\u4ece\u4e0a\u9762\u7684\u4f8b\u5b50\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c@api\u4e0b\u4e5f\u6709\u4ee5HTTP_METHOD\u547d\u540d\u7684\u88c5\u9970\u5668\uff0c\u628a\u5b83\u52a0\u5728\u51fd\u6570\u4e0a\u6807\u8bb0\u4e86\u8fd9\u4e2a\u51fd\u6570\u4ee5\u4f55\u79cdHTTP\u65b9\u6cd5\u8bbf\u95ee\uff0c\u5f3a\u5236\u7684\u89c4\u5219\u662f**\u4e00\u4e2a\u51fd\u6570\u53ea\u652f\u6301\u4e00\u79cdHTTP\u65b9\u6cd5** (\u652f\u6301\u591a\u65b9\u6cd5\u7684URL\u53ef\u4ee5\u7528API\u6216Module)\uff0c\u6302\u8f7d\u4e5f\u662f\u4ee5\u51fd\u6570\u547d\u540d\u7684\u65b9\u5f0f\uff0c\u5982\u4e0a\u9762\u4f8b\u5b50\u7684 signup \u51fd\u6570\uff0c\u5176\u4e0a\u6709@api.post\u88c5\u9970\u5668\uff0c\u5c31\u5b9a\u4e49\u4e86\n\n```json\nPOST /api/account/signup\n```\n\n\u8fd9\u4e2aAPI\uff0c\u5e76\u4e14\u53ea\u80fd\u4f7f\u7528POST\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u8fd4\u56de405 \uff08http_method_not_allowed\uff09\n\n\n\n## Utils\n\n\u6709\u4e86\u4e4b\u524dQuick Start\u7684\u4ecb\u7ecd\uff0c\u76f8\u4fe1\u4f60\u5bf9UtilMeta\u5df2\u7ecf\u57fa\u672c\u4e0a\u624b\u4e86\uff0c\u63a5\u4e0b\u6765\u4f1a\u8be6\u7ec6\u7684\u4ecb\u7ecdUtilMeta\u4e2d\u7684\u5404\u4e2a\u7ec4\u4ef6\n\n### 1. \u6a21\u5757\u7cfb\u7edf Module System\n\n\u6a21\u5757\u7cfb\u7edf\u662fUtilMeta\u7684\u6570\u636e\u6838\u5fc3\uff0c\u5728\u5404\u4e2a\u7ec4\u4ef6\u914d\u7f6e\u5f97\u5f53\u65f6\u5b83\u53ef\u4ee5\u81ea\u52a8\u5b8c\u6210\u6570\u636e\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u5904\u7406\uff0c\u6743\u9650\u5904\u7406\u548c\u67e5\u8be2\u5904\u7406\uff0c\u5e76\u4e14\u5141\u8bb8\u524d\u7aef\u8bf7\u6c42\u5b9a\u5236\u6570\u636e\n\n\u4e00\u4e2a\u6a21\u5757\u57fa\u672c\u7684\u683c\u5f0f\u5982\u4e0b\n\n```python\nclass AccountMain(Module):\n    class Meta:\n        model = Account\n        field = Field(...)\n        method = Method(...)\n```\n\n\n\n#### 1.1 Field \u7ec4\u4ef6\n\nField\u7ec4\u4ef6\u5728\u6a21\u5757\u7cfb\u7edf\u4e2d\u8d1f\u8d23\u6570\u636e\u7684\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u6709\u4ee5\u4e0b\u53c2\u6570\n\n* **readonly**: \u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u4e3a\u6a21\u5757\u4e2d**\u53ea\u8bfb**\u5b57\u6bb5\u7684\u5217\u8868/\u5143\u7ec4\uff0c\u5176\u4e2d\u7684\u5b57\u6bb5\u53ea\u4f1a\u88abget\u65b9\u6cd5\u83b7\u53d6\uff0c\u65e0\u6cd5\u88abput/patch\u65b9\u6cd5\u4fee\u6539\uff08\u5982\u4e3b\u952e\uff0c\u4e00\u4e9b\u56fa\u5b9a\u65e5\u671f\uff0c\u7cfb\u7edf\u53d8\u91cf\u7b49\uff09\uff0c\u5982\u679c\u5e0c\u671b\u5e8f\u5217\u5316\u5168\u90e8\u5b57\u6bb5\u5e76\u5168\u90e8\u4e3a\u53ea\u8bfb\u6743\u9650\uff0c\u53ef\u4ee5\u4f20\u5165\n\n```python\nfield = Field(readonly='__all__')\n```\n\n* **writable**: \u6a21\u5757\u4e2d**\u53ef\u5199**\u5b57\u6bb5\u7684\u5217\u8868/\u5143\u7ec4\uff0c\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528 \u2018\\_\\_all\\_\\_' , \u53ef\u5199\u7684\u5b57\u6bb5\u76f8\u5f53\u4e8e\u540c\u65f6\u5177\u6709\u8bfb\u548c\u5199\u6743\u9650\uff0c\u53ef\u4ee5\u88abput/patch\u65b9\u6cd5\u8fdb\u884c\u66f4\u6539\u4e5f\u53ef\u4ee5\u88abget\u65b9\u6cd5\u83b7\u53d6\uff0c\u5982\u5728QuickStart\u4e2d\u7684\u4f8b\u5b50\n\n```python\nfield = Field(\n\t\treadonly=('username', 'register_date')\uff0c\n\t\twritable=('name', 'intro', 'avatar')\n)\n```\n\n  \u6240\u6709\u5b9a\u4e49\u5728readonly\u548cwritable\u4e2d\u7684\u5b57\u6bb5**\u90fd\u53ef\u4ee5**\u88abget\u5e8f\u5217\u5316\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u6839\u636e\u5b57\u6bb5\u662f\u5426\u53ef\u4ee5\u4fee\u6539\u5206\u6210\u8fd9\u4e24\u7c7b\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u4e0d\u5b58\u5728\u53ea\u80fd\u5199\u4e0d\u80fd\u8bfb\u7684\u5b57\u6bb5\n\n* **excludes**: \u5f53\u53ea\u8bfb\u6216\u53ef\u5199\u5b57\u6bb5\u4e3a\\_\\_all\\_\\_\u65f6\u7528\u6765**\u6392\u9664**\u4e00\u90e8\u5206\u5b57\u6bb5\u7684\u5217\u8868\uff0c\u4e00\u4e2a\u5e38\u89c1\u60c5\u51b5\u662f\u9700\u8981\u5e8f\u5217\u5316\u5168\u90e8\u5b57\u6bb5\uff0c\u9664\u4e86\u4e2a\u522b\u5b57\u6bb5\uff08\u5982\u79c1\u5bc6\u6027\u6570\u636e\uff09\uff0c\u8fd9\u65f6\u7528excludes\u5217\u8868\u6765\u6392\u9664\u5b83\u4eec\u6bd4\u8f83\u65b9\u4fbf\n\n* **filter**: \u6a21\u5757\u7684\u67e5\u8be2\u914d\u7f6e\uff0c\u652f\u6301\u524d\u7aef\u6839\u636e\u53c2\u6570\u8fdb\u884c\u7cbe\u786e/\u6a21\u7cca/\u6b63\u5219/\u8303\u56f4\u67e5\u8be2\uff0c\u4e0eid\u7684\u8bf7\u6c42\u65b9\u5f0f\u7684\u533a\u522b\u5728\u4e8e\uff0c\u65e0\u8bba\u67e5\u8be2\u4e3a\u7a7a\uff0c\u6709\u4e00\u4e2a\u8fd8\u662f\u591a\u4e2a\u7ed3\u679c\uff0c**\u90fd\u4f1a\u8fd4\u56de JSON\u5217\u8868 \uff08\u5305\u62ec\u7a7a\u5217\u8868\uff09**, filter\u53c2\u6570\u63a5\u53d7\u4e00\u4e2a\u5b57\u5178\uff0c\u5b57\u5178\u7684\u952e\u4e3a\u9700\u8981\u67e5\u8be2\u7684\u5b57\u6bb5\uff0c\u503c\u4e3a**Filter\u7ec4\u4ef6**\u7684\u5b9e\u4f8b\n\n```python\nfield = Field(\n    filter={\n    \t'name':Filter('%', '~')\n    }\n)\n```\n\n  \u4ee5\u4e0a\u4f8b\u5b50\u7684\u914d\u7f6e\u53ef\u4ee5\u5b9e\u73b0\u4ee5\u4e0b\u7684\u67e5\u8be2API\n\n```json\nGET /api/account?name%=meta\n```\n\n  \u5c06\u4f1a\u8fd4\u56de\u6240\u6709name\u5b57\u6bb5**\u5305\u542b**'meta'\u5b57\u7b26\u4e32\u7684\u8bb0\u5f55\u7684\u5e8f\u5217\u5316JSON\u5217\u8868\uff0c\u5176\u4e2d\u81ea\u52a8\u5316\u67e5\u8be2\u4f9d\u8d56\u7684\u5c31\u662fFilter\u7ec4\u4ef6\n\n\t##### 1.1.1 Filter \u7ec4\u4ef6\n\n  Filter\u7ec4\u4ef6\u662fUtilMeta\u4e2d\u8d1f\u8d23\u5b57\u6bb5\u67e5\u8be2\u7684\u7ec4\u4ef6\uff0c\u5bf9\u5e94\u62bd\u8c61django\u7684QuerySet\u67e5\u8be2API\uff0c\u53ef\u4ee5\u5c06\u524d\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\u89e3\u6790\u4e3a filter lookups\u5e76\u81ea\u52a8\u5b8c\u6210\u67e5\u8be2\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5373\u5141\u8bb8\u7684\u67e5\u8be2\u7c7b\u578b\uff0c\u57fa\u672c\u67e5\u8be2\u7c7b\u578b\u53ca\u5176\u5bf9\u5e94\u7684lookup\u5982\u4e0b\n\n```python\n{\n\t\t'': 'exact',\n\t\t'=': 'exact',\n\t\t'~=': 'iexact',\n\t\t'=%': 'startwith',\n\t\t'~%': 'istartwith',\n\t\t'%=': 'endwith',\n\t\t'%~': 'iendwith',\n\t\t'%': 'contains',\n\t\t'~': 'icontains',\n\t\t'>': 'gt',\n\t\t'<': 'lt',\n\t\t'>=': 'gte',\n\t\t'<=': 'lte',\n\t\t'$': 'regex',\n\t\t'~$': 'iregex'\n}\n```\n\n  \u6709\u51e0\u4e2a\u7279\u6b8a\u7684\u7b26\u53f7\u53ef\u4ee5\u4e0e\u4ee5\u4e0a\u7684\u90e8\u5206\u7b26\u53f7\u8fdb\u884c\u7ec4\u5408:\n\n  1. ! : \u53ef\u4ee5\u7528\u5728\u6240\u6709\u67e5\u8be2\u7b26\uff08\u9664\u4e86<, >, <=, >=\uff0c\u56e0\u4e3a\u53ef\u4ee5\u7b49\u6548\uff09**\u524d**\uff0c\u8868\u793a\u6c42\u8fd9\u4e2a\u67e5\u8be2\u6761\u4ef6\u7684\u8865\u96c6\uff08exclude\uff09\uff0c\u614e\u7528 ! ,\u4e0d\u6070\u5f53\u7684\u67e5\u8be2\u6761\u4ef6\u53ef\u80fd\u4f1a\u8f93\u51fa\u6240\u6709\u7684\u8868\u7ed3\u679c\n\n  2. ^ : \u53ef\u4ee5\u7528\u5728\u6240\u6709\u67e5\u8be2\u7b26\uff08\u9664\u4e86<, >, <=, >=\uff0c\u56e0\u4e3a\u6ca1\u6709\u610f\u4e49\uff09**\u540e**\uff0c\u8868\u793a\u5141\u8bb8\u5217\u8868\u503c\u7684\u67e5\u8be2\uff0c\u6bd4\u5982\n\n```python\n{\n\t 'id^':[2,3,4]\n}\n```\n\n  \u5c06\u4f1a\u8fd4\u56deid\u4e3a2/3/4\u7684\u4e09\u6761\u8bb0\u5f55\uff0c\u76f8\u5f53\u4e8e\u52a0\u4e86\u4e00\u4e2a__in\u7684lookup\uff0c\u4e4b\u6240\u4ee5\u5217\u8868\u503c\u67e5\u8be2\u6ca1\u6709\u8bbe\u8ba1\u6210\u6839\u636e\u8bf7\u6c42\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u533a\u5206\u662f\u56e0\u4e3a\u8fd8\u5b58\u5728\u7c7b\u4f3cArrayField\u8fd9\u79cd\u5217\u8868\u7c7b\u578b\u5b57\u6bb5\uff0c\u5355\u4e2a\u503c\u5217\u8868\u503c\u5206\u5f00\u7b26\u53f7\u67e5\u8be2\u4e5f\u65b9\u4fbf\u4e8e\u8bf7\u6c42\u7684\u89e3\u6790\uff0c\u56e0\u4e3aGET\u8bf7\u6c42\u4f20\u6765\u7684\u6570\u636e\u4ee5QueryDict\u5f62\u5f0f\uff0c\u6bcf\u4e2a\u5b57\u6bb5\u90fd\u5bf9\u5e94\u4e00\u4e2a\u503c\u5217\u8868\uff0c\u5982\u679c\u4e0d\u660e\u786e\u8bf7\u6c42\u8bed\u4e49\uff0c\u5f88\u5bb9\u6613\u9020\u6210\u89e3\u6790\u6df7\u6dc6\n\n  Filter\u7ec4\u4ef6\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u53ef\u8fb9\u957f\u53c2\u6570 *options, \u63a5\u53d7\u591a\u4e2a\u4ee5\u4e0a\u7684\u67e5\u8be2\u7b26\u6216\u67e5\u8be2\u7b26\u7ec4\u5408\uff0c\u4f8b\u5982\n\n```python\n'name': Filter('%=', '!~', '^')\n```\n\n  \u5f53\u6211\u4eec\u660e\u786e\u4e86\u8fd9\u4e9b\u7b26\u53f7\u6240\u4ee3\u8868\u7684\u67e5\u8be2\u610f\u4e49\uff0c\u63a5\u4e0b\u6765\u53c2\u6570\u7684\u610f\u4e49\u5728\u4e8e\u628a\u67e5\u8be2\u7b26\u548c\u67e5\u8be2\u65b9\u6cd5\u5339\u914d\uff0c\u8bd5\u60f3\u6211\u4eec\u53ef\u80fd\u5e0c\u671b\u6a21\u7cca\u67e5\u8be2\u6216\u53cd\u5411\u67e5\u8be2\u5e94\u7528\u4e8eGET\u8bf7\u6c42\uff0c\u4f46\u4f30\u8ba1\u4e0d\u4f1a\u5e0c\u671b\u5e94\u7528\u4e8eDELETE\u8bf7\u6c42\uff0c\u5426\u5219\u4f8b\u5982\n\n```json\nDELETE /api/account?name%=\n```\n\n  \u8fd9\u6837\u7684\u7a7a\u503c\u67e5\u8be2\u5728\u6743\u9650\u914d\u7f6e\u4e0d\u5f53\u7684\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5168\u90e8\u7528\u6237\u7684\u5220\u9664\uff0c\u6240\u4ee5\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u5371\u9669\u60c5\u51b5\u7684\u53d1\u751f\uff0cfilter\u652f\u6301\u4e3a\u4e0d\u540c\u7684\u65b9\u6cd5\u914d\u7f6e\u4e0d\u540c\u7684\u67e5\u8be2\u7b26\n\n  * **methods**: \u9ed8\u8ba4\u4e3a ('get',) \u5373\u6240\u6709\u67e5\u8be2\u53ea\u652f\u6301GET\u8bf7\u6c42\uff0c\u53ef\u4ee5\u6269\u5145\uff0c\u5176\u4e2d\u6bcf\u4e2a\u65b9\u6cd5\u5bf9\u5e94\u7684\u67e5\u8be2\u7b26\u90fd\u662f\u4ee5\u4e0a\u7684options\n  * **get/put/patch/delete**: \u8fd9\u56db\u4e2a\u53c2\u6570\u53ef\u4ee5\u5206\u522b\u6307\u5b9a\u6bcf\u4e2a\u65b9\u6cd5\u5bf9\u5e94\u7684\u67e5\u8be2\u7b26\u5217\u8868\n\n  \u8fd8\u6709\u53c2\u6570\u662f\u4e3a\u4e86\u9632\u6b62\u5371\u9669\u7684\u67e5\u8be2\u60c5\u51b5\u7684\n\n  * **one**: \u9ed8\u8ba4\u4e3afalse\uff0c \u5373\u8fd4\u56de\u7ed3\u679c\u4e3a\u5217\u8868\u503c\uff0c\u82e5\u67e5\u8be2\u4e3a\u7a7a\u5219\u8fd4\u56de\u7a7a\u5217\u8868\uff0cone=True\u65f6\u5f53\u4f7f\u7528\u8fd9\u4e2a\u5b57\u6bb5\u4f5c\u7b49\u503c\u67e5\u8be2\u65f6\u82e5\u67e5\u8be2\u6210\u529f\u5219\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\uff08json\u5bf9\u8c61\uff09\uff0c\u82e5\u67e5\u8be2\u5931\u8d25\u5219\u8fd4\u56de404\uff0c\u800c\u4e14\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b57\u6bb5\u9700\u8981\u6ee1\u8db3\u662f**unique**\u7684\n\n  * **empty_allowed**: \u662f\u5426\u5141\u8bb8\u7a7a\u503c\u67e5\u8be2\uff0c\u9ed8\u8ba4\u4e3aFalse\uff0c\u7a7a\u503c\u67e5\u8be2\u4f1a\u62a5400\n\n\n  Filter\u7ec4\u4ef6\u4e5f\u652f\u6301\u5bf9\u5173\u7cfb\u8868\u7684\u5b57\u6bb5\u8fdb\u884c\u67e5\u8be2\uff0c\u5e76\u6709\u53c2\u6570\n\n  * **relate_field**: \u9ed8\u8ba4\u4e3aid\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u5176\u4ed6\u7684\u5173\u7cfb\u8868\u7684\u5b57\u6bb5\uff0c\u4f8b\u5982\u4e00\u4e2a\u4f5c\u54c1\u6a21\u5757\u9700\u8981\u6839   \u636e\u4f5c\u8005\u540d\u5b57\u8fdb\u884c\u6a21\u7cca\u67e5\u8be2\uff0c\u5219\u5982\u6b64\u914d\u7f6e\n\n```python\n\t'creator': Filter('~', relate_field='name')\n```\n\n  \u90a3\u4e48\u751f\u6210\u7684\u67e5\u8be2API\n\n```json\n\tGET /api/work?creator~='zxl'\n```\n\n  \u5219\u4f1a\u67e5\u8be2\u8fd4\u56de\u6240\u6709\u4f5c\u8005\u540d\u5b57\u5ffd\u7565\u5927\u5c0f\u5199\u5730\u542b\u6709\u2019zxl'\u7684\u4f5c\u54c1\n\n\n\u53ef\u4ee5\u770b\u51fa\uff0c\u901a\u8fc7Filter\u5b57\u6bb5\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u751f\u6210\u591a\u6837\u5316\u7684\u5b57\u6bb5\u67e5\u8be2API\uff0c\u800c\u4e14\u53ef\u4ee5\u65b9\u4fbf\u7684\u638c\u63e1\u5404\u65b9\u6cd5\u7684\u67e5\u8be2\u6743\u9650\uff0c\u907f\u514d\u5371\u9669\u67e5\u8be2\n\n* **order**: \u5e8f\u5217\u5316\u7684\u6392\u5e8f\u914d\u7f6e\uff0c\u4e0eQuerySet\u7684order_by\u63a5\u53d7\u7684\u53c2\u6570\u4e00\u81f4\uff0c\u4e00\u4e2a\u5b57\u6bb5\u5217\u8868/\u5143\u7ec4\n\n```python\nfield = Field(order=('-register_date', 'id'))\n```\n\n  \u8fd9\u6837\u8bbe\u7f6e\u4f1a\u4f7f\u5e8f\u5217\u5316\u7684\u7ed3\u679c\u6309\u7167  (\u6ce8\u518c\u65e5\u671f\u7684\u5012\u5e8f\uff0c\u4e3b\u952e\u7684\u6b63\u5e8f) \u8fd9\u6837\u7684\u4f18\u5148\u7ea7\u6392\u5e8f\n\n* **relate**: \u5173\u8054\u8868\u7684\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u914d\u7f6e\uff0c\u53ef\u4ee5\u5c06\u5916\u952e\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3aJSON\u5bf9\u8c61\uff0c\u5c06\u591a\u5bf9\u591a\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3aJSON\u5217\u8868 (\u6216\u503c\u5217\u8868)\uff0c\u4e0efilter\u53c2\u6570\u7c7b\u4f3c\uff0crelate\u53c2\u6570\u63a5\u53d7\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2d\u952e\u4e3a\u5173\u7cfb\u5b57\u6bb5\u5b57\u7b26\u4e32\uff08\u8fd9\u91cc\u7684**\u5173\u7cfb**\u53ef\u4ee5\u6307\u4e00\u5bf9\u4e00\uff0c\u5916\u952e\uff0c\u591a\u5bf9\u591a\u4ee5\u53ca\u5b83\u4eec\u7684\u53cd\u5411\u5f15\u7528related_name\uff09, \u5176\u4e2d\u7684\u503c\u4e3a**Relate\u7ec4\u4ef6**\u7684\u5b9e\u4f8b\n\n```python\nfield = Field(\n\t\treadonly=['id', 'title'],\n\t\trelate={\n\t\t\t\t'creator': Relate(field=['id', 'name', 'avatar']),\n\t\t\t\t'tags': Relate(field='id', modify=True)\n\t\t}\n)\n```\n\n  Work\u6a21\u578b\u6709\u4e00\u4e2a\u6307\u5411\u7528\u6237\u7684creator\u5916\u952e\u548c\u591a\u5bf9\u591a\u5b57\u6bb5tags\uff0c\u5982\u6b64\u914d\u7f6erelate\u5c06\u4f1a\u4f5c\u7528\u4e8e\u5e8f\u5217\u5316\u7684\u7ed3\u679c\n\n```json\nGET /api/work?id=3\n<response>:\n{\n\t'id': 3,\n\t'title': 'utilmeta',\n\t'creator': {\n\t\t\t\t'id': 1,\n\t\t\t\t'name': 'zxl',\n\t\t\t\t'avatar': '/avatar/y21df4hsa.jpg'\n\t\t},\n\t'tags': [3,4,11]\n}\n```\n\n  \u53ef\u4ee5\u770b\u5230\u5173\u7cfb\u5b57\u6bb5\u4e5f\u51fa\u73b0\u5728\u4e86\u5e8f\u5217\u5316\u7ed3\u679c\u4e2d\uff0c\u5e76\u4e14\u6309\u7167\u914d\u7f6e\u7684\u5b57\u6bb5\u8fdb\u884c\u8fd4\u56de\uff0c\u5176\u4e2d\u4f9d\u8d56\u7684\u5c31\u662fRelate\u7ec4\u4ef6\n\n  ##### 1.1.2 Relate \u7ec4\u4ef6\n\n  pass\n\n* **annotate**: Field\u4e2d\u7684annotate\u53c2\u6570\u5141\u8bb8\u81ea\u5b9a\u4e49\u65b0\u7684\u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u540d\u79f0\u548c\u8fd4\u56de\u503c\uff0c\u4e0d\u53d7\u6a21\u5757\u7684\u6a21\u578b\u5b57\u6bb5\u7684\u9650\u5236\uff0cproxy\u53c2\u6570\u540c\u6837\u63a5\u53d7\u4e00\u4e2a\u5b57\u5178\uff0c\u5b83\u7684\u952e\u662f\u81ea\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\uff0c\u4f1a\u88ab\u63d2\u5165\u5e8f\u5217\u5316\u7ed3\u679c\u4e2d\uff0c\u503c\u6709\u56db\u79cd\u9009\u62e9\n\n```python\nfield = Field(\n\t\treadonly=['username', 'register_date'],\n\t\tannotate={\n\t\t\t\t'api_version': 'v1.2',\n\t\t\t\t'work_num': exp.Count('works'),\n\t\t\t\t'is_self': lambda self, user: self == user,\n\t\t\t\t'register_date': lambda val:val.strftime('%Y\u5e74%m\u6708%d\u65e5')\n\t\t}\n)\n```\n\n  1. **\u5e38\u91cf**\uff1a\u4e00\u4e2a**\u53ef\u4ee5\u88abJSON\u5e8f\u5217\u5316**\u7684\u5e38\u91cf\uff0c\u4f1a\u76f4\u63a5\u63d2\u5165\u5230\u7ed3\u679c\u4e2d\n\n  2. **\u8868\u8fbe\u5f0f**\uff1a\u4e00\u4e2adjango **Expression**, \u8fd9\u4e9b\u8868\u8fbe\u5f0f\u88abUtilMeta\u7684utils\u4e2d\u7684proxy\u8fdb\u884c\u6574\u7406\uff0c\u4ee5\u53ca\u5bfc\u5165\u5230\u4e86\u5f53\u524d\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\uff0c\u7528\u4ed6\u4eec\u53ef\u4ee5\u5b8c\u6210\u4e00\u4e9b\u7684**\u8ba1\u6570\uff0c\u8fd0\u7b97**\u7b49\u5904\u7406\n\n  3. **\u4ee3\u7406\u51fd\u6570**\uff1a\u4e00\u4e2a**callable** (\u51fd\u6570\uff0clambda\u8868\u8fbe\u5f0f\u6216\u542b\u6709\\_\\_call\\_\\_\u7684\u7c7b)\uff0c\u8fd9\u4e2a\u51fd\u6570\u9700\u8981\u4e09\u4e2a\u53ef\u9009\u7684\u53c2\u6570\n\n     * self: \u5bf9\u4e8e\u67e5\u8be2QuerySet\u4e2d\u7684\u6bcf\u4e2a**\u5b9e\u4f8b**\u90fd\u4f1a\u4f5c\u4e3aself\u53c2\u6570\u4f20\u9012\u5230\u8fd9\u4e2a\u51fd\u6570\u4e2d\n     * user: \u672c\u6b21\u8bf7\u6c42\u7684**\u7528\u6237**\u5bf9\u8c61\n     * data: \u8bf7\u6c42**\u6570\u636e**\u7684\u5b57\u5178\n\n     \u4ee3\u7406\u51fd\u6570\u7684\u53c2\u6570\u9700\u8981\u662f\u4e0a\u8ff0\u4e09\u4e2a\u53c2\u6570\u7684\u5b50\u96c6\uff0c\u5e76\u4e14\u8bf7**\u53ea\u58f0\u660e\u9700\u8981\u7684\u53c2\u6570**\uff0c\u4e0d\u9700\u8981\u7684\u53c2\u6570\u5c06\u4e0d\u4f1a\u52a0\u8f7d\n\n  4. **\u5904\u7406\u51fd\u6570**\uff1a\u6709\u4e00\u4e2a\u53c2\u6570\u7684**callable**\uff0c\u7528\u4e8e\u5bf9\u6a21\u578b\u5b57\u6bb5\u5e8f\u5217\u5316\u7684\u7ed3\u679c\u8fdb\u884c\u5904\u7406\uff0c\u5b83\u5bf9\u5e94\u7684\u503c**\u5fc5\u987b\u4e3a\u5df2\u7ecf\u58f0\u660e\u7684\u6a21\u578b\u5b57\u6bb5**\uff08\u5728readonly/writable\u6216relate\u7684\u952e\u4e2d\uff09\uff0c\u8be5\u6a21\u578b\u5b57\u6bb5\u5e8f\u5217\u5316\u7684\u7ed3\u679c\u4f1a\u4f5c\u4e3a\u53c2\u6570\u503c\u4f20\u5165\u8fd9\u4e2a\u51fd\u6570\u5e76\u5c06\u8fd4\u56de\u7684\u7ed3\u679c\u4f5c\u4e3a\u5e8f\u5217\u5316\u7684\u7ed3\u679c\n\n  \u9664\u4e86\u5bf9\u6a21\u578b\u5b57\u6bb5\u7684\u5904\u7406\u51fd\u6570\u5916\uff0c\u5176\u4ed6\u7684\u952e\u4e0d\u80fd\u4e0e\u6a21\u578b\u5b57\u6bb5\u51b2\u7a81\n\n  \u542b\u6709self\u53c2\u6570\u7684\u4ee3\u7406\u51fd\u6570\u7684\u4f7f\u7528\u4f1a\u4f7f\u5f97\u8bf7\u6c42\u6027\u80fd\u53d7\u5230\u4e00\u5b9a\u5f71\u54cd\uff08\u56e0\u4e3a\u9700\u8981\u5c06QuerySet\u4e2d\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u8fdb\u884c\u8fd4\u56de\uff09\uff0c\u6240\u4ee5\u5982\u679c\u80fd\u4f7f\u7528Expression\u65b9\u5f0f\u5b8c\u6210\u7684\u5c3d\u91cf\u4e0d\u7528\u4ee3\u7406\u51fd\u6570\uff0c\u5982\u4ee5\u4e0b\u4e24\u79cd\u76f8\u540c\u6548\u679c\u7684\u8868\u8fbe\u5f0f\u7b2c\u4e00\u79cd\u6027\u80fd\u66f4\u9ad8\n\n```python\n'work_num': exp.Count('works')\t\t# has better performance\n'work_num': lambda self: self.works.count()\n```\n\n  proxy\u5b57\u5178\u4e2d\u7684\u5b57\u6bb5\u6beb\u65e0\u7591\u95ee\u662f\u53ea\u8bfb\u7684\uff0c\u53ea\u652f\u6301GET\u65b9\u6cd5\n\n* **template**: \u6a21\u5757\u7684**\u6a21\u677f**\u914d\u7f6e\uff0c\u6a21\u677f\u5728UtilMeta\u4e2d\u662f\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6982\u5ff5\n\n##### 1.1.x \u66f4\u591a\u7684\u5b9a\u4e49\u65b9\u5f0f\n\n\u4ee5\u4e0a\u7684\u793a\u4f8b\u4e2d\uff0c\u5b9a\u4e49\u5b57\u6bb5\u7684\u65b9\u5f0f\u662f\u5b57\u6bb5\u5b57\u7b26\u4e32\u6216\u8005\u7528 '\\_\\_all\\_\\_' \u6307\u6240\u6709\u5b57\u6bb5\uff0c\u800c\u66f4\u52a0\u4fbf\u6377\u7684\u65b9\u5f0f\u662f\u6a21\u578b\u5c5e\u6027\u65b9\u5f0f\uff0c\u4ee5\u4e0b\u4e3a\u5b9e\u4f8b\n\n```python\nclass WorkMain(Module):\n    class Meta:\n        model = Work\n        field = Field(\n            readonly=[model.id, model.title],\n            relate={\n                model.creator: Relate(\n                    field=[\n                        Account.id, \n                        Account.name\n                        Account.avatar\n                    ]),\n                model.tags: Relate(field='id', modify=True)\n            }\n        )\n```\n\n\u53ea\u8981\u5b57\u6bb5\u662f\u6a21\u578b\u7684\u4e00\u4e2a\u5c5e\u6027\u5c31\u53ef\u4ee5\u7528\u4ee5\u4e0a\u65b9\u6cd5\u6765\u5b9a\u4e49\uff0c\u5f53\u6a21\u578b\u5b57\u6bb5\u53d1\u751f\u6539\u53d8\u65f6IDE\u4f1a\u53d1\u51fa\u8b66\u793a\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528IDE\u7684\u8865\u9f50\u529f\u80fd\u5feb\u901f\u5b8c\u6210\u5b9a\u4e49\uff0c\u4f46\u662f\u5982\u679c\u5b57\u6bb5\u6ca1\u6709\u8fd9\u4e2a\u5c5e\u6027\uff08\u5982related_name\u5f15\u7528\u5b57\u6bb5\u7b49\uff09\u5c31\u9700\u8981\u4ee5\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\u6765\u5b9a\u4e49\uff0c\u4e24\u79cd\u65b9\u5f0fUtilMeta\u90fd\u80fd\u6b63\u786e\u5904\u7406\n\n\n\n\u521d\u6b21\u4e4b\u5916\u5bf9\u5e94relate, filter, annotate\u7b49\u4ee5\u5b57\u5178\u65b9\u5f0f\u5b9a\u4e49\u7684\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2aSchema\u5b9e\u4f8b\uff0cSchema\u7ee7\u627f\u81eadict\uff0c\u5b83\u7684\u7279\u70b9\u662f\u5728\u5176\u4e0a\u5b9a\u4e49\u7684\u5c5e\u6027\u4f1a\u88ab\u8f6c\u6362\u4e3a\u952e\u503c\uff0c\u4f7f\u7528Schema\u7684\u597d\u5904\u662f\u65b9\u4fbf\u5728\u4e0d\u540c\u6a21\u5757\u95f4\uff0c\u7ee7\u627f\uff0c\u590d\u7528\u4e00\u4e9b\u5b57\u6bb5\u914d\u7f6e\uff0c\u800c\u4e14\u907f\u514d\u4e86\u4f7f\u7528\u5b57\u5178\u9020\u6210\u7684\u62f7\u8d1d\u95ee\u9898\n\n```python\nclass ContentAnnotate(Schema):\n    like_num = exp.Count('likes')\n    view_num = exp.Count('views')\n\n    def liked(self: Content, user: Account) -> bool:\n        if not user:\n            return False\n        return user in self.likes.all()\n\nclass MusicAnnotate(ContentAnnotate):\n    download_times = exp.Count('download_people')\n\nclass MusicMain(ContentMain):\n    class Meta:\n        model = Music\n        field = Field(\n            annotate=MusicAnnotate()\n        )\n\n```\n\n\u867d\u7136\u6a21\u578b\u7ee7\u627f\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u5b57\u5178\u5c5e\u6027\u7684\u7ee7\u627f\u548c\u66f4\u65b0\uff0c\u4f46\u662f\u5bf9\u4e8e\u76f8\u540c\u6a21\u5757\u6765\u8bf4\u8fd9\u662f\u4e00\u4e2a\u65b9\u4fbf\u7684\u65b9\u6cd5\n\n#### 1.2 Method \u7ec4\u4ef6\n\n#### 1.3 \u6a21\u578b\u7ee7\u627f\n\n\n\n### 2. \u6a21\u677f\u7cfb\u7edf Template System\n\n\u6a21\u677f\u7cfb\u7edf\u662fUtilMeta\u6570\u636e\u89e3\u6790\u7684\u4e2d\u67a2\u90e8\u5206\uff0c\u6709\u522b\u4e8eDjango\u4e2dHTML\u6a21\u677f\u7684\u542b\u4e49\uff0cUtilMeta\u4e2d\u7684\u6a21\u677f\u6307\u7684\u662f\u6570\u636e\u6a21\u677f\uff0c\u89c4\u8303\u8bf7\u6c42\u53c2\u6570\u7684\u7c7b\u578b\uff0c\u9650\u5236\u548c\u7ed3\u6784\uff0c\u8fc7\u6ee4\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u810f\u8bf7\u6c42\uff0c\u5e76\u80fd\u591f\u5c06\u8bf7\u6c42\u53c2\u6570\u5e8f\u5217\u5316\u4e3a\u8981\u6c42\u7684\u7ed3\u6784\n\n\u5bf9\u4e8e\u4e00\u4e2aUtilMeta\u9879\u76ee\uff0c\u5728\u542f\u52a8\u65f6\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a\u6839\u6a21\u677f\uff0c\u5176\u4e2d\u6709\u6240\u6709\u53ef\u80fd\u7684\u8bf7\u6c42\u8def\u5f84\u5df2\u7ecf\u5bf9\u5e94\u7684\u8bf7\u6c42\u6a21\u677f\u548c\u8fd4\u56de\u6a21\u677f\uff0c\u53ef\u4ee5\u8bf4\uff0c\u7528Util\u5728API\u5c42\u548cModule\u5c42\u505a\u7684\u5927\u90e8\u5206\u5b9a\u4e49\u6027\u6216\u914d\u7f6e\u6027\u7684\u5de5\u4f5c\u90fd\u4f1a\u8f6c\u6362\u4e3a\u6a21\u677f\u4e0a\u7684\u53c2\u6570\u6216\u8005\u9650\u5236\uff0c\u4e3a\u6574\u4e2a\u5e94\u7528\u670d\u52a1\uff0c\u5f53\u7136\uff0c\u6a21\u677f\u53ea\u8d1f\u8d23\u6570\u636e\u7684**\u89e3\u6790**\u548c**\u9a8c\u8bc1**\uff0c\u4e0d\u8d1f\u8d23\u4e1a\u52a1\u7684\u8fdb\u884c\u548c\u5177\u4f53\u7684\u6570\u636e\u64cd\u4f5c\uff0c\u90a3\u4e9b\u662fAPI\u548cModule\u5355\u5143\u4e2d\u7684\u903b\u8f91\u4ee3\u7801\u7684\u4efb\u52a1\n\n\u867d\u7136\u6839\u6a21\u677f\u662f\u4e00\u4f53\u7684\uff08\u662f\u6839API\u7684\u4e00\u4e2a\u5b57\u5178\u5143\u7d20\uff09\uff0c\u4f46\u62bd\u8c61\u4e0a\u6574\u4e2a\u6a21\u677f\u7cfb\u7edf\u5927\u4f53\u53ef\u4ee5\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\n\n#### 2.1 \u6a21\u677f\u7cfb\u7edf\u6982\u89c8\n\n1. **\u81ea\u52a8\u5316\uff08\u6ce8\u5165\u5f0f\uff09\u6a21\u677f**\n\n\u670d\u52a1\u4e8eModule\u7684\u6a21\u677f\uff0c\u901a\u8fc7\u5728Field\u4e2d\u7684\u5e8f\u5217\u5316\u914d\u7f6e\u548cMethod\u4e2d\u7684\u65b9\u6cd5\u914d\u7f6e\u751f\u6210\uff0c\u5b83\u4eec\u7684\u7c7b\u578b\uff0c\u9650\u5236\uff0c\u9ed8\u8ba4\u503c\u7b49\u90fd\u5728\u5b9a\u4e49\u6a21\u578b\u5b57\u6bb5\u65f6\u786e\u5b9a\uff0c\u5728\u6a21\u5757\u5316\u65f6UtilMeta\u63a5\u7ba1\u4e86\u8fd9\u90e8\u5206\u6a21\u677f\u7684\u751f\u6210\uff0c\u800c\u4e14\u8fd9\u90e8\u5206\u57fa\u672c\u7684\u589e\u5220\u6539\u67e5\u6846\u67b6\u4f1a\u81ea\u52a8\u5904\u7406\uff0c\u4e5f\u65e0\u9700\u7f16\u5199\u903b\u8f91\u4ee3\u7801\u548c\u7c7b\u578b\u63d0\u793a\uff0c\u5f00\u53d1\u8005\u5982\u679c\u9700\u8981\u66f4\u5b9a\u4e49\u590d\u6742\u7684\u9650\u5236\u6216\u989d\u5916\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528**\u6ce8\u5165**\u7684\u65b9\u5f0f\u53ea\u5f71\u54cd\u76ee\u6807\u53c2\u6570\uff0c\u5728Field\u7ec4\u4ef6\u4e2d\u63d0\u4f9b\u4e86\u8fd9\u6837\u7684\u63a5\u53e3 template\u53c2\u6570\uff0c\u901a\u8fc7\u4f20\u5165\u4e00\u4e2a\u5b57\u5178\u53ef\u4ee5\u5c06\u952e\u5bf9\u5e94\u7684\u53c2\u6570\u7684\u89c4\u5219\u8fdb\u884c\u6ce8\u5165\u878d\u5408\uff0c**\u6ce8\u5165\u539f\u5219\u662f\u89c4\u5219\u53ea\u80fd\u589e\u591a\u4e0d\u80fd\u51cf\u5c11**\uff0c\u56e0\u4e3a\u4e00\u4e9b\u6570\u636e\u5e93\u5c42\u9762\u7684\u9650\u5236\uff08\u5982\u6700\u5927\u957f\u5ea6\u7b49\uff09\u88ab\u57fa\u7840\u7684\u89c4\u5219\u4fdd\u8bc1\uff0c\u65b0\u6ce8\u5165\u7684\u89c4\u5219\u53ea\u80fd\u66f4\u52a0\u4e25\u683c\u5426\u5219\u53ef\u80fd\u5728\u8fd0\u884c\u65f6\u5f15\u53d1\u6570\u636e\u5e93\u5199\u5165\u9519\u8bef\n\n2. **\u5b9a\u4e49\u5f0f\u6a21\u677f**\n\n\u5728API\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u8bf7\u6c42\u8def\u5f84\uff0c\u8bf7\u6c42\u53c2\u6570\uff0c\u8bf7\u6c42\u4f53\u4f5c\u51fa\u7ec6\u81f4\u7684\u9650\u5236\u6a21\u677f\uff0c\u6765\u6ee1\u8db3\u590d\u6742\u7684\uff0c\u5b9a\u5236\u5316\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u8fd9\u4e00\u90e8\u5206\u901a\u5e38\u501f\u52a9Schema\u7ec4\u4ef6\u548cRule\u7ec4\u4ef6\u5b8c\u6210\uff0cSchema\u7ec4\u4ef6\u662f\u4e00\u4e2a\u7ee7\u627f\u81eadict\u7684\u7c7b\uff0c\u7ee7\u627f\u81eaSchema\u7684\u7c7b\u53ef\u4ee5\u4f7f\u7528\u7c7b\u6210\u5458\u7c7b\u578b\u6ce8\u91ca\u7684\u65b9\u6cd5\u5b9a\u4e49\u6570\u636e\u7684\u7ed3\u6784\u7c7b\u578b\uff0c\u4e5f\u53ef\u4ee5\u7ed3\u5408Rule\u53bb\u8be6\u7ec6\u5236\u5b9a\u53c2\u6570\u7684\u89c4\u5219\uff0cSchema\u652f\u6301\u5c5e\u6027\u8bbf\u95ee\u548c\u5b57\u5178\u952e\u8bbf\u95ee\u4e24\u79cd\u8bbf\u95ee\u65b9\u5f0f\uff0c\u800c\u4e14\u4fee\u6539\u4e0e\u5220\u9664\u662f\u540c\u6b65\u7684\uff0c\u65e2\u5229\u7528\u4e86\u7c7b\u5c5e\u6027\u81ea\u52a8\u63d0\u793a\u7684\u65b9\u4fbf\u529f\u80fd\uff0c\u8fd8\u53ef\u4ee5\u65b9\u4fbf\u7684\u5411\u6570\u636e\u6a21\u5757\u4e2d\u4f20\u9012\u6570\u636e\u548c\u8fd4\u56de\u6570\u636e\uff0c\u7136\u540e\u901a\u8fc7\u51fd\u6570\u53c2\u6570\u7c7b\u578b\u63d0\u793a\u7684\u65b9\u5f0f\u7ed1\u5b9a\u5230API\u4e2d\n\nSchema\u7c7b\u53ef\u4ee5\u901a\u8fc7\u5b9e\u4f8b\u5316\u7684\u65b9\u5f0f\u63a5\u53d7\u5e76\u9a8c\u8bc1\u6570\u636e\u5f97\u5230\u4e00\u4e2aSchema\u5b9e\u4f8b\uff0c\u7531\u4e8eSchema\u7ee7\u627fdict\uff0c\u5b57\u5178\u7c7b\u7684\u65b9\u6cd5\u5305\u62ec ** \u53cc\u661f\u53f7\u6620\u5c04\u4e5f\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\n\n```python\nclass Item(Schema):\n    id: int\n    name: str\n\nclass AccountData(Schema):\n    name: str = 'default'\n    password = Rule(len=(3, 20))\n    item_list: List[Item]\n\nclass GroupData(AccountData):\n    members: List[AccountData] = []\n\naccount_data = AccountData(\n    name='python group',\n    password='abc123',\n    item_list=[Item(id=3, name='it1')]\n)\n\ngroup_data = GroupData(**account_data, members=[AccountData(...), ...])\n\n```\n\n\u5728\u5b9a\u4e49\u6a21\u677f\u65f6\u9700\u6ce8\u610f\u4e24\u70b9\n\n1. \u53c2\u6570\u540d\u79f0\u4e0d\u80fd\u4ee5 \\_\\_ \uff08\u53cc\u4e0b\u5212\u7ebf\uff09\u5f00\u5934\u7ed3\u5c3e\uff0c\u8fd9\u6837\u7684\u53d8\u91cf\u4f5c\u4e3a\u7c7b**\u4fdd\u7559\u53d8\u91cf**\u4e0d\u4f1a\u6dfb\u52a0\u5230\u6a21\u677f\u4e2d\n2. \u7531\u4e8eSchema\u7ee7\u627f\u81eadict\u5b57\u5178\u7c7b\uff0c\u63d0\u4f9b\u5c5e\u6027\u8bbf\u95ee\u548c\u952e\u8bbf\u95ee\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5b57\u5178\u7684\u6b63\u5e38\u529f\u80fd\uff0c\u7c7b\u53d8\u91cf\u7684\u547d\u540d\u9700\u8981**\u907f\u5f00\u5b57\u5178\u7684\u65b9\u6cd5\u540d\u79f0**\uff0c\u5982 get, pop , update, clear, values, items, keys\u7b49\n\n\u8fd9\u90e8\u5206\u7684\u6a21\u677f\u662f\u975e\u5e38\u7075\u6d3b\u7684\uff0c\u4e0d\u662f\u5f3a\u5236\u7ed1\u5b9a\u7684\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u53e6\u8d77\u4e00\u4e2a\u6587\u4ef6\uff0c\u5f15\u5165Schema\u548ctyping\uff0c\u4e13\u95e8\u7528\u4e8e\u5b9a\u4e49\u53c2\u6570\u6a21\u677f\uff0c\u5176\u4e2d\u53ef\u6d3b\u7528\u7ee7\u627f\u91cd\u7528\u53c2\u6570\u8bbe\u7f6e\uff0c\u7136\u540e\u5728API\u4e2d\u8fdb\u884c\u5f15\u5165\u5e76\u5bf9\u53c2\u6570\u4f5c\u7c7b\u578b\u63d0\u793a\n\n\u63a5\u4e0b\u6765\u5c06\u91cd\u70b9\u4ecb\u7ecd\u5b9a\u4e49\u5f0f\u6a21\u677f\u7684\u8bf7\u6c42\u6570\u636e\u89e3\u6790\u89c4\u5219\uff0c\u8bf7\u6c42\u6570\u636e\u5728\u8fd9\u91cc\u7684\u6982\u5ff5\u662f\u8bf7\u6c42\u643a\u5e26\u7684\u4fe1\u606f\u548c\u6570\u636e\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u5305\u542b\u4e09\u90e8\u5206\n\n1. \u8bf7\u6c42URL\n2. \u8bf7\u6c42QueryString\n3. \u8bf7\u6c42\u4f53\n\n\u5b9a\u4e49\u5f0f\u6a21\u677f\u7684\u5de5\u4f5c\u5c31\u662f\u5c06\u8bf7\u6c42\u7684\u8def\u5f84\uff0c\u53c2\u6570\uff0c\u8bf7\u6c42\u4f53\u6620\u5c04\u89e3\u6790\u5230\u5bf9\u5e94\u51fd\u6570\u53c2\u6570\u4e0a\uff0c\u5e76\u4fdd\u8bc1\u8f6c\u5316\u4e3a\u5b9a\u4e49\u597d\u7684\u6570\u636e\u7ed3\u6784\u548c\u6ee1\u8db3\u76f8\u5e94\u7684\u9650\u5236\n\n#### 2.2 URL\u4e2d\u4f20\u53c2\n\n\u5728URL\u4e2d\u4f20\u9012\u6570\u636e\u662f\u6bd4\u8f83\u666e\u904d\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50\n\n```python\n# GET /api/doc/code.python/3#framework\n# GET /api/doc/code.python/3\n# GET /api/doc/code.python\n\n@api.get(path='{0}.{1}/{page}#{item}')\ndef doc(self, major, category: str, \n        page: int = None, item: str = None):\n    print(args) # ('code', 'python')\n    print(page) # 3\n    print(item) # 'framework'\n```\n\nURL\u7684\u53c2\u6570\u5339\u914d\u5b57\u7b26\u4e32\u7531@api\u88c5\u9970\u5668\u4e2d\u7684path\u53c2\u6570\u5b9a\u4e49\uff0c\u7c7b\u4f3cpython\u5b57\u7b26\u4e32format\u7684\u89c4\u5219\uff0c\u53ef\u4ee5\u5b9a\u4e49**\u987a\u5e8f\u53c2\u6570**\u548c**\u5177\u540d\u53c2\u6570**\u3002URL\u53c2\u6570\u4e2d\u7684\u987a\u5e8f\u53c2\u6570 {0}, {1} ... \u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u524d\u540e\u987a\u5e8f\u5fc5\u987b\u662f\u8fde\u7eed\u5730\u4ece\u5c0f\u5230\u5927\uff0c\u5728\u51fd\u6570\u4f20\u53c2\u4e2d\u5c06\u4f5c\u4e3a\u987a\u5e8f\u53c2\u6570\u4f20\u5165\u51fd\u6570 self \u540e\u7684\u5bf9\u5e94\u4f4d\u7f6e\u53c2\u6570\uff0cURL\u4e2d\u7684\u5177\u540d\u53c2\u6570\u662f\u4ee5\u952e\u503c\u53c2\u6570\u7684\u65b9\u5f0f\u4f20\u5165\u51fd\u6570\u4e2d\u5bf9\u5e94\u540d\u79f0\u7684\u53c2\u6570\uff0c\u5728URL\u4e2d\u5b9a\u4e49\u591a\u4e2a\u53c2\u6570\u65f6\uff0c\u53c2\u6570\u548c\u53c2\u6570\u76f4\u63a5\u5fc5\u987b\u6709\u5b57\u7b26\u4e32\u4f5c\u4e3a**\u5206\u5272**\uff0c\u8fd9\u4e2a\u5b57\u7b26\u4e32\u901a\u5e38\u4e3a\u4e0b\u5212\u7ebf   **/ **\n\n\u8981\u6ce8\u610f\u6b64\u65f6\u51fd\u6570\u7684\u540d\u79f0\u4f9d\u7136\u6709\u6548\uff0c\u4f5c\u4e3a\u4e00\u6bb5URL\u8def\u5f84\uff0cpath\u4e2d\u662f \u2018\u5269\u4f59\u2019 \u7684URL\u8def\u5f84\n\n##### 2.2.1 \u53c2\u6570\u7701\u7565\u7684\u89c4\u5219\n\n\u53c2\u6570\u53ef\u4ee5**\u5411\u540e\u7701\u7565**\uff0citem\u53c2\u6570\u6709\u9ed8\u8ba4\u503c\uff0c\u5c31\u53ef\u4ee5\u5339\u914d /api/doc/code.python/3 \u7684\u8def\u5f84\uff0c**\u9ed8\u8ba4\u53c2\u6570\u8fde\u540c\u524d\u9762\u7684\u5206\u9694\u5b57\u7b26\u4e32\u4e00\u540c\u7701\u7565**, \u4f9d\u6b64\u7c7b\u63a8\uff0c\u4ece\u540e\u5f80\u524d\uff0c\u6240\u6709\u7684\u9ed8\u8ba4\u53c2\u6570\u90fd\u53ef\u4ee5\u7701\u7565\uff0c**\u4e0ePython\u51fd\u6570\u5b9a\u4e49\u89c4\u5219\u4e00\u6837**\uff0c\u4e0d\u80fd\u51fa\u73b0\u9760\u524d\u7684\u8def\u5f84\u53c2\u6570\u53ef\u4ee5\u7701\u7565\u800c\u9760\u540e\u7684\u4e0d\u884c\u7684\u60c5\u51b5\n\n\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u4e4b\u4e00\u7684\u53c2\u6570\u5373\u89c6\u4f5c\u53ef\u4ee5\u7701\u7565\n\n1. **\u53c2\u6570\u6709\u4e00\u4e2a\u57fa\u672c\u53d8\u91cf\u7684\u9ed8\u8ba4\u503c\uff08\u4e0d\u80fd\u4e3aRule\uff09**\n\n```python\ndef doc(self, item: str = None, # not require\n\t\t\t\tpage: int = Rule(ge=1, le=10) # required\n\t\t\t ):\n\t\tpass\n```\n\n2. **\u53c2\u6570\u6709\u4e00\u4e2aRule\u5b9e\u4f8b\u4f5c\u4e3a\u9ed8\u8ba4\u503c\uff0c\u5728Rule\u4e2d\u8bbe\u7f6edefault\u6216require=False**\n\n```python\ndef doc(self, page: int = Rule(ge=1, le=10, default=1)\t# not require\n\t\t\t\titem: str = Rule(require=False)\t\t\t# not require\n\t\t\t ):\n\t\tpass\n```\n\n\u4ee5\u4e0a\u7684\u60c5\u51b5\uff0c\u65e0\u8bba\u662f\u76f4\u63a5\u8bbe\u7f6e\u5e38\u91cf\u9ed8\u8ba4\u503c\u8fd8\u662f\u5728Rule\u4e2d\u8bbe\u7f6edefault\uff0c\u5728\u53c2\u6570\u7f3a\u5931\u65f6\u51fd\u6570\u53c2\u6570\u4f1a\u88ab\u4f20\u9012\u8fd9\u4e2a\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c\uff0c\u7136\u800c\u5f53\u53ea\u5728Rule\u4e2d\u8bbe\u7f6e require=False \u800c\u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u7684\u60c5\u51b5\u5bf9\u5e94\u7684\u51fd\u6570\u53c2\u6570\u4f1a\u88ab\u4f20\u5165 ...\uff08\u7701\u7565\u53f7 **Ellipsis**\uff09\uff0c\u9700\u8981\u7279\u522b\u6ce8\u610f\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u51fd\u6570\u53c2\u6570\u8fd8\u662f\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u6bd4\u8f83\u65b9\u4fbf\uff0cRule(require=False)\u4e3b\u8981\u7528\u4e8e\u5b57\u5178\u6570\u636e\u7684\u6a21\u677f\uff0c\u8bf7\u6c42\u4e2d\u7f3a\u5931\u7684\u6b64\u7c7b\u53c2\u6570\u4e0d\u4f1a\u51fa\u73b0\u5728\u5b57\u5178\u6570\u636e\u4e2d\n\n3. **\u987a\u5e8f\u53c2\u6570\u4e2d\u51fa\u73b0 *args \u53d8\u91cf**\n\n```python\n@api.get(path='{0}/{1}/{3}')\ndef eg(self, first, *others):\n\t\tpass\n```\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u9664\u4e86\u7b2c\u4e00\u4e2a\u987a\u5e8f\u53c2\u6570 {0} \u4e0d\u80fd\u7701\u7565\u5916\uff0c\u5176\u4ed6\u7684\u987a\u5e8f\u53c2\u6570\u7531\u4e8e\u6709\u53d8\u957f\u53c2\u6570\u7684\u5b58\u5728\u800c\u53ef\u4ee5\u7701\u7565\n\n4. **\u5177\u540d\u53c2\u6570\u4e2d\u51fa\u73b0 \\*\\*kwargs \u53d8\u91cf**\n\n```python\n@api.get(path='{0}/{id}/{field}#{annotate}')\ndef doc(self, model, id: int, **kwargs):\n\t\tpass\n```\n\u7531\u4e8e\u51fa\u73b0 ** \u952e\u503c\u53d8\u91cf\uff0cid\u540e\u9762\u7684\u5177\u540d\u53c2\u6570\u5c31\u662f\u53ef\u7701\u7565\u7684\n\n\u53ea\u80fd\u5411\u540e\u7701\u7565\u7684\u89c4\u5219\u4e5f\u5f88\u660e\u663e\uff0c\u53ef\u4ee5\u770b\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\n\n```python\n@api.get(path='{0}.{1}/{page}#{item}')\ndef doc(self, *classes, page: int, item: str = None):\n    # Invalid\n\t\tpass\n```\n\n\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u987a\u5e8f\u53c2\u6570\u7531\u4e8e\u4f7f\u7528\u4e86\u53d8\u957f\u7684\u987a\u5e8f\u53c2\u6570\u53d8\u91cf *classes\uff0c\u6240\u4ee5\u4e24\u4e2a\u987a\u5e8f\u53c2\u6570\u90fd\u662f\u53ef\u7701\u7565\u7684\uff0c\u7136\u800c\u5728\u987a\u5e8f\u53c2\u6570**\u540e\u9762** (\u8fd9\u91cc\u6307\u5728\u8def\u5f84\u5b57\u7b26\u4e32\u4e2d) \u7684page\u53c2\u6570\u5374\u4e0d\u53ef\u7701\u7565\uff0c\u8fd9\u662f\u505a\u4e0d\u5230\u7684\uff0c\u6240\u4ee5\u987a\u5e8f\u53c2\u6570\u7684\u7701\u7565\u6ca1\u6709\u610f\u4e49\uff0c\u6b64\u65f6\u4f1a\u62a5\u9519\n\n##### 2.2.2 \u6b63\u5219\u8868\u8fbe\u5f0f\u5b9a\u4e49\u8def\u5f84\n\n\u9664\u4e86\u4f7f\u7528path\u8fd9\u79cdformat\u6807\u51c6\u7684\u65b9\u5f0f\u4ee5\u5916\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4f20\u7edf\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff0c\u5728@api\u88c5\u9970\u5668\u7684reg\u53c2\u6570\u5b9a\u4e49\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u7684\u7ed3\u679c\u6309\u7167\u987a\u5e8f\u5206\u53d1\u4e3a\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 ?P \u8868\u8fbe\u5f0f\u5206\u53d1\u5177\u540d\u53c2\u6570\uff0c\u6240\u4ee5\u53c2\u6570\u5747\u4e0d\u53ef\u4ee5\u7701\u7565\n\n```python\n@api.get(reg='^([a-z]{4,6})\\.([a-z]{4,10})/(?P<page>\\d{1,3})#(?P<item>[a-z]{3,10})$')\ndef doc(self, *args, page: int, item: str):\n\t\tpass\n```\n\n\u4f7f\u7528\u6b63\u5219\u548c\u4f7f\u7528\u666e\u901a\u5339\u914d\u540e\u7528\u76f8\u540c\u7684\u6b63\u5219\u4f5c\u4e3aRule\u8fdb\u884c\u9a8c\u8bc1\u7684\u6548\u679c\u5927\u81f4\u76f8\u540c\uff0c\u4f46\u662f\u5f53\u6b63\u5219\u5339\u914d\u5931\u8d25\u65f6\u4f1a\u8fd4\u56de404\uff0c\u4f46\u5f53\u53c2\u6570\u5339\u914d\u6210\u529f\u4f46\u6b63\u5219\u9a8c\u8bc1\u5931\u8d25\u65f6\u4f1a\u8fd4\u56de400\n\n#### 2.3 \u5728QueryString\u4e2d\u4f20\u53c2\n\n##### 2.3.1 \u53ea\u5728\u8bf7\u6c42\u4f53\u4e2d\u4f20\u53c2\n\n\u5bf9\u4e8e\u4e00\u4e9b\u67e5\u8be2\u64cd\u4f5c\u7b49\uff0c\u5728URL\u7684QueryString\u4e2d\u4f20\u5165\u952e\u503c\u5bf9\u4e5f\u662f\u5f88\u666e\u904d\u7684\u65b9\u5f0f\n\n```python\n# GET /api/doc?page=3&item=framework\n@api.get\ndef doc(self, page: int, item: str):\n    print(page) # 3\n    print(item) # 'framework'\n```\n\n\u53ea\u8981\u4e0d\u53bb\u5b9a\u4e49path\u6216reg\u5b57\u7b26\u4e32\uff0c\u51fd\u6570\u4e2d\u9664\u4e86self\u5916\u7684\u53c2\u6570\u5c06\u4f1a\u4f5c\u4e3aQueryString\u4e2d\u7684\u53c2\u6570\u6a21\u677f\uff0c\u5982\u679c\u4f60\u60f3\u628a\u8fd9\u4e9b\u53c2\u6570\u6574\u5408\u5230\u4e00\u4e2aSchema\u4e2d\u5b9a\u4e49\uff0c\u53ef\u4ee5\u4f7f\u7528\n\n```python\nclass QuerySchema(Schema):\n    page: int = Rule(ge=1, le=10)\n    item: str = Rule(len=(3, 20), default=None)\n\nclass CommonAPI(API):\n    @api.get\n    def doc(self, query: QuerySchema = Schema.Param):\n        print(query.page) # 3\n        print(query.item) # 'framework'\n```\n\n\u4f46\u662f\u8fd9\u79cd\u5355\u72ec\u6307\u5b9aSchema.Param\u7684\u65b9\u5f0f\u5fc5\u987b\u4fdd\u8bc1\u76f8\u5e94\u53c2\u6570\u7684\u7c7b\u578b\u63d0\u793a\u662fdict\u7684\u5b50\u7c7b (Schema\u4e3adict\u7684\u5b50\u7c7b)\uff0c\u56e0\u4e3aQueryString\u4e2d\u7684\u53c2\u6570\u662f\u4ee5\u952e\u503c\u5bf9\u65b9\u5f0f\u5b9a\u4e49\u7684\uff0c\u6240\u4ee5\u5fc5\u5b9a\u4f1a\u8f6c\u5316\u4e3a\u4e00\u4e2a\u5b57\u5178\n\n##### 2.3.2 \u540c\u65f6\u5728URL\u548cQueryString\u4e2d\u4f20\u53c2\n\n\u5148\u770b\u4e00\u4e2a\u4f8b\u5b50\n\n```python\n# DELETE /api/log/2019/10/INFO?status=200\n@api.delete(path='{0}/{1}/{level}')\n    def log(self, year: int = Rule(ge=2000, le=2020, default=None), \n            month: int = Rule(ge=1, le=12, default=None), \n            level: str = Rule(choices=['INFO', 'WARN', 'ERROR'], default=None),\n            status: int = Rule(ge=100, le=600, default=200)\n           ):\n        print(year, month, level, status)\n        data = {k: v for k, v in self.data.items() if v is not None}\n        return self.module.filter(**data).delete()\n```\n\n\u5728\u51fd\u6570\u53c2\u6570\u4e2d\uff0c\u9664\u4e86path\u4e2d\u5b9a\u4e49\u7684\u987a\u5e8f\u53c2\u6570\u548c\u5177\u540d\u53c2\u6570\u5916\uff0c\u4f59\u4e0b\u7684\u53c2\u6570\u5c31\u662fQueryString\u4e2d\u7684\u53c2\u6570\u4e86\n\n\u6839\u636e\u53c2\u6570\u7684\u7701\u7565\u89c4\u5219\n\n```json\nDELETE /api/log?status=200\t\t\t// year=None, month=None, level=None, status=200\nDELETE /api/log/2019?status=200\t    // year=2019, month=None, level=None, status=200\nDELETE /api/log/INFO\t\t\t\t// Invalid (apply the rule of 'year' in 'INFO')\n```\n\n\u4ece\u4e0a\u9762\u7684\u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa\u8fd9\u4e2a\u63a5\u53e3\u7684\u53c2\u6570\u8bbe\u8ba1\u662f\u6709\u95ee\u9898\u7684\uff0c\u5e94\u8be5\u4e5f\u5141\u8bb8\u5ffd\u7565\u65f6\u95f4\u67e5\u8be2 level='INFO' \u7684\u65e5\u5fd7\uff0c\u6240\u4ee5\u5e94\u8be5\u628alevel\u8fd9\u4e2a\u53c2\u6570\u4eceURL\u4e2d\u8f6c\u79fb\u5230QueryString\u4e2d\uff0c\u5373\u5220\u9664path\u4e2d\u7684 { level } \uff0c \u800c\u4e14\u6211\u4eec\u603b\u7ed3\u51fa\u7684\u7ecf\u9a8c\u4e5f\u662f\uff0c\u5bf9\u4e8e\u5982**\u65e5\u671f\uff0c\u5206\u7c7b\u7b49\u53ef\u4ee5\u5411\u540e\u7701\u7565\u7684\u6570\u636e**\u9002\u5408\u4e8eURL\u67e5\u8be2\uff0c\u800c**\u5e73\u884c\u8bed\u4e49**\u7684\u67e5\u8be2\u9002\u5408\u653e\u5728QueryString\u4e2d\n\n#### 2.4 \u63a5\u53d7\u8bf7\u6c42\u4f53\u4e2d\u7684\u6570\u636e\n\n\u5bf9\u4e8ePUT / PATCH / POST\u65b9\u6cd5\u6765\u8bf4\uff0c\u8bf7\u6c42\u8fd8\u4f1a\u5305\u62ec\u8bf7\u6c42\u4f53\u6570\u636e\uff0c\uff08\u867d\u7136GET/DELETE\u65b9\u6cd5\u4e5f\u80fd\u643a\u5e26\u8bf7\u6c42\u4f53\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u91cc\u7ea6\u5b9a\u9650\u5236\u4e0d\u80fd\u4f7f\u7528\uff09\uff0c\n\u8bf7\u6c42\u4f53\u6570\u636e\u7684\u7c7b\u578b\u5f88\u591a\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2ajson\uff0c\u4e00\u4e2a\u53ef\u80fd\u5305\u542b\u6587\u4ef6\u7684\u8868\u5355\uff0c\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u6216\u8005\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u8bf7\u6c42\u4f53\u4e00\u822c\u4f7f\u7528\u7c7b\u578b\u63d0\u793a\u660e\u786e\u7c7b\u578b\u6765\u5b9a\u4e49\uff0c\u5177\u4f53\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\n\n```python\nclass DataSchema(Schema):\n    title: str = Rule(len=(3, 20))\n    description: str = ''\n\nclass FormSchema(DataSchema):\n    image: Media.File = None\n\nclass MediaAPI(API):\n    @api.upload\n    def upload(self, file: Media.File = Schema.Body):\n        print(self.META['CONTENT_TYPE'])\t# application/octet-stream\n\n    def post(self, data: FormSchema = Schema.Body):\n        print(self.META['CONTENT_TYPE'])\t# multipart/form-data\n\n    @api.put\n    def batch(self, data: typing.List[DataSchema] = Schema.Body):\n        print(self.META['CONTENT_TYPE'])\t# application/json\n```\n\n\u5728UtilMeta\u4e2d\uff0c\u6587\u4ef6\u7684\u7c7b\u578b\u5c31\u662fMedia.File\uff0cMedia\u662f\u5a92\u4f53\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u6587\u4ef6\u7684\u4fdd\u5b58\uff0c\u6d41\u5f0f\u5316\uff0c\u4e0b\u8f7d\u7b49\uff0c\u5728upload\u51fd\u6570\u4e2d\u5355\u72ec\u7528File\u7c7b\u578b\u4f5c\u4e3a Body\uff0c\u8868\u793a\u63a5\u53d7\u4e8c\u8fdb\u5236\u6d41\u6587\u4ef6\u4f5c\u4e3a\u8bf7\u6c42\u4f53\uff0c\u76f8\u5e94\u7684Content-Type\u4e5f\u662f\u4e3aapplication/octet-stream\uff0c\u800cpost\u51fd\u6570\u7528FormSchema\u4f5c\u4e3a\u8bf7\u6c42\u4f53\uff0cFormSchema\u7ee7\u627f\u81eaDataSchema\uff0c\u7531\u4e8e\u5176\u4e2d\u65e2\u6709\u666e\u901a\u6570\u636e\u53c8\u6709\u6587\u4ef6\uff0c\u6240\u4ee5\u5e94\u8be5\u4f7f\u7528 multipart/form-data\u4f5c\u4e3a\u63d0\u4ea4\u6570\u636e\u7c7b\u578b\uff0cbatch\u51fd\u6570\u662f\u4e00\u4e2a\u6279\u91cf\u66f4\u65b0\u63a5\u53e3\uff0c\u4f7f\u7528List[Schema]\u4f5c\u4e3a\u7c7b\u578b\u63d0\u793a\u8868\u793a\u63a5\u53d7\u4e00\u4e2ajson\u6570\u7ec4\u4f5c\u4e3a\u8bf7\u6c42\u6570\u636e\uff0c\u800c\u5bf9\u5e94\u7684Schema\u4e2d\u4e0d\u5b58\u5728\u6587\u4ef6\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528json\u683c\u5f0f\u7684\u6570\u636e \n\n#### 2.5 \u540c\u65f6\u5728URL\uff0cQueryString\u548c\u8bf7\u6c42\u4f53\u4e2d\u4f20\u9012\u6570\u636e\n\n\u5bf9\u4e8e\u8fd9\u79cd\u590d\u6742\u7684\u60c5\u51b5\uff0cUtilMeta\u91c7\u7528**\u6807\u8bc6\u548c\u6392\u9664**\u7684\u65b9\u6cd5\u5bf9\u53c2\u6570\u8fdb\u884c\u8bf7\u6c42\u7c7b\u578b\u7684\u5212\u5206\uff0c\u9996\u5148\u786e\u5b9a\u7684URL\u4e2d\u7684\u53c2\u6570\uff0c\u5b83\u4eec\u7684\u987a\u5e8f\u548c\u5173\u952e\u5b57\u5728\u51fd\u6570\u4e2d\u5f97\u5230\u6807\u8bc6\uff0c\u5269\u4f59\u7684\u53c2\u6570\u9ed8\u8ba4\u5c06\u4f5c\u4e3aQueryString\u4e2d\u7684\u53c2\u6570\uff0c\u9664\u975e\u6709\u4e00\u4e2a\u53c2\u6570\u5728\u9ed8\u8ba4\u503c\u4e2d\u58f0\u660e\u81ea\u5df1\u662f\u8bf7\u6c42\u4f53\uff08Schema.Body\uff09, \u5176\u5b9e\u81f3\u6b64\u5df2\u7ecf\u56ca\u62ec\u4e86\u6240\u6709\u53ef\u80fd\u6027\uff0c\u4f46\u662f\u4e3a\u4e86\u4f7f\u53c2\u6570\u5b9a\u4e49\u66f4\u52a0\u65b9\u4fbf\uff0c\u518d\u5f15\u5165\u4e00\u4e2aSchema.Param\u7c7b\uff0c\u7528\u4e8e\u6807\u8bb0\u4e00\u4e2a\u51fd\u6570\u53c2\u6570\u4e3aQureyString\u5b57\u5178\uff0c\u5e76\u4e14\u53ef\u4ee5\u5e94\u7528Schema\u7c7b\u578b\u63d0\u793a\uff0c\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50\n\n```python\n@api.post(path='{0}/{1}/{level}')\n    def log(self, year: int = Rule(ge=2000, le=2020, default=None),\n            month: int = Rule(ge=1, le=12, default=None),\n            level: str = Rule(choices=['INFO', 'WARN', 'ERROR'], default=None),\n            status: int = Rule(ge=100, le=600, default=200),\n            time: str = Rule(default='default time'),\n            data: DataSchema = Schema.Body):\n```\n\n\u5728\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cyear, month\u662fURL\u4e2d\u7684\u987a\u5e8f\u53c2\u6570\uff0clevel\u662fURL\u4e2d\u7684\u5177\u540d\u53c2\u6570\uff0cdata\u6807\u8bc6\u4e3aBody\uff0c\u5c06\u4f20\u5165\u88abDataSchema\u5e8f\u5217\u5316\u7684\u8bf7\u6c42\u4f53\u6570\u636e\uff0c\u5269\u4f59\u7684status\u548ctime\u5c06\u4f5c\u4e3aQueryString\u6570\u636e\n\n\u5bf9\u5e94\u7684\uff0c\u5982\u679c\u4f60\u5b9a\u4e49\u4e86\u4e00\u4e2aSchema.Param\u53c2\u6570\uff0c\u4f59\u4e0b\u7684\u53c2\u6570\u5c06\u4f5c\u4e3a\u8bf7\u6c42\u4f53\u7684\u6a21\u677f\n\n```python\n@api.put\n    def update(self, query: QuerySchema = Schema.Param,\n               name: str = Rule(len=(3, 10)),\n               desc: str = Rule(len=(None, 200), default=''),\n               image: Media.File,\n               **others\n              ):\n        print(self.META['CONTENT_TYPE'])  # application/json\n        print(data)\n        for d in data:\n            d.title = 'changed title'\n        return data\n```\n\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cquery\u53c2\u6570\u5c06\u4f20\u5165\u5e8f\u5217\u5316\u7684QueryString\u7684\u952e\u503c\u5bf9\u6570\u636e\uff0c\u4f59\u4e0b\u7684name, desc, image\u53c2\u6570\u5c06\u4f5c\u4e3a\u8bf7\u6c42\u4f53\u6a21\u677f\uff0c\u8bf7\u6c42\u4f53\u5e94\u8be5\u4e3a\u4e00\u4e2amultipart/form-data\u7c7b\u578b\u7684\u643a\u5e26\u6587\u4ef6\u7684\u8868\u5355\uff0c\u5728\u4e00\u822c\u7684Schema\u6216\u51fd\u6570\u53c2\u6570\u4e2d\uff0c\u5982\u679c\u6570\u636e\u51fa\u73b0\u4e86\u6a21\u677f\u4e4b\u5916\u7684\u952e\uff0c\u8be5\u952e\u503c\u5bf9\u5c06\u4e0d\u4f1a\u5f97\u5230\u4fdd\u7559\uff0c\u5982\u679c\u9700\u8981\u4fdd\u7559\u4e0b\u6765\u6240\u6709\u7684\u952e\u503c\u5bf9\u6570\u636e\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u53c2\u6570\u540e\u6dfb\u52a0\u4e00\u4e2a **kwargs \u53cc\u661f\u53f7\u7684\u952e\u503c\u53d8\u91cf\uff0c\u8868\u793a\u51fd\u6570\u5e0c\u671b\u5bb9\u7eb3\u66f4\u591a\u7684\u53c2\u6570\uff0c\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u8868\u793a\u5982\u679c\u8bf7\u6c42\u4f53\u8868\u5355\u6709\u989d\u5916\u7684\u6570\u636e\uff0c\u4e5f\u4f1a\u4f20\u5165others\u4e2d\n\n\u5982\u679c\u5e0c\u671b\u5728Schema\u4e2d\u4e5f\u4fdd\u7559\u989d\u5916\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5728Schema\u7c7b\u4e2d\u8bbe\u7f6e \\_\\_config\\_\\_ \u53d8\u91cf\uff0c\u8bbe\u7f6eexcess_preserve=True\n\n```python\nclass FormSchema(Schema):\n    __config__ = Schema.Config(excess_preserve=True)\n\n    name: str = Rule(len=(3, 10))\n    desc: str = Rule(len=(None, 200))\n    image: Media.File\n```\n\n\n\n\n\u81f3\u6b64\uff0c\u6240\u6709\u65b9\u6cd5\u7684\u6240\u6709\u60c5\u51b5\u90fd\u5df2\u8986\u76d6\uff0c\u4e5f\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u8fc7\u4e8e\u590d\u6742\u7684\u53c2\u6570\u65b9\u6848\uff0c\u4e00\u822c1~2\u79cd\u914d\u5408\u5c31\u8db3\u591f\u4e86\n\n#### 2.7  Rule\u7ec4\u4ef6: \u89c4\u5219\u5b9a\u4e49\u5668\uff0c\u7c7b\u578b\u5236\u9020\u673a\n\n\u4e4b\u524d\u6211\u4eec\u4ecb\u7ecd\u4e86\u5982\u4f55\u5229\u7528Schema\u7c7b\u548c\u7c7b\u578b\u63d0\u793a\u5c06\u8bf7\u6c42\u6570\u636e\u89e3\u6790\u5230\u51fd\u6570\u53c2\u6570\u4e2d\uff0c\u5728\u5176\u4e2d\u6211\u4eec\u5df2\u7ecf\u89c1\u5230\u4e86\u7528\u4e8e\u5b9a\u4e49\u53c2\u6570\u89c4\u5219\u9650\u5236\u7684Rule\u7ec4\u4ef6\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u8be6\u7ec6\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u91cd\u8981\u7684\u7ec4\u4ef6\n\nRule\u7ec4\u4ef6\u8d1f\u8d23\u53c2\u6570\u7684\u89c4\u5219\u9650\u5236\uff0c\u5176\u4e2d\u53ef\u4ee5\u7075\u6d3b\u7684\u4ece**\u7c7b\u578b\uff0c\u503c\uff0c\u957f\u5ea6\uff0c\u6b63\u5219\u548c\u8868\u8fbe\u5f0f**\u7b49\u591a\u4e2a\u65b9\u9762\u5b9a\u4e49\u89c4\u5219\uff0c\u800c\u4e14\uff0cRule\u7ec4\u4ef6\u8fd8\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a **\u201c\u7c7b\u578b\u5236\u9020\u673a\u201d** \uff0c\u6240\u6709Rule\u7ec4\u4ef6\u7684\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u770b\u4f5c\u4e00\u79cd\u7279\u6b8a\u7c7b\u578b\uff0c\u4f60\u53ef\u4ee5\u8c03\u7528\u5b83\u7684\\_\\_call\\_\\_\u65b9\u6cd5\u5c06\u4e00\u4e2a\u6570\u636e\u8f6c\u6362\u4e3a**\u7b26\u5408\u5176\u89c4\u5219**\u7684\u6570\u636e\u6216\u8005\u62a5\u9519\uff0c\u5c31\u50cf**\u7c7b\u578b\u8f6c\u5316**\u4e00\u6837\n\n```python\n>>> r = Rule(type=str, len=(3, 6))\n>>> r(123)\n'123'\n>>> r('abc1234')\n\nValueError: value abc1234 length is larger than max_length 6\n```\n\n\u5229\u7528\u8fd9\u70b9\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528Rule\u4f5c\u6a21\u677f\u7684\u7c7b\u578b\u63d0\u793a\uff0c\u5b83\u4f1a\u5c06\u8bf7\u6c42\u6570\u636e\u8f6c\u4e3a\u7b26\u5408\u8981\u6c42\u7684\u683c\u5f0f\u6216\u62a5\u9519\uff08\u53ef\u4ee5\u5728API\u4e2d\u901a\u8fc7BadRequest\u63a5\u4f4f\u8fd9\u4e2a\u9519\u8bef\u5e76\u4e14\u8fdb\u884c\u5904\u7406\u8fd4\u56de\uff09\n\n\u4f46\u662f\u5728\u6a21\u677f\u5b9a\u4e49\u4e2d\uff0c\u5982\u679c\u76f4\u63a5\u7528Rule\u5b9e\u4f8b\u53bb\u5b9a\u4e49\u7c7b\u578b\uff0c\u7531\u4e8epython\u6807\u51c6\u4e0d\u652f\u6301\uff0c\u65e0\u6cd5\u83b7\u5f97\u7c7b\u578b\u63d0\u793a\u5e26\u6765\u7684\u4fbf\u5229\uff0c\u6240\u4ee5\uff0c\u53ef\u4ee5\u6298\u8877\u91c7\u53d6\u8fd9\u79cd\u65b9\u6cd5\n\n```python\nclass DataSchema(Schema):\n    def name_validator(self, name: str):\n        return name.startswith('valid')\n\n    name: str = Rule(len=(3, 10), exp=name_validator)\n    password: str = Rule(reg='[0-9a-zA-Z]{6, 20}')\n    values: List[str] = Rule(len=(1, 10))\n\n```\n\n\u8fd9\u6837\uff0c\u65e2\u96c6\u4e2d\u5b9a\u4e49\u4e86\u53c2\u6570\u7c7b\u578b\u548c\u9650\u5236\uff0c\u7528\u8fd9\u6837\u7684\u7c7b\u4f5c\u7c7b\u578b\u63d0\u793a\u4e5f\u53ef\u4ee5\u83b7\u5f97\u826f\u597d\u65b9\u4fbf\u7684\u6548\u679c\uff0cSchema\u7c7b\u4f1a\u81ea\u52a8\u8bc6\u522b\u53d8\u91cf\u5bf9\u5e94\u7684Rule\uff0c\u5e76\u4e14\u5c06\u53d8\u91cf\u7684\u7c7b\u578b\u63d0\u793a\u4f5c\u4e3a\u4e00\u6761\u89c4\u5219\u63d2\u5165\u5230Rule\u4e2d\n\n**Rule\u8be6\u7ec6\u7684\u53c2\u6570\u89c4\u5219\uff1a**\n\n* **gt / ge / lt / le** : \u8fd9\u56db\u4e2a\u53c2\u6570\u5206\u522b\u4e3a >, >=, <, <=\uff0c\u503c\u53ef\u4ee5\u4e3a\u4e00\u4e2a int, float, str\uff0c\u5982\u679c\u540c\u65f6\u8bbe\u7f6e\u4e86\u5927\u4e8e\u7684\u503c\uff08\u6700\u5c0f\u503c\uff09\u548c\u5c0f\u4e8e\u7684\u503c\uff08\u6700\u5927\u503c\uff09\uff0c\u5219\u6700\u5927\u503c\u4e0d\u5f97\u5c0f\u4e8e\u6700\u5c0f\u503c\n\n```python\n>>> rule = Rule(gt=4, le=2)\nAssertionError: Rule lt/le (2) must > gt/ge (4)\n>>> rule = Rule(ge=0.1, lt=1.0)\n>>> rule('0.2')\n0.2\n>>> rule(1)\nValueError: value <1.0> not less than 1.0\n```\n\n* **val** : \u6570\u636e\u5fc5\u987b**\u7b49\u4e8e**val\u53c2\u6570\u7684\u503c\uff0c\u5e38\u7528\u4e8e\u5bc6\u94a5\u6216token\u7b49\u7684\u9a8c\u8bc1\n\n```python\n>>> rule = Rule(val='MySecretKey')\n>>> rule('AnyOtherValue')\nValueError: value <'AnyOtherValue'> not equal to 'MySecretKey'\n>>> rule('MySecretKey')\n'MySecretKey'\n```\n\n* **choices**\uff1a\u6570\u636e\u7684\u503c\u5fc5\u987b\u4e3achoices\u4e2d\u7684**\u6210\u5458**\n\n```python\n>>> rule = Rule(choices=['INFO', 'WARN', 'ERROR'])\n>>> rule('DEBUG')\nValueError: value <'DEBUG'> not in choices ['ERROR', 'INFO', 'WARN']\n>>> rule('WARN')\n'WARN'\n```\n\n* **set**: \u6570\u636e\u5fc5\u987b\u4e3a\u4e00\u4e2a\u5217\u8868\uff0c\u4e14\u4e3aset\u53c2\u6570\u7684**\u5b50\u96c6**, \u975e\u5217\u8868\u6570\u636e\u5c06\u4f1a\u8f6c\u5316\u4e3a\u4e00\u4e2a\u96c6\u5408\uff0c\u5982\u679c\u9700\u8981\u5c06\u6570\u636e\u8f6c\u5316\u4e3a\u5176\u4ed6\u7684\u7c7b\u578b\uff08tuple/list\uff09\uff0c\u9700\u8981\u4f7f\u7528type\u53c2\u6570\n\n```python\n>>> rule = Rule(set={'A', 'B', 'C', 'D'})\n>>> rule('B')\n{'B'}\n>>> rule(['A', 'E'])\nValueError: value <{'E', 'A'}> is not subset of ['A', 'B', 'C', 'D']\n>>> rule({'B', 'D'})\n{'B', 'D'}\n```\n\n* **type**: \u53c2\u6570\u7684\u7c7b\u578b\u5c06\u4f1a\u88ab\u8f6c\u5316\u4e3atype\u53c2\u6570\u7684**\u7c7b\u578b**\uff0c\u5982\u679c\u8f6c\u5316\u5931\u8d25\u4f1a\u629b\u51fa\u9519\u8bef\n\n```python\n>>> rule = Rule(type=float)\n>>> rule('3.40')\n3.4\n>>> rule('abc')\nTypeError: Data: <'abc'> can't match or transform to type: <class 'float'>, \n with error: could not convert string to float: 'abc'\n```\n\n* **union**: \u5bf9\u5e94typing\u4e2d\u7684Union\uff0c\u63a5\u53d7\u4e00\u4e2a\u7c7b\u578b\u7684\u5143\u7ec4\uff0c\u5982\u679c\u6570\u636e\u7b26\u5408\u5176\u4e2d\u7684\u4e00\u4e2a\u7c7b\u578b\u5219\u8fd4\u56de\uff0c\u5426\u5219\u5c06\u4f9d\u6b21\u8fdb\u884c\u8f6c\u5316\uff0c\u5ffd\u7565\u8f6c\u5316\u5931\u8d25\uff0c\u5982\u679c\u80fd\u591f\u6210\u529f\u8f6c\u5316\u5219\u8fd4\u56de\u8f6c\u5316\u7684\u7ed3\u679c\uff0c\u53ea\u6709\u5f53\u5bf9\u5176\u4e2d\u6240\u6709\u7684\u7c7b\u578b\u8f6c\u5316\u90fd\u5931\u8d25\u7684\u60c5\u51b5\u4f1a\u629b\u51fa\u9519\u8bef\uff0cunion\u4e2d\u7684\u987a\u5e8f\u4e5f\u5f88\u91cd\u8981\uff0c\u7531\u4e8e\u7c7b\u578b\u8f6c\u5316\u662f\u6309\u5176\u4e2d\u987a\u5e8f\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u5c06\u66f4\u671f\u671b\u7684\u7c7b\u578b\u9760\u524d\u6392\u5217\uff0c\u800c\u4e14\u7531\u4e8e\u5728python\u4e2d\u6240\u6709\u7c7b\u578b\u90fd\u53ef\u4ee5\u8f6c\u4e3astr\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u5e0c\u671b\u629b\u51fa\u9519\u8bef\uff0c\u53ef\u4ee5\u5c06str\u653e\u5728\u6700\u540e\n\n```python\n>>> rule = Rule(union=(list, int))\n>>> rule([1, 2])\n[1, 2]\n>>> rule(3)\n3\n>>> rule('str')\n['str']\n>>> rule = Rule(union=(float, int))\n>>> rule('abc')\nTypeError: value <'abc'> can't convert to any type of union: (<class 'float'>, <class 'int'>)\n```\n\n* **temp**: \u63d0\u4f9b\u4e00\u4e2a\u5b57\u5178/\u5217\u8868/\u5143\u7ec4 **\u6a21\u677f**\uff0c\u6570\u636e\u5fc5\u987b\u6ee1\u8db3\u76f8\u540c\u7684\u7ed3\u6784\uff0c\u5b83\u7684\u89e3\u6790\u89c4\u5219\u4e0eSchema\u76f8\u540c\n\n```python\n>>> rule = Rule(temp=[{'id': int, 'name': Rule(len=(3, 10), default=None)}])\n>>> data = [{'id': '3'}, {'id': 2, 'name': 'MyName'}]\n>>> rule(data)\n[{'id': 3, 'name': None}, {'id': 2, 'name': 'MyName'}]\n```\n\n\u53ef\u4ee5\u770b\u5230\u4f20\u5165\u7684\u5217\u8868\u6570\u636e\u5df2\u7ecf\u53d1\u751f\u4e86\u8f6c\u5316\uff0c\u5b57\u5178\u5143\u7d20\u5bf9\u5e94\u7684\u952e\u503c\u4e5f\u8fdb\u884c\u4e86\u7c7b\u578b\u8f6c\u5316\uff0c\u7f3a\u5931\u7684\u952e\u88ab\u9ed8\u8ba4\u503c\u8865\u9f50\uff0c\u4f46\u5f53\u65e0\u6cd5\u8fdb\u884c\u8fd9\u4e9b\u8f6c\u5316\u65f6\u5c31\u4f1a\u629b\u51fa\u9519\u8bef\uff0c\u6a21\u677f\u7684\u5177\u4f53\u89e3\u6790\u89c4\u5219\u5c06\u5728\u4e0b\u4e00\u8282\u4ecb\u7ecd\n\n* **len**:  \u9650\u5236\u6570\u636e\u7684**\u957f\u5ea6**\uff0clen\u53c2\u6570\u7684\u503c\u5982\u679c\u4e3a\u4e00\u4e2a\u6574\u6570\uff0c\u5219\u8868\u793a\u6570\u636e\u7684\u957f\u5ea6\u5fc5\u987b\u7b49\u4e8e\u8fd9\u4e2a\u503c\uff0c\u5982\u679c\u4e3a\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c\u5219\u89c4\u5b9a\u6570\u636e\u7684\u6700\u5927\u6700\u5c0f\u957f\u5ea6\uff0c\u6570\u636e\u53ef\u4ee5\u662f\u4efb\u610f\u7c7b\u578b\uff0c\u6ca1\u6709 \\_\\_len\\_\\_\u5c5e\u6027\u7684\u6570\u636e\u5c06\u4f1a\u4f5c\u4e3a\u5b57\u7b26\u4e32\u68c0\u9a8c\u957f\u5ea6\n\n```python\n>>> rule = Rule(len=3)\n>>> rule(3.14)\nValueError: value <3.14> with length 4 not match the length 3\n>>> rule(['A','B','C'])\n['A', 'B', 'C']\n>>> rule = Rule(len=(1, 4))\n>>> rule('12345')\nValueError: value <'12345'> with length 5 is larger than max_length 4\n>>> rule('r')\n'r'\n>>> rule = Rule(len=(3, None))\n>>> rule('A Very Long String Can Pass the <None> max_length')\n'A Very Long String Can Pass the <None> max_length'\n```\n\n\u53ef\u4ee5\u770b\u5230\u7528\u4e8c\u5143\u7ec4\u8bbe\u7f6e\u957f\u5ea6\u8fb9\u754c\uff0c\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u53ef\u4ee5\u7b49\u4e8e\u8fb9\u754c\u4f46\u4e0d\u80fd\u8d85\u8fc7\u8fb9\u754c\uff0c\u5982\u679c\u8fb9\u754c\u503c\u4e3aNone\u5219\u8868\u793a\u4e0d\u8bbe\u7f6e\u8fb9\u754c\uff0c\u957f\u5ea6\u9650\u5236\u4e0d\u80fd\u4e3a\u8d1f\u6570\n\n* **reg**: \u6570\u636e\u5fc5\u987b\u5b8c\u5168\u5339\u914d\u8fd9\u4e2a\u53c2\u6570\u7684**\u6b63\u5219**\u8868\u8fbe\u5f0f\n\n```python\n>>> rule = Rule(reg='([A-Za-z0-9]+)')\n>>> rule('abcABC123')\n'abcABC123'\n>>> rule('abc@123')\nValueError: value <'abc@123'> not match the regex '([A-Za-z0-9]+)'\n```\n\n* **exp**: \u6570\u636e\u7684**\u9a8c\u8bc1\u5668\u51fd\u6570**\uff0c\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2acallable\uff0c\u5305\u62eclambda\u8868\u8fbe\u5f0f\uff0c\u8fd9\u4e2a\u51fd\u6570\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff0c\u5c06\u4f1a\u88ab\u4f20\u5165\u5f85\u9a8c\u8bc1\u6570\u636e\uff0c\u5982\u679c\u51fd\u6570\u629b\u51fa\u9519\u8bef\u6216\u8005\u8fd4\u56deFalse\u5219\u9a8c\u8bc1\u5931\u8d25\uff0c\u8fd4\u56deTrue\u8868\u793a\u9a8c\u8bc1\u6210\u529f\n\n```python\n>>> rule = Rule(exp=lambda v: v.startswith('@'))\n>>> rule(123)\nValueError: value validate failed with error: 'int' object has no attribute 'startswith'\n>>> rule('value')\nValueError: value validate failed with error: value <'value'> not match the expression\n>>> rule('@utilmeta')\n'@utilmeta'\n```\n\n\u901a\u8fc7exp\u53c2\u6570\uff0c\u4f60\u53ef\u4ee5\u5b9a\u4e49\u4efb\u610f\u590d\u6742\u7684\u9a8c\u8bc1\u903b\u8f91\n\n* **null**: \u51b3\u5b9a\u6570\u636e\u80fd\u5426\u4e3aNone\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e3aFalse\uff0c\u5982\u679c\u8bbe\u7f6enull=True\uff0c\u5219\u9488\u5bf9None\u7684\u6570\u636e\u5c06**\u4e0d\u518d\u9a8c\u8bc1\u540e\u7eed\u89c4\u5219**\u800c\u76f4\u63a5\u8fd4\u56de\n\n```python\n>>> rule = Rule(val=2020, null=True)\n>>> rule(None)\nNone\n>>> rule(2019)\nValueError: value <2019> not equal to 2020\n```\n\n* **require**: \u6570\u636e\u662f\u5426\u4e3a**\u5fc5\u9700**\u7684\uff0c\u9ed8\u8ba4\u4e3aTrue\uff0c\u65e2Rule\u5bf9\u5e94\u7684\u952e\u6216\u4f4d\u7f6e\u5fc5\u987b\u51fa\u73b0\u5728\u8bf7\u6c42\u6570\u636e\u4e2d\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff0crequire=False\u65f6\u5c06\u4e0d\u4f1a\u62a5\u9519\uff0c\u5982\u679c\u89c4\u5219\u8bbe\u7f6e\u6709\u9ed8\u8ba4\u503c\uff0c\u5c06\u4f1a\u628a\u9ed8\u8ba4\u503c\u586b\u5165\u76f8\u5e94\u4f4d\u7f6e\uff0c\u5426\u5219\u53c2\u6570\u5c06\u4e3a\u7a7a\u7f3a\n\n```python\n>>> rule = Rule(temp=(Rule(require=True), Rule(require=False)))\n>>> rule([1,2])\n(1, 2)\n>>> rule(1)\n(1,)\n>>> rule([])\nValueError: value required position 0 not in data\n>>> rule = Rule(temp=(Rule(default=''), str))\nAssertionError: tuple template must order by required -> defaulted -> omitted\n>>> rule = Rule(temp=(int, Rule(default=''), Rule(require=False)))\n>>> rule([3])\n(3, '')\n>>> rule = Rule(temp={'id': int, 'name': Rule(require=False)})\n>>> rule({'id':2})\n{'id': 2}\n```\n\n\u901a\u8fc7\u8fd9\u51e0\u4e2a\u4f8b\u5b50\u6211\u4eec\u80fd\u770b\u5230require\u7684\u89c4\u5f8b\u4e86\uff0cRule\u5b9e\u4f8b\u53ef\u4ee5\u5206\u4e3a\u4e09\u4e2a\u7c7b\u578b\n\n1. required: \u4e0d\u8bbe\u7f6edefault\u548crequire\u7684Rule\uff0c\u5fc5\u987b\u51fa\u73b0\u5728\u8bf7\u6c42\u6570\u636e\u4e2d\n2. defaulted: \u8bbe\u7f6e\u4e86default\u7684Rule\uff0c\u82e5\u8bf7\u6c42\u6570\u636e\u4e2d\u6ca1\u6709\u51fa\u73b0\u5219\u4f1a\u8865\u9f50\uff0c\u6216\u8005\u8bf4\u4e00\u5b9a\u4f1a\u51fa\u73b0\u5728\u8f6c\u5316\u540e\u7684\u6570\u636e\u4e2d\n3. omiited: \u5373\u5355\u72ec\u8bbe\u7f6erequire=False\u800c\u4e0d\u8bbe\u7f6edefault\u7684Rule\uff0c\u6570\u636e\u4e2d\u6ca1\u6709\u65f6\u4e0d\u4f1a\u8865\u9f50\uff0c\u4e0d\u4e00\u5b9a\u4f1a\u51fa\u73b0\u5728\u8f6c\u5316\u540e\u6570\u636e\u4e2d\n\n\u5728\u4ee5\u5143\u7ec4\u4f5c\u4e3a\u6a21\u677f\u65f6\uff0c\u6a21\u677f\u4e2d\u7684\u5143\u7d20**\u5fc5\u987b\u4ee5 required -> defaulted -> omitted \u7684\u987a\u5e8f**\u8fdb\u884c\u6392\u5217\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u89e3\u6790\u540e\u7684\u6570\u636e\u4f1a\u51fa\u73b0\u5728\u5bf9\u5e94\u7684\u4f4d\u7f6e\u4e0a\u6216\u88ab\u7701\u7565\n\n* **default**: \u8bbe\u7f6e\u53c2\u6570\u7684**\u9ed8\u8ba4\u503c**\uff0c\u5f53\u53c2\u6570\u4e0d\u5b58\u5728\uff08\u5b57\u5178\u6ca1\u6709\u8fd9\u4e2a\u952e\u6216\u5728\u5143\u7ec4\u6a21\u677f\u7684\u957f\u5ea6\u4e4b\u5916\uff09\u65f6\u8865\u5165\u8fd9\u4e2a\u9ed8\u8ba4\u503c\uff0c\u8bbe\u7f6edefault\u540c\u65f6\u4e5f\u4f1a\u4ee4\u89c4\u5219\u7684require=False\n* **doc**: Rule\u5b9e\u4f8b\u7684**\u6587\u6863**\uff0c\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f1a\u5728\u81ea\u52a8\u751f\u6210\u7684API\u6587\u6863\u4e2d\u8fdb\u884c\u5c55\u793a\uff0c\u53ef\u4ee5\u89e3\u91ca\u8fd9\u4e2a\u89c4\u5219\u7684\u4e00\u4e9b\u8be6\u7ec6\u4fe1\u606f\uff0c\u4e0d\u5bf9\u9a8c\u8bc1\u6570\u636e\u9020\u6210\u5f71\u54cd\n\n#### 2.8 \u8fd4\u56de\u6a21\u677f\n\n\u6a21\u677f\u7cfb\u7edf\u9664\u4e86\u5305\u62ec\u8bf7\u6c42\u6a21\u677f\u8fd8\u5305\u62ec\u8fd4\u56de\u6a21\u677f\uff0c\u53ea\u4e0d\u8fc7\u8fd4\u56de\u6a21\u677f\u662f\u4f5c\u4e3a\u9762\u5411\u524d\u7aef\u7684\u6587\u6863\u7684\u65b9\u5f0f\uff0c\u9664\u975e\u914d\u7f6estrict=True\uff0c\u5426\u5219\u4e0d\u4f1a\u5bf9\u8fd4\u56de\u4f53\u672c\u8eab\u6570\u636e\u8fdb\u884c\u9a8c\u8bc1\uff0c\u591a\u8fd4\u56de\u6a21\u677f\u4e3b\u8981\u662f\u7528handle\u94a9\u5b50\u7684\u65b9\u5f0f\u89e3\u51b3\uff0c\u5b83\u53ef\u4ee5\u6355\u83b7API\u4e2d\u53d1\u751f\u7684 \u8bf7\u6c42\u9519\u8bef\uff0c\u6743\u9650\u7981\u6b62\uff0c\u670d\u52a1\u9519\u8bef\u7b49\u5e38\u89c1\u9519\u8bef\u5e76\u4e14\u53ef\u4ee5\u7075\u6d3b\u914d\u7f6e\u5b83\u4eec\u7684\u8fd4\u56de\u683c\u5f0f\n\n##### 2.8.1 \u8fd4\u56de\u4f53\u7ec4\u4ef6Response\n\n\u8fd9\u4e2a\u7ec4\u4ef6\u7528\u4e8e\u5b9a\u4e49\u8fd4\u56de\u4f53\u7684\u6570\u636e\u7ed3\u6784\u548c\u8bf7\u6c42\u5934\u7ed3\u6784\uff0c\u8bf7\u6c42\u4f53Content-Type\u7b49\uff0c\u7531\u4e8e\u4e00\u822c\u7684API\u7cfb\u7edf\u5177\u6709\u8d8b\u4e8e\u7edf\u4e00\u7684\u8fd4\u56de\u683c\u5f0f\uff08\u5982\u8fd4\u56de\u4e00\u4e2ajson\uff0c\u56fa\u5b9a\u7684\u952e\u5bf9\u5e94\u8fd4\u56de\u6570\u636e\uff0c\u62a5\u9519\u4fe1\u606f\uff0c\u64cd\u4f5c\u72b6\u6001\u7b49\uff09\uff0c\u6240\u4ee5\u4ee5\u6a21\u677f\u7684\u65b9\u5f0f\u7edf\u4e00\u5b9a\u4e49\u65e2\u65b9\u4fbf\u5f00\u53d1\uff0c\u53c8\u65b9\u4fbf\u96c6\u6210\u6587\u6863\uff0c\u8fd9\u5c31\u662fResponse\u7ec4\u4ef6\u7684\u4f5c\u7528\uff0c\u5728\u4e4b\u524dQuickStart\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u8fd9\u6837\u7684Response\u5b9e\u4f8b\n\n```python\nclass RootAPI(API):\n    class Meta:\n        response = Response(\n            result_key='result',\n            message_key='msg',\n            action_state_key='state'\n        )\n```\n\n\u5728API\u7684Meta\u7c7b\u4e2d\u5b9a\u4e49\u7684response\u53d8\u91cf\u4e3a\u4e00\u4e2aResponse\u5b9e\u4f8b\uff0c\u5176\u4e2d\u5b9a\u4e49\u4e86\u8fd4\u56de\u4f53json\u6570\u636e\u7684\u7ed3\u6784\uff0c\u5176\u4e2d\u7684\u53c2\u6570\u542b\u4e49\u662f\n\n* **result_key**: \u8fd4\u56de\u7ed3\u679c\u5bf9\u5e94\u7684\u952e\u7684\u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3aNone\uff0c\u5373\u8fd4\u56de\u7ed3\u679c\u76f4\u63a5\u4f5c\u4e3a\u8fd4\u56de\u4f53\u5185\u5bb9\uff0c\u4e0d\u7528json\u8fdb\u884c\u5305\u88f9\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u4e3aNone\u5219\u8bbe\u7f6e\u5176\u4ed6\u7684key\u90fd\u662f\u6ca1\u6709\u610f\u4e49\u7684\n* **message_key**: \u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u7684\u952e\uff0c\u5728\u6b63\u5e38\u8fd4\u56de\u65f6\u8fd9\u4e2a\u952e\u7684\u503c\u4e3a\u7a7a\uff0c\u5982\u679c\u51fa\u73b0\u8bf7\u6c42\u6570\u636e\u9a8c\u8bc1\u5931\u8d25\u6216\u670d\u52a1\u51fa\u9519\u7b49\u60c5\u51b5\uff0c\u8fd4\u56de\u4f53\u4e2d\u8fd9\u4e2a\u952e\u5bf9\u5e94\u7684\u503c\u5c06\u4f1a\u4e3a\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\u5b57\u7b26\u4e32\n* **action_state_key**: \u7528\u4e8e\u8868\u793a\u4e1a\u52a1\u903b\u8f91\u6267\u884c\u72b6\u6001\u7684\u952e\uff0c\u6bd4\u5982\u767b\u5f55\u64cd\u4f5c\uff0c\u65e0\u8bba\u767b\u5f55\u6210\u529f\u5931\u8d25\u90fd\u8fd4\u56de200 OK\uff0c\u4f46\u767b\u5f55\u6210\u529f\u6216\u5931\u8d25\u53ef\u4ee5\u4f53\u73b0\u5728\u8fd9\u4e2a\u952e\u5bf9\u5e94\u7684\u503c\u4e0a\uff08\u9ed8\u8ba4\u6210\u529f\u4e3a1\uff0c\u5931\u8d25\u4e3a0\uff09\uff0c\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u66f4\u591a\u7684\u8fd4\u56de\u72b6\u6001\uff0c\u8fd9\u4e2a\u72b6\u6001\u4e0eHTTP\u72b6\u6001\u7801\u65e0\u5173\n* **http_status_code_key**: \u9ed8\u8ba4\u4e3aNone\uff0c\u4e0d\u5efa\u8bae\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u8fd9\u4e2akey\u5c06\u4f1a\u628a\u771f\u6b63\u7684HTTP\u8fd4\u56de\u7801\u653e\u5728\u8fd9\u4e2a\u952e\u4e0a\uff0c\u800c\u6c38\u8fdc\u8fd4\u56de 200 OK\u7684\u72b6\u6001\u7801\n* **page_count_key:** \u5206\u9875\u67e5\u8be2\u7684\u9875\u6570\u5bf9\u5e94\u7684\u952e\uff0c\u5728\u5e94\u7528\u5206\u9875Page\u7ec4\u4ef6\u7684\u6a21\u5757\u8fd4\u56de\u7684\u7ed3\u679c\u4e2d\u5c31\u5305\u62ec\u5f53\u524d\u67e5\u8be2\u6761\u4ef6\uff0c\u6bcf\u9875\u884c\u6570\u5bf9\u5e94\u7684\u603b\u9875\u6570\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u524d\u7aef\u5206\u9875\u5668\u7684\u6700\u5927\u503c\uff0c\u8fd9\u6837\u53ef\u4ee5\u628a\u9875\u6570\u548c\u7ed3\u679c\u4f53\u73b0\u5728\u4e00\u4e2a\u8bf7\u6c42\u4e2d\uff0c\u907f\u514d\u91cd\u590d\u67e5\u8be2\n\n\n\n```json\n{\n    \"result\": {\n        \"id\": 1,\n        \"name\": \"UtilMeta\"\n    },\n    \"msg\": \"\",\n    \"state\": 1\n}\n```\n\n\n\n\n\u4e00\u90e8\u5206\u662f\u6a21\u578b\u5b57\u6bb5\u6a21\u677f\uff08\u5de5\u4f5c\u5728Module\uff09\uff0c\u5b83\u4eec\u7684\u7c7b\u578b\uff0c\u9650\u5236\uff0c\u9ed8\u8ba4\u503c\u7b49\u90fd\u5728\u5b9a\u4e49\u6a21\u578b\u7684\u65f6\u5019\u6307\u5b9a\uff0c\u5728\u6a21\u5757\u5316\u65f6UtilMeta\u63a5\u7ba1\u4e86\u8fd9\u90e8\u5206\u6a21\u677f\u7684\u751f\u6210\uff0c\u53ea\u8981\u5728Field\u4e2d\u58f0\u660e\u6e05\u695a\u5b57\u6bb5\uff0c\u5404\u4e2a\u65b9\u6cd5\u7684\u8bf7\u6c42\u6a21\u677f\u548c\u8fd4\u56de\u6a21\u677f\u5c06\u4f1a\u81ea\u52a8\u751f\u6210\uff0c\u800c\u4e14\u8fd9\u90e8\u5206\u57fa\u672c\u7684\u589e\u5220\u6539\u67e5\u6846\u67b6\u4f1a\u81ea\u52a8\u5904\u7406\uff0c\u4e5f\u65e0\u9700\u7f16\u5199\u903b\u8f91\u4ee3\u7801\u548c\u7c7b\u578b\u63d0\u793a\uff0c\u5f00\u53d1\u8005\u5982\u679c\u9700\u8981\u66f4\u5b9a\u4e49\u590d\u6742\u7684\u9650\u5236\u6216\u989d\u5916\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528**\u6ce8\u5165**\u7684\u65b9\u5f0f\u53ea\u5f71\u54cd\u76ee\u6807\u53c2\u6570\n\n\u53e6\u4e00\u90e8\u5206\u662fAPI\u4e0a\u5904\u7406\u5355\u5143\u7684\u53c2\u6570\u6a21\u677f\uff0c\u8fd9\u4e9b\u53c2\u6570\u6ca1\u6709\u6a21\u578b\u4e0e\u4e4b\u5bf9\u5e94\uff0c\u6240\u4ee5\u5b9a\u4e49\u6a21\u677f\u7684\u5de5\u4f5c\u5e94\u8be5\u7531\u5f00\u53d1\u8005\u6839\u636e\u5177\u4f53\u4e1a\u52a1\u903b\u8f91\u6765\u5b8c\u6210\uff0cUtilMeta\u63d0\u4f9b\u4e00\u4e2a\u540d\u4e3aSchema\u7684\u7ec4\u4ef6\u4ee5type hint\u7684\u65b9\u5f0f\u5e2e\u52a9\u4f60\u5b9a\u4e49\u6a21\u677f\uff0c\u8fd9\u662f\u4e00\u4e2a\u7ee7\u627f\u81eadict\u7684\u7c7b\uff0c\u62e5\u6709\u5b57\u5178\u7684\u5168\u90e8\u5c5e\u6027\uff0c\u5f53\u4f60\u7684\u51fd\u6570\u4f7f\u7528Schema\u5b50\u7c7b\u4f5c\u4e3atype_hint\u7684\u65f6\u5019\uff0c\u5bf9\u5e94\u8bf7\u6c42\u7684\u6570\u636e\u5c06\u4f1a\u81ea\u52a8\u5e8f\u5217\u5316\u4e3a\u8fd9\u4e2a\u7c7b\u5143\u7d20\u5bf9\u5e94\u7684Python\u5bf9\u8c61\uff0c\u5176\u4e2d\u53ef\u4ee5\u5b8c\u6210\u6570\u636e\u6821\u9a8c\u7b49\u5de5\u4f5c\n\n\n\n### 3. \u63a5\u53e3\u7cfb\u7edf API System\n\n#### 3.1 API\u89e3\u6790\u673a\u5236\n\n\n\n#### 3.2 \u94a9\u5b50\u7cfb\u7edf\n\nUtilMeta\u4e2d\u7684\u94a9\u5b50\u7cfb\u7edf\u53ef\u4ee5\u4f5c\u7528\u4e8e\u4e00\u4e2aAPI\uff0c\u6a21\u5757\u6216\u51fd\u6570\uff0c\u4f7f\u5f97\u8bf7\u6c42\u7684\u5904\u7406\u5982\u6d41\u6c34\u7ebf\u4e00\u822c\u5206\u5de5\u660e\u786e\uff0c\u4f9d\u6b21\u8fdb\u884c\uff0c\u6709\u6548\u5904\u7406\uff0c\u5176\u4e2dAPI\u4e0a\u7684\u94a9\u5b50\u6709\u51e0\u79cd\u7c7b\u578b\n\n##### 1. @api.before : \u5904\u7406\u524d\u94a9\u5b50\n\n\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\u7684\u88c5\u9970\u5668\uff0c\u8fd9\u4e2a\u53c2\u6570\u662f\u4e00\u4e2aAPI\u5185\u5904\u7406\u5355\u5143\u7684\u540d\u79f0\u6216\u5f15\u7528\n\n```python\nclass AccountAPI(API):\n\n    def auth(self):\n        # do something\n    \tpass\n\n   \t@api.before(auth)\t# or @api.before('auth')\n    def pre_auth(self, data, meta):\n        # do something before auth function called\n    \tpass\n```\n\n\u5982\u679cbefore\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4ec5\u4ec5\u662f\u6267\u884c\u5b8cbefore\u94a9\u5b50\u518d\u6267\u884c\u5904\u7406\u51fd\u6570\uff0c\u597d\u50cf\u4f5c\u7528\u4e0d\u5927\uff0c\u53ef\u662f\uff0c\u8fd9\u4e2a\u53c2\u6570\u8fd8\u53ef\u4ee5\u662f\u4e00\u4e2a\u6a21\u5757\uff0c\u751a\u81f3\u662f\u4e00\u4e2aAPI\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8bf7\u6c42\u5230\u8fbe\u90a3\u4e2a\u5355\u5143\u4e4b\u524d\uff0c\u5bf9\u8bf7\u6c42\u7684data, headers\u7b49\u4f5c\u51fa\u4e00\u5b9a\u5904\u7406\uff0c\u9a8c\u8bc1\u7b49\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u94a9\u5b50\u51fd\u6570\u672c\u8eab\u6709\u4e24\u4e2a**\u53ef\u9009\u53c2\u6570**\uff08\u51fd\u6570\u5728\u5b9a\u4e49\u65f6\u9664self\u5916\u53ef\u4ee5\u5b9a\u4e490~2\u4e2a\u53c2\u6570\uff0c\u5c06\u4f1a\u4f9d\u6b21\u4f20\u5165\u6570\u636e\uff0c\u6309\u9700\u5b9a\u4e49\uff09\uff0c\u5c06\u4f1a\u4f9d\u6b21\u4f20\u5165\u8bf7\u6c42\u6570\u636eself.data\u548c\u8bf7\u6c42\u5934\u4fe1\u606fself.META\uff0c\u800cAPI\u5b9e\u4f8b\u7684data\u5c5e\u6027\u662f\u4f1a\u4f20\u9012\u5230\u4e0b\u4e00\u5c42API\u548cModule\u4e2d\u8fdb\u884c\u5904\u7406\u7684\uff0c\n\n##### 2. @api.after : \u5904\u7406\u540e\u94a9\u5b50\n\n\u4e0ebefore\u88c5\u9970\u5668\u76f8\u5bf9\u7684\uff0cafter\u88c5\u9970\u7684\u51fd\u6570\u662f\u5728\u5904\u7406\u5355\u5143\u6267\u884c\u4e4b\u540e\u6267\u884c\uff0c\u88ab\u88c5\u9970\u7684\u51fd\u6570\u6709\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\uff0c\u4f20\u5165\u5904\u7406\u5355\u5143\u6267\u884c\u8fd4\u56de\u7684\u7ed3\u679c\n\n```python\nclass WorkAPI(API):\n\tlist = WorkList\n\n    @api.after(list)\t# or @api.after(WorkList) or @api.after('list')\n    def process(self, response):\n        response['My-Header'] = 'My Value'\n        return response\n```\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679cafter\u4e00\u4e2a\u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u5b83\u7684\u8fd4\u56de\u7ed3\u679c\uff08return \u7684\u503c\uff09\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5bf9\u5b83\u8fdb\u884c\u5904\u7406\uff0c\u800c\u52a0\u5728\u4e00\u4e2aAPI\u6216Module\u4e0a\u4f1a\u5f97\u5230\u5b83\u8fd4\u56de\u7684HttpResponse\uff0c\u6309\u7167\u7ea6\u5b9a\u8fdb\u884c\u4e0d\u6539\u53d8\u8fd4\u56de\u7ed3\u679c\u7684\u5904\u7406\uff08\u5982\u8bb0\u5f55\u65e5\u5fd7\uff09\u6216\u6539\u53d8headers\uff0c\u4e5f\u5c31\u662f\u4e0d\u8981\u628a\u8fd9\u4e2a\u53c2\u6570\u89c6\u4f5c\u4e00\u4e2a\u5b57\u5178\u6216\u5217\u8868\uff0c\u800c\u4e14\u52a1\u5fc5\u5c06\u8fd9\u4e2a\u53c2\u6570\u8fdb\u884c\u8fd4\u56de\uff0c\u56e0\u4e3aafter\u88c5\u9970\u5668\u7684\u7ed3\u679c\u5728\u51fd\u6570\u6267\u884c\u4e0d\u53d1\u751f\u9519\u8bef\u7684\u524d\u63d0\u4e0b\u5c06**\u76f4\u63a5\u4f5c\u4e3a\u5f53\u524dAPI\u7684\u5904\u7406\u7ed3\u679c**\u8fd4\u56de\u7ed9\u4e0a\u5c42API\n\n##### 3. @api.handle : \u9519\u8bef\u5904\u7406\u94a9\u5b50 \n\n\u5728\u540e\u7aef\u7cfb\u7edf\u4e2d\uff0c\u5bf9\u4e8e\u9519\u8bef\u8bf7\u6c42\u6216\u670d\u52a1\u9519\u8bef\u7684\u5904\u7406\u975e\u5e38\u91cd\u8981\uff0c\u8fd9\u4e2a\u88c5\u9970\u5668\u5c31\u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u5904\u7406\u94a9\u5b50\uff0c\u5b83\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u5904\u7406\u5355\u5143\u7684\u540d\u79f0\u6216\u5f15\u7528\uff08\u4e0e\u4ee5\u4e0a\u4e24\u4e2a\u88c5\u9970\u5668\u76f8\u540c\uff09\uff0c\u7b2c\u4e8c\u662f\u53ef\u9009\u53c2\u6570\uff0c\u9519\u8bef\u7684\u7c7b\u578b\uff0c\u9ed8\u8ba4\u4e3aException\uff0c\u5373\u5904\u7406\u6240\u6709\u7684\u9519\u8bef\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u4e00\u4e2a\u5904\u7406\u5355\u5143\u8bbe\u7f6e\u591a\u4e2a\u8bf7\u6c42\u94a9\u5b50\uff0c\u6bcf\u4e2a\u5bf9\u5e94\u4e0d\u540c\u7684\u9519\u8bef\u7c7b\u578b\n\n```python\nclass RootAPI(API):\n    work = WorkAPI\n\n    @api.handle(work, BadRequest)\n    def handle_work_parse(self, error):\n        pass\n\n    @api.handle(work, PermissionDenied)\n    def handle_work_permission(self, error):\n        pass\n\n    @api.handle(work)\n    def handle_work_permission(self, error):\n        pass\n```\n\n\n\n\u4e8b\u5b9e\u4e0a\u4e3a\u4e86\u786e\u4fdd\u8fd4\u56de\u6b63\u786e\uff0c\u5728\u6700\u9876\u5c42\u7684API\u4e0a\u4e5f\u6709\u9ed8\u8ba4\u7684\u9519\u8bef\u5904\u7406\u94a9\u5b50\uff0c\u5f53\u9047\u5230BadRequest\u9519\u8bef\u8fd4\u56de400\uff0c\u5f53\u9047\u5230PermissionDenied\u9519\u8bef\u8fd4\u56de403\uff0c\u901a\u5e38\u9519\u8bef\u8fd4\u56de500\u7b49\u7b49\uff0c\u5e76\u4f1a\u5c06\u9519\u8bef\u4fe1\u606f\u8bb0\u5f55\u5230\u8bf7\u6c42\u7684\u65e5\u5fd7\u4e2d\n\n\u5728\u6d4b\u8bd5\u73af\u5883\uff08production=False\uff09\u4e2d\uff0c\u62a5\u9519\u4fe1\u606f\u5c06\u4f1a\u4f5c\u4e3a\u7ed3\u679c\u8fd4\u56de\u7ed9\u524d\u7aef\uff0c\u4fbf\u4e8e\u8c03\u8bd5\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff08production=True\uff09\u9519\u8bef\u7684\u4fe1\u606f\u9ed8\u8ba4\u5c06\u4e0d\u4f1a\u8fd4\u56de\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9519\u8bef\u5904\u7406\u94a9\u5b50\u81ea\u5b9a\u4e49\u9519\u8bef\u65f6\u7684\u8fd4\u56de\u4fe1\u606f\n\n#### 3.3 \u8c03\u7528\u7cfb\u7edf*\n\n\u4e00\u4e2a\u529f\u80fd\u590d\u6742\u7684API\u7cfb\u7edf\uff0c\u5f80\u5f80\u4e5f\u6709\u8fdc\u7a0b\u8c03\u7528\uff08RPC\uff09\u6216\u5fae\u670d\u52a1\u96c6\u6210\u7684\u9700\u6c42\uff0c\u5982\u4f55\u4f18\u96c5\u7684\u5904\u7406\u8fdc\u7a0b\u63a5\u53e3\u8c03\u7528\uff0c\u4ee5\u53ca\u5185\u90e8\u670d\u52a1\u7684\u63a5\u53e3\u590d\u7528\u5f88\u5173\u952e\uff0cAPI\u7684\u8c03\u7528\u7cfb\u7edf\u89e3\u51b3\u4e86\u4ee5\u4e0a\u95ee\u9898\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u7075\u6d3b\u7684\u590d\u7528\u5176\u4ed6API\u63a5\u53e3\u7684\u65b9\u6cd5\uff0c\n\n##### 1. \u5185\u90e8API\u65b9\u6cd5\u590d\u7528\n\n##### 2. \u8c03\u7528\u8fdc\u7a0bUtilMeta\u670d\u52a1\n\n##### 3. \u8c03\u7528\u4e00\u822c\u8fdc\u7a0b\u670d\u52a1\n\n\u5982\u679c\u4f60\u8fd8\u5e0c\u671b\u4e0e\u8bf7\u6c42\u6a21\u677f\u4e00\u6837\u83b7\u5f97\u7c7b\u578b\u63d0\u793a\u7684\u4fbf\u5229\uff0c\u53ef\u4ee5\u6839\u636e\u8fdc\u7a0b\u670d\u52a1API\u63d0\u4f9b\u7684\u6587\u6863\u6574\u7406\u4e00\u4e2aSchema\uff0c\u8bf7\u6c42\u8fdc\u7a0b\u670d\u52a1\u5f97\u5230\u7684\u6570\u636e\u4e5f\u4f1a\u88ab\u89e3\u6790\u4e3a\u89c4\u8303\u7684Schema\u5bf9\u8c61\u4f9b\u4f60\u5728\u51fd\u6570\u4e2d\u8fdb\u884c\u8c03\u7528\n\n#### 3.4 \u5b89\u5168\u7cfb\u7edf*\n\n##### 1. Rebot \u8bf7\u6c42\u8fc7\u6ee4\n\n##### 2. API \u8c03\u7528\u6b21\u6570\u9650\u5236\n\n##### 3. \u9ed1\u540d\u5355\uff0c\u767d\u540d\u5355\n\n#### 3.5 \u5f02\u6b65\u7cfb\u7edf\uff1aASGI, WS, MQTT  *\n\n\n\n### 4. \u7f13\u5b58\u7cfb\u7edf Cache System*\n\n\n\n### 5. \u670d\u52a1\u4e0e\u914d\u7f6e Service&Settings\n\n#### 5.1 \u547d\u4ee4\u884c\u5de5\u5177meta\n\n\n\n##### 1. setup\n\nsetup\u547d\u4ee4\u7528\u4e8e\u521b\u5efa\u4e00\u4e2aUtilMeta\u5de5\u7a0b\uff0c\u6839\u636e\u547d\u4ee4\u53c2\u6570\u9009\u62e9\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u7eafpython\u540e\u7aef\u9879\u76ee\u6216\u4e00\u4e2a\u5b8c\u6574\u7684\u53ef\u90e8\u7f72\u7684\u5de5\u7a0b\uff0c\u4e0b\u9762\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u8bf4\u660emeta setup\u7684\u4f7f\u7528\u65b9\u6cd5\n\n\u5047\u8bbe\u6211\u8981\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a utilmeta.com\u7684\u7ad9\u70b9, \u5e76\u521b\u5efa\u5b50\u57df\u540d doc.utilmeta.com\u548c ops.utilmeta.com\u5bf9\u5e94\u7684\u670d\u52a1\uff08\u4e8b\u5b9e\u4e0a\u8fd9\u4e9b\u670d\u52a1\u90fd\u662f\u57fa\u4e8eUtilMeta\u7684\uff09 , \u90a3\u4e48\u53ea\u9700\u8fd9\u6837\n\n```shell\nmeta setup utilmeta -w\ncd utilmeta\nmeta setup doc\nmeta setup ops\n```\n\n\u5c31\u4f1a\u5f62\u6210\u5982\u4e0b\u7684\u5de5\u7a0b\n\n```\n/utilmeta\n\t/deploy\n\t\t/config\n\t\t\tnginx.conf\n\t\t\tdoc.nginx.conf\n\t\t\tops.nginx.conf\n\t/dev\n\t/dist\n\t\tindex.html\n\t\tdoc.index.html\n\t\tops.index.html\n\t/doc\n\t/media\n\t/ops\n\t/www\n\tmeta.ini\n```\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u7b2c\u4e00\u4e2a\u547d\u4ee4\u52a0\u5165 -w \u53c2\u6570\u521b\u5efa\u4e86\u4e00\u4e2a\u5e26\u6709\u90e8\u7f72\uff0c\u5a92\u4f53\uff0c\u524d\u7aef\u76ee\u5f55\u7684\u5168\u6808\u5de5\u7a0b\uff0c\u9ed8\u8ba4\u521b\u5efa\u4e86\u540d\u4e3awww\u7684\u670d\u52a1\uff0c\u4e4b\u540e\u4e24\u6b21setup\u6ca1\u6709-w\u53c2\u6570\uff0c\u521b\u5efa\u4e86\u4e0ewww\u540c\u7ea7\u7684\u4e24\u4e2a\u540e\u7aef\u670d\u52a1\u5de5\u7a0b\uff0c\u5e76\u4e14\u540c\u65f6\u521b\u5efa\u4e86\u5165\u53e3html\u6587\u4ef6\u548cnginx\u914d\u7f6e\u6587\u4ef6 (\u9ed8\u8ba4\u4e0d\u540c\u5b50\u57df\u540d\u7528\u4e0d\u540c\u5165\u53e3\u914d\u7f6e)\uff0c \u6211\u4eec\u6253\u5f00meta.ini\n\n```ini\n[meta]\nname = utilmeta\nauto-deploy = True\ndefault-service = www\n\n[service:www]\nmain = main\nconf = config.conf:config\nwsgi = config.service:wsgi\n\nuwsgi = deploy/config/uwsgi.ini\n# gunicorn = deploy/config/gunicorn.conf\nnginx = deploy/config/nginx.conf\nnginx-link = /etc/nginx/sites-enabled/utilmeta.conf\n\n[service:doc]\nmain = main\nconf = config.conf:config\nwsgi = config.service:wsgi\n\nuwsgi = deploy/config/doc.uwsgi.ini\n# gunicorn = deploy/config/doc.gunicorn.conf\nnginx = deploy/config/doc.nginx.conf\nnginx-link = /etc/nginx/sites-enabled/doc.utilmeta.conf\n\n[service:ops]\nmain = main\nconf = config.conf:config\nwsgi = config.service:wsgi\n\nuwsgi = deploy/config/ops.uwsgi.ini\n# gunicorn = deploy/config/ops.gunicorn.conf\nnginx = deploy/config/ops.nginx.conf\nnginx-link = /etc/nginx/sites-enabled/ops.utilmeta.conf\n```\n\n\u6587\u4ef6\u5939\u540d\u79f0\u4e0e\u5b50\u57df\u5bf9\u79f0\u53ea\u662f\u4e00\u79cd\u65b9\u4fbf\u7684\u7ea6\u5b9a\uff0c\u4f60\u4e5f\u53ef\u4ee5\u91c7\u53d6\u5176\u4ed6\u547d\u540d\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u8981\u5728Config\u914d\u7f6e\u6587\u4ef6\u4e2d\u58f0\u660e\u6e05\u695a\u8fd9\u4e2a\u670d\u52a1\u5bf9\u5e94\u7684host\n\n\u5e76\u4e14\uff0c\u5728\u4e0d\u540c\u6587\u4ef6\u5939\u4e2d\u8fdb\u884csetup\u7684\u6548\u679c\u53ef\u80fd\u4e0d\u4e00\u6837\uff0c\u5728\u4e0a\u4e2a\u4f8b\u5b50\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u4e00\u4e2aUtilMeta\u9879\u76ee\u4e2d\u8fdb\u884c\uff0c\u5c06\u4f1a\u628a\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u5b50\u670d\u52a1\u8fdb\u884c\u521b\u5efa\uff0c\u800c\u5728\u5916\u90e8\u5219\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u670d\u52a1\n\n##### 2. meta.ini\n\nmeta.ini \u662fUtilMeta\u9879\u76ee\u5728 setup -w \u521d\u59cb\u521b\u5efa\u65f6\u5c31\u4f1a\u5728\u5de5\u7a0b\u76ee\u5f55\u521b\u5efa\u7684\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u5728\u5de5\u7a0b\u4e2d\u7684\u4efb\u610f\u5730\u5740\u6267\u884cmeta\u547d\u4ee4\uff0cmeta\u9ed8\u8ba4\u4f1a\u81ea\u52a8\u5411\u4e0a\u5bfb\u5740\u76f4\u81f3\u627e\u5230meta.ini\uff0c\u6240\u4ee5**\u8bf7\u4e0d\u8981\u968f\u610f\u79fb\u52a8\uff0c\u91cd\u547d\u540d\u6216\u5220\u9664\u8fd9\u4e2a\u6587\u4ef6**\uff0c\u8fd9\u5c06\u4f1a\u5bfc\u81f4meta\u7684\u5927\u90e8\u5206\u547d\u4ee4\u4e0d\u53ef\u7528\uff0c\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u5206\u4e3a\u4e24\u90e8\u5206\n\n[meta] \u4e2d\u7684\u914d\u7f6e\u9879\u4e3a\u9879\u76ee\u7684\u5143\u6570\u636e\uff0c\u5982\u9879\u76ee\u540d\u79f0\uff0c\u9ed8\u8ba4\u64cd\u4f5c\u7684\u670d\u52a1\u7b49\n\n[service:<name>] \u8fd9\u79cd\u5f62\u5f0f\u7684\u4e3a\u4e00\u4e2a\u670d\u52a1\u7684\u914d\u7f6e\uff0c\u4ee5\u4e0a\u7684\u4f8b\u5b50\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728setup\u670d\u52a1\u7684\u540c\u65f6\u670d\u52a1\u914d\u7f6e\u4f1a\u88ab\u6dfb\u52a0\u5230meta.ini\u4e2d\uff0c\u8fd9\u4e9b\u914d\u7f6e\u5f88\u91cd\u8981\n\n* **main**: \u670d\u52a1\u5165\u53e3\u4e3b\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4e3amain\uff08\u5373\u670d\u52a1\u76ee\u5f55\u4e0b\u7684main.py\u6587\u4ef6\uff09\uff0c\u5f71\u54cdserve\u547d\u4ee4\n* **conf**:  \u670d\u52a1\u914d\u7f6e\u6587\u4ef6\u6a21\u5757\uff0c\u9ed8\u8ba4\u4e3aconfig.conf:config \uff08\u5373\u670d\u52a1\u76ee\u5f55\u4e0b config/conf.py\u4e2d\u7684 config\u5bf9\u8c61\uff09\n* **wsgi**: \u670d\u52a1WSGI\u5e94\u7528\u6a21\u5757\uff0c\u9ed8\u8ba4\u4e3aconfig.service:wsgi \uff08\u5373\u670d\u52a1\u76ee\u5f55\u4e0b config/service.py\u4e2d\u7684 wsgi\u5bf9\u8c61\uff09\n* **uwsgi**: UtilMeta\u652f\u6301\u7684WSGI\u6709 uwsgi \u548c gunicorn\uff0c\u4f9d\u7167\u4f60\u9009\u7528\u7684WSGI\u9009\u62e9\u8fd9\u4e24\u4e2a\u53c2\u6570\u4e2d\u7684\u4e00\u4e2a\uff0cuwsgi\u53c2\u6570\u6307\u5b9auwsgi\u7684\u914d\u7f6e\u6587\u4ef6\n* **gunicorn**: \u540c\u4e0a\uff0c\u8fd9\u662f\u6307\u5b9agunicorn\u914d\u7f6e\u6587\u4ef6\u7684\u53c2\u6570\n* **nginx**:  UtilMeta\u652f\u6301\u7684Web\u670d\u52a1\u5668\u4e3a Nginx\u548cApache\uff0c\u9ed8\u8ba4\u4f7f\u7528nginx\uff0c\u8fd9\u4e2a\u53c2\u6570\u6307\u5b9a\u9879\u76ee\u4e2d\u7684nginx\u914d\u7f6e\u6587\u4ef6\uff08\u53ea\u914d\u7f6e\u5355\u4e2a\u670d\u52a1\uff0c\u4e0d\u662f\u4e3b\u6587\u4ef6 /etc/nginx/nginx.conf\uff09\n* **nginx-link**: \u4ee5\u4e0anginx\u914d\u7f6e\u6587\u4ef6\u5c06**\u8f6f\u94fe\u63a5**\u5230\u7684\u5730\u5740\uff0c\u5fc5\u987b\u4e3a**\u7edd\u5bf9\u76ee\u5f55**\uff0c\u5728Ubuntu\u4e2d\u901a\u5e38\u5728/etc/nginx/sites-enabled/\u4e2d\uff0c\u901a\u8fc7\u8f6f\u94fe\u63a5\u5bfc\u5165\u5230\u4e3b\u6587\u4ef6\u5c06\u4f1a\u4f7f\u5355\u4e2a\u914d\u7f6e\u6587\u4ef6\u751f\u6548\n\n\u6240\u6709\u7684\u7b2c\u4e09\u65b9\u914d\u7f6e\u6587\u4ef6\uff08uwsgi/gunicorn/nginx/apache\uff09\u5728\u9879\u76ee\u521d\u59cb\u5316\u65f6\u4f1a\u81ea\u52a8\u751f\u6210\uff0c\u4f60\u53ef\u4ee5\u4fee\u6539\u5b83\uff0c\u5f53meta\u914d\u7f6e\u7684auto-deploy\u4e3aTrue\u65f6\u8fd9\u4e2a\u6587\u4ef6\u5c06\u5728\u6bcf\u6b21\u90e8\u7f72\u65f6**\u6839\u636e\u4f60\u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684deploy\u53c2\u6570\u8fdb\u884c\u81ea\u52a8\u751f\u6210**\n\n\n## Operations:\n\n\u63a5\u4e0b\u6765\u5c06\u4f1a\u8be6\u7ec6\u4ecb\u7ecdUtilMeta\u7684\u8fd0\u7ef4\u7cfb\u7edf\n\n\n\n## Tutorial:\n\n\u5728\u4e86\u89e3UtilMeta\u7684\u5404\u4e2a\u7ec4\u4ef6\u548c\u6574\u4e2a\u6846\u67b6\u7684\u67b6\u6784\u540e\uff0c\u6211\u4eec\u63a5\u7740QuickStart\u4e2d\u7684\u6848\u4f8b\u8fdb\u4e00\u6b65\u5f00\u53d1\u6210\u4e00\u4e2a\u5b8c\u6574\u7ad9\u70b9\uff0c\u5e76\u5728\u5176\u4e2d\u6df1\u5165\u4e86\u89e3UtilMeta\u7684\u5b9e\u8df5\u7528\u6cd5\n\n\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://utilmeta.com", "keywords": "util meta django api framework", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "UtilMeta", "package_url": "https://pypi.org/project/UtilMeta/", "platform": "", "project_url": "https://pypi.org/project/UtilMeta/", "project_urls": {"Documentation": "https://docs.utilmeta.com", "Homepage": "https://utilmeta.com", "Project Home": "https://utilmeta.com", "Source Code": "https://github.com/metadef/utilmeta"}, "release_url": "https://pypi.org/project/UtilMeta/1.4/", "requires_dist": ["django (>=2.2.0)"], "requires_python": ">=3.6", "summary": "Ultimate API service framework based on django, redefine the application development workflow", "version": "1.4", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>UtilMeta</h1>\n<h2>Feature:</h2>\n<p>UtilMeta\u662f\u4e00\u4e2a\u57fa\u4e8edjango\u7684API\u6846\u67b6\uff0c\u5bf9API\u670d\u52a1\u8fdb\u884c\u4e86\u9ad8\u5ea6\u7684\u62bd\u8c61\u548c\u6574\u5408\uff0c\u6709\u4ee5\u4e0b\u4e3b\u8981\u529f\u80fd\u7279\u8272</p>\n<h4>1. \u72ec\u7279\u7684\u6570\u636e\u63a5\u53e3\u67b6\u6784\u6a21\u5f0f</h4>\n<p>UtilMeta \u7684\u67b6\u6784\u4e3a</p>\n<ul>\n<li>\n<p><strong>Model</strong>:  \u4e0edjango\u4e00\u81f4\u7684\u6a21\u578b\u5c42\uff0c\u4ec5\u7528\u4e8e\u8868\u7ed3\u6784\u548c\u8868\u5173\u7cfb\u7684\u5b9a\u4e49</p>\n</li>\n<li>\n<p><strong>Module</strong>:  \u529f\u80fd\u5f3a\u5927\u7684\u6a21\u5757\u5c42\uff0c\u9075\u5faaREST\u6807\u51c6\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u7528\u7ec4\u4ef6\u53c2\u6570\u914d\u7f6e\u7684\u65b9\u5f0f\u5b9a\u4e49\u5b57\u6bb5\u7684\u8bfb/\u5199\u6743\u9650\uff0c\u67e5\u8be2\u5b57\u6bb5\u548c\u67e5\u8be2\u65b9\u6cd5\uff0cget/put/post/patch/delete\u7684\u6743\u9650\uff0c\u6a21\u5757\u5728\u5b9a\u4e49\u597d\u4e4b\u540e\uff0c<strong>\u65e0\u9700\u7f16\u5199\u4efb\u4f55ORM\u903b\u8f91</strong>\uff0cUtilMeta\u4f1a\u63a5\u624b\u5bf9\u8d44\u6e90\u7684\u67e5\u8be2\uff0c\u64cd\u4f5c\uff0c\u63d0\u4f9b\u7684\u65b9\u4fbf\u7684\u94a9\u5b50\uff0c\u53ef\u4ee5\u5b9a\u5236\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\n\u524d\u7aef\u53ef\u4ee5\u5728\u5141\u8bb8\u7684\u8303\u56f4\u5185\uff0c<strong>\u901a\u8fc7\u53c2\u6570\u5b9a\u4e49\u8fd4\u56de\u7684\u5b57\u6bb5\uff0c\u683c\u5f0f\uff0c\u987a\u5e8f</strong>\u7b49\uff0c\u8fd9\u4e9b\u529f\u80fd\u4e5f\u6709\u522b\u4e8e\u4f20\u7edf\u7684REST\uff0c\u540c\u6837\u6574\u5408\u5728Module\u7cfb\u7edf\u4e2d\u7531\u6846\u67b6\u81ea\u52a8\u5b8c\u6210</p>\n</li>\n<li>\n<p><strong>API</strong>\uff1a\u63a5\u53e3\u5c42\uff0c\u8d1f\u8d23\u5b9a\u4e49\u63a5\u53e3\u7684url\uff0c\u53c2\u6570\u7684\u7c7b\u578b\u548c\u9650\u5236\uff0c\u5e76\u63d0\u4f9b\u5f3a\u5927\u7684\u53c2\u6570\u6a21\u677f\u89e3\u6790\u7cfb\u7edf\uff0c\u8fc7\u6ee4\u810f\u8bf7\u6c42\uff0c\u4ee5\u72ec\u521b\u7684<strong>\u7ec4\u4ef6\u6302\u8f7d</strong>\u65b9\u5f0f\u66ff\u4ee3django\u7684urlpatterns\u65b9\u5f0f\u4f18\u96c5\u7684\u5b9a\u4e49url\u7ed3\u6784\uff0c\u5e76\u4e14\u63d0\u4f9b\u7075\u6d3b\u7684\u94a9\u5b50\uff0cAPI\uff0cModule\u548c\u51fd\u6570\u90fd\u53ef\u4ee5\u7528\u53d8\u91cf\u7684\u65b9\u5f0f\u6302\u8f7d\u5230\u7236API\u4e0a\uff0c\u5b9e\u73b0\u7ed3\u6784\u81ea\u76f8\u4f3c\u7684API\u6709\u5411\u56fe\uff0c\u7ed3\u6784\u6e05\u6670</p>\n</li>\n</ul>\n<h4>2. \u7ec4\u4ef6\u5316\u5b9a\u4e49API\u670d\u52a1\uff1a</h4>\n<p>UtilMeta\u63d0\u4f9b\u5927\u91cf\u529f\u80fd\u5f3a\u5927\u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982<strong>\u53c2\u6570\u6a21\u677f/\u67e5\u8be2/\u6743\u9650/\u5a92\u4f53/\u5206\u9875/\u65e5\u5fd7</strong>\u7b49\u7b49\uff0c\u901a\u8fc7\u53c2\u6570\u5b9a\u4e49\u7684\u65b9\u5f0f\u6253\u9020API\u7cfb\u7edf\uff0c\u53ef\u4ee5\u6e05\u6670\u6709\u6548\u7684\u7ec4\u7ec7\u4ee3\u7801\uff0c\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\uff0c\u589e\u52a0\u6e90\u7801\u53ef\u8bfb\u6027\uff0c\u501f\u52a9\u4ed6\u4eec\uff0c\u53ef\u4ee5\u5b9e\u73b0</p>\n<ul>\n<li>\n<p><strong>Config</strong>: \u4ee3\u66ff\u5b9a\u4e49\u53d8\u91cf\u65b9\u5f0f\u7684settings\u914d\u7f6e\uff0c\u8fd0\u7528\u591a\u4e2a\u914d\u7f6e\u5b50\u7ec4\u4ef6\u4ee5\u53c2\u6570\u65b9\u5f0f\u8fdb\u884c\u9879\u76ee\u8bbe\u7f6e\uff0c\u65e2\u65b9\u4fbfIDE\u7ed9\u51fa\u63d0\u793a\u548c\u589e\u52a0\u53ef\u8bfb\u6027\uff0c\u4e5f\u53ef\u4ee5\u8fdb\u884c\u591a\u9879check\u4fdd\u8bc1\u914d\u7f6e\u6b63\u786e</p>\n</li>\n<li>\n<p><strong>Auth</strong>\uff1a<strong>\u7ec6\u7c92\u5ea6\u7684\u7528\u6237\u6743\u9650\u914d\u7f6e</strong>\uff0c\u4e00\u4e2a\u8bf7\u6c42\u7684\u72b6\u6001\uff08\u672a\u767b\u5f55\uff0c\u5df2\u767b\u5f55\uff09\uff0c\u7528\u6237\u7684\u72b6\u6001\uff08\u7ba1\u7406\u5458\uff0c\u666e\u901a\u7528\u6237\uff09\uff0c\u7528\u6237\u4e0e\u8bf7\u6c42\u8d44\u6e90\u7684\u5173\u7cfb\uff08\u5982\u7528\u6237\u662f\u8bf7\u6c42\u7684\u5185\u5bb9\u7684\u4f5c\u8005\uff09\u4ee5\u53ca\u8bf7\u6c42\u7684\u65b9\u6cd5\uff08GET/PUT/...\uff09\u5728\u8fd9\u4e9b\u7ef4\u5ea6\u4e0a\u90fd\u53ef\u4ee5\u6e05\u6670\u7b80\u6d01\u7684\u914d\u7f6e\u8bbf\u95ee\u6743\u9650\uff0c\u6ca1\u6709\u6743\u9650\u4f1a\u8fd4\u56de403</p>\n</li>\n<li>\n<p><strong>Rule/Schema/Response</strong>:  \u7075\u6d3b\u5730\u4e3a\u6bcf\u4e2aAPI\u5b9a\u5236<strong>\u8bf7\u6c42\u53c2\u6570\u6a21\u677f</strong>\uff0c<strong>\u8fd4\u56de\u6a21\u677f</strong>\u548c<strong>\u53c2\u6570\u89c4\u5219</strong></p>\n</li>\n<li>\n<p><strong>Relate</strong>: \u5173\u8054\u8868\u7684\u548c\u4e2d\u95f4\u8868\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u914d\u7f6e\u7ec4\u4ef6\uff0c\u96c6\u6210\u5728Module\u4e2d</p>\n</li>\n<li>\n<p><strong>Filter/Search</strong>: \u67e5\u8be2\u641c\u7d22\u7ec4\u4ef6\uff0c\u65b9\u4fbf\u7684\u5b9e\u73b0\u6a21\u5757\u641c\u7d22\u548c\u5168\u7ad9\u641c\u7d22</p>\n</li>\n<li>\n<p><strong>Media</strong>: \u5a92\u4f53\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u5a92\u4f53\u6587\u4ef6\uff08\u97f3\u89c6\u9891\u56fe\u7247\u548c\u4e00\u822c\u6587\u4ef6\uff09\u7684\u5b58\u50a8\u548c\u6d41\u5f0f\u8fd4\u56de</p>\n</li>\n</ul>\n<h4>3.  \u5f3a\u5927\u7684\u9879\u76ee\u7ba1\u7406\u540e\u53f0</h4>\n<p>UtilMeta \u63d0\u4f9b\u4e00\u4e2a\u9879\u76ee\u7684\u7ba1\u7406\u540e\u53f0\uff0c\u9ed8\u8ba4\u5305\u62ec\u4ee5\u4e0b\u90e8\u5206</p>\n<ul>\n<li><strong>\u81ea\u52a8\u7684API\u6587\u6863</strong>\uff1aUtilMeta\u6846\u67b6\u4f1a\u6574\u5408\u4f60\u7684\u63a5\u53e3url\uff0c\u53c2\u6570\u6a21\u677f\uff0c\u8fd4\u56de\u6a21\u677f\u548c\u5355\u5143\u6587\u6863\uff08\u4f60\u5728\u51fd\u6570\u4e2d\u5199\u7684\u6587\u6863\uff09\u5230\u4e00\u4e2a\u81ea\u52a8\u7684\u4ea4\u4e92API\u6587\u6863\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u63a5\u53e3\u8fdb\u884c\u53c2\u6570\u6d4b\u8bd5\uff0c\u800c\u4e14\u540e\u7aef\u4ee3\u7801\u7684\u6539\u53d8\u5c06\u4f1a\u76f4\u63a5\u5bfc\u81f4API\u6587\u6863\u6539\u53d8\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7ef4\u62a4\u6587\u6863\uff0c\u524d\u540e\u7aef\u5f00\u53d1\u4eba\u5458\u90fd\u53ef\u4ee5\u53c2\u7167\u8fd9\u4efd\u6c38\u8fdc\u6700\u65b0\u7684\u6587\u6863</li>\n<li><strong>\u65e5\u5fd7\u7cfb\u7edf</strong>\uff1aUtilMeta\u7684\u65e5\u5fd7\u7cfb\u7edf\u9664\u4e86\u4f1a\u8bb0\u5f55\u6bcf\u4e00\u6b21\u8bbf\u95ee\u7684\u5404\u9879\u57fa\u672c\u6570\u636e\uff08\u65f6\u95f4\uff0chttp_method, status, ip, content_type, content_length\u548c\u8bf7\u6c42\u6beb\u79d2\u65f6\u95f4\uff09, \u8fd8\u4f1a\u7ed9\u51fa\u8bf7\u6c42\u7684\u7ec4\u4ef6 \uff08API/Module\u6216\u51fd\u6570\uff09\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u8bbe\u7f6e\u8bb0\u5f55\u8bf7\u6c42\u7684\u67e5\u8be2\u65f6\u95f4\u7ec6\u8282\uff0c\u5177\u4f53\u53c2\u6570\u548c\u7ecf\u8fc7\u7684\u94a9\u5b50\u51fd\u6570\uff0c\u65b9\u4fbf\u8fdb\u884c\u5206\u6790\u8c03\u8bd5\uff0cbug\u590d\u73b0</li>\n<li><strong>\u81ea\u52a8\u6d4b\u8bd5\u7cfb\u7edf</strong>\uff1a\u76f4\u63a5\u4ee5Web\u65b9\u5f0f\u7ba1\u7406\u548c\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\uff0c\u538b\u529b\u6d4b\u8bd5\uff0c\u5e76\u53cd\u9988\u6d4b\u8bd5\u62a5\u544a\uff0c\u6240\u6709\u6d4b\u8bd5\u81ea\u52a8\u8fdb\u884c</li>\n<li><strong>\u7ba1\u7406\u5458\u7cfb\u7edf</strong>\uff1a\u63d0\u4f9broot/manager/worker\u7684\u4e09\u7ea7\u6743\u9650\u7cfb\u7edf\uff0c\u8d1f\u8d23\u5bf9\u7ad9\u5185\u7684\u8d44\u6e90\u8fdb\u884c\u7ba1\u7406\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6269\u5c55\u52a0\u5165\u5982\u5185\u5bb9\u5ba1\u6838\u7b49\u529f\u80fd</li>\n<li><strong>\u6570\u636e\u76d1\u63a7\u5206\u6790\u7cfb\u7edf</strong>\uff1a\u901a\u8fc7\u914d\u7f6e\u5bf9\u7ad9\u5185\u8d44\u6e90\u7684\u6570\u636e\u8fdb\u884c\u5206\u6790\u7edf\u8ba1\uff08\u5982\u7528\u6237\u5728\u7ebf\u4eba\u6570\u6bcf\u5c0f\u65f6\u7edf\u8ba1\uff09\uff0c\u751f\u6210\u6570\u636e\u56fe\u8868\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u670d\u52a1\u5668\u8fd0\u884c\u6570\u636e\u8fdb\u884c\u76d1\u63a7\uff0c\u5206\u6790</li>\n</ul>\n<h4>4. \u81ea\u52a8\u5316\uff0c\u4e00\u952e\u5316\u7684\u90e8\u7f72\u670d\u52a1</h4>\n<ul>\n<li><strong>\u547d\u4ee4\u884c\u5de5\u5177meta</strong>: \u6269\u5c55\u81eadjango\u7684manage.py\uff0c\u53ef\u4ee5\u7ed3\u5408\u591a\u79cd\u65b9\u6848\uff08uwsgi, gunicorn\uff09\u5b9e\u73b0\u81ea\u52a8\u90e8\u7f72\uff0c\u6839\u636e\u9879\u76ee\u8bbe\u7f6e\u81ea\u52a8\u751f\u6210nginx\u914d\u7f6e\u6587\u4ef6</li>\n<li><strong>\u53ef\u6269\u5c55\u7684\u81ea\u52a8GET\u8bf7\u6c42\u7f13\u5b58</strong></li>\n</ul>\n<p>UtilMeta\u6839\u636e\u4f60\u5b9a\u4e49\u7684Module\uff0c\u5728\u914d\u7f6e\u7f13\u5b58\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u7f13\u5b58\u5927\u90e8\u5206GET\u8bf7\u6c42\u5e76\u4e14\u4e0d\u9700\u8981\u5f00\u53d1\u8005\u5173\u5fc3\u7f13\u5b58\u7ec6\u8282\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6839\u636e\u7cfb\u7edf\u5185\u5b58\u8c03\u6574\u7f13\u5b58\u91cf\uff0c\u5e76\u4e14\u53ef\u4ee5\u7075\u6d3b\u7684\u914d\u7f6e\u6269\u5c55\uff0c\u5982redis\u4e3b\u4ece\u7f13\u5b58\u96c6\u7fa4\u914d\u7f6e\uff0ctimeout\u65f6\u95f4,\nUtilMeta\u8fd8\u53ef\u4ee5\u8fdb\u884c\u542f\u52a8\u9884\u70ed\uff0c\u5c06\u6570\u636e\u5e93\u7684\u90e8\u5206\u6570\u636e\uff08\u53d6\u51b3\u4e8e\u4f60\u7684\u914d\u7f6e\u7a7a\u95f4\uff09\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d</p>\n<h2>Quick Start</h2>\n<p>\u6211\u4eec\u5c06\u5728\u8fd9\u91cc\u5feb\u901f\u5efa\u7acb\u4e00\u4e2a\u5c0f\u578b\u7684\u5185\u5bb9\u5e73\u53f0\u4f5c\u4e3aUtilMeta\u7684Quick Start</p>\n<h3>1. \u5b89\u88c5\u4e0e\u521b\u5efa\u9879\u76ee</h3>\n<p>\u4f7f\u7528pip\u5de5\u5177\u8fdb\u884c\u5b89\u88c5</p>\n<pre>pip install utilmeta\n</pre>\n<p>UtilMeta\u4f1a\u540c\u6b65\u5b89\u88c5\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177meta\uff0cmeta\u662fdjango\u7684manage.py\u7684\u5c01\u88c5\uff0c\u52a0\u5165\u4e86\u81ea\u52a8\u90e8\u7f72\uff0c\u6d4b\u8bd5\uff0c\u76d1\u63a7\u7b49\u529f\u80fd\uff0c\u6211\u4eec\u7684\u5168\u90e8\u547d\u4ee4\u5c06\u7531\u5b83\u6765\u5b8c\u6210\uff0c\u4f7f\u7528</p>\n<pre>meta setup example\n</pre>\n<p>\u521b\u5efa\u9879\u76ee\uff0c\u9ed8\u8ba4\u521b\u5efa\u7684\u6587\u4ef6\u5939\u7ed3\u6784\u4e3a\uff1a</p>\n<pre><code> example/\n  config/\n    __init__.py\n    conf.py\n    service.py\n  media/\n    image/\n  module/\n    __init__.py\n    modules.py\n  service/\n    __init__.py\n    api.py\n  __init__.py\n  main.py\n</code></pre>\n<p>\u8fd9\u6837\u7684\u9879\u76ee\u7ed3\u6784\u9002\u5408\u4e8e\u7eaf\u540e\u7aef\u5f00\u53d1\uff0c\u52a0\u5165\u53c2\u6570 -w \u5c06\u4f1a\u589e\u52a0\u4e00\u7ea7\u76ee\u5f55</p>\n<pre>meta setup example -w\n</pre>\n<p>\u5f97\u5230\u76ee\u5f55</p>\n<pre><code>example/\n  deploy/\t\t\n    config/\n      nginx.conf\n      uwsgi.ini\n    log/\n    run/\n    sql/\n  dev/\n    node_modules/\n  dist/\n    css/\n    img/\n    js/\n    index.html\n  media/\n    image/\n  www/\n    config/\n    module/\n    service/\n    main.py\n</code></pre>\n<p>\u8fd9\u6837\u7684\u7ed3\u6784\u9002\u5408\u4e8e\u4e2a\u4eba\u5168\u6808\u5316\u7684\u5f00\u53d1\uff0c\u7ed9\u51fa\u7684\u5206\u7c7b\u5efa\u8bae\u662f\uff1a</p>\n<ul>\n<li>deploy \u4e2d\u5b58\u653e<strong>\u90e8\u7f72</strong>\u6709\u5173\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u65e5\u5fd7\u6587\u4ef6\u7b49</li>\n<li>dev \u662f<strong>\u524d\u7aef\u5de5\u4f5c</strong>\u76ee\u5f55\uff0c\u5b58\u653e Vue\uff0cReact\u6216\u8005App\u7684\u524d\u7aef\u6587\u4ef6\uff0c</li>\n<li>dist \u662f<strong>\u524d\u7aef\u90e8\u7f72</strong>\u76ee\u5f55\uff0c\u5404\u524d\u7aef\u6846\u67b6build production\u7684\u5b58\u653e\u76ee\u5f55\u6216app\u8f6f\u4ef6\u5b58\u653e\u76ee\u5f55\uff0c</li>\n<li>media \u662f\u7528\u6237\u4e0a\u4f20\u7684<strong>\u5a92\u4f53\u6587\u4ef6</strong>\u5b58\u653e\u76ee\u5f55\uff0c\u56fe\u7247\uff0c\u97f3\u89c6\u9891\u7b49</li>\n<li>www \u548c\u4e0a\u9762\u7b2c\u4e00\u6b21\u521b\u5efa\u7684\u76ee\u5f55\u7ed3\u6784\u4e00\u6837\uff0c\u662f<strong>\u540e\u7aef\u6587\u4ef6</strong>\u5b58\u653e\u76ee\u5f55</li>\n</ul>\n<h3>2. \u521b\u5efa\u4e0e\u6dfb\u52a0\u6a21\u5757</h3>\n<p>\u5728UtilMeta\u91cc\uff0c\u6a21\u5757\u662f\u6570\u636e\u6a21\u578b\u7684\u7ec4\u7ec7\u5355\u4f4d\uff0c\u7c7b\u8bd5\u4e8edjango\u4e2d\u7684app\uff0c\u6211\u4eec\u5148\u6dfb\u52a0\u4e00\u4e2a\u8d26\u6237\u6a21\u5757\uff0c\u7528\u4e8e\u5e73\u53f0\u7528\u6237\u7684\u7ba1\u7406\uff0c\u8fdb\u5165module\u6587\u4ef6\u5939\u5e76\u6dfb\u52a0\u6a21\u5757</p>\n<pre><span class=\"nb\">cd</span> module\nmeta add account\n</pre>\n<p>\u4f1a\u521b\u5efa\u4ee5\u4e0b\u7684\u76ee\u5f55\u7ed3\u6784</p>\n<pre><code>module/\n  account/\n    migrations/\n      __init__.py\n    __init__.py\n    models.py\n    module.py\n</code></pre>\n<p>models\u5c42\u7684\u7528\u6cd5\u4e0edjango\u4fdd\u6301\u4e00\u81f4\uff0c\u6211\u4eec\u6253\u5f00models.py\uff0c\u7f16\u5199\u6a21\u578b</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">utilmeta.fields</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Account</span><span class=\"p\">(</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n   <span class=\"n\">username</span> <span class=\"o\">=</span> <span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">,</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n   <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">''</span><span class=\"p\">)</span>\n   <span class=\"n\">password</span> <span class=\"o\">=</span> <span class=\"n\">PasswordField</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">))</span>\n   <span class=\"n\">intro</span> <span class=\"o\">=</span> <span class=\"n\">RichTextField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">''</span><span class=\"p\">)</span>\n   <span class=\"n\">avatar</span> <span class=\"o\">=</span> <span class=\"n\">FileField</span><span class=\"p\">(</span><span class=\"n\">upload_to</span><span class=\"o\">=</span><span class=\"s1\">'avatar/'</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"avatar/default.png\"</span><span class=\"p\">)</span>\n   <span class=\"n\">register_date</span> <span class=\"o\">=</span> <span class=\"n\">DateField</span><span class=\"p\">(</span><span class=\"n\">auto_now_add</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre>\n<p>UtilMeta\u7684fields\u6587\u4ef6\u4e2d\u5bfc\u5165\u4e86django models\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\uff08\u5305\u62ecpostgresql\u5b57\u6bb5\uff09\uff0c\u4e00\u4e9b\u5e38\u7528\u7684callable\uff08CASCADE, PROTECT, SET_NULL\u7b49\uff09\uff0c\u4ee5\u53ca\u4e00\u4e9bUtilMeta\u81ea\u5b9a\u4e49\u7684\u5b57\u6bb5\uff0c\u5b83\u4eec\u7684\u547d\u540d\u90fd\u5f88\u89c4\u8303\uff0c\u5bfc\u5165\u5168\u90e8\u4e5f\u4e0d\u4f1a\u5bf9\u547d\u540d\u7a7a\u95f4\u9020\u6210\u5f88\u5927\u5f71\u54cd\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u53ea\u5bfc\u5165fields</p>\n<p>\u4ee5\u4e0a\u4ee3\u7801\u4e2d\u6709\u4e24\u4e2aUtilMeta\u5b9a\u4e49\u7684\u5b57\u6bb5</p>\n<p><strong>PasswordField</strong>: \u81ea\u5e26\u54c8\u5e0c\u52a0\u5bc6\u7684\u5b57\u6bb5\uff0clen\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u5b9e\u9645\u5bc6\u7801\u7684\u957f\u5ea6\u8303\u56f4</p>\n<p><strong>RichTextFIeld</strong>: \u7ee7\u627f\u81eaTextField\uff0c\u81ea\u5e26XSS\u8fc7\u6ee4</p>\n<p>\u9664\u6b64\u4e4b\u5916\u4e0edjango models\u7684\u7f16\u5199\u5e76\u65e0\u5dee\u5f02</p>\n<h3>3.\u9879\u76ee\u914d\u7f6e</h3>\n<p>\u6dfb\u52a0\u6a21\u5757\u540e\u9700\u8981\u5728\u8bbe\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0modules\uff0c\u6211\u4eec\u6253\u5f00config\u6587\u4ef6\u5939\u4e0b\u7684conf.py\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230\u914d\u7f6e\u9879\u6709\u522b\u4e8edjango\u7684\u53d8\u91cf\u5b9a\u4e49\u65b9\u6cd5\uff0c\u7528\u7c7b\u5b9e\u4f8b\u53c2\u6570\u7684\u65b9\u6cd5\u8fdb\u884c\u914d\u7f6e\uff0c\n\u53ef\u4ee5\u65b9\u4fbf\u7684\u501f\u52a9IDE\u7684\u81ea\u52a8\u63d0\u793a\u8865\u9f50\u627e\u5230\u76f8\u5e94\u7684\u914d\u7f6e\u9879</p>\n<pre><span class=\"n\">config</span> <span class=\"o\">=</span> <span class=\"n\">conf</span><span class=\"o\">.</span><span class=\"n\">Config</span><span class=\"p\">(</span>\n   <span class=\"vm\">__name__</span><span class=\"p\">,</span>\n   <span class=\"o\">...</span>\n   <span class=\"n\">modules_dir</span><span class=\"o\">=</span><span class=\"s1\">'module'</span><span class=\"p\">,</span>\n   <span class=\"n\">auth</span><span class=\"o\">=</span><span class=\"n\">conf</span><span class=\"o\">.</span><span class=\"n\">Auth</span><span class=\"p\">(</span>\t\t      <span class=\"c1\"># new</span>\n        <span class=\"n\">user_model</span><span class=\"o\">=</span><span class=\"s1\">'account.Account'</span><span class=\"p\">,</span>\n        <span class=\"n\">login_fields</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'username'</span><span class=\"p\">,)</span>\n   <span class=\"p\">),</span>\n   <span class=\"n\">databases</span><span class=\"o\">=</span><span class=\"p\">{</span>\n        <span class=\"s1\">'default'</span><span class=\"p\">:</span> <span class=\"n\">conf</span><span class=\"o\">.</span><span class=\"n\">Database</span><span class=\"p\">(</span>\n            <span class=\"n\">engine</span><span class=\"o\">=</span><span class=\"n\">conf</span><span class=\"o\">.</span><span class=\"n\">Database</span><span class=\"o\">.</span><span class=\"n\">SQLITE</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">'db'</span><span class=\"p\">,</span>\n        <span class=\"p\">),</span>\n    <span class=\"p\">},</span>\n   <span class=\"o\">...</span>\n<span class=\"p\">)</span>\n</pre>\n<p>modules_dir\u662f\u9879\u76ee\u5b58\u653e\u6a21\u578b\u7684\u76ee\u5f55\uff0c\u5176\u4e2d\u7684\u6587\u4ef6\u5939\u90fd\u4f1a\u88ab\u81ea\u52a8\u89c6\u4e3a\u4e00\u4e2adjango app\u8fdb\u884c\u5904\u7406\uff0c\nUtilMeta\u4f1a\u6839\u636e\u4f60\u7684\u914d\u7f6e (modules, session\uff0c\u662f\u5426\u4e3a\u751f\u4ea7\u73af\u5883\u7b49) \u751f\u6210INSTALLED_APPS</p>\n<p>\u800c\u4e0b\u9762\u914d\u7f6eauth\u662f\u4e3a\u4e86\u89c4\u5b9a\u6211\u4eec\u521b\u5efa\u7684Account\u7c7b\u662f\u9879\u76ee\u7684<strong>\u7528\u6237\u7c7b</strong>\uff0c\u5fc5\u987b\u914d\u7f6e\u8fd9\u9879\u624d\u80fd\u542f\u7528\u9488\u5bf9\u7528\u6237\u7684\u6743\u9650\u914d\u7f6e\u7b49\u5f88\u591a\u91cd\u8981\u529f\u80fd\uff0c\u5176\u4e2d\u53c2\u6570\u7684\u8981\u6c42\u662f\uff1a</p>\n<ul>\n<li>login_fields: \u767b\u5f55\u5b57\u6bb5\uff0c\u9700\u8981\u4e3aunique\u7684</li>\n<li>user_model\uff1a<strong>\u5fc5\u987b\u9879</strong>\uff0c\u5982\u679c\u4e0d\u6307\u5b9aauth_model\u5219\u5bf9\u5e94\u7684\u6a21\u578b\u4e2d\u5fc5\u987b\u5305\u542bPasswordFIeld\u4f5c\u4e3a\u5bc6\u7801\u5b57\u6bb5</li>\n<li>auth_model:  \u5982\u679c\u9700\u8981\u7528\u6237\u6a21\u578b\u548c\u5bc6\u7801\u6a21\u578b\u5206\u79bb\uff0c\u53ef\u4ee5\u7528\u5b83\u6307\u5b9a\u4e00\u4e2a\u5bc6\u7801\u6a21\u578b\uff0c\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u6307\u5411user_model\u7684\u4e00\u5bf9\u4e00\u5b57\u6bb5\u548c\u4e00\u4e2aPasswordFIeld\uff0c\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u65e0\u9700\u914d\u7f6e</li>\n</ul>\n<p>\u6211\u4eec\u56de\u5230\u6709main.py\u7684\u76ee\u5f55\uff0c\u6267\u884c</p>\n<pre>meta makemigrations\nmeta migrate\n</pre>\n<p>\u5982\u679c\u6211\u4eec\u4f7f\u7528sqlite\u6570\u636e\u5e93\uff0c\u4f1a\u770b\u5230\u5df2\u7ecf\u5728\u9879\u76ee\u6587\u4ef6\u5939\u521b\u5efa\u4e86db.sqlite3\u6587\u4ef6</p>\n<h3>4. \u6a21\u5757\u5316</h3>\n<p>\u8fd9\u4e00\u6b65\u5c31\u662f\u6709\u8da3\u7684\u5730\u65b9\u4e86\uff0c\u6211\u4eec\u5c06\u4f1a\u901a\u8fc7UtilMeta\u7684\u6a21\u5757\u7c7b\u5f00\u53d1\u4e00\u4e2a\u7528\u6237\u7684\u6570\u636e\u63a5\u53e3\uff0c\n\u4f60\u5c06\u770b\u5230\u4e00\u4e2a\u72ec\u7279\u800c\u5f3a\u5927\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u673a\u5236\uff0c\u6211\u4eec\u6253\u5f00module.py\uff0c\u7f16\u5199</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">utilmeta.utils</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.models</span> <span class=\"kn\">import</span> <span class=\"n\">Account</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">AccountMain</span><span class=\"p\">(</span><span class=\"n\">Module</span><span class=\"p\">):</span>\n   <span class=\"nd\">@mod</span><span class=\"o\">.</span><span class=\"n\">proxy</span>\n   <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n       <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Account</span>\n       <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n           <span class=\"n\">readonly</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'username'</span><span class=\"p\">,</span> <span class=\"s1\">'register_date'</span><span class=\"p\">),</span>\n           <span class=\"n\">writable</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'name'</span><span class=\"p\">,</span> <span class=\"s1\">'intro'</span><span class=\"p\">,</span> <span class=\"s1\">'avatar'</span><span class=\"p\">)</span>\n       <span class=\"p\">)</span>\n\n      <span class=\"n\">method</span> <span class=\"o\">=</span> <span class=\"n\">Method</span><span class=\"p\">(</span>\n           <span class=\"n\">get</span><span class=\"o\">=</span><span class=\"n\">Auth</span><span class=\"p\">(</span><span class=\"n\">state</span><span class=\"o\">=</span><span class=\"s2\">\"login\"</span><span class=\"p\">),</span>\n           <span class=\"n\">put</span><span class=\"o\">=</span><span class=\"n\">Auth</span><span class=\"p\">(</span><span class=\"n\">relate</span><span class=\"o\">=</span><span class=\"s2\">\"self\"</span><span class=\"p\">),</span>\n           <span class=\"n\">delete</span><span class=\"o\">=</span><span class=\"n\">Auth</span><span class=\"p\">(</span><span class=\"n\">require</span><span class=\"o\">=</span><span class=\"n\">Auth</span><span class=\"o\">.</span><span class=\"n\">admin</span><span class=\"p\">)</span>\n       <span class=\"p\">)</span>\n</pre>\n<p>\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2aAccountMain\u6a21\u5757\u7c7b\uff0c\u7ee7\u627f\u81eaModule\uff0c\u5728Meta\u7c7b\u4e2d\u6307\u5b9a\u4e86\u4e09\u4e2a\u91cd\u8981\u7684\u53c2\u6570</p>\n<ul>\n<li>\n<p><strong>model</strong>: \u6a21\u5757\u7684\u6a21\u578b\uff0c\u4e3aAccount</p>\n</li>\n<li>\n<p><strong>field</strong>: \u6a21\u5757\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u8bbe\u7f6e\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u6307\u5b9areadonly\u7684\u5b57\u6bb5\uff08\u53ea\u8bfb\u7684\u5b57\u6bb5\uff0c\u53ea\u80fd\u88abget\u65b9\u6cd5\u83b7\u53d6\uff0c\u4e0d\u80fd\u88abput/patch\u65b9\u6cd5\u66f4\u6539\uff09\u548cwritable\u5b57\u6bb5\uff08\u53ef\u4ee5\u88ab\u4efb\u610f\u65b9\u6cd5\u64cd\u4f5c\uff09</p>\n</li>\n<li>\n<p><strong>method</strong>: \u6a21\u5757\u7684\u65b9\u6cd5\u8bbe\u7f6e\uff0c\u53c2\u6570\u540d\u4e3aHTTP_METHOD\uff0c\u503c\u4e3a\u6b64\u65b9\u6cd5\u5bf9\u5e94\u7684\u7ec4\u4ef6\u6216\u7ec4\u4ef6\u5217\u8868\uff0c\u5728\u8fd9\u91cc\u4e3a\u91cd\u8981\u7684Auth\u6743\u9650\u7ec4\u4ef6\uff0c\u7528\u4e8e\u6307\u5b9a\u5404\u65b9\u6cd5\u6240\u9700\u7684\u6743\u9650\uff0c\u4ee5\u4e0b\u662f\u8fd9\u4e9b\u53c2\u6570\u7684\u610f\u4e49</p>\n<p>state='login' : \u5fc5\u987b\u4e3a\u767b\u5f55\u72b6\u6001\u624d\u80fd\u8fdb\u884c</p>\n<p>relate='self':  \u8bf7\u6c42\u7684\u8d44\u6e90\u5fc5\u987b\u4e3a\u8bf7\u6c42\u8005\u672c\u8eab\uff0c\uff08\u5373\u53ea\u80fd\u81ea\u5df1\u4fee\u6539\u81ea\u5df1\u7684\u6570\u636e\uff09</p>\n<p>require=Auth.admin \uff1a\u8bf7\u6c42\u8005\u5fc5\u987b\u4e3a\u7ba1\u7406\u5458\u7528\u6237\uff0cadmin\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u9ed8\u8ba4\u8fd4\u56deFalse\uff0c\u53ef\u4ee5\u88ab\u8986\u76d6\u4e3a\u4f60\u7684\u9879\u76ee\u7684\u5224\u65ad\u7ba1\u7406\u5458\u7684\u65b9\u6cd5\uff0c\u5982</p>\n</li>\n</ul>\n<pre><span class=\"n\">Auth</span><span class=\"o\">.</span><span class=\"n\">admin</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"n\">user</span><span class=\"p\">:</span> <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">type</span> <span class=\"o\">==</span> <span class=\"s1\">'admin'</span>\n</pre>\n<p>Auth\u6a21\u5757\u7684\u7528\u6cd5\u8fd8\u6709\u5f88\u591a\uff0c\u5c31\u5148\u4e0d\u5728\u8fd9\u91cc\u5c55\u5f00\u4e86\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u6837\u914d\u7f6e\u6743\u9650\u662f\u5f88\u6e05\u6670\u7b80\u6d01\u7684</p>\n<p>\u53e6\u5916\u6211\u4eec\u770b\u5230\uff0c\u5728Meta\u7c7b\u4e0a\u52a0\u4e86\u88c5\u9970\u5668@mod.proxy\uff0c\u88c5\u9970\u5668\u7236\u7c7b@mod\u662f\u670d\u52a1\u4e8e\u6a21\u5757\u7684\uff0c\u8fd9\u4e2a proxy\u5c06\u8fd9\u4e2a\u6a21\u5757\u53d8\u4e3a<strong>\u4ee3\u7406\u6a21\u5757</strong>\uff0c\u4ee3\u7406\u6a21\u5757\u4e0e\u666e\u901a\u6a21\u5757\u7684\u533a\u522b\u5728\u4e8e\u53ef\u4ee5\u914d\u7f6epost\u548c     delete\u65b9\u6cd5 (\u8fd9\u4e24\u79cd<strong>\u589e/\u5220</strong>\u7684\u65b9\u6cd5\u7684\u5b9e\u73b0\u4e0efield\u4e2d\u7684<strong>\u8bfb/\u5199</strong>\u7684\u5e8f\u5217\u5316\u914d\u7f6e\u65e0\u5173)\uff0c\u5e76\u4e14\uff0c<strong>\u4e00\u4e2a\u6a21\u578b\u53ea\u80fd\u5bf9\u5e94\u4e00\u4e2a\u4ee3\u7406\u6a21\u5757</strong>\uff0cUtilMeta\u8fd9\u6837\u9650\u5236\u7684\u76ee\u7684\u662f\u51cf\u5c11\u8868\u8bb0\u5f55\u7684\u589e\u5220\u6743\u9650\u7684\u6269\u6563</p>\n<p>\u7f16\u5199\u597d\u7684\u6a21\u5757\u53ef\u4ee5\u5bfc\u5165\u5230module/modules.py\u4e2d\uff0c\u65b9\u4fbfAPI\u7684\u5f15\u7528</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">.account.module</span> <span class=\"kn\">import</span> <span class=\"n\">AccountMain</span>\n</pre>\n<h3>5. \u6302\u8f7d\u5230API</h3>\n<p>\u8981\u60f3\u8ba9\u6211\u4eec\u5b9a\u4e49\u7684\u6a21\u5757\u53ef\u4ee5\u88ab\u8bbf\u95ee\uff0c\u9700\u8981\u5c06\u5176<strong>\u6302\u8f7d</strong>\u5230API\u4e0a\uff0c\u6211\u4eec\u6253\u5f00service\u6587\u4ef6\u5939\u4e2d\u7684api.py\uff0c\u9ed8\u8ba4\u6709\u4ee5\u4e0b\u5185\u5bb9</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">utilmeta.utils</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n<span class=\"kn\">from</span> <span class=\"nn\">module.modules</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">RootAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n   <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n       <span class=\"k\">pass</span>\n</pre>\n<p>\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6config/conf.py\u4e2d\uff0c\u6709\u8fd9\u4e48\u4e24\u884c</p>\n<pre><span class=\"n\">root_api</span><span class=\"o\">=</span><span class=\"s1\">'service.api.RootAPI'</span><span class=\"p\">,</span>\n<span class=\"n\">root_name</span><span class=\"o\">=</span><span class=\"s1\">'api'</span>\n</pre>\n<p>\u5c31\u662f\u7528\u6765\u6307\u5b9a<strong>\u6839API</strong>\u7684\uff0c\u4e00\u4e2a\u9879\u76ee\u6240\u6709\u7684API\u548c\u6a21\u5757\u90fd\u4f1a\u6700\u7ec8\u6302\u8f7d\u5230\u6839API\u4e0a\uff0c\u5426\u5219\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u5230\uff0c\u6839API\u9ed8\u8ba4\u89e3\u6790\u5230URL: /api\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7root_name\u6307\u5b9a</p>\n<p>\u6211\u4eec\u6dfb\u52a0\u4e00\u4e2a\u9488\u5bf9\u8d26\u6237\u7684API</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">utilmeta.utils</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n<span class=\"kn\">from</span> <span class=\"nn\">module.modules</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">UserSchema</span><span class=\"p\">(</span><span class=\"n\">Schema</span><span class=\"p\">):</span>\n   <span class=\"n\">username</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">))</span>\n   <span class=\"n\">password</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">reg</span><span class=\"o\">=</span><span class=\"s1\">'[0-9a-zA-Z]{6,20}'</span><span class=\"p\">)</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SignupSchema</span><span class=\"p\">(</span><span class=\"n\">UserSchema</span><span class=\"p\">):</span>\n   <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">),</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">'name'</span><span class=\"p\">)</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">AccountAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n   <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n       <span class=\"n\">module</span> <span class=\"o\">=</span> <span class=\"n\">AccountMain</span>\n\n   <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">post</span>\n   <span class=\"k\">def</span> <span class=\"nf\">signup</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">:</span> <span class=\"n\">SignupSchema</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Body</span><span class=\"p\">):</span>\n       <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">Auth</span><span class=\"o\">.</span><span class=\"n\">register</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"p\">)</span>\n       <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">module</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">user</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">serialize</span><span class=\"p\">()[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n   <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">post</span><span class=\"p\">(</span><span class=\"n\">require</span><span class=\"o\">=</span><span class=\"s1\">'!login'</span><span class=\"p\">)</span>\n   <span class=\"k\">def</span> <span class=\"nf\">login</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">:</span> <span class=\"n\">UserSchema</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Body</span><span class=\"p\">):</span>\n       <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">Auth</span><span class=\"o\">.</span><span class=\"n\">login</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">username</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">password</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"p\">)</span>\n       <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">user</span><span class=\"p\">:</span>\n           <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fail</span><span class=\"p\">(</span><span class=\"s1\">'Username or Password wrong'</span><span class=\"p\">)</span>\n       <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span><span class=\"p\">(</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n\n   <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">put</span><span class=\"p\">(</span><span class=\"n\">require</span><span class=\"o\">=</span><span class=\"s1\">'login'</span><span class=\"p\">)</span>\n   <span class=\"k\">def</span> <span class=\"nf\">logout</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n       <span class=\"n\">Auth</span><span class=\"o\">.</span><span class=\"n\">logout</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"p\">)</span>\n       <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">success</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">RootAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n    <span class=\"n\">account</span> <span class=\"o\">=</span> <span class=\"n\">AccountAPI</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">Response</span><span class=\"p\">(</span>\n            <span class=\"n\">result_key</span><span class=\"o\">=</span><span class=\"s1\">'result'</span><span class=\"p\">,</span>\n            <span class=\"n\">message_key</span><span class=\"o\">=</span><span class=\"s1\">'msg'</span><span class=\"p\">,</span>\n            <span class=\"n\">action_state_key</span><span class=\"o\">=</span><span class=\"s1\">'state'</span>\n        <span class=\"p\">)</span>\n</pre>\n<p>\u8fd9\u4e2aAPI\u867d\u7136\u4ee3\u7801\u4e0d\u591a\uff0c\u4f46\u5df2\u7ecf\u5b8c\u6574\u7684\u5c06\u7528\u6237\u7684\u6ce8\u518c\uff0c\u767b\u5f55\uff0c\u767b\u51fa\u548c\u7528\u6237\u4fe1\u606f\u7684\u67e5\u8be2\uff0c\u4fee\u6539\u5b9e\u73b0\u4e86\n\u6211\u4eec\u53ef\u4ee5\u5148\u770b\u4e00\u4e0b\u6548\u679c\u518d\u89e3\u91ca\u5176\u4e2d\u7684\u539f\u7406</p>\n<h3>6. \u6d4b\u8bd5API</h3>\n<p>\u4ee5\u4e0a\u6211\u4eec\u5df2\u7ecf\u901a\u8fc7\u7f16\u5199Model, Module\u548cAPI\u6210\u529f\u7684\u6784\u5efa\u4e86\u4e00\u4e2a\u9488\u5bf9\u7528\u6237\u6a21\u578b\u7684\u6570\u636e\u63a5\u53e3\u670d\u52a1\uff0c\u6211\u4eec\u5728\u9879\u76ee\u76ee\u5f55\u4f7f\u7528</p>\n<pre>meta serve\n</pre>\n<p>\u542f\u52a8UtilMeta\u670d\u52a1</p>\n<p>\u6211\u4eec\u53ef\u4ee5\u6253\u5f00Postman\u6216\u8005\u4f7f\u7528\u7c7b\u4f3c\u8f6f\u4ef6\u5411 /api/account/signup \u53d1\u9001\u4e00\u4e2aPOST\u8bf7\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528form\u7684\u65b9\u5f0f\u6216\u53d1\u9001json\u6570\u636e</p>\n<img alt=\"image-20200414205953268\">\n<p>\u53ef\u4ee5\u770b\u5230UtilMeta\u521b\u5efa\u4e86\u7528\u6237\u5e76\u5c06\u7528\u6237\u7684\u6570\u636e\u8fdb\u884c\u5e8f\u5217\u5316\u540e\u8fd4\u56de\uff0c\u4f60\u53ef\u4ee5\u8fde\u63a5\u6570\u636e\u5e93\u5e76\u67e5\u770b\u65b0\u521b\u5efa\u7684\u7528\u6237\uff0c\u7528\u6237\u7684\u5bc6\u7801\u5df2\u7ecf\u7ecf\u8fc7PasswordField\u7684\u54c8\u5e0c\u52a0\u5bc6</p>\n<img alt=\"image-20200414210154204\">\n<p>\u6211\u4eec\u53ef\u4ee5\u770b\u4e00\u4e0b\u8fd9\u4e2a\u8bf7\u6c42\u6240\u5bf9\u5e94\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u770b\u5230\u51fd\u6570\u7684\u903b\u8f91\u662f\u5f88\u7b80\u5355\u7684\uff0c\u901a\u8fc7Auth\u7ec4\u4ef6\u6ce8\u518c\u7528\u6237\uff0c\u5e76\u5c06\u8fd4\u56de\u7684\u7528\u6237\u5b9e\u4f8b\u4f20\u5165\u6a21\u5757\u4e2d\u8fdb\u884c\u5e8f\u5217\u5316</p>\n<pre><span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">post</span>\t<span class=\"c1\"># make this function an API for POST</span>\n<span class=\"k\">def</span> <span class=\"nf\">signup</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">:</span> <span class=\"n\">SignupSchema</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Body</span><span class=\"p\">):</span>\n\t\t<span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">Auth</span><span class=\"o\">.</span><span class=\"n\">register</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"p\">)</span>\t\t\t<span class=\"c1\"># create&amp;register user</span>\n\t\t<span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">module</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">user</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">serialize</span><span class=\"p\">()[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\t<span class=\"c1\"># serialize </span>\n</pre>\n<p>\u6211\u4eec\u518d\u6765\u8bd5\u4e00\u4e0b\u7528\u6237\u7684\u767b\u5f55</p>\n<img alt=\"image-20200414212320360\">\n<p>\u7528\u6237\u901a\u8fc7username\u548cpassword\u767b\u5f55\uff0c\u6210\u529f\u540e (state: 1) \u8fd4\u56de\u4e86\u7528\u6237\u7684\u4e3b\u952e (result: 1)</p>\n<p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7account\u63a5\u53e3\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u8fd8\u8bb0\u5f97\u6211\u4eec\u5728\u7528\u6237\u6a21\u5757\u4e2d\u5b9a\u4e49\u4e86get\u65b9\u6cd5\u7684\u6743\u9650\u4e3a\u767b\u5f55Auth(state='login')\uff0c\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u767b\u5f55\u4e86\uff0c\u8bbf\u95ee GET /api/account?id=1</p>\n<img alt=\"image-20200414212736889\">\n<p>\u53ef\u4ee5\u770b\u5230\u5e8f\u5217\u5316\u7684\u6570\u636e\u88ab\u8fd4\u56de\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7528PUT\u65b9\u6cd5\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\u66ff\u6362</p>\n<img alt=\"image-20200414214710623\">\n<p>\u5176\u4e2d\u8bf7\u6c42\u53c2\u6570id=1\u662f\u67e5\u8be2\u53c2\u6570\uff0c\u67e5\u8be2\u5230id=1\u7684\u7528\u6237\uff0c\u5e76\u5c06\u8bf7\u6c42\u4f53\u4e2d\u7684\u6570\u636e\u5199\u5165\u6570\u636e\u5e93\uff0c\u671f\u95f4\u4f1a\u8fdb\u884c\u6570\u636e\u6821\u9a8c\uff0c\u5bf9\u4e0d\u7b26\u5408\u89c4\u8303\u7684\u8bf7\u6c42\u8fd4\u56de400\uff0c\u5bf9\u4e0d\u7b26\u5408\u8bf7\u6c42\u6743\u9650\u7684\u8bf7\u6c42\u8fd4\u56de403\uff0c\u5982\u679c\u67e5\u8be2\u5931\u8d25\u5219\u7ecf\u8fc7\u8fd9\u4e2aPUT\uff0c\u6211\u4eec\u7684\u6570\u636e\u5df2\u7ecf\u53d1\u751f\u6539\u53d8</p>\n<img alt=\"image-20200414214914409\">\n<p>\u8fd8\u53ef\u4ee5\u8fdb\u884c\u767b\u51fa</p>\n<img alt=\"image-20200414235118719\">\n<p>\u767b\u51fa\u4ee5\u540e\uff0c\u7531\u4e8e\u5df2\u7ecf\u4e0d\u5728\u767b\u5f55\u72b6\u6001\uff0c\u5982\u679c\u518d\u6b21\u8bf7\u6c42\u83b7\u53d6\u6570\u636e\u5c06\u4f1a\u5f97\u5230403</p>\n<img alt=\"image-20200414235203101\">\n<p>\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u540c\u6837\u5305\u62ec\u4e86\u6743\u9650\u63a7\u5236</p>\n<h3>7. API\u7684\u5de5\u4f5c\u673a\u5236</h3>\n<p>API\u901a\u8fc7<strong>\u7c7b\u5185\u5b9a\u4e49\u53d8\u91cf\u7684\u65b9\u5f0f</strong>\u8fdb\u884cURL\u5339\u914d\uff0c\u4ece\u914d\u7f6e\u4e2d\u53ef\u77e5RootAPI\u6302\u8f7d\u5230 /api, \u90a3\u4e48\u5728\u5176\u4e2d\u5b9a\u4e49\u53d8\u91cfaccount = AccountAPI \u4f1a\u5c06/api/account \u89e3\u6790\u5230 AccountAPI\u8fd9\u4e2aAPI\u4e0a\uff0c\u4ee5\u6b64\u7c7b\u63a8\u53ef\u4ee5\u8fdb\u884c\u6811\u72b6\u7684\u89e3\u6790\uff0c\u5728API\u5185\u90e8\uff0c \u6709\u51e0\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5c06\u7ec4\u4ef6<strong>\u6302\u8f7d\u5230URL</strong>\u4e0a\uff0c\u8fd9\u4e9b\u89c4\u5219\u975e\u5e38\u91cd\u8981</p>\n<ol>\n<li>\n<p>\u4ee5\u5b9a\u4e49\u53d8\u91cf\u7684\u5f62\u5f0f\u6302\u8f7dAPI\uff0c\u5df2\u7ecf\u4ecb\u7ecd</p>\n</li>\n<li>\n<p>\u4ee5\u5b9a\u4e49\u53d8\u91cf\u7684\u5f62\u5f0f\u6302\u8f7dModule, \u4e0e\u6302\u8f7dAPI\u7c7b\u4f3c\uff0c\u5982\u679c\u65b0\u5f00\u53d1\u4e00\u4e2aAccountProfile\u6a21\u5757\uff0c\u5e76\u5728AccountAPI\u4e2d\u5b9a\u4e49 profile = AccountProfile, \u5c31\u4f1a\u4f7f /api/account/profile\u89e3\u6790\u5230\u8be5\u6a21\u5757</p>\n</li>\n<li>\n<p>\u5728API\u7c7b\u7684Meta\u7c7b\u4e2d\u7528module\u53d8\u91cf\u5b9a\u4e49<strong>\u6838\u5fc3\u6a21\u5757</strong>\uff0c\u6838\u5fc3\u6a21\u5757\u7684\u65b9\u6cd5\uff08\u5b9a\u4e49\u5728AccountMain\u7684Method\u4e2d\u7684GET/PUT/DELETE\u65b9\u6cd5\uff09\u5c06\u4f1a\u4f5c\u7528\u5230AccountAPI\u7684URL /api/account\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bf7\u6c42</p>\n</li>\n</ol>\n<pre><span class=\"err\">GET</span> <span class=\"err\">/api/account?id=</span><span class=\"mi\">1</span>\n</pre>\n<p>\u5c06\u4f1a\u843d\u5728AccountMain\u7684get\u65b9\u6cd5\u4e0a\uff0c\u6839\u636e\u5176field\u7684\u914d\u7f6e\u8fd4\u56de\u5bf9\u5e94\u5b57\u6bb5\u548c\u503c\u7684json\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u4f1a\u7531Module\u4ee3\u4e3a\u5b8c\u6210</p>\n<ol>\n<li>\n<p>\u5728API\u4e2d\u5b9a\u4e49\u51fd\u6570\uff0c\u4e0edjango\u7684\u7c7b\u89c6\u56fe\u7684\u89c4\u5219\u7c7b\u4f3c\uff0c\u4ee5\u5c0f\u5199HTTP_METHOD\u547d\u540d\u7684\u51fd\u6570get/put/post/patch/delete\u4f1a\u4f5c\u7528\u5230API\u5bf9\u5e94\u7684URL\u4e0a\uff0c\u5982\u679cAPI\u4e2d\u7684\u6838\u5fc3\u6a21\u5757\u5df2\u7ecf\u5b9a\u4e49\u4e86\u8be5\u65b9\u6cd5\uff0cAPI\u7684\u4e2d\u7684\u51fd\u6570\u4f1a\u5c06\u5176<strong>\u8986\u76d6</strong></p>\n</li>\n<li>\n<p>\u540c\u6837\u5728API\u4e2d\u5b9a\u4e49\u5e76\u975e\u4ee5HTTP_METHOD\u547d\u540d\u7684\u51fd\u6570\uff0c\u9700\u8981\u7528@api\u7c7b\u4e0b\u7684\u88c5\u9970\u5668\uff0c\u4ece\u4e0a\u9762\u7684\u4f8b\u5b50\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c@api\u4e0b\u4e5f\u6709\u4ee5HTTP_METHOD\u547d\u540d\u7684\u88c5\u9970\u5668\uff0c\u628a\u5b83\u52a0\u5728\u51fd\u6570\u4e0a\u6807\u8bb0\u4e86\u8fd9\u4e2a\u51fd\u6570\u4ee5\u4f55\u79cdHTTP\u65b9\u6cd5\u8bbf\u95ee\uff0c\u5f3a\u5236\u7684\u89c4\u5219\u662f<strong>\u4e00\u4e2a\u51fd\u6570\u53ea\u652f\u6301\u4e00\u79cdHTTP\u65b9\u6cd5</strong> (\u652f\u6301\u591a\u65b9\u6cd5\u7684URL\u53ef\u4ee5\u7528API\u6216Module)\uff0c\u6302\u8f7d\u4e5f\u662f\u4ee5\u51fd\u6570\u547d\u540d\u7684\u65b9\u5f0f\uff0c\u5982\u4e0a\u9762\u4f8b\u5b50\u7684 signup \u51fd\u6570\uff0c\u5176\u4e0a\u6709@api.post\u88c5\u9970\u5668\uff0c\u5c31\u5b9a\u4e49\u4e86</p>\n</li>\n</ol>\n<pre><span class=\"err\">POST</span> <span class=\"err\">/api/account/signup</span>\n</pre>\n<p>\u8fd9\u4e2aAPI\uff0c\u5e76\u4e14\u53ea\u80fd\u4f7f\u7528POST\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u8fd4\u56de405 \uff08http_method_not_allowed\uff09</p>\n<h2>Utils</h2>\n<p>\u6709\u4e86\u4e4b\u524dQuick Start\u7684\u4ecb\u7ecd\uff0c\u76f8\u4fe1\u4f60\u5bf9UtilMeta\u5df2\u7ecf\u57fa\u672c\u4e0a\u624b\u4e86\uff0c\u63a5\u4e0b\u6765\u4f1a\u8be6\u7ec6\u7684\u4ecb\u7ecdUtilMeta\u4e2d\u7684\u5404\u4e2a\u7ec4\u4ef6</p>\n<h3>1. \u6a21\u5757\u7cfb\u7edf Module System</h3>\n<p>\u6a21\u5757\u7cfb\u7edf\u662fUtilMeta\u7684\u6570\u636e\u6838\u5fc3\uff0c\u5728\u5404\u4e2a\u7ec4\u4ef6\u914d\u7f6e\u5f97\u5f53\u65f6\u5b83\u53ef\u4ee5\u81ea\u52a8\u5b8c\u6210\u6570\u636e\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u5904\u7406\uff0c\u6743\u9650\u5904\u7406\u548c\u67e5\u8be2\u5904\u7406\uff0c\u5e76\u4e14\u5141\u8bb8\u524d\u7aef\u8bf7\u6c42\u5b9a\u5236\u6570\u636e</p>\n<p>\u4e00\u4e2a\u6a21\u5757\u57fa\u672c\u7684\u683c\u5f0f\u5982\u4e0b</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">AccountMain</span><span class=\"p\">(</span><span class=\"n\">Module</span><span class=\"p\">):</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Account</span>\n        <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">)</span>\n        <span class=\"n\">method</span> <span class=\"o\">=</span> <span class=\"n\">Method</span><span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">)</span>\n</pre>\n<h4>1.1 Field \u7ec4\u4ef6</h4>\n<p>Field\u7ec4\u4ef6\u5728\u6a21\u5757\u7cfb\u7edf\u4e2d\u8d1f\u8d23\u6570\u636e\u7684\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u6709\u4ee5\u4e0b\u53c2\u6570</p>\n<ul>\n<li><strong>readonly</strong>: \u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u4e3a\u6a21\u5757\u4e2d<strong>\u53ea\u8bfb</strong>\u5b57\u6bb5\u7684\u5217\u8868/\u5143\u7ec4\uff0c\u5176\u4e2d\u7684\u5b57\u6bb5\u53ea\u4f1a\u88abget\u65b9\u6cd5\u83b7\u53d6\uff0c\u65e0\u6cd5\u88abput/patch\u65b9\u6cd5\u4fee\u6539\uff08\u5982\u4e3b\u952e\uff0c\u4e00\u4e9b\u56fa\u5b9a\u65e5\u671f\uff0c\u7cfb\u7edf\u53d8\u91cf\u7b49\uff09\uff0c\u5982\u679c\u5e0c\u671b\u5e8f\u5217\u5316\u5168\u90e8\u5b57\u6bb5\u5e76\u5168\u90e8\u4e3a\u53ea\u8bfb\u6743\u9650\uff0c\u53ef\u4ee5\u4f20\u5165</li>\n</ul>\n<pre><span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">readonly</span><span class=\"o\">=</span><span class=\"s1\">'__all__'</span><span class=\"p\">)</span>\n</pre>\n<ul>\n<li><strong>writable</strong>: \u6a21\u5757\u4e2d<strong>\u53ef\u5199</strong>\u5b57\u6bb5\u7684\u5217\u8868/\u5143\u7ec4\uff0c\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528 \u2018__all__' , \u53ef\u5199\u7684\u5b57\u6bb5\u76f8\u5f53\u4e8e\u540c\u65f6\u5177\u6709\u8bfb\u548c\u5199\u6743\u9650\uff0c\u53ef\u4ee5\u88abput/patch\u65b9\u6cd5\u8fdb\u884c\u66f4\u6539\u4e5f\u53ef\u4ee5\u88abget\u65b9\u6cd5\u83b7\u53d6\uff0c\u5982\u5728QuickStart\u4e2d\u7684\u4f8b\u5b50</li>\n</ul>\n<pre><span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n\t\t<span class=\"n\">readonly</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'username'</span><span class=\"p\">,</span> <span class=\"s1\">'register_date'</span><span class=\"p\">)</span><span class=\"err\">\uff0c</span>\n\t\t<span class=\"n\">writable</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'name'</span><span class=\"p\">,</span> <span class=\"s1\">'intro'</span><span class=\"p\">,</span> <span class=\"s1\">'avatar'</span><span class=\"p\">)</span>\n<span class=\"p\">)</span>\n</pre>\n<p>\u6240\u6709\u5b9a\u4e49\u5728readonly\u548cwritable\u4e2d\u7684\u5b57\u6bb5<strong>\u90fd\u53ef\u4ee5</strong>\u88abget\u5e8f\u5217\u5316\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u6839\u636e\u5b57\u6bb5\u662f\u5426\u53ef\u4ee5\u4fee\u6539\u5206\u6210\u8fd9\u4e24\u7c7b\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u4e0d\u5b58\u5728\u53ea\u80fd\u5199\u4e0d\u80fd\u8bfb\u7684\u5b57\u6bb5</p>\n<ul>\n<li>\n<p><strong>excludes</strong>: \u5f53\u53ea\u8bfb\u6216\u53ef\u5199\u5b57\u6bb5\u4e3a__all__\u65f6\u7528\u6765<strong>\u6392\u9664</strong>\u4e00\u90e8\u5206\u5b57\u6bb5\u7684\u5217\u8868\uff0c\u4e00\u4e2a\u5e38\u89c1\u60c5\u51b5\u662f\u9700\u8981\u5e8f\u5217\u5316\u5168\u90e8\u5b57\u6bb5\uff0c\u9664\u4e86\u4e2a\u522b\u5b57\u6bb5\uff08\u5982\u79c1\u5bc6\u6027\u6570\u636e\uff09\uff0c\u8fd9\u65f6\u7528excludes\u5217\u8868\u6765\u6392\u9664\u5b83\u4eec\u6bd4\u8f83\u65b9\u4fbf</p>\n</li>\n<li>\n<p><strong>filter</strong>: \u6a21\u5757\u7684\u67e5\u8be2\u914d\u7f6e\uff0c\u652f\u6301\u524d\u7aef\u6839\u636e\u53c2\u6570\u8fdb\u884c\u7cbe\u786e/\u6a21\u7cca/\u6b63\u5219/\u8303\u56f4\u67e5\u8be2\uff0c\u4e0eid\u7684\u8bf7\u6c42\u65b9\u5f0f\u7684\u533a\u522b\u5728\u4e8e\uff0c\u65e0\u8bba\u67e5\u8be2\u4e3a\u7a7a\uff0c\u6709\u4e00\u4e2a\u8fd8\u662f\u591a\u4e2a\u7ed3\u679c\uff0c<strong>\u90fd\u4f1a\u8fd4\u56de JSON\u5217\u8868 \uff08\u5305\u62ec\u7a7a\u5217\u8868\uff09</strong>, filter\u53c2\u6570\u63a5\u53d7\u4e00\u4e2a\u5b57\u5178\uff0c\u5b57\u5178\u7684\u952e\u4e3a\u9700\u8981\u67e5\u8be2\u7684\u5b57\u6bb5\uff0c\u503c\u4e3a<strong>Filter\u7ec4\u4ef6</strong>\u7684\u5b9e\u4f8b</p>\n</li>\n</ul>\n<pre><span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n    <span class=\"nb\">filter</span><span class=\"o\">=</span><span class=\"p\">{</span>\n    \t<span class=\"s1\">'name'</span><span class=\"p\">:</span><span class=\"n\">Filter</span><span class=\"p\">(</span><span class=\"s1\">'%'</span><span class=\"p\">,</span> <span class=\"s1\">'~'</span><span class=\"p\">)</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">)</span>\n</pre>\n<p>\u4ee5\u4e0a\u4f8b\u5b50\u7684\u914d\u7f6e\u53ef\u4ee5\u5b9e\u73b0\u4ee5\u4e0b\u7684\u67e5\u8be2API</p>\n<pre><span class=\"err\">GET</span> <span class=\"err\">/api/account?name%=meta</span>\n</pre>\n<p>\u5c06\u4f1a\u8fd4\u56de\u6240\u6709name\u5b57\u6bb5<strong>\u5305\u542b</strong>'meta'\u5b57\u7b26\u4e32\u7684\u8bb0\u5f55\u7684\u5e8f\u5217\u5316JSON\u5217\u8868\uff0c\u5176\u4e2d\u81ea\u52a8\u5316\u67e5\u8be2\u4f9d\u8d56\u7684\u5c31\u662fFilter\u7ec4\u4ef6</p>\n<pre><code>##### 1.1.1 Filter \u7ec4\u4ef6\n</code></pre>\n<p>Filter\u7ec4\u4ef6\u662fUtilMeta\u4e2d\u8d1f\u8d23\u5b57\u6bb5\u67e5\u8be2\u7684\u7ec4\u4ef6\uff0c\u5bf9\u5e94\u62bd\u8c61django\u7684QuerySet\u67e5\u8be2API\uff0c\u53ef\u4ee5\u5c06\u524d\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\u89e3\u6790\u4e3a filter lookups\u5e76\u81ea\u52a8\u5b8c\u6210\u67e5\u8be2\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5373\u5141\u8bb8\u7684\u67e5\u8be2\u7c7b\u578b\uff0c\u57fa\u672c\u67e5\u8be2\u7c7b\u578b\u53ca\u5176\u5bf9\u5e94\u7684lookup\u5982\u4e0b</p>\n<pre><span class=\"p\">{</span>\n\t\t<span class=\"s1\">''</span><span class=\"p\">:</span> <span class=\"s1\">'exact'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'='</span><span class=\"p\">:</span> <span class=\"s1\">'exact'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'~='</span><span class=\"p\">:</span> <span class=\"s1\">'iexact'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'=%'</span><span class=\"p\">:</span> <span class=\"s1\">'startwith'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'~%'</span><span class=\"p\">:</span> <span class=\"s1\">'istartwith'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'%='</span><span class=\"p\">:</span> <span class=\"s1\">'endwith'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'%~'</span><span class=\"p\">:</span> <span class=\"s1\">'iendwith'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'%'</span><span class=\"p\">:</span> <span class=\"s1\">'contains'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'~'</span><span class=\"p\">:</span> <span class=\"s1\">'icontains'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'&gt;'</span><span class=\"p\">:</span> <span class=\"s1\">'gt'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'&lt;'</span><span class=\"p\">:</span> <span class=\"s1\">'lt'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'&gt;='</span><span class=\"p\">:</span> <span class=\"s1\">'gte'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'&lt;='</span><span class=\"p\">:</span> <span class=\"s1\">'lte'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'$'</span><span class=\"p\">:</span> <span class=\"s1\">'regex'</span><span class=\"p\">,</span>\n\t\t<span class=\"s1\">'~$'</span><span class=\"p\">:</span> <span class=\"s1\">'iregex'</span>\n<span class=\"p\">}</span>\n</pre>\n<p>\u6709\u51e0\u4e2a\u7279\u6b8a\u7684\u7b26\u53f7\u53ef\u4ee5\u4e0e\u4ee5\u4e0a\u7684\u90e8\u5206\u7b26\u53f7\u8fdb\u884c\u7ec4\u5408:</p>\n<ol>\n<li>\n<p>! : \u53ef\u4ee5\u7528\u5728\u6240\u6709\u67e5\u8be2\u7b26\uff08\u9664\u4e86&lt;, &gt;, &lt;=, &gt;=\uff0c\u56e0\u4e3a\u53ef\u4ee5\u7b49\u6548\uff09<strong>\u524d</strong>\uff0c\u8868\u793a\u6c42\u8fd9\u4e2a\u67e5\u8be2\u6761\u4ef6\u7684\u8865\u96c6\uff08exclude\uff09\uff0c\u614e\u7528 ! ,\u4e0d\u6070\u5f53\u7684\u67e5\u8be2\u6761\u4ef6\u53ef\u80fd\u4f1a\u8f93\u51fa\u6240\u6709\u7684\u8868\u7ed3\u679c</p>\n</li>\n<li>\n<p>^ : \u53ef\u4ee5\u7528\u5728\u6240\u6709\u67e5\u8be2\u7b26\uff08\u9664\u4e86&lt;, &gt;, &lt;=, &gt;=\uff0c\u56e0\u4e3a\u6ca1\u6709\u610f\u4e49\uff09<strong>\u540e</strong>\uff0c\u8868\u793a\u5141\u8bb8\u5217\u8868\u503c\u7684\u67e5\u8be2\uff0c\u6bd4\u5982</p>\n</li>\n</ol>\n<pre><span class=\"p\">{</span>\n\t <span class=\"s1\">'id^'</span><span class=\"p\">:[</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</pre>\n<p>\u5c06\u4f1a\u8fd4\u56deid\u4e3a2/3/4\u7684\u4e09\u6761\u8bb0\u5f55\uff0c\u76f8\u5f53\u4e8e\u52a0\u4e86\u4e00\u4e2a__in\u7684lookup\uff0c\u4e4b\u6240\u4ee5\u5217\u8868\u503c\u67e5\u8be2\u6ca1\u6709\u8bbe\u8ba1\u6210\u6839\u636e\u8bf7\u6c42\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u533a\u5206\u662f\u56e0\u4e3a\u8fd8\u5b58\u5728\u7c7b\u4f3cArrayField\u8fd9\u79cd\u5217\u8868\u7c7b\u578b\u5b57\u6bb5\uff0c\u5355\u4e2a\u503c\u5217\u8868\u503c\u5206\u5f00\u7b26\u53f7\u67e5\u8be2\u4e5f\u65b9\u4fbf\u4e8e\u8bf7\u6c42\u7684\u89e3\u6790\uff0c\u56e0\u4e3aGET\u8bf7\u6c42\u4f20\u6765\u7684\u6570\u636e\u4ee5QueryDict\u5f62\u5f0f\uff0c\u6bcf\u4e2a\u5b57\u6bb5\u90fd\u5bf9\u5e94\u4e00\u4e2a\u503c\u5217\u8868\uff0c\u5982\u679c\u4e0d\u660e\u786e\u8bf7\u6c42\u8bed\u4e49\uff0c\u5f88\u5bb9\u6613\u9020\u6210\u89e3\u6790\u6df7\u6dc6</p>\n<p>Filter\u7ec4\u4ef6\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u53ef\u8fb9\u957f\u53c2\u6570 *options, \u63a5\u53d7\u591a\u4e2a\u4ee5\u4e0a\u7684\u67e5\u8be2\u7b26\u6216\u67e5\u8be2\u7b26\u7ec4\u5408\uff0c\u4f8b\u5982</p>\n<pre><span class=\"s1\">'name'</span><span class=\"p\">:</span> <span class=\"n\">Filter</span><span class=\"p\">(</span><span class=\"s1\">'%='</span><span class=\"p\">,</span> <span class=\"s1\">'!~'</span><span class=\"p\">,</span> <span class=\"s1\">'^'</span><span class=\"p\">)</span>\n</pre>\n<p>\u5f53\u6211\u4eec\u660e\u786e\u4e86\u8fd9\u4e9b\u7b26\u53f7\u6240\u4ee3\u8868\u7684\u67e5\u8be2\u610f\u4e49\uff0c\u63a5\u4e0b\u6765\u53c2\u6570\u7684\u610f\u4e49\u5728\u4e8e\u628a\u67e5\u8be2\u7b26\u548c\u67e5\u8be2\u65b9\u6cd5\u5339\u914d\uff0c\u8bd5\u60f3\u6211\u4eec\u53ef\u80fd\u5e0c\u671b\u6a21\u7cca\u67e5\u8be2\u6216\u53cd\u5411\u67e5\u8be2\u5e94\u7528\u4e8eGET\u8bf7\u6c42\uff0c\u4f46\u4f30\u8ba1\u4e0d\u4f1a\u5e0c\u671b\u5e94\u7528\u4e8eDELETE\u8bf7\u6c42\uff0c\u5426\u5219\u4f8b\u5982</p>\n<pre><span class=\"err\">DELETE</span> <span class=\"err\">/api/account?name%=</span>\n</pre>\n<p>\u8fd9\u6837\u7684\u7a7a\u503c\u67e5\u8be2\u5728\u6743\u9650\u914d\u7f6e\u4e0d\u5f53\u7684\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5168\u90e8\u7528\u6237\u7684\u5220\u9664\uff0c\u6240\u4ee5\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u5371\u9669\u60c5\u51b5\u7684\u53d1\u751f\uff0cfilter\u652f\u6301\u4e3a\u4e0d\u540c\u7684\u65b9\u6cd5\u914d\u7f6e\u4e0d\u540c\u7684\u67e5\u8be2\u7b26</p>\n<ul>\n<li><strong>methods</strong>: \u9ed8\u8ba4\u4e3a ('get',) \u5373\u6240\u6709\u67e5\u8be2\u53ea\u652f\u6301GET\u8bf7\u6c42\uff0c\u53ef\u4ee5\u6269\u5145\uff0c\u5176\u4e2d\u6bcf\u4e2a\u65b9\u6cd5\u5bf9\u5e94\u7684\u67e5\u8be2\u7b26\u90fd\u662f\u4ee5\u4e0a\u7684options</li>\n<li><strong>get/put/patch/delete</strong>: \u8fd9\u56db\u4e2a\u53c2\u6570\u53ef\u4ee5\u5206\u522b\u6307\u5b9a\u6bcf\u4e2a\u65b9\u6cd5\u5bf9\u5e94\u7684\u67e5\u8be2\u7b26\u5217\u8868</li>\n</ul>\n<p>\u8fd8\u6709\u53c2\u6570\u662f\u4e3a\u4e86\u9632\u6b62\u5371\u9669\u7684\u67e5\u8be2\u60c5\u51b5\u7684</p>\n<ul>\n<li>\n<p><strong>one</strong>: \u9ed8\u8ba4\u4e3afalse\uff0c \u5373\u8fd4\u56de\u7ed3\u679c\u4e3a\u5217\u8868\u503c\uff0c\u82e5\u67e5\u8be2\u4e3a\u7a7a\u5219\u8fd4\u56de\u7a7a\u5217\u8868\uff0cone=True\u65f6\u5f53\u4f7f\u7528\u8fd9\u4e2a\u5b57\u6bb5\u4f5c\u7b49\u503c\u67e5\u8be2\u65f6\u82e5\u67e5\u8be2\u6210\u529f\u5219\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\uff08json\u5bf9\u8c61\uff09\uff0c\u82e5\u67e5\u8be2\u5931\u8d25\u5219\u8fd4\u56de404\uff0c\u800c\u4e14\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b57\u6bb5\u9700\u8981\u6ee1\u8db3\u662f<strong>unique</strong>\u7684</p>\n</li>\n<li>\n<p><strong>empty_allowed</strong>: \u662f\u5426\u5141\u8bb8\u7a7a\u503c\u67e5\u8be2\uff0c\u9ed8\u8ba4\u4e3aFalse\uff0c\u7a7a\u503c\u67e5\u8be2\u4f1a\u62a5400</p>\n</li>\n</ul>\n<p>Filter\u7ec4\u4ef6\u4e5f\u652f\u6301\u5bf9\u5173\u7cfb\u8868\u7684\u5b57\u6bb5\u8fdb\u884c\u67e5\u8be2\uff0c\u5e76\u6709\u53c2\u6570</p>\n<ul>\n<li><strong>relate_field</strong>: \u9ed8\u8ba4\u4e3aid\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u5176\u4ed6\u7684\u5173\u7cfb\u8868\u7684\u5b57\u6bb5\uff0c\u4f8b\u5982\u4e00\u4e2a\u4f5c\u54c1\u6a21\u5757\u9700\u8981\u6839   \u636e\u4f5c\u8005\u540d\u5b57\u8fdb\u884c\u6a21\u7cca\u67e5\u8be2\uff0c\u5219\u5982\u6b64\u914d\u7f6e</li>\n</ul>\n<pre>\t<span class=\"s1\">'creator'</span><span class=\"p\">:</span> <span class=\"n\">Filter</span><span class=\"p\">(</span><span class=\"s1\">'~'</span><span class=\"p\">,</span> <span class=\"n\">relate_field</span><span class=\"o\">=</span><span class=\"s1\">'name'</span><span class=\"p\">)</span>\n</pre>\n<p>\u90a3\u4e48\u751f\u6210\u7684\u67e5\u8be2API</p>\n<pre>\t<span class=\"err\">GET</span> <span class=\"err\">/api/work?creator~='zxl'</span>\n</pre>\n<p>\u5219\u4f1a\u67e5\u8be2\u8fd4\u56de\u6240\u6709\u4f5c\u8005\u540d\u5b57\u5ffd\u7565\u5927\u5c0f\u5199\u5730\u542b\u6709\u2019zxl'\u7684\u4f5c\u54c1</p>\n<p>\u53ef\u4ee5\u770b\u51fa\uff0c\u901a\u8fc7Filter\u5b57\u6bb5\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u751f\u6210\u591a\u6837\u5316\u7684\u5b57\u6bb5\u67e5\u8be2API\uff0c\u800c\u4e14\u53ef\u4ee5\u65b9\u4fbf\u7684\u638c\u63e1\u5404\u65b9\u6cd5\u7684\u67e5\u8be2\u6743\u9650\uff0c\u907f\u514d\u5371\u9669\u67e5\u8be2</p>\n<ul>\n<li><strong>order</strong>: \u5e8f\u5217\u5316\u7684\u6392\u5e8f\u914d\u7f6e\uff0c\u4e0eQuerySet\u7684order_by\u63a5\u53d7\u7684\u53c2\u6570\u4e00\u81f4\uff0c\u4e00\u4e2a\u5b57\u6bb5\u5217\u8868/\u5143\u7ec4</li>\n</ul>\n<pre><span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">order</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'-register_date'</span><span class=\"p\">,</span> <span class=\"s1\">'id'</span><span class=\"p\">))</span>\n</pre>\n<p>\u8fd9\u6837\u8bbe\u7f6e\u4f1a\u4f7f\u5e8f\u5217\u5316\u7684\u7ed3\u679c\u6309\u7167  (\u6ce8\u518c\u65e5\u671f\u7684\u5012\u5e8f\uff0c\u4e3b\u952e\u7684\u6b63\u5e8f) \u8fd9\u6837\u7684\u4f18\u5148\u7ea7\u6392\u5e8f</p>\n<ul>\n<li><strong>relate</strong>: \u5173\u8054\u8868\u7684\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u914d\u7f6e\uff0c\u53ef\u4ee5\u5c06\u5916\u952e\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3aJSON\u5bf9\u8c61\uff0c\u5c06\u591a\u5bf9\u591a\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3aJSON\u5217\u8868 (\u6216\u503c\u5217\u8868)\uff0c\u4e0efilter\u53c2\u6570\u7c7b\u4f3c\uff0crelate\u53c2\u6570\u63a5\u53d7\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2d\u952e\u4e3a\u5173\u7cfb\u5b57\u6bb5\u5b57\u7b26\u4e32\uff08\u8fd9\u91cc\u7684<strong>\u5173\u7cfb</strong>\u53ef\u4ee5\u6307\u4e00\u5bf9\u4e00\uff0c\u5916\u952e\uff0c\u591a\u5bf9\u591a\u4ee5\u53ca\u5b83\u4eec\u7684\u53cd\u5411\u5f15\u7528related_name\uff09, \u5176\u4e2d\u7684\u503c\u4e3a<strong>Relate\u7ec4\u4ef6</strong>\u7684\u5b9e\u4f8b</li>\n</ul>\n<pre><span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n\t\t<span class=\"n\">readonly</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'id'</span><span class=\"p\">,</span> <span class=\"s1\">'title'</span><span class=\"p\">],</span>\n\t\t<span class=\"n\">relate</span><span class=\"o\">=</span><span class=\"p\">{</span>\n\t\t\t\t<span class=\"s1\">'creator'</span><span class=\"p\">:</span> <span class=\"n\">Relate</span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'id'</span><span class=\"p\">,</span> <span class=\"s1\">'name'</span><span class=\"p\">,</span> <span class=\"s1\">'avatar'</span><span class=\"p\">]),</span>\n\t\t\t\t<span class=\"s1\">'tags'</span><span class=\"p\">:</span> <span class=\"n\">Relate</span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"o\">=</span><span class=\"s1\">'id'</span><span class=\"p\">,</span> <span class=\"n\">modify</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\t\t<span class=\"p\">}</span>\n<span class=\"p\">)</span>\n</pre>\n<p>Work\u6a21\u578b\u6709\u4e00\u4e2a\u6307\u5411\u7528\u6237\u7684creator\u5916\u952e\u548c\u591a\u5bf9\u591a\u5b57\u6bb5tags\uff0c\u5982\u6b64\u914d\u7f6erelate\u5c06\u4f1a\u4f5c\u7528\u4e8e\u5e8f\u5217\u5316\u7684\u7ed3\u679c</p>\n<pre><span class=\"err\">GET</span> <span class=\"err\">/api/work?id=</span><span class=\"mi\">3</span>\n<span class=\"err\">&lt;response&gt;:</span>\n<span class=\"p\">{</span>\n\t<span class=\"err\">'id':</span> <span class=\"err\">3,</span>\n\t<span class=\"err\">'title':</span> <span class=\"err\">'utilmeta',</span>\n\t<span class=\"err\">'creator':</span> <span class=\"err\">{</span>\n\t\t\t\t<span class=\"err\">'id':</span> <span class=\"err\">1,</span>\n\t\t\t\t<span class=\"err\">'name':</span> <span class=\"err\">'zxl',</span>\n\t\t\t\t<span class=\"err\">'avatar':</span> <span class=\"err\">'/avatar/y21df4hsa.jpg'</span>\n\t\t<span class=\"p\">}</span><span class=\"err\">,</span>\n\t<span class=\"err\">'tags':</span> <span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">11</span><span class=\"p\">]</span>\n<span class=\"err\">}</span>\n</pre>\n<p>\u53ef\u4ee5\u770b\u5230\u5173\u7cfb\u5b57\u6bb5\u4e5f\u51fa\u73b0\u5728\u4e86\u5e8f\u5217\u5316\u7ed3\u679c\u4e2d\uff0c\u5e76\u4e14\u6309\u7167\u914d\u7f6e\u7684\u5b57\u6bb5\u8fdb\u884c\u8fd4\u56de\uff0c\u5176\u4e2d\u4f9d\u8d56\u7684\u5c31\u662fRelate\u7ec4\u4ef6</p>\n<h5>1.1.2 Relate \u7ec4\u4ef6</h5>\n<p>pass</p>\n<ul>\n<li><strong>annotate</strong>: Field\u4e2d\u7684annotate\u53c2\u6570\u5141\u8bb8\u81ea\u5b9a\u4e49\u65b0\u7684\u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u540d\u79f0\u548c\u8fd4\u56de\u503c\uff0c\u4e0d\u53d7\u6a21\u5757\u7684\u6a21\u578b\u5b57\u6bb5\u7684\u9650\u5236\uff0cproxy\u53c2\u6570\u540c\u6837\u63a5\u53d7\u4e00\u4e2a\u5b57\u5178\uff0c\u5b83\u7684\u952e\u662f\u81ea\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\uff0c\u4f1a\u88ab\u63d2\u5165\u5e8f\u5217\u5316\u7ed3\u679c\u4e2d\uff0c\u503c\u6709\u56db\u79cd\u9009\u62e9</li>\n</ul>\n<pre><span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n\t\t<span class=\"n\">readonly</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'username'</span><span class=\"p\">,</span> <span class=\"s1\">'register_date'</span><span class=\"p\">],</span>\n\t\t<span class=\"n\">annotate</span><span class=\"o\">=</span><span class=\"p\">{</span>\n\t\t\t\t<span class=\"s1\">'api_version'</span><span class=\"p\">:</span> <span class=\"s1\">'v1.2'</span><span class=\"p\">,</span>\n\t\t\t\t<span class=\"s1\">'work_num'</span><span class=\"p\">:</span> <span class=\"n\">exp</span><span class=\"o\">.</span><span class=\"n\">Count</span><span class=\"p\">(</span><span class=\"s1\">'works'</span><span class=\"p\">),</span>\n\t\t\t\t<span class=\"s1\">'is_self'</span><span class=\"p\">:</span> <span class=\"k\">lambda</span> <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">:</span> <span class=\"bp\">self</span> <span class=\"o\">==</span> <span class=\"n\">user</span><span class=\"p\">,</span>\n\t\t\t\t<span class=\"s1\">'register_date'</span><span class=\"p\">:</span> <span class=\"k\">lambda</span> <span class=\"n\">val</span><span class=\"p\">:</span><span class=\"n\">val</span><span class=\"o\">.</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s1\">'%Y\u5e74%m\u6708</span><span class=\"si\">%d</span><span class=\"s1\">\u65e5'</span><span class=\"p\">)</span>\n\t\t<span class=\"p\">}</span>\n<span class=\"p\">)</span>\n</pre>\n<ol>\n<li>\n<p><strong>\u5e38\u91cf</strong>\uff1a\u4e00\u4e2a<strong>\u53ef\u4ee5\u88abJSON\u5e8f\u5217\u5316</strong>\u7684\u5e38\u91cf\uff0c\u4f1a\u76f4\u63a5\u63d2\u5165\u5230\u7ed3\u679c\u4e2d</p>\n</li>\n<li>\n<p><strong>\u8868\u8fbe\u5f0f</strong>\uff1a\u4e00\u4e2adjango <strong>Expression</strong>, \u8fd9\u4e9b\u8868\u8fbe\u5f0f\u88abUtilMeta\u7684utils\u4e2d\u7684proxy\u8fdb\u884c\u6574\u7406\uff0c\u4ee5\u53ca\u5bfc\u5165\u5230\u4e86\u5f53\u524d\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\uff0c\u7528\u4ed6\u4eec\u53ef\u4ee5\u5b8c\u6210\u4e00\u4e9b\u7684<strong>\u8ba1\u6570\uff0c\u8fd0\u7b97</strong>\u7b49\u5904\u7406</p>\n</li>\n<li>\n<p><strong>\u4ee3\u7406\u51fd\u6570</strong>\uff1a\u4e00\u4e2a<strong>callable</strong> (\u51fd\u6570\uff0clambda\u8868\u8fbe\u5f0f\u6216\u542b\u6709__call__\u7684\u7c7b)\uff0c\u8fd9\u4e2a\u51fd\u6570\u9700\u8981\u4e09\u4e2a\u53ef\u9009\u7684\u53c2\u6570</p>\n<ul>\n<li>self: \u5bf9\u4e8e\u67e5\u8be2QuerySet\u4e2d\u7684\u6bcf\u4e2a<strong>\u5b9e\u4f8b</strong>\u90fd\u4f1a\u4f5c\u4e3aself\u53c2\u6570\u4f20\u9012\u5230\u8fd9\u4e2a\u51fd\u6570\u4e2d</li>\n<li>user: \u672c\u6b21\u8bf7\u6c42\u7684<strong>\u7528\u6237</strong>\u5bf9\u8c61</li>\n<li>data: \u8bf7\u6c42<strong>\u6570\u636e</strong>\u7684\u5b57\u5178</li>\n</ul>\n<p>\u4ee3\u7406\u51fd\u6570\u7684\u53c2\u6570\u9700\u8981\u662f\u4e0a\u8ff0\u4e09\u4e2a\u53c2\u6570\u7684\u5b50\u96c6\uff0c\u5e76\u4e14\u8bf7<strong>\u53ea\u58f0\u660e\u9700\u8981\u7684\u53c2\u6570</strong>\uff0c\u4e0d\u9700\u8981\u7684\u53c2\u6570\u5c06\u4e0d\u4f1a\u52a0\u8f7d</p>\n</li>\n<li>\n<p><strong>\u5904\u7406\u51fd\u6570</strong>\uff1a\u6709\u4e00\u4e2a\u53c2\u6570\u7684<strong>callable</strong>\uff0c\u7528\u4e8e\u5bf9\u6a21\u578b\u5b57\u6bb5\u5e8f\u5217\u5316\u7684\u7ed3\u679c\u8fdb\u884c\u5904\u7406\uff0c\u5b83\u5bf9\u5e94\u7684\u503c<strong>\u5fc5\u987b\u4e3a\u5df2\u7ecf\u58f0\u660e\u7684\u6a21\u578b\u5b57\u6bb5</strong>\uff08\u5728readonly/writable\u6216relate\u7684\u952e\u4e2d\uff09\uff0c\u8be5\u6a21\u578b\u5b57\u6bb5\u5e8f\u5217\u5316\u7684\u7ed3\u679c\u4f1a\u4f5c\u4e3a\u53c2\u6570\u503c\u4f20\u5165\u8fd9\u4e2a\u51fd\u6570\u5e76\u5c06\u8fd4\u56de\u7684\u7ed3\u679c\u4f5c\u4e3a\u5e8f\u5217\u5316\u7684\u7ed3\u679c</p>\n</li>\n</ol>\n<p>\u9664\u4e86\u5bf9\u6a21\u578b\u5b57\u6bb5\u7684\u5904\u7406\u51fd\u6570\u5916\uff0c\u5176\u4ed6\u7684\u952e\u4e0d\u80fd\u4e0e\u6a21\u578b\u5b57\u6bb5\u51b2\u7a81</p>\n<p>\u542b\u6709self\u53c2\u6570\u7684\u4ee3\u7406\u51fd\u6570\u7684\u4f7f\u7528\u4f1a\u4f7f\u5f97\u8bf7\u6c42\u6027\u80fd\u53d7\u5230\u4e00\u5b9a\u5f71\u54cd\uff08\u56e0\u4e3a\u9700\u8981\u5c06QuerySet\u4e2d\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u8fdb\u884c\u8fd4\u56de\uff09\uff0c\u6240\u4ee5\u5982\u679c\u80fd\u4f7f\u7528Expression\u65b9\u5f0f\u5b8c\u6210\u7684\u5c3d\u91cf\u4e0d\u7528\u4ee3\u7406\u51fd\u6570\uff0c\u5982\u4ee5\u4e0b\u4e24\u79cd\u76f8\u540c\u6548\u679c\u7684\u8868\u8fbe\u5f0f\u7b2c\u4e00\u79cd\u6027\u80fd\u66f4\u9ad8</p>\n<pre><span class=\"s1\">'work_num'</span><span class=\"p\">:</span> <span class=\"n\">exp</span><span class=\"o\">.</span><span class=\"n\">Count</span><span class=\"p\">(</span><span class=\"s1\">'works'</span><span class=\"p\">)</span>\t\t<span class=\"c1\"># has better performance</span>\n<span class=\"s1\">'work_num'</span><span class=\"p\">:</span> <span class=\"k\">lambda</span> <span class=\"bp\">self</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">works</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span>\n</pre>\n<p>proxy\u5b57\u5178\u4e2d\u7684\u5b57\u6bb5\u6beb\u65e0\u7591\u95ee\u662f\u53ea\u8bfb\u7684\uff0c\u53ea\u652f\u6301GET\u65b9\u6cd5</p>\n<ul>\n<li><strong>template</strong>: \u6a21\u5757\u7684<strong>\u6a21\u677f</strong>\u914d\u7f6e\uff0c\u6a21\u677f\u5728UtilMeta\u4e2d\u662f\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6982\u5ff5</li>\n</ul>\n<h5>1.1.x \u66f4\u591a\u7684\u5b9a\u4e49\u65b9\u5f0f</h5>\n<p>\u4ee5\u4e0a\u7684\u793a\u4f8b\u4e2d\uff0c\u5b9a\u4e49\u5b57\u6bb5\u7684\u65b9\u5f0f\u662f\u5b57\u6bb5\u5b57\u7b26\u4e32\u6216\u8005\u7528 '__all__' \u6307\u6240\u6709\u5b57\u6bb5\uff0c\u800c\u66f4\u52a0\u4fbf\u6377\u7684\u65b9\u5f0f\u662f\u6a21\u578b\u5c5e\u6027\u65b9\u5f0f\uff0c\u4ee5\u4e0b\u4e3a\u5b9e\u4f8b</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">WorkMain</span><span class=\"p\">(</span><span class=\"n\">Module</span><span class=\"p\">):</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Work</span>\n        <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n            <span class=\"n\">readonly</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">id</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">title</span><span class=\"p\">],</span>\n            <span class=\"n\">relate</span><span class=\"o\">=</span><span class=\"p\">{</span>\n                <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">creator</span><span class=\"p\">:</span> <span class=\"n\">Relate</span><span class=\"p\">(</span>\n                    <span class=\"n\">field</span><span class=\"o\">=</span><span class=\"p\">[</span>\n                        <span class=\"n\">Account</span><span class=\"o\">.</span><span class=\"n\">id</span><span class=\"p\">,</span> \n                        <span class=\"n\">Account</span><span class=\"o\">.</span><span class=\"n\">name</span>\n                        <span class=\"n\">Account</span><span class=\"o\">.</span><span class=\"n\">avatar</span>\n                    <span class=\"p\">]),</span>\n                <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">tags</span><span class=\"p\">:</span> <span class=\"n\">Relate</span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"o\">=</span><span class=\"s1\">'id'</span><span class=\"p\">,</span> <span class=\"n\">modify</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">)</span>\n</pre>\n<p>\u53ea\u8981\u5b57\u6bb5\u662f\u6a21\u578b\u7684\u4e00\u4e2a\u5c5e\u6027\u5c31\u53ef\u4ee5\u7528\u4ee5\u4e0a\u65b9\u6cd5\u6765\u5b9a\u4e49\uff0c\u5f53\u6a21\u578b\u5b57\u6bb5\u53d1\u751f\u6539\u53d8\u65f6IDE\u4f1a\u53d1\u51fa\u8b66\u793a\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528IDE\u7684\u8865\u9f50\u529f\u80fd\u5feb\u901f\u5b8c\u6210\u5b9a\u4e49\uff0c\u4f46\u662f\u5982\u679c\u5b57\u6bb5\u6ca1\u6709\u8fd9\u4e2a\u5c5e\u6027\uff08\u5982related_name\u5f15\u7528\u5b57\u6bb5\u7b49\uff09\u5c31\u9700\u8981\u4ee5\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\u6765\u5b9a\u4e49\uff0c\u4e24\u79cd\u65b9\u5f0fUtilMeta\u90fd\u80fd\u6b63\u786e\u5904\u7406</p>\n<p>\u521d\u6b21\u4e4b\u5916\u5bf9\u5e94relate, filter, annotate\u7b49\u4ee5\u5b57\u5178\u65b9\u5f0f\u5b9a\u4e49\u7684\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2aSchema\u5b9e\u4f8b\uff0cSchema\u7ee7\u627f\u81eadict\uff0c\u5b83\u7684\u7279\u70b9\u662f\u5728\u5176\u4e0a\u5b9a\u4e49\u7684\u5c5e\u6027\u4f1a\u88ab\u8f6c\u6362\u4e3a\u952e\u503c\uff0c\u4f7f\u7528Schema\u7684\u597d\u5904\u662f\u65b9\u4fbf\u5728\u4e0d\u540c\u6a21\u5757\u95f4\uff0c\u7ee7\u627f\uff0c\u590d\u7528\u4e00\u4e9b\u5b57\u6bb5\u914d\u7f6e\uff0c\u800c\u4e14\u907f\u514d\u4e86\u4f7f\u7528\u5b57\u5178\u9020\u6210\u7684\u62f7\u8d1d\u95ee\u9898</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">ContentAnnotate</span><span class=\"p\">(</span><span class=\"n\">Schema</span><span class=\"p\">):</span>\n    <span class=\"n\">like_num</span> <span class=\"o\">=</span> <span class=\"n\">exp</span><span class=\"o\">.</span><span class=\"n\">Count</span><span class=\"p\">(</span><span class=\"s1\">'likes'</span><span class=\"p\">)</span>\n    <span class=\"n\">view_num</span> <span class=\"o\">=</span> <span class=\"n\">exp</span><span class=\"o\">.</span><span class=\"n\">Count</span><span class=\"p\">(</span><span class=\"s1\">'views'</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">liked</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">:</span> <span class=\"n\">Content</span><span class=\"p\">,</span> <span class=\"n\">user</span><span class=\"p\">:</span> <span class=\"n\">Account</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">bool</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">user</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">False</span>\n        <span class=\"k\">return</span> <span class=\"n\">user</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">likes</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">MusicAnnotate</span><span class=\"p\">(</span><span class=\"n\">ContentAnnotate</span><span class=\"p\">):</span>\n    <span class=\"n\">download_times</span> <span class=\"o\">=</span> <span class=\"n\">exp</span><span class=\"o\">.</span><span class=\"n\">Count</span><span class=\"p\">(</span><span class=\"s1\">'download_people'</span><span class=\"p\">)</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">MusicMain</span><span class=\"p\">(</span><span class=\"n\">ContentMain</span><span class=\"p\">):</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Music</span>\n        <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n            <span class=\"n\">annotate</span><span class=\"o\">=</span><span class=\"n\">MusicAnnotate</span><span class=\"p\">()</span>\n        <span class=\"p\">)</span>\n</pre>\n<p>\u867d\u7136\u6a21\u578b\u7ee7\u627f\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u5b57\u5178\u5c5e\u6027\u7684\u7ee7\u627f\u548c\u66f4\u65b0\uff0c\u4f46\u662f\u5bf9\u4e8e\u76f8\u540c\u6a21\u5757\u6765\u8bf4\u8fd9\u662f\u4e00\u4e2a\u65b9\u4fbf\u7684\u65b9\u6cd5</p>\n<h4>1.2 Method \u7ec4\u4ef6</h4>\n<h4>1.3 \u6a21\u578b\u7ee7\u627f</h4>\n<h3>2. \u6a21\u677f\u7cfb\u7edf Template System</h3>\n<p>\u6a21\u677f\u7cfb\u7edf\u662fUtilMeta\u6570\u636e\u89e3\u6790\u7684\u4e2d\u67a2\u90e8\u5206\uff0c\u6709\u522b\u4e8eDjango\u4e2dHTML\u6a21\u677f\u7684\u542b\u4e49\uff0cUtilMeta\u4e2d\u7684\u6a21\u677f\u6307\u7684\u662f\u6570\u636e\u6a21\u677f\uff0c\u89c4\u8303\u8bf7\u6c42\u53c2\u6570\u7684\u7c7b\u578b\uff0c\u9650\u5236\u548c\u7ed3\u6784\uff0c\u8fc7\u6ee4\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u810f\u8bf7\u6c42\uff0c\u5e76\u80fd\u591f\u5c06\u8bf7\u6c42\u53c2\u6570\u5e8f\u5217\u5316\u4e3a\u8981\u6c42\u7684\u7ed3\u6784</p>\n<p>\u5bf9\u4e8e\u4e00\u4e2aUtilMeta\u9879\u76ee\uff0c\u5728\u542f\u52a8\u65f6\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a\u6839\u6a21\u677f\uff0c\u5176\u4e2d\u6709\u6240\u6709\u53ef\u80fd\u7684\u8bf7\u6c42\u8def\u5f84\u5df2\u7ecf\u5bf9\u5e94\u7684\u8bf7\u6c42\u6a21\u677f\u548c\u8fd4\u56de\u6a21\u677f\uff0c\u53ef\u4ee5\u8bf4\uff0c\u7528Util\u5728API\u5c42\u548cModule\u5c42\u505a\u7684\u5927\u90e8\u5206\u5b9a\u4e49\u6027\u6216\u914d\u7f6e\u6027\u7684\u5de5\u4f5c\u90fd\u4f1a\u8f6c\u6362\u4e3a\u6a21\u677f\u4e0a\u7684\u53c2\u6570\u6216\u8005\u9650\u5236\uff0c\u4e3a\u6574\u4e2a\u5e94\u7528\u670d\u52a1\uff0c\u5f53\u7136\uff0c\u6a21\u677f\u53ea\u8d1f\u8d23\u6570\u636e\u7684<strong>\u89e3\u6790</strong>\u548c<strong>\u9a8c\u8bc1</strong>\uff0c\u4e0d\u8d1f\u8d23\u4e1a\u52a1\u7684\u8fdb\u884c\u548c\u5177\u4f53\u7684\u6570\u636e\u64cd\u4f5c\uff0c\u90a3\u4e9b\u662fAPI\u548cModule\u5355\u5143\u4e2d\u7684\u903b\u8f91\u4ee3\u7801\u7684\u4efb\u52a1</p>\n<p>\u867d\u7136\u6839\u6a21\u677f\u662f\u4e00\u4f53\u7684\uff08\u662f\u6839API\u7684\u4e00\u4e2a\u5b57\u5178\u5143\u7d20\uff09\uff0c\u4f46\u62bd\u8c61\u4e0a\u6574\u4e2a\u6a21\u677f\u7cfb\u7edf\u5927\u4f53\u53ef\u4ee5\u5206\u4e3a\u4e24\u90e8\u5206\uff0c</p>\n<h4>2.1 \u6a21\u677f\u7cfb\u7edf\u6982\u89c8</h4>\n<ol>\n<li><strong>\u81ea\u52a8\u5316\uff08\u6ce8\u5165\u5f0f\uff09\u6a21\u677f</strong></li>\n</ol>\n<p>\u670d\u52a1\u4e8eModule\u7684\u6a21\u677f\uff0c\u901a\u8fc7\u5728Field\u4e2d\u7684\u5e8f\u5217\u5316\u914d\u7f6e\u548cMethod\u4e2d\u7684\u65b9\u6cd5\u914d\u7f6e\u751f\u6210\uff0c\u5b83\u4eec\u7684\u7c7b\u578b\uff0c\u9650\u5236\uff0c\u9ed8\u8ba4\u503c\u7b49\u90fd\u5728\u5b9a\u4e49\u6a21\u578b\u5b57\u6bb5\u65f6\u786e\u5b9a\uff0c\u5728\u6a21\u5757\u5316\u65f6UtilMeta\u63a5\u7ba1\u4e86\u8fd9\u90e8\u5206\u6a21\u677f\u7684\u751f\u6210\uff0c\u800c\u4e14\u8fd9\u90e8\u5206\u57fa\u672c\u7684\u589e\u5220\u6539\u67e5\u6846\u67b6\u4f1a\u81ea\u52a8\u5904\u7406\uff0c\u4e5f\u65e0\u9700\u7f16\u5199\u903b\u8f91\u4ee3\u7801\u548c\u7c7b\u578b\u63d0\u793a\uff0c\u5f00\u53d1\u8005\u5982\u679c\u9700\u8981\u66f4\u5b9a\u4e49\u590d\u6742\u7684\u9650\u5236\u6216\u989d\u5916\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528<strong>\u6ce8\u5165</strong>\u7684\u65b9\u5f0f\u53ea\u5f71\u54cd\u76ee\u6807\u53c2\u6570\uff0c\u5728Field\u7ec4\u4ef6\u4e2d\u63d0\u4f9b\u4e86\u8fd9\u6837\u7684\u63a5\u53e3 template\u53c2\u6570\uff0c\u901a\u8fc7\u4f20\u5165\u4e00\u4e2a\u5b57\u5178\u53ef\u4ee5\u5c06\u952e\u5bf9\u5e94\u7684\u53c2\u6570\u7684\u89c4\u5219\u8fdb\u884c\u6ce8\u5165\u878d\u5408\uff0c<strong>\u6ce8\u5165\u539f\u5219\u662f\u89c4\u5219\u53ea\u80fd\u589e\u591a\u4e0d\u80fd\u51cf\u5c11</strong>\uff0c\u56e0\u4e3a\u4e00\u4e9b\u6570\u636e\u5e93\u5c42\u9762\u7684\u9650\u5236\uff08\u5982\u6700\u5927\u957f\u5ea6\u7b49\uff09\u88ab\u57fa\u7840\u7684\u89c4\u5219\u4fdd\u8bc1\uff0c\u65b0\u6ce8\u5165\u7684\u89c4\u5219\u53ea\u80fd\u66f4\u52a0\u4e25\u683c\u5426\u5219\u53ef\u80fd\u5728\u8fd0\u884c\u65f6\u5f15\u53d1\u6570\u636e\u5e93\u5199\u5165\u9519\u8bef</p>\n<ol>\n<li><strong>\u5b9a\u4e49\u5f0f\u6a21\u677f</strong></li>\n</ol>\n<p>\u5728API\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u8bf7\u6c42\u8def\u5f84\uff0c\u8bf7\u6c42\u53c2\u6570\uff0c\u8bf7\u6c42\u4f53\u4f5c\u51fa\u7ec6\u81f4\u7684\u9650\u5236\u6a21\u677f\uff0c\u6765\u6ee1\u8db3\u590d\u6742\u7684\uff0c\u5b9a\u5236\u5316\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u8fd9\u4e00\u90e8\u5206\u901a\u5e38\u501f\u52a9Schema\u7ec4\u4ef6\u548cRule\u7ec4\u4ef6\u5b8c\u6210\uff0cSchema\u7ec4\u4ef6\u662f\u4e00\u4e2a\u7ee7\u627f\u81eadict\u7684\u7c7b\uff0c\u7ee7\u627f\u81eaSchema\u7684\u7c7b\u53ef\u4ee5\u4f7f\u7528\u7c7b\u6210\u5458\u7c7b\u578b\u6ce8\u91ca\u7684\u65b9\u6cd5\u5b9a\u4e49\u6570\u636e\u7684\u7ed3\u6784\u7c7b\u578b\uff0c\u4e5f\u53ef\u4ee5\u7ed3\u5408Rule\u53bb\u8be6\u7ec6\u5236\u5b9a\u53c2\u6570\u7684\u89c4\u5219\uff0cSchema\u652f\u6301\u5c5e\u6027\u8bbf\u95ee\u548c\u5b57\u5178\u952e\u8bbf\u95ee\u4e24\u79cd\u8bbf\u95ee\u65b9\u5f0f\uff0c\u800c\u4e14\u4fee\u6539\u4e0e\u5220\u9664\u662f\u540c\u6b65\u7684\uff0c\u65e2\u5229\u7528\u4e86\u7c7b\u5c5e\u6027\u81ea\u52a8\u63d0\u793a\u7684\u65b9\u4fbf\u529f\u80fd\uff0c\u8fd8\u53ef\u4ee5\u65b9\u4fbf\u7684\u5411\u6570\u636e\u6a21\u5757\u4e2d\u4f20\u9012\u6570\u636e\u548c\u8fd4\u56de\u6570\u636e\uff0c\u7136\u540e\u901a\u8fc7\u51fd\u6570\u53c2\u6570\u7c7b\u578b\u63d0\u793a\u7684\u65b9\u5f0f\u7ed1\u5b9a\u5230API\u4e2d</p>\n<p>Schema\u7c7b\u53ef\u4ee5\u901a\u8fc7\u5b9e\u4f8b\u5316\u7684\u65b9\u5f0f\u63a5\u53d7\u5e76\u9a8c\u8bc1\u6570\u636e\u5f97\u5230\u4e00\u4e2aSchema\u5b9e\u4f8b\uff0c\u7531\u4e8eSchema\u7ee7\u627fdict\uff0c\u5b57\u5178\u7c7b\u7684\u65b9\u6cd5\u5305\u62ec ** \u53cc\u661f\u53f7\u6620\u5c04\u4e5f\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Item</span><span class=\"p\">(</span><span class=\"n\">Schema</span><span class=\"p\">):</span>\n    <span class=\"nb\">id</span><span class=\"p\">:</span> <span class=\"nb\">int</span>\n    <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"nb\">str</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">AccountData</span><span class=\"p\">(</span><span class=\"n\">Schema</span><span class=\"p\">):</span>\n    <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s1\">'default'</span>\n    <span class=\"n\">password</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">))</span>\n    <span class=\"n\">item_list</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Item</span><span class=\"p\">]</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">GroupData</span><span class=\"p\">(</span><span class=\"n\">AccountData</span><span class=\"p\">):</span>\n    <span class=\"n\">members</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">AccountData</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n<span class=\"n\">account_data</span> <span class=\"o\">=</span> <span class=\"n\">AccountData</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">'python group'</span><span class=\"p\">,</span>\n    <span class=\"n\">password</span><span class=\"o\">=</span><span class=\"s1\">'abc123'</span><span class=\"p\">,</span>\n    <span class=\"n\">item_list</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">Item</span><span class=\"p\">(</span><span class=\"nb\">id</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">'it1'</span><span class=\"p\">)]</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">group_data</span> <span class=\"o\">=</span> <span class=\"n\">GroupData</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">account_data</span><span class=\"p\">,</span> <span class=\"n\">members</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">AccountData</span><span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">),</span> <span class=\"o\">...</span><span class=\"p\">])</span>\n</pre>\n<p>\u5728\u5b9a\u4e49\u6a21\u677f\u65f6\u9700\u6ce8\u610f\u4e24\u70b9</p>\n<ol>\n<li>\u53c2\u6570\u540d\u79f0\u4e0d\u80fd\u4ee5 __ \uff08\u53cc\u4e0b\u5212\u7ebf\uff09\u5f00\u5934\u7ed3\u5c3e\uff0c\u8fd9\u6837\u7684\u53d8\u91cf\u4f5c\u4e3a\u7c7b<strong>\u4fdd\u7559\u53d8\u91cf</strong>\u4e0d\u4f1a\u6dfb\u52a0\u5230\u6a21\u677f\u4e2d</li>\n<li>\u7531\u4e8eSchema\u7ee7\u627f\u81eadict\u5b57\u5178\u7c7b\uff0c\u63d0\u4f9b\u5c5e\u6027\u8bbf\u95ee\u548c\u952e\u8bbf\u95ee\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5b57\u5178\u7684\u6b63\u5e38\u529f\u80fd\uff0c\u7c7b\u53d8\u91cf\u7684\u547d\u540d\u9700\u8981<strong>\u907f\u5f00\u5b57\u5178\u7684\u65b9\u6cd5\u540d\u79f0</strong>\uff0c\u5982 get, pop , update, clear, values, items, keys\u7b49</li>\n</ol>\n<p>\u8fd9\u90e8\u5206\u7684\u6a21\u677f\u662f\u975e\u5e38\u7075\u6d3b\u7684\uff0c\u4e0d\u662f\u5f3a\u5236\u7ed1\u5b9a\u7684\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u53e6\u8d77\u4e00\u4e2a\u6587\u4ef6\uff0c\u5f15\u5165Schema\u548ctyping\uff0c\u4e13\u95e8\u7528\u4e8e\u5b9a\u4e49\u53c2\u6570\u6a21\u677f\uff0c\u5176\u4e2d\u53ef\u6d3b\u7528\u7ee7\u627f\u91cd\u7528\u53c2\u6570\u8bbe\u7f6e\uff0c\u7136\u540e\u5728API\u4e2d\u8fdb\u884c\u5f15\u5165\u5e76\u5bf9\u53c2\u6570\u4f5c\u7c7b\u578b\u63d0\u793a</p>\n<p>\u63a5\u4e0b\u6765\u5c06\u91cd\u70b9\u4ecb\u7ecd\u5b9a\u4e49\u5f0f\u6a21\u677f\u7684\u8bf7\u6c42\u6570\u636e\u89e3\u6790\u89c4\u5219\uff0c\u8bf7\u6c42\u6570\u636e\u5728\u8fd9\u91cc\u7684\u6982\u5ff5\u662f\u8bf7\u6c42\u643a\u5e26\u7684\u4fe1\u606f\u548c\u6570\u636e\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u5305\u542b\u4e09\u90e8\u5206</p>\n<ol>\n<li>\u8bf7\u6c42URL</li>\n<li>\u8bf7\u6c42QueryString</li>\n<li>\u8bf7\u6c42\u4f53</li>\n</ol>\n<p>\u5b9a\u4e49\u5f0f\u6a21\u677f\u7684\u5de5\u4f5c\u5c31\u662f\u5c06\u8bf7\u6c42\u7684\u8def\u5f84\uff0c\u53c2\u6570\uff0c\u8bf7\u6c42\u4f53\u6620\u5c04\u89e3\u6790\u5230\u5bf9\u5e94\u51fd\u6570\u53c2\u6570\u4e0a\uff0c\u5e76\u4fdd\u8bc1\u8f6c\u5316\u4e3a\u5b9a\u4e49\u597d\u7684\u6570\u636e\u7ed3\u6784\u548c\u6ee1\u8db3\u76f8\u5e94\u7684\u9650\u5236</p>\n<h4>2.2 URL\u4e2d\u4f20\u53c2</h4>\n<p>\u5728URL\u4e2d\u4f20\u9012\u6570\u636e\u662f\u6bd4\u8f83\u666e\u904d\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50</p>\n<pre><span class=\"c1\"># GET /api/doc/code.python/3#framework</span>\n<span class=\"c1\"># GET /api/doc/code.python/3</span>\n<span class=\"c1\"># GET /api/doc/code.python</span>\n\n<span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">'</span><span class=\"si\">{0}</span><span class=\"s1\">.</span><span class=\"si\">{1}</span><span class=\"s1\">/</span><span class=\"si\">{page}</span><span class=\"s1\">#</span><span class=\"si\">{item}</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">doc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">major</span><span class=\"p\">,</span> <span class=\"n\">category</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> \n        <span class=\"n\">page</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span> <span class=\"c1\"># ('code', 'python')</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">page</span><span class=\"p\">)</span> <span class=\"c1\"># 3</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span> <span class=\"c1\"># 'framework'</span>\n</pre>\n<p>URL\u7684\u53c2\u6570\u5339\u914d\u5b57\u7b26\u4e32\u7531@api\u88c5\u9970\u5668\u4e2d\u7684path\u53c2\u6570\u5b9a\u4e49\uff0c\u7c7b\u4f3cpython\u5b57\u7b26\u4e32format\u7684\u89c4\u5219\uff0c\u53ef\u4ee5\u5b9a\u4e49<strong>\u987a\u5e8f\u53c2\u6570</strong>\u548c<strong>\u5177\u540d\u53c2\u6570</strong>\u3002URL\u53c2\u6570\u4e2d\u7684\u987a\u5e8f\u53c2\u6570 {0}, {1} ... \u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u524d\u540e\u987a\u5e8f\u5fc5\u987b\u662f\u8fde\u7eed\u5730\u4ece\u5c0f\u5230\u5927\uff0c\u5728\u51fd\u6570\u4f20\u53c2\u4e2d\u5c06\u4f5c\u4e3a\u987a\u5e8f\u53c2\u6570\u4f20\u5165\u51fd\u6570 self \u540e\u7684\u5bf9\u5e94\u4f4d\u7f6e\u53c2\u6570\uff0cURL\u4e2d\u7684\u5177\u540d\u53c2\u6570\u662f\u4ee5\u952e\u503c\u53c2\u6570\u7684\u65b9\u5f0f\u4f20\u5165\u51fd\u6570\u4e2d\u5bf9\u5e94\u540d\u79f0\u7684\u53c2\u6570\uff0c\u5728URL\u4e2d\u5b9a\u4e49\u591a\u4e2a\u53c2\u6570\u65f6\uff0c\u53c2\u6570\u548c\u53c2\u6570\u76f4\u63a5\u5fc5\u987b\u6709\u5b57\u7b26\u4e32\u4f5c\u4e3a<strong>\u5206\u5272</strong>\uff0c\u8fd9\u4e2a\u5b57\u7b26\u4e32\u901a\u5e38\u4e3a\u4e0b\u5212\u7ebf   **/ **</p>\n<p>\u8981\u6ce8\u610f\u6b64\u65f6\u51fd\u6570\u7684\u540d\u79f0\u4f9d\u7136\u6709\u6548\uff0c\u4f5c\u4e3a\u4e00\u6bb5URL\u8def\u5f84\uff0cpath\u4e2d\u662f \u2018\u5269\u4f59\u2019 \u7684URL\u8def\u5f84</p>\n<h5>2.2.1 \u53c2\u6570\u7701\u7565\u7684\u89c4\u5219</h5>\n<p>\u53c2\u6570\u53ef\u4ee5<strong>\u5411\u540e\u7701\u7565</strong>\uff0citem\u53c2\u6570\u6709\u9ed8\u8ba4\u503c\uff0c\u5c31\u53ef\u4ee5\u5339\u914d /api/doc/code.python/3 \u7684\u8def\u5f84\uff0c<strong>\u9ed8\u8ba4\u53c2\u6570\u8fde\u540c\u524d\u9762\u7684\u5206\u9694\u5b57\u7b26\u4e32\u4e00\u540c\u7701\u7565</strong>, \u4f9d\u6b64\u7c7b\u63a8\uff0c\u4ece\u540e\u5f80\u524d\uff0c\u6240\u6709\u7684\u9ed8\u8ba4\u53c2\u6570\u90fd\u53ef\u4ee5\u7701\u7565\uff0c<strong>\u4e0ePython\u51fd\u6570\u5b9a\u4e49\u89c4\u5219\u4e00\u6837</strong>\uff0c\u4e0d\u80fd\u51fa\u73b0\u9760\u524d\u7684\u8def\u5f84\u53c2\u6570\u53ef\u4ee5\u7701\u7565\u800c\u9760\u540e\u7684\u4e0d\u884c\u7684\u60c5\u51b5</p>\n<p>\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u4e4b\u4e00\u7684\u53c2\u6570\u5373\u89c6\u4f5c\u53ef\u4ee5\u7701\u7565</p>\n<ol>\n<li><strong>\u53c2\u6570\u6709\u4e00\u4e2a\u57fa\u672c\u53d8\u91cf\u7684\u9ed8\u8ba4\u503c\uff08\u4e0d\u80fd\u4e3aRule\uff09</strong></li>\n</ol>\n<pre><span class=\"k\">def</span> <span class=\"nf\">doc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"c1\"># not require</span>\n\t\t\t\t<span class=\"n\">page</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">)</span> <span class=\"c1\"># required</span>\n\t\t\t <span class=\"p\">):</span>\n\t\t<span class=\"k\">pass</span>\n</pre>\n<ol>\n<li><strong>\u53c2\u6570\u6709\u4e00\u4e2aRule\u5b9e\u4f8b\u4f5c\u4e3a\u9ed8\u8ba4\u503c\uff0c\u5728Rule\u4e2d\u8bbe\u7f6edefault\u6216require=False</strong></li>\n</ol>\n<pre><span class=\"k\">def</span> <span class=\"nf\">doc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">page</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\t<span class=\"c1\"># not require</span>\n\t\t\t\t<span class=\"n\">item</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">require</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\t\t\t<span class=\"c1\"># not require</span>\n\t\t\t <span class=\"p\">):</span>\n\t\t<span class=\"k\">pass</span>\n</pre>\n<p>\u4ee5\u4e0a\u7684\u60c5\u51b5\uff0c\u65e0\u8bba\u662f\u76f4\u63a5\u8bbe\u7f6e\u5e38\u91cf\u9ed8\u8ba4\u503c\u8fd8\u662f\u5728Rule\u4e2d\u8bbe\u7f6edefault\uff0c\u5728\u53c2\u6570\u7f3a\u5931\u65f6\u51fd\u6570\u53c2\u6570\u4f1a\u88ab\u4f20\u9012\u8fd9\u4e2a\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c\uff0c\u7136\u800c\u5f53\u53ea\u5728Rule\u4e2d\u8bbe\u7f6e require=False \u800c\u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u7684\u60c5\u51b5\u5bf9\u5e94\u7684\u51fd\u6570\u53c2\u6570\u4f1a\u88ab\u4f20\u5165 ...\uff08\u7701\u7565\u53f7 <strong>Ellipsis</strong>\uff09\uff0c\u9700\u8981\u7279\u522b\u6ce8\u610f\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u51fd\u6570\u53c2\u6570\u8fd8\u662f\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u6bd4\u8f83\u65b9\u4fbf\uff0cRule(require=False)\u4e3b\u8981\u7528\u4e8e\u5b57\u5178\u6570\u636e\u7684\u6a21\u677f\uff0c\u8bf7\u6c42\u4e2d\u7f3a\u5931\u7684\u6b64\u7c7b\u53c2\u6570\u4e0d\u4f1a\u51fa\u73b0\u5728\u5b57\u5178\u6570\u636e\u4e2d</p>\n<ol>\n<li>*<em>\u987a\u5e8f\u53c2\u6570\u4e2d\u51fa\u73b0 <em>args \u53d8\u91cf</em></em></li>\n</ol>\n<pre><span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">'</span><span class=\"si\">{0}</span><span class=\"s1\">/</span><span class=\"si\">{1}</span><span class=\"s1\">/</span><span class=\"si\">{3}</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">eg</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">first</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">others</span><span class=\"p\">):</span>\n\t\t<span class=\"k\">pass</span>\n</pre>\n<p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u9664\u4e86\u7b2c\u4e00\u4e2a\u987a\u5e8f\u53c2\u6570 {0} \u4e0d\u80fd\u7701\u7565\u5916\uff0c\u5176\u4ed6\u7684\u987a\u5e8f\u53c2\u6570\u7531\u4e8e\u6709\u53d8\u957f\u53c2\u6570\u7684\u5b58\u5728\u800c\u53ef\u4ee5\u7701\u7565</p>\n<ol>\n<li><strong>\u5177\u540d\u53c2\u6570\u4e2d\u51fa\u73b0 **kwargs \u53d8\u91cf</strong></li>\n</ol>\n<pre><span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">'</span><span class=\"si\">{0}</span><span class=\"s1\">/</span><span class=\"si\">{id}</span><span class=\"s1\">/</span><span class=\"si\">{field}</span><span class=\"s1\">#</span><span class=\"si\">{annotate}</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">doc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"nb\">id</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n\t\t<span class=\"k\">pass</span>\n</pre>\n<p>\u7531\u4e8e\u51fa\u73b0 ** \u952e\u503c\u53d8\u91cf\uff0cid\u540e\u9762\u7684\u5177\u540d\u53c2\u6570\u5c31\u662f\u53ef\u7701\u7565\u7684</p>\n<p>\u53ea\u80fd\u5411\u540e\u7701\u7565\u7684\u89c4\u5219\u4e5f\u5f88\u660e\u663e\uff0c\u53ef\u4ee5\u770b\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50</p>\n<pre><span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">'</span><span class=\"si\">{0}</span><span class=\"s1\">.</span><span class=\"si\">{1}</span><span class=\"s1\">/</span><span class=\"si\">{page}</span><span class=\"s1\">#</span><span class=\"si\">{item}</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">doc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">classes</span><span class=\"p\">,</span> <span class=\"n\">page</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"c1\"># Invalid</span>\n\t\t<span class=\"k\">pass</span>\n</pre>\n<p>\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u987a\u5e8f\u53c2\u6570\u7531\u4e8e\u4f7f\u7528\u4e86\u53d8\u957f\u7684\u987a\u5e8f\u53c2\u6570\u53d8\u91cf *classes\uff0c\u6240\u4ee5\u4e24\u4e2a\u987a\u5e8f\u53c2\u6570\u90fd\u662f\u53ef\u7701\u7565\u7684\uff0c\u7136\u800c\u5728\u987a\u5e8f\u53c2\u6570<strong>\u540e\u9762</strong> (\u8fd9\u91cc\u6307\u5728\u8def\u5f84\u5b57\u7b26\u4e32\u4e2d) \u7684page\u53c2\u6570\u5374\u4e0d\u53ef\u7701\u7565\uff0c\u8fd9\u662f\u505a\u4e0d\u5230\u7684\uff0c\u6240\u4ee5\u987a\u5e8f\u53c2\u6570\u7684\u7701\u7565\u6ca1\u6709\u610f\u4e49\uff0c\u6b64\u65f6\u4f1a\u62a5\u9519</p>\n<h5>2.2.2 \u6b63\u5219\u8868\u8fbe\u5f0f\u5b9a\u4e49\u8def\u5f84</h5>\n<p>\u9664\u4e86\u4f7f\u7528path\u8fd9\u79cdformat\u6807\u51c6\u7684\u65b9\u5f0f\u4ee5\u5916\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4f20\u7edf\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff0c\u5728@api\u88c5\u9970\u5668\u7684reg\u53c2\u6570\u5b9a\u4e49\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u7684\u7ed3\u679c\u6309\u7167\u987a\u5e8f\u5206\u53d1\u4e3a\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 ?P \u8868\u8fbe\u5f0f\u5206\u53d1\u5177\u540d\u53c2\u6570\uff0c\u6240\u4ee5\u53c2\u6570\u5747\u4e0d\u53ef\u4ee5\u7701\u7565</p>\n<pre><span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">reg</span><span class=\"o\">=</span><span class=\"s1\">'^([a-z]{4,6})\\.([a-z]{4,10})/(?P&lt;page&gt;\\d{1,3})#(?P&lt;item&gt;[a-z]{3,10})$'</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">doc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"n\">page</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n\t\t<span class=\"k\">pass</span>\n</pre>\n<p>\u4f7f\u7528\u6b63\u5219\u548c\u4f7f\u7528\u666e\u901a\u5339\u914d\u540e\u7528\u76f8\u540c\u7684\u6b63\u5219\u4f5c\u4e3aRule\u8fdb\u884c\u9a8c\u8bc1\u7684\u6548\u679c\u5927\u81f4\u76f8\u540c\uff0c\u4f46\u662f\u5f53\u6b63\u5219\u5339\u914d\u5931\u8d25\u65f6\u4f1a\u8fd4\u56de404\uff0c\u4f46\u5f53\u53c2\u6570\u5339\u914d\u6210\u529f\u4f46\u6b63\u5219\u9a8c\u8bc1\u5931\u8d25\u65f6\u4f1a\u8fd4\u56de400</p>\n<h4>2.3 \u5728QueryString\u4e2d\u4f20\u53c2</h4>\n<h5>2.3.1 \u53ea\u5728\u8bf7\u6c42\u4f53\u4e2d\u4f20\u53c2</h5>\n<p>\u5bf9\u4e8e\u4e00\u4e9b\u67e5\u8be2\u64cd\u4f5c\u7b49\uff0c\u5728URL\u7684QueryString\u4e2d\u4f20\u5165\u952e\u503c\u5bf9\u4e5f\u662f\u5f88\u666e\u904d\u7684\u65b9\u5f0f</p>\n<pre><span class=\"c1\"># GET /api/doc?page=3&amp;item=framework</span>\n<span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">get</span>\n<span class=\"k\">def</span> <span class=\"nf\">doc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">page</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">page</span><span class=\"p\">)</span> <span class=\"c1\"># 3</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span> <span class=\"c1\"># 'framework'</span>\n</pre>\n<p>\u53ea\u8981\u4e0d\u53bb\u5b9a\u4e49path\u6216reg\u5b57\u7b26\u4e32\uff0c\u51fd\u6570\u4e2d\u9664\u4e86self\u5916\u7684\u53c2\u6570\u5c06\u4f1a\u4f5c\u4e3aQueryString\u4e2d\u7684\u53c2\u6570\u6a21\u677f\uff0c\u5982\u679c\u4f60\u60f3\u628a\u8fd9\u4e9b\u53c2\u6570\u6574\u5408\u5230\u4e00\u4e2aSchema\u4e2d\u5b9a\u4e49\uff0c\u53ef\u4ee5\u4f7f\u7528</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">QuerySchema</span><span class=\"p\">(</span><span class=\"n\">Schema</span><span class=\"p\">):</span>\n    <span class=\"n\">page</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">)</span>\n    <span class=\"n\">item</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">),</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">CommonAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n    <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">get</span>\n    <span class=\"k\">def</span> <span class=\"nf\">doc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">query</span><span class=\"p\">:</span> <span class=\"n\">QuerySchema</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Param</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"o\">.</span><span class=\"n\">page</span><span class=\"p\">)</span> <span class=\"c1\"># 3</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"o\">.</span><span class=\"n\">item</span><span class=\"p\">)</span> <span class=\"c1\"># 'framework'</span>\n</pre>\n<p>\u4f46\u662f\u8fd9\u79cd\u5355\u72ec\u6307\u5b9aSchema.Param\u7684\u65b9\u5f0f\u5fc5\u987b\u4fdd\u8bc1\u76f8\u5e94\u53c2\u6570\u7684\u7c7b\u578b\u63d0\u793a\u662fdict\u7684\u5b50\u7c7b (Schema\u4e3adict\u7684\u5b50\u7c7b)\uff0c\u56e0\u4e3aQueryString\u4e2d\u7684\u53c2\u6570\u662f\u4ee5\u952e\u503c\u5bf9\u65b9\u5f0f\u5b9a\u4e49\u7684\uff0c\u6240\u4ee5\u5fc5\u5b9a\u4f1a\u8f6c\u5316\u4e3a\u4e00\u4e2a\u5b57\u5178</p>\n<h5>2.3.2 \u540c\u65f6\u5728URL\u548cQueryString\u4e2d\u4f20\u53c2</h5>\n<p>\u5148\u770b\u4e00\u4e2a\u4f8b\u5b50</p>\n<pre><span class=\"c1\"># DELETE /api/log/2019/10/INFO?status=200</span>\n<span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">'</span><span class=\"si\">{0}</span><span class=\"s1\">/</span><span class=\"si\">{1}</span><span class=\"s1\">/</span><span class=\"si\">{level}</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">year</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">2000</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">2020</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">),</span> \n            <span class=\"n\">month</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">),</span> \n            <span class=\"n\">level</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">choices</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'INFO'</span><span class=\"p\">,</span> <span class=\"s1\">'WARN'</span><span class=\"p\">,</span> <span class=\"s1\">'ERROR'</span><span class=\"p\">],</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">),</span>\n            <span class=\"n\">status</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">200</span><span class=\"p\">)</span>\n           <span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">year</span><span class=\"p\">,</span> <span class=\"n\">month</span><span class=\"p\">,</span> <span class=\"n\">level</span><span class=\"p\">,</span> <span class=\"n\">status</span><span class=\"p\">)</span>\n        <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">k</span><span class=\"p\">:</span> <span class=\"n\">v</span> <span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span> <span class=\"k\">if</span> <span class=\"n\">v</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">}</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">module</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">data</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span>\n</pre>\n<p>\u5728\u51fd\u6570\u53c2\u6570\u4e2d\uff0c\u9664\u4e86path\u4e2d\u5b9a\u4e49\u7684\u987a\u5e8f\u53c2\u6570\u548c\u5177\u540d\u53c2\u6570\u5916\uff0c\u4f59\u4e0b\u7684\u53c2\u6570\u5c31\u662fQueryString\u4e2d\u7684\u53c2\u6570\u4e86</p>\n<p>\u6839\u636e\u53c2\u6570\u7684\u7701\u7565\u89c4\u5219</p>\n<pre><span class=\"err\">DELETE</span> <span class=\"err\">/api/log?status=</span><span class=\"mi\">200</span>\t\t\t<span class=\"err\">//</span> <span class=\"err\">year=None,</span> <span class=\"err\">month=None,</span> <span class=\"err\">level=None,</span> <span class=\"err\">status=</span><span class=\"mi\">200</span>\n<span class=\"err\">DELETE</span> <span class=\"err\">/api/log/</span><span class=\"mi\">2019</span><span class=\"err\">?status=</span><span class=\"mi\">200</span>\t    <span class=\"err\">//</span> <span class=\"err\">year=</span><span class=\"mi\">2019</span><span class=\"err\">,</span> <span class=\"err\">month=None,</span> <span class=\"err\">level=None,</span> <span class=\"err\">status=</span><span class=\"mi\">200</span>\n<span class=\"err\">DELETE</span> <span class=\"err\">/api/log/INFO</span>\t\t\t\t<span class=\"err\">//</span> <span class=\"err\">Invalid</span> <span class=\"err\">(apply</span> <span class=\"err\">the</span> <span class=\"err\">rule</span> <span class=\"err\">of</span> <span class=\"err\">'year'</span> <span class=\"err\">in</span> <span class=\"err\">'INFO')</span>\n</pre>\n<p>\u4ece\u4e0a\u9762\u7684\u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa\u8fd9\u4e2a\u63a5\u53e3\u7684\u53c2\u6570\u8bbe\u8ba1\u662f\u6709\u95ee\u9898\u7684\uff0c\u5e94\u8be5\u4e5f\u5141\u8bb8\u5ffd\u7565\u65f6\u95f4\u67e5\u8be2 level='INFO' \u7684\u65e5\u5fd7\uff0c\u6240\u4ee5\u5e94\u8be5\u628alevel\u8fd9\u4e2a\u53c2\u6570\u4eceURL\u4e2d\u8f6c\u79fb\u5230QueryString\u4e2d\uff0c\u5373\u5220\u9664path\u4e2d\u7684 { level } \uff0c \u800c\u4e14\u6211\u4eec\u603b\u7ed3\u51fa\u7684\u7ecf\u9a8c\u4e5f\u662f\uff0c\u5bf9\u4e8e\u5982<strong>\u65e5\u671f\uff0c\u5206\u7c7b\u7b49\u53ef\u4ee5\u5411\u540e\u7701\u7565\u7684\u6570\u636e</strong>\u9002\u5408\u4e8eURL\u67e5\u8be2\uff0c\u800c<strong>\u5e73\u884c\u8bed\u4e49</strong>\u7684\u67e5\u8be2\u9002\u5408\u653e\u5728QueryString\u4e2d</p>\n<h4>2.4 \u63a5\u53d7\u8bf7\u6c42\u4f53\u4e2d\u7684\u6570\u636e</h4>\n<p>\u5bf9\u4e8ePUT / PATCH / POST\u65b9\u6cd5\u6765\u8bf4\uff0c\u8bf7\u6c42\u8fd8\u4f1a\u5305\u62ec\u8bf7\u6c42\u4f53\u6570\u636e\uff0c\uff08\u867d\u7136GET/DELETE\u65b9\u6cd5\u4e5f\u80fd\u643a\u5e26\u8bf7\u6c42\u4f53\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u91cc\u7ea6\u5b9a\u9650\u5236\u4e0d\u80fd\u4f7f\u7528\uff09\uff0c\n\u8bf7\u6c42\u4f53\u6570\u636e\u7684\u7c7b\u578b\u5f88\u591a\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2ajson\uff0c\u4e00\u4e2a\u53ef\u80fd\u5305\u542b\u6587\u4ef6\u7684\u8868\u5355\uff0c\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u6216\u8005\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u8bf7\u6c42\u4f53\u4e00\u822c\u4f7f\u7528\u7c7b\u578b\u63d0\u793a\u660e\u786e\u7c7b\u578b\u6765\u5b9a\u4e49\uff0c\u5177\u4f53\u770b\u4e0b\u9762\u7684\u4f8b\u5b50</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">DataSchema</span><span class=\"p\">(</span><span class=\"n\">Schema</span><span class=\"p\">):</span>\n    <span class=\"n\">title</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">))</span>\n    <span class=\"n\">description</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FormSchema</span><span class=\"p\">(</span><span class=\"n\">DataSchema</span><span class=\"p\">):</span>\n    <span class=\"n\">image</span><span class=\"p\">:</span> <span class=\"n\">Media</span><span class=\"o\">.</span><span class=\"n\">File</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">MediaAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n    <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">upload</span>\n    <span class=\"k\">def</span> <span class=\"nf\">upload</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file</span><span class=\"p\">:</span> <span class=\"n\">Media</span><span class=\"o\">.</span><span class=\"n\">File</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Body</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">META</span><span class=\"p\">[</span><span class=\"s1\">'CONTENT_TYPE'</span><span class=\"p\">])</span>\t<span class=\"c1\"># application/octet-stream</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">post</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">:</span> <span class=\"n\">FormSchema</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Body</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">META</span><span class=\"p\">[</span><span class=\"s1\">'CONTENT_TYPE'</span><span class=\"p\">])</span>\t<span class=\"c1\"># multipart/form-data</span>\n\n    <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">put</span>\n    <span class=\"k\">def</span> <span class=\"nf\">batch</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">:</span> <span class=\"n\">typing</span><span class=\"o\">.</span><span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">DataSchema</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Body</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">META</span><span class=\"p\">[</span><span class=\"s1\">'CONTENT_TYPE'</span><span class=\"p\">])</span>\t<span class=\"c1\"># application/json</span>\n</pre>\n<p>\u5728UtilMeta\u4e2d\uff0c\u6587\u4ef6\u7684\u7c7b\u578b\u5c31\u662fMedia.File\uff0cMedia\u662f\u5a92\u4f53\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u6587\u4ef6\u7684\u4fdd\u5b58\uff0c\u6d41\u5f0f\u5316\uff0c\u4e0b\u8f7d\u7b49\uff0c\u5728upload\u51fd\u6570\u4e2d\u5355\u72ec\u7528File\u7c7b\u578b\u4f5c\u4e3a Body\uff0c\u8868\u793a\u63a5\u53d7\u4e8c\u8fdb\u5236\u6d41\u6587\u4ef6\u4f5c\u4e3a\u8bf7\u6c42\u4f53\uff0c\u76f8\u5e94\u7684Content-Type\u4e5f\u662f\u4e3aapplication/octet-stream\uff0c\u800cpost\u51fd\u6570\u7528FormSchema\u4f5c\u4e3a\u8bf7\u6c42\u4f53\uff0cFormSchema\u7ee7\u627f\u81eaDataSchema\uff0c\u7531\u4e8e\u5176\u4e2d\u65e2\u6709\u666e\u901a\u6570\u636e\u53c8\u6709\u6587\u4ef6\uff0c\u6240\u4ee5\u5e94\u8be5\u4f7f\u7528 multipart/form-data\u4f5c\u4e3a\u63d0\u4ea4\u6570\u636e\u7c7b\u578b\uff0cbatch\u51fd\u6570\u662f\u4e00\u4e2a\u6279\u91cf\u66f4\u65b0\u63a5\u53e3\uff0c\u4f7f\u7528List[Schema]\u4f5c\u4e3a\u7c7b\u578b\u63d0\u793a\u8868\u793a\u63a5\u53d7\u4e00\u4e2ajson\u6570\u7ec4\u4f5c\u4e3a\u8bf7\u6c42\u6570\u636e\uff0c\u800c\u5bf9\u5e94\u7684Schema\u4e2d\u4e0d\u5b58\u5728\u6587\u4ef6\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528json\u683c\u5f0f\u7684\u6570\u636e</p>\n<h4>2.5 \u540c\u65f6\u5728URL\uff0cQueryString\u548c\u8bf7\u6c42\u4f53\u4e2d\u4f20\u9012\u6570\u636e</h4>\n<p>\u5bf9\u4e8e\u8fd9\u79cd\u590d\u6742\u7684\u60c5\u51b5\uff0cUtilMeta\u91c7\u7528<strong>\u6807\u8bc6\u548c\u6392\u9664</strong>\u7684\u65b9\u6cd5\u5bf9\u53c2\u6570\u8fdb\u884c\u8bf7\u6c42\u7c7b\u578b\u7684\u5212\u5206\uff0c\u9996\u5148\u786e\u5b9a\u7684URL\u4e2d\u7684\u53c2\u6570\uff0c\u5b83\u4eec\u7684\u987a\u5e8f\u548c\u5173\u952e\u5b57\u5728\u51fd\u6570\u4e2d\u5f97\u5230\u6807\u8bc6\uff0c\u5269\u4f59\u7684\u53c2\u6570\u9ed8\u8ba4\u5c06\u4f5c\u4e3aQueryString\u4e2d\u7684\u53c2\u6570\uff0c\u9664\u975e\u6709\u4e00\u4e2a\u53c2\u6570\u5728\u9ed8\u8ba4\u503c\u4e2d\u58f0\u660e\u81ea\u5df1\u662f\u8bf7\u6c42\u4f53\uff08Schema.Body\uff09, \u5176\u5b9e\u81f3\u6b64\u5df2\u7ecf\u56ca\u62ec\u4e86\u6240\u6709\u53ef\u80fd\u6027\uff0c\u4f46\u662f\u4e3a\u4e86\u4f7f\u53c2\u6570\u5b9a\u4e49\u66f4\u52a0\u65b9\u4fbf\uff0c\u518d\u5f15\u5165\u4e00\u4e2aSchema.Param\u7c7b\uff0c\u7528\u4e8e\u6807\u8bb0\u4e00\u4e2a\u51fd\u6570\u53c2\u6570\u4e3aQureyString\u5b57\u5178\uff0c\u5e76\u4e14\u53ef\u4ee5\u5e94\u7528Schema\u7c7b\u578b\u63d0\u793a\uff0c\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50</p>\n<pre><span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">post</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">'</span><span class=\"si\">{0}</span><span class=\"s1\">/</span><span class=\"si\">{1}</span><span class=\"s1\">/</span><span class=\"si\">{level}</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">year</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">2000</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">2020</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">),</span>\n            <span class=\"n\">month</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">),</span>\n            <span class=\"n\">level</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">choices</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'INFO'</span><span class=\"p\">,</span> <span class=\"s1\">'WARN'</span><span class=\"p\">,</span> <span class=\"s1\">'ERROR'</span><span class=\"p\">],</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">),</span>\n            <span class=\"n\">status</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">200</span><span class=\"p\">),</span>\n            <span class=\"n\">time</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">'default time'</span><span class=\"p\">),</span>\n            <span class=\"n\">data</span><span class=\"p\">:</span> <span class=\"n\">DataSchema</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Body</span><span class=\"p\">):</span>\n</pre>\n<p>\u5728\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cyear, month\u662fURL\u4e2d\u7684\u987a\u5e8f\u53c2\u6570\uff0clevel\u662fURL\u4e2d\u7684\u5177\u540d\u53c2\u6570\uff0cdata\u6807\u8bc6\u4e3aBody\uff0c\u5c06\u4f20\u5165\u88abDataSchema\u5e8f\u5217\u5316\u7684\u8bf7\u6c42\u4f53\u6570\u636e\uff0c\u5269\u4f59\u7684status\u548ctime\u5c06\u4f5c\u4e3aQueryString\u6570\u636e</p>\n<p>\u5bf9\u5e94\u7684\uff0c\u5982\u679c\u4f60\u5b9a\u4e49\u4e86\u4e00\u4e2aSchema.Param\u53c2\u6570\uff0c\u4f59\u4e0b\u7684\u53c2\u6570\u5c06\u4f5c\u4e3a\u8bf7\u6c42\u4f53\u7684\u6a21\u677f</p>\n<pre><span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">put</span>\n    <span class=\"k\">def</span> <span class=\"nf\">update</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">query</span><span class=\"p\">:</span> <span class=\"n\">QuerySchema</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Param</span><span class=\"p\">,</span>\n               <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">)),</span>\n               <span class=\"n\">desc</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"mi\">200</span><span class=\"p\">),</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">''</span><span class=\"p\">),</span>\n               <span class=\"n\">image</span><span class=\"p\">:</span> <span class=\"n\">Media</span><span class=\"o\">.</span><span class=\"n\">File</span><span class=\"p\">,</span>\n               <span class=\"o\">**</span><span class=\"n\">others</span>\n              <span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">META</span><span class=\"p\">[</span><span class=\"s1\">'CONTENT_TYPE'</span><span class=\"p\">])</span>  <span class=\"c1\"># application/json</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">d</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"p\">:</span>\n            <span class=\"n\">d</span><span class=\"o\">.</span><span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"s1\">'changed title'</span>\n        <span class=\"k\">return</span> <span class=\"n\">data</span>\n</pre>\n<p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cquery\u53c2\u6570\u5c06\u4f20\u5165\u5e8f\u5217\u5316\u7684QueryString\u7684\u952e\u503c\u5bf9\u6570\u636e\uff0c\u4f59\u4e0b\u7684name, desc, image\u53c2\u6570\u5c06\u4f5c\u4e3a\u8bf7\u6c42\u4f53\u6a21\u677f\uff0c\u8bf7\u6c42\u4f53\u5e94\u8be5\u4e3a\u4e00\u4e2amultipart/form-data\u7c7b\u578b\u7684\u643a\u5e26\u6587\u4ef6\u7684\u8868\u5355\uff0c\u5728\u4e00\u822c\u7684Schema\u6216\u51fd\u6570\u53c2\u6570\u4e2d\uff0c\u5982\u679c\u6570\u636e\u51fa\u73b0\u4e86\u6a21\u677f\u4e4b\u5916\u7684\u952e\uff0c\u8be5\u952e\u503c\u5bf9\u5c06\u4e0d\u4f1a\u5f97\u5230\u4fdd\u7559\uff0c\u5982\u679c\u9700\u8981\u4fdd\u7559\u4e0b\u6765\u6240\u6709\u7684\u952e\u503c\u5bf9\u6570\u636e\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u53c2\u6570\u540e\u6dfb\u52a0\u4e00\u4e2a **kwargs \u53cc\u661f\u53f7\u7684\u952e\u503c\u53d8\u91cf\uff0c\u8868\u793a\u51fd\u6570\u5e0c\u671b\u5bb9\u7eb3\u66f4\u591a\u7684\u53c2\u6570\uff0c\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u8868\u793a\u5982\u679c\u8bf7\u6c42\u4f53\u8868\u5355\u6709\u989d\u5916\u7684\u6570\u636e\uff0c\u4e5f\u4f1a\u4f20\u5165others\u4e2d</p>\n<p>\u5982\u679c\u5e0c\u671b\u5728Schema\u4e2d\u4e5f\u4fdd\u7559\u989d\u5916\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5728Schema\u7c7b\u4e2d\u8bbe\u7f6e __config__ \u53d8\u91cf\uff0c\u8bbe\u7f6eexcess_preserve=True</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">FormSchema</span><span class=\"p\">(</span><span class=\"n\">Schema</span><span class=\"p\">):</span>\n    <span class=\"n\">__config__</span> <span class=\"o\">=</span> <span class=\"n\">Schema</span><span class=\"o\">.</span><span class=\"n\">Config</span><span class=\"p\">(</span><span class=\"n\">excess_preserve</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n    <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">))</span>\n    <span class=\"n\">desc</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"mi\">200</span><span class=\"p\">))</span>\n    <span class=\"n\">image</span><span class=\"p\">:</span> <span class=\"n\">Media</span><span class=\"o\">.</span><span class=\"n\">File</span>\n</pre>\n<p>\u81f3\u6b64\uff0c\u6240\u6709\u65b9\u6cd5\u7684\u6240\u6709\u60c5\u51b5\u90fd\u5df2\u8986\u76d6\uff0c\u4e5f\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u8fc7\u4e8e\u590d\u6742\u7684\u53c2\u6570\u65b9\u6848\uff0c\u4e00\u822c1~2\u79cd\u914d\u5408\u5c31\u8db3\u591f\u4e86</p>\n<h4>2.7  Rule\u7ec4\u4ef6: \u89c4\u5219\u5b9a\u4e49\u5668\uff0c\u7c7b\u578b\u5236\u9020\u673a</h4>\n<p>\u4e4b\u524d\u6211\u4eec\u4ecb\u7ecd\u4e86\u5982\u4f55\u5229\u7528Schema\u7c7b\u548c\u7c7b\u578b\u63d0\u793a\u5c06\u8bf7\u6c42\u6570\u636e\u89e3\u6790\u5230\u51fd\u6570\u53c2\u6570\u4e2d\uff0c\u5728\u5176\u4e2d\u6211\u4eec\u5df2\u7ecf\u89c1\u5230\u4e86\u7528\u4e8e\u5b9a\u4e49\u53c2\u6570\u89c4\u5219\u9650\u5236\u7684Rule\u7ec4\u4ef6\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u8be6\u7ec6\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u91cd\u8981\u7684\u7ec4\u4ef6</p>\n<p>Rule\u7ec4\u4ef6\u8d1f\u8d23\u53c2\u6570\u7684\u89c4\u5219\u9650\u5236\uff0c\u5176\u4e2d\u53ef\u4ee5\u7075\u6d3b\u7684\u4ece<strong>\u7c7b\u578b\uff0c\u503c\uff0c\u957f\u5ea6\uff0c\u6b63\u5219\u548c\u8868\u8fbe\u5f0f</strong>\u7b49\u591a\u4e2a\u65b9\u9762\u5b9a\u4e49\u89c4\u5219\uff0c\u800c\u4e14\uff0cRule\u7ec4\u4ef6\u8fd8\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a <strong>\u201c\u7c7b\u578b\u5236\u9020\u673a\u201d</strong> \uff0c\u6240\u6709Rule\u7ec4\u4ef6\u7684\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u770b\u4f5c\u4e00\u79cd\u7279\u6b8a\u7c7b\u578b\uff0c\u4f60\u53ef\u4ee5\u8c03\u7528\u5b83\u7684__call__\u65b9\u6cd5\u5c06\u4e00\u4e2a\u6570\u636e\u8f6c\u6362\u4e3a<strong>\u7b26\u5408\u5176\u89c4\u5219</strong>\u7684\u6570\u636e\u6216\u8005\u62a5\u9519\uff0c\u5c31\u50cf<strong>\u7c7b\u578b\u8f6c\u5316</strong>\u4e00\u6837</p>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">r</span><span class=\"p\">(</span><span class=\"mi\">123</span><span class=\"p\">)</span>\n<span class=\"s1\">'123'</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">r</span><span class=\"p\">(</span><span class=\"s1\">'abc1234'</span><span class=\"p\">)</span>\n\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"n\">abc1234</span> <span class=\"n\">length</span> <span class=\"ow\">is</span> <span class=\"n\">larger</span> <span class=\"n\">than</span> <span class=\"n\">max_length</span> <span class=\"mi\">6</span>\n</pre>\n<p>\u5229\u7528\u8fd9\u70b9\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528Rule\u4f5c\u6a21\u677f\u7684\u7c7b\u578b\u63d0\u793a\uff0c\u5b83\u4f1a\u5c06\u8bf7\u6c42\u6570\u636e\u8f6c\u4e3a\u7b26\u5408\u8981\u6c42\u7684\u683c\u5f0f\u6216\u62a5\u9519\uff08\u53ef\u4ee5\u5728API\u4e2d\u901a\u8fc7BadRequest\u63a5\u4f4f\u8fd9\u4e2a\u9519\u8bef\u5e76\u4e14\u8fdb\u884c\u5904\u7406\u8fd4\u56de\uff09</p>\n<p>\u4f46\u662f\u5728\u6a21\u677f\u5b9a\u4e49\u4e2d\uff0c\u5982\u679c\u76f4\u63a5\u7528Rule\u5b9e\u4f8b\u53bb\u5b9a\u4e49\u7c7b\u578b\uff0c\u7531\u4e8epython\u6807\u51c6\u4e0d\u652f\u6301\uff0c\u65e0\u6cd5\u83b7\u5f97\u7c7b\u578b\u63d0\u793a\u5e26\u6765\u7684\u4fbf\u5229\uff0c\u6240\u4ee5\uff0c\u53ef\u4ee5\u6298\u8877\u91c7\u53d6\u8fd9\u79cd\u65b9\u6cd5</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">DataSchema</span><span class=\"p\">(</span><span class=\"n\">Schema</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"nf\">name_validator</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s1\">'valid'</span><span class=\"p\">)</span>\n\n    <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">),</span> <span class=\"n\">exp</span><span class=\"o\">=</span><span class=\"n\">name_validator</span><span class=\"p\">)</span>\n    <span class=\"n\">password</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">reg</span><span class=\"o\">=</span><span class=\"s1\">'[0-9a-zA-Z]{6, 20}'</span><span class=\"p\">)</span>\n    <span class=\"n\">values</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">))</span>\n</pre>\n<p>\u8fd9\u6837\uff0c\u65e2\u96c6\u4e2d\u5b9a\u4e49\u4e86\u53c2\u6570\u7c7b\u578b\u548c\u9650\u5236\uff0c\u7528\u8fd9\u6837\u7684\u7c7b\u4f5c\u7c7b\u578b\u63d0\u793a\u4e5f\u53ef\u4ee5\u83b7\u5f97\u826f\u597d\u65b9\u4fbf\u7684\u6548\u679c\uff0cSchema\u7c7b\u4f1a\u81ea\u52a8\u8bc6\u522b\u53d8\u91cf\u5bf9\u5e94\u7684Rule\uff0c\u5e76\u4e14\u5c06\u53d8\u91cf\u7684\u7c7b\u578b\u63d0\u793a\u4f5c\u4e3a\u4e00\u6761\u89c4\u5219\u63d2\u5165\u5230Rule\u4e2d</p>\n<p><strong>Rule\u8be6\u7ec6\u7684\u53c2\u6570\u89c4\u5219\uff1a</strong></p>\n<ul>\n<li><strong>gt / ge / lt / le</strong> : \u8fd9\u56db\u4e2a\u53c2\u6570\u5206\u522b\u4e3a &gt;, &gt;=, &lt;, &lt;=\uff0c\u503c\u53ef\u4ee5\u4e3a\u4e00\u4e2a int, float, str\uff0c\u5982\u679c\u540c\u65f6\u8bbe\u7f6e\u4e86\u5927\u4e8e\u7684\u503c\uff08\u6700\u5c0f\u503c\uff09\u548c\u5c0f\u4e8e\u7684\u503c\uff08\u6700\u5927\u503c\uff09\uff0c\u5219\u6700\u5927\u503c\u4e0d\u5f97\u5c0f\u4e8e\u6700\u5c0f\u503c</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">gt</span><span class=\"o\">=</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"n\">le</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"ne\">AssertionError</span><span class=\"p\">:</span> <span class=\"n\">Rule</span> <span class=\"n\">lt</span><span class=\"o\">/</span><span class=\"n\">le</span> <span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"n\">must</span> <span class=\"o\">&gt;</span> <span class=\"n\">gt</span><span class=\"o\">/</span><span class=\"n\">ge</span> <span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">ge</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span> <span class=\"n\">lt</span><span class=\"o\">=</span><span class=\"mf\">1.0</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'0.2'</span><span class=\"p\">)</span>\n<span class=\"mf\">0.2</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"mf\">1.0</span><span class=\"o\">&gt;</span> <span class=\"ow\">not</span> <span class=\"n\">less</span> <span class=\"n\">than</span> <span class=\"mf\">1.0</span>\n</pre>\n<ul>\n<li><strong>val</strong> : \u6570\u636e\u5fc5\u987b<strong>\u7b49\u4e8e</strong>val\u53c2\u6570\u7684\u503c\uff0c\u5e38\u7528\u4e8e\u5bc6\u94a5\u6216token\u7b49\u7684\u9a8c\u8bc1</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"o\">=</span><span class=\"s1\">'MySecretKey'</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'AnyOtherValue'</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"s1\">'AnyOtherValue'</span><span class=\"o\">&gt;</span> <span class=\"ow\">not</span> <span class=\"n\">equal</span> <span class=\"n\">to</span> <span class=\"s1\">'MySecretKey'</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'MySecretKey'</span><span class=\"p\">)</span>\n<span class=\"s1\">'MySecretKey'</span>\n</pre>\n<ul>\n<li><strong>choices</strong>\uff1a\u6570\u636e\u7684\u503c\u5fc5\u987b\u4e3achoices\u4e2d\u7684<strong>\u6210\u5458</strong></li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">choices</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'INFO'</span><span class=\"p\">,</span> <span class=\"s1\">'WARN'</span><span class=\"p\">,</span> <span class=\"s1\">'ERROR'</span><span class=\"p\">])</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'DEBUG'</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"s1\">'DEBUG'</span><span class=\"o\">&gt;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">choices</span> <span class=\"p\">[</span><span class=\"s1\">'ERROR'</span><span class=\"p\">,</span> <span class=\"s1\">'INFO'</span><span class=\"p\">,</span> <span class=\"s1\">'WARN'</span><span class=\"p\">]</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'WARN'</span><span class=\"p\">)</span>\n<span class=\"s1\">'WARN'</span>\n</pre>\n<ul>\n<li><strong>set</strong>: \u6570\u636e\u5fc5\u987b\u4e3a\u4e00\u4e2a\u5217\u8868\uff0c\u4e14\u4e3aset\u53c2\u6570\u7684<strong>\u5b50\u96c6</strong>, \u975e\u5217\u8868\u6570\u636e\u5c06\u4f1a\u8f6c\u5316\u4e3a\u4e00\u4e2a\u96c6\u5408\uff0c\u5982\u679c\u9700\u8981\u5c06\u6570\u636e\u8f6c\u5316\u4e3a\u5176\u4ed6\u7684\u7c7b\u578b\uff08tuple/list\uff09\uff0c\u9700\u8981\u4f7f\u7528type\u53c2\u6570</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">set</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'A'</span><span class=\"p\">,</span> <span class=\"s1\">'B'</span><span class=\"p\">,</span> <span class=\"s1\">'C'</span><span class=\"p\">,</span> <span class=\"s1\">'D'</span><span class=\"p\">})</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'B'</span><span class=\"p\">)</span>\n<span class=\"p\">{</span><span class=\"s1\">'B'</span><span class=\"p\">}</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">([</span><span class=\"s1\">'A'</span><span class=\"p\">,</span> <span class=\"s1\">'E'</span><span class=\"p\">])</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"p\">{</span><span class=\"s1\">'E'</span><span class=\"p\">,</span> <span class=\"s1\">'A'</span><span class=\"p\">}</span><span class=\"o\">&gt;</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"n\">subset</span> <span class=\"n\">of</span> <span class=\"p\">[</span><span class=\"s1\">'A'</span><span class=\"p\">,</span> <span class=\"s1\">'B'</span><span class=\"p\">,</span> <span class=\"s1\">'C'</span><span class=\"p\">,</span> <span class=\"s1\">'D'</span><span class=\"p\">]</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">({</span><span class=\"s1\">'B'</span><span class=\"p\">,</span> <span class=\"s1\">'D'</span><span class=\"p\">})</span>\n<span class=\"p\">{</span><span class=\"s1\">'B'</span><span class=\"p\">,</span> <span class=\"s1\">'D'</span><span class=\"p\">}</span>\n</pre>\n<ul>\n<li><strong>type</strong>: \u53c2\u6570\u7684\u7c7b\u578b\u5c06\u4f1a\u88ab\u8f6c\u5316\u4e3atype\u53c2\u6570\u7684<strong>\u7c7b\u578b</strong>\uff0c\u5982\u679c\u8f6c\u5316\u5931\u8d25\u4f1a\u629b\u51fa\u9519\u8bef</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">float</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'3.40'</span><span class=\"p\">)</span>\n<span class=\"mf\">3.4</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'abc'</span><span class=\"p\">)</span>\n<span class=\"ne\">TypeError</span><span class=\"p\">:</span> <span class=\"n\">Data</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"s1\">'abc'</span><span class=\"o\">&gt;</span> <span class=\"n\">can</span><span class=\"s1\">'t match or transform to type: &lt;class '</span><span class=\"nb\">float</span><span class=\"s1\">'&gt;, </span>\n <span class=\"k\">with</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">could</span> <span class=\"ow\">not</span> <span class=\"n\">convert</span> <span class=\"n\">string</span> <span class=\"n\">to</span> <span class=\"nb\">float</span><span class=\"p\">:</span> <span class=\"s1\">'abc'</span>\n</pre>\n<ul>\n<li><strong>union</strong>: \u5bf9\u5e94typing\u4e2d\u7684Union\uff0c\u63a5\u53d7\u4e00\u4e2a\u7c7b\u578b\u7684\u5143\u7ec4\uff0c\u5982\u679c\u6570\u636e\u7b26\u5408\u5176\u4e2d\u7684\u4e00\u4e2a\u7c7b\u578b\u5219\u8fd4\u56de\uff0c\u5426\u5219\u5c06\u4f9d\u6b21\u8fdb\u884c\u8f6c\u5316\uff0c\u5ffd\u7565\u8f6c\u5316\u5931\u8d25\uff0c\u5982\u679c\u80fd\u591f\u6210\u529f\u8f6c\u5316\u5219\u8fd4\u56de\u8f6c\u5316\u7684\u7ed3\u679c\uff0c\u53ea\u6709\u5f53\u5bf9\u5176\u4e2d\u6240\u6709\u7684\u7c7b\u578b\u8f6c\u5316\u90fd\u5931\u8d25\u7684\u60c5\u51b5\u4f1a\u629b\u51fa\u9519\u8bef\uff0cunion\u4e2d\u7684\u987a\u5e8f\u4e5f\u5f88\u91cd\u8981\uff0c\u7531\u4e8e\u7c7b\u578b\u8f6c\u5316\u662f\u6309\u5176\u4e2d\u987a\u5e8f\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u5c06\u66f4\u671f\u671b\u7684\u7c7b\u578b\u9760\u524d\u6392\u5217\uff0c\u800c\u4e14\u7531\u4e8e\u5728python\u4e2d\u6240\u6709\u7c7b\u578b\u90fd\u53ef\u4ee5\u8f6c\u4e3astr\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u5e0c\u671b\u629b\u51fa\u9519\u8bef\uff0c\u53ef\u4ee5\u5c06str\u653e\u5728\u6700\u540e</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">union</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">([</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">])</span>\n<span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">]</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"mi\">3</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'str'</span><span class=\"p\">)</span>\n<span class=\"p\">[</span><span class=\"s1\">'str'</span><span class=\"p\">]</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">union</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'abc'</span><span class=\"p\">)</span>\n<span class=\"ne\">TypeError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"s1\">'abc'</span><span class=\"o\">&gt;</span> <span class=\"n\">can</span><span class=\"s1\">'t convert to any type of union: (&lt;class '</span><span class=\"nb\">float</span><span class=\"s1\">'&gt;, &lt;class '</span><span class=\"nb\">int</span><span class=\"s1\">'&gt;)</span>\n</pre>\n<ul>\n<li><strong>temp</strong>: \u63d0\u4f9b\u4e00\u4e2a\u5b57\u5178/\u5217\u8868/\u5143\u7ec4 <strong>\u6a21\u677f</strong>\uff0c\u6570\u636e\u5fc5\u987b\u6ee1\u8db3\u76f8\u540c\u7684\u7ed3\u6784\uff0c\u5b83\u7684\u89e3\u6790\u89c4\u5219\u4e0eSchema\u76f8\u540c</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">temp</span><span class=\"o\">=</span><span class=\"p\">[{</span><span class=\"s1\">'id'</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"s1\">'name'</span><span class=\"p\">:</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">),</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)}])</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">[{</span><span class=\"s1\">'id'</span><span class=\"p\">:</span> <span class=\"s1\">'3'</span><span class=\"p\">},</span> <span class=\"p\">{</span><span class=\"s1\">'id'</span><span class=\"p\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"s1\">'name'</span><span class=\"p\">:</span> <span class=\"s1\">'MyName'</span><span class=\"p\">}]</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n<span class=\"p\">[{</span><span class=\"s1\">'id'</span><span class=\"p\">:</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"s1\">'name'</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">},</span> <span class=\"p\">{</span><span class=\"s1\">'id'</span><span class=\"p\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"s1\">'name'</span><span class=\"p\">:</span> <span class=\"s1\">'MyName'</span><span class=\"p\">}]</span>\n</pre>\n<p>\u53ef\u4ee5\u770b\u5230\u4f20\u5165\u7684\u5217\u8868\u6570\u636e\u5df2\u7ecf\u53d1\u751f\u4e86\u8f6c\u5316\uff0c\u5b57\u5178\u5143\u7d20\u5bf9\u5e94\u7684\u952e\u503c\u4e5f\u8fdb\u884c\u4e86\u7c7b\u578b\u8f6c\u5316\uff0c\u7f3a\u5931\u7684\u952e\u88ab\u9ed8\u8ba4\u503c\u8865\u9f50\uff0c\u4f46\u5f53\u65e0\u6cd5\u8fdb\u884c\u8fd9\u4e9b\u8f6c\u5316\u65f6\u5c31\u4f1a\u629b\u51fa\u9519\u8bef\uff0c\u6a21\u677f\u7684\u5177\u4f53\u89e3\u6790\u89c4\u5219\u5c06\u5728\u4e0b\u4e00\u8282\u4ecb\u7ecd</p>\n<ul>\n<li><strong>len</strong>:  \u9650\u5236\u6570\u636e\u7684<strong>\u957f\u5ea6</strong>\uff0clen\u53c2\u6570\u7684\u503c\u5982\u679c\u4e3a\u4e00\u4e2a\u6574\u6570\uff0c\u5219\u8868\u793a\u6570\u636e\u7684\u957f\u5ea6\u5fc5\u987b\u7b49\u4e8e\u8fd9\u4e2a\u503c\uff0c\u5982\u679c\u4e3a\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c\u5219\u89c4\u5b9a\u6570\u636e\u7684\u6700\u5927\u6700\u5c0f\u957f\u5ea6\uff0c\u6570\u636e\u53ef\u4ee5\u662f\u4efb\u610f\u7c7b\u578b\uff0c\u6ca1\u6709 __len__\u5c5e\u6027\u7684\u6570\u636e\u5c06\u4f1a\u4f5c\u4e3a\u5b57\u7b26\u4e32\u68c0\u9a8c\u957f\u5ea6</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"mf\">3.14</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"mf\">3.14</span><span class=\"o\">&gt;</span> <span class=\"k\">with</span> <span class=\"n\">length</span> <span class=\"mi\">4</span> <span class=\"ow\">not</span> <span class=\"n\">match</span> <span class=\"n\">the</span> <span class=\"n\">length</span> <span class=\"mi\">3</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">([</span><span class=\"s1\">'A'</span><span class=\"p\">,</span><span class=\"s1\">'B'</span><span class=\"p\">,</span><span class=\"s1\">'C'</span><span class=\"p\">])</span>\n<span class=\"p\">[</span><span class=\"s1\">'A'</span><span class=\"p\">,</span> <span class=\"s1\">'B'</span><span class=\"p\">,</span> <span class=\"s1\">'C'</span><span class=\"p\">]</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'12345'</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"s1\">'12345'</span><span class=\"o\">&gt;</span> <span class=\"k\">with</span> <span class=\"n\">length</span> <span class=\"mi\">5</span> <span class=\"ow\">is</span> <span class=\"n\">larger</span> <span class=\"n\">than</span> <span class=\"n\">max_length</span> <span class=\"mi\">4</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'r'</span><span class=\"p\">)</span>\n<span class=\"s1\">'r'</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'A Very Long String Can Pass the &lt;None&gt; max_length'</span><span class=\"p\">)</span>\n<span class=\"s1\">'A Very Long String Can Pass the &lt;None&gt; max_length'</span>\n</pre>\n<p>\u53ef\u4ee5\u770b\u5230\u7528\u4e8c\u5143\u7ec4\u8bbe\u7f6e\u957f\u5ea6\u8fb9\u754c\uff0c\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u53ef\u4ee5\u7b49\u4e8e\u8fb9\u754c\u4f46\u4e0d\u80fd\u8d85\u8fc7\u8fb9\u754c\uff0c\u5982\u679c\u8fb9\u754c\u503c\u4e3aNone\u5219\u8868\u793a\u4e0d\u8bbe\u7f6e\u8fb9\u754c\uff0c\u957f\u5ea6\u9650\u5236\u4e0d\u80fd\u4e3a\u8d1f\u6570</p>\n<ul>\n<li><strong>reg</strong>: \u6570\u636e\u5fc5\u987b\u5b8c\u5168\u5339\u914d\u8fd9\u4e2a\u53c2\u6570\u7684<strong>\u6b63\u5219</strong>\u8868\u8fbe\u5f0f</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">reg</span><span class=\"o\">=</span><span class=\"s1\">'([A-Za-z0-9]+)'</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'abcABC123'</span><span class=\"p\">)</span>\n<span class=\"s1\">'abcABC123'</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'abc@123'</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"s1\">'abc@123'</span><span class=\"o\">&gt;</span> <span class=\"ow\">not</span> <span class=\"n\">match</span> <span class=\"n\">the</span> <span class=\"n\">regex</span> <span class=\"s1\">'([A-Za-z0-9]+)'</span>\n</pre>\n<ul>\n<li><strong>exp</strong>: \u6570\u636e\u7684<strong>\u9a8c\u8bc1\u5668\u51fd\u6570</strong>\uff0c\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2acallable\uff0c\u5305\u62eclambda\u8868\u8fbe\u5f0f\uff0c\u8fd9\u4e2a\u51fd\u6570\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff0c\u5c06\u4f1a\u88ab\u4f20\u5165\u5f85\u9a8c\u8bc1\u6570\u636e\uff0c\u5982\u679c\u51fd\u6570\u629b\u51fa\u9519\u8bef\u6216\u8005\u8fd4\u56deFalse\u5219\u9a8c\u8bc1\u5931\u8d25\uff0c\u8fd4\u56deTrue\u8868\u793a\u9a8c\u8bc1\u6210\u529f</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">exp</span><span class=\"o\">=</span><span class=\"k\">lambda</span> <span class=\"n\">v</span><span class=\"p\">:</span> <span class=\"n\">v</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s1\">'@'</span><span class=\"p\">))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"mi\">123</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"n\">validate</span> <span class=\"n\">failed</span> <span class=\"k\">with</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"s1\">'int'</span> <span class=\"nb\">object</span> <span class=\"n\">has</span> <span class=\"n\">no</span> <span class=\"n\">attribute</span> <span class=\"s1\">'startswith'</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'value'</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"n\">validate</span> <span class=\"n\">failed</span> <span class=\"k\">with</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"s1\">'value'</span><span class=\"o\">&gt;</span> <span class=\"ow\">not</span> <span class=\"n\">match</span> <span class=\"n\">the</span> <span class=\"n\">expression</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"s1\">'@utilmeta'</span><span class=\"p\">)</span>\n<span class=\"s1\">'@utilmeta'</span>\n</pre>\n<p>\u901a\u8fc7exp\u53c2\u6570\uff0c\u4f60\u53ef\u4ee5\u5b9a\u4e49\u4efb\u610f\u590d\u6742\u7684\u9a8c\u8bc1\u903b\u8f91</p>\n<ul>\n<li><strong>null</strong>: \u51b3\u5b9a\u6570\u636e\u80fd\u5426\u4e3aNone\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e3aFalse\uff0c\u5982\u679c\u8bbe\u7f6enull=True\uff0c\u5219\u9488\u5bf9None\u7684\u6570\u636e\u5c06<strong>\u4e0d\u518d\u9a8c\u8bc1\u540e\u7eed\u89c4\u5219</strong>\u800c\u76f4\u63a5\u8fd4\u56de</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"o\">=</span><span class=\"mi\">2020</span><span class=\"p\">,</span> <span class=\"n\">null</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n<span class=\"kc\">None</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"mi\">2019</span><span class=\"p\">)</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span><span class=\"mi\">2019</span><span class=\"o\">&gt;</span> <span class=\"ow\">not</span> <span class=\"n\">equal</span> <span class=\"n\">to</span> <span class=\"mi\">2020</span>\n</pre>\n<ul>\n<li><strong>require</strong>: \u6570\u636e\u662f\u5426\u4e3a<strong>\u5fc5\u9700</strong>\u7684\uff0c\u9ed8\u8ba4\u4e3aTrue\uff0c\u65e2Rule\u5bf9\u5e94\u7684\u952e\u6216\u4f4d\u7f6e\u5fc5\u987b\u51fa\u73b0\u5728\u8bf7\u6c42\u6570\u636e\u4e2d\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff0crequire=False\u65f6\u5c06\u4e0d\u4f1a\u62a5\u9519\uff0c\u5982\u679c\u89c4\u5219\u8bbe\u7f6e\u6709\u9ed8\u8ba4\u503c\uff0c\u5c06\u4f1a\u628a\u9ed8\u8ba4\u503c\u586b\u5165\u76f8\u5e94\u4f4d\u7f6e\uff0c\u5426\u5219\u53c2\u6570\u5c06\u4e3a\u7a7a\u7f3a</li>\n</ul>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">temp</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">require</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">),</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">require</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">([</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">])</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">([])</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"n\">required</span> <span class=\"n\">position</span> <span class=\"mi\">0</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">data</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">temp</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">''</span><span class=\"p\">),</span> <span class=\"nb\">str</span><span class=\"p\">))</span>\n<span class=\"ne\">AssertionError</span><span class=\"p\">:</span> <span class=\"nb\">tuple</span> <span class=\"n\">template</span> <span class=\"n\">must</span> <span class=\"n\">order</span> <span class=\"n\">by</span> <span class=\"n\">required</span> <span class=\"o\">-&gt;</span> <span class=\"n\">defaulted</span> <span class=\"o\">-&gt;</span> <span class=\"n\">omitted</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">temp</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">''</span><span class=\"p\">),</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">require</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">([</span><span class=\"mi\">3</span><span class=\"p\">])</span>\n<span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"s1\">''</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span> <span class=\"o\">=</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">temp</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'id'</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"s1\">'name'</span><span class=\"p\">:</span> <span class=\"n\">Rule</span><span class=\"p\">(</span><span class=\"n\">require</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)})</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">rule</span><span class=\"p\">({</span><span class=\"s1\">'id'</span><span class=\"p\">:</span><span class=\"mi\">2</span><span class=\"p\">})</span>\n<span class=\"p\">{</span><span class=\"s1\">'id'</span><span class=\"p\">:</span> <span class=\"mi\">2</span><span class=\"p\">}</span>\n</pre>\n<p>\u901a\u8fc7\u8fd9\u51e0\u4e2a\u4f8b\u5b50\u6211\u4eec\u80fd\u770b\u5230require\u7684\u89c4\u5f8b\u4e86\uff0cRule\u5b9e\u4f8b\u53ef\u4ee5\u5206\u4e3a\u4e09\u4e2a\u7c7b\u578b</p>\n<ol>\n<li>required: \u4e0d\u8bbe\u7f6edefault\u548crequire\u7684Rule\uff0c\u5fc5\u987b\u51fa\u73b0\u5728\u8bf7\u6c42\u6570\u636e\u4e2d</li>\n<li>defaulted: \u8bbe\u7f6e\u4e86default\u7684Rule\uff0c\u82e5\u8bf7\u6c42\u6570\u636e\u4e2d\u6ca1\u6709\u51fa\u73b0\u5219\u4f1a\u8865\u9f50\uff0c\u6216\u8005\u8bf4\u4e00\u5b9a\u4f1a\u51fa\u73b0\u5728\u8f6c\u5316\u540e\u7684\u6570\u636e\u4e2d</li>\n<li>omiited: \u5373\u5355\u72ec\u8bbe\u7f6erequire=False\u800c\u4e0d\u8bbe\u7f6edefault\u7684Rule\uff0c\u6570\u636e\u4e2d\u6ca1\u6709\u65f6\u4e0d\u4f1a\u8865\u9f50\uff0c\u4e0d\u4e00\u5b9a\u4f1a\u51fa\u73b0\u5728\u8f6c\u5316\u540e\u6570\u636e\u4e2d</li>\n</ol>\n<p>\u5728\u4ee5\u5143\u7ec4\u4f5c\u4e3a\u6a21\u677f\u65f6\uff0c\u6a21\u677f\u4e2d\u7684\u5143\u7d20<strong>\u5fc5\u987b\u4ee5 required -&gt; defaulted -&gt; omitted \u7684\u987a\u5e8f</strong>\u8fdb\u884c\u6392\u5217\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u89e3\u6790\u540e\u7684\u6570\u636e\u4f1a\u51fa\u73b0\u5728\u5bf9\u5e94\u7684\u4f4d\u7f6e\u4e0a\u6216\u88ab\u7701\u7565</p>\n<ul>\n<li><strong>default</strong>: \u8bbe\u7f6e\u53c2\u6570\u7684<strong>\u9ed8\u8ba4\u503c</strong>\uff0c\u5f53\u53c2\u6570\u4e0d\u5b58\u5728\uff08\u5b57\u5178\u6ca1\u6709\u8fd9\u4e2a\u952e\u6216\u5728\u5143\u7ec4\u6a21\u677f\u7684\u957f\u5ea6\u4e4b\u5916\uff09\u65f6\u8865\u5165\u8fd9\u4e2a\u9ed8\u8ba4\u503c\uff0c\u8bbe\u7f6edefault\u540c\u65f6\u4e5f\u4f1a\u4ee4\u89c4\u5219\u7684require=False</li>\n<li><strong>doc</strong>: Rule\u5b9e\u4f8b\u7684<strong>\u6587\u6863</strong>\uff0c\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f1a\u5728\u81ea\u52a8\u751f\u6210\u7684API\u6587\u6863\u4e2d\u8fdb\u884c\u5c55\u793a\uff0c\u53ef\u4ee5\u89e3\u91ca\u8fd9\u4e2a\u89c4\u5219\u7684\u4e00\u4e9b\u8be6\u7ec6\u4fe1\u606f\uff0c\u4e0d\u5bf9\u9a8c\u8bc1\u6570\u636e\u9020\u6210\u5f71\u54cd</li>\n</ul>\n<h4>2.8 \u8fd4\u56de\u6a21\u677f</h4>\n<p>\u6a21\u677f\u7cfb\u7edf\u9664\u4e86\u5305\u62ec\u8bf7\u6c42\u6a21\u677f\u8fd8\u5305\u62ec\u8fd4\u56de\u6a21\u677f\uff0c\u53ea\u4e0d\u8fc7\u8fd4\u56de\u6a21\u677f\u662f\u4f5c\u4e3a\u9762\u5411\u524d\u7aef\u7684\u6587\u6863\u7684\u65b9\u5f0f\uff0c\u9664\u975e\u914d\u7f6estrict=True\uff0c\u5426\u5219\u4e0d\u4f1a\u5bf9\u8fd4\u56de\u4f53\u672c\u8eab\u6570\u636e\u8fdb\u884c\u9a8c\u8bc1\uff0c\u591a\u8fd4\u56de\u6a21\u677f\u4e3b\u8981\u662f\u7528handle\u94a9\u5b50\u7684\u65b9\u5f0f\u89e3\u51b3\uff0c\u5b83\u53ef\u4ee5\u6355\u83b7API\u4e2d\u53d1\u751f\u7684 \u8bf7\u6c42\u9519\u8bef\uff0c\u6743\u9650\u7981\u6b62\uff0c\u670d\u52a1\u9519\u8bef\u7b49\u5e38\u89c1\u9519\u8bef\u5e76\u4e14\u53ef\u4ee5\u7075\u6d3b\u914d\u7f6e\u5b83\u4eec\u7684\u8fd4\u56de\u683c\u5f0f</p>\n<h5>2.8.1 \u8fd4\u56de\u4f53\u7ec4\u4ef6Response</h5>\n<p>\u8fd9\u4e2a\u7ec4\u4ef6\u7528\u4e8e\u5b9a\u4e49\u8fd4\u56de\u4f53\u7684\u6570\u636e\u7ed3\u6784\u548c\u8bf7\u6c42\u5934\u7ed3\u6784\uff0c\u8bf7\u6c42\u4f53Content-Type\u7b49\uff0c\u7531\u4e8e\u4e00\u822c\u7684API\u7cfb\u7edf\u5177\u6709\u8d8b\u4e8e\u7edf\u4e00\u7684\u8fd4\u56de\u683c\u5f0f\uff08\u5982\u8fd4\u56de\u4e00\u4e2ajson\uff0c\u56fa\u5b9a\u7684\u952e\u5bf9\u5e94\u8fd4\u56de\u6570\u636e\uff0c\u62a5\u9519\u4fe1\u606f\uff0c\u64cd\u4f5c\u72b6\u6001\u7b49\uff09\uff0c\u6240\u4ee5\u4ee5\u6a21\u677f\u7684\u65b9\u5f0f\u7edf\u4e00\u5b9a\u4e49\u65e2\u65b9\u4fbf\u5f00\u53d1\uff0c\u53c8\u65b9\u4fbf\u96c6\u6210\u6587\u6863\uff0c\u8fd9\u5c31\u662fResponse\u7ec4\u4ef6\u7684\u4f5c\u7528\uff0c\u5728\u4e4b\u524dQuickStart\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u8fd9\u6837\u7684Response\u5b9e\u4f8b</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">RootAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">Response</span><span class=\"p\">(</span>\n            <span class=\"n\">result_key</span><span class=\"o\">=</span><span class=\"s1\">'result'</span><span class=\"p\">,</span>\n            <span class=\"n\">message_key</span><span class=\"o\">=</span><span class=\"s1\">'msg'</span><span class=\"p\">,</span>\n            <span class=\"n\">action_state_key</span><span class=\"o\">=</span><span class=\"s1\">'state'</span>\n        <span class=\"p\">)</span>\n</pre>\n<p>\u5728API\u7684Meta\u7c7b\u4e2d\u5b9a\u4e49\u7684response\u53d8\u91cf\u4e3a\u4e00\u4e2aResponse\u5b9e\u4f8b\uff0c\u5176\u4e2d\u5b9a\u4e49\u4e86\u8fd4\u56de\u4f53json\u6570\u636e\u7684\u7ed3\u6784\uff0c\u5176\u4e2d\u7684\u53c2\u6570\u542b\u4e49\u662f</p>\n<ul>\n<li><strong>result_key</strong>: \u8fd4\u56de\u7ed3\u679c\u5bf9\u5e94\u7684\u952e\u7684\u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3aNone\uff0c\u5373\u8fd4\u56de\u7ed3\u679c\u76f4\u63a5\u4f5c\u4e3a\u8fd4\u56de\u4f53\u5185\u5bb9\uff0c\u4e0d\u7528json\u8fdb\u884c\u5305\u88f9\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u4e3aNone\u5219\u8bbe\u7f6e\u5176\u4ed6\u7684key\u90fd\u662f\u6ca1\u6709\u610f\u4e49\u7684</li>\n<li><strong>message_key</strong>: \u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u7684\u952e\uff0c\u5728\u6b63\u5e38\u8fd4\u56de\u65f6\u8fd9\u4e2a\u952e\u7684\u503c\u4e3a\u7a7a\uff0c\u5982\u679c\u51fa\u73b0\u8bf7\u6c42\u6570\u636e\u9a8c\u8bc1\u5931\u8d25\u6216\u670d\u52a1\u51fa\u9519\u7b49\u60c5\u51b5\uff0c\u8fd4\u56de\u4f53\u4e2d\u8fd9\u4e2a\u952e\u5bf9\u5e94\u7684\u503c\u5c06\u4f1a\u4e3a\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\u5b57\u7b26\u4e32</li>\n<li><strong>action_state_key</strong>: \u7528\u4e8e\u8868\u793a\u4e1a\u52a1\u903b\u8f91\u6267\u884c\u72b6\u6001\u7684\u952e\uff0c\u6bd4\u5982\u767b\u5f55\u64cd\u4f5c\uff0c\u65e0\u8bba\u767b\u5f55\u6210\u529f\u5931\u8d25\u90fd\u8fd4\u56de200 OK\uff0c\u4f46\u767b\u5f55\u6210\u529f\u6216\u5931\u8d25\u53ef\u4ee5\u4f53\u73b0\u5728\u8fd9\u4e2a\u952e\u5bf9\u5e94\u7684\u503c\u4e0a\uff08\u9ed8\u8ba4\u6210\u529f\u4e3a1\uff0c\u5931\u8d25\u4e3a0\uff09\uff0c\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u66f4\u591a\u7684\u8fd4\u56de\u72b6\u6001\uff0c\u8fd9\u4e2a\u72b6\u6001\u4e0eHTTP\u72b6\u6001\u7801\u65e0\u5173</li>\n<li><strong>http_status_code_key</strong>: \u9ed8\u8ba4\u4e3aNone\uff0c\u4e0d\u5efa\u8bae\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u8fd9\u4e2akey\u5c06\u4f1a\u628a\u771f\u6b63\u7684HTTP\u8fd4\u56de\u7801\u653e\u5728\u8fd9\u4e2a\u952e\u4e0a\uff0c\u800c\u6c38\u8fdc\u8fd4\u56de 200 OK\u7684\u72b6\u6001\u7801</li>\n<li><strong>page_count_key:</strong> \u5206\u9875\u67e5\u8be2\u7684\u9875\u6570\u5bf9\u5e94\u7684\u952e\uff0c\u5728\u5e94\u7528\u5206\u9875Page\u7ec4\u4ef6\u7684\u6a21\u5757\u8fd4\u56de\u7684\u7ed3\u679c\u4e2d\u5c31\u5305\u62ec\u5f53\u524d\u67e5\u8be2\u6761\u4ef6\uff0c\u6bcf\u9875\u884c\u6570\u5bf9\u5e94\u7684\u603b\u9875\u6570\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u524d\u7aef\u5206\u9875\u5668\u7684\u6700\u5927\u503c\uff0c\u8fd9\u6837\u53ef\u4ee5\u628a\u9875\u6570\u548c\u7ed3\u679c\u4f53\u73b0\u5728\u4e00\u4e2a\u8bf7\u6c42\u4e2d\uff0c\u907f\u514d\u91cd\u590d\u67e5\u8be2</li>\n</ul>\n<pre><span class=\"p\">{</span>\n    <span class=\"nt\">\"result\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">\"id\"</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"UtilMeta\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"nt\">\"msg\"</span><span class=\"p\">:</span> <span class=\"s2\">\"\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"state\"</span><span class=\"p\">:</span> <span class=\"mi\">1</span>\n<span class=\"p\">}</span>\n</pre>\n<p>\u4e00\u90e8\u5206\u662f\u6a21\u578b\u5b57\u6bb5\u6a21\u677f\uff08\u5de5\u4f5c\u5728Module\uff09\uff0c\u5b83\u4eec\u7684\u7c7b\u578b\uff0c\u9650\u5236\uff0c\u9ed8\u8ba4\u503c\u7b49\u90fd\u5728\u5b9a\u4e49\u6a21\u578b\u7684\u65f6\u5019\u6307\u5b9a\uff0c\u5728\u6a21\u5757\u5316\u65f6UtilMeta\u63a5\u7ba1\u4e86\u8fd9\u90e8\u5206\u6a21\u677f\u7684\u751f\u6210\uff0c\u53ea\u8981\u5728Field\u4e2d\u58f0\u660e\u6e05\u695a\u5b57\u6bb5\uff0c\u5404\u4e2a\u65b9\u6cd5\u7684\u8bf7\u6c42\u6a21\u677f\u548c\u8fd4\u56de\u6a21\u677f\u5c06\u4f1a\u81ea\u52a8\u751f\u6210\uff0c\u800c\u4e14\u8fd9\u90e8\u5206\u57fa\u672c\u7684\u589e\u5220\u6539\u67e5\u6846\u67b6\u4f1a\u81ea\u52a8\u5904\u7406\uff0c\u4e5f\u65e0\u9700\u7f16\u5199\u903b\u8f91\u4ee3\u7801\u548c\u7c7b\u578b\u63d0\u793a\uff0c\u5f00\u53d1\u8005\u5982\u679c\u9700\u8981\u66f4\u5b9a\u4e49\u590d\u6742\u7684\u9650\u5236\u6216\u989d\u5916\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528<strong>\u6ce8\u5165</strong>\u7684\u65b9\u5f0f\u53ea\u5f71\u54cd\u76ee\u6807\u53c2\u6570</p>\n<p>\u53e6\u4e00\u90e8\u5206\u662fAPI\u4e0a\u5904\u7406\u5355\u5143\u7684\u53c2\u6570\u6a21\u677f\uff0c\u8fd9\u4e9b\u53c2\u6570\u6ca1\u6709\u6a21\u578b\u4e0e\u4e4b\u5bf9\u5e94\uff0c\u6240\u4ee5\u5b9a\u4e49\u6a21\u677f\u7684\u5de5\u4f5c\u5e94\u8be5\u7531\u5f00\u53d1\u8005\u6839\u636e\u5177\u4f53\u4e1a\u52a1\u903b\u8f91\u6765\u5b8c\u6210\uff0cUtilMeta\u63d0\u4f9b\u4e00\u4e2a\u540d\u4e3aSchema\u7684\u7ec4\u4ef6\u4ee5type hint\u7684\u65b9\u5f0f\u5e2e\u52a9\u4f60\u5b9a\u4e49\u6a21\u677f\uff0c\u8fd9\u662f\u4e00\u4e2a\u7ee7\u627f\u81eadict\u7684\u7c7b\uff0c\u62e5\u6709\u5b57\u5178\u7684\u5168\u90e8\u5c5e\u6027\uff0c\u5f53\u4f60\u7684\u51fd\u6570\u4f7f\u7528Schema\u5b50\u7c7b\u4f5c\u4e3atype_hint\u7684\u65f6\u5019\uff0c\u5bf9\u5e94\u8bf7\u6c42\u7684\u6570\u636e\u5c06\u4f1a\u81ea\u52a8\u5e8f\u5217\u5316\u4e3a\u8fd9\u4e2a\u7c7b\u5143\u7d20\u5bf9\u5e94\u7684Python\u5bf9\u8c61\uff0c\u5176\u4e2d\u53ef\u4ee5\u5b8c\u6210\u6570\u636e\u6821\u9a8c\u7b49\u5de5\u4f5c</p>\n<h3>3. \u63a5\u53e3\u7cfb\u7edf API System</h3>\n<h4>3.1 API\u89e3\u6790\u673a\u5236</h4>\n<h4>3.2 \u94a9\u5b50\u7cfb\u7edf</h4>\n<p>UtilMeta\u4e2d\u7684\u94a9\u5b50\u7cfb\u7edf\u53ef\u4ee5\u4f5c\u7528\u4e8e\u4e00\u4e2aAPI\uff0c\u6a21\u5757\u6216\u51fd\u6570\uff0c\u4f7f\u5f97\u8bf7\u6c42\u7684\u5904\u7406\u5982\u6d41\u6c34\u7ebf\u4e00\u822c\u5206\u5de5\u660e\u786e\uff0c\u4f9d\u6b21\u8fdb\u884c\uff0c\u6709\u6548\u5904\u7406\uff0c\u5176\u4e2dAPI\u4e0a\u7684\u94a9\u5b50\u6709\u51e0\u79cd\u7c7b\u578b</p>\n<h5>1. @api.before : \u5904\u7406\u524d\u94a9\u5b50</h5>\n<p>\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\u7684\u88c5\u9970\u5668\uff0c\u8fd9\u4e2a\u53c2\u6570\u662f\u4e00\u4e2aAPI\u5185\u5904\u7406\u5355\u5143\u7684\u540d\u79f0\u6216\u5f15\u7528</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">AccountAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">auth</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"c1\"># do something</span>\n    \t<span class=\"k\">pass</span>\n\n   \t<span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">before</span><span class=\"p\">(</span><span class=\"n\">auth</span><span class=\"p\">)</span>\t<span class=\"c1\"># or @api.before('auth')</span>\n    <span class=\"k\">def</span> <span class=\"nf\">pre_auth</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">meta</span><span class=\"p\">):</span>\n        <span class=\"c1\"># do something before auth function called</span>\n    \t<span class=\"k\">pass</span>\n</pre>\n<p>\u5982\u679cbefore\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4ec5\u4ec5\u662f\u6267\u884c\u5b8cbefore\u94a9\u5b50\u518d\u6267\u884c\u5904\u7406\u51fd\u6570\uff0c\u597d\u50cf\u4f5c\u7528\u4e0d\u5927\uff0c\u53ef\u662f\uff0c\u8fd9\u4e2a\u53c2\u6570\u8fd8\u53ef\u4ee5\u662f\u4e00\u4e2a\u6a21\u5757\uff0c\u751a\u81f3\u662f\u4e00\u4e2aAPI\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8bf7\u6c42\u5230\u8fbe\u90a3\u4e2a\u5355\u5143\u4e4b\u524d\uff0c\u5bf9\u8bf7\u6c42\u7684data, headers\u7b49\u4f5c\u51fa\u4e00\u5b9a\u5904\u7406\uff0c\u9a8c\u8bc1\u7b49\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u94a9\u5b50\u51fd\u6570\u672c\u8eab\u6709\u4e24\u4e2a<strong>\u53ef\u9009\u53c2\u6570</strong>\uff08\u51fd\u6570\u5728\u5b9a\u4e49\u65f6\u9664self\u5916\u53ef\u4ee5\u5b9a\u4e490~2\u4e2a\u53c2\u6570\uff0c\u5c06\u4f1a\u4f9d\u6b21\u4f20\u5165\u6570\u636e\uff0c\u6309\u9700\u5b9a\u4e49\uff09\uff0c\u5c06\u4f1a\u4f9d\u6b21\u4f20\u5165\u8bf7\u6c42\u6570\u636eself.data\u548c\u8bf7\u6c42\u5934\u4fe1\u606fself.META\uff0c\u800cAPI\u5b9e\u4f8b\u7684data\u5c5e\u6027\u662f\u4f1a\u4f20\u9012\u5230\u4e0b\u4e00\u5c42API\u548cModule\u4e2d\u8fdb\u884c\u5904\u7406\u7684\uff0c</p>\n<h5>2. @api.after : \u5904\u7406\u540e\u94a9\u5b50</h5>\n<p>\u4e0ebefore\u88c5\u9970\u5668\u76f8\u5bf9\u7684\uff0cafter\u88c5\u9970\u7684\u51fd\u6570\u662f\u5728\u5904\u7406\u5355\u5143\u6267\u884c\u4e4b\u540e\u6267\u884c\uff0c\u88ab\u88c5\u9970\u7684\u51fd\u6570\u6709\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\uff0c\u4f20\u5165\u5904\u7406\u5355\u5143\u6267\u884c\u8fd4\u56de\u7684\u7ed3\u679c</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">WorkAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n\t<span class=\"nb\">list</span> <span class=\"o\">=</span> <span class=\"n\">WorkList</span>\n\n    <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">after</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">)</span>\t<span class=\"c1\"># or @api.after(WorkList) or @api.after('list')</span>\n    <span class=\"k\">def</span> <span class=\"nf\">process</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">response</span><span class=\"p\">):</span>\n        <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"s1\">'My-Header'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">'My Value'</span>\n        <span class=\"k\">return</span> <span class=\"n\">response</span>\n</pre>\n<p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679cafter\u4e00\u4e2a\u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u5b83\u7684\u8fd4\u56de\u7ed3\u679c\uff08return \u7684\u503c\uff09\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5bf9\u5b83\u8fdb\u884c\u5904\u7406\uff0c\u800c\u52a0\u5728\u4e00\u4e2aAPI\u6216Module\u4e0a\u4f1a\u5f97\u5230\u5b83\u8fd4\u56de\u7684HttpResponse\uff0c\u6309\u7167\u7ea6\u5b9a\u8fdb\u884c\u4e0d\u6539\u53d8\u8fd4\u56de\u7ed3\u679c\u7684\u5904\u7406\uff08\u5982\u8bb0\u5f55\u65e5\u5fd7\uff09\u6216\u6539\u53d8headers\uff0c\u4e5f\u5c31\u662f\u4e0d\u8981\u628a\u8fd9\u4e2a\u53c2\u6570\u89c6\u4f5c\u4e00\u4e2a\u5b57\u5178\u6216\u5217\u8868\uff0c\u800c\u4e14\u52a1\u5fc5\u5c06\u8fd9\u4e2a\u53c2\u6570\u8fdb\u884c\u8fd4\u56de\uff0c\u56e0\u4e3aafter\u88c5\u9970\u5668\u7684\u7ed3\u679c\u5728\u51fd\u6570\u6267\u884c\u4e0d\u53d1\u751f\u9519\u8bef\u7684\u524d\u63d0\u4e0b\u5c06<strong>\u76f4\u63a5\u4f5c\u4e3a\u5f53\u524dAPI\u7684\u5904\u7406\u7ed3\u679c</strong>\u8fd4\u56de\u7ed9\u4e0a\u5c42API</p>\n<h5>3. @api.handle : \u9519\u8bef\u5904\u7406\u94a9\u5b50</h5>\n<p>\u5728\u540e\u7aef\u7cfb\u7edf\u4e2d\uff0c\u5bf9\u4e8e\u9519\u8bef\u8bf7\u6c42\u6216\u670d\u52a1\u9519\u8bef\u7684\u5904\u7406\u975e\u5e38\u91cd\u8981\uff0c\u8fd9\u4e2a\u88c5\u9970\u5668\u5c31\u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u5904\u7406\u94a9\u5b50\uff0c\u5b83\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u5904\u7406\u5355\u5143\u7684\u540d\u79f0\u6216\u5f15\u7528\uff08\u4e0e\u4ee5\u4e0a\u4e24\u4e2a\u88c5\u9970\u5668\u76f8\u540c\uff09\uff0c\u7b2c\u4e8c\u662f\u53ef\u9009\u53c2\u6570\uff0c\u9519\u8bef\u7684\u7c7b\u578b\uff0c\u9ed8\u8ba4\u4e3aException\uff0c\u5373\u5904\u7406\u6240\u6709\u7684\u9519\u8bef\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u4e00\u4e2a\u5904\u7406\u5355\u5143\u8bbe\u7f6e\u591a\u4e2a\u8bf7\u6c42\u94a9\u5b50\uff0c\u6bcf\u4e2a\u5bf9\u5e94\u4e0d\u540c\u7684\u9519\u8bef\u7c7b\u578b</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">RootAPI</span><span class=\"p\">(</span><span class=\"n\">API</span><span class=\"p\">):</span>\n    <span class=\"n\">work</span> <span class=\"o\">=</span> <span class=\"n\">WorkAPI</span>\n\n    <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">handle</span><span class=\"p\">(</span><span class=\"n\">work</span><span class=\"p\">,</span> <span class=\"n\">BadRequest</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">handle_work_parse</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">error</span><span class=\"p\">):</span>\n        <span class=\"k\">pass</span>\n\n    <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">handle</span><span class=\"p\">(</span><span class=\"n\">work</span><span class=\"p\">,</span> <span class=\"n\">PermissionDenied</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">handle_work_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">error</span><span class=\"p\">):</span>\n        <span class=\"k\">pass</span>\n\n    <span class=\"nd\">@api</span><span class=\"o\">.</span><span class=\"n\">handle</span><span class=\"p\">(</span><span class=\"n\">work</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">handle_work_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">error</span><span class=\"p\">):</span>\n        <span class=\"k\">pass</span>\n</pre>\n<p>\u4e8b\u5b9e\u4e0a\u4e3a\u4e86\u786e\u4fdd\u8fd4\u56de\u6b63\u786e\uff0c\u5728\u6700\u9876\u5c42\u7684API\u4e0a\u4e5f\u6709\u9ed8\u8ba4\u7684\u9519\u8bef\u5904\u7406\u94a9\u5b50\uff0c\u5f53\u9047\u5230BadRequest\u9519\u8bef\u8fd4\u56de400\uff0c\u5f53\u9047\u5230PermissionDenied\u9519\u8bef\u8fd4\u56de403\uff0c\u901a\u5e38\u9519\u8bef\u8fd4\u56de500\u7b49\u7b49\uff0c\u5e76\u4f1a\u5c06\u9519\u8bef\u4fe1\u606f\u8bb0\u5f55\u5230\u8bf7\u6c42\u7684\u65e5\u5fd7\u4e2d</p>\n<p>\u5728\u6d4b\u8bd5\u73af\u5883\uff08production=False\uff09\u4e2d\uff0c\u62a5\u9519\u4fe1\u606f\u5c06\u4f1a\u4f5c\u4e3a\u7ed3\u679c\u8fd4\u56de\u7ed9\u524d\u7aef\uff0c\u4fbf\u4e8e\u8c03\u8bd5\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff08production=True\uff09\u9519\u8bef\u7684\u4fe1\u606f\u9ed8\u8ba4\u5c06\u4e0d\u4f1a\u8fd4\u56de\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9519\u8bef\u5904\u7406\u94a9\u5b50\u81ea\u5b9a\u4e49\u9519\u8bef\u65f6\u7684\u8fd4\u56de\u4fe1\u606f</p>\n<h4>3.3 \u8c03\u7528\u7cfb\u7edf*</h4>\n<p>\u4e00\u4e2a\u529f\u80fd\u590d\u6742\u7684API\u7cfb\u7edf\uff0c\u5f80\u5f80\u4e5f\u6709\u8fdc\u7a0b\u8c03\u7528\uff08RPC\uff09\u6216\u5fae\u670d\u52a1\u96c6\u6210\u7684\u9700\u6c42\uff0c\u5982\u4f55\u4f18\u96c5\u7684\u5904\u7406\u8fdc\u7a0b\u63a5\u53e3\u8c03\u7528\uff0c\u4ee5\u53ca\u5185\u90e8\u670d\u52a1\u7684\u63a5\u53e3\u590d\u7528\u5f88\u5173\u952e\uff0cAPI\u7684\u8c03\u7528\u7cfb\u7edf\u89e3\u51b3\u4e86\u4ee5\u4e0a\u95ee\u9898\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u7075\u6d3b\u7684\u590d\u7528\u5176\u4ed6API\u63a5\u53e3\u7684\u65b9\u6cd5\uff0c</p>\n<h5>1. \u5185\u90e8API\u65b9\u6cd5\u590d\u7528</h5>\n<h5>2. \u8c03\u7528\u8fdc\u7a0bUtilMeta\u670d\u52a1</h5>\n<h5>3. \u8c03\u7528\u4e00\u822c\u8fdc\u7a0b\u670d\u52a1</h5>\n<p>\u5982\u679c\u4f60\u8fd8\u5e0c\u671b\u4e0e\u8bf7\u6c42\u6a21\u677f\u4e00\u6837\u83b7\u5f97\u7c7b\u578b\u63d0\u793a\u7684\u4fbf\u5229\uff0c\u53ef\u4ee5\u6839\u636e\u8fdc\u7a0b\u670d\u52a1API\u63d0\u4f9b\u7684\u6587\u6863\u6574\u7406\u4e00\u4e2aSchema\uff0c\u8bf7\u6c42\u8fdc\u7a0b\u670d\u52a1\u5f97\u5230\u7684\u6570\u636e\u4e5f\u4f1a\u88ab\u89e3\u6790\u4e3a\u89c4\u8303\u7684Schema\u5bf9\u8c61\u4f9b\u4f60\u5728\u51fd\u6570\u4e2d\u8fdb\u884c\u8c03\u7528</p>\n<h4>3.4 \u5b89\u5168\u7cfb\u7edf*</h4>\n<h5>1. Rebot \u8bf7\u6c42\u8fc7\u6ee4</h5>\n<h5>2. API \u8c03\u7528\u6b21\u6570\u9650\u5236</h5>\n<h5>3. \u9ed1\u540d\u5355\uff0c\u767d\u540d\u5355</h5>\n<h4>3.5 \u5f02\u6b65\u7cfb\u7edf\uff1aASGI, WS, MQTT  *</h4>\n<h3>4. \u7f13\u5b58\u7cfb\u7edf Cache System*</h3>\n<h3>5. \u670d\u52a1\u4e0e\u914d\u7f6e Service&amp;Settings</h3>\n<h4>5.1 \u547d\u4ee4\u884c\u5de5\u5177meta</h4>\n<h5>1. setup</h5>\n<p>setup\u547d\u4ee4\u7528\u4e8e\u521b\u5efa\u4e00\u4e2aUtilMeta\u5de5\u7a0b\uff0c\u6839\u636e\u547d\u4ee4\u53c2\u6570\u9009\u62e9\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u7eafpython\u540e\u7aef\u9879\u76ee\u6216\u4e00\u4e2a\u5b8c\u6574\u7684\u53ef\u90e8\u7f72\u7684\u5de5\u7a0b\uff0c\u4e0b\u9762\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u8bf4\u660emeta setup\u7684\u4f7f\u7528\u65b9\u6cd5</p>\n<p>\u5047\u8bbe\u6211\u8981\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a utilmeta.com\u7684\u7ad9\u70b9, \u5e76\u521b\u5efa\u5b50\u57df\u540d doc.utilmeta.com\u548c ops.utilmeta.com\u5bf9\u5e94\u7684\u670d\u52a1\uff08\u4e8b\u5b9e\u4e0a\u8fd9\u4e9b\u670d\u52a1\u90fd\u662f\u57fa\u4e8eUtilMeta\u7684\uff09 , \u90a3\u4e48\u53ea\u9700\u8fd9\u6837</p>\n<pre>meta setup utilmeta -w\n<span class=\"nb\">cd</span> utilmeta\nmeta setup doc\nmeta setup ops\n</pre>\n<p>\u5c31\u4f1a\u5f62\u6210\u5982\u4e0b\u7684\u5de5\u7a0b</p>\n<pre><code>/utilmeta\n\t/deploy\n\t\t/config\n\t\t\tnginx.conf\n\t\t\tdoc.nginx.conf\n\t\t\tops.nginx.conf\n\t/dev\n\t/dist\n\t\tindex.html\n\t\tdoc.index.html\n\t\tops.index.html\n\t/doc\n\t/media\n\t/ops\n\t/www\n\tmeta.ini\n</code></pre>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u7b2c\u4e00\u4e2a\u547d\u4ee4\u52a0\u5165 -w \u53c2\u6570\u521b\u5efa\u4e86\u4e00\u4e2a\u5e26\u6709\u90e8\u7f72\uff0c\u5a92\u4f53\uff0c\u524d\u7aef\u76ee\u5f55\u7684\u5168\u6808\u5de5\u7a0b\uff0c\u9ed8\u8ba4\u521b\u5efa\u4e86\u540d\u4e3awww\u7684\u670d\u52a1\uff0c\u4e4b\u540e\u4e24\u6b21setup\u6ca1\u6709-w\u53c2\u6570\uff0c\u521b\u5efa\u4e86\u4e0ewww\u540c\u7ea7\u7684\u4e24\u4e2a\u540e\u7aef\u670d\u52a1\u5de5\u7a0b\uff0c\u5e76\u4e14\u540c\u65f6\u521b\u5efa\u4e86\u5165\u53e3html\u6587\u4ef6\u548cnginx\u914d\u7f6e\u6587\u4ef6 (\u9ed8\u8ba4\u4e0d\u540c\u5b50\u57df\u540d\u7528\u4e0d\u540c\u5165\u53e3\u914d\u7f6e)\uff0c \u6211\u4eec\u6253\u5f00meta.ini</p>\n<pre><span class=\"k\">[meta]</span>\n<span class=\"na\">name</span> <span class=\"o\">=</span> <span class=\"s\">utilmeta</span>\n<span class=\"na\">auto-deploy</span> <span class=\"o\">=</span> <span class=\"s\">True</span>\n<span class=\"na\">default-service</span> <span class=\"o\">=</span> <span class=\"s\">www</span>\n\n<span class=\"k\">[service:www]</span>\n<span class=\"na\">main</span> <span class=\"o\">=</span> <span class=\"s\">main</span>\n<span class=\"na\">conf</span> <span class=\"o\">=</span> <span class=\"s\">config.conf:config</span>\n<span class=\"na\">wsgi</span> <span class=\"o\">=</span> <span class=\"s\">config.service:wsgi</span>\n\n<span class=\"na\">uwsgi</span> <span class=\"o\">=</span> <span class=\"s\">deploy/config/uwsgi.ini</span>\n<span class=\"c1\"># gunicorn = deploy/config/gunicorn.conf</span>\n<span class=\"na\">nginx</span> <span class=\"o\">=</span> <span class=\"s\">deploy/config/nginx.conf</span>\n<span class=\"na\">nginx-link</span> <span class=\"o\">=</span> <span class=\"s\">/etc/nginx/sites-enabled/utilmeta.conf</span>\n\n<span class=\"k\">[service:doc]</span>\n<span class=\"na\">main</span> <span class=\"o\">=</span> <span class=\"s\">main</span>\n<span class=\"na\">conf</span> <span class=\"o\">=</span> <span class=\"s\">config.conf:config</span>\n<span class=\"na\">wsgi</span> <span class=\"o\">=</span> <span class=\"s\">config.service:wsgi</span>\n\n<span class=\"na\">uwsgi</span> <span class=\"o\">=</span> <span class=\"s\">deploy/config/doc.uwsgi.ini</span>\n<span class=\"c1\"># gunicorn = deploy/config/doc.gunicorn.conf</span>\n<span class=\"na\">nginx</span> <span class=\"o\">=</span> <span class=\"s\">deploy/config/doc.nginx.conf</span>\n<span class=\"na\">nginx-link</span> <span class=\"o\">=</span> <span class=\"s\">/etc/nginx/sites-enabled/doc.utilmeta.conf</span>\n\n<span class=\"k\">[service:ops]</span>\n<span class=\"na\">main</span> <span class=\"o\">=</span> <span class=\"s\">main</span>\n<span class=\"na\">conf</span> <span class=\"o\">=</span> <span class=\"s\">config.conf:config</span>\n<span class=\"na\">wsgi</span> <span class=\"o\">=</span> <span class=\"s\">config.service:wsgi</span>\n\n<span class=\"na\">uwsgi</span> <span class=\"o\">=</span> <span class=\"s\">deploy/config/ops.uwsgi.ini</span>\n<span class=\"c1\"># gunicorn = deploy/config/ops.gunicorn.conf</span>\n<span class=\"na\">nginx</span> <span class=\"o\">=</span> <span class=\"s\">deploy/config/ops.nginx.conf</span>\n<span class=\"na\">nginx-link</span> <span class=\"o\">=</span> <span class=\"s\">/etc/nginx/sites-enabled/ops.utilmeta.conf</span>\n</pre>\n<p>\u6587\u4ef6\u5939\u540d\u79f0\u4e0e\u5b50\u57df\u5bf9\u79f0\u53ea\u662f\u4e00\u79cd\u65b9\u4fbf\u7684\u7ea6\u5b9a\uff0c\u4f60\u4e5f\u53ef\u4ee5\u91c7\u53d6\u5176\u4ed6\u547d\u540d\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u8981\u5728Config\u914d\u7f6e\u6587\u4ef6\u4e2d\u58f0\u660e\u6e05\u695a\u8fd9\u4e2a\u670d\u52a1\u5bf9\u5e94\u7684host</p>\n<p>\u5e76\u4e14\uff0c\u5728\u4e0d\u540c\u6587\u4ef6\u5939\u4e2d\u8fdb\u884csetup\u7684\u6548\u679c\u53ef\u80fd\u4e0d\u4e00\u6837\uff0c\u5728\u4e0a\u4e2a\u4f8b\u5b50\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u4e00\u4e2aUtilMeta\u9879\u76ee\u4e2d\u8fdb\u884c\uff0c\u5c06\u4f1a\u628a\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u5b50\u670d\u52a1\u8fdb\u884c\u521b\u5efa\uff0c\u800c\u5728\u5916\u90e8\u5219\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u670d\u52a1</p>\n<h5>2. meta.ini</h5>\n<p>meta.ini \u662fUtilMeta\u9879\u76ee\u5728 setup -w \u521d\u59cb\u521b\u5efa\u65f6\u5c31\u4f1a\u5728\u5de5\u7a0b\u76ee\u5f55\u521b\u5efa\u7684\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u5728\u5de5\u7a0b\u4e2d\u7684\u4efb\u610f\u5730\u5740\u6267\u884cmeta\u547d\u4ee4\uff0cmeta\u9ed8\u8ba4\u4f1a\u81ea\u52a8\u5411\u4e0a\u5bfb\u5740\u76f4\u81f3\u627e\u5230meta.ini\uff0c\u6240\u4ee5<strong>\u8bf7\u4e0d\u8981\u968f\u610f\u79fb\u52a8\uff0c\u91cd\u547d\u540d\u6216\u5220\u9664\u8fd9\u4e2a\u6587\u4ef6</strong>\uff0c\u8fd9\u5c06\u4f1a\u5bfc\u81f4meta\u7684\u5927\u90e8\u5206\u547d\u4ee4\u4e0d\u53ef\u7528\uff0c\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u5206\u4e3a\u4e24\u90e8\u5206</p>\n<p>[meta] \u4e2d\u7684\u914d\u7f6e\u9879\u4e3a\u9879\u76ee\u7684\u5143\u6570\u636e\uff0c\u5982\u9879\u76ee\u540d\u79f0\uff0c\u9ed8\u8ba4\u64cd\u4f5c\u7684\u670d\u52a1\u7b49</p>\n<p>[service:&lt;name&gt;] \u8fd9\u79cd\u5f62\u5f0f\u7684\u4e3a\u4e00\u4e2a\u670d\u52a1\u7684\u914d\u7f6e\uff0c\u4ee5\u4e0a\u7684\u4f8b\u5b50\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728setup\u670d\u52a1\u7684\u540c\u65f6\u670d\u52a1\u914d\u7f6e\u4f1a\u88ab\u6dfb\u52a0\u5230meta.ini\u4e2d\uff0c\u8fd9\u4e9b\u914d\u7f6e\u5f88\u91cd\u8981</p>\n<ul>\n<li><strong>main</strong>: \u670d\u52a1\u5165\u53e3\u4e3b\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4e3amain\uff08\u5373\u670d\u52a1\u76ee\u5f55\u4e0b\u7684main.py\u6587\u4ef6\uff09\uff0c\u5f71\u54cdserve\u547d\u4ee4</li>\n<li><strong>conf</strong>:  \u670d\u52a1\u914d\u7f6e\u6587\u4ef6\u6a21\u5757\uff0c\u9ed8\u8ba4\u4e3aconfig.conf:config \uff08\u5373\u670d\u52a1\u76ee\u5f55\u4e0b config/conf.py\u4e2d\u7684 config\u5bf9\u8c61\uff09</li>\n<li><strong>wsgi</strong>: \u670d\u52a1WSGI\u5e94\u7528\u6a21\u5757\uff0c\u9ed8\u8ba4\u4e3aconfig.service:wsgi \uff08\u5373\u670d\u52a1\u76ee\u5f55\u4e0b config/service.py\u4e2d\u7684 wsgi\u5bf9\u8c61\uff09</li>\n<li><strong>uwsgi</strong>: UtilMeta\u652f\u6301\u7684WSGI\u6709 uwsgi \u548c gunicorn\uff0c\u4f9d\u7167\u4f60\u9009\u7528\u7684WSGI\u9009\u62e9\u8fd9\u4e24\u4e2a\u53c2\u6570\u4e2d\u7684\u4e00\u4e2a\uff0cuwsgi\u53c2\u6570\u6307\u5b9auwsgi\u7684\u914d\u7f6e\u6587\u4ef6</li>\n<li><strong>gunicorn</strong>: \u540c\u4e0a\uff0c\u8fd9\u662f\u6307\u5b9agunicorn\u914d\u7f6e\u6587\u4ef6\u7684\u53c2\u6570</li>\n<li><strong>nginx</strong>:  UtilMeta\u652f\u6301\u7684Web\u670d\u52a1\u5668\u4e3a Nginx\u548cApache\uff0c\u9ed8\u8ba4\u4f7f\u7528nginx\uff0c\u8fd9\u4e2a\u53c2\u6570\u6307\u5b9a\u9879\u76ee\u4e2d\u7684nginx\u914d\u7f6e\u6587\u4ef6\uff08\u53ea\u914d\u7f6e\u5355\u4e2a\u670d\u52a1\uff0c\u4e0d\u662f\u4e3b\u6587\u4ef6 /etc/nginx/nginx.conf\uff09</li>\n<li><strong>nginx-link</strong>: \u4ee5\u4e0anginx\u914d\u7f6e\u6587\u4ef6\u5c06<strong>\u8f6f\u94fe\u63a5</strong>\u5230\u7684\u5730\u5740\uff0c\u5fc5\u987b\u4e3a<strong>\u7edd\u5bf9\u76ee\u5f55</strong>\uff0c\u5728Ubuntu\u4e2d\u901a\u5e38\u5728/etc/nginx/sites-enabled/\u4e2d\uff0c\u901a\u8fc7\u8f6f\u94fe\u63a5\u5bfc\u5165\u5230\u4e3b\u6587\u4ef6\u5c06\u4f1a\u4f7f\u5355\u4e2a\u914d\u7f6e\u6587\u4ef6\u751f\u6548</li>\n</ul>\n<p>\u6240\u6709\u7684\u7b2c\u4e09\u65b9\u914d\u7f6e\u6587\u4ef6\uff08uwsgi/gunicorn/nginx/apache\uff09\u5728\u9879\u76ee\u521d\u59cb\u5316\u65f6\u4f1a\u81ea\u52a8\u751f\u6210\uff0c\u4f60\u53ef\u4ee5\u4fee\u6539\u5b83\uff0c\u5f53meta\u914d\u7f6e\u7684auto-deploy\u4e3aTrue\u65f6\u8fd9\u4e2a\u6587\u4ef6\u5c06\u5728\u6bcf\u6b21\u90e8\u7f72\u65f6<strong>\u6839\u636e\u4f60\u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684deploy\u53c2\u6570\u8fdb\u884c\u81ea\u52a8\u751f\u6210</strong></p>\n<h2>Operations:</h2>\n<p>\u63a5\u4e0b\u6765\u5c06\u4f1a\u8be6\u7ec6\u4ecb\u7ecdUtilMeta\u7684\u8fd0\u7ef4\u7cfb\u7edf</p>\n<h2>Tutorial:</h2>\n<p>\u5728\u4e86\u89e3UtilMeta\u7684\u5404\u4e2a\u7ec4\u4ef6\u548c\u6574\u4e2a\u6846\u67b6\u7684\u67b6\u6784\u540e\uff0c\u6211\u4eec\u63a5\u7740QuickStart\u4e2d\u7684\u6848\u4f8b\u8fdb\u4e00\u6b65\u5f00\u53d1\u6210\u4e00\u4e2a\u5b8c\u6574\u7ad9\u70b9\uff0c\u5e76\u5728\u5176\u4e2d\u6df1\u5165\u4e86\u89e3UtilMeta\u7684\u5b9e\u8df5\u7528\u6cd5</p>\n\n          </div>"}, "last_serial": 7053234, "releases": {"1.1": [{"comment_text": "", "digests": {"md5": "7679894330b6e0c5f979f255b377c2fb", "sha256": "415c35b04e4dbdd0588e35330fb99a52f413d1412486e25816d0d6313d64a9b4"}, "downloads": -1, "filename": "UtilMeta-1.1-py3-none-any.whl", "has_sig": false, "md5_digest": "7679894330b6e0c5f979f255b377c2fb", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 41952, "upload_time": "2020-01-21T15:40:22", "upload_time_iso_8601": "2020-01-21T15:40:22.592137Z", "url": "https://files.pythonhosted.org/packages/29/ef/ab98f1fb9744d980dd39bfb9886c6287ea9b99770d2dcf95b2a871c49a8e/UtilMeta-1.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "810a43615ca8e99caf1e104b673b2705", "sha256": "aec293eb83a104e848939883061e40264131f95326b2e40598cf92012dde5441"}, "downloads": -1, "filename": "UtilMeta-1.1.tar.gz", "has_sig": false, "md5_digest": "810a43615ca8e99caf1e104b673b2705", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 33504, "upload_time": "2020-01-21T15:40:26", "upload_time_iso_8601": "2020-01-21T15:40:26.499628Z", "url": "https://files.pythonhosted.org/packages/01/54/6cafd2c38145e39ea830d8ab2a543610159e8e37c5672c3cf81ae4f73cda/UtilMeta-1.1.tar.gz", "yanked": false}], "1.2": [{"comment_text": "", "digests": {"md5": "2e1347823d6d4a3e5f09a79e7a8fd23a", "sha256": "a656e94fb0cdba6f39354ff0000408e0b402a19e67bb8df4b47071b60370f6c3"}, "downloads": -1, "filename": "UtilMeta-1.2-py3-none-any.whl", "has_sig": false, "md5_digest": "2e1347823d6d4a3e5f09a79e7a8fd23a", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 82360, "upload_time": "2020-02-19T15:08:32", "upload_time_iso_8601": "2020-02-19T15:08:32.881384Z", "url": "https://files.pythonhosted.org/packages/fd/f7/6314b53f50d6086ace25b1e0a8d99b430c1f8e52e66b8fc08e04a2682ecc/UtilMeta-1.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "44b6acd6667e509b2b4e3a17e86ca4e2", "sha256": "219c18843aa1b1d84f6aec2664a8e4fa1f390369e2e79e1eea24b9ac0d00d630"}, "downloads": -1, "filename": "UtilMeta-1.2.tar.gz", "has_sig": false, "md5_digest": "44b6acd6667e509b2b4e3a17e86ca4e2", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 59800, "upload_time": "2020-02-19T15:08:34", "upload_time_iso_8601": "2020-02-19T15:08:34.507816Z", "url": "https://files.pythonhosted.org/packages/f5/22/7979dddab7ae5f17c4c8f2107d32f692fad17f19b5ce881dbe5c20066ba0/UtilMeta-1.2.tar.gz", "yanked": false}], "1.4": [{"comment_text": "", "digests": {"md5": "6d2f43a84b30a13555fceec69981b65b", "sha256": "0857d49c91b7aab917ab90dbd968722399475ac956f9986b39f818129e8d8d4d"}, "downloads": -1, "filename": "UtilMeta-1.4-py3-none-any.whl", "has_sig": false, "md5_digest": "6d2f43a84b30a13555fceec69981b65b", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 152944, "upload_time": "2020-04-19T13:40:14", "upload_time_iso_8601": "2020-04-19T13:40:14.991773Z", "url": "https://files.pythonhosted.org/packages/07/33/40e274d8453bb8fdc1f2ac81ec9c414e99de4790785c95d787e5de1d9cdf/UtilMeta-1.4-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "16104a0c7fb75f087339a04e19fbeee9", "sha256": "1b31b3faef8211c3bc015a9fc40a98f0cc2d010abb24bd45b21009067f560667"}, "downloads": -1, "filename": "UtilMeta-1.4.tar.gz", "has_sig": false, "md5_digest": "16104a0c7fb75f087339a04e19fbeee9", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 169683, "upload_time": "2020-04-19T13:40:26", "upload_time_iso_8601": "2020-04-19T13:40:26.466165Z", "url": "https://files.pythonhosted.org/packages/7b/78/840f6e989c5dbe476ce0bcf678481c535234c8c72339ee5d7f583f17f2dc/UtilMeta-1.4.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "6d2f43a84b30a13555fceec69981b65b", "sha256": "0857d49c91b7aab917ab90dbd968722399475ac956f9986b39f818129e8d8d4d"}, "downloads": -1, "filename": "UtilMeta-1.4-py3-none-any.whl", "has_sig": false, "md5_digest": "6d2f43a84b30a13555fceec69981b65b", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 152944, "upload_time": "2020-04-19T13:40:14", "upload_time_iso_8601": "2020-04-19T13:40:14.991773Z", "url": "https://files.pythonhosted.org/packages/07/33/40e274d8453bb8fdc1f2ac81ec9c414e99de4790785c95d787e5de1d9cdf/UtilMeta-1.4-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "16104a0c7fb75f087339a04e19fbeee9", "sha256": "1b31b3faef8211c3bc015a9fc40a98f0cc2d010abb24bd45b21009067f560667"}, "downloads": -1, "filename": "UtilMeta-1.4.tar.gz", "has_sig": false, "md5_digest": "16104a0c7fb75f087339a04e19fbeee9", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 169683, "upload_time": "2020-04-19T13:40:26", "upload_time_iso_8601": "2020-04-19T13:40:26.466165Z", "url": "https://files.pythonhosted.org/packages/7b/78/840f6e989c5dbe476ce0bcf678481c535234c8c72339ee5d7f583f17f2dc/UtilMeta-1.4.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:38:49 2020"}