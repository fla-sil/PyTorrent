{"info": {"author": "Jo\u00e3o D. Ferreira", "author_email": "jotomicron@gmail.com", "bugtrack_url": null, "classifiers": ["License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python :: 3"], "description": "# Safe Parser\n\nPython's standard library provides a function, `ast.literal_eval`, which safely evaluates string representation of a python literal, such as a list or a string. This allows one to parse, for example, `'[\"string\", {}, 12.34]'` and other such safe literals.\n\nThis package provides an improvement of that ideia.\n\nA safe parser is an object that can take a string containing a valid python code that contains  assignments, and produces a dictionary of the resulting where environment dictionary. As such, it permits parsing and executing this:\n```python\na = ['a', 'list']\nb = {'content': a}\n```\nwhich is parsed into the following:\n```python\n{\n    'a': ['a', 'list'],\n    'b': {'content': ['a', 'list']}\n}\n```\n\nThe parser also allows executing functions, as long as it knows that they are safe to execute. For example, if there is a function \n```python\ndef repeat(x, n):\n    return [x] * n\n```\nthen a parser can parse the string `a = repeat('x', 3)` into:\n```python\n{\n    'a': ['x', 'x', 'x']\n}\n```\n\nThe safety is guaranteed becuase the parser is aware of which functions are safe to execute, by using a plugin system. All parsers contain a (initially empty) plugin store, which can be used to register new plugins:\n```python\nfrom safeparser import Parser\n\nparser = Parser()\n\n@parser.plugin_store.register\ndef repeat(x, n):\n    return [x] * n\n\nparser.parse('a = repeat(\"x\", 3)')\n\nprint(parser.env)\n\n# output: {'a': ['x', 'x', 'x']}\n```\n\n## Motivation\n\nThe parser provided with this package enables, foremost, the ability to run user input in a safe and controlled manner. Python, as a general purpose programming language, can \"execute anything\", and as such is not appropriate for user input. However, there are situations where a system is so complex that users may need the ability to talk more expressively with a third party.\n\nThe primary goal of this package is to serve as a user input processor for a system that allows users to ask a server to call a function with a series of input values. For example, a user may be interested in the similarity between any pair of a set of provided entities. Thus, the user needs to provide the entities and the pairs. For _n_ complex entities, this would mean providing _O_(_n<sup>2</sup>_) pairs, which may be impractical. If the system knows how to make the pairs itself, then the user does needs only to provide the entities.\n\n## What is safe?\n\nFor the purposes of this package, a safe statement is one that, once executed, produces no visible side effect other than creating or editing a variable (or multiple variables) in a dictionary.\n\n## Features\n\n- A parser can parse strings and file objects. The following two are valid\n```python\nparser.parse('a = 1')\nwith open('filename.txt') as f:\n    parser.parse(f)\n```\n\n- A parser can parse multiple inputs, each one building on top of the resulting dictionray of the previous\n```python\nparser.parse('a = 1')\nparser.parse('b = 2')\nprint(parser.env)\n# output: {'a': 1, 'b': 2}\n```\n\n- A parser can be started with an existing environment\n```python\nparser = Parser(env={'a': 1})\nparser.parse('b = a')\nprint(parser.env)\n# output: {'a': 1, 'b': 1}\n```\n\n- A plugin can be registered using a decorator or a method. The following are equivalent\n```python\n@parser.plugin_store.register\ndef add(a, b):\n    return a + b\n\ndef add(a, b):\n    return a + b\nparser.plugin_store.add(add)\n```\n\n- Plugins have direct access to the environment being constructed and can alter it\n```python\n@parser.plugin_store.register\ndef new_variable(*, env):\n    env['var'] = 0\n```\nFor this to work, the plugin function must have a non-optional keyword-only argument named `env`. Note that the environment is not a python dictionary, but it behaves like one, except that it does not allow double-underscore variables (see limitations below), and that the methods `keys()` and `values()` are not implemented.\n\n\n## Limitations\n\n- Because of how the code works, and also to not hinder future development, double-underscore variable names are not allowed. This is, on the one hand, so that we can safely inject an empty `__builtins__` into the evaluation of the code, as well as to allow injecting the current environment's state into plugins that request it (see above).\n\n- At the moment, I am not allowing expressions other than calls and literal. This means that the input does not allow binray operation, for example, unlike the `ast.literal_eval` function.\n\n- Methods cannot be executed. It is impossible to execute\n```python\nl = []\nl.append(0)\n```\neven though this is safe from the definition above\n\n- Note that plugins are only safe as long as the code they execute is safe. However, since the parser itself is in control of what plugins it supports, the ideia of executing unsafe user-provided code is still impossible.", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/jdferreira/safe-parser", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "safe-parser", "package_url": "https://pypi.org/project/safe-parser/", "platform": "", "project_url": "https://pypi.org/project/safe-parser/", "project_urls": {"Homepage": "https://github.com/jdferreira/safe-parser"}, "release_url": "https://pypi.org/project/safe-parser/0.1.3/", "requires_dist": null, "requires_python": "", "summary": "A simple parser of python-line code that can be safely executed", "version": "0.1.3", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>Safe Parser</h1>\n<p>Python's standard library provides a function, <code>ast.literal_eval</code>, which safely evaluates string representation of a python literal, such as a list or a string. This allows one to parse, for example, <code>'[\"string\", {}, 12.34]'</code> and other such safe literals.</p>\n<p>This package provides an improvement of that ideia.</p>\n<p>A safe parser is an object that can take a string containing a valid python code that contains  assignments, and produces a dictionary of the resulting where environment dictionary. As such, it permits parsing and executing this:</p>\n<pre><span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">'a'</span><span class=\"p\">,</span> <span class=\"s1\">'list'</span><span class=\"p\">]</span>\n<span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">'content'</span><span class=\"p\">:</span> <span class=\"n\">a</span><span class=\"p\">}</span>\n</pre>\n<p>which is parsed into the following:</p>\n<pre><span class=\"p\">{</span>\n    <span class=\"s1\">'a'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s1\">'a'</span><span class=\"p\">,</span> <span class=\"s1\">'list'</span><span class=\"p\">],</span>\n    <span class=\"s1\">'b'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s1\">'content'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s1\">'a'</span><span class=\"p\">,</span> <span class=\"s1\">'list'</span><span class=\"p\">]}</span>\n<span class=\"p\">}</span>\n</pre>\n<p>The parser also allows executing functions, as long as it knows that they are safe to execute. For example, if there is a function</p>\n<pre><span class=\"k\">def</span> <span class=\"nf\">repeat</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">x</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"n\">n</span>\n</pre>\n<p>then a parser can parse the string <code>a = repeat('x', 3)</code> into:</p>\n<pre><span class=\"p\">{</span>\n    <span class=\"s1\">'a'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s1\">'x'</span><span class=\"p\">,</span> <span class=\"s1\">'x'</span><span class=\"p\">,</span> <span class=\"s1\">'x'</span><span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</pre>\n<p>The safety is guaranteed becuase the parser is aware of which functions are safe to execute, by using a plugin system. All parsers contain a (initially empty) plugin store, which can be used to register new plugins:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">safeparser</span> <span class=\"kn\">import</span> <span class=\"n\">Parser</span>\n\n<span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">Parser</span><span class=\"p\">()</span>\n\n<span class=\"nd\">@parser</span><span class=\"o\">.</span><span class=\"n\">plugin_store</span><span class=\"o\">.</span><span class=\"n\">register</span>\n<span class=\"k\">def</span> <span class=\"nf\">repeat</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">x</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"n\">n</span>\n\n<span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">'a = repeat(\"x\", 3)'</span><span class=\"p\">)</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># output: {'a': ['x', 'x', 'x']}</span>\n</pre>\n<h2>Motivation</h2>\n<p>The parser provided with this package enables, foremost, the ability to run user input in a safe and controlled manner. Python, as a general purpose programming language, can \"execute anything\", and as such is not appropriate for user input. However, there are situations where a system is so complex that users may need the ability to talk more expressively with a third party.</p>\n<p>The primary goal of this package is to serve as a user input processor for a system that allows users to ask a server to call a function with a series of input values. For example, a user may be interested in the similarity between any pair of a set of provided entities. Thus, the user needs to provide the entities and the pairs. For <em>n</em> complex entities, this would mean providing <em>O</em>(<em>n<sup>2</sup></em>) pairs, which may be impractical. If the system knows how to make the pairs itself, then the user does needs only to provide the entities.</p>\n<h2>What is safe?</h2>\n<p>For the purposes of this package, a safe statement is one that, once executed, produces no visible side effect other than creating or editing a variable (or multiple variables) in a dictionary.</p>\n<h2>Features</h2>\n<ul>\n<li>A parser can parse strings and file objects. The following two are valid</li>\n</ul>\n<pre><span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">'a = 1'</span><span class=\"p\">)</span>\n<span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"s1\">'filename.txt'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n    <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">)</span>\n</pre>\n<ul>\n<li>A parser can parse multiple inputs, each one building on top of the resulting dictionray of the previous</li>\n</ul>\n<pre><span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">'a = 1'</span><span class=\"p\">)</span>\n<span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">'b = 2'</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"p\">)</span>\n<span class=\"c1\"># output: {'a': 1, 'b': 2}</span>\n</pre>\n<ul>\n<li>A parser can be started with an existing environment</li>\n</ul>\n<pre><span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">Parser</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'a'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">})</span>\n<span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">'b = a'</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"p\">)</span>\n<span class=\"c1\"># output: {'a': 1, 'b': 1}</span>\n</pre>\n<ul>\n<li>A plugin can be registered using a decorator or a method. The following are equivalent</li>\n</ul>\n<pre><span class=\"nd\">@parser</span><span class=\"o\">.</span><span class=\"n\">plugin_store</span><span class=\"o\">.</span><span class=\"n\">register</span>\n<span class=\"k\">def</span> <span class=\"nf\">add</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">a</span> <span class=\"o\">+</span> <span class=\"n\">b</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">add</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">a</span> <span class=\"o\">+</span> <span class=\"n\">b</span>\n<span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">plugin_store</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">add</span><span class=\"p\">)</span>\n</pre>\n<ul>\n<li>Plugins have direct access to the environment being constructed and can alter it</li>\n</ul>\n<pre><span class=\"nd\">@parser</span><span class=\"o\">.</span><span class=\"n\">plugin_store</span><span class=\"o\">.</span><span class=\"n\">register</span>\n<span class=\"k\">def</span> <span class=\"nf\">new_variable</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">,</span> <span class=\"n\">env</span><span class=\"p\">):</span>\n    <span class=\"n\">env</span><span class=\"p\">[</span><span class=\"s1\">'var'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n</pre>\n<p>For this to work, the plugin function must have a non-optional keyword-only argument named <code>env</code>. Note that the environment is not a python dictionary, but it behaves like one, except that it does not allow double-underscore variables (see limitations below), and that the methods <code>keys()</code> and <code>values()</code> are not implemented.</p>\n<h2>Limitations</h2>\n<ul>\n<li>\n<p>Because of how the code works, and also to not hinder future development, double-underscore variable names are not allowed. This is, on the one hand, so that we can safely inject an empty <code>__builtins__</code> into the evaluation of the code, as well as to allow injecting the current environment's state into plugins that request it (see above).</p>\n</li>\n<li>\n<p>At the moment, I am not allowing expressions other than calls and literal. This means that the input does not allow binray operation, for example, unlike the <code>ast.literal_eval</code> function.</p>\n</li>\n<li>\n<p>Methods cannot be executed. It is impossible to execute</p>\n</li>\n</ul>\n<pre><span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"n\">l</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n</pre>\n<p>even though this is safe from the definition above</p>\n<ul>\n<li>Note that plugins are only safe as long as the code they execute is safe. However, since the parser itself is in control of what plugins it supports, the ideia of executing unsafe user-provided code is still impossible.</li>\n</ul>\n\n          </div>"}, "last_serial": 4773607, "releases": {"0.1.1": [{"comment_text": "", "digests": {"md5": "1d58780acc1da29d9319e39bfdaa2f80", "sha256": "e3c8055aba1203d22af981b4e5a9654ee16bd6444d904b864e23b04d8581a4df"}, "downloads": -1, "filename": "safe-parser-0.1.1.tar.gz", "has_sig": false, "md5_digest": "1d58780acc1da29d9319e39bfdaa2f80", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6245, "upload_time": "2019-02-03T00:25:51", "upload_time_iso_8601": "2019-02-03T00:25:51.468595Z", "url": "https://files.pythonhosted.org/packages/f1/6a/1172f69c316cf16a947aad5bf12ffb09156db48cd341a01fddd7e6f33d68/safe-parser-0.1.1.tar.gz", "yanked": false}], "0.1.3": [{"comment_text": "", "digests": {"md5": "6e14dfeb3f472977ceda39dafcabe659", "sha256": "3a7e653b263d398109d10f73c5211b89a1e98b48d54dcd7358a666a3324c2753"}, "downloads": -1, "filename": "safe-parser-0.1.3.tar.gz", "has_sig": false, "md5_digest": "6e14dfeb3f472977ceda39dafcabe659", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6249, "upload_time": "2019-02-03T00:51:54", "upload_time_iso_8601": "2019-02-03T00:51:54.046330Z", "url": "https://files.pythonhosted.org/packages/71/f0/8fde954243a0c8cd181abf7907d339db13abf6b37db5bdece239f0ea41c0/safe-parser-0.1.3.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "6e14dfeb3f472977ceda39dafcabe659", "sha256": "3a7e653b263d398109d10f73c5211b89a1e98b48d54dcd7358a666a3324c2753"}, "downloads": -1, "filename": "safe-parser-0.1.3.tar.gz", "has_sig": false, "md5_digest": "6e14dfeb3f472977ceda39dafcabe659", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6249, "upload_time": "2019-02-03T00:51:54", "upload_time_iso_8601": "2019-02-03T00:51:54.046330Z", "url": "https://files.pythonhosted.org/packages/71/f0/8fde954243a0c8cd181abf7907d339db13abf6b37db5bdece239f0ea41c0/safe-parser-0.1.3.tar.gz", "yanked": false}], "timestamp": "Fri May  8 02:59:24 2020"}