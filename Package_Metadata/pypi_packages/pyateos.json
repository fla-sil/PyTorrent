{"info": {"author": "Federico Olivieri", "author_email": "lvrfrc87@gmail.com", "bugtrack_url": null, "classifiers": ["License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python :: 3"], "description": "# pyATEOS\n\nDeliberately inspired by [pyATS](https://developer.cisco.com/docs/pyats/) and based on [pyEAPI](https://pyeapi.readthedocs.io/en/latest/), [jsodiff](https://github.com/fzumstein/jsondiff) and [jmespath](http://jmespath.org/) libraries, pyATEOS is a python framework for operational status tests on Arista network gear. pyATS is based on SSH show command parsed via regex. Thanks to the powerful Arista API, every show command can be returned in JSON format skipping all the parse unstructured output pain. Ideally, a day pyATS will supprt Arista API as well.\n\n## TABLE OF CONTENT\n----\n- HOW IT WORKS\n- HOW TO RUN - API\n- HOW TO RUN - CLI\n- FILTER\n- TEST SUPPORTED\n- THE `SHOW` COMMANDS BEHIND THE PLUGINS\n- ANSIBLE PYATEOS\n----\n\n### HOW IT WORKS\nA snapshot of the operational status of a switch is taken before a config or network change and compare against a second snapshot taken after the change. A diff file is generated in .json format.\n\nDiff example after removing a NTP server and add new one:\n\n```\n{\n    \"peers\": {\n[...]\n        \"insert\": {\n            \"216.239.35.0\": {\n                \"delay\": 10.11,\n                \"jitter\": 0.0,\n                \"lastReceived\": 1582533810.0,\n                \"peerType\": \"unicast\",\n                \"reachabilityHistory\": [\n                    true\n                ],\n                \"condition\": \"reject\",\n                \"offset\": 160338.608,\n                \"peerIpAddr\": \"216.239.35.0\",\n                \"pollInterval\": 64,\n                \"refid\": \".GOOG.\",\n                \"stratumLevel\": 1\n            }\n        },\n        \"delete\": {\n            \"10.75.33.5\": {\n                \"delay\": 0.0,\n                \"jitter\": 0.0,\n                \"lastReceived\": 2085978496.0,\n                \"peerType\": \"unicast\",\n                \"reachabilityHistory\": [\n                    false\n                ],\n                \"condition\": \"reject\",\n                \"offset\": 0.0,\n                \"peerIpAddr\": \"10.75.33.5\",\n                \"pollInterval\": 1024,\n                \"refid\": \".INIT.\",\n                \"stratumLevel\": 16\n            }\n        }\n    }\n}\n```\n\nRemember, this does not show a config change, instead it shows the difference of the operational status of the NTP servers. This means that you will see a diff in `jitter` or `offset` between 2 snapshots. Example:\n\n```\n{\n    \"peers\": {\n        \"ns2.sys.cloudsys.tmcs\": {\n            \"jitter\": [\n                6.36,\n                3.826\n            ],\n            \"lastReceived\": [\n                1582537393.0,\n                1582537586.0\n            ],\n            \"condition\": [\n                \"candidate\",\n                \"sys.peer\"\n            ]\n        },\n        \"ns1.sys.cloudsys.tmcs\": {\n            \"delay\": [\n                0.408,\n                0.355\n            ],\n            \"jitter\": [\n                5.075,\n                6.241\n            ],\n            \"lastReceived\": [\n                1582537405.0,\n                1582537605.0\n            ],\n            \"condition\": [\n                \"sys.peer\",\n                \"candidate\"\n            ],\n            \"offset\": [\n                5.477,\n                -6.42\n            ]\n        }\n    }\n}\n```\n### HOW TO RUN - API\n```\n>>> from pyateos import pyateos\n>>> \n>>> my_dict = {\n    'invetory': 'eos_invenotry.ini',\n    'before': True,\n    'after': False,\n    'compare': False,\n    'test': ['ntp'],\n    'node': ['lf4'],\n    'file_name': None,\n    'filter': False\n}\n>>> \n>>> pyateos.pyateos(**my_dict)\n>>> BEFORE file ID for NTP test: 1582619302\n>>> \n>>> my_dict = {\n    'invetory': 'eos_invenotry.ini',\n    'before': False,\n    'after': True,\n    'compare': False,\n    'test': ['ntp'],\n    'node': ['lf4'],\n    'file_name': None,\n    'filter': False\n}\n>>> \n>>> pyateos.pyateos(**my_dict)\n>>> AFTER file ID for NTP test: 1582619366\n>>> \n>>> my_dict = {\n    'invetory': 'eos_invenotry.ini',\n    'before': False,\n    'after': False,\n    'compare': True,\n    'test': ['ntp'],\n    'node': ['lf4'],\n    'file_name': [1582619302, 1582619366]\n    'filter': False,\n}\n>>> \n>>> pyateos.pyateos(**my_dict)\n>>> DIFF file ID for NTP test: 64\n```\n\n### HOW TO RUN - CLI\nAn inventory must be defined as described in pyEAPI [doc](https://pyeapi.readthedocs.io/en/latest/configfile.html). A filesystem is automatically created at every code iteration (if required - idempotent). The fiename of before and after are in the follwing format `timestamp_node_test.json`. Diff filename is `(after_timpestamp - before_timestamp)_node_test.json`.\n\nArguments list:\n\n```\n    usage: pyATEOS [-h] (-B | -A | -C) -t TEST [TEST ...] [-g GROUP [GROUP ...]]\n               [-i INVENTORY] -n NODE [NODE ...] [-F FILE [FILE ...]] [-f]\n\n    pyATEOS - A simple python application for operational status test on Arista\n    device. Based on pyATS idea and pyeapi library for API calls.\n\n    optional arguments:\n    -h, --help            show this help message and exit\n    -B, --before          write json file containing the test result BEFORE. To\n                            be run BEFORE the config change. File path example:\n                            $PWD/before/ntp/router1_ntp.json\n    -A, --after           write json file containing the test result AFTER. To\n                            be run AFTER the config change. File path example:\n                            $PWD/after/ip_route/router1_ip_route.json\n    -C, --compare         diff between before and after test files. File path\n                            example: $PWD/diff/snmp/router1_snmp.json\n    -t TEST [TEST ...], --test TEST [TEST ...]\n                            run one or more specific test. Multiple values are\n                            accepted separated by space\n    -g GROUP [GROUP ...], --group GROUP [GROUP ...]\n                            run a subset of test. Options available: mgmt,\n                            routing, layer2, ctrl, all Multiple values are\n                            accepted separated by space. Works also with -t --test\n    -i INVENTORY, --inventory INVENTORY\n                            specify pyeapi inventory file path\n    -n NODE [NODE ...], --node NODE [NODE ...]\n                            specify inventory node. Multiple values are accepted\n                            separated by space\n    -F FILE [FILE ...], --file_name FILE [FILE ...]\n                            provide the 2 filename IDs to compare, separated by\n                            space. BEFORE first, AFTER second. i.e [..] -C -f\n                            1582386835 1582387929\n    -f, --filter          filter counters where present\n```\n\nexample - BEFORE a network config change for NTP server:\n\n```\npyateos -i eos_inventory.ini -n lf4 -t mgmt -B\nBEFORE file ID for NTP test: 1582537406\nBEFORE file ID for SNMP test: 1582537409\n\nls -la before/ntp/\n-rw-r--r--  1 federicoolivieri  staff   916 24 Feb 09:47 1582537406.json\n```\n\nexample - AFTER a network config change for NTP server:\n\n```\npyateos -i eos_inventory.ini -n lf4 -t mgmt -A\nAFTER file ID for NTP test: 1582537612\nAFTER file ID for SNMP test: 1582537614\n\nls -la after/ntp/\n-rw-r--r--  1 federicoolivieri  staff  1246 24 Feb 10:43 1582537612.json\n```\n\ndiff example of the aboves for NTP.\n\n```\npyateos -i eos_inventory.ini -n lf4 -t ntp -C -F 1582537612 1582537406\nDIFF file ID for NTP test: 6\n\nls -la diff/ntp/\n-rw-r--r--  1 federicoolivieri  staff     2 24 Feb 10:43 6_ntp_lf4.json\n```\n\n`group` and `test` can be use together:\n\n```\npyateos -g mgmt -t bgp_evpn -n lf4 -i ../eos_inventory.ini -B\nBEFORE file ID for NTP test: 1583161168\nBEFORE file ID for BGP_EVPN test: 1583161171\nBEFORE file ID for SNMP test: 1583161172\n```\n\nEven thugh `before` and `after` test can be run using groups, every diff must be run for every single test. Is not possible (yet) to run diff for a group of test\n\n### FILTER\nSome test outputs like interfaces or ntp have counters that constantly change. Therefore the diff will aways return a quite verbose output, making difficult to spot the what has been `insert` or `delete`. Apply `-f` or `--filter` will prune all unecessary counters.\nFilters are only valid for those test that return dict(dict()). For dict(list()) return, filters are transparent.\n\nExample no filter applied to NTP test\n\n```\npyateos -n lf4 -t ntp -C -F 1582732433 1582732569\n\n{\n    \"peers\": {\n        \"ns1.sys.cloudsys.tmcs\": {\n            \"delay\": [\n                0.441,\n                0.505\n            ],\n            \"jitter\": [\n                0.49,\n                0.004\n            ],\n            \"lastReceived\": [\n                1582732381.0,\n                1582732522.0\n            ],\n            \"reachabilityHistory\": {\n                \"delete\":\n            [...]\n        },\n        \"delete\": {\n            \"ns2.sys.cloudsys.tmcs\": {\n                \"delay\": 0.441,\n                \"jitter\": 0.457,\n                \"lastReceived\": 1582732328.0,\n                \"peerType\": \"unicast\",\n                \"reachabilityHistory\": [\n                    true,\n                    true,\n                    true,\n                    true,\n                    true,\n                    true,\n                    true,\n                    true\n                ],\n                \"condition\": \"candidate\",\n                \"offset\": -0.509,\n                \"peerIpAddr\": \"10.75.33.5\",\n                \"pollInterval\": 1024,\n                \"refid\": \"169.254.0.1\",\n                \"stratumLevel\": 3\n            }\n        }\n    }\n}\n```\n\nExample with filter applied to the same test above.\n\n```\npyateos -n lf4 -t ntp -C -F 1582732433 1582732569 -f\n\n{\n    \"delete\": {\n        \"ns2.sys.cloudsys.tmcs\": {\n            \"delay\": 0.441,\n            \"jitter\": 0.457,\n            \"lastReceived\": 1582732328.0,\n            \"peerType\": \"unicast\",\n            \"reachabilityHistory\": [\n                true,\n                true,\n                true,\n                true,\n                true,\n                true,\n                true,\n                true\n            ],\n            \"condition\": \"candidate\",\n            \"offset\": -0.509,\n            \"peerIpAddr\": \"10.75.33.5\",\n            \"pollInterval\": 1024,\n            \"refid\": \"169.254.0.1\",\n            \"stratumLevel\": 3\n        }\n    },\n    \"insert\": null\n}\n```\n\n### TEST SUPPORTED\n\nAll test supported are available under `plugins` folder. Those are:\n\n```\nacl\nas_path\nbgp_evpn\nbgp_ipv4\ninterface\nip_route\nmlag\nntp\nprefix_list\nroute_map\nsnmp\nstp\nvlan\nvrf\nvxlan\n```\n\nSome of the test are grouped together like: \n\n`mgmt: ntp, snmp`, \n\n`routing: bgp_evpn, bgp_ipv4, ip_route`, \n\n`layer2: stp, vlan, vxlan, lldp, arp, mac`,\n\n`ctrl: acl, as_path, prefix_list, route_map` \n\n`all` running all test availables under `plugins`. \n\n### ADD NEW PLUGINS\nNew plugins can be easily created and added under `plugins/` folder. Give to the file a meaningful name and copy the below content. The test name will be equal to the class name.\n\n```\n#!/usr/bin/env python3\nfrom pyeapi import eapilib\n\nclass my_test():\n\n    def __init__(self, node):\n        self.node = node\n\n    @property\n    def show(self):\n\n        try:\n            cmd = self.node.enable('show my command')\n            result = cmd[0]['result']\n\n            return result\n\n        except eapilib.CommandError:\n            print('COMMAND command \"show my command not support by the platform')\n```\n\nLook for `test_all` list and add your test there. If you want, you can add your test to an existing group or create your own group:\n\n```\n    test_all = [\n        'my_test'\n        [..]\n        'vrf',\n        'vxlan'\n    ]\n```\n\n### THE `SHOW` COMMANDS COMMANDS BEHIND THE PLUGINS\nEvery pyATEOS plugin run a specific run command. To better understand which output you will expect by each test, here the full list of plugins/commands:\n```\nacl:            show ip access-lists\narp:            show ip arp\nas_path:        show ip as-path access-list\nbgp_evpn:       show bgp evpn\nbgp_ipv4:       show bgp ipv4 unicast\ninterface:      show interfaces\nip_route:       show ip route detail\nlldp:           show lldp neighbors\nmac:            show address-table\nmlag:           show mlag\nntp:            show ntp associations\nprefix_list:    show ip prefix-list\nroute_map:      show route-map\nsnmp:           show snmp host\nvlan:           show vlan\nvrf:            show vrf\nvxlan:          show interfaces vxlan 1\n```\n\n### ANSIBLE PYATEOS\nGood news for Ansible folks, pyATEOS is supported by Ansible. `eos_pyateos` module is available. You can add under your [collection](https://galaxy.ansible.com/docs/contributing/creating_collections.html) or under `ansible/modules/network/eos/eos_pyateos.py`. Examples, test results and modules available under `ansible/`.\n\nHere and example of Ansible playbook using `eos_pyateos`:\n\n```\n- name: run BEFORE tests.\n  eos_pyateos:\n      before: true\n      test:\n          - acl\n      group: \n          - mgmt\n          - layer2\n      hostname: \"{{ inventory_hostname }}\"\n  register: result\n\n- name: save BEFORE file IDs.\n  delegate_to: 127.0.0.1\n  set_fact:\n      before_ids: \"{{ result.before_file_ids }}\"\n\n- name: change mgmt config on switch.\n  eos_config:\n      lines:\n          - no ntp server vrf mgmt 10.75.33.5\n          - ntp server vrf mgmt 216.239.35.4\n          - no snmp-server host 10.1.22.1 vrf mgmt version 2c snmp_pass\n          - snmp-server host 10.1.22.9 vrf mgmt version 2c snmp_pass\n\n- name: shutdown interface.\n  eos_config:\n      lines:\n          - shutdown\n      parents: interface Ethernet50/1\n\n- name: edit ACL.\n  eos_config:\n      lines:\n          - no 10\n          - 10 remark pyATEOS TEST\n      parents: ip access-list standard SNMP\n\n- name: run AFTER tests.\n  eos_pyateos:\n      after: true\n      test:\n          - acl\n      group:\n          - mgmt\n          - layer2\n      hostname: \"{{ inventory_hostname }}\"\n  register: result\n\n- name: save AFTER file IDs.\n  delegate_to: 127.0.0.1\n      set_fact:\n          after_ids: \"{{ result.after_file_ids }}\"\n\n- name: run DIFF result.\n  eos_pyateos:\n      compare: true\n      group:\n          - mgmt\n          - layer2\n      test:\n          - acl\n      hostname: \"{{ inventory_hostname }}\"\n      filter: true\n      files: \n          - \"{{ before_ids }}\"\n          - \"{{ after_ids }}\"\n```\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://gitlab.com/networkAutomation/pyateos", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "pyateos", "package_url": "https://pypi.org/project/pyateos/", "platform": "", "project_url": "https://pypi.org/project/pyateos/", "project_urls": {"Homepage": "https://gitlab.com/networkAutomation/pyateos"}, "release_url": "https://pypi.org/project/pyateos/0.1.6/", "requires_dist": ["jsondiff (>=1.2.0)", "pyeapi (>=0.8.3)", "jmespath (>=0.9.5)"], "requires_python": ">=3.6", "summary": "python framework to test operational status of an Arista network", "version": "0.1.6", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>pyATEOS</h1>\n<p>Deliberately inspired by <a href=\"https://developer.cisco.com/docs/pyats/\" rel=\"nofollow\">pyATS</a> and based on <a href=\"https://pyeapi.readthedocs.io/en/latest/\" rel=\"nofollow\">pyEAPI</a>, <a href=\"https://github.com/fzumstein/jsondiff\" rel=\"nofollow\">jsodiff</a> and <a href=\"http://jmespath.org/\" rel=\"nofollow\">jmespath</a> libraries, pyATEOS is a python framework for operational status tests on Arista network gear. pyATS is based on SSH show command parsed via regex. Thanks to the powerful Arista API, every show command can be returned in JSON format skipping all the parse unstructured output pain. Ideally, a day pyATS will supprt Arista API as well.</p>\n<h2>TABLE OF CONTENT</h2>\n<hr>\n<ul>\n<li>HOW IT WORKS</li>\n<li>HOW TO RUN - API</li>\n<li>HOW TO RUN - CLI</li>\n<li>FILTER</li>\n<li>TEST SUPPORTED</li>\n<li>THE <code>SHOW</code> COMMANDS BEHIND THE PLUGINS</li>\n<li>ANSIBLE PYATEOS</li>\n</ul>\n<hr>\n<h3>HOW IT WORKS</h3>\n<p>A snapshot of the operational status of a switch is taken before a config or network change and compare against a second snapshot taken after the change. A diff file is generated in .json format.</p>\n<p>Diff example after removing a NTP server and add new one:</p>\n<pre><code>{\n    \"peers\": {\n[...]\n        \"insert\": {\n            \"216.239.35.0\": {\n                \"delay\": 10.11,\n                \"jitter\": 0.0,\n                \"lastReceived\": 1582533810.0,\n                \"peerType\": \"unicast\",\n                \"reachabilityHistory\": [\n                    true\n                ],\n                \"condition\": \"reject\",\n                \"offset\": 160338.608,\n                \"peerIpAddr\": \"216.239.35.0\",\n                \"pollInterval\": 64,\n                \"refid\": \".GOOG.\",\n                \"stratumLevel\": 1\n            }\n        },\n        \"delete\": {\n            \"10.75.33.5\": {\n                \"delay\": 0.0,\n                \"jitter\": 0.0,\n                \"lastReceived\": 2085978496.0,\n                \"peerType\": \"unicast\",\n                \"reachabilityHistory\": [\n                    false\n                ],\n                \"condition\": \"reject\",\n                \"offset\": 0.0,\n                \"peerIpAddr\": \"10.75.33.5\",\n                \"pollInterval\": 1024,\n                \"refid\": \".INIT.\",\n                \"stratumLevel\": 16\n            }\n        }\n    }\n}\n</code></pre>\n<p>Remember, this does not show a config change, instead it shows the difference of the operational status of the NTP servers. This means that you will see a diff in <code>jitter</code> or <code>offset</code> between 2 snapshots. Example:</p>\n<pre><code>{\n    \"peers\": {\n        \"ns2.sys.cloudsys.tmcs\": {\n            \"jitter\": [\n                6.36,\n                3.826\n            ],\n            \"lastReceived\": [\n                1582537393.0,\n                1582537586.0\n            ],\n            \"condition\": [\n                \"candidate\",\n                \"sys.peer\"\n            ]\n        },\n        \"ns1.sys.cloudsys.tmcs\": {\n            \"delay\": [\n                0.408,\n                0.355\n            ],\n            \"jitter\": [\n                5.075,\n                6.241\n            ],\n            \"lastReceived\": [\n                1582537405.0,\n                1582537605.0\n            ],\n            \"condition\": [\n                \"sys.peer\",\n                \"candidate\"\n            ],\n            \"offset\": [\n                5.477,\n                -6.42\n            ]\n        }\n    }\n}\n</code></pre>\n<h3>HOW TO RUN - API</h3>\n<pre><code>&gt;&gt;&gt; from pyateos import pyateos\n&gt;&gt;&gt; \n&gt;&gt;&gt; my_dict = {\n    'invetory': 'eos_invenotry.ini',\n    'before': True,\n    'after': False,\n    'compare': False,\n    'test': ['ntp'],\n    'node': ['lf4'],\n    'file_name': None,\n    'filter': False\n}\n&gt;&gt;&gt; \n&gt;&gt;&gt; pyateos.pyateos(**my_dict)\n&gt;&gt;&gt; BEFORE file ID for NTP test: 1582619302\n&gt;&gt;&gt; \n&gt;&gt;&gt; my_dict = {\n    'invetory': 'eos_invenotry.ini',\n    'before': False,\n    'after': True,\n    'compare': False,\n    'test': ['ntp'],\n    'node': ['lf4'],\n    'file_name': None,\n    'filter': False\n}\n&gt;&gt;&gt; \n&gt;&gt;&gt; pyateos.pyateos(**my_dict)\n&gt;&gt;&gt; AFTER file ID for NTP test: 1582619366\n&gt;&gt;&gt; \n&gt;&gt;&gt; my_dict = {\n    'invetory': 'eos_invenotry.ini',\n    'before': False,\n    'after': False,\n    'compare': True,\n    'test': ['ntp'],\n    'node': ['lf4'],\n    'file_name': [1582619302, 1582619366]\n    'filter': False,\n}\n&gt;&gt;&gt; \n&gt;&gt;&gt; pyateos.pyateos(**my_dict)\n&gt;&gt;&gt; DIFF file ID for NTP test: 64\n</code></pre>\n<h3>HOW TO RUN - CLI</h3>\n<p>An inventory must be defined as described in pyEAPI <a href=\"https://pyeapi.readthedocs.io/en/latest/configfile.html\" rel=\"nofollow\">doc</a>. A filesystem is automatically created at every code iteration (if required - idempotent). The fiename of before and after are in the follwing format <code>timestamp_node_test.json</code>. Diff filename is <code>(after_timpestamp - before_timestamp)_node_test.json</code>.</p>\n<p>Arguments list:</p>\n<pre><code>    usage: pyATEOS [-h] (-B | -A | -C) -t TEST [TEST ...] [-g GROUP [GROUP ...]]\n               [-i INVENTORY] -n NODE [NODE ...] [-F FILE [FILE ...]] [-f]\n\n    pyATEOS - A simple python application for operational status test on Arista\n    device. Based on pyATS idea and pyeapi library for API calls.\n\n    optional arguments:\n    -h, --help            show this help message and exit\n    -B, --before          write json file containing the test result BEFORE. To\n                            be run BEFORE the config change. File path example:\n                            $PWD/before/ntp/router1_ntp.json\n    -A, --after           write json file containing the test result AFTER. To\n                            be run AFTER the config change. File path example:\n                            $PWD/after/ip_route/router1_ip_route.json\n    -C, --compare         diff between before and after test files. File path\n                            example: $PWD/diff/snmp/router1_snmp.json\n    -t TEST [TEST ...], --test TEST [TEST ...]\n                            run one or more specific test. Multiple values are\n                            accepted separated by space\n    -g GROUP [GROUP ...], --group GROUP [GROUP ...]\n                            run a subset of test. Options available: mgmt,\n                            routing, layer2, ctrl, all Multiple values are\n                            accepted separated by space. Works also with -t --test\n    -i INVENTORY, --inventory INVENTORY\n                            specify pyeapi inventory file path\n    -n NODE [NODE ...], --node NODE [NODE ...]\n                            specify inventory node. Multiple values are accepted\n                            separated by space\n    -F FILE [FILE ...], --file_name FILE [FILE ...]\n                            provide the 2 filename IDs to compare, separated by\n                            space. BEFORE first, AFTER second. i.e [..] -C -f\n                            1582386835 1582387929\n    -f, --filter          filter counters where present\n</code></pre>\n<p>example - BEFORE a network config change for NTP server:</p>\n<pre><code>pyateos -i eos_inventory.ini -n lf4 -t mgmt -B\nBEFORE file ID for NTP test: 1582537406\nBEFORE file ID for SNMP test: 1582537409\n\nls -la before/ntp/\n-rw-r--r--  1 federicoolivieri  staff   916 24 Feb 09:47 1582537406.json\n</code></pre>\n<p>example - AFTER a network config change for NTP server:</p>\n<pre><code>pyateos -i eos_inventory.ini -n lf4 -t mgmt -A\nAFTER file ID for NTP test: 1582537612\nAFTER file ID for SNMP test: 1582537614\n\nls -la after/ntp/\n-rw-r--r--  1 federicoolivieri  staff  1246 24 Feb 10:43 1582537612.json\n</code></pre>\n<p>diff example of the aboves for NTP.</p>\n<pre><code>pyateos -i eos_inventory.ini -n lf4 -t ntp -C -F 1582537612 1582537406\nDIFF file ID for NTP test: 6\n\nls -la diff/ntp/\n-rw-r--r--  1 federicoolivieri  staff     2 24 Feb 10:43 6_ntp_lf4.json\n</code></pre>\n<p><code>group</code> and <code>test</code> can be use together:</p>\n<pre><code>pyateos -g mgmt -t bgp_evpn -n lf4 -i ../eos_inventory.ini -B\nBEFORE file ID for NTP test: 1583161168\nBEFORE file ID for BGP_EVPN test: 1583161171\nBEFORE file ID for SNMP test: 1583161172\n</code></pre>\n<p>Even thugh <code>before</code> and <code>after</code> test can be run using groups, every diff must be run for every single test. Is not possible (yet) to run diff for a group of test</p>\n<h3>FILTER</h3>\n<p>Some test outputs like interfaces or ntp have counters that constantly change. Therefore the diff will aways return a quite verbose output, making difficult to spot the what has been <code>insert</code> or <code>delete</code>. Apply <code>-f</code> or <code>--filter</code> will prune all unecessary counters.\nFilters are only valid for those test that return dict(dict()). For dict(list()) return, filters are transparent.</p>\n<p>Example no filter applied to NTP test</p>\n<pre><code>pyateos -n lf4 -t ntp -C -F 1582732433 1582732569\n\n{\n    \"peers\": {\n        \"ns1.sys.cloudsys.tmcs\": {\n            \"delay\": [\n                0.441,\n                0.505\n            ],\n            \"jitter\": [\n                0.49,\n                0.004\n            ],\n            \"lastReceived\": [\n                1582732381.0,\n                1582732522.0\n            ],\n            \"reachabilityHistory\": {\n                \"delete\":\n            [...]\n        },\n        \"delete\": {\n            \"ns2.sys.cloudsys.tmcs\": {\n                \"delay\": 0.441,\n                \"jitter\": 0.457,\n                \"lastReceived\": 1582732328.0,\n                \"peerType\": \"unicast\",\n                \"reachabilityHistory\": [\n                    true,\n                    true,\n                    true,\n                    true,\n                    true,\n                    true,\n                    true,\n                    true\n                ],\n                \"condition\": \"candidate\",\n                \"offset\": -0.509,\n                \"peerIpAddr\": \"10.75.33.5\",\n                \"pollInterval\": 1024,\n                \"refid\": \"169.254.0.1\",\n                \"stratumLevel\": 3\n            }\n        }\n    }\n}\n</code></pre>\n<p>Example with filter applied to the same test above.</p>\n<pre><code>pyateos -n lf4 -t ntp -C -F 1582732433 1582732569 -f\n\n{\n    \"delete\": {\n        \"ns2.sys.cloudsys.tmcs\": {\n            \"delay\": 0.441,\n            \"jitter\": 0.457,\n            \"lastReceived\": 1582732328.0,\n            \"peerType\": \"unicast\",\n            \"reachabilityHistory\": [\n                true,\n                true,\n                true,\n                true,\n                true,\n                true,\n                true,\n                true\n            ],\n            \"condition\": \"candidate\",\n            \"offset\": -0.509,\n            \"peerIpAddr\": \"10.75.33.5\",\n            \"pollInterval\": 1024,\n            \"refid\": \"169.254.0.1\",\n            \"stratumLevel\": 3\n        }\n    },\n    \"insert\": null\n}\n</code></pre>\n<h3>TEST SUPPORTED</h3>\n<p>All test supported are available under <code>plugins</code> folder. Those are:</p>\n<pre><code>acl\nas_path\nbgp_evpn\nbgp_ipv4\ninterface\nip_route\nmlag\nntp\nprefix_list\nroute_map\nsnmp\nstp\nvlan\nvrf\nvxlan\n</code></pre>\n<p>Some of the test are grouped together like:</p>\n<p><code>mgmt: ntp, snmp</code>,</p>\n<p><code>routing: bgp_evpn, bgp_ipv4, ip_route</code>,</p>\n<p><code>layer2: stp, vlan, vxlan, lldp, arp, mac</code>,</p>\n<p><code>ctrl: acl, as_path, prefix_list, route_map</code></p>\n<p><code>all</code> running all test availables under <code>plugins</code>.</p>\n<h3>ADD NEW PLUGINS</h3>\n<p>New plugins can be easily created and added under <code>plugins/</code> folder. Give to the file a meaningful name and copy the below content. The test name will be equal to the class name.</p>\n<pre><code>#!/usr/bin/env python3\nfrom pyeapi import eapilib\n\nclass my_test():\n\n    def __init__(self, node):\n        self.node = node\n\n    @property\n    def show(self):\n\n        try:\n            cmd = self.node.enable('show my command')\n            result = cmd[0]['result']\n\n            return result\n\n        except eapilib.CommandError:\n            print('COMMAND command \"show my command not support by the platform')\n</code></pre>\n<p>Look for <code>test_all</code> list and add your test there. If you want, you can add your test to an existing group or create your own group:</p>\n<pre><code>    test_all = [\n        'my_test'\n        [..]\n        'vrf',\n        'vxlan'\n    ]\n</code></pre>\n<h3>THE <code>SHOW</code> COMMANDS COMMANDS BEHIND THE PLUGINS</h3>\n<p>Every pyATEOS plugin run a specific run command. To better understand which output you will expect by each test, here the full list of plugins/commands:</p>\n<pre><code>acl:            show ip access-lists\narp:            show ip arp\nas_path:        show ip as-path access-list\nbgp_evpn:       show bgp evpn\nbgp_ipv4:       show bgp ipv4 unicast\ninterface:      show interfaces\nip_route:       show ip route detail\nlldp:           show lldp neighbors\nmac:            show address-table\nmlag:           show mlag\nntp:            show ntp associations\nprefix_list:    show ip prefix-list\nroute_map:      show route-map\nsnmp:           show snmp host\nvlan:           show vlan\nvrf:            show vrf\nvxlan:          show interfaces vxlan 1\n</code></pre>\n<h3>ANSIBLE PYATEOS</h3>\n<p>Good news for Ansible folks, pyATEOS is supported by Ansible. <code>eos_pyateos</code> module is available. You can add under your <a href=\"https://galaxy.ansible.com/docs/contributing/creating_collections.html\" rel=\"nofollow\">collection</a> or under <code>ansible/modules/network/eos/eos_pyateos.py</code>. Examples, test results and modules available under <code>ansible/</code>.</p>\n<p>Here and example of Ansible playbook using <code>eos_pyateos</code>:</p>\n<pre><code>- name: run BEFORE tests.\n  eos_pyateos:\n      before: true\n      test:\n          - acl\n      group: \n          - mgmt\n          - layer2\n      hostname: \"{{ inventory_hostname }}\"\n  register: result\n\n- name: save BEFORE file IDs.\n  delegate_to: 127.0.0.1\n  set_fact:\n      before_ids: \"{{ result.before_file_ids }}\"\n\n- name: change mgmt config on switch.\n  eos_config:\n      lines:\n          - no ntp server vrf mgmt 10.75.33.5\n          - ntp server vrf mgmt 216.239.35.4\n          - no snmp-server host 10.1.22.1 vrf mgmt version 2c snmp_pass\n          - snmp-server host 10.1.22.9 vrf mgmt version 2c snmp_pass\n\n- name: shutdown interface.\n  eos_config:\n      lines:\n          - shutdown\n      parents: interface Ethernet50/1\n\n- name: edit ACL.\n  eos_config:\n      lines:\n          - no 10\n          - 10 remark pyATEOS TEST\n      parents: ip access-list standard SNMP\n\n- name: run AFTER tests.\n  eos_pyateos:\n      after: true\n      test:\n          - acl\n      group:\n          - mgmt\n          - layer2\n      hostname: \"{{ inventory_hostname }}\"\n  register: result\n\n- name: save AFTER file IDs.\n  delegate_to: 127.0.0.1\n      set_fact:\n          after_ids: \"{{ result.after_file_ids }}\"\n\n- name: run DIFF result.\n  eos_pyateos:\n      compare: true\n      group:\n          - mgmt\n          - layer2\n      test:\n          - acl\n      hostname: \"{{ inventory_hostname }}\"\n      filter: true\n      files: \n          - \"{{ before_ids }}\"\n          - \"{{ after_ids }}\"\n</code></pre>\n\n          </div>"}, "last_serial": 6734242, "releases": {"0.1.1": [{"comment_text": "", "digests": {"md5": "aa16df8078c78197b3f6356be242c057", "sha256": "a610a4942fd6f3ff309cedaaa2da33226757f98ec70eb0b49e51ffd75308451b"}, "downloads": -1, "filename": "pyateos-0.1.1-py3-none-any.whl", "has_sig": false, "md5_digest": "aa16df8078c78197b3f6356be242c057", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 19155, "upload_time": "2020-02-25T10:58:11", "upload_time_iso_8601": "2020-02-25T10:58:11.475717Z", "url": "https://files.pythonhosted.org/packages/b4/ea/cab635f98645a6f65dd0b5ff273d7b7712564db9c2d942048e87c7fa665c/pyateos-0.1.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "ea52442d2b598849048ee89602669752", "sha256": "6766cbb690b900ad1ad322a61aedfa6fe2e84b3e7245db87419094521d8b8703"}, "downloads": -1, "filename": "pyateos-0.1.1.tar.gz", "has_sig": false, "md5_digest": "ea52442d2b598849048ee89602669752", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 9495, "upload_time": "2020-02-25T10:58:13", "upload_time_iso_8601": "2020-02-25T10:58:13.571583Z", "url": "https://files.pythonhosted.org/packages/4f/6a/8336e46e41d19f81d2ecc23cb950eb2114cfcec69a0daccd5cc0879da8a4/pyateos-0.1.1.tar.gz", "yanked": false}], "0.1.2": [{"comment_text": "", "digests": {"md5": "b3958942a3cbf980a840d30463fa4b7f", "sha256": "1ac8c47301ae865bfad846c40d933293cf2775dcf2fdda6bc6f37e981eb422b9"}, "downloads": -1, "filename": "pyateos-0.1.2-py3-none-any.whl", "has_sig": false, "md5_digest": "b3958942a3cbf980a840d30463fa4b7f", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 20023, "upload_time": "2020-02-25T11:07:06", "upload_time_iso_8601": "2020-02-25T11:07:06.941467Z", "url": "https://files.pythonhosted.org/packages/29/ac/23964c08425f60bb16c1fe319c7145fe00c75656882beca8322bd49a9f68/pyateos-0.1.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "c973bb6fced818f13fd0c5c906a4f418", "sha256": "6473fa26020f01964535f6cee1d4a9416f0c3faaa20f3ddc6b71fccadd0cc4da"}, "downloads": -1, "filename": "pyateos-0.1.2.tar.gz", "has_sig": false, "md5_digest": "c973bb6fced818f13fd0c5c906a4f418", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 9941, "upload_time": "2020-02-25T11:07:08", "upload_time_iso_8601": "2020-02-25T11:07:08.524945Z", "url": "https://files.pythonhosted.org/packages/bf/1e/e8c5ba8410d3e134a7fb35569e262544fdd492bb22adf5661209ed296f89/pyateos-0.1.2.tar.gz", "yanked": false}], "0.1.3": [{"comment_text": "", "digests": {"md5": "16bc7e6e5348afe131687ac8a7bc3084", "sha256": "9082c13a7e034fad3224895cbc019c882d09889e1069319e50a08effef917846"}, "downloads": -1, "filename": "pyateos-0.1.3-py3-none-any.whl", "has_sig": false, "md5_digest": "16bc7e6e5348afe131687ac8a7bc3084", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 20031, "upload_time": "2020-02-25T11:13:29", "upload_time_iso_8601": "2020-02-25T11:13:29.794477Z", "url": "https://files.pythonhosted.org/packages/b2/9c/6ac49b7e9c556d778eed5f33081a2a075b5a33b78c73f2046316d4468135/pyateos-0.1.3-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "02c9dac29218b3b4301681d0e05ab95a", "sha256": "c94416f46ad90bba097a83247c3cb048a563735e961c3fc2499e5e9df939ea3e"}, "downloads": -1, "filename": "pyateos-0.1.3.tar.gz", "has_sig": false, "md5_digest": "02c9dac29218b3b4301681d0e05ab95a", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 9936, "upload_time": "2020-02-25T11:13:31", "upload_time_iso_8601": "2020-02-25T11:13:31.568347Z", "url": "https://files.pythonhosted.org/packages/83/90/a04e5a739f3ae6bcedbd0ed37bb9e2f7cadb7203147a465b50defbca688d/pyateos-0.1.3.tar.gz", "yanked": false}], "0.1.5": [{"comment_text": "", "digests": {"md5": "2a384ffb96316cb24d22ce00549201de", "sha256": "a65c7c52e9c7f22589a00536c3434a615543215fa55725de0f74d9060bda0116"}, "downloads": -1, "filename": "pyateos-0.1.5-py3-none-any.whl", "has_sig": false, "md5_digest": "2a384ffb96316cb24d22ce00549201de", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 21601, "upload_time": "2020-02-26T16:44:50", "upload_time_iso_8601": "2020-02-26T16:44:50.754053Z", "url": "https://files.pythonhosted.org/packages/fd/98/c43bd9177684499c3a69a9baa2903f968febae499950cbf37f98197776f4/pyateos-0.1.5-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "7f41909d15e67aba5638d2859b9ca078", "sha256": "512b378d2799b7fb3db1afd052c145867dff0afae6bb41fc5e046c408b115171"}, "downloads": -1, "filename": "pyateos-0.1.5.tar.gz", "has_sig": false, "md5_digest": "7f41909d15e67aba5638d2859b9ca078", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 12281, "upload_time": "2020-02-26T16:44:52", "upload_time_iso_8601": "2020-02-26T16:44:52.311691Z", "url": "https://files.pythonhosted.org/packages/51/57/e9046513aa235c6a12ec89118b39b8ab74ab7e33174800c572886439bb4a/pyateos-0.1.5.tar.gz", "yanked": false}], "0.1.6": [{"comment_text": "", "digests": {"md5": "cf8b00c2d0c2b58f7a4f1efbf349a75a", "sha256": "be3c05d1eba2d9bf7c3fda8d7579d9423651bc391e6ff1c18d2689bc01997a64"}, "downloads": -1, "filename": "pyateos-0.1.6-py3-none-any.whl", "has_sig": false, "md5_digest": "cf8b00c2d0c2b58f7a4f1efbf349a75a", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 23985, "upload_time": "2020-03-02T15:36:46", "upload_time_iso_8601": "2020-03-02T15:36:46.888757Z", "url": "https://files.pythonhosted.org/packages/05/f1/d1e5f82c24f58c21880fd644f29a7877a3bba87c2c1244c4fbcad415b59d/pyateos-0.1.6-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "17b1e75526ddfd11f2be5836ad027b2c", "sha256": "6fb6d8c88af815fba680826a532389bb4929b6e0613c65e92a6e568cca6135c6"}, "downloads": -1, "filename": "pyateos-0.1.6.tar.gz", "has_sig": false, "md5_digest": "17b1e75526ddfd11f2be5836ad027b2c", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 15199, "upload_time": "2020-03-02T15:36:48", "upload_time_iso_8601": "2020-03-02T15:36:48.658424Z", "url": "https://files.pythonhosted.org/packages/22/30/f5c73f8d87a69ffe5a3260606f19358550f8947557fcca623b8d40301da3/pyateos-0.1.6.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "cf8b00c2d0c2b58f7a4f1efbf349a75a", "sha256": "be3c05d1eba2d9bf7c3fda8d7579d9423651bc391e6ff1c18d2689bc01997a64"}, "downloads": -1, "filename": "pyateos-0.1.6-py3-none-any.whl", "has_sig": false, "md5_digest": "cf8b00c2d0c2b58f7a4f1efbf349a75a", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 23985, "upload_time": "2020-03-02T15:36:46", "upload_time_iso_8601": "2020-03-02T15:36:46.888757Z", "url": "https://files.pythonhosted.org/packages/05/f1/d1e5f82c24f58c21880fd644f29a7877a3bba87c2c1244c4fbcad415b59d/pyateos-0.1.6-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "17b1e75526ddfd11f2be5836ad027b2c", "sha256": "6fb6d8c88af815fba680826a532389bb4929b6e0613c65e92a6e568cca6135c6"}, "downloads": -1, "filename": "pyateos-0.1.6.tar.gz", "has_sig": false, "md5_digest": "17b1e75526ddfd11f2be5836ad027b2c", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 15199, "upload_time": "2020-03-02T15:36:48", "upload_time_iso_8601": "2020-03-02T15:36:48.658424Z", "url": "https://files.pythonhosted.org/packages/22/30/f5c73f8d87a69ffe5a3260606f19358550f8947557fcca623b8d40301da3/pyateos-0.1.6.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:10:04 2020"}