{"info": {"author": "Shayne Sweeney", "author_email": "shayne@instagram.com", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Intended Audience :: Developers", "License :: OSI Approved :: GNU Library or Lesser General Public License (LGPL)", "Natural Language :: English", "Operating System :: OS Independent", "Programming Language :: Python :: 2.5", "Programming Language :: Python :: 2.6", "Programming Language :: Python :: 2.7", "Topic :: Software Development :: Debuggers", "Topic :: Utilities"], "description": "====================================================\nTripod - Slow Script Watchdog\n====================================================\n\n\nOverview\n--------\n\nTripod is a module that samples running scripts, logging tracebacks to a temp file.\n\nMost of the code was brought over from the `Django watchdog middleware project, Dogslow`_.\n\n.. _Django watchdog middleware project, Dogslow: https://bitbucket.org/evzijst/dogslow\n\n\nInstallation\n------------\n\nInstall tripod::\n\n    $ pip install tripod\n\n\nConfiguration\n-------------\n\nYou can use the following environmental variables to adjust the sampler::\n\n    # Log traceback of running script every 5 seconds\n    TRIPOD_INTERVAL = 5\n\n\nUsage\n-----\n\nRun tripod::\n\n    $ python -m tripod.sampler ./some_script.py\n    [Tripod] Sampling every 5.000000 seconds\n    [Tripod] Writing output to: /tmp/slow_process_tkM6Rt.log\n\nEvery 5 seconds the watchdog is activated and takes a peek at the script's\nstack and appends the backtrace (including all local stack variables) to the\nlog file.\n\nEvery stack is appended to the log file and looks like this::\n\n\n    File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\n        \"__main__\", fname, loader, pkg_name)\n    File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/runpy.py\", line 72, in _run_code\n        exec code in run_globals\n    File \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 128, in <module>\n        main()\n    File \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 118, in main\n        exec f.read() in globals(), globals()\n    File \"<string>\", line 5, in <module>\n    File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/socket.py\", line 351, in read\n        data = self._sock.recv(rbufsize)\n    File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/httplib.py\", line 553, in read\n        s = self.fp.read(amt)\n    File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/socket.py\", line 380, in read\n        data = self._sock.recv(left)\n\n    Full backtrace with local variables:\n\n    File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\n        \"__main__\", fname, loader, pkg_name)\n\n        Arguments: _run_module_as_main(mod_name='tripod.sampler', alter_argv=1)\n        Local variables:\n\n        {'alter_argv': 1,\n        'code': <code object <module> at 0x10ba09a30, file \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 1>,\n        'fname': '/Users/shayne/Code/tripod/tripod/sampler.py',\n        'loader': <pkgutil.ImpLoader instance at 0x10ba0a368>,\n        'main_globals': {'SafePrettyPrinter': <class '__main__.SafePrettyPrinter'>,\n                            'Timer': <class 'tripod.timer.Timer'>,\n                            '__builtins__': <module '__builtin__' (built-in)>,\n                            '__doc__': None,\n                            '__file__': 'slow.py',\n                            '__loader__': <pkgutil.ImpLoader instance at 0x10ba0a368>,\n                            '__name__': '__main__',\n                            '__package__': 'tripod',\n                            'dt': <module 'datetime' from '/Users/shayne/pyenv/lib/python2.7/lib-dynload/datetime.so'>,\n                            'f': <addinfourl at 4495809568 whose fp = <socket._fileobject object at 0x10bac70d0>>,\n                            'formatvalue': <function formatvalue at 0x10bac1320>,\n                            'inspect': <module 'inspect' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/inspect.py'>,\n                            'linecache': <module 'linecache' from '/Users/shayne/pyenv/lib/python2.7/linecache.pyc'>,\n                            'main': <function main at 0x10bac1488>,\n                            'os': <module 'os' from '/Users/shayne/pyenv/lib/python2.7/os.pyc'>,\n                            'peek': <function peek at 0x10bac1410>,\n                            'pprint': <module 'pprint' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/pprint.py'>,\n                            'spformat': <function spformat at 0x10ba649b0>,\n                            'stack': <function stack at 0x10bac1398>,\n                            'sys': <module 'sys' (built-in)>,\n                            'tempfile': <module 'tempfile' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/tempfile.pyc'>,\n                            'thread': <module 'thread' (built-in)>,\n                            'urllib2': <module 'urllib2' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.pyc'>},\n        'mod_name': 'tripod.sampler',\n        'pkg_name': 'tripod'}\n\n    File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/runpy.py\", line 72, in _run_code\n        exec code in run_globals\n\n        Arguments: _run_code(code=<code object <module> at 0x10ba09a30, file \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 1>, run_globals=<dict object at 0x7f9812c1dc40 (really long repr)>, init_globals=None, mod_name='__main__', mod_fname='/Users/shayne/Code/tripod/tripod/sampler.py', mod_loader=<pkgutil.ImpLoader instance at 0x10ba0a368>, pkg_name='tripod')\n        Local variables:\n\n        {'code': <code object <module> at 0x10ba09a30, file \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 1>,\n        'init_globals': None,\n        'mod_fname': '/Users/shayne/Code/tripod/tripod/sampler.py',\n        'mod_loader': <pkgutil.ImpLoader instance at 0x10ba0a368>,\n        'mod_name': '__main__',\n\n      ...loads more...\n\nThe example above shows that the request thread was blocked in\n``f.read()`` at the time ``tripod`` took its snapshot.\n\nNote that ``tripod`` only takes a peek at the thread's stack. It does not\ninterrupt the script, or influence it in any other way.\n\n\nCaveats\n-------\n\nTripod, like Dogslow uses multithreading. It has a single background thread that handles the\ntimer timeouts and takes the tracebacks, so that the original script\nthreads are not interrupted. This has some consequences.\n\n\nMultithreading and the GIL\n~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nIn cPython, the GIL (Global Interpreter Lock) prevents multiple threads from\nexecuting Python code simultaneously. Only when a thread explicitly releases\nits lock on the GIL, can a second thread run.\n\nReleasing the GIL is done automatically whenever a Python program makes\nblocking calls outside of the interpreter, for example when doing IO.\n\nFor ``tripod`` this means that it can only reliably sample scripts that\nare slow because they are doing IO, calling sleep or busy waiting to acquire\nlocks themselves.\n\nIn most cases this is fine. A scenario where cPython's GIL is problematic\nis when the request's thread hits an infinite loop in Python code\n(or legitimate Python that is extremely expensive and takes a long time\nto execute), never releasing the GIL. Even though ``tripod``'s watchdog\ntimer does become runnable, it cannot log the stack.\n\n\nCo-routines and Greenlets\n~~~~~~~~~~~~~~~~~~~~~~~~~\n\n``Tripod`` is intended for use in a synchronous configuration. A\nprocess that uses dedicated threads (or single-threaded processes).\n\nWhen running with a \"co-routines framework\" where multiple requests are served\nconcurrently by one thread, backtraces might become nonsensical.", "description_content_type": null, "docs_url": null, "download_url": "https://github.com/downloads/shayne/tripod/tripod-0.1.tar.gz", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/shayne/tripod", "keywords": "debug watchdog middleware traceback", "license": "GNU LGPL", "maintainer": null, "maintainer_email": null, "name": "tripod", "package_url": "https://pypi.org/project/tripod/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/tripod/", "project_urls": {"Download": "https://github.com/downloads/shayne/tripod/tripod-0.1.tar.gz", "Homepage": "https://github.com/shayne/tripod"}, "release_url": "https://pypi.org/project/tripod/0.1/", "requires_dist": null, "requires_python": null, "summary": "A module that samples running scripts, logging tracebacks.", "version": "0.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <div id=\"overview\">\n<h2>Overview</h2>\n<p>Tripod is a module that samples running scripts, logging tracebacks to a temp file.</p>\n<p>Most of the code was brought over from the <a href=\"https://bitbucket.org/evzijst/dogslow\" rel=\"nofollow\">Django watchdog middleware project, Dogslow</a>.</p>\n</div>\n<div id=\"installation\">\n<h2>Installation</h2>\n<p>Install tripod:</p>\n<pre>$ pip install tripod\n</pre>\n</div>\n<div id=\"configuration\">\n<h2>Configuration</h2>\n<p>You can use the following environmental variables to adjust the sampler:</p>\n<pre># Log traceback of running script every 5 seconds\nTRIPOD_INTERVAL = 5\n</pre>\n</div>\n<div id=\"usage\">\n<h2>Usage</h2>\n<p>Run tripod:</p>\n<pre>$ python -m tripod.sampler ./some_script.py\n[Tripod] Sampling every 5.000000 seconds\n[Tripod] Writing output to: /tmp/slow_process_tkM6Rt.log\n</pre>\n<p>Every 5 seconds the watchdog is activated and takes a peek at the script\u2019s\nstack and appends the backtrace (including all local stack variables) to the\nlog file.</p>\n<p>Every stack is appended to the log file and looks like this:</p>\n<pre>File \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\nFile \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\nFile \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 128, in &lt;module&gt;\n    main()\nFile \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 118, in main\n    exec f.read() in globals(), globals()\nFile \"&lt;string&gt;\", line 5, in &lt;module&gt;\nFile \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/socket.py\", line 351, in read\n    data = self._sock.recv(rbufsize)\nFile \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/httplib.py\", line 553, in read\n    s = self.fp.read(amt)\nFile \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/socket.py\", line 380, in read\n    data = self._sock.recv(left)\n\nFull backtrace with local variables:\n\nFile \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n\n    Arguments: _run_module_as_main(mod_name='tripod.sampler', alter_argv=1)\n    Local variables:\n\n    {'alter_argv': 1,\n    'code': &lt;code object &lt;module&gt; at 0x10ba09a30, file \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 1&gt;,\n    'fname': '/Users/shayne/Code/tripod/tripod/sampler.py',\n    'loader': &lt;pkgutil.ImpLoader instance at 0x10ba0a368&gt;,\n    'main_globals': {'SafePrettyPrinter': &lt;class '__main__.SafePrettyPrinter'&gt;,\n                        'Timer': &lt;class 'tripod.timer.Timer'&gt;,\n                        '__builtins__': &lt;module '__builtin__' (built-in)&gt;,\n                        '__doc__': None,\n                        '__file__': 'slow.py',\n                        '__loader__': &lt;pkgutil.ImpLoader instance at 0x10ba0a368&gt;,\n                        '__name__': '__main__',\n                        '__package__': 'tripod',\n                        'dt': &lt;module 'datetime' from '/Users/shayne/pyenv/lib/python2.7/lib-dynload/datetime.so'&gt;,\n                        'f': &lt;addinfourl at 4495809568 whose fp = &lt;socket._fileobject object at 0x10bac70d0&gt;&gt;,\n                        'formatvalue': &lt;function formatvalue at 0x10bac1320&gt;,\n                        'inspect': &lt;module 'inspect' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/inspect.py'&gt;,\n                        'linecache': &lt;module 'linecache' from '/Users/shayne/pyenv/lib/python2.7/linecache.pyc'&gt;,\n                        'main': &lt;function main at 0x10bac1488&gt;,\n                        'os': &lt;module 'os' from '/Users/shayne/pyenv/lib/python2.7/os.pyc'&gt;,\n                        'peek': &lt;function peek at 0x10bac1410&gt;,\n                        'pprint': &lt;module 'pprint' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/pprint.py'&gt;,\n                        'spformat': &lt;function spformat at 0x10ba649b0&gt;,\n                        'stack': &lt;function stack at 0x10bac1398&gt;,\n                        'sys': &lt;module 'sys' (built-in)&gt;,\n                        'tempfile': &lt;module 'tempfile' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/tempfile.pyc'&gt;,\n                        'thread': &lt;module 'thread' (built-in)&gt;,\n                        'urllib2': &lt;module 'urllib2' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.pyc'&gt;},\n    'mod_name': 'tripod.sampler',\n    'pkg_name': 'tripod'}\n\nFile \"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\n\n    Arguments: _run_code(code=&lt;code object &lt;module&gt; at 0x10ba09a30, file \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 1&gt;, run_globals=&lt;dict object at 0x7f9812c1dc40 (really long repr)&gt;, init_globals=None, mod_name='__main__', mod_fname='/Users/shayne/Code/tripod/tripod/sampler.py', mod_loader=&lt;pkgutil.ImpLoader instance at 0x10ba0a368&gt;, pkg_name='tripod')\n    Local variables:\n\n    {'code': &lt;code object &lt;module&gt; at 0x10ba09a30, file \"/Users/shayne/Code/tripod/tripod/sampler.py\", line 1&gt;,\n    'init_globals': None,\n    'mod_fname': '/Users/shayne/Code/tripod/tripod/sampler.py',\n    'mod_loader': &lt;pkgutil.ImpLoader instance at 0x10ba0a368&gt;,\n    'mod_name': '__main__',\n\n  ...loads more...\n</pre>\n<p>The example above shows that the request thread was blocked in\n<tt>f.read()</tt> at the time <tt>tripod</tt> took its snapshot.</p>\n<p>Note that <tt>tripod</tt> only takes a peek at the thread\u2019s stack. It does not\ninterrupt the script, or influence it in any other way.</p>\n</div>\n<div id=\"caveats\">\n<h2>Caveats</h2>\n<p>Tripod, like Dogslow uses multithreading. It has a single background thread that handles the\ntimer timeouts and takes the tracebacks, so that the original script\nthreads are not interrupted. This has some consequences.</p>\n<div id=\"multithreading-and-the-gil\">\n<h3>Multithreading and the GIL</h3>\n<p>In cPython, the GIL (Global Interpreter Lock) prevents multiple threads from\nexecuting Python code simultaneously. Only when a thread explicitly releases\nits lock on the GIL, can a second thread run.</p>\n<p>Releasing the GIL is done automatically whenever a Python program makes\nblocking calls outside of the interpreter, for example when doing IO.</p>\n<p>For <tt>tripod</tt> this means that it can only reliably sample scripts that\nare slow because they are doing IO, calling sleep or busy waiting to acquire\nlocks themselves.</p>\n<p>In most cases this is fine. A scenario where cPython\u2019s GIL is problematic\nis when the request\u2019s thread hits an infinite loop in Python code\n(or legitimate Python that is extremely expensive and takes a long time\nto execute), never releasing the GIL. Even though <tt>tripod</tt>\u2019s watchdog\ntimer does become runnable, it cannot log the stack.</p>\n</div>\n<div id=\"co-routines-and-greenlets\">\n<h3>Co-routines and Greenlets</h3>\n<p><tt>Tripod</tt> is intended for use in a synchronous configuration. A\nprocess that uses dedicated threads (or single-threaded processes).</p>\n<p>When running with a \u201cco-routines framework\u201d where multiple requests are served\nconcurrently by one thread, backtraces might become nonsensical.</p>\n</div>\n</div>\n\n          </div>"}, "last_serial": 803419, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "c6ab3f2f1c2a135e6e4c73a6c4ae8e73", "sha256": "ff5b1471cd910e1ed3be46ca3730ec9e24aa2db08bdd46730c7e6697d8fc9231"}, "downloads": -1, "filename": "tripod-0.1.tar.gz", "has_sig": false, "md5_digest": "c6ab3f2f1c2a135e6e4c73a6c4ae8e73", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15614, "upload_time": "2012-08-29T19:29:54", "upload_time_iso_8601": "2012-08-29T19:29:54.190166Z", "url": "https://files.pythonhosted.org/packages/db/79/3b2e5677b33f011e61691a900050da26dbf4184f455d4321ca2670d2715a/tripod-0.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "c6ab3f2f1c2a135e6e4c73a6c4ae8e73", "sha256": "ff5b1471cd910e1ed3be46ca3730ec9e24aa2db08bdd46730c7e6697d8fc9231"}, "downloads": -1, "filename": "tripod-0.1.tar.gz", "has_sig": false, "md5_digest": "c6ab3f2f1c2a135e6e4c73a6c4ae8e73", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15614, "upload_time": "2012-08-29T19:29:54", "upload_time_iso_8601": "2012-08-29T19:29:54.190166Z", "url": "https://files.pythonhosted.org/packages/db/79/3b2e5677b33f011e61691a900050da26dbf4184f455d4321ca2670d2715a/tripod-0.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:46:55 2020"}