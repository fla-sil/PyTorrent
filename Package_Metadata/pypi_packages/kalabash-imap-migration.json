{"info": {"author": "Alphamonak Solutions", "author_email": "info@alphamonak.com", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Environment :: Web Environment", "Framework :: Django :: 1.11", "Intended Audience :: System Administrators", "License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python :: 2", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.4", "Programming Language :: Python :: 3.5", "Programming Language :: Python :: 3.6", "Topic :: Communications :: Email", "Topic :: Internet :: WWW/HTTP"], "description": "Mailboxes migration using OfflineIMAP\n=====================================\n\nA simple `Kalabash <https://alphamonak.com/>`_ extension which provides a\nway to migrate existing mailboxes using `OfflineIMAP\n<http://offlineimap.org/>`_.\n\nHow does it work\n----------------\n\nThis extension mainly provides a cron script which periodically\nsynchronize user mailboxes from an existing IMAP server to a new\none. The workflow is pretty simple:\n\n* A user from the old server logs into Kalabash using the same credentials\n\n* A new account is automatically created and a new migration task is\n  created using the provided credentials\n\n* The cron script periodically synchronizes mailboxes corresponding to\n  migration tasks\n\n* Once a migration is done, it can be disabled through the admin panel\n\nInstallation\n------------\n\nInstall this extension system-wide or inside a virtual environment by\nrunning the following command::\n\n  $ python setup.py install\n\nThen, edit the ``settings.py`` file of your kalabash instance and\nadd ``kalabash_imap_migration`` inside the ``KALABASH_APPS`` variable\nlike this::\n\n  KALABASH_APPS = (\n    # ...\n    'kalabash_imap_migration',\n  )\n\nThen, add the following at the end of the file::\n\n  from kalabash_imap_migration import settings as kalabash_imap_migration_settings\n  kalabash_imap_migration_settings.apply(globals())\n\nRestart the python process running kalabash (uwsgi, gunicorn, apache,\nwhatever).\n\nRun the following commands to setup the database tables::\n\n  $ cd <kalabash_instance_dir>\n  $ python manage.py migrate kalabash_imap_migration\n  $ python manage.py load_initial_data\n\nYou also need to `install <http://offlineimap.org/doc/installation.html>`_ OfflineIMAP.\n\nConfiguration\n-------------\n\nAuthentication backend\n======================\n\n.. warning::\n\n   Please make sure automatic domain/mailbox creation is enabled,\n   otherwise the authentication won't work. Go to the online settings\n   panel (admin tab) and check your current state.\n\nAn IMAP authentication backend is provided by the extension and must\nbe enabled.\n\nEdit the ``settings.py`` file and modify the\n``AUTHENTICATION_BACKENDS`` variable as follows:\n\n.. sourcecode:: python\n\n  AUTHENTICATION_BACKENDS = (\n      'django.contrib.auth.backends.ModelBackend',\n      'kalabash_imap_migration.auth_backends.IMAPBackend',\n  )\n\ncron script\n===========\n\nThe synchronization script must be configured to run periodically on\nyour new server. Since it will copy mailboxes content to its final\ndestination, filesystem permissions must be respected. To do that, it\nmust be executed by the user which owns mailboxes (generally\n``vmail``).\n\nHere is a configuration example where the script is executed every\nhours. You can copy it inside the ``/etc/cron.d/kalabash`` file:\n\n.. sourcecode:: shell\n\n  PYTHON=/srv/kalabash/env/bin/python\n  INSTANCE=/srv/kalabash/instance\n\n  0       */1     *       *       *       vmail   cd /srv/vmail && $PYTHON $INSTANCE/manage.py generate_offlineimap_config --output .offlineimaprc && /usr/local/bin/offlineimap > /dev/null 2>&1\n\nFeel free to adapt it.\n\nHelper script for OfflineIMAP\n=============================\n\nOfflineIMAP will need a way to retrieve user passwords of the old\nserver. To do that, just copy the following Python code into a file\ncalled ``.offlineimap.py``:\n\n.. sourcecode:: python\n\n  import os\n  import site\n  import sys\n\n  site.addsitedir(\"/srv/kalabash/env/lib/python2.7/site-packages\")\n  sys.path.append(\"/srv/kalabash/instance\")\n  os.environ[\"DJANGO_SETTINGS_MODULE\"] = \"instance.settings\"\n\n  from django.apps import apps\n  from django.conf import settings\n  apps.populate(settings.INSTALLED_APPS)\n\n  from kalabash_imap_migration.models import Migration\n\n  def get_user_password(username):\n      \"\"\"Retrieve a password from Kalabash's database.\"\"\"\n      return Migration.objects.select_related().get(\n          mailbox__user__username=username\n      ).password\n\nThen, copy this file into the home directory of the user owning\nmailboxes (generally ``vmail``). For example:\n\n.. sourcecode:: shell\n\n  $ cp .offlineimap.py /srv/vmail\n  $ chown vmail:vmail /srv/vmail/.offlineimap.py\n\nOnline settings\n===============\n\nYou need to configure the access to the old IMAP server.\n\nAll the configuration is done from the admin panel (*Kalabash >\nParameters > IMAP migration*).", "description_content_type": "", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://alphamonak.com/", "keywords": "e,m,a,i,l", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "kalabash-imap-migration", "package_url": "https://pypi.org/project/kalabash-imap-migration/", "platform": "", "project_url": "https://pypi.org/project/kalabash-imap-migration/", "project_urls": {"Homepage": "https://alphamonak.com/"}, "release_url": "https://pypi.org/project/kalabash-imap-migration/1.2.6/", "requires_dist": null, "requires_python": "", "summary": "A plugin to migrate mailboxes using IMAP", "version": "1.2.6", "yanked": false, "html_description": "<div class=\"project-description\">\n            <div id=\"mailboxes-migration-using-offlineimap\">\n<h2>Mailboxes migration using OfflineIMAP</h2>\n<p>A simple <a href=\"https://alphamonak.com/\" rel=\"nofollow\">Kalabash</a> extension which provides a\nway to migrate existing mailboxes using <a href=\"http://offlineimap.org/\" rel=\"nofollow\">OfflineIMAP</a>.</p>\n<div id=\"how-does-it-work\">\n<h3>How does it work</h3>\n<p>This extension mainly provides a cron script which periodically\nsynchronize user mailboxes from an existing IMAP server to a new\none. The workflow is pretty simple:</p>\n<ul>\n<li>A user from the old server logs into Kalabash using the same credentials</li>\n<li>A new account is automatically created and a new migration task is\ncreated using the provided credentials</li>\n<li>The cron script periodically synchronizes mailboxes corresponding to\nmigration tasks</li>\n<li>Once a migration is done, it can be disabled through the admin panel</li>\n</ul>\n</div>\n<div id=\"installation\">\n<h3>Installation</h3>\n<p>Install this extension system-wide or inside a virtual environment by\nrunning the following command:</p>\n<pre>$ python setup.py install\n</pre>\n<p>Then, edit the <tt>settings.py</tt> file of your kalabash instance and\nadd <tt>kalabash_imap_migration</tt> inside the <tt>KALABASH_APPS</tt> variable\nlike this:</p>\n<pre>KALABASH_APPS = (\n  # ...\n  'kalabash_imap_migration',\n)\n</pre>\n<p>Then, add the following at the end of the file:</p>\n<pre>from kalabash_imap_migration import settings as kalabash_imap_migration_settings\nkalabash_imap_migration_settings.apply(globals())\n</pre>\n<p>Restart the python process running kalabash (uwsgi, gunicorn, apache,\nwhatever).</p>\n<p>Run the following commands to setup the database tables:</p>\n<pre>$ cd &lt;kalabash_instance_dir&gt;\n$ python manage.py migrate kalabash_imap_migration\n$ python manage.py load_initial_data\n</pre>\n<p>You also need to <a href=\"http://offlineimap.org/doc/installation.html\" rel=\"nofollow\">install</a> OfflineIMAP.</p>\n</div>\n<div id=\"configuration\">\n<h3>Configuration</h3>\n</div>\n</div>\n<div id=\"authentication-backend\">\n<h2>Authentication backend</h2>\n<div>\n<p>Warning</p>\n<p>Please make sure automatic domain/mailbox creation is enabled,\notherwise the authentication won\u2019t work. Go to the online settings\npanel (admin tab) and check your current state.</p>\n</div>\n<p>An IMAP authentication backend is provided by the extension and must\nbe enabled.</p>\n<p>Edit the <tt>settings.py</tt> file and modify the\n<tt>AUTHENTICATION_BACKENDS</tt> variable as follows:</p>\n<pre><span class=\"n\">AUTHENTICATION_BACKENDS</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n    <span class=\"s1\">'django.contrib.auth.backends.ModelBackend'</span><span class=\"p\">,</span>\n    <span class=\"s1\">'kalabash_imap_migration.auth_backends.IMAPBackend'</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n</pre>\n</div>\n<div id=\"cron-script\">\n<h2>cron script</h2>\n<p>The synchronization script must be configured to run periodically on\nyour new server. Since it will copy mailboxes content to its final\ndestination, filesystem permissions must be respected. To do that, it\nmust be executed by the user which owns mailboxes (generally\n<tt>vmail</tt>).</p>\n<p>Here is a configuration example where the script is executed every\nhours. You can copy it inside the <tt>/etc/cron.d/kalabash</tt> file:</p>\n<pre><span class=\"nv\">PYTHON</span><span class=\"o\">=</span>/srv/kalabash/env/bin/python\n<span class=\"nv\">INSTANCE</span><span class=\"o\">=</span>/srv/kalabash/instance\n\n<span class=\"m\">0</span>       */1     *       *       *       vmail   <span class=\"nb\">cd</span> /srv/vmail <span class=\"o\">&amp;&amp;</span> <span class=\"nv\">$PYTHON</span> <span class=\"nv\">$INSTANCE</span>/manage.py generate_offlineimap_config --output .offlineimaprc <span class=\"o\">&amp;&amp;</span> /usr/local/bin/offlineimap &gt; /dev/null <span class=\"m\">2</span>&gt;<span class=\"p\">&amp;</span><span class=\"m\">1</span>\n</pre>\n<p>Feel free to adapt it.</p>\n</div>\n<div id=\"helper-script-for-offlineimap\">\n<h2>Helper script for OfflineIMAP</h2>\n<p>OfflineIMAP will need a way to retrieve user passwords of the old\nserver. To do that, just copy the following Python code into a file\ncalled <tt>.offlineimap.py</tt>:</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n<span class=\"kn\">import</span> <span class=\"nn\">site</span>\n<span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n\n<span class=\"n\">site</span><span class=\"o\">.</span><span class=\"n\">addsitedir</span><span class=\"p\">(</span><span class=\"s2\">\"/srv/kalabash/env/lib/python2.7/site-packages\"</span><span class=\"p\">)</span>\n<span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"s2\">\"/srv/kalabash/instance\"</span><span class=\"p\">)</span>\n<span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"p\">[</span><span class=\"s2\">\"DJANGO_SETTINGS_MODULE\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"instance.settings\"</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django.apps</span> <span class=\"kn\">import</span> <span class=\"n\">apps</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.conf</span> <span class=\"kn\">import</span> <span class=\"n\">settings</span>\n<span class=\"n\">apps</span><span class=\"o\">.</span><span class=\"n\">populate</span><span class=\"p\">(</span><span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">INSTALLED_APPS</span><span class=\"p\">)</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">kalabash_imap_migration.models</span> <span class=\"kn\">import</span> <span class=\"n\">Migration</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">get_user_password</span><span class=\"p\">(</span><span class=\"n\">username</span><span class=\"p\">):</span>\n    <span class=\"sd\">\"\"\"Retrieve a password from Kalabash's database.\"\"\"</span>\n    <span class=\"k\">return</span> <span class=\"n\">Migration</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">select_related</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span>\n        <span class=\"n\">mailbox__user__username</span><span class=\"o\">=</span><span class=\"n\">username</span>\n    <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">password</span>\n</pre>\n<p>Then, copy this file into the home directory of the user owning\nmailboxes (generally <tt>vmail</tt>). For example:</p>\n<pre>$ cp .offlineimap.py /srv/vmail\n$ chown vmail:vmail /srv/vmail/.offlineimap.py\n</pre>\n</div>\n<div id=\"online-settings\">\n<h2>Online settings</h2>\n<p>You need to configure the access to the old IMAP server.</p>\n<p>All the configuration is done from the admin panel (<em>Kalabash &gt;\nParameters &gt; IMAP migration</em>).</p>\n</div>\n\n          </div>"}, "last_serial": 5903284, "releases": {"1.2.3": [{"comment_text": "", "digests": {"md5": "02a9ab204af94fd681d808921c919db1", "sha256": "b2d8fc48ef45ea871bb5d64a3560927dedc05c9de8261e09cf987275de75c616"}, "downloads": -1, "filename": "kalabash-imap-migration-1.2.3.tar.gz", "has_sig": false, "md5_digest": "02a9ab204af94fd681d808921c919db1", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 13492, "upload_time": "2018-11-22T22:53:53", "upload_time_iso_8601": "2018-11-22T22:53:53.694801Z", "url": "https://files.pythonhosted.org/packages/be/aa/18e0faeae7b16011c1c7b0cac2b2afa9c40ed2400a77afa5cea4f44ee34b/kalabash-imap-migration-1.2.3.tar.gz", "yanked": false}], "1.2.5": [{"comment_text": "", "digests": {"md5": "77f7aed35e3285f91a397ae2209882a7", "sha256": "ca8a0f77210f5dcea0f16190f886dd5eb236dcc017c4b3e8e4992f4179065efc"}, "downloads": -1, "filename": "kalabash-imap-migration-1.2.5.tar.gz", "has_sig": false, "md5_digest": "77f7aed35e3285f91a397ae2209882a7", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 9560, "upload_time": "2019-01-19T08:00:37", "upload_time_iso_8601": "2019-01-19T08:00:37.425506Z", "url": "https://files.pythonhosted.org/packages/5d/c0/f5488483c6d55d307bdc78fdbcc527ba5024a1cc9ee7f7c831a6dba1569a/kalabash-imap-migration-1.2.5.tar.gz", "yanked": false}], "1.2.6": [{"comment_text": "", "digests": {"md5": "ada7a7aad169ee02343ecd2ae6ba9185", "sha256": "972c8febc833d8ba8974bd88c315469601ca3f9662fb5936772f8d2f91b7db90"}, "downloads": -1, "filename": "kalabash-imap-migration-1.2.6.tar.gz", "has_sig": false, "md5_digest": "ada7a7aad169ee02343ecd2ae6ba9185", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 105563, "upload_time": "2019-09-29T17:54:26", "upload_time_iso_8601": "2019-09-29T17:54:26.388874Z", "url": "https://files.pythonhosted.org/packages/27/aa/357cdd25b8c075fddb1f7675c33ba5c7cc5e5a9c888a2eb089cf3792d09b/kalabash-imap-migration-1.2.6.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "ada7a7aad169ee02343ecd2ae6ba9185", "sha256": "972c8febc833d8ba8974bd88c315469601ca3f9662fb5936772f8d2f91b7db90"}, "downloads": -1, "filename": "kalabash-imap-migration-1.2.6.tar.gz", "has_sig": false, "md5_digest": "ada7a7aad169ee02343ecd2ae6ba9185", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 105563, "upload_time": "2019-09-29T17:54:26", "upload_time_iso_8601": "2019-09-29T17:54:26.388874Z", "url": "https://files.pythonhosted.org/packages/27/aa/357cdd25b8c075fddb1f7675c33ba5c7cc5e5a9c888a2eb089cf3792d09b/kalabash-imap-migration-1.2.6.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:50:46 2020"}