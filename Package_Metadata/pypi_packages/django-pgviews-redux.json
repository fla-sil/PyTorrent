{"info": {"author": "Mikul\u00e1\u0161 Poul", "author_email": "mikulaspoul@gmail.com", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Framework :: Django", "Framework :: Django :: 2.0", "Framework :: Django :: 3.0", "Programming Language :: Python", "Programming Language :: Python :: 3"], "description": "# SQL Views for Postgres\n\n[![Circle CI](https://circleci.com/gh/mikicz/django-pgviews.png)](https://circleci.com/gh/mikicz/django-pgviews)\n[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)\n\nAdds first-class support for [PostgreSQL Views][pg-views] in the Django ORM.\nFor of the original [django-pgviews][django-pgviews] by [mypebble][mypebble] with support for Django 2.2+.\n\n[pg-views]: http://www.postgresql.org/docs/9.1/static/sql-createview.html\n[django-pgviews]: https://github.com/mypebble/django-pgviews\n[mypebble]: https://github.com/mypebble\n\n## Installation\n\nInstall via pip:\n\n    pip install django-pgviews-redux\n\nAdd to installed applications in settings.py:\n\n```python\nINSTALLED_APPS = (\n  # ...\n  'django_pgviews',\n)\n```\n\n## Examples\n\n```python\nfrom django.db import models\n\nfrom django_pgviews import view as pg\n\n\nclass Customer(models.Model):\n    name = models.CharField(max_length=100)\n    post_code = models.CharField(max_length=20)\n    is_preferred = models.BooleanField(default=False)\n\n    class Meta:\n        app_label = 'myapp'\n\nclass PreferredCustomer(pg.View):\n    projection = ['myapp.Customer.*',]\n    dependencies = ['myapp.OtherView',]\n    sql = \"\"\"SELECT * FROM myapp_customer WHERE is_preferred = TRUE;\"\"\"\n\n    class Meta:\n      app_label = 'myapp'\n      db_table = 'myapp_preferredcustomer'\n      managed = False\n```\n\n**NOTE** It is important that we include the `managed = False` in the `Meta` so\nDjango 1.7 migrations don't attempt to create DB tables for this view.\n\nThe SQL produced by this might look like:\n\n```postgresql\nCREATE VIEW myapp_preferredcustomer AS\nSELECT * FROM myapp_customer WHERE is_preferred = TRUE;\n```\n\nTo create all your views, run ``python manage.py sync_pgviews``\n\nYou can also specify field names, which will map onto fields in your View:\n\n```python\nfrom django_pgviews import view as pg\n\n\nVIEW_SQL = \"\"\"\n    SELECT name, post_code FROM myapp_customer WHERE is_preferred = TRUE\n\"\"\"\n\n\nclass PreferredCustomer(pg.View):\n    name = models.CharField(max_length=100)\n    post_code = models.CharField(max_length=20)\n\n    sql = VIEW_SQL\n```\n\n## Usage\n\nTo map onto a View, simply extend `pg_views.view.View`, assign SQL to the\n`sql` argument and define a `db_table`. You must _always_ set `managed = False`\non the `Meta` class.\n\nViews can be created in a number of ways:\n\n1. Define fields to map onto the VIEW output\n2. Define a projection that describes the VIEW fields\n\n### Define Fields\n\nDefine the fields as you would with any Django Model:\n\n```python\nfrom django_pgviews import view as pg\n\n\nVIEW_SQL = \"\"\"\n    SELECT name, post_code FROM myapp_customer WHERE is_preferred = TRUE\n\"\"\"\n\n\nclass PreferredCustomer(pg.View):\n    name = models.CharField(max_length=100)\n    post_code = models.CharField(max_length=20)\n\n    sql = VIEW_SQL\n\n    class Meta:\n      managed = False\n      db_table = 'my_sql_view'\n```\n\n### Define Projection\n\n`django-pgviews` can take a projection to figure out what fields it needs to\nmap onto for a view. To use this, set the `projection` attribute:\n\n```python\nfrom django_pgviews import view as pg\n\n\nclass PreferredCustomer(pg.View):\n    projection = ['myapp.Customer.*',]\n    sql = \"\"\"SELECT * FROM myapp_customer WHERE is_preferred = TRUE;\"\"\"\n\n    class Meta:\n      db_table = 'my_sql_view'\n      managed = False\n```\n\nThis will take all fields on `myapp.Customer` and apply them to\n`PreferredCustomer`\n\n## Features\n\n### Updating Views\n\nSometimes your models change and you need your Database Views to reflect the new\ndata. Updating the View logic is as simple as modifying the underlying SQL and\nrunning:\n\n```\npython manage.py sync_pgviews --force\n```\n\nThis will forcibly update any views that conflict with your new SQL.\n\n### Dependencies\n\nYou can specify other views you depend on. This ensures the other views are\ninstalled beforehand. Using dependencies also ensures that your views get\nrefreshed correctly when using `sync_pgviews --force`.\n\n**Note:** Views are synced after the Django application has migrated and adding\nmodels to the dependency list will cause syncing to fail.\n\nExample:\n\n```python\nfrom django_pgviews import view as pg\n\nclass PreferredCustomer(pg.View):\n    dependencies = ['myapp.OtherView',]\n    sql = \"\"\"SELECT * FROM myapp_customer WHERE is_preferred = TRUE;\"\"\"\n\n    class Meta:\n      app_label = 'myapp'\n      db_table = 'myapp_preferredcustomer'\n      managed = False\n```\n\n### Materialized Views\n\nPostgres 9.3 and up supports [materialized views](http://www.postgresql.org/docs/current/static/sql-creatematerializedview.html)\nwhich allow you to cache the results of views, potentially allowing them\nto load faster.\n\nHowever, you do need to manually refresh the view. To do this automatically,\nyou can attach [signals](https://docs.djangoproject.com/en/1.8/ref/signals/)\nand call the refresh function.\n\nExample:\n\n```python\nfrom django_pgviews import view as pg\n\n\nVIEW_SQL = \"\"\"\n    SELECT name, post_code FROM myapp_customer WHERE is_preferred = TRUE\n\"\"\"\n\nclass Customer(models.Model):\n    name = models.CharField(max_length=100)\n    post_code = models.CharField(max_length=20)\n    is_preferred = models.BooleanField(default=True)\n\n\nclass PreferredCustomer(pg.MaterializedView):\n    name = models.CharField(max_length=100)\n    post_code = models.CharField(max_length=20)\n\n    sql = VIEW_SQL\n\n\n@receiver(post_save, sender=Customer)\ndef customer_saved(sender, action=None, instance=None, **kwargs):\n    PreferredCustomer.refresh()\n```\n\nPostgres 9.4 and up allow materialized views to be refreshed concurrently, without blocking reads, as long as a\nunique index exists on the materialized view. To enable concurrent refresh, specify the name of a column that can be\nused as a unique index on the materialized view. Unique index can be defined on more than one column of a materialized \nview. Once enabled, passing `concurrently=True` to the model's refresh method will result in postgres performing the \nrefresh concurrently. (Note that the refresh method itself blocks until the refresh is complete; concurrent refresh is \nmost useful when materialized views are updated in another process or thread.)\n\nExample:\n\n```python\nfrom django_pgviews import view as pg\n\n\nVIEW_SQL = \"\"\"\n    SELECT id, name, post_code FROM myapp_customer WHERE is_preferred = TRUE\n\"\"\"\n\nclass PreferredCustomer(pg.MaterializedView):\n    concurrent_index = 'id, post_code'\n    sql = VIEW_SQL\n\n    name = models.CharField(max_length=100)\n    post_code = models.CharField(max_length=20)\n\n\n@receiver(post_save, sender=Customer)\ndef customer_saved(sender, action=None, instance=None, **kwargs):\n    PreferredCustomer.refresh(concurrently=True)\n```\n\n### Custom Schema\n\nYou can define any table name you wish for your views. They can even live inside your own custom\n[PostgreSQL schema](http://www.postgresql.org/docs/current/static/ddl-schemas.html).\n\n```python\nfrom django_pgviews import view as pg\n\n\nclass PreferredCustomer(pg.View):\n    sql = \"\"\"SELECT * FROM myapp_customer WHERE is_preferred = TRUE;\"\"\"\n\n    class Meta:\n      db_table = 'my_custom_schema.preferredcustomer'\n      managed = False\n```\n\n### Sync Listeners\n\ndjango-pgviews 0.5.0 adds the ability to listen to when a `post_sync` event has\noccurred.\n\n#### `view_synced`\n\nFired every time a VIEW is synchronised with the database.\n\nProvides args:\n* `sender` - View Class\n* `update` - Whether the view to be updated\n* `force` - Whether `force` was passed\n* `status` - The result of creating the view e.g. `EXISTS`, `FORCE_REQUIRED`\n* `has_changed` - Whether the view had to change\n\n#### `all_views_synced`\n\nSent after all Postgres VIEWs are synchronised.\n\nProvides args:\n* `sender` - Always `None`\n\n\n## Django Compatibility\n\n<table>\n  <thead>\n    <tr>\n      <th>Django Version</th>\n      <th>Django-PGView Version</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>1.4 and down</td>\n      <td>Unsupported</td>\n    </tr>\n    <tr>\n      <td>1.5</td>\n      <td>0.0.1</td>\n    </tr>\n    <tr>\n      <td>1.6</td>\n      <td>0.0.3</td>\n    </tr>\n    <tr>\n      <td>1.7</td>\n      <td>0.0.4</td>\n    </tr>\n    <tr>\n      <td>1.9</td>\n      <td>0.1.0</td>\n    </tr>\n    <tr>\n      <td>1.10</td>\n      <td>0.2.0</td>\n    </tr>\n    <tr>\n      <td>2.2</td>\n      <td>0.6.0</td>\n    </tr>\n    <tr>\n      <td>3.0</td>\n      <td>0.6.0</td>\n    </tr>\n  </tbody>\n</table>\n\n### Django 1.7 Note\n\nDjango 1.7 changed how models are loaded so that it's no longer possible to do\n`sql = str(User.objects.all().query)` because the dependent models aren't\nyet loaded by Django.\n\n### Django 1.9 Note\n\nYou now have to use the `.view` module directly.\n\n### Django 1.10 Note\n\nWhen updating to Django 1.10, if you see `AttributeError: can't set attribute`\nwhen you try to migrate or run tests, you need to check your migrations for\nwhere `_base_manager` or `_default_manager` get set on the model and replace it\nwith `objects` inside the migration.\n\nThis also applies to [Django MPTT](https://django-mptt.github.io/django-mptt/upgrade.html#id1)\nwho have covered this in a bit more detail.\n\n## Python 3 Support\n\nDjango PGViews Redux only supports Python 3.6+.\n\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/mikicz/django-pgviews", "keywords": "", "license": "Public Domain", "maintainer": "", "maintainer_email": "", "name": "django-pgviews-redux", "package_url": "https://pypi.org/project/django-pgviews-redux/", "platform": "", "project_url": "https://pypi.org/project/django-pgviews-redux/", "project_urls": {"Homepage": "https://github.com/mikicz/django-pgviews"}, "release_url": "https://pypi.org/project/django-pgviews-redux/0.6.0/", "requires_dist": null, "requires_python": "", "summary": "Create and manage Postgres SQL Views in Django", "version": "0.6.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>SQL Views for Postgres</h1>\n<p><a href=\"https://circleci.com/gh/mikicz/django-pgviews\" rel=\"nofollow\"><img alt=\"Circle CI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/1f7ae06cbda57dd29e5856e2dda44358e6e57a7b/68747470733a2f2f636972636c6563692e636f6d2f67682f6d696b69637a2f646a616e676f2d706776696577732e706e67\"></a>\n<a href=\"https://github.com/psf/black\" rel=\"nofollow\"><img alt=\"Code style: black\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/fbfdc7754183ecf079bc71ddeabaf88f6cbc5c00/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f64652532307374796c652d626c61636b2d3030303030302e737667\"></a></p>\n<p>Adds first-class support for <a href=\"http://www.postgresql.org/docs/9.1/static/sql-createview.html\" rel=\"nofollow\">PostgreSQL Views</a> in the Django ORM.\nFor of the original <a href=\"https://github.com/mypebble/django-pgviews\" rel=\"nofollow\">django-pgviews</a> by <a href=\"https://github.com/mypebble\" rel=\"nofollow\">mypebble</a> with support for Django 2.2+.</p>\n<h2>Installation</h2>\n<p>Install via pip:</p>\n<pre><code>pip install django-pgviews-redux\n</code></pre>\n<p>Add to installed applications in settings.py:</p>\n<pre><span class=\"n\">INSTALLED_APPS</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n  <span class=\"c1\"># ...</span>\n  <span class=\"s1\">'django_pgviews'</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n</pre>\n<h2>Examples</h2>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django.db</span> <span class=\"kn\">import</span> <span class=\"n\">models</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django_pgviews</span> <span class=\"kn\">import</span> <span class=\"n\">view</span> <span class=\"k\">as</span> <span class=\"n\">pg</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Customer</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n    <span class=\"n\">post_code</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n    <span class=\"n\">is_preferred</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">BooleanField</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"s1\">'myapp'</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">PreferredCustomer</span><span class=\"p\">(</span><span class=\"n\">pg</span><span class=\"o\">.</span><span class=\"n\">View</span><span class=\"p\">):</span>\n    <span class=\"n\">projection</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">'myapp.Customer.*'</span><span class=\"p\">,]</span>\n    <span class=\"n\">dependencies</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">'myapp.OtherView'</span><span class=\"p\">,]</span>\n    <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"s2\">\"\"\"SELECT * FROM myapp_customer WHERE is_preferred = TRUE;\"\"\"</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n      <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"s1\">'myapp'</span>\n      <span class=\"n\">db_table</span> <span class=\"o\">=</span> <span class=\"s1\">'myapp_preferredcustomer'</span>\n      <span class=\"n\">managed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n</pre>\n<p><strong>NOTE</strong> It is important that we include the <code>managed = False</code> in the <code>Meta</code> so\nDjango 1.7 migrations don't attempt to create DB tables for this view.</p>\n<p>The SQL produced by this might look like:</p>\n<pre><span class=\"k\">CREATE</span> <span class=\"k\">VIEW</span> <span class=\"n\">myapp_preferredcustomer</span> <span class=\"k\">AS</span>\n<span class=\"k\">SELECT</span> <span class=\"o\">*</span> <span class=\"k\">FROM</span> <span class=\"n\">myapp_customer</span> <span class=\"k\">WHERE</span> <span class=\"n\">is_preferred</span> <span class=\"o\">=</span> <span class=\"k\">TRUE</span><span class=\"p\">;</span>\n</pre>\n<p>To create all your views, run <code>python manage.py sync_pgviews</code></p>\n<p>You can also specify field names, which will map onto fields in your View:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_pgviews</span> <span class=\"kn\">import</span> <span class=\"n\">view</span> <span class=\"k\">as</span> <span class=\"n\">pg</span>\n\n\n<span class=\"n\">VIEW_SQL</span> <span class=\"o\">=</span> <span class=\"s2\">\"\"\"</span>\n<span class=\"s2\">    SELECT name, post_code FROM myapp_customer WHERE is_preferred = TRUE</span>\n<span class=\"s2\">\"\"\"</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PreferredCustomer</span><span class=\"p\">(</span><span class=\"n\">pg</span><span class=\"o\">.</span><span class=\"n\">View</span><span class=\"p\">):</span>\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n    <span class=\"n\">post_code</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n\n    <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"n\">VIEW_SQL</span>\n</pre>\n<h2>Usage</h2>\n<p>To map onto a View, simply extend <code>pg_views.view.View</code>, assign SQL to the\n<code>sql</code> argument and define a <code>db_table</code>. You must <em>always</em> set <code>managed = False</code>\non the <code>Meta</code> class.</p>\n<p>Views can be created in a number of ways:</p>\n<ol>\n<li>Define fields to map onto the VIEW output</li>\n<li>Define a projection that describes the VIEW fields</li>\n</ol>\n<h3>Define Fields</h3>\n<p>Define the fields as you would with any Django Model:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_pgviews</span> <span class=\"kn\">import</span> <span class=\"n\">view</span> <span class=\"k\">as</span> <span class=\"n\">pg</span>\n\n\n<span class=\"n\">VIEW_SQL</span> <span class=\"o\">=</span> <span class=\"s2\">\"\"\"</span>\n<span class=\"s2\">    SELECT name, post_code FROM myapp_customer WHERE is_preferred = TRUE</span>\n<span class=\"s2\">\"\"\"</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PreferredCustomer</span><span class=\"p\">(</span><span class=\"n\">pg</span><span class=\"o\">.</span><span class=\"n\">View</span><span class=\"p\">):</span>\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n    <span class=\"n\">post_code</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n\n    <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"n\">VIEW_SQL</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n      <span class=\"n\">managed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n      <span class=\"n\">db_table</span> <span class=\"o\">=</span> <span class=\"s1\">'my_sql_view'</span>\n</pre>\n<h3>Define Projection</h3>\n<p><code>django-pgviews</code> can take a projection to figure out what fields it needs to\nmap onto for a view. To use this, set the <code>projection</code> attribute:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_pgviews</span> <span class=\"kn\">import</span> <span class=\"n\">view</span> <span class=\"k\">as</span> <span class=\"n\">pg</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PreferredCustomer</span><span class=\"p\">(</span><span class=\"n\">pg</span><span class=\"o\">.</span><span class=\"n\">View</span><span class=\"p\">):</span>\n    <span class=\"n\">projection</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">'myapp.Customer.*'</span><span class=\"p\">,]</span>\n    <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"s2\">\"\"\"SELECT * FROM myapp_customer WHERE is_preferred = TRUE;\"\"\"</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n      <span class=\"n\">db_table</span> <span class=\"o\">=</span> <span class=\"s1\">'my_sql_view'</span>\n      <span class=\"n\">managed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n</pre>\n<p>This will take all fields on <code>myapp.Customer</code> and apply them to\n<code>PreferredCustomer</code></p>\n<h2>Features</h2>\n<h3>Updating Views</h3>\n<p>Sometimes your models change and you need your Database Views to reflect the new\ndata. Updating the View logic is as simple as modifying the underlying SQL and\nrunning:</p>\n<pre><code>python manage.py sync_pgviews --force\n</code></pre>\n<p>This will forcibly update any views that conflict with your new SQL.</p>\n<h3>Dependencies</h3>\n<p>You can specify other views you depend on. This ensures the other views are\ninstalled beforehand. Using dependencies also ensures that your views get\nrefreshed correctly when using <code>sync_pgviews --force</code>.</p>\n<p><strong>Note:</strong> Views are synced after the Django application has migrated and adding\nmodels to the dependency list will cause syncing to fail.</p>\n<p>Example:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_pgviews</span> <span class=\"kn\">import</span> <span class=\"n\">view</span> <span class=\"k\">as</span> <span class=\"n\">pg</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">PreferredCustomer</span><span class=\"p\">(</span><span class=\"n\">pg</span><span class=\"o\">.</span><span class=\"n\">View</span><span class=\"p\">):</span>\n    <span class=\"n\">dependencies</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">'myapp.OtherView'</span><span class=\"p\">,]</span>\n    <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"s2\">\"\"\"SELECT * FROM myapp_customer WHERE is_preferred = TRUE;\"\"\"</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n      <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"s1\">'myapp'</span>\n      <span class=\"n\">db_table</span> <span class=\"o\">=</span> <span class=\"s1\">'myapp_preferredcustomer'</span>\n      <span class=\"n\">managed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n</pre>\n<h3>Materialized Views</h3>\n<p>Postgres 9.3 and up supports <a href=\"http://www.postgresql.org/docs/current/static/sql-creatematerializedview.html\" rel=\"nofollow\">materialized views</a>\nwhich allow you to cache the results of views, potentially allowing them\nto load faster.</p>\n<p>However, you do need to manually refresh the view. To do this automatically,\nyou can attach <a href=\"https://docs.djangoproject.com/en/1.8/ref/signals/\" rel=\"nofollow\">signals</a>\nand call the refresh function.</p>\n<p>Example:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_pgviews</span> <span class=\"kn\">import</span> <span class=\"n\">view</span> <span class=\"k\">as</span> <span class=\"n\">pg</span>\n\n\n<span class=\"n\">VIEW_SQL</span> <span class=\"o\">=</span> <span class=\"s2\">\"\"\"</span>\n<span class=\"s2\">    SELECT name, post_code FROM myapp_customer WHERE is_preferred = TRUE</span>\n<span class=\"s2\">\"\"\"</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Customer</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n    <span class=\"n\">post_code</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n    <span class=\"n\">is_preferred</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">BooleanField</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PreferredCustomer</span><span class=\"p\">(</span><span class=\"n\">pg</span><span class=\"o\">.</span><span class=\"n\">MaterializedView</span><span class=\"p\">):</span>\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n    <span class=\"n\">post_code</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n\n    <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"n\">VIEW_SQL</span>\n\n\n<span class=\"nd\">@receiver</span><span class=\"p\">(</span><span class=\"n\">post_save</span><span class=\"p\">,</span> <span class=\"n\">sender</span><span class=\"o\">=</span><span class=\"n\">Customer</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">customer_saved</span><span class=\"p\">(</span><span class=\"n\">sender</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"n\">PreferredCustomer</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">()</span>\n</pre>\n<p>Postgres 9.4 and up allow materialized views to be refreshed concurrently, without blocking reads, as long as a\nunique index exists on the materialized view. To enable concurrent refresh, specify the name of a column that can be\nused as a unique index on the materialized view. Unique index can be defined on more than one column of a materialized\nview. Once enabled, passing <code>concurrently=True</code> to the model's refresh method will result in postgres performing the\nrefresh concurrently. (Note that the refresh method itself blocks until the refresh is complete; concurrent refresh is\nmost useful when materialized views are updated in another process or thread.)</p>\n<p>Example:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_pgviews</span> <span class=\"kn\">import</span> <span class=\"n\">view</span> <span class=\"k\">as</span> <span class=\"n\">pg</span>\n\n\n<span class=\"n\">VIEW_SQL</span> <span class=\"o\">=</span> <span class=\"s2\">\"\"\"</span>\n<span class=\"s2\">    SELECT id, name, post_code FROM myapp_customer WHERE is_preferred = TRUE</span>\n<span class=\"s2\">\"\"\"</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">PreferredCustomer</span><span class=\"p\">(</span><span class=\"n\">pg</span><span class=\"o\">.</span><span class=\"n\">MaterializedView</span><span class=\"p\">):</span>\n    <span class=\"n\">concurrent_index</span> <span class=\"o\">=</span> <span class=\"s1\">'id, post_code'</span>\n    <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"n\">VIEW_SQL</span>\n\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n    <span class=\"n\">post_code</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">(</span><span class=\"n\">max_length</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@receiver</span><span class=\"p\">(</span><span class=\"n\">post_save</span><span class=\"p\">,</span> <span class=\"n\">sender</span><span class=\"o\">=</span><span class=\"n\">Customer</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">customer_saved</span><span class=\"p\">(</span><span class=\"n\">sender</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"n\">PreferredCustomer</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">(</span><span class=\"n\">concurrently</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre>\n<h3>Custom Schema</h3>\n<p>You can define any table name you wish for your views. They can even live inside your own custom\n<a href=\"http://www.postgresql.org/docs/current/static/ddl-schemas.html\" rel=\"nofollow\">PostgreSQL schema</a>.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_pgviews</span> <span class=\"kn\">import</span> <span class=\"n\">view</span> <span class=\"k\">as</span> <span class=\"n\">pg</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PreferredCustomer</span><span class=\"p\">(</span><span class=\"n\">pg</span><span class=\"o\">.</span><span class=\"n\">View</span><span class=\"p\">):</span>\n    <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"s2\">\"\"\"SELECT * FROM myapp_customer WHERE is_preferred = TRUE;\"\"\"</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n      <span class=\"n\">db_table</span> <span class=\"o\">=</span> <span class=\"s1\">'my_custom_schema.preferredcustomer'</span>\n      <span class=\"n\">managed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n</pre>\n<h3>Sync Listeners</h3>\n<p>django-pgviews 0.5.0 adds the ability to listen to when a <code>post_sync</code> event has\noccurred.</p>\n<h4><code>view_synced</code></h4>\n<p>Fired every time a VIEW is synchronised with the database.</p>\n<p>Provides args:</p>\n<ul>\n<li><code>sender</code> - View Class</li>\n<li><code>update</code> - Whether the view to be updated</li>\n<li><code>force</code> - Whether <code>force</code> was passed</li>\n<li><code>status</code> - The result of creating the view e.g. <code>EXISTS</code>, <code>FORCE_REQUIRED</code></li>\n<li><code>has_changed</code> - Whether the view had to change</li>\n</ul>\n<h4><code>all_views_synced</code></h4>\n<p>Sent after all Postgres VIEWs are synchronised.</p>\n<p>Provides args:</p>\n<ul>\n<li><code>sender</code> - Always <code>None</code></li>\n</ul>\n<h2>Django Compatibility</h2>\n<table>\n  <thead>\n    <tr>\n      <th>Django Version</th>\n      <th>Django-PGView Version</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>1.4 and down</td>\n      <td>Unsupported</td>\n    </tr>\n    <tr>\n      <td>1.5</td>\n      <td>0.0.1</td>\n    </tr>\n    <tr>\n      <td>1.6</td>\n      <td>0.0.3</td>\n    </tr>\n    <tr>\n      <td>1.7</td>\n      <td>0.0.4</td>\n    </tr>\n    <tr>\n      <td>1.9</td>\n      <td>0.1.0</td>\n    </tr>\n    <tr>\n      <td>1.10</td>\n      <td>0.2.0</td>\n    </tr>\n    <tr>\n      <td>2.2</td>\n      <td>0.6.0</td>\n    </tr>\n    <tr>\n      <td>3.0</td>\n      <td>0.6.0</td>\n    </tr>\n  </tbody>\n</table>\n<h3>Django 1.7 Note</h3>\n<p>Django 1.7 changed how models are loaded so that it's no longer possible to do\n<code>sql = str(User.objects.all().query)</code> because the dependent models aren't\nyet loaded by Django.</p>\n<h3>Django 1.9 Note</h3>\n<p>You now have to use the <code>.view</code> module directly.</p>\n<h3>Django 1.10 Note</h3>\n<p>When updating to Django 1.10, if you see <code>AttributeError: can't set attribute</code>\nwhen you try to migrate or run tests, you need to check your migrations for\nwhere <code>_base_manager</code> or <code>_default_manager</code> get set on the model and replace it\nwith <code>objects</code> inside the migration.</p>\n<p>This also applies to <a href=\"https://django-mptt.github.io/django-mptt/upgrade.html#id1\" rel=\"nofollow\">Django MPTT</a>\nwho have covered this in a bit more detail.</p>\n<h2>Python 3 Support</h2>\n<p>Django PGViews Redux only supports Python 3.6+.</p>\n\n          </div>"}, "last_serial": 6761174, "releases": {"0.6.0": [{"comment_text": "", "digests": {"md5": "c79b21dfaa8a117cc30f622e79f9a4f3", "sha256": "0008a50e4df49d5eea2e5428f23fa11bc425c47fb4c844ce017c0189e3578b99"}, "downloads": -1, "filename": "django_pgviews_redux-0.6.0-py3-none-any.whl", "has_sig": false, "md5_digest": "c79b21dfaa8a117cc30f622e79f9a4f3", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 13160, "upload_time": "2020-03-06T11:06:02", "upload_time_iso_8601": "2020-03-06T11:06:02.537487Z", "url": "https://files.pythonhosted.org/packages/33/c4/e725cba5c55565df1d272d2992d97be497f08f7a9de6d810aa75d02f2cbb/django_pgviews_redux-0.6.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "1f3c20a8f3e6bb51d7a784fae65bd5b4", "sha256": "1e870c8274b3eca3492d0eb39e00924426d6896ec44612de0a2e9f36fe455b9a"}, "downloads": -1, "filename": "django-pgviews-redux-0.6.0.tar.gz", "has_sig": false, "md5_digest": "1f3c20a8f3e6bb51d7a784fae65bd5b4", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 13285, "upload_time": "2020-03-06T11:06:04", "upload_time_iso_8601": "2020-03-06T11:06:04.842763Z", "url": "https://files.pythonhosted.org/packages/eb/c6/693ac962b69ee1cdcc3325bae0ec0b6860ae489d35710a38d5d179843f3f/django-pgviews-redux-0.6.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "c79b21dfaa8a117cc30f622e79f9a4f3", "sha256": "0008a50e4df49d5eea2e5428f23fa11bc425c47fb4c844ce017c0189e3578b99"}, "downloads": -1, "filename": "django_pgviews_redux-0.6.0-py3-none-any.whl", "has_sig": false, "md5_digest": "c79b21dfaa8a117cc30f622e79f9a4f3", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 13160, "upload_time": "2020-03-06T11:06:02", "upload_time_iso_8601": "2020-03-06T11:06:02.537487Z", "url": "https://files.pythonhosted.org/packages/33/c4/e725cba5c55565df1d272d2992d97be497f08f7a9de6d810aa75d02f2cbb/django_pgviews_redux-0.6.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "1f3c20a8f3e6bb51d7a784fae65bd5b4", "sha256": "1e870c8274b3eca3492d0eb39e00924426d6896ec44612de0a2e9f36fe455b9a"}, "downloads": -1, "filename": "django-pgviews-redux-0.6.0.tar.gz", "has_sig": false, "md5_digest": "1f3c20a8f3e6bb51d7a784fae65bd5b4", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 13285, "upload_time": "2020-03-06T11:06:04", "upload_time_iso_8601": "2020-03-06T11:06:04.842763Z", "url": "https://files.pythonhosted.org/packages/eb/c6/693ac962b69ee1cdcc3325bae0ec0b6860ae489d35710a38d5d179843f3f/django-pgviews-redux-0.6.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:55:04 2020"}