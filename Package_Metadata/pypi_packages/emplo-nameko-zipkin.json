{"info": {"author": "Maxim Kiyan <maxim.k@fraglab.com>, Zbigniew Siciarz <zbigniew.siciarz@emplocity.pl>", "author_email": "", "bugtrack_url": null, "classifiers": [], "description": "emplocity-nameko-zipkin\n-------------\n\nZipkin tracing for nameko framework\n\nInstall\n-------\n\n```\npip install emplocity-nameko-zipkin\n```\n\nUsage\n-----\n\n#### Services\n\n```python\nfrom nameko_zipkin import Zipkin\nfrom nameko.rpc import rpc\n\n\nclass Service:\n    name = 'service'\n    zipkin = Zipkin() # Dependency provider injects py_zipkin.zipkin.zipkin_span object\n    \n    @rpc\n    def method(self):\n        assert self.zipkin.service_name == Service.name\n        assert self.zipkin.span_name == Service.method.__name__\n```\n\n#### Standalone rpc\n\n```python\nfrom py_zipkin import zipkin\nfrom nameko_zipkin import monkey_patch\nfrom nameko_zipkin.transport import HttpHandler\nfrom nameko.standalone.rpc import ClusterRpcProxy\n\n\nhandler = HttpHandler('http://localhost:9411/api/v1/spans').handle\nmonkey_patch(handler)\n\nwith zipkin.zipkin_server_span('RootService',\n                               'RootMethod',\n                               sample_rate=100.,\n                               transport_handler=handler):\n    with ClusterRpcProxy({'AMQP_URI': \"pyamqp://guest:guest@localhost\"}) as proxy:\n        proxy.service.method()\n```\n\nHow it works\n------------\n\n* monkey_patch patches MethodProxy class to initialize a client span, it's called in dependency provider setup method\n* On service method call a server span is created\n* Trace parameters (trace_id, parent_span_id, etc.) are passed through context data and are accessible in py_zipkin.thread_local.get_zipkin_attrs\n* If there are no parameters, request isn't traced\n* Child service calls are also supported\n* Trace results are reported through handler classes in nameko_zipkin.transport\n\n\nConfiguration\n-------------\n\nZIPKIN section must be added to nameko service config.yaml\n\n```yaml\nZIPKIN:\n    HANDLER: HttpHandler\n    HANDLER_PARAMS:\n      url: http://localhost:9411/api/v1/spans\n```\n\nPlaned changes\n--------------\n\n* Trace initialization on trace attrs absence in context data\n* Kafka transport support\n* Custom handlers support in config.yaml ('my_module.MyHandler')", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/Emplocity/nameko-zipkin", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "emplo-nameko-zipkin", "package_url": "https://pypi.org/project/emplo-nameko-zipkin/", "platform": "", "project_url": "https://pypi.org/project/emplo-nameko-zipkin/", "project_urls": {"Homepage": "https://github.com/Emplocity/nameko-zipkin"}, "release_url": "https://pypi.org/project/emplo-nameko-zipkin/0.1.7/", "requires_dist": null, "requires_python": "", "summary": "Zipkin tracing for nameko framework", "version": "0.1.7", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h2>emplocity-nameko-zipkin</h2>\n<p>Zipkin tracing for nameko framework</p>\n<h2>Install</h2>\n<pre><code>pip install emplocity-nameko-zipkin\n</code></pre>\n<h2>Usage</h2>\n<h4>Services</h4>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">nameko_zipkin</span> <span class=\"kn\">import</span> <span class=\"n\">Zipkin</span>\n<span class=\"kn\">from</span> <span class=\"nn\">nameko.rpc</span> <span class=\"kn\">import</span> <span class=\"n\">rpc</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Service</span><span class=\"p\">:</span>\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">'service'</span>\n    <span class=\"n\">zipkin</span> <span class=\"o\">=</span> <span class=\"n\">Zipkin</span><span class=\"p\">()</span> <span class=\"c1\"># Dependency provider injects py_zipkin.zipkin.zipkin_span object</span>\n    \n    <span class=\"nd\">@rpc</span>\n    <span class=\"k\">def</span> <span class=\"nf\">method</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">assert</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">zipkin</span><span class=\"o\">.</span><span class=\"n\">service_name</span> <span class=\"o\">==</span> <span class=\"n\">Service</span><span class=\"o\">.</span><span class=\"n\">name</span>\n        <span class=\"k\">assert</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">zipkin</span><span class=\"o\">.</span><span class=\"n\">span_name</span> <span class=\"o\">==</span> <span class=\"n\">Service</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n</pre>\n<h4>Standalone rpc</h4>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">py_zipkin</span> <span class=\"kn\">import</span> <span class=\"n\">zipkin</span>\n<span class=\"kn\">from</span> <span class=\"nn\">nameko_zipkin</span> <span class=\"kn\">import</span> <span class=\"n\">monkey_patch</span>\n<span class=\"kn\">from</span> <span class=\"nn\">nameko_zipkin.transport</span> <span class=\"kn\">import</span> <span class=\"n\">HttpHandler</span>\n<span class=\"kn\">from</span> <span class=\"nn\">nameko.standalone.rpc</span> <span class=\"kn\">import</span> <span class=\"n\">ClusterRpcProxy</span>\n\n\n<span class=\"n\">handler</span> <span class=\"o\">=</span> <span class=\"n\">HttpHandler</span><span class=\"p\">(</span><span class=\"s1\">'http://localhost:9411/api/v1/spans'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">handle</span>\n<span class=\"n\">monkey_patch</span><span class=\"p\">(</span><span class=\"n\">handler</span><span class=\"p\">)</span>\n\n<span class=\"k\">with</span> <span class=\"n\">zipkin</span><span class=\"o\">.</span><span class=\"n\">zipkin_server_span</span><span class=\"p\">(</span><span class=\"s1\">'RootService'</span><span class=\"p\">,</span>\n                               <span class=\"s1\">'RootMethod'</span><span class=\"p\">,</span>\n                               <span class=\"n\">sample_rate</span><span class=\"o\">=</span><span class=\"mf\">100.</span><span class=\"p\">,</span>\n                               <span class=\"n\">transport_handler</span><span class=\"o\">=</span><span class=\"n\">handler</span><span class=\"p\">):</span>\n    <span class=\"k\">with</span> <span class=\"n\">ClusterRpcProxy</span><span class=\"p\">({</span><span class=\"s1\">'AMQP_URI'</span><span class=\"p\">:</span> <span class=\"s2\">\"pyamqp://guest:guest@localhost\"</span><span class=\"p\">})</span> <span class=\"k\">as</span> <span class=\"n\">proxy</span><span class=\"p\">:</span>\n        <span class=\"n\">proxy</span><span class=\"o\">.</span><span class=\"n\">service</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">()</span>\n</pre>\n<h2>How it works</h2>\n<ul>\n<li>monkey_patch patches MethodProxy class to initialize a client span, it's called in dependency provider setup method</li>\n<li>On service method call a server span is created</li>\n<li>Trace parameters (trace_id, parent_span_id, etc.) are passed through context data and are accessible in py_zipkin.thread_local.get_zipkin_attrs</li>\n<li>If there are no parameters, request isn't traced</li>\n<li>Child service calls are also supported</li>\n<li>Trace results are reported through handler classes in nameko_zipkin.transport</li>\n</ul>\n<h2>Configuration</h2>\n<p>ZIPKIN section must be added to nameko service config.yaml</p>\n<pre><span class=\"nt\">ZIPKIN</span><span class=\"p\">:</span>\n    <span class=\"nt\">HANDLER</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">HttpHandler</span>\n    <span class=\"nt\">HANDLER_PARAMS</span><span class=\"p\">:</span>\n      <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">http://localhost:9411/api/v1/spans</span>\n</pre>\n<h2>Planed changes</h2>\n<ul>\n<li>Trace initialization on trace attrs absence in context data</li>\n<li>Kafka transport support</li>\n<li>Custom handlers support in config.yaml ('my_module.MyHandler')</li>\n</ul>\n\n          </div>"}, "last_serial": 5366936, "releases": {"0.1.5": [{"comment_text": "", "digests": {"md5": "a74415f7c65199c0f67640afedfdbc85", "sha256": "88703646bccf0f0f05d063e2c7a3e375f4992d44cbd25f6f71b1bfb2f8476274"}, "downloads": -1, "filename": "emplo-nameko-zipkin-0.1.5.linux-x86_64.tar.gz", "has_sig": false, "md5_digest": "a74415f7c65199c0f67640afedfdbc85", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6820, "upload_time": "2019-05-15T12:02:44", "upload_time_iso_8601": "2019-05-15T12:02:44.462187Z", "url": "https://files.pythonhosted.org/packages/36/eb/a011a4b1d17d115bbbd126809d32e1db4ad09a47cd49f3d93c638de5e20f/emplo-nameko-zipkin-0.1.5.linux-x86_64.tar.gz", "yanked": false}], "0.1.6": [{"comment_text": "", "digests": {"md5": "8cd54377cdea667b62987ae6b6d43398", "sha256": "8e3db8cb988d500ec219eab7b27dc2c9dde4d9de5644ff96953d2e49ee9298ed"}, "downloads": -1, "filename": "emplo-nameko-zipkin-0.1.6.tar.gz", "has_sig": false, "md5_digest": "8cd54377cdea667b62987ae6b6d43398", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3943, "upload_time": "2019-05-15T14:04:53", "upload_time_iso_8601": "2019-05-15T14:04:53.210443Z", "url": "https://files.pythonhosted.org/packages/b3/47/725e0ce74f4cf36e2eb0269d72c7b98545f8c6b367e46c192b53ea54f6f3/emplo-nameko-zipkin-0.1.6.tar.gz", "yanked": false}], "0.1.7": [{"comment_text": "", "digests": {"md5": "c8a757b4133568e993b2f16adddc7246", "sha256": "c1f6c63fa39870ea1a267e6920e7a8c93d10ec20df93603274bc0036d2054c62"}, "downloads": -1, "filename": "emplo-nameko-zipkin-0.1.7.tar.gz", "has_sig": false, "md5_digest": "c8a757b4133568e993b2f16adddc7246", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3935, "upload_time": "2019-06-06T12:39:51", "upload_time_iso_8601": "2019-06-06T12:39:51.507516Z", "url": "https://files.pythonhosted.org/packages/98/d3/3a0cff467d03fdbf639b20c04b4718eede648b47db71a50b4f902be2aba3/emplo-nameko-zipkin-0.1.7.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "c8a757b4133568e993b2f16adddc7246", "sha256": "c1f6c63fa39870ea1a267e6920e7a8c93d10ec20df93603274bc0036d2054c62"}, "downloads": -1, "filename": "emplo-nameko-zipkin-0.1.7.tar.gz", "has_sig": false, "md5_digest": "c8a757b4133568e993b2f16adddc7246", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3935, "upload_time": "2019-06-06T12:39:51", "upload_time_iso_8601": "2019-06-06T12:39:51.507516Z", "url": "https://files.pythonhosted.org/packages/98/d3/3a0cff467d03fdbf639b20c04b4718eede648b47db71a50b4f902be2aba3/emplo-nameko-zipkin-0.1.7.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:46:32 2020"}