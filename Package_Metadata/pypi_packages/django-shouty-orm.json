{"info": {"author": "Keryn Knight", "author_email": "django-shouty-orm@kerynknight.com", "bugtrack_url": null, "classifiers": ["Development Status :: 3 - Alpha", "Framework :: Django", "Intended Audience :: Developers", "License :: OSI Approved :: BSD License", "Natural Language :: English", "Programming Language :: Python", "Programming Language :: Python :: 2", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.5", "Programming Language :: Python :: 3.6"], "description": "django-shouty-orm\n=================\n\n:author: Keryn Knight\n:version: 0.1.1\n\nRationale\n---------\n\nI want to use ``MyModel.objects.only()`` and ``.defer()`` because that's the\n**correct** thing to do, even if it's not the default thing Django does. But\nusing ``.only()`` and ``.defer()`` in Django is an absolute footgun because any\nattempt to subsequently access the missing fields will ... **do another query**\n\nSimilarly, I don't want Django to silently allow me to do N+1 queries for related\nmanagers/querysets. But it does, so there's another footgun.\n\nThis module then, is my terrible attempt to fix the footguns automatically, by\nforcing them to raise exceptions where possible, rather than do the query. This\nflies in the face of some other proposed solutions over the years on the mailing list,\nsuch as automatically doing  ``prefetch_related`` or ``select_related``.\n\nI think/hope that the package pairs well with `django-shouty-templates`_ to try\nand surface some of the small pains I've had over the years.\n\nWhat it does\n------------\n\nAll of the following examples should raise an exception because they pose a probable\nadditional +1 (or more) queries.\n\nAccessing fields intentionally not selected::\n\n    >>> u = User.objects.only('pk').get(pk=1)\n    >>> u.username\n    MissingLocalField(\"Access to username [...]\")\n    >>> u = User.objects.defer('username').get(pk=1)\n    >>> u.email\n    >>> u.username\n    MissingLocalField(\"Access to username [...]\")\n\nAccess to relationships that have not been selected::\n\n    >>> le = LogEntry.objects.get(pk=1)\n    >>> le.action_flag\n    >>> le.user.pk\n    MissingRelationField(\"Access to user [...]\")\n\nAccess to reverse relationships that have not been selected::\n\n    >>> u = User.objects.only('pk').get(pk=1)\n    >>> u.logentry_set.all()\n    MissingReverseRelationField(\"Access to logentry_set [...]\")\n\nPretty much all relationship access (normal or reverse, ``OneToOne`` or\n``ForeignKey`` or ``ManyToMany``) should be blocked unless ``select_related`` or\n``prefetch_related`` were used to include them.\n\nSetup\n-----\n\nAdd ``shoutyorm`` or ``shoutyorm.Shout`` to your ``settings.INSTALLED_APPS``\n\nI'd certainly suggest that you should only enable it when ``DEBUG`` is ``True`` or\nduring your test suite.\n\nDependencies\n^^^^^^^^^^^^\n\n- Django 2.2+ (obviously)\n- `wrapt`_ 1.11+ (for proxying managers/querysets transparently)\n\n\nOptional configuration\n^^^^^^^^^^^^^^^^^^^^^^\n\n\n- ``settings.SHOUTY_LOCAL_FIELDS`` may be ``True|False``\n\n  Accessing fields which have been deferred via ``.only()`` and ``.defer()`` at the\n  QuerySet level will error loudly.\n- ``settings.SHOUTY_RELATION_FIELDS`` may be ``True|False``\n\n  Accessing OneToOnes which have not been ``.select_related()`` at the QuerySet\n  level will error loudly.\n  Accessing local foreignkeys which have not been ``prefetch_related()`` or\n  ``select_related()`` at the queryset level will error loudly.\n- ``settings.SHOUTY_RELATION_REVERSE_FIELDS`` may be ``True|False``\n\n  Accessing foreignkeys from the \"other\" side (that is, via the reverse relation\n  manager) which have not been ``.prefetch_related()`` at the QuerySet level will error loudly.\n\nTests\n-----\n\nJust run ``python3 -m shoutyorm`` and hope for the best. I usually do.\n\n\nAlternatives\n------------\n\nA similar similar approach is taken by `django-seal`_ but without the\nonus/burden of subclassing from specific models. I've not looked at the\nimplementation details of how seal works, but I expect I could've saved myself\nquite a lot of headache by seeing what steps it takes in what circumstances,\nrather than constantly hitting breakpoints and inspecting state.\n\nA novel idea is presented in `django-eraserhead`_ of specifically calling out\nwhen you might be able to use ``defer()`` and ``only()`` to reduce your selections,\nbut introducing those optimisations still poses a danger of regression without a\ntest suite and this module.\n\nHaving started writing this list of alternatives, I am reminded of `nplusone`_\nand it turns out that has Django support *and* a setting for raising exceptions...\nSo all of this patch may be moot, because I expect that covers a lot more? Again\nI've not looked at their implementation but I'm sure it's miles better than this\nabomination.\n\n\nThe license\n-----------\n\nIt's `FreeBSD`_. There's should be a ``LICENSE`` file in the root of the repository, and in any archives.\n\n.. _FreeBSD: http://en.wikipedia.org/wiki/BSD_licenses#2-clause_license_.28.22Simplified_BSD_License.22_or_.22FreeBSD_License.22.29\n.. _django-seal: https://github.com/charettes/django-seal\n.. _django-eraserhead: https://github.com/dizballanze/django-eraserhead\n.. _nplusone: https://github.com/jmcarp/nplusone\n.. _django-shouty-templates: https://github.com/kezabelle/django-shouty-templates\n.. _wrapt: https://wrapt.readthedocs.io/en/latest/index.html\n\n\n----\n\nCopyright (c) 2020, Keryn Knight\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n\n----\n\nChange history for django-shouty-orm\n------------------------------------\n0.1.1\n^^^^^^\n* Initial release\n\n\n", "description_content_type": "", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/kezabelle/django-shouty-orm", "keywords": "django orm sql exception", "license": "BSD License", "maintainer": "Keryn Knight", "maintainer_email": "django-shouty-orm@kerynknight.com", "name": "django-shouty-orm", "package_url": "https://pypi.org/project/django-shouty-orm/", "platform": "", "project_url": "https://pypi.org/project/django-shouty-orm/", "project_urls": {"Homepage": "https://github.com/kezabelle/django-shouty-orm"}, "release_url": "https://pypi.org/project/django-shouty-orm/0.1.1/", "requires_dist": ["Django (>=2.2)", "wrapt (>=1.11)"], "requires_python": "", "summary": "Applies a monkeypatch which forces Django's ORM to error far more loudly in certain cases", "version": "0.1.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <table>\n<col>\n<col>\n<tbody>\n<tr><th>Author:</th>\n<td>Keryn Knight</td></tr>\n<tr><th>Version:</th>\n<td>0.1.1</td></tr>\n</tbody>\n</table>\n<div id=\"rationale\">\n<h2>Rationale</h2>\n<p>I want to use <tt>MyModel.objects.only()</tt> and <tt>.defer()</tt> because that\u2019s the\n<strong>correct</strong> thing to do, even if it\u2019s not the default thing Django does. But\nusing <tt>.only()</tt> and <tt>.defer()</tt> in Django is an absolute footgun because any\nattempt to subsequently access the missing fields will \u2026 <strong>do another query</strong></p>\n<p>Similarly, I don\u2019t want Django to silently allow me to do N+1 queries for related\nmanagers/querysets. But it does, so there\u2019s another footgun.</p>\n<p>This module then, is my terrible attempt to fix the footguns automatically, by\nforcing them to raise exceptions where possible, rather than do the query. This\nflies in the face of some other proposed solutions over the years on the mailing list,\nsuch as automatically doing  <tt>prefetch_related</tt> or <tt>select_related</tt>.</p>\n<p>I think/hope that the package pairs well with <a href=\"https://github.com/kezabelle/django-shouty-templates\" rel=\"nofollow\">django-shouty-templates</a> to try\nand surface some of the small pains I\u2019ve had over the years.</p>\n</div>\n<div id=\"what-it-does\">\n<h2>What it does</h2>\n<p>All of the following examples should raise an exception because they pose a probable\nadditional +1 (or more) queries.</p>\n<p>Accessing fields intentionally not selected:</p>\n<pre>&gt;&gt;&gt; u = User.objects.only('pk').get(pk=1)\n&gt;&gt;&gt; u.username\nMissingLocalField(\"Access to username [...]\")\n&gt;&gt;&gt; u = User.objects.defer('username').get(pk=1)\n&gt;&gt;&gt; u.email\n&gt;&gt;&gt; u.username\nMissingLocalField(\"Access to username [...]\")\n</pre>\n<p>Access to relationships that have not been selected:</p>\n<pre>&gt;&gt;&gt; le = LogEntry.objects.get(pk=1)\n&gt;&gt;&gt; le.action_flag\n&gt;&gt;&gt; le.user.pk\nMissingRelationField(\"Access to user [...]\")\n</pre>\n<p>Access to reverse relationships that have not been selected:</p>\n<pre>&gt;&gt;&gt; u = User.objects.only('pk').get(pk=1)\n&gt;&gt;&gt; u.logentry_set.all()\nMissingReverseRelationField(\"Access to logentry_set [...]\")\n</pre>\n<p>Pretty much all relationship access (normal or reverse, <tt>OneToOne</tt> or\n<tt>ForeignKey</tt> or <tt>ManyToMany</tt>) should be blocked unless <tt>select_related</tt> or\n<tt>prefetch_related</tt> were used to include them.</p>\n</div>\n<div id=\"setup\">\n<h2>Setup</h2>\n<p>Add <tt>shoutyorm</tt> or <tt>shoutyorm.Shout</tt> to your <tt>settings.INSTALLED_APPS</tt></p>\n<p>I\u2019d certainly suggest that you should only enable it when <tt>DEBUG</tt> is <tt>True</tt> or\nduring your test suite.</p>\n<div id=\"dependencies\">\n<h3>Dependencies</h3>\n<ul>\n<li>Django 2.2+ (obviously)</li>\n<li><a href=\"https://wrapt.readthedocs.io/en/latest/index.html\" rel=\"nofollow\">wrapt</a> 1.11+ (for proxying managers/querysets transparently)</li>\n</ul>\n</div>\n<div id=\"optional-configuration\">\n<h3>Optional configuration</h3>\n<ul>\n<li><p><tt>settings.SHOUTY_LOCAL_FIELDS</tt> may be <tt>True|False</tt></p>\n<p>Accessing fields which have been deferred via <tt>.only()</tt> and <tt>.defer()</tt> at the\nQuerySet level will error loudly.</p>\n</li>\n<li><p><tt>settings.SHOUTY_RELATION_FIELDS</tt> may be <tt>True|False</tt></p>\n<p>Accessing OneToOnes which have not been <tt>.select_related()</tt> at the QuerySet\nlevel will error loudly.\nAccessing local foreignkeys which have not been <tt>prefetch_related()</tt> or\n<tt>select_related()</tt> at the queryset level will error loudly.</p>\n</li>\n<li><p><tt>settings.SHOUTY_RELATION_REVERSE_FIELDS</tt> may be <tt>True|False</tt></p>\n<p>Accessing foreignkeys from the \u201cother\u201d side (that is, via the reverse relation\nmanager) which have not been <tt>.prefetch_related()</tt> at the QuerySet level will error loudly.</p>\n</li>\n</ul>\n</div>\n</div>\n<div id=\"tests\">\n<h2>Tests</h2>\n<p>Just run <tt>python3 <span class=\"pre\">-m</span> shoutyorm</tt> and hope for the best. I usually do.</p>\n</div>\n<div id=\"alternatives\">\n<h2>Alternatives</h2>\n<p>A similar similar approach is taken by <a href=\"https://github.com/charettes/django-seal\" rel=\"nofollow\">django-seal</a> but without the\nonus/burden of subclassing from specific models. I\u2019ve not looked at the\nimplementation details of how seal works, but I expect I could\u2019ve saved myself\nquite a lot of headache by seeing what steps it takes in what circumstances,\nrather than constantly hitting breakpoints and inspecting state.</p>\n<p>A novel idea is presented in <a href=\"https://github.com/dizballanze/django-eraserhead\" rel=\"nofollow\">django-eraserhead</a> of specifically calling out\nwhen you might be able to use <tt>defer()</tt> and <tt>only()</tt> to reduce your selections,\nbut introducing those optimisations still poses a danger of regression without a\ntest suite and this module.</p>\n<p>Having started writing this list of alternatives, I am reminded of <a href=\"https://github.com/jmcarp/nplusone\" rel=\"nofollow\">nplusone</a>\nand it turns out that has Django support <em>and</em> a setting for raising exceptions\u2026\nSo all of this patch may be moot, because I expect that covers a lot more? Again\nI\u2019ve not looked at their implementation but I\u2019m sure it\u2019s miles better than this\nabomination.</p>\n</div>\n<div id=\"the-license\">\n<h2>The license</h2>\n<p>It\u2019s <a href=\"http://en.wikipedia.org/wiki/BSD_licenses#2-clause_license_.28.22Simplified_BSD_License.22_or_.22FreeBSD_License.22.29\" rel=\"nofollow\">FreeBSD</a>. There\u2019s should be a <tt>LICENSE</tt> file in the root of the repository, and in any archives.</p>\n<hr class=\"docutils\">\n<p>Copyright (c) 2020, Keryn Knight\nAll rights reserved.</p>\n<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>\n<ol>\n<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>\n<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>\n</ol>\n<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \u201cAS IS\u201d AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>\n</div>\n<hr class=\"docutils\">\n<div id=\"change-history-for-django-shouty-orm\">\n<h2>Change history for django-shouty-orm</h2>\n<h2 id=\"id1\"><span class=\"section-subtitle\">0.1.1</span></h2>\n<ul>\n<li>Initial release</li>\n</ul>\n</div>\n\n          </div>"}, "last_serial": 6970961, "releases": {"0.1.1": [{"comment_text": "", "digests": {"md5": "974c20ae382273c351e198a035820d1a", "sha256": "3d8500b2b2991ad84763e58c2c76064d13ecfa9f102b9f62284b305fc34f788d"}, "downloads": -1, "filename": "django_shouty_orm-0.1.1-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "974c20ae382273c351e198a035820d1a", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 13248, "upload_time": "2020-04-07T15:48:01", "upload_time_iso_8601": "2020-04-07T15:48:01.202715Z", "url": "https://files.pythonhosted.org/packages/3b/68/e98135c1aa46b067a2b32a7cf14aa1306b00d4d39efcef7d287114fc76ca/django_shouty_orm-0.1.1-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "a549bd72aa58cbb062eebb1abc4e77a5", "sha256": "bf804e31f929e937c6fd036a8a9fa52bee530b2304c0980535318b17668c180b"}, "downloads": -1, "filename": "django-shouty-orm-0.1.1.tar.gz", "has_sig": false, "md5_digest": "a549bd72aa58cbb062eebb1abc4e77a5", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 20216, "upload_time": "2020-04-07T15:48:07", "upload_time_iso_8601": "2020-04-07T15:48:07.975298Z", "url": "https://files.pythonhosted.org/packages/92/b7/e41188714006d797cc3e40c192098ebe182d3804fdc80be017ec9c924e69/django-shouty-orm-0.1.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "974c20ae382273c351e198a035820d1a", "sha256": "3d8500b2b2991ad84763e58c2c76064d13ecfa9f102b9f62284b305fc34f788d"}, "downloads": -1, "filename": "django_shouty_orm-0.1.1-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "974c20ae382273c351e198a035820d1a", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 13248, "upload_time": "2020-04-07T15:48:01", "upload_time_iso_8601": "2020-04-07T15:48:01.202715Z", "url": "https://files.pythonhosted.org/packages/3b/68/e98135c1aa46b067a2b32a7cf14aa1306b00d4d39efcef7d287114fc76ca/django_shouty_orm-0.1.1-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "a549bd72aa58cbb062eebb1abc4e77a5", "sha256": "bf804e31f929e937c6fd036a8a9fa52bee530b2304c0980535318b17668c180b"}, "downloads": -1, "filename": "django-shouty-orm-0.1.1.tar.gz", "has_sig": false, "md5_digest": "a549bd72aa58cbb062eebb1abc4e77a5", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 20216, "upload_time": "2020-04-07T15:48:07", "upload_time_iso_8601": "2020-04-07T15:48:07.975298Z", "url": "https://files.pythonhosted.org/packages/92/b7/e41188714006d797cc3e40c192098ebe182d3804fdc80be017ec9c924e69/django-shouty-orm-0.1.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:53:28 2020"}