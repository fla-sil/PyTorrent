{"info": {"author": "Willem Bult", "author_email": "willem.bult@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "|Build Status|\n\ncelerytest - Integration testing with Celery\n============================================\n\nWriting (integration) tests that depend on Celery tasks is problematic.\nWhen you manually run a Celery worker together with your tests, it runs\nin a separate process and there's no clean way to address objects\ntargeted by Celery from your tests. When you use a separate test\ndatabase (as with Django for example), you'll have to duplicate\nconfiguration code so your Celery worker accesses the same database.\n\ncelerytest provides the ability to run a Celery worker in the background\nfrom your tests. It also allows your tests to monitor the worker and\npause until Celery tasks are completed.\n\nUsing celerytest\n----------------\n\nTo start a Celery worker in a separate thread, use:\n\n.. code:: python\n\n    app = Celery() # your Celery app\n    worker = start_celery_worker(app) # configure the app for our celery worker\n\nTo wait for the worker to finish executing tasks, use:\n\n.. code:: python\n\n    result = some_celery_task.delay()\n    worker.idle.wait() # optionally specify time-out\n\nDjango\n~~~~~~\n\nTo use this with your django app through django-celery, get your app as\nsuch:\n\n.. code:: python\n\n    from djcelery.app import app\n    worker = start_celery_worker(app)\n\nTestCase\n~~~~~~~~\n\nIf you want to use this in a unittest TestCase, you can use\nCeleryTestCaseMixin. If you're writing unit tests that depend on a\ncelery worker, though, you're doing it wrong. For unit tests, you'll\nwant to mock your Celery methods and test them separately. You could use\nCeleryTestCaseMixin to write integration tests with Celery tasks,\nthough.\n\n.. code:: python\n\n    from unittest import TestCase\n    from celerytest.testcase import CeleryTestCaseMixin, setup_celery_worker\n    import time\n\n    app = Celery()\n    setup_celery_worker(app) # need to setup worker outside\n\n    class SomeTestCase(CeleryTestCaseMixin, TestCase):\n        celery_app = app\n        celery_concurrency = 4\n\n        def test_something(self):\n            result = multiply.delay(2,3)\n            self.worker.idle.wait()\n            self.assertEqual(result.get(), 6)\n\nLettuce\n~~~~~~~\n\nTo automatically launch a worker in the background while running a\nLettuce integration test suite, add to ``terrain.py``:\n\n.. code:: python\n\n    # terrain.py\n    from lettuce import *\n    from celerytest import start_celery_worker\n    from app import app\n\n    @before.harvest\n    def initial_setup(server):\n        # memory transport may not work here\n        world.celery = start_celery_worker(app, config=\"amqp\")\n\n    @after.harvest\n    def cleanup(server):\n        world.celery.stop()\n\n    @after.each_step\n    def after_step(step):\n        # make sure we've received any scheduled tasks\n        world.celery.active.wait(.05) \n        # allow tasks to complete\n        world.celery.idle.wait(5)\n\nInstallation\n------------\n\nInstall the latest version of ``celerytest`` from PyPI:\n\n::\n\n    $ pip install celerytest\n\nOr, clone the latest version of ``celerytest`` from GitHub and run\nsetup:\n\n::\n\n    $ git clone git://github.com/RentMethod/celerytest.git\n    $ cd celerytest\n    $ ./setup.py install # as root\n\n.. |Build Status| image:: https://travis-ci.org/RentMethod/celerytest.svg?branch=master\n   :target: https://travis-ci.org/RentMethod/celerytest", "description_content_type": null, "docs_url": null, "download_url": "https://github.com/RentMethod/celerytest/archive/0.1.1.tar.gz", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "http://github.com/RentMethod/celerytest", "keywords": "celery,testing,integration,test", "license": "BSD license, see LICENSE", "maintainer": null, "maintainer_email": null, "name": "celerytest", "package_url": "https://pypi.org/project/celerytest/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/celerytest/", "project_urls": {"Download": "https://github.com/RentMethod/celerytest/archive/0.1.1.tar.gz", "Homepage": "http://github.com/RentMethod/celerytest"}, "release_url": "https://pypi.org/project/celerytest/0.1.1/", "requires_dist": null, "requires_python": null, "summary": "Run a monitored Celery worker for integration tests that depend on Celery tasks", "version": "0.1.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><a href=\"https://travis-ci.org/RentMethod/celerytest\" rel=\"nofollow\"><img alt=\"Build Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/e18624464349b5f352b071dd7e4454df0e4ede61/68747470733a2f2f7472617669732d63692e6f72672f52656e744d6574686f642f63656c657279746573742e7376673f6272616e63683d6d6173746572\"></a></p>\n<div id=\"celerytest-integration-testing-with-celery\">\n<h2>celerytest - Integration testing with Celery</h2>\n<p>Writing (integration) tests that depend on Celery tasks is problematic.\nWhen you manually run a Celery worker together with your tests, it runs\nin a separate process and there\u2019s no clean way to address objects\ntargeted by Celery from your tests. When you use a separate test\ndatabase (as with Django for example), you\u2019ll have to duplicate\nconfiguration code so your Celery worker accesses the same database.</p>\n<p>celerytest provides the ability to run a Celery worker in the background\nfrom your tests. It also allows your tests to monitor the worker and\npause until Celery tasks are completed.</p>\n<div id=\"using-celerytest\">\n<h3>Using celerytest</h3>\n<p>To start a Celery worker in a separate thread, use:</p>\n<pre><span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">Celery</span><span class=\"p\">()</span> <span class=\"c1\"># your Celery app</span>\n<span class=\"n\">worker</span> <span class=\"o\">=</span> <span class=\"n\">start_celery_worker</span><span class=\"p\">(</span><span class=\"n\">app</span><span class=\"p\">)</span> <span class=\"c1\"># configure the app for our celery worker</span>\n</pre>\n<p>To wait for the worker to finish executing tasks, use:</p>\n<pre><span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">some_celery_task</span><span class=\"o\">.</span><span class=\"n\">delay</span><span class=\"p\">()</span>\n<span class=\"n\">worker</span><span class=\"o\">.</span><span class=\"n\">idle</span><span class=\"o\">.</span><span class=\"n\">wait</span><span class=\"p\">()</span> <span class=\"c1\"># optionally specify time-out</span>\n</pre>\n<div id=\"django\">\n<h4>Django</h4>\n<p>To use this with your django app through django-celery, get your app as\nsuch:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">djcelery.app</span> <span class=\"kn\">import</span> <span class=\"n\">app</span>\n<span class=\"n\">worker</span> <span class=\"o\">=</span> <span class=\"n\">start_celery_worker</span><span class=\"p\">(</span><span class=\"n\">app</span><span class=\"p\">)</span>\n</pre>\n</div>\n<div id=\"testcase\">\n<h4>TestCase</h4>\n<p>If you want to use this in a unittest TestCase, you can use\nCeleryTestCaseMixin. If you\u2019re writing unit tests that depend on a\ncelery worker, though, you\u2019re doing it wrong. For unit tests, you\u2019ll\nwant to mock your Celery methods and test them separately. You could use\nCeleryTestCaseMixin to write integration tests with Celery tasks,\nthough.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">unittest</span> <span class=\"kn\">import</span> <span class=\"n\">TestCase</span>\n<span class=\"kn\">from</span> <span class=\"nn\">celerytest.testcase</span> <span class=\"kn\">import</span> <span class=\"n\">CeleryTestCaseMixin</span><span class=\"p\">,</span> <span class=\"n\">setup_celery_worker</span>\n<span class=\"kn\">import</span> <span class=\"nn\">time</span>\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">Celery</span><span class=\"p\">()</span>\n<span class=\"n\">setup_celery_worker</span><span class=\"p\">(</span><span class=\"n\">app</span><span class=\"p\">)</span> <span class=\"c1\"># need to setup worker outside</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SomeTestCase</span><span class=\"p\">(</span><span class=\"n\">CeleryTestCaseMixin</span><span class=\"p\">,</span> <span class=\"n\">TestCase</span><span class=\"p\">):</span>\n    <span class=\"n\">celery_app</span> <span class=\"o\">=</span> <span class=\"n\">app</span>\n    <span class=\"n\">celery_concurrency</span> <span class=\"o\">=</span> <span class=\"mi\">4</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">test_something</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">multiply</span><span class=\"o\">.</span><span class=\"n\">delay</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">worker</span><span class=\"o\">.</span><span class=\"n\">idle</span><span class=\"o\">.</span><span class=\"n\">wait</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">assertEqual</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(),</span> <span class=\"mi\">6</span><span class=\"p\">)</span>\n</pre>\n</div>\n<div id=\"lettuce\">\n<h4>Lettuce</h4>\n<p>To automatically launch a worker in the background while running a\nLettuce integration test suite, add to <tt>terrain.py</tt>:</p>\n<pre><span class=\"c1\"># terrain.py</span>\n<span class=\"kn\">from</span> <span class=\"nn\">lettuce</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n<span class=\"kn\">from</span> <span class=\"nn\">celerytest</span> <span class=\"kn\">import</span> <span class=\"n\">start_celery_worker</span>\n<span class=\"kn\">from</span> <span class=\"nn\">app</span> <span class=\"kn\">import</span> <span class=\"n\">app</span>\n\n<span class=\"nd\">@before</span><span class=\"o\">.</span><span class=\"n\">harvest</span>\n<span class=\"k\">def</span> <span class=\"nf\">initial_setup</span><span class=\"p\">(</span><span class=\"n\">server</span><span class=\"p\">):</span>\n    <span class=\"c1\"># memory transport may not work here</span>\n    <span class=\"n\">world</span><span class=\"o\">.</span><span class=\"n\">celery</span> <span class=\"o\">=</span> <span class=\"n\">start_celery_worker</span><span class=\"p\">(</span><span class=\"n\">app</span><span class=\"p\">,</span> <span class=\"n\">config</span><span class=\"o\">=</span><span class=\"s2\">\"amqp\"</span><span class=\"p\">)</span>\n\n<span class=\"nd\">@after</span><span class=\"o\">.</span><span class=\"n\">harvest</span>\n<span class=\"k\">def</span> <span class=\"nf\">cleanup</span><span class=\"p\">(</span><span class=\"n\">server</span><span class=\"p\">):</span>\n    <span class=\"n\">world</span><span class=\"o\">.</span><span class=\"n\">celery</span><span class=\"o\">.</span><span class=\"n\">stop</span><span class=\"p\">()</span>\n\n<span class=\"nd\">@after</span><span class=\"o\">.</span><span class=\"n\">each_step</span>\n<span class=\"k\">def</span> <span class=\"nf\">after_step</span><span class=\"p\">(</span><span class=\"n\">step</span><span class=\"p\">):</span>\n    <span class=\"c1\"># make sure we've received any scheduled tasks</span>\n    <span class=\"n\">world</span><span class=\"o\">.</span><span class=\"n\">celery</span><span class=\"o\">.</span><span class=\"n\">active</span><span class=\"o\">.</span><span class=\"n\">wait</span><span class=\"p\">(</span><span class=\"o\">.</span><span class=\"mi\">05</span><span class=\"p\">)</span>\n    <span class=\"c1\"># allow tasks to complete</span>\n    <span class=\"n\">world</span><span class=\"o\">.</span><span class=\"n\">celery</span><span class=\"o\">.</span><span class=\"n\">idle</span><span class=\"o\">.</span><span class=\"n\">wait</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n</pre>\n</div>\n</div>\n<div id=\"installation\">\n<h3>Installation</h3>\n<p>Install the latest version of <tt>celerytest</tt> from PyPI:</p>\n<pre>$ pip install celerytest\n</pre>\n<p>Or, clone the latest version of <tt>celerytest</tt> from GitHub and run\nsetup:</p>\n<pre>$ git clone git://github.com/RentMethod/celerytest.git\n$ cd celerytest\n$ ./setup.py install # as root\n</pre>\n</div>\n</div>\n\n          </div>"}, "last_serial": 1291255, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "7bc392f29257dee304987b773aa7e9c9", "sha256": "38aac73d5a4b8ee7d7c3104af8dd07e347aae632e36db1b41397196cfc7ce4bc"}, "downloads": -1, "filename": "celerytest-0.1.tar.gz", "has_sig": false, "md5_digest": "7bc392f29257dee304987b773aa7e9c9", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6421, "upload_time": "2014-11-01T02:50:13", "upload_time_iso_8601": "2014-11-01T02:50:13.248619Z", "url": "https://files.pythonhosted.org/packages/6c/29/f4629d18409f22ec34dda2420deb29addddbe5538337603ed61195adee9b/celerytest-0.1.tar.gz", "yanked": false}], "0.1.1": [{"comment_text": "", "digests": {"md5": "91ab4ebeb84adf0bbf9d0967c05872fd", "sha256": "b0fc2ced0cb93446a1a06eb7cd3a694050d5fbd4fb9bad8bc1c82e978932b29e"}, "downloads": -1, "filename": "celerytest-0.1.1.tar.gz", "has_sig": false, "md5_digest": "91ab4ebeb84adf0bbf9d0967c05872fd", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6589, "upload_time": "2014-11-01T20:21:07", "upload_time_iso_8601": "2014-11-01T20:21:07.363504Z", "url": "https://files.pythonhosted.org/packages/34/7e/1f4a3f6b053671c35fcf54f06935ff34d50e2b38dda9a3f62907c421ee6c/celerytest-0.1.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "91ab4ebeb84adf0bbf9d0967c05872fd", "sha256": "b0fc2ced0cb93446a1a06eb7cd3a694050d5fbd4fb9bad8bc1c82e978932b29e"}, "downloads": -1, "filename": "celerytest-0.1.1.tar.gz", "has_sig": false, "md5_digest": "91ab4ebeb84adf0bbf9d0967c05872fd", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6589, "upload_time": "2014-11-01T20:21:07", "upload_time_iso_8601": "2014-11-01T20:21:07.363504Z", "url": "https://files.pythonhosted.org/packages/34/7e/1f4a3f6b053671c35fcf54f06935ff34d50e2b38dda9a3f62907c421ee6c/celerytest-0.1.1.tar.gz", "yanked": false}], "timestamp": "Thu May  7 22:34:51 2020"}