{"info": {"author": "Rohan Kekatpure", "author_email": "rohan_kekatpure@intuit.com", "bugtrack_url": null, "classifiers": [], "description": "=========\nFilemerge\n=========\n\nFilemerge is a utility for merging a large number of small HDFS files into\nsmaller number of large files. Filemerge is intended for use by Hadoop operations\nengineers and map-reduce application developers.\n\nThe structure of the code is simple. The actual merging is performed by a Pig\nscript created at run time using user-supplied parameters. These parameters\ncontrol the set of files to merge. The utility consists of a single file,\n``filemerge.py``, that takes the input parameters and invokes the created pig\nscript. As such, ``pig`` **command needs to be available and in path of the\nruntime user.** The user specifies the input path, output path, topic, and\nfiles to be merged either as a year/month/day format or specific HDFS directory\nor a list of HDFS directories in a file.\n\n========================\nInstallation and testing\n========================\n\nBecause the application code is small and self-contained, installation requires\nsimply cloning the repository.\n\n\n.. code-block:: sh\n\n    git clone https://github.com/intuit/filemerge.git\n\n\nNote that ``filemerge`` itself does not have any dependencies besides pig\ncommand-line. However, running the test suite locally requires installation of\nthe test discovery and mocking packages. These dependencies are listed in\n``filemerge/requirements.txt`` and can be installed as follows.\n\n.. code-block:: sh\n\n    cd filemerge\n    pip install -r requirements.txt\n\nFinally, installation can be verified by running the test suite locally.\n\n.. code-block:: sh\n\n    nosetests -w unit_tests -v\n\nDevelopers can check test coverage running\n\n.. code-block:: sh\n\n    ./runtests.sh\n\nfrom the project top-level directory.\n\n\n==================\nRunning the script\n==================\n\n--------------\nThe script API\n--------------\n\nThe full API of the script is available on commandline by typing\n\n.. code-block:: sh\n\n    python filemerge.py -h\n\nThe help message is reproduced below for reference.\n\n.. code-block:: sh   \n\n    Usage:\n        python filemerge.py --topic=<'topic-in-single-quotes'>\n                            --input-prefix=<'HDFS-location-in-single-quotes'>\n                            --output-prefix=<'HDFS-location-in-single-quotes'>\n                            --num-reducers=<any-positive-integer>\n                            --queue=<hadoop queue name>\n                            [--year=<4-digit-year>]\n                            [--month=<month>]\n                            [--day=<day>]\n                            [--dir=<directory relative to input-prefix>]\n                            [--file=<file with list of directories, relative to input-prefix>]\n                            [--window=<window size in days>]\n                            [--codec=<valid hadoop compression codec>]\n                            [-r]\n\n\n\n    Options:\n      -h, --help            show this help message and exit\n      -y YEAR, --year=YEAR  Year for the merge\n      -m MONTH, --month=MONTH\n                            Month for the merge\n      -d DAY, --day=DAY     Day for the merge\n      -D DIRECTORY, --directory=DIRECTORY\n                            Directory containing files to merge\n      -f FILE, --file=FILE  File containing list of input directories\n      -w WINDOW, --window=WINDOW\n                            Window in days (merge for the past *n* days\n      -l LOOKBACK, --lookback=LOOKBACK\n                            Lookback period (merge for 1 day *n* days prior)\n      -t TOPIC, --topic=TOPIC\n                            Topic for the merge\n      -i INPUT_PREFIX, --input-prefix=INPUT_PREFIX\n                            Input directory prefix\n      -o OUTPUT_PREFIX, --output-prefix=OUTPUT_PREFIX\n                            Output directory prefix\n      -n NUM_REDUCERS, --num-reducers=NUM_REDUCERS\n                            Number of reducers\n      -c CODEC, --codec=CODEC\n                            Compression codec to use\n      -q QUEUE, --queue=QUEUE\n                            Mapreduce job queue\n      -r, --dry-run         Dry run; create, but dont execute the Pig script\n\nThe arguments outside the square brackets are required and those in the square\nbrackets are optional, but a minimum set of these arguments is needed to compute\nthe set of directories to be merged. The acceptable option groups are following:\n\n - Group 1\n    - year (-y)\n    - year (-y), month (-m)\n    - year (-y), month (-m), day (-d)\n\n - Group 2\n    - HDFS directory (-D)\n\n - Group 3\n    - file with a list of HDFS directories (-f)\n\n - Group 4\n    - window with a start date (-w); files for all days between start date minus\n      window to start date will be merged\n\n - Group 5\n    - lookback with a start date (-l); files for a single day lookback days before the\n      start date will be merged\n\nThese option groups are designed to enable merging at the directory, day, month,\nor the year level. The ``-f`` offers ability to merge non-contiguous firectory\nblocks. The ``-w`` and ``-l`` options allow merging of directories at periodic\nintervals using a sliding window.\n\nOne can further enhance the flexibility of these options by wrapping the\n``python`` call in a shell script and providing custom list of directories,\nnon-contiguous months, shunking large directory lists into smaller parts etc.\n\n++++++++++++++++++++++++\nWhy all the flexibility?\n++++++++++++++++++++++++\n\nThe ``filemerge`` tool is written with operations and map-reduce application\ndevelopers in mind. Operations team will need periodic merges based on the\nretention policy and will typically use the tool with the ``-y, -m, -d``\noptions. Map-reduce application developers might need to merge single\ndirectories or random directory groups and will use the ``-d`` and ``-f``\noptions.\n\n---------------------------------------------\nBasic usage: Merging all files in a directory\n---------------------------------------------\n\nThe most common usage pattern for ``filemerge`` is to merge all files in a\ndirectory and produce one output file (in a different directory). To merge files\nunders a specific directory, provide the basepath using the ``-i`` option and\nthe final directory name using the ``-D`` option. In the following invocation\nthe ``/path/to/clickstream`` is the base HDFS path and ``jan2016`` is the\nsubdirectory that contains the files to be merged (in this case, for January\n2016). In other words, the full path to the files that will be merged is:\n``/path/to/clickstream/jan2016``\n\n.. code-block:: sh\n\n    python filemerge/filemerge.py \\\n        -i '/hdfs/path/to/clickstream' \\\n        -D 'jan2016' \\\n        -o '/hdfs/path/to/jan2016-merged' \\\n        -t 'clickstream'\n\n\n-----------------------------------------\nExample invocation for a full month merge\n-----------------------------------------\n\nFollowing command invokes the script for merging February 2015 data of the\n'clickstream' directory in HDFS. This is the raw call to the filemerge python script\nand will initiate 28 map-reduce jobs.\n\n.. code-block:: sh\n    \n    python filemerge/filemerge.py \\\n        -i '/hdfs/path/to/clickstream' \\\n        -o '/hdfs/path/to/clickstream-merged' \\\n        -t 'clickstream' \\\n        -y 2015 \\\n        -m 2\n\n----------------------------------------        \nExample invocation for a full year merge\n----------------------------------------\n\nSimply omit the month and day options and the merge wil be performed for the\nfull year. Following command invokes the script for merging the entire 2015 data\nof the 'clickstream' directory with a 1 day chunk size. This will initiate 365\nmap-reduce jobs.\n\n.. code-block:: sh\n    \n    python filemerge/filemerge.py \\\n        -i '/hdfs/path/to/clickstream' \\\n        -o '/hdfs/path/to/clickstream-merged' \\\n        -t 'clickstream' \\\n        -y 2015\n\nNote that detecting files in time window (e.g. a certain month or a year)\nrequires ``filemerge`` to assume certain directory naming conventions. This\nconvention is specified in ``filemerge/templates.py`` and can be user-defined.\n\n------------------------------------------------------\nExample invocation for a non-contiguous directory list\n------------------------------------------------------\n\nTo merge files under unrelated non-contiguous directories, list all the final\ndirectory names in a file and pass the full file path to the ``-f`` option. In\nthe invocation below, ``-i`` captures the common portion of the path to all the\ndirectories and the final directories are listed in the file.\n\n.. code-block:: sh\n\n    python filemerge/filemerge.py \\\n        -i '/hdfs/path/to/clickstream' \\\n        -o '/hdfs/path/to/clickstream-merged' \\\n        -t 'clickstream' \\\n        -f /local/filesystem/path/to/directory_list.txt\n\nLets assume to that ``/local/filesystem/path/to/directory_list.txt`` contains\nthe following lines\n\n.. code-block:: sh\n\n    d_20150225\n    d_20160309\n    d_20150728\n\nIn that case all files under ``/hdfs/path/to/clickstream/{d_20150225,\nd_20160309, d_20150728}`` will be merged. Note, that they wont be merged into\nthe *same* file. Rather, three different output directories, one for each directory\nin listed in ``directory_list.txt``, will be created.\n\n--------------------------------------------\nExample invocation for a sliding time window\n--------------------------------------------\n\nThe following invocation the ``filemerge`` script will merge files in the\n``clickstream`` directory for the last 20 days (not including today). The window\nis datetime aware.\n\n.. code-block:: sh\n\n    python filemerge/filemerge.py \\\n        -i '/hdfs/path/to/clickstream' \\\n        -o '/hdfs/path/to/clickstream-merged' \\\n        -t 'clickstream' \\\n        -w 20\n\n---------------------------------------------------\nExample invocation for a sliding window daily merge\n---------------------------------------------------\n\nThe following invocation the ``filemerge`` script will merge files in the\n``clickstream`` topic for the day 20 days prior to today. The lookback is\ndatetime aware.\n\n.. code-block:: sh\n\n    python filemerge/filemerge.py \\\n        -i '/hdfs/path/to/clickstream' \\\n        -o '/hdfs/path/to/clickstream-merged' \\\n        -t 'clickstream' \\\n        -l 20\n\n---------------------\nMulti-directory merge\n---------------------\n\nFor multi-directory merges, ``filemerge.py`` can be called from a script that\nprovides the list of directories and the merge frequency. The following wrapper\nscript shows how to merge 2015 files for a subset of directories. The script needs to\nbe present in the same directory as the ``filemerge.py`` script.\n\n .. code-block:: sh\n\n    #!/bin/bash\n\n    # List of all HDFS subdirectories can be obtained as follows\n    # hadoop fs -ls /hdfs/base/path | sed -E \"s:.*/hdfs/base/path/(.*)$:\\\\1:\"\n     \n    # Set of subdirectories to be merged, obtained from output of the\n    # above command\n\n    TOPICS=(\n        businessevents\n        customer-transactions\n        desktop-clickstream\n        mobile-clickstream-ios\n        mobile-clickstream-android)\n    \n    YEAR=2015\n    for TOPIC in ${TOPICS[@]}; do\n        OUTPUT_DIR=\"/hdfs/base/path/${TOPIC}-merged\"\n\n        python filemerge/filemerge.py \\\n            -i '/hdfs/base/path/${TOPIC}' \\\n            -o ${OUTPUT_DIR} \\\n            -t ${TOPIC} \\\n            -y 2015\n    done\n\n-----------------------\nMerge for custom months\n-----------------------\n\nMerging for custom months is straightforward and is similar to above looping\nlogic. Once again, the following script needs to be located in the same directory\nas ``filemerge.py``.\n\n .. code-block:: sh\n\n    #!/bin/bash\n\n    # Subset of months to be merged\n    MONTHS=(\n        01 \n        02\n        07\n        09\n        10\n        12)\n    \n    YEAR=2015\n    TOPIC=\"clickstream\"\n    OUTPUT_DIR=\"/hdfs/base/path/${TOPIC}-merged\"\n\n    for MM in ${MONTHS[@]}; do        \n        python filemerge/filemerge.py \\\n            -i '/hdfs/base/path/${TOPIC}' \\\n            -o ${OUTPUT_DIR} \\\n            -t ${TOPIC} \\\n            -y 2015 \\\n            -m ${MONTH}\n\n    done\n\n------------------\nHigh-level pattern\n------------------\n\nThe overarching pattern here is to realize that **the unit of time for the merge\nlogic is a directory**. As long as this is noted, the actual logic can be customized\nin more ways than those shown above: simply write a wrapper shell script to\ncreate your variables and loop over them. These variables can be months,\ninput directories, or output directories.", "description_content_type": null, "docs_url": null, "download_url": "https://github.com/intuit/filemerge/tarball/0.1", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/intuit/filemerge", "keywords": "pypi,filemerge", "license": "UNKNOWN", "maintainer": null, "maintainer_email": null, "name": "filemerge", "package_url": "https://pypi.org/project/filemerge/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/filemerge/", "project_urls": {"Download": "https://github.com/intuit/filemerge/tarball/0.1", "Homepage": "https://github.com/intuit/filemerge"}, "release_url": "https://pypi.org/project/filemerge/0.0.3/", "requires_dist": null, "requires_python": null, "summary": "Filemerge: Tool to merge small HDFS files", "version": "0.0.3", "yanked": false, "html_description": "<div class=\"project-description\">\n            <div id=\"filemerge\">\n<h2>Filemerge</h2>\n<p>Filemerge is a utility for merging a large number of small HDFS files into\nsmaller number of large files. Filemerge is intended for use by Hadoop operations\nengineers and map-reduce application developers.</p>\n<p>The structure of the code is simple. The actual merging is performed by a Pig\nscript created at run time using user-supplied parameters. These parameters\ncontrol the set of files to merge. The utility consists of a single file,\n<tt>filemerge.py</tt>, that takes the input parameters and invokes the created pig\nscript. As such, <tt>pig</tt> <strong>command needs to be available and in path of the\nruntime user.</strong> The user specifies the input path, output path, topic, and\nfiles to be merged either as a year/month/day format or specific HDFS directory\nor a list of HDFS directories in a file.</p>\n</div>\n<div id=\"installation-and-testing\">\n<h2>Installation and testing</h2>\n<p>Because the application code is small and self-contained, installation requires\nsimply cloning the repository.</p>\n<pre>git clone https://github.com/intuit/filemerge.git\n</pre>\n<p>Note that <tt>filemerge</tt> itself does not have any dependencies besides pig\ncommand-line. However, running the test suite locally requires installation of\nthe test discovery and mocking packages. These dependencies are listed in\n<tt>filemerge/requirements.txt</tt> and can be installed as follows.</p>\n<pre><span class=\"nb\">cd</span> filemerge\npip install -r requirements.txt\n</pre>\n<p>Finally, installation can be verified by running the test suite locally.</p>\n<pre>nosetests -w unit_tests -v\n</pre>\n<p>Developers can check test coverage running</p>\n<pre>./runtests.sh\n</pre>\n<p>from the project top-level directory.</p>\n</div>\n<div id=\"running-the-script\">\n<h2>Running the script</h2>\n<div id=\"the-script-api\">\n<h3>The script API</h3>\n<p>The full API of the script is available on commandline by typing</p>\n<pre>python filemerge.py -h\n</pre>\n<p>The help message is reproduced below for reference.</p>\n<pre>Usage:\n    python filemerge.py --topic<span class=\"o\">=</span>&lt;<span class=\"s1\">'topic-in-single-quotes'</span>&gt;\n                        --input-prefix<span class=\"o\">=</span>&lt;<span class=\"s1\">'HDFS-location-in-single-quotes'</span>&gt;\n                        --output-prefix<span class=\"o\">=</span>&lt;<span class=\"s1\">'HDFS-location-in-single-quotes'</span>&gt;\n                        --num-reducers<span class=\"o\">=</span>&lt;any-positive-integer&gt;\n                        --queue<span class=\"o\">=</span>&lt;hadoop queue name&gt;\n                        <span class=\"o\">[</span>--year<span class=\"o\">=</span>&lt;<span class=\"m\">4</span>-digit-year&gt;<span class=\"o\">]</span>\n                        <span class=\"o\">[</span>--month<span class=\"o\">=</span>&lt;month&gt;<span class=\"o\">]</span>\n                        <span class=\"o\">[</span>--day<span class=\"o\">=</span>&lt;day&gt;<span class=\"o\">]</span>\n                        <span class=\"o\">[</span>--dir<span class=\"o\">=</span>&lt;directory relative to input-prefix&gt;<span class=\"o\">]</span>\n                        <span class=\"o\">[</span>--file<span class=\"o\">=</span>&lt;file with list of directories, relative to input-prefix&gt;<span class=\"o\">]</span>\n                        <span class=\"o\">[</span>--window<span class=\"o\">=</span>&lt;window size in days&gt;<span class=\"o\">]</span>\n                        <span class=\"o\">[</span>--codec<span class=\"o\">=</span>&lt;valid hadoop compression codec&gt;<span class=\"o\">]</span>\n                        <span class=\"o\">[</span>-r<span class=\"o\">]</span>\n\n\n\nOptions:\n  -h, --help            show this <span class=\"nb\">help</span> message and <span class=\"nb\">exit</span>\n  -y YEAR, --year<span class=\"o\">=</span>YEAR  Year <span class=\"k\">for</span> the merge\n  -m MONTH, --month<span class=\"o\">=</span>MONTH\n                        Month <span class=\"k\">for</span> the merge\n  -d DAY, --day<span class=\"o\">=</span>DAY     Day <span class=\"k\">for</span> the merge\n  -D DIRECTORY, --directory<span class=\"o\">=</span>DIRECTORY\n                        Directory containing files to merge\n  -f FILE, --file<span class=\"o\">=</span>FILE  File containing list of input directories\n  -w WINDOW, --window<span class=\"o\">=</span>WINDOW\n                        Window in days <span class=\"o\">(</span>merge <span class=\"k\">for</span> the past *n* days\n  -l LOOKBACK, --lookback<span class=\"o\">=</span>LOOKBACK\n                        Lookback period <span class=\"o\">(</span>merge <span class=\"k\">for</span> <span class=\"m\">1</span> day *n* days prior<span class=\"o\">)</span>\n  -t TOPIC, --topic<span class=\"o\">=</span>TOPIC\n                        Topic <span class=\"k\">for</span> the merge\n  -i INPUT_PREFIX, --input-prefix<span class=\"o\">=</span>INPUT_PREFIX\n                        Input directory prefix\n  -o OUTPUT_PREFIX, --output-prefix<span class=\"o\">=</span>OUTPUT_PREFIX\n                        Output directory prefix\n  -n NUM_REDUCERS, --num-reducers<span class=\"o\">=</span>NUM_REDUCERS\n                        Number of reducers\n  -c CODEC, --codec<span class=\"o\">=</span>CODEC\n                        Compression codec to use\n  -q QUEUE, --queue<span class=\"o\">=</span>QUEUE\n                        Mapreduce job queue\n  -r, --dry-run         Dry run<span class=\"p\">;</span> create, but dont execute the Pig script\n</pre>\n<p>The arguments outside the square brackets are required and those in the square\nbrackets are optional, but a minimum set of these arguments is needed to compute\nthe set of directories to be merged. The acceptable option groups are following:</p>\n<blockquote>\n<ul>\n<li><dl>\n<dt>Group 1</dt>\n<dd><ul>\n<li>year (-y)</li>\n<li>year (-y), month (-m)</li>\n<li>year (-y), month (-m), day (-d)</li>\n</ul>\n</dd>\n</dl>\n</li>\n<li><dl>\n<dt>Group 2</dt>\n<dd><ul>\n<li>HDFS directory (-D)</li>\n</ul>\n</dd>\n</dl>\n</li>\n<li><dl>\n<dt>Group 3</dt>\n<dd><ul>\n<li>file with a list of HDFS directories (-f)</li>\n</ul>\n</dd>\n</dl>\n</li>\n<li><dl>\n<dt>Group 4</dt>\n<dd><ul>\n<li>window with a start date (-w); files for all days between start date minus\nwindow to start date will be merged</li>\n</ul>\n</dd>\n</dl>\n</li>\n<li><dl>\n<dt>Group 5</dt>\n<dd><ul>\n<li>lookback with a start date (-l); files for a single day lookback days before the\nstart date will be merged</li>\n</ul>\n</dd>\n</dl>\n</li>\n</ul>\n</blockquote>\n<p>These option groups are designed to enable merging at the directory, day, month,\nor the year level. The <tt><span class=\"pre\">-f</span></tt> offers ability to merge non-contiguous firectory\nblocks. The <tt><span class=\"pre\">-w</span></tt> and <tt><span class=\"pre\">-l</span></tt> options allow merging of directories at periodic\nintervals using a sliding window.</p>\n<p>One can further enhance the flexibility of these options by wrapping the\n<tt>python</tt> call in a shell script and providing custom list of directories,\nnon-contiguous months, shunking large directory lists into smaller parts etc.</p>\n<div id=\"why-all-the-flexibility\">\n<h4>Why all the flexibility?</h4>\n<p>The <tt>filemerge</tt> tool is written with operations and map-reduce application\ndevelopers in mind. Operations team will need periodic merges based on the\nretention policy and will typically use the tool with the <tt><span class=\"pre\">-y,</span> <span class=\"pre\">-m,</span> <span class=\"pre\">-d</span></tt>\noptions. Map-reduce application developers might need to merge single\ndirectories or random directory groups and will use the <tt><span class=\"pre\">-d</span></tt> and <tt><span class=\"pre\">-f</span></tt>\noptions.</p>\n</div>\n</div>\n<div id=\"basic-usage-merging-all-files-in-a-directory\">\n<h3>Basic usage: Merging all files in a directory</h3>\n<p>The most common usage pattern for <tt>filemerge</tt> is to merge all files in a\ndirectory and produce one output file (in a different directory). To merge files\nunders a specific directory, provide the basepath using the <tt><span class=\"pre\">-i</span></tt> option and\nthe final directory name using the <tt><span class=\"pre\">-D</span></tt> option. In the following invocation\nthe <tt>/path/to/clickstream</tt> is the base HDFS path and <tt>jan2016</tt> is the\nsubdirectory that contains the files to be merged (in this case, for January\n2016). In other words, the full path to the files that will be merged is:\n<tt>/path/to/clickstream/jan2016</tt></p>\n<pre>python filemerge/filemerge.py <span class=\"se\">\\\n</span>    -i <span class=\"s1\">'/hdfs/path/to/clickstream'</span> <span class=\"se\">\\\n</span>    -D <span class=\"s1\">'jan2016'</span> <span class=\"se\">\\\n</span>    -o <span class=\"s1\">'/hdfs/path/to/jan2016-merged'</span> <span class=\"se\">\\\n</span>    -t <span class=\"s1\">'clickstream'</span>\n</pre>\n</div>\n<div id=\"example-invocation-for-a-full-month-merge\">\n<h3>Example invocation for a full month merge</h3>\n<p>Following command invokes the script for merging February 2015 data of the\n\u2018clickstream\u2019 directory in HDFS. This is the raw call to the filemerge python script\nand will initiate 28 map-reduce jobs.</p>\n<pre>python filemerge/filemerge.py <span class=\"se\">\\\n</span>    -i <span class=\"s1\">'/hdfs/path/to/clickstream'</span> <span class=\"se\">\\\n</span>    -o <span class=\"s1\">'/hdfs/path/to/clickstream-merged'</span> <span class=\"se\">\\\n</span>    -t <span class=\"s1\">'clickstream'</span> <span class=\"se\">\\\n</span>    -y <span class=\"m\">2015</span> <span class=\"se\">\\\n</span>    -m <span class=\"m\">2</span>\n</pre>\n</div>\n<div id=\"example-invocation-for-a-full-year-merge\">\n<h3>Example invocation for a full year merge</h3>\n<p>Simply omit the month and day options and the merge wil be performed for the\nfull year. Following command invokes the script for merging the entire 2015 data\nof the \u2018clickstream\u2019 directory with a 1 day chunk size. This will initiate 365\nmap-reduce jobs.</p>\n<pre>python filemerge/filemerge.py <span class=\"se\">\\\n</span>    -i <span class=\"s1\">'/hdfs/path/to/clickstream'</span> <span class=\"se\">\\\n</span>    -o <span class=\"s1\">'/hdfs/path/to/clickstream-merged'</span> <span class=\"se\">\\\n</span>    -t <span class=\"s1\">'clickstream'</span> <span class=\"se\">\\\n</span>    -y <span class=\"m\">2015</span>\n</pre>\n<p>Note that detecting files in time window (e.g. a certain month or a year)\nrequires <tt>filemerge</tt> to assume certain directory naming conventions. This\nconvention is specified in <tt>filemerge/templates.py</tt> and can be user-defined.</p>\n</div>\n<div id=\"example-invocation-for-a-non-contiguous-directory-list\">\n<h3>Example invocation for a non-contiguous directory list</h3>\n<p>To merge files under unrelated non-contiguous directories, list all the final\ndirectory names in a file and pass the full file path to the <tt><span class=\"pre\">-f</span></tt> option. In\nthe invocation below, <tt><span class=\"pre\">-i</span></tt> captures the common portion of the path to all the\ndirectories and the final directories are listed in the file.</p>\n<pre>python filemerge/filemerge.py <span class=\"se\">\\\n</span>    -i <span class=\"s1\">'/hdfs/path/to/clickstream'</span> <span class=\"se\">\\\n</span>    -o <span class=\"s1\">'/hdfs/path/to/clickstream-merged'</span> <span class=\"se\">\\\n</span>    -t <span class=\"s1\">'clickstream'</span> <span class=\"se\">\\\n</span>    -f /local/filesystem/path/to/directory_list.txt\n</pre>\n<p>Lets assume to that <tt>/local/filesystem/path/to/directory_list.txt</tt> contains\nthe following lines</p>\n<pre>d_20150225\nd_20160309\nd_20150728\n</pre>\n<p>In that case all files under <tt><span class=\"pre\">/hdfs/path/to/clickstream/{d_20150225,</span>\nd_20160309, d_20150728}</tt> will be merged. Note, that they wont be merged into\nthe <em>same</em> file. Rather, three different output directories, one for each directory\nin listed in <tt>directory_list.txt</tt>, will be created.</p>\n</div>\n<div id=\"example-invocation-for-a-sliding-time-window\">\n<h3>Example invocation for a sliding time window</h3>\n<p>The following invocation the <tt>filemerge</tt> script will merge files in the\n<tt>clickstream</tt> directory for the last 20 days (not including today). The window\nis datetime aware.</p>\n<pre>python filemerge/filemerge.py <span class=\"se\">\\\n</span>    -i <span class=\"s1\">'/hdfs/path/to/clickstream'</span> <span class=\"se\">\\\n</span>    -o <span class=\"s1\">'/hdfs/path/to/clickstream-merged'</span> <span class=\"se\">\\\n</span>    -t <span class=\"s1\">'clickstream'</span> <span class=\"se\">\\\n</span>    -w <span class=\"m\">20</span>\n</pre>\n</div>\n<div id=\"example-invocation-for-a-sliding-window-daily-merge\">\n<h3>Example invocation for a sliding window daily merge</h3>\n<p>The following invocation the <tt>filemerge</tt> script will merge files in the\n<tt>clickstream</tt> topic for the day 20 days prior to today. The lookback is\ndatetime aware.</p>\n<pre>python filemerge/filemerge.py <span class=\"se\">\\\n</span>    -i <span class=\"s1\">'/hdfs/path/to/clickstream'</span> <span class=\"se\">\\\n</span>    -o <span class=\"s1\">'/hdfs/path/to/clickstream-merged'</span> <span class=\"se\">\\\n</span>    -t <span class=\"s1\">'clickstream'</span> <span class=\"se\">\\\n</span>    -l <span class=\"m\">20</span>\n</pre>\n</div>\n<div id=\"multi-directory-merge\">\n<h3>Multi-directory merge</h3>\n<p>For multi-directory merges, <tt>filemerge.py</tt> can be called from a script that\nprovides the list of directories and the merge frequency. The following wrapper\nscript shows how to merge 2015 files for a subset of directories. The script needs to\nbe present in the same directory as the <tt>filemerge.py</tt> script.</p>\n<blockquote>\n<pre><span class=\"ch\">#!/bin/bash\n</span>\n<span class=\"c1\"># List of all HDFS subdirectories can be obtained as follows\n# hadoop fs -ls /hdfs/base/path | sed -E \"s:.*/hdfs/base/path/(.*)$:\\\\1:\"\n</span>\n<span class=\"c1\"># Set of subdirectories to be merged, obtained from output of the\n# above command\n</span>\n<span class=\"nv\">TOPICS</span><span class=\"o\">=(</span>\n    businessevents\n    customer-transactions\n    desktop-clickstream\n    mobile-clickstream-ios\n    mobile-clickstream-android<span class=\"o\">)</span>\n\n<span class=\"nv\">YEAR</span><span class=\"o\">=</span><span class=\"m\">2015</span>\n<span class=\"k\">for</span> TOPIC in <span class=\"si\">${</span><span class=\"nv\">TOPICS</span><span class=\"p\">[@]</span><span class=\"si\">}</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n    <span class=\"nv\">OUTPUT_DIR</span><span class=\"o\">=</span><span class=\"s2\">\"/hdfs/base/path/</span><span class=\"si\">${</span><span class=\"nv\">TOPIC</span><span class=\"si\">}</span><span class=\"s2\">-merged\"</span>\n\n    python filemerge/filemerge.py <span class=\"se\">\\\n</span>        -i <span class=\"s1\">'/hdfs/base/path/${TOPIC}'</span> <span class=\"se\">\\\n</span>        -o <span class=\"si\">${</span><span class=\"nv\">OUTPUT_DIR</span><span class=\"si\">}</span> <span class=\"se\">\\\n</span>        -t <span class=\"si\">${</span><span class=\"nv\">TOPIC</span><span class=\"si\">}</span> <span class=\"se\">\\\n</span>        -y <span class=\"m\">2015</span>\n<span class=\"k\">done</span>\n</pre>\n</blockquote>\n</div>\n<div id=\"merge-for-custom-months\">\n<h3>Merge for custom months</h3>\n<p>Merging for custom months is straightforward and is similar to above looping\nlogic. Once again, the following script needs to be located in the same directory\nas <tt>filemerge.py</tt>.</p>\n<blockquote>\n<pre><span class=\"ch\">#!/bin/bash\n</span>\n<span class=\"c1\"># Subset of months to be merged\n</span><span class=\"nv\">MONTHS</span><span class=\"o\">=(</span>\n    <span class=\"m\">01</span>\n    <span class=\"m\">02</span>\n    <span class=\"m\">07</span>\n    <span class=\"m\">09</span>\n    <span class=\"m\">10</span>\n    <span class=\"m\">12</span><span class=\"o\">)</span>\n\n<span class=\"nv\">YEAR</span><span class=\"o\">=</span><span class=\"m\">2015</span>\n<span class=\"nv\">TOPIC</span><span class=\"o\">=</span><span class=\"s2\">\"clickstream\"</span>\n<span class=\"nv\">OUTPUT_DIR</span><span class=\"o\">=</span><span class=\"s2\">\"/hdfs/base/path/</span><span class=\"si\">${</span><span class=\"nv\">TOPIC</span><span class=\"si\">}</span><span class=\"s2\">-merged\"</span>\n\n<span class=\"k\">for</span> MM in <span class=\"si\">${</span><span class=\"nv\">MONTHS</span><span class=\"p\">[@]</span><span class=\"si\">}</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n    python filemerge/filemerge.py <span class=\"se\">\\\n</span>        -i <span class=\"s1\">'/hdfs/base/path/${TOPIC}'</span> <span class=\"se\">\\\n</span>        -o <span class=\"si\">${</span><span class=\"nv\">OUTPUT_DIR</span><span class=\"si\">}</span> <span class=\"se\">\\\n</span>        -t <span class=\"si\">${</span><span class=\"nv\">TOPIC</span><span class=\"si\">}</span> <span class=\"se\">\\\n</span>        -y <span class=\"m\">2015</span> <span class=\"se\">\\\n</span>        -m <span class=\"si\">${</span><span class=\"nv\">MONTH</span><span class=\"si\">}</span>\n\n<span class=\"k\">done</span>\n</pre>\n</blockquote>\n</div>\n<div id=\"high-level-pattern\">\n<h3>High-level pattern</h3>\n<p>The overarching pattern here is to realize that <strong>the unit of time for the merge\nlogic is a directory</strong>. As long as this is noted, the actual logic can be customized\nin more ways than those shown above: simply write a wrapper shell script to\ncreate your variables and loop over them. These variables can be months,\ninput directories, or output directories.</p>\n</div>\n</div>\n\n          </div>"}, "last_serial": 2369805, "releases": {"0.0.2": [], "0.0.3": [{"comment_text": "", "digests": {"md5": "db7b1fc7f43bfb1f22fd6a47f5847470", "sha256": "59d42958d48db5f76f2c6a5f64ebbe4a2437f50755a97e26f59da47d2b1145f0"}, "downloads": -1, "filename": "filemerge-0.0.3.tar.gz", "has_sig": false, "md5_digest": "db7b1fc7f43bfb1f22fd6a47f5847470", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 11827, "upload_time": "2016-09-28T23:20:38", "upload_time_iso_8601": "2016-09-28T23:20:38.653964Z", "url": "https://files.pythonhosted.org/packages/d0/74/4c86dae0ef8c0e7f9098eb621acff5b4817cede82b2ed2438383b34637fd/filemerge-0.0.3.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "db7b1fc7f43bfb1f22fd6a47f5847470", "sha256": "59d42958d48db5f76f2c6a5f64ebbe4a2437f50755a97e26f59da47d2b1145f0"}, "downloads": -1, "filename": "filemerge-0.0.3.tar.gz", "has_sig": false, "md5_digest": "db7b1fc7f43bfb1f22fd6a47f5847470", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 11827, "upload_time": "2016-09-28T23:20:38", "upload_time_iso_8601": "2016-09-28T23:20:38.653964Z", "url": "https://files.pythonhosted.org/packages/d0/74/4c86dae0ef8c0e7f9098eb621acff5b4817cede82b2ed2438383b34637fd/filemerge-0.0.3.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:42:34 2020"}