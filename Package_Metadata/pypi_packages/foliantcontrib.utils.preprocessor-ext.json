{"info": {"author": "Daniil Minukhin", "author_email": "ddddsa@gmail.com", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Environment :: Console", "Intended Audience :: Developers", "License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python", "Topic :: Documentation", "Topic :: Utilities"], "description": "[![](https://img.shields.io/pypi/v/foliantcontrib.utils.preprocessor_ext.svg)](https://pypi.org/project/foliantcontrib.utils.preprocessor_ext/) [![](https://img.shields.io/github/v/tag/foliant-docs/foliantcontrib.utils.preprocessor_ext.svg?label=GitHub)](https://github.com/foliant-docs/foliantcontrib.utils.preprocessor_ext)\n\n# Overview\n\nExtension for basic Preprocessor class with useful methods and functions.\n\n# Usage\n\nUsually when we create preprocessors we inherit from `BasePreprocessor`:\n\n```python\n\nclass Preprocessor(BasePreprocessor):\n  ...\n```\n\nTo use all features of preprocessor_ext we should inherit from `BasePreprocessorExt` instead:\n\n```python\n\nclass Preprocessor(BasePreprocessorExt):\n  ...\n```\n\n# Features\n\n## Simplified tag processing workflow\n\nUsually to process tags in Markdown-files we write something like this:\n\n```python\nclass Preprocessor(BasePreprocessor):\n  ...\n  def _process_tags(content):\n    def sub(match):\n      # process the tag\n      return processed_string\n\n    self.pattern.sub(sub, content)\n\n  def apply(self):\n    self.logger.info('Applying preprocessor')\n    for markdown_file_path in self.working_dir.rglob('*.md'):\n        with open(markdown_file_path, encoding='utf8') as markdown_file:\n            content = markdown_file.read()\n\n        processed_content = self._process_tags(content)\n\n        if processed_content:\n            with open(markdown_file_path, 'w') as markdown_file:\n                markdown_file.write(processed_content)\n        self.logger.info('Preprocessor applied')\n```\n\nBasePreprocessorExt saves us from writing these many lines of the code which appear unchanged in most preprocessors.\n\nSo now instead of all that code we will write:\n\n```python\nclass Preprocessor(BasePreprocessorExt):\n  ...\n  def _process_tag(match):\n    # process the tag\n    return processed_string\n\n  def apply(self):\n    self._process_tags_for_all_files(func=self._process_tag)\n        self.logger.info('Preprocessor applied')\n```\n\nAs a bonus when using this workflow we get additional capabilities of logging and outputting warnings.\n\n### Issuing warnings\n\nWhen using `_process_tags_for_all_files` method to process tags we can also take advantage of `_warning` method.\n\nWhat this method does:\n1. Prints warning message to user and adds the md-file name to this message.\n2. Logs this message.\n3. May also add to logged message context of the tag where the problem occured.\n4. May also add to logged message the error traceback.\n5. If debug=true, #3 and #4 are also added to the message which is printed to user.\n\nSimple example:\n\n```python\nclass Preprocessor(BasePreprocessorExt):\n  ...\n  def _process_tag(match):\n    try:\n      config = open(self.options.get('config'))\n    except FileNotFoundError as e:\n      self._warning('Config file not found! Using default', error=e)\n    ...\n```\n\nHere if the exception gets triggered, user will see something like this in console:\n\n```bash\nParsing config\nDone\n\nApplying preprocessor my_preprocessor\nWARNING: [index.md] Config file not found! Using default\n\nDone\n\nApplying preprocessor _unescape\nDone\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nResult: slug.pre\n\n```\n\nAs we see, we've only supplied the message, but the preprocessor also added the `WARNING:` prefix and current file name to console. If we'd run the make command in debug mode (with `-d --debug` flag), we would also see full traceback of the error. In any case, traceback is stored in log.\n\n### Getting tag context\n\nSometimes we want to show the context of the tag, where we met some problems. By context I mean some words before the tag, some contents of the tag body and some words after the tag. It's really useful for debugging large md-files, with context you usually can identify the place in the document which causes errors.\n\nFor this purpose `BasePreprocessorExt` class has a handy method called `get_tag_context`. Give it the match object you are currently working with and it will return you the string with tag context.\n\nFor example:\n\n```python\nclass Preprocessor(BasePreprocessorExt):\n  ...\n  def _process_tag(match):\n    try:\n      config = open(self.options.get('config'))\n    except FileNotFoundError as e:\n      context = self.get_tag_context(match)\n      print(f'Config not found, check the tag:\\n{context}')\n    ...\n```\n\nThis will print:\n\n```bash\nParsing config\nDone\n\nApplying preprocessor my_preprocessor\n\nConfig not found, check the tag:\n...amet, consectetur adipisicing elit. Dolores ipsum non nisi voluptatum alias.\n\n<my_tag param=\"value\" config=\"wrong/path\">\n    Tag body consectetur adipisicing elit. Voluptatem.\n</template>\n\nEnd of document.\n```\n\nNow user can easily understand where's the problem in his document.\n\n`get_tag_context` function accepts two parameters:\n\n`limit` (default: `100`) \u2014 number of characters included in context from before the tag, after the tag, and of the tag body;\n`full_tag` (default: `False`) \u2014 if this is True, the tag body is copied into context without cropping (useful for relatively small expected tag bodies).\n\n### Sending context to warning\n\nOne last thing to use the full power of `BasePreprocessorExt` warnings:\n\n`self._warning` accepts the context parameter. You can send there the context string. The context is only shown to user in the console if the debug mode is on, but it is always saved in the log file.\n\nExample:\n\n```python\nclass Preprocessor(BasePreprocessorExt):\n  ...\n  def _process_tag(match):\n    try:\n      config = open(self.options.get('config'))\n    except FileNotFoundError as e:\n      self._warning('Config file not found! Using default',\n                    context=self.get_context(match),\n                    error=e)\n    ...\n```\n\nNow if we catch this exception in normal mode, we will only get the md-filename and the message in the console. But if we run it in debug mode, we will get a full python traceback and the context of the tag. And a happy user.\n\n### allow_fail decorator\n\nOften we don't want the whole preprocessor to crash if there are some problems in just one tag of the document. We can easily achieve this using the `allow_fail` decorator, which is included in the `preprocessor_ext` module. Decorate your function, which is then sent to `_process_tags_for_all_files` method:\n\n```python\nfrom foliant.preprocessors.utils.preprocessor_ext import (BasePreprocessorExt,\n                                                          allow_fail)\n\n\nclass Preprocessor(BasePreprocessorExt):\n  ...\n  @allow_fail()\n  def _process_tag(match):\n    # process the tag\n    return processed_string\n\n  def apply(self):\n    self._process_tags_for_all_files(func=self._process_tag)\n        self.logger.info('Preprocessor applied')\n```\n\nNow in case _any_ error occurs in the `_process_tag` function, preprocessor will issue warning, show it to user, save it into log and skip the tag.\n\nThe `allow_fail` decorator accepts one argument, the error message, which will be shown to user in case of exception. It defaults to: _Failed to process tag. Skipping._\n\n## Simplified file processing workflow\n\nIf your preprocessor doesn't have tags, you're probably doing somehing like this:\n\n```python\nclass Preprocessor(BasePreprocessor):\n  ...\n  def _process_file(content):\n    processed = content\n    # do something with the content\n    return processed\n\n  def apply(self):\n    self.logger.info('Applying preprocessor')\n    for markdown_file_path in self.working_dir.rglob('*.md'):\n        with open(markdown_file_path, encoding='utf8') as markdown_file:\n            content = markdown_file.read()\n\n        processed_content = self._process_tags(content)\n\n        if processed_content:\n            with open(markdown_file_path, 'w') as markdown_file:\n                markdown_file.write(processed_content)\n        self.logger.info('Preprocessor applied')\n```\n\nBasePreprocessorExt saves us from writing these many lines of the code which appear unchanged in most preprocessors.\n\nSo now instead of all that code we will write:\n\n```python\nclass Preprocessor(BasePreprocessorExt):\n  ...\n  def _process_file(match):\n    processed = content\n    # do something with the content\n    return processed\n\n  def apply(self):\n    self._process_all_files(func=self._process_tag)\n        self.logger.info('Preprocessor applied')\n```\n\nAs a bonus we have `self.current_filepath` set to the path of currently processing file and `self.current_filename` \u2014 to the chapter name, as it is would be stated in `chapters` foliant.yml section.\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/foliant-docs/foliantcontrib.utils.preprocessor_ext", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "foliantcontrib.utils.preprocessor-ext", "package_url": "https://pypi.org/project/foliantcontrib.utils.preprocessor-ext/", "platform": "any", "project_url": "https://pypi.org/project/foliantcontrib.utils.preprocessor-ext/", "project_urls": {"Homepage": "https://github.com/foliant-docs/foliantcontrib.utils.preprocessor_ext"}, "release_url": "https://pypi.org/project/foliantcontrib.utils.preprocessor-ext/1.0.3/", "requires_dist": ["foliant (>=1.0.8)", "foliantcontrib.meta (>=1.2.3)", "PyYAML"], "requires_python": "", "summary": "Extension to basic preprocessor class with useful methods and functions.", "version": "1.0.3", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><a href=\"https://pypi.org/project/foliantcontrib.utils.preprocessor_ext/\" rel=\"nofollow\"><img alt=\"\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/fb94951089cc0e4acb6dfae88280e7605657c012/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f666f6c69616e74636f6e747269622e7574696c732e70726570726f636573736f725f6578742e737667\"></a> <a href=\"https://github.com/foliant-docs/foliantcontrib.utils.preprocessor_ext\" rel=\"nofollow\"><img alt=\"\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/299e9bf9418247956c5f1963917a9133950ad7b6/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f762f7461672f666f6c69616e742d646f63732f666f6c69616e74636f6e747269622e7574696c732e70726570726f636573736f725f6578742e7376673f6c6162656c3d476974487562\"></a></p>\n<h1>Overview</h1>\n<p>Extension for basic Preprocessor class with useful methods and functions.</p>\n<h1>Usage</h1>\n<p>Usually when we create preprocessors we inherit from <code>BasePreprocessor</code>:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessor</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n</pre>\n<p>To use all features of preprocessor_ext we should inherit from <code>BasePreprocessorExt</code> instead:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessorExt</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n</pre>\n<h1>Features</h1>\n<h2>Simplified tag processing workflow</h2>\n<p>Usually to process tags in Markdown-files we write something like this:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessor</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n  <span class=\"k\">def</span> <span class=\"nf\">_process_tags</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"nf\">sub</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">):</span>\n      <span class=\"c1\"># process the tag</span>\n      <span class=\"k\">return</span> <span class=\"n\">processed_string</span>\n\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span><span class=\"o\">.</span><span class=\"n\">sub</span><span class=\"p\">(</span><span class=\"n\">sub</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">)</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">apply</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">'Applying preprocessor'</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">markdown_file_path</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">working_dir</span><span class=\"o\">.</span><span class=\"n\">rglob</span><span class=\"p\">(</span><span class=\"s1\">'*.md'</span><span class=\"p\">):</span>\n        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">markdown_file_path</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"s1\">'utf8'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">markdown_file</span><span class=\"p\">:</span>\n            <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">markdown_file</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span>\n\n        <span class=\"n\">processed_content</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_process_tags</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">processed_content</span><span class=\"p\">:</span>\n            <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">markdown_file_path</span><span class=\"p\">,</span> <span class=\"s1\">'w'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">markdown_file</span><span class=\"p\">:</span>\n                <span class=\"n\">markdown_file</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">processed_content</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">'Preprocessor applied'</span><span class=\"p\">)</span>\n</pre>\n<p>BasePreprocessorExt saves us from writing these many lines of the code which appear unchanged in most preprocessors.</p>\n<p>So now instead of all that code we will write:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessorExt</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n  <span class=\"k\">def</span> <span class=\"nf\">_process_tag</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">):</span>\n    <span class=\"c1\"># process the tag</span>\n    <span class=\"k\">return</span> <span class=\"n\">processed_string</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">apply</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_process_tags_for_all_files</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_process_tag</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">'Preprocessor applied'</span><span class=\"p\">)</span>\n</pre>\n<p>As a bonus when using this workflow we get additional capabilities of logging and outputting warnings.</p>\n<h3>Issuing warnings</h3>\n<p>When using <code>_process_tags_for_all_files</code> method to process tags we can also take advantage of <code>_warning</code> method.</p>\n<p>What this method does:</p>\n<ol>\n<li>Prints warning message to user and adds the md-file name to this message.</li>\n<li>Logs this message.</li>\n<li>May also add to logged message context of the tag where the problem occured.</li>\n<li>May also add to logged message the error traceback.</li>\n<li>If debug=true, #3 and #4 are also added to the message which is printed to user.</li>\n</ol>\n<p>Simple example:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessorExt</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n  <span class=\"k\">def</span> <span class=\"nf\">_process_tag</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">):</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n      <span class=\"n\">config</span> <span class=\"o\">=</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">options</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">'config'</span><span class=\"p\">))</span>\n    <span class=\"k\">except</span> <span class=\"ne\">FileNotFoundError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n      <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_warning</span><span class=\"p\">(</span><span class=\"s1\">'Config file not found! Using default'</span><span class=\"p\">,</span> <span class=\"n\">error</span><span class=\"o\">=</span><span class=\"n\">e</span><span class=\"p\">)</span>\n    <span class=\"o\">...</span>\n</pre>\n<p>Here if the exception gets triggered, user will see something like this in console:</p>\n<pre>Parsing config\nDone\n\nApplying preprocessor my_preprocessor\nWARNING: <span class=\"o\">[</span>index.md<span class=\"o\">]</span> Config file not found! Using default\n\nDone\n\nApplying preprocessor _unescape\nDone\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nResult: slug.pre\n</pre>\n<p>As we see, we've only supplied the message, but the preprocessor also added the <code>WARNING:</code> prefix and current file name to console. If we'd run the make command in debug mode (with <code>-d --debug</code> flag), we would also see full traceback of the error. In any case, traceback is stored in log.</p>\n<h3>Getting tag context</h3>\n<p>Sometimes we want to show the context of the tag, where we met some problems. By context I mean some words before the tag, some contents of the tag body and some words after the tag. It's really useful for debugging large md-files, with context you usually can identify the place in the document which causes errors.</p>\n<p>For this purpose <code>BasePreprocessorExt</code> class has a handy method called <code>get_tag_context</code>. Give it the match object you are currently working with and it will return you the string with tag context.</p>\n<p>For example:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessorExt</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n  <span class=\"k\">def</span> <span class=\"nf\">_process_tag</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">):</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n      <span class=\"n\">config</span> <span class=\"o\">=</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">options</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">'config'</span><span class=\"p\">))</span>\n    <span class=\"k\">except</span> <span class=\"ne\">FileNotFoundError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n      <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_tag_context</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">)</span>\n      <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">'Config not found, check the tag:</span><span class=\"se\">\\n</span><span class=\"si\">{</span><span class=\"n\">context</span><span class=\"si\">}</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n    <span class=\"o\">...</span>\n</pre>\n<p>This will print:</p>\n<pre>Parsing config\nDone\n\nApplying preprocessor my_preprocessor\n\nConfig not found, check the tag:\n...amet, consectetur adipisicing elit. Dolores ipsum non nisi voluptatum alias.\n\n&lt;my_tag <span class=\"nv\">param</span><span class=\"o\">=</span><span class=\"s2\">\"value\"</span> <span class=\"nv\">config</span><span class=\"o\">=</span><span class=\"s2\">\"wrong/path\"</span>&gt;\n    Tag body consectetur adipisicing elit. Voluptatem.\n&lt;/template&gt;\n\nEnd of document.\n</pre>\n<p>Now user can easily understand where's the problem in his document.</p>\n<p><code>get_tag_context</code> function accepts two parameters:</p>\n<p><code>limit</code> (default: <code>100</code>) \u2014 number of characters included in context from before the tag, after the tag, and of the tag body;\n<code>full_tag</code> (default: <code>False</code>) \u2014 if this is True, the tag body is copied into context without cropping (useful for relatively small expected tag bodies).</p>\n<h3>Sending context to warning</h3>\n<p>One last thing to use the full power of <code>BasePreprocessorExt</code> warnings:</p>\n<p><code>self._warning</code> accepts the context parameter. You can send there the context string. The context is only shown to user in the console if the debug mode is on, but it is always saved in the log file.</p>\n<p>Example:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessorExt</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n  <span class=\"k\">def</span> <span class=\"nf\">_process_tag</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">):</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n      <span class=\"n\">config</span> <span class=\"o\">=</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">options</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">'config'</span><span class=\"p\">))</span>\n    <span class=\"k\">except</span> <span class=\"ne\">FileNotFoundError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n      <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_warning</span><span class=\"p\">(</span><span class=\"s1\">'Config file not found! Using default'</span><span class=\"p\">,</span>\n                    <span class=\"n\">context</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_context</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">),</span>\n                    <span class=\"n\">error</span><span class=\"o\">=</span><span class=\"n\">e</span><span class=\"p\">)</span>\n    <span class=\"o\">...</span>\n</pre>\n<p>Now if we catch this exception in normal mode, we will only get the md-filename and the message in the console. But if we run it in debug mode, we will get a full python traceback and the context of the tag. And a happy user.</p>\n<h3>allow_fail decorator</h3>\n<p>Often we don't want the whole preprocessor to crash if there are some problems in just one tag of the document. We can easily achieve this using the <code>allow_fail</code> decorator, which is included in the <code>preprocessor_ext</code> module. Decorate your function, which is then sent to <code>_process_tags_for_all_files</code> method:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">foliant.preprocessors.utils.preprocessor_ext</span> <span class=\"kn\">import</span> <span class=\"p\">(</span><span class=\"n\">BasePreprocessorExt</span><span class=\"p\">,</span>\n                                                          <span class=\"n\">allow_fail</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessorExt</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n  <span class=\"nd\">@allow_fail</span><span class=\"p\">()</span>\n  <span class=\"k\">def</span> <span class=\"nf\">_process_tag</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">):</span>\n    <span class=\"c1\"># process the tag</span>\n    <span class=\"k\">return</span> <span class=\"n\">processed_string</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">apply</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_process_tags_for_all_files</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_process_tag</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">'Preprocessor applied'</span><span class=\"p\">)</span>\n</pre>\n<p>Now in case <em>any</em> error occurs in the <code>_process_tag</code> function, preprocessor will issue warning, show it to user, save it into log and skip the tag.</p>\n<p>The <code>allow_fail</code> decorator accepts one argument, the error message, which will be shown to user in case of exception. It defaults to: <em>Failed to process tag. Skipping.</em></p>\n<h2>Simplified file processing workflow</h2>\n<p>If your preprocessor doesn't have tags, you're probably doing somehing like this:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessor</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n  <span class=\"k\">def</span> <span class=\"nf\">_process_file</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">):</span>\n    <span class=\"n\">processed</span> <span class=\"o\">=</span> <span class=\"n\">content</span>\n    <span class=\"c1\"># do something with the content</span>\n    <span class=\"k\">return</span> <span class=\"n\">processed</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">apply</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">'Applying preprocessor'</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">markdown_file_path</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">working_dir</span><span class=\"o\">.</span><span class=\"n\">rglob</span><span class=\"p\">(</span><span class=\"s1\">'*.md'</span><span class=\"p\">):</span>\n        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">markdown_file_path</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"s1\">'utf8'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">markdown_file</span><span class=\"p\">:</span>\n            <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">markdown_file</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span>\n\n        <span class=\"n\">processed_content</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_process_tags</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">processed_content</span><span class=\"p\">:</span>\n            <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">markdown_file_path</span><span class=\"p\">,</span> <span class=\"s1\">'w'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">markdown_file</span><span class=\"p\">:</span>\n                <span class=\"n\">markdown_file</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">processed_content</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">'Preprocessor applied'</span><span class=\"p\">)</span>\n</pre>\n<p>BasePreprocessorExt saves us from writing these many lines of the code which appear unchanged in most preprocessors.</p>\n<p>So now instead of all that code we will write:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Preprocessor</span><span class=\"p\">(</span><span class=\"n\">BasePreprocessorExt</span><span class=\"p\">):</span>\n  <span class=\"o\">...</span>\n  <span class=\"k\">def</span> <span class=\"nf\">_process_file</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"p\">):</span>\n    <span class=\"n\">processed</span> <span class=\"o\">=</span> <span class=\"n\">content</span>\n    <span class=\"c1\"># do something with the content</span>\n    <span class=\"k\">return</span> <span class=\"n\">processed</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">apply</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_process_all_files</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_process_tag</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">'Preprocessor applied'</span><span class=\"p\">)</span>\n</pre>\n<p>As a bonus we have <code>self.current_filepath</code> set to the path of currently processing file and <code>self.current_filename</code> \u2014 to the chapter name, as it is would be stated in <code>chapters</code> foliant.yml section.</p>\n\n          </div>"}, "last_serial": 6934276, "releases": {"1.0.0": [{"comment_text": "", "digests": {"md5": "b6c54b711159a4526182db85cdfe0552", "sha256": "0ce14b5ae2b447ebb185b95572988da7a7d15754a1eccb91cc50a8a7434a320c"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.0-py3-none-any.whl", "has_sig": false, "md5_digest": "b6c54b711159a4526182db85cdfe0552", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 6898, "upload_time": "2019-05-20T09:22:02", "upload_time_iso_8601": "2019-05-20T09:22:02.910858Z", "url": "https://files.pythonhosted.org/packages/77/af/2bc0407a06fdb4aff29de52da0a6d3bd36c4a5b702c5f2a60b40bbfe4f83/foliantcontrib.utils.preprocessor_ext-1.0.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "38d62241acb8883639fba343ce06cc96", "sha256": "94c574162a335a78cd54a1b95da7379a098493fc96a98f33d4dc1d54432e19e0"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.0.tar.gz", "has_sig": false, "md5_digest": "38d62241acb8883639fba343ce06cc96", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 5776, "upload_time": "2019-05-20T09:22:05", "upload_time_iso_8601": "2019-05-20T09:22:05.307292Z", "url": "https://files.pythonhosted.org/packages/a3/d1/b0ea88fd6a5c79077a4d1e2c18feedd3f71b67debf082dcf3510896775a0/foliantcontrib.utils.preprocessor_ext-1.0.0.tar.gz", "yanked": false}], "1.0.1": [{"comment_text": "", "digests": {"md5": "5805229d739c260dc7ae3ff7688857c0", "sha256": "cf3f28bd50b2ad09e9ce850b73f232a22e0fd8c44f02fcd19502dce69fc37bf8"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "5805229d739c260dc7ae3ff7688857c0", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 6902, "upload_time": "2019-06-14T13:23:59", "upload_time_iso_8601": "2019-06-14T13:23:59.528106Z", "url": "https://files.pythonhosted.org/packages/11/ab/1688bfd2661c36d05e8dcbe348b94e20e50eb83f1ff722a52b19946bb1bd/foliantcontrib.utils.preprocessor_ext-1.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "eaef62dae6c33e9b0b7e15ec42995b69", "sha256": "5cb71d9852a81a52f2814df18016006ccb48cc6e8b0308e4efd76f1cd385d2bf"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.1.tar.gz", "has_sig": false, "md5_digest": "eaef62dae6c33e9b0b7e15ec42995b69", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 5773, "upload_time": "2019-06-14T13:24:01", "upload_time_iso_8601": "2019-06-14T13:24:01.203200Z", "url": "https://files.pythonhosted.org/packages/f5/cf/8636787c1cec3e76441a18b62cf776aa1aad9908371bc4e46546aa8c250e/foliantcontrib.utils.preprocessor_ext-1.0.1.tar.gz", "yanked": false}], "1.0.2": [{"comment_text": "", "digests": {"md5": "ee4176e9b0c24d8277da0ad73b978f09", "sha256": "e4f39de7090e0484f15a22149cafd3cbc988fb8637e1111b2a21adc2ef7cc143"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.2-py3-none-any.whl", "has_sig": false, "md5_digest": "ee4176e9b0c24d8277da0ad73b978f09", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 6654, "upload_time": "2019-07-29T10:17:18", "upload_time_iso_8601": "2019-07-29T10:17:18.498780Z", "url": "https://files.pythonhosted.org/packages/73/36/b4b671e075084bfb97214cfdddc3f2e4498f83e38bf1d3ef9b3e51010f4e/foliantcontrib.utils.preprocessor_ext-1.0.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "1a5bb8126b574d26a2969034232e4eb7", "sha256": "16a2882ccad40293f3a3a3eb5e113f4a4c3f6df9f92ac75304b8145b06cab3a1"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.2.tar.gz", "has_sig": false, "md5_digest": "1a5bb8126b574d26a2969034232e4eb7", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 5528, "upload_time": "2019-07-29T10:17:20", "upload_time_iso_8601": "2019-07-29T10:17:20.067233Z", "url": "https://files.pythonhosted.org/packages/1e/4a/844e01cf4881924781a21b031f57a4fde71cea74256465e80fd9db50991c/foliantcontrib.utils.preprocessor_ext-1.0.2.tar.gz", "yanked": false}], "1.0.3": [{"comment_text": "", "digests": {"md5": "ae5fe577c25923db17d04214778236d4", "sha256": "96c4bc2f8720cb13797ddf05ef5d82351b4059b0986403a9a572e3f4d60488c5"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.3-py3-none-any.whl", "has_sig": false, "md5_digest": "ae5fe577c25923db17d04214778236d4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 7218, "upload_time": "2020-04-02T09:08:02", "upload_time_iso_8601": "2020-04-02T09:08:02.208110Z", "url": "https://files.pythonhosted.org/packages/3c/95/76a450514b403e40bbf9ebae1a13562b6bde52fda11dfda51d796f987434/foliantcontrib.utils.preprocessor_ext-1.0.3-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "4c9e47801e27ab16d67287294234e05c", "sha256": "b7862a2467891eaf7c5a7091e9d0da54adc16ef1a6c7b1a53e3b5bd9ef3a197c"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.3.tar.gz", "has_sig": false, "md5_digest": "4c9e47801e27ab16d67287294234e05c", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6138, "upload_time": "2020-04-02T09:08:03", "upload_time_iso_8601": "2020-04-02T09:08:03.730452Z", "url": "https://files.pythonhosted.org/packages/d6/db/07db282822e681f3045986b3177a2b68d2cdb7a4af77d52b248b95535816/foliantcontrib.utils.preprocessor_ext-1.0.3.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "ae5fe577c25923db17d04214778236d4", "sha256": "96c4bc2f8720cb13797ddf05ef5d82351b4059b0986403a9a572e3f4d60488c5"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.3-py3-none-any.whl", "has_sig": false, "md5_digest": "ae5fe577c25923db17d04214778236d4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 7218, "upload_time": "2020-04-02T09:08:02", "upload_time_iso_8601": "2020-04-02T09:08:02.208110Z", "url": "https://files.pythonhosted.org/packages/3c/95/76a450514b403e40bbf9ebae1a13562b6bde52fda11dfda51d796f987434/foliantcontrib.utils.preprocessor_ext-1.0.3-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "4c9e47801e27ab16d67287294234e05c", "sha256": "b7862a2467891eaf7c5a7091e9d0da54adc16ef1a6c7b1a53e3b5bd9ef3a197c"}, "downloads": -1, "filename": "foliantcontrib.utils.preprocessor_ext-1.0.3.tar.gz", "has_sig": false, "md5_digest": "4c9e47801e27ab16d67287294234e05c", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6138, "upload_time": "2020-04-02T09:08:03", "upload_time_iso_8601": "2020-04-02T09:08:03.730452Z", "url": "https://files.pythonhosted.org/packages/d6/db/07db282822e681f3045986b3177a2b68d2cdb7a4af77d52b248b95535816/foliantcontrib.utils.preprocessor_ext-1.0.3.tar.gz", "yanked": false}], "timestamp": "Fri May  8 01:01:06 2020"}