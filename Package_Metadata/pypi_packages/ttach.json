{"info": {"author": "Pavel Yakubovskiy", "author_email": "qubvel@gmail.com", "bugtrack_url": null, "classifiers": ["License :: OSI Approved :: MIT License", "Programming Language :: Python", "Programming Language :: Python :: 3", "Programming Language :: Python :: Implementation :: CPython", "Programming Language :: Python :: Implementation :: PyPy"], "description": "\n# TTAch\nImage Test Time Augmentation with PyTorch!\n\nSimilar to what Data Augmentation is doing to the training set, the purpose of Test Time Augmentation is to perform random modifications to the test images. Thus, instead of showing the regular, \u201cclean\u201d images, only once to the trained model, we will show it the augmented images several times. We will then average the predictions of each corresponding image and take that as our final guess [[1](https://towardsdatascience.com/test-time-augmentation-tta-and-how-to-perform-it-with-keras-4ac19b67fb4d)].  \n```\n           Input\n             |           # input batch of images \n        / / /|\\ \\ \\      # apply augmentations (flips, rotation, scale, etc.)\n       | | | | | | |     # pass augmented batches through model\n       | | | | | | |     # reverse transformations for each batch of masks/labels\n        \\ \\ \\ / / /      # merge predictions (mean, max, gmean, etc.)\n             |           # output batch of masks/labels\n           Output\n```\n## Table of Contents\n1. [Quick Start](#quick-start)\n2. [Transforms](#transforms)\n3. [Aliases](#aliases)\n4. [Merge modes](#merge-modes)\n5. [Installation](#installation)\n\n## Quick start\n\n#####  Segmentation model wrapping:\n```python\nimport ttach as tta\ntta_model = tta.SegmentationTTAWrapper(model, tta.aliases.d4_transform(), merge_mode='mean')\n```\n#####  Classification model wrapping:\n```python\ntta_model = tta.ClassificationTTAWrapper(model, tta.aliases.five_crops_transform())\n```\n\n## Advanced Examples\n#####  Custom transform:\n```python\n# defined 2 * 2 * 3 * 3 = 36 augmentations !\ntransforms = tta.Compose(\n    [\n        tta.HorizontalFlip(),\n        tta.Rotate90(angles=[0, 180]),\n        tta.Scale(scales=[1, 2, 4]),\n        tta.Multiply(factors=[0.9, 1, 1.1]),        \n    ]\n)\n\ntta_model = tta.SegmentationTTAWrapper(model, transforms)\n```\n##### Custom model (multi-input / multi-output)\n```python\n# Example how to process ONE batch on images with TTA\n# Here `image`/`mask` are 4D tensors (B, C, H, W), `label` is 2D tensor (B, N)\n\nfor transformer in transforms: # custom transforms or e.g. tta.aliases.d4_transform() \n\n    # augment image\n    augmented_image = transformer.augment_image(image)\n\n    # pass to model\n    model_output = model(augmented_image, another_input_data)\n\n    # reverse augmentation for mask and label\n    deaug_mask = transformer.deaugment_mask(model_output['mask'])\n    deaug_label = transformer.deaugment_label(model_output['label'])\n\n    # save results\n    labels.append(deaug_mask)\n    masks.append(deaug_label)\n\n# reduce results as you want, e.g mean/max/min\nlabel = mean(labels)\nmask = mean(masks)\n```\n\n## Transforms\n\n| Transform      | Parameters                | Values                            |\n|----------------|:-------------------------:|:---------------------------------:|\n| HorizontalFlip | -                         | -                                 |\n| VerticalFlip   | -                         | -                                 |\n| Rotate90       | angles                    | List\\[0, 90, 180, 270]            |\n| Scale          | scales<br>interpolation   | List\\[float]<br>\"nearest\"/\"linear\"|\n| Resize         | sizes<br>original_size<br>interpolation   | List\\[Tuple\\[int, int]]<br>Tuple\\[int,int]<br>\"nearest\"/\"linear\"|\n| Add            | values                    | List\\[float]                      |\n| Multiply       | factors                   | List\\[float]                      |\n| FiveCrops      | crop_height<br>crop_width | int<br>int                        |\n\n## Aliases\n\n  - flip_transform (horizontal + vertical flips)\n  - hflip_transform (horizontal flip)\n  - d4_transform (flips + rotation 0, 90, 180, 270)\n  - multiscale_transform (scale transform, take scales as input parameter)\n  - five_crop_transform (corner crops + center crop)\n  - ten_crop_transform (five crops + five crops on horizontal flip)\n\n## Merge modes\n - mean\n - gmean (geometric mean)\n - sum\n - max\n - min\n - tsharpen ([temperature sharpen](https://www.kaggle.com/c/severstal-steel-defect-detection/discussion/107716#latest-624046) with t=0.5)\n\n## Installation\nPyPI:\n```bash\n$ pip install ttach\n```\nSource:\n```bash\n$ pip install git+https://github.com/qubvel/ttach\n```\n\n## Run tests\n\n```bash\ndocker build -f Dockerfile.dev -t ttach:dev . && docker run --rm ttach:dev pytest -p no:cacheprovider\n```\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/qubvel/ttach", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "ttach", "package_url": "https://pypi.org/project/ttach/", "platform": "", "project_url": "https://pypi.org/project/ttach/", "project_urls": {"Homepage": "https://github.com/qubvel/ttach"}, "release_url": "https://pypi.org/project/ttach/0.0.2/", "requires_dist": ["pytest ; extra == 'test'"], "requires_python": ">=3.0.0", "summary": "Images test time augmentation with PyTorch.", "version": "0.0.2", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>TTAch</h1>\n<p>Image Test Time Augmentation with PyTorch!</p>\n<p>Similar to what Data Augmentation is doing to the training set, the purpose of Test Time Augmentation is to perform random modifications to the test images. Thus, instead of showing the regular, \u201cclean\u201d images, only once to the trained model, we will show it the augmented images several times. We will then average the predictions of each corresponding image and take that as our final guess [<a href=\"https://towardsdatascience.com/test-time-augmentation-tta-and-how-to-perform-it-with-keras-4ac19b67fb4d\" rel=\"nofollow\">1</a>].</p>\n<pre><code>           Input\n             |           # input batch of images \n        / / /|\\ \\ \\      # apply augmentations (flips, rotation, scale, etc.)\n       | | | | | | |     # pass augmented batches through model\n       | | | | | | |     # reverse transformations for each batch of masks/labels\n        \\ \\ \\ / / /      # merge predictions (mean, max, gmean, etc.)\n             |           # output batch of masks/labels\n           Output\n</code></pre>\n<h2>Table of Contents</h2>\n<ol>\n<li><a href=\"#quick-start\" rel=\"nofollow\">Quick Start</a></li>\n<li><a href=\"#transforms\" rel=\"nofollow\">Transforms</a></li>\n<li><a href=\"#aliases\" rel=\"nofollow\">Aliases</a></li>\n<li><a href=\"#merge-modes\" rel=\"nofollow\">Merge modes</a></li>\n<li><a href=\"#installation\" rel=\"nofollow\">Installation</a></li>\n</ol>\n<h2>Quick start</h2>\n<h5>Segmentation model wrapping:</h5>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">ttach</span> <span class=\"k\">as</span> <span class=\"nn\">tta</span>\n<span class=\"n\">tta_model</span> <span class=\"o\">=</span> <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">SegmentationTTAWrapper</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">aliases</span><span class=\"o\">.</span><span class=\"n\">d4_transform</span><span class=\"p\">(),</span> <span class=\"n\">merge_mode</span><span class=\"o\">=</span><span class=\"s1\">'mean'</span><span class=\"p\">)</span>\n</pre>\n<h5>Classification model wrapping:</h5>\n<pre><span class=\"n\">tta_model</span> <span class=\"o\">=</span> <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">ClassificationTTAWrapper</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">aliases</span><span class=\"o\">.</span><span class=\"n\">five_crops_transform</span><span class=\"p\">())</span>\n</pre>\n<h2>Advanced Examples</h2>\n<h5>Custom transform:</h5>\n<pre><span class=\"c1\"># defined 2 * 2 * 3 * 3 = 36 augmentations !</span>\n<span class=\"n\">transforms</span> <span class=\"o\">=</span> <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">Compose</span><span class=\"p\">(</span>\n    <span class=\"p\">[</span>\n        <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">HorizontalFlip</span><span class=\"p\">(),</span>\n        <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">Rotate90</span><span class=\"p\">(</span><span class=\"n\">angles</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">180</span><span class=\"p\">]),</span>\n        <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">Scale</span><span class=\"p\">(</span><span class=\"n\">scales</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">]),</span>\n        <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">Multiply</span><span class=\"p\">(</span><span class=\"n\">factors</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mf\">0.9</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mf\">1.1</span><span class=\"p\">]),</span>        \n    <span class=\"p\">]</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">tta_model</span> <span class=\"o\">=</span> <span class=\"n\">tta</span><span class=\"o\">.</span><span class=\"n\">SegmentationTTAWrapper</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">transforms</span><span class=\"p\">)</span>\n</pre>\n<h5>Custom model (multi-input / multi-output)</h5>\n<pre><span class=\"c1\"># Example how to process ONE batch on images with TTA</span>\n<span class=\"c1\"># Here `image`/`mask` are 4D tensors (B, C, H, W), `label` is 2D tensor (B, N)</span>\n\n<span class=\"k\">for</span> <span class=\"n\">transformer</span> <span class=\"ow\">in</span> <span class=\"n\">transforms</span><span class=\"p\">:</span> <span class=\"c1\"># custom transforms or e.g. tta.aliases.d4_transform() </span>\n\n    <span class=\"c1\"># augment image</span>\n    <span class=\"n\">augmented_image</span> <span class=\"o\">=</span> <span class=\"n\">transformer</span><span class=\"o\">.</span><span class=\"n\">augment_image</span><span class=\"p\">(</span><span class=\"n\">image</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># pass to model</span>\n    <span class=\"n\">model_output</span> <span class=\"o\">=</span> <span class=\"n\">model</span><span class=\"p\">(</span><span class=\"n\">augmented_image</span><span class=\"p\">,</span> <span class=\"n\">another_input_data</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># reverse augmentation for mask and label</span>\n    <span class=\"n\">deaug_mask</span> <span class=\"o\">=</span> <span class=\"n\">transformer</span><span class=\"o\">.</span><span class=\"n\">deaugment_mask</span><span class=\"p\">(</span><span class=\"n\">model_output</span><span class=\"p\">[</span><span class=\"s1\">'mask'</span><span class=\"p\">])</span>\n    <span class=\"n\">deaug_label</span> <span class=\"o\">=</span> <span class=\"n\">transformer</span><span class=\"o\">.</span><span class=\"n\">deaugment_label</span><span class=\"p\">(</span><span class=\"n\">model_output</span><span class=\"p\">[</span><span class=\"s1\">'label'</span><span class=\"p\">])</span>\n\n    <span class=\"c1\"># save results</span>\n    <span class=\"n\">labels</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">deaug_mask</span><span class=\"p\">)</span>\n    <span class=\"n\">masks</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">deaug_label</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># reduce results as you want, e.g mean/max/min</span>\n<span class=\"n\">label</span> <span class=\"o\">=</span> <span class=\"n\">mean</span><span class=\"p\">(</span><span class=\"n\">labels</span><span class=\"p\">)</span>\n<span class=\"n\">mask</span> <span class=\"o\">=</span> <span class=\"n\">mean</span><span class=\"p\">(</span><span class=\"n\">masks</span><span class=\"p\">)</span>\n</pre>\n<h2>Transforms</h2>\n<table>\n<thead>\n<tr>\n<th>Transform</th>\n<th align=\"center\">Parameters</th>\n<th align=\"center\">Values</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HorizontalFlip</td>\n<td align=\"center\">-</td>\n<td align=\"center\">-</td>\n</tr>\n<tr>\n<td>VerticalFlip</td>\n<td align=\"center\">-</td>\n<td align=\"center\">-</td>\n</tr>\n<tr>\n<td>Rotate90</td>\n<td align=\"center\">angles</td>\n<td align=\"center\">List[0, 90, 180, 270]</td>\n</tr>\n<tr>\n<td>Scale</td>\n<td align=\"center\">scales<br>interpolation</td>\n<td align=\"center\">List[float]<br>\"nearest\"/\"linear\"</td>\n</tr>\n<tr>\n<td>Resize</td>\n<td align=\"center\">sizes<br>original_size<br>interpolation</td>\n<td align=\"center\">List[Tuple[int, int]]<br>Tuple[int,int]<br>\"nearest\"/\"linear\"</td>\n</tr>\n<tr>\n<td>Add</td>\n<td align=\"center\">values</td>\n<td align=\"center\">List[float]</td>\n</tr>\n<tr>\n<td>Multiply</td>\n<td align=\"center\">factors</td>\n<td align=\"center\">List[float]</td>\n</tr>\n<tr>\n<td>FiveCrops</td>\n<td align=\"center\">crop_height<br>crop_width</td>\n<td align=\"center\">int<br>int</td>\n</tr></tbody></table>\n<h2>Aliases</h2>\n<ul>\n<li>flip_transform (horizontal + vertical flips)</li>\n<li>hflip_transform (horizontal flip)</li>\n<li>d4_transform (flips + rotation 0, 90, 180, 270)</li>\n<li>multiscale_transform (scale transform, take scales as input parameter)</li>\n<li>five_crop_transform (corner crops + center crop)</li>\n<li>ten_crop_transform (five crops + five crops on horizontal flip)</li>\n</ul>\n<h2>Merge modes</h2>\n<ul>\n<li>mean</li>\n<li>gmean (geometric mean)</li>\n<li>sum</li>\n<li>max</li>\n<li>min</li>\n<li>tsharpen (<a href=\"https://www.kaggle.com/c/severstal-steel-defect-detection/discussion/107716#latest-624046\" rel=\"nofollow\">temperature sharpen</a> with t=0.5)</li>\n</ul>\n<h2>Installation</h2>\n<p>PyPI:</p>\n<pre>$ pip install ttach\n</pre>\n<p>Source:</p>\n<pre>$ pip install git+https://github.com/qubvel/ttach\n</pre>\n<h2>Run tests</h2>\n<pre>docker build -f Dockerfile.dev -t ttach:dev . <span class=\"o\">&amp;&amp;</span> docker run --rm ttach:dev pytest -p no:cacheprovider\n</pre>\n\n          </div>"}, "last_serial": 6064537, "releases": {"0.0.1": [{"comment_text": "", "digests": {"md5": "065c35c060cf0015cecfe5a1ed179741", "sha256": "8c9f76bf4ec40b547299a660ab167ea746f71ace9cbd37e8581dfbd16da0fc98"}, "downloads": -1, "filename": "ttach-0.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "065c35c060cf0015cecfe5a1ed179741", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.0.0", "size": 8655, "upload_time": "2019-10-02T13:01:55", "upload_time_iso_8601": "2019-10-02T13:01:55.019517Z", "url": "https://files.pythonhosted.org/packages/2c/e0/115092bd2a827e4eb35a0c8445902737fe91754a9328b3901340fe086529/ttach-0.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "b1d145b5ed94e2adf3bdad114f27a90f", "sha256": "e06f5703133eebf7dc5bb05b9217fe4c6625af41b25279770d9a36166d986eab"}, "downloads": -1, "filename": "ttach-0.0.1.tar.gz", "has_sig": false, "md5_digest": "b1d145b5ed94e2adf3bdad114f27a90f", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.0.0", "size": 8444, "upload_time": "2019-10-02T13:01:57", "upload_time_iso_8601": "2019-10-02T13:01:57.200881Z", "url": "https://files.pythonhosted.org/packages/27/87/f86ad00aaa4b7da0889a36677a7c0f004864ae8cb5cebe0e5888bb464ee1/ttach-0.0.1.tar.gz", "yanked": false}], "0.0.2": [{"comment_text": "", "digests": {"md5": "77bda05f326422eb7716e9042b607e03", "sha256": "60b2630150c179db0f861a6b37b642e1d5ce1c6a16b618f1196b953ab94d49ed"}, "downloads": -1, "filename": "ttach-0.0.2-py3-none-any.whl", "has_sig": false, "md5_digest": "77bda05f326422eb7716e9042b607e03", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.0.0", "size": 9085, "upload_time": "2019-11-01T15:13:49", "upload_time_iso_8601": "2019-11-01T15:13:49.949079Z", "url": "https://files.pythonhosted.org/packages/53/22/470bb42f90505dc572f6bbcf3ac84d67aaf1554cd48cc08f788c36fec129/ttach-0.0.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "4ebb170b85e5ba32d8807d8d3a23b18a", "sha256": "f84c6f53c534bf8a47ab00df59e8bfc40225cdcff552184415f39ad5d3e96b7b"}, "downloads": -1, "filename": "ttach-0.0.2.tar.gz", "has_sig": false, "md5_digest": "4ebb170b85e5ba32d8807d8d3a23b18a", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.0.0", "size": 8851, "upload_time": "2019-11-01T15:13:52", "upload_time_iso_8601": "2019-11-01T15:13:52.048982Z", "url": "https://files.pythonhosted.org/packages/b8/1f/055cdfbb2b5967522979d70b01d78b61dc54e95c667272a4a296987a5a18/ttach-0.0.2.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "77bda05f326422eb7716e9042b607e03", "sha256": "60b2630150c179db0f861a6b37b642e1d5ce1c6a16b618f1196b953ab94d49ed"}, "downloads": -1, "filename": "ttach-0.0.2-py3-none-any.whl", "has_sig": false, "md5_digest": "77bda05f326422eb7716e9042b607e03", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.0.0", "size": 9085, "upload_time": "2019-11-01T15:13:49", "upload_time_iso_8601": "2019-11-01T15:13:49.949079Z", "url": "https://files.pythonhosted.org/packages/53/22/470bb42f90505dc572f6bbcf3ac84d67aaf1554cd48cc08f788c36fec129/ttach-0.0.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "4ebb170b85e5ba32d8807d8d3a23b18a", "sha256": "f84c6f53c534bf8a47ab00df59e8bfc40225cdcff552184415f39ad5d3e96b7b"}, "downloads": -1, "filename": "ttach-0.0.2.tar.gz", "has_sig": false, "md5_digest": "4ebb170b85e5ba32d8807d8d3a23b18a", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.0.0", "size": 8851, "upload_time": "2019-11-01T15:13:52", "upload_time_iso_8601": "2019-11-01T15:13:52.048982Z", "url": "https://files.pythonhosted.org/packages/b8/1f/055cdfbb2b5967522979d70b01d78b61dc54e95c667272a4a296987a5a18/ttach-0.0.2.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:45:06 2020"}