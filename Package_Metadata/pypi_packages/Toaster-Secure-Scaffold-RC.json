{"info": {"author": "Toaster Ltd.", "author_email": "developers@toaster.co", "bugtrack_url": null, "classifiers": ["License :: OSI Approved :: Apache Software License", "Operating System :: OS Independent", "Programming Language :: Python :: 3.7", "Programming Language :: Python :: 3 :: Only"], "description": "# Secure GAE Scaffold (Python 3)\n\n## Introduction\n\nPlease note: this is not an official Google product.\n\nThis is a secure scaffold package designed primarily to work with\nGoogle App Engine (although it is not limited to this).\n\nIt is built using Python 3 and Flask.\n\nThe scaffold provides the following basic security guarantees by default through\na flask app factory found in `secure_scaffold/factories.py`. This app will:\n\n1. Set assorted security headers (Strict-Transport-Security, X-Frame-Options,\n   X-XSS-Protection, X-Content-Type-Options, Content-Security-Policy) with\n   strong default values to help avoid attacks like Cross-Site Scripting (XSS)\n   and Cross-Site Script Inclusion.  See  `add_csp_headers` and\n   `settings.CSP_CONFIG`.\n1. Verify XSRF tokens by default on authenticated requests using any verb other\n   that GET, HEAD, or OPTIONS.  See the `secure_scaffold/xsrf.py` for more information.\n\n## Usage\n\n### Installation\n\nAs this is currently in beta we have a beta pypi package.\n\nThis project can be installed via\n\n`pip install toaster-secure-scaffold-rc`\n\nFor your convenience we also have the option to install with various other\ndependencies for the contrib APIs such as cloud-tasks, Datastore and Firestore.\n\nThese can be included with the `[]` syntax. For example all of them can be installed\nvia:\n\n`pip install toaster-secure-scaffold-rc[datastore,firestore,tasks]`\n\n### Setup\n\nOnce installed you can easily begin a new project by running:\n\n    secure_scaffold start-project PROJECT_NAME GCLOUD_PROJECT_NAME\n\nMore details about this command can be found by running:\n\n    secure_scaffold start-project --help\n\n\n### App Factory\n\nTo use the secure scaffold in your app, use our app generator.\n\n```python\nfrom secure_scaffold import factories\n\napp = factories.AppFactory().generate()\n```\n\nThis will automatically set all the needed CSP headers.\n\n### XSRF\n\nTo enable XSRF protection add the decorator to the endpoints you need it for.\nThis needs to be set *after* the route decorator\ne.g.\n\n```python\nfrom secure_scaffold import factories\nfrom secure_scaffold import xsrf\n\napp = factories.AppFactory().generate()\n\n@app.route('/', methods=['GET', 'POST'])\n@xsrf.xsrf_protected()\ndef index():\n    return 'Hello World!'\n```\n\n\nWe use Flask Sessions for XSRF, for this you should set up a unique Secret Key for your application.\n\nA random one is set in the app factory, but you should overwrite this yourself, see [Flask Sessions](http://flask.pocoo.org/docs/1.0/quickstart/#sessions)\n\n\n### Settings Config\n\nSimilar to django settings, to enable multiple settings files you need to set an environment variable.\nYour folder structure should include a settings folder containing your settings files, for example:\n\n    my_project/\n        settings/\n            __init__.py\n            base.py\n            development.py\n            production.py\n\nYou should then set the environment variable (**SETTINGS_MODULE**) to the settings you require in that environment.\n\n    export SETTINGS_MODULE=settings.development\n\nYou can then import your settings in your project like this:\n\n    from secure_scaffold.config import settings\n\n\n### Authentication\n\nThe Secure Scaffold provides two methods of authentication. One is an in built\nauthentication system relying on Googles OAuth2 system. The alternative is a system relying on IAP\n\n#### OAuth2 Users\n\nSecond generation App Engine systems have had the Users API removed so the majority of\nthe original functionality isn't available. As a result it is now recommended to use\nseparate systems such as Googles OAuth2. The Secure Scaffold provides a wrapper for this\nbased heavily on [this guide](https://developers.google.com/identity/sign-in/web/sign-in).\n\nFor this to work there is some minimal setup.\n\nThe first is to provide an OAuth Client ID. To do this go to the GCloud console and create\nan OAuth Client ID [here](https://console.cloud.google.com/apis/credentials). Ensure you add\nthe domains you are using to the `Authorised JavaScript Origins` and `Authorised redirect URIs`.\nYou can include `localhost:5000` in these to enable using this system in development.\n\nOnce you have a `Client ID` add it to your settings file like so:\n\n```python\nAUTH_OAUTH_CLIENT_ID = 'my-client-id'\n```\n\nOnce done all that is required is to register the auth blueprint to your project like so:\n\n```python\nfrom secure_scaffold import factories\nfrom secure_scaffold.contrib.users.auth import auth_handler\n\n\napp = factories.AppFactory().generate()\napp.register_blueprint(auth_handler.blueprint)\n```\n\nThis creates two enpoints at `/auth/login` and `/auth/authenticate`. Login provides a frontend\nwith a Google sign in button. This sends an API request to `/auth/authenticate` which validates\nthe login procedure and returns an endpoint to redirect to. By default this is `/`.\n\nIf you want to force a user to be logged in to access a URL you can use the provided\n`requires_login` decorator like so:\n\n```python\nfrom secure_scaffold import factories\nfrom secure_scaffold.contrib.users.auth import auth_handler\n\n\napp = factories.AppFactory().generate()\napp.register_blueprint(auth_handler.blueprint)\n\n\n@app.route('/')\n@auth_handler.requires_login\ndef private_view():\n    return \"You can't see this unless you are logged in.\"\n```\n\nIf a user is logged in they will be able to see the page. If they are not they will\nautomatically be redirected to `/auth/login`.\n\n##### Extending the OAuth2 system.\n\nThe OAuth2 system is built using a class at `secure_scaffold.contrib.users.auth.AuthHandler`.\n\nThis class is designed to be easy to subclass and override. For instance if you wanted to\nchange the URL which the user is redirected to on logging in you can do it like so:\n\n```python\nfrom secure_scaffold import factories\nfrom secure_scaffold.contrib.users.auth import AuthHandler\n\napp = factories.AppFactory().generate()\n\nclass MyAuthHandler(AuthHandler):\n    redirect_url = '/after-login'\n\nauth_handler = MyAuthHandler()\napp.register_blueprint(auth_handler.blueprint)\n```\n\n#### IAP Users\n\nThis is available at `secure_scaffold.contrib.appengine.users`. It provides a `User`\nclass which has a few useful methods providing the details of the current user.\nIt also provides `requires_auth` and `requires_admin` decorators which enforce the need\nfor authentication and admin rights respectively on the views they are applied to.\n\nThese work almost identically to how they do in the first generation App Engine APIs.\n\nTo use these you will need to enable IAP on your App Engine instance. This is \nprovides the app with the correct headers for this functionality.\n\n\n### Datastore/Firestore\n\nThe Secure Scaffold comes with a built in API for both Datastore and Firestore.\n\nThis is a partial ORM - it allows you to simply define data models, to create, \nretrieve, update and delete them (CRUD). However it does not work with relations\nor nested entities/documents.\n\nTo use this API you must create a settings file with a variable called `DATABASE_SETTINGS`.\nThis has to be a dict with two fields, an `engine` field and a `settings` field.\n\n- `engine` must reference a module with the appropriate database engine, this\nallows the code to switch between databases such as firestore and datastore with\na single setting change.\n- `settings` are the settings that will be passed to the database engine client. As a\nminimum these should contain `project` pointing to the gcloud project.\n\nThe settings should something like this:\n\n```python\nDATABASE_SETTINGS = {\n    'engine': 'secure_scaffold.contrib.db.engine.firestore',\n    'settings': {\n        'project': 'my-gcloud-project-id'\n    }\n}\n```\n\nThe above uses the firestore engine. To use Datastore instead you should replace\n`secure_scaffold.contrib.db.engine.firestore` with \n`secure_scaffold.contrib.db.engine.datastore`. There are no other code changes required.\n\n\nThe API can be used like so:\n\n```python\nfrom secure_scaffold.contrib.db import models\n\n\nclass Person(models.Model):\n    name = models.Field(str, primary=True)\n    age = models.Field(int)\n    arms = models.Field(int, default=2)\n    social_security = models.Field(str, unique=True)\n    data = models.Field(dict, required=False)\n\n\n# Create some people.\nPerson(name='John', age=30, social_security='111-11-1111').save()\nPerson(name='Jane', age=30, social_security='222-22-2222').save()\n\n\njanes = Person.get(name='Jane')  # Returns a generator which yields all objects with a name of 'Jane'\nfor jane in janes:\n    jane.age = 28\n    jane.save()  # Updates Jane to have an age of 28 in the database.\n\npeople = Person.get_all()  # Gives a generator which will yield all the people\nfor person in people:\n    print(person.name)   # Prints 'John' and then 'Jane'\n    print(person.age)   # Prints 30 and then 28\n    print(person.arms)   # Prints 2 and then 2\n    person.delete()  # Deletes the entry in the database.\n```\n\nThe API operates a basic validation system - you define fields within a model class,\neach field has a type and some optional args. If the field receives an object of the\nwrong type it will raise an error.\n\n\n### Tasks\n\nThe Secure Scaffold comes with a system for setting up tasks with\n[Google Cloud Tasks](https://cloud.google.com/tasks/).\n\nThis system works by creating a `TaskRunner` class instance and registering functions\nas `Task` objects using a decorator provided by the `TaskRunner` instance.\n\nThis creates a view in a [Flask blueprint](http://flask.pocoo.org/docs/dev/blueprints/)\nstored in the `TaskRunner` instance and adds a `delay` method to the registered\nfunction - allowing the function to be run later by the task queue.\n\n#### Setup\n\nFor this module to work you must first install `google-cloud-tasks`:\n\n    pip install google-cloud-tasks\n\nYou must also add a `CLOUD_TASKS_QUEUE_CONFIG` object to your settings file.\nIt should look like this:\n\n```python\nCLOUD_TASKS_QUEUE_CONFIG = {\n    'project': 'YOUR GCLOUD PROJECT NAME',\n    'location': 'YOUR TASKE QUEUE LOCATION',\n    'queue': 'YOUR TASK QUEUE NAME'\n}\n```\n\n#### Using\n\nA basic example of the task system is as follows:\n\n```python\nfrom flask import request\n\nfrom secure_scaffold import factories\nfrom secure_scaffold.contrib.cloud_tasks import tasks\n\n\napp = factories.AppFactory().generate()\n\ntask_runner = tasks.TaskRunner('tasks', __name__, url_prefix='/tasks')\n\napp.register_blueprint(task_runner.blueprint)\n\n\n@task_runner.task(route='/print_task', methods=['POST'])\ndef print_task():\n    arg = request.json().get('arg')\n    print(arg)\n    return 'OK'\n\n\n@app.route('/')\ndef main():\n    print_task.delay(arg='Hello, World!')\n    return 'OK'\n```\n\nThis sets up a Secure Scaffold app as well as a task runner. It then registers\nthe blueprint of the task runner in the app.\n\nWe create a task function, which gets an argument called `arg` from\nthe global `request` object and prints it. This is registered as a task\nusing the `task_runner.task` decorator.\n\nFinally we create a flask route called `main` which calls the `delay` method\nof our task.\n\nBehind the scenes what happens is our `task_runner` creates a `Task` object\ncontaining this function and a `delay` method. It then registers the object\nas a flask route at `/tasks/print_task/`. The `Task` objects delay method\nmakes a request to the cloud tasks API to create a task for this method in\nthe queue. It takes any arbitrary arguments and keyword arguments and adds\nthem to the body of this request - making them accessible via the \n`flask.request` global variable within the task. \n\n## Scaffold Development\n\n### Structure:\n\n`secure_scaffold/` \n- Top level directory\n\n`secure_scaffold/contrib` \n- Contains non-essential but useful libraries.\n- Holds several alternatives to App Engine APIs \nwhich are no longer available in second generation instances \n\n`secure_scaffold/tests` \n- Tests for the secure scaffold \n\n`secure_scaffold/config.py` \n- Similar to django settings set up \n- Looks for the \"SETTINGS_MODULE\" environment variable to be set \n- See Settings Config below on how to use this\n\n`secure_scaffold/factories.py`\n- The main Flask app factory that applies the security defaults\n- See App Factory below on how to use this\n\n`secure_scaffold/settings.py`\n- Security settings \n- Defines our CSP headers and other specifics\n\n`secure_scaffold/xsrf.py`\n- Defines XSRF decorators to be used with your flask app \n- See XSRF below on how to use this\n\n### Dependency Setup\n\nWe recommend setting up a virtual env to install dependencies:\n\n`virtualenv env --python=python3`\n\n`source env/bin/activate`\n\n`pip install -r dev_requirements.txt`\n\nThere are some extra dependencies required for the development on specific submodules.\n\nThese include:\n\n- `google-cloud-firestore` for development on `secure_scaffold.contrib.db.engine.firestore\n- `google-cloud-datastore` for development on `secure_scaffold.contrib.db.engine.datastore\n- `google-cloud-tasks` for development on `secure_scaffold.contrib.cloud_tasks.tasks\n\n### Testing\n\nTo run unit tests:\n\n`pytest`\n\n\n## Third Party Credits\n\n- Flask\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/toasterco/gae-secure-scaffold-python", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "Toaster-Secure-Scaffold-RC", "package_url": "https://pypi.org/project/Toaster-Secure-Scaffold-RC/", "platform": "", "project_url": "https://pypi.org/project/Toaster-Secure-Scaffold-RC/", "project_urls": {"Homepage": "https://github.com/toasterco/gae-secure-scaffold-python"}, "release_url": "https://pypi.org/project/Toaster-Secure-Scaffold-RC/0.8.2/", "requires_dist": ["flask (==1.0.2)", "click (==7.0)", "google-cloud-datastore (==1.8.0) ; extra == 'datastore'", "google-cloud-firestore (==1.2.0) ; extra == 'firestore'", "google-cloud-tasks (==1.1.0) ; extra == 'tasks'"], "requires_python": "", "summary": "Secure Scaffold for Google App Engine", "version": "0.8.2", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>Secure GAE Scaffold (Python 3)</h1>\n<h2>Introduction</h2>\n<p>Please note: this is not an official Google product.</p>\n<p>This is a secure scaffold package designed primarily to work with\nGoogle App Engine (although it is not limited to this).</p>\n<p>It is built using Python 3 and Flask.</p>\n<p>The scaffold provides the following basic security guarantees by default through\na flask app factory found in <code>secure_scaffold/factories.py</code>. This app will:</p>\n<ol>\n<li>Set assorted security headers (Strict-Transport-Security, X-Frame-Options,\nX-XSS-Protection, X-Content-Type-Options, Content-Security-Policy) with\nstrong default values to help avoid attacks like Cross-Site Scripting (XSS)\nand Cross-Site Script Inclusion.  See  <code>add_csp_headers</code> and\n<code>settings.CSP_CONFIG</code>.</li>\n<li>Verify XSRF tokens by default on authenticated requests using any verb other\nthat GET, HEAD, or OPTIONS.  See the <code>secure_scaffold/xsrf.py</code> for more information.</li>\n</ol>\n<h2>Usage</h2>\n<h3>Installation</h3>\n<p>As this is currently in beta we have a beta pypi package.</p>\n<p>This project can be installed via</p>\n<p><code>pip install toaster-secure-scaffold-rc</code></p>\n<p>For your convenience we also have the option to install with various other\ndependencies for the contrib APIs such as cloud-tasks, Datastore and Firestore.</p>\n<p>These can be included with the <code>[]</code> syntax. For example all of them can be installed\nvia:</p>\n<p><code>pip install toaster-secure-scaffold-rc[datastore,firestore,tasks]</code></p>\n<h3>Setup</h3>\n<p>Once installed you can easily begin a new project by running:</p>\n<pre><code>secure_scaffold start-project PROJECT_NAME GCLOUD_PROJECT_NAME\n</code></pre>\n<p>More details about this command can be found by running:</p>\n<pre><code>secure_scaffold start-project --help\n</code></pre>\n<h3>App Factory</h3>\n<p>To use the secure scaffold in your app, use our app generator.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold</span> <span class=\"kn\">import</span> <span class=\"n\">factories</span>\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">factories</span><span class=\"o\">.</span><span class=\"n\">AppFactory</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">generate</span><span class=\"p\">()</span>\n</pre>\n<p>This will automatically set all the needed CSP headers.</p>\n<h3>XSRF</h3>\n<p>To enable XSRF protection add the decorator to the endpoints you need it for.\nThis needs to be set <em>after</em> the route decorator\ne.g.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold</span> <span class=\"kn\">import</span> <span class=\"n\">factories</span>\n<span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold</span> <span class=\"kn\">import</span> <span class=\"n\">xsrf</span>\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">factories</span><span class=\"o\">.</span><span class=\"n\">AppFactory</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">generate</span><span class=\"p\">()</span>\n\n<span class=\"nd\">@app</span><span class=\"o\">.</span><span class=\"n\">route</span><span class=\"p\">(</span><span class=\"s1\">'/'</span><span class=\"p\">,</span> <span class=\"n\">methods</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'GET'</span><span class=\"p\">,</span> <span class=\"s1\">'POST'</span><span class=\"p\">])</span>\n<span class=\"nd\">@xsrf</span><span class=\"o\">.</span><span class=\"n\">xsrf_protected</span><span class=\"p\">()</span>\n<span class=\"k\">def</span> <span class=\"nf\">index</span><span class=\"p\">():</span>\n    <span class=\"k\">return</span> <span class=\"s1\">'Hello World!'</span>\n</pre>\n<p>We use Flask Sessions for XSRF, for this you should set up a unique Secret Key for your application.</p>\n<p>A random one is set in the app factory, but you should overwrite this yourself, see <a href=\"http://flask.pocoo.org/docs/1.0/quickstart/#sessions\" rel=\"nofollow\">Flask Sessions</a></p>\n<h3>Settings Config</h3>\n<p>Similar to django settings, to enable multiple settings files you need to set an environment variable.\nYour folder structure should include a settings folder containing your settings files, for example:</p>\n<pre><code>my_project/\n    settings/\n        __init__.py\n        base.py\n        development.py\n        production.py\n</code></pre>\n<p>You should then set the environment variable (<strong>SETTINGS_MODULE</strong>) to the settings you require in that environment.</p>\n<pre><code>export SETTINGS_MODULE=settings.development\n</code></pre>\n<p>You can then import your settings in your project like this:</p>\n<pre><code>from secure_scaffold.config import settings\n</code></pre>\n<h3>Authentication</h3>\n<p>The Secure Scaffold provides two methods of authentication. One is an in built\nauthentication system relying on Googles OAuth2 system. The alternative is a system relying on IAP</p>\n<h4>OAuth2 Users</h4>\n<p>Second generation App Engine systems have had the Users API removed so the majority of\nthe original functionality isn't available. As a result it is now recommended to use\nseparate systems such as Googles OAuth2. The Secure Scaffold provides a wrapper for this\nbased heavily on <a href=\"https://developers.google.com/identity/sign-in/web/sign-in\" rel=\"nofollow\">this guide</a>.</p>\n<p>For this to work there is some minimal setup.</p>\n<p>The first is to provide an OAuth Client ID. To do this go to the GCloud console and create\nan OAuth Client ID <a href=\"https://console.cloud.google.com/apis/credentials\" rel=\"nofollow\">here</a>. Ensure you add\nthe domains you are using to the <code>Authorised JavaScript Origins</code> and <code>Authorised redirect URIs</code>.\nYou can include <code>localhost:5000</code> in these to enable using this system in development.</p>\n<p>Once you have a <code>Client ID</code> add it to your settings file like so:</p>\n<pre><span class=\"n\">AUTH_OAUTH_CLIENT_ID</span> <span class=\"o\">=</span> <span class=\"s1\">'my-client-id'</span>\n</pre>\n<p>Once done all that is required is to register the auth blueprint to your project like so:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold</span> <span class=\"kn\">import</span> <span class=\"n\">factories</span>\n<span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold.contrib.users.auth</span> <span class=\"kn\">import</span> <span class=\"n\">auth_handler</span>\n\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">factories</span><span class=\"o\">.</span><span class=\"n\">AppFactory</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">generate</span><span class=\"p\">()</span>\n<span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">register_blueprint</span><span class=\"p\">(</span><span class=\"n\">auth_handler</span><span class=\"o\">.</span><span class=\"n\">blueprint</span><span class=\"p\">)</span>\n</pre>\n<p>This creates two enpoints at <code>/auth/login</code> and <code>/auth/authenticate</code>. Login provides a frontend\nwith a Google sign in button. This sends an API request to <code>/auth/authenticate</code> which validates\nthe login procedure and returns an endpoint to redirect to. By default this is <code>/</code>.</p>\n<p>If you want to force a user to be logged in to access a URL you can use the provided\n<code>requires_login</code> decorator like so:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold</span> <span class=\"kn\">import</span> <span class=\"n\">factories</span>\n<span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold.contrib.users.auth</span> <span class=\"kn\">import</span> <span class=\"n\">auth_handler</span>\n\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">factories</span><span class=\"o\">.</span><span class=\"n\">AppFactory</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">generate</span><span class=\"p\">()</span>\n<span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">register_blueprint</span><span class=\"p\">(</span><span class=\"n\">auth_handler</span><span class=\"o\">.</span><span class=\"n\">blueprint</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@app</span><span class=\"o\">.</span><span class=\"n\">route</span><span class=\"p\">(</span><span class=\"s1\">'/'</span><span class=\"p\">)</span>\n<span class=\"nd\">@auth_handler</span><span class=\"o\">.</span><span class=\"n\">requires_login</span>\n<span class=\"k\">def</span> <span class=\"nf\">private_view</span><span class=\"p\">():</span>\n    <span class=\"k\">return</span> <span class=\"s2\">\"You can't see this unless you are logged in.\"</span>\n</pre>\n<p>If a user is logged in they will be able to see the page. If they are not they will\nautomatically be redirected to <code>/auth/login</code>.</p>\n<h5>Extending the OAuth2 system.</h5>\n<p>The OAuth2 system is built using a class at <code>secure_scaffold.contrib.users.auth.AuthHandler</code>.</p>\n<p>This class is designed to be easy to subclass and override. For instance if you wanted to\nchange the URL which the user is redirected to on logging in you can do it like so:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold</span> <span class=\"kn\">import</span> <span class=\"n\">factories</span>\n<span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold.contrib.users.auth</span> <span class=\"kn\">import</span> <span class=\"n\">AuthHandler</span>\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">factories</span><span class=\"o\">.</span><span class=\"n\">AppFactory</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">generate</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">MyAuthHandler</span><span class=\"p\">(</span><span class=\"n\">AuthHandler</span><span class=\"p\">):</span>\n    <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"s1\">'/after-login'</span>\n\n<span class=\"n\">auth_handler</span> <span class=\"o\">=</span> <span class=\"n\">MyAuthHandler</span><span class=\"p\">()</span>\n<span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">register_blueprint</span><span class=\"p\">(</span><span class=\"n\">auth_handler</span><span class=\"o\">.</span><span class=\"n\">blueprint</span><span class=\"p\">)</span>\n</pre>\n<h4>IAP Users</h4>\n<p>This is available at <code>secure_scaffold.contrib.appengine.users</code>. It provides a <code>User</code>\nclass which has a few useful methods providing the details of the current user.\nIt also provides <code>requires_auth</code> and <code>requires_admin</code> decorators which enforce the need\nfor authentication and admin rights respectively on the views they are applied to.</p>\n<p>These work almost identically to how they do in the first generation App Engine APIs.</p>\n<p>To use these you will need to enable IAP on your App Engine instance. This is\nprovides the app with the correct headers for this functionality.</p>\n<h3>Datastore/Firestore</h3>\n<p>The Secure Scaffold comes with a built in API for both Datastore and Firestore.</p>\n<p>This is a partial ORM - it allows you to simply define data models, to create,\nretrieve, update and delete them (CRUD). However it does not work with relations\nor nested entities/documents.</p>\n<p>To use this API you must create a settings file with a variable called <code>DATABASE_SETTINGS</code>.\nThis has to be a dict with two fields, an <code>engine</code> field and a <code>settings</code> field.</p>\n<ul>\n<li><code>engine</code> must reference a module with the appropriate database engine, this\nallows the code to switch between databases such as firestore and datastore with\na single setting change.</li>\n<li><code>settings</code> are the settings that will be passed to the database engine client. As a\nminimum these should contain <code>project</code> pointing to the gcloud project.</li>\n</ul>\n<p>The settings should something like this:</p>\n<pre><span class=\"n\">DATABASE_SETTINGS</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s1\">'engine'</span><span class=\"p\">:</span> <span class=\"s1\">'secure_scaffold.contrib.db.engine.firestore'</span><span class=\"p\">,</span>\n    <span class=\"s1\">'settings'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s1\">'project'</span><span class=\"p\">:</span> <span class=\"s1\">'my-gcloud-project-id'</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</pre>\n<p>The above uses the firestore engine. To use Datastore instead you should replace\n<code>secure_scaffold.contrib.db.engine.firestore</code> with\n<code>secure_scaffold.contrib.db.engine.datastore</code>. There are no other code changes required.</p>\n<p>The API can be used like so:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold.contrib.db</span> <span class=\"kn\">import</span> <span class=\"n\">models</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Person</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">primary</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n    <span class=\"n\">age</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"nb\">int</span><span class=\"p\">)</span>\n    <span class=\"n\">arms</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n    <span class=\"n\">social_security</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n    <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"nb\">dict</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\"># Create some people.</span>\n<span class=\"n\">Person</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">'John'</span><span class=\"p\">,</span> <span class=\"n\">age</span><span class=\"o\">=</span><span class=\"mi\">30</span><span class=\"p\">,</span> <span class=\"n\">social_security</span><span class=\"o\">=</span><span class=\"s1\">'111-11-1111'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n<span class=\"n\">Person</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">'Jane'</span><span class=\"p\">,</span> <span class=\"n\">age</span><span class=\"o\">=</span><span class=\"mi\">30</span><span class=\"p\">,</span> <span class=\"n\">social_security</span><span class=\"o\">=</span><span class=\"s1\">'222-22-2222'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n\n\n<span class=\"n\">janes</span> <span class=\"o\">=</span> <span class=\"n\">Person</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">'Jane'</span><span class=\"p\">)</span>  <span class=\"c1\"># Returns a generator which yields all objects with a name of 'Jane'</span>\n<span class=\"k\">for</span> <span class=\"n\">jane</span> <span class=\"ow\">in</span> <span class=\"n\">janes</span><span class=\"p\">:</span>\n    <span class=\"n\">jane</span><span class=\"o\">.</span><span class=\"n\">age</span> <span class=\"o\">=</span> <span class=\"mi\">28</span>\n    <span class=\"n\">jane</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>  <span class=\"c1\"># Updates Jane to have an age of 28 in the database.</span>\n\n<span class=\"n\">people</span> <span class=\"o\">=</span> <span class=\"n\">Person</span><span class=\"o\">.</span><span class=\"n\">get_all</span><span class=\"p\">()</span>  <span class=\"c1\"># Gives a generator which will yield all the people</span>\n<span class=\"k\">for</span> <span class=\"n\">person</span> <span class=\"ow\">in</span> <span class=\"n\">people</span><span class=\"p\">:</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">person</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>   <span class=\"c1\"># Prints 'John' and then 'Jane'</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">person</span><span class=\"o\">.</span><span class=\"n\">age</span><span class=\"p\">)</span>   <span class=\"c1\"># Prints 30 and then 28</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">person</span><span class=\"o\">.</span><span class=\"n\">arms</span><span class=\"p\">)</span>   <span class=\"c1\"># Prints 2 and then 2</span>\n    <span class=\"n\">person</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span>  <span class=\"c1\"># Deletes the entry in the database.</span>\n</pre>\n<p>The API operates a basic validation system - you define fields within a model class,\neach field has a type and some optional args. If the field receives an object of the\nwrong type it will raise an error.</p>\n<h3>Tasks</h3>\n<p>The Secure Scaffold comes with a system for setting up tasks with\n<a href=\"https://cloud.google.com/tasks/\" rel=\"nofollow\">Google Cloud Tasks</a>.</p>\n<p>This system works by creating a <code>TaskRunner</code> class instance and registering functions\nas <code>Task</code> objects using a decorator provided by the <code>TaskRunner</code> instance.</p>\n<p>This creates a view in a <a href=\"http://flask.pocoo.org/docs/dev/blueprints/\" rel=\"nofollow\">Flask blueprint</a>\nstored in the <code>TaskRunner</code> instance and adds a <code>delay</code> method to the registered\nfunction - allowing the function to be run later by the task queue.</p>\n<h4>Setup</h4>\n<p>For this module to work you must first install <code>google-cloud-tasks</code>:</p>\n<pre><code>pip install google-cloud-tasks\n</code></pre>\n<p>You must also add a <code>CLOUD_TASKS_QUEUE_CONFIG</code> object to your settings file.\nIt should look like this:</p>\n<pre><span class=\"n\">CLOUD_TASKS_QUEUE_CONFIG</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s1\">'project'</span><span class=\"p\">:</span> <span class=\"s1\">'YOUR GCLOUD PROJECT NAME'</span><span class=\"p\">,</span>\n    <span class=\"s1\">'location'</span><span class=\"p\">:</span> <span class=\"s1\">'YOUR TASKE QUEUE LOCATION'</span><span class=\"p\">,</span>\n    <span class=\"s1\">'queue'</span><span class=\"p\">:</span> <span class=\"s1\">'YOUR TASK QUEUE NAME'</span>\n<span class=\"p\">}</span>\n</pre>\n<h4>Using</h4>\n<p>A basic example of the task system is as follows:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">flask</span> <span class=\"kn\">import</span> <span class=\"n\">request</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold</span> <span class=\"kn\">import</span> <span class=\"n\">factories</span>\n<span class=\"kn\">from</span> <span class=\"nn\">secure_scaffold.contrib.cloud_tasks</span> <span class=\"kn\">import</span> <span class=\"n\">tasks</span>\n\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">factories</span><span class=\"o\">.</span><span class=\"n\">AppFactory</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">generate</span><span class=\"p\">()</span>\n\n<span class=\"n\">task_runner</span> <span class=\"o\">=</span> <span class=\"n\">tasks</span><span class=\"o\">.</span><span class=\"n\">TaskRunner</span><span class=\"p\">(</span><span class=\"s1\">'tasks'</span><span class=\"p\">,</span> <span class=\"vm\">__name__</span><span class=\"p\">,</span> <span class=\"n\">url_prefix</span><span class=\"o\">=</span><span class=\"s1\">'/tasks'</span><span class=\"p\">)</span>\n\n<span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">register_blueprint</span><span class=\"p\">(</span><span class=\"n\">task_runner</span><span class=\"o\">.</span><span class=\"n\">blueprint</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@task_runner</span><span class=\"o\">.</span><span class=\"n\">task</span><span class=\"p\">(</span><span class=\"n\">route</span><span class=\"o\">=</span><span class=\"s1\">'/print_task'</span><span class=\"p\">,</span> <span class=\"n\">methods</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'POST'</span><span class=\"p\">])</span>\n<span class=\"k\">def</span> <span class=\"nf\">print_task</span><span class=\"p\">():</span>\n    <span class=\"n\">arg</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">json</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">'arg'</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">arg</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"s1\">'OK'</span>\n\n\n<span class=\"nd\">@app</span><span class=\"o\">.</span><span class=\"n\">route</span><span class=\"p\">(</span><span class=\"s1\">'/'</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">main</span><span class=\"p\">():</span>\n    <span class=\"n\">print_task</span><span class=\"o\">.</span><span class=\"n\">delay</span><span class=\"p\">(</span><span class=\"n\">arg</span><span class=\"o\">=</span><span class=\"s1\">'Hello, World!'</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"s1\">'OK'</span>\n</pre>\n<p>This sets up a Secure Scaffold app as well as a task runner. It then registers\nthe blueprint of the task runner in the app.</p>\n<p>We create a task function, which gets an argument called <code>arg</code> from\nthe global <code>request</code> object and prints it. This is registered as a task\nusing the <code>task_runner.task</code> decorator.</p>\n<p>Finally we create a flask route called <code>main</code> which calls the <code>delay</code> method\nof our task.</p>\n<p>Behind the scenes what happens is our <code>task_runner</code> creates a <code>Task</code> object\ncontaining this function and a <code>delay</code> method. It then registers the object\nas a flask route at <code>/tasks/print_task/</code>. The <code>Task</code> objects delay method\nmakes a request to the cloud tasks API to create a task for this method in\nthe queue. It takes any arbitrary arguments and keyword arguments and adds\nthem to the body of this request - making them accessible via the\n<code>flask.request</code> global variable within the task.</p>\n<h2>Scaffold Development</h2>\n<h3>Structure:</h3>\n<p><code>secure_scaffold/</code></p>\n<ul>\n<li>Top level directory</li>\n</ul>\n<p><code>secure_scaffold/contrib</code></p>\n<ul>\n<li>Contains non-essential but useful libraries.</li>\n<li>Holds several alternatives to App Engine APIs\nwhich are no longer available in second generation instances</li>\n</ul>\n<p><code>secure_scaffold/tests</code></p>\n<ul>\n<li>Tests for the secure scaffold</li>\n</ul>\n<p><code>secure_scaffold/config.py</code></p>\n<ul>\n<li>Similar to django settings set up</li>\n<li>Looks for the \"SETTINGS_MODULE\" environment variable to be set</li>\n<li>See Settings Config below on how to use this</li>\n</ul>\n<p><code>secure_scaffold/factories.py</code></p>\n<ul>\n<li>The main Flask app factory that applies the security defaults</li>\n<li>See App Factory below on how to use this</li>\n</ul>\n<p><code>secure_scaffold/settings.py</code></p>\n<ul>\n<li>Security settings</li>\n<li>Defines our CSP headers and other specifics</li>\n</ul>\n<p><code>secure_scaffold/xsrf.py</code></p>\n<ul>\n<li>Defines XSRF decorators to be used with your flask app</li>\n<li>See XSRF below on how to use this</li>\n</ul>\n<h3>Dependency Setup</h3>\n<p>We recommend setting up a virtual env to install dependencies:</p>\n<p><code>virtualenv env --python=python3</code></p>\n<p><code>source env/bin/activate</code></p>\n<p><code>pip install -r dev_requirements.txt</code></p>\n<p>There are some extra dependencies required for the development on specific submodules.</p>\n<p>These include:</p>\n<ul>\n<li><code>google-cloud-firestore</code> for development on `secure_scaffold.contrib.db.engine.firestore</li>\n<li><code>google-cloud-datastore</code> for development on `secure_scaffold.contrib.db.engine.datastore</li>\n<li><code>google-cloud-tasks</code> for development on `secure_scaffold.contrib.cloud_tasks.tasks</li>\n</ul>\n<h3>Testing</h3>\n<p>To run unit tests:</p>\n<p><code>pytest</code></p>\n<h2>Third Party Credits</h2>\n<ul>\n<li>Flask</li>\n</ul>\n\n          </div>"}, "last_serial": 5728708, "releases": {"0.8.1": [{"comment_text": "", "digests": {"md5": "5def6fd827724e538f65003701c25f9f", "sha256": "dd6224d767a839c640b5754d8c53c289684345093f2d96ff43ae0de44c55fe35"}, "downloads": -1, "filename": "Toaster_Secure_Scaffold_RC-0.8.1-py3-none-any.whl", "has_sig": false, "md5_digest": "5def6fd827724e538f65003701c25f9f", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 42928, "upload_time": "2019-08-22T02:34:37", "upload_time_iso_8601": "2019-08-22T02:34:37.244426Z", "url": "https://files.pythonhosted.org/packages/de/79/22b6802fd65ece90b51311422eca07e42cf0dea228c672a9da6a93382116/Toaster_Secure_Scaffold_RC-0.8.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "822d8636fdea2636e8fa09a08188f2b4", "sha256": "527c86b13ad37489ebcbb180eef7986cdb92e4d23ce033cedfe693b7af8203fa"}, "downloads": -1, "filename": "Toaster Secure Scaffold RC-0.8.1.tar.gz", "has_sig": false, "md5_digest": "822d8636fdea2636e8fa09a08188f2b4", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 32659, "upload_time": "2019-08-22T02:34:40", "upload_time_iso_8601": "2019-08-22T02:34:40.313295Z", "url": "https://files.pythonhosted.org/packages/91/d1/a896c355a0b9f3130e114f18529649b9ccfe0f36b3f250158868dc3a5ebc/Toaster%20Secure%20Scaffold%20RC-0.8.1.tar.gz", "yanked": false}], "0.8.2": [{"comment_text": "", "digests": {"md5": "0da94fc5cff4fc704bbde708583de283", "sha256": "8503f01a0ddd671c24735e3288f643fc7869566b5d0b1f9a9a6a766ada8f8760"}, "downloads": -1, "filename": "Toaster_Secure_Scaffold_RC-0.8.2-py3-none-any.whl", "has_sig": false, "md5_digest": "0da94fc5cff4fc704bbde708583de283", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 42920, "upload_time": "2019-08-26T03:07:41", "upload_time_iso_8601": "2019-08-26T03:07:41.000320Z", "url": "https://files.pythonhosted.org/packages/df/f7/5358dfd3abe036f0a272c48400e18993630b2192d1f821735fab7a760d19/Toaster_Secure_Scaffold_RC-0.8.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "f46cc74ebee5168b596c6fc18794b5d8", "sha256": "a2df32bc823afb9affb4b45873172d61aed44c08f86c99435f5caf3a6ed6fe2e"}, "downloads": -1, "filename": "Toaster Secure Scaffold RC-0.8.2.tar.gz", "has_sig": false, "md5_digest": "f46cc74ebee5168b596c6fc18794b5d8", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 32666, "upload_time": "2019-08-26T03:07:43", "upload_time_iso_8601": "2019-08-26T03:07:43.828943Z", "url": "https://files.pythonhosted.org/packages/a0/b7/7008a0f9dacdb0a4fc76ce4d6bccc8de19ce14930c02bc2ba8aff0678bf7/Toaster%20Secure%20Scaffold%20RC-0.8.2.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "0da94fc5cff4fc704bbde708583de283", "sha256": "8503f01a0ddd671c24735e3288f643fc7869566b5d0b1f9a9a6a766ada8f8760"}, "downloads": -1, "filename": "Toaster_Secure_Scaffold_RC-0.8.2-py3-none-any.whl", "has_sig": false, "md5_digest": "0da94fc5cff4fc704bbde708583de283", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 42920, "upload_time": "2019-08-26T03:07:41", "upload_time_iso_8601": "2019-08-26T03:07:41.000320Z", "url": "https://files.pythonhosted.org/packages/df/f7/5358dfd3abe036f0a272c48400e18993630b2192d1f821735fab7a760d19/Toaster_Secure_Scaffold_RC-0.8.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "f46cc74ebee5168b596c6fc18794b5d8", "sha256": "a2df32bc823afb9affb4b45873172d61aed44c08f86c99435f5caf3a6ed6fe2e"}, "downloads": -1, "filename": "Toaster Secure Scaffold RC-0.8.2.tar.gz", "has_sig": false, "md5_digest": "f46cc74ebee5168b596c6fc18794b5d8", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 32666, "upload_time": "2019-08-26T03:07:43", "upload_time_iso_8601": "2019-08-26T03:07:43.828943Z", "url": "https://files.pythonhosted.org/packages/a0/b7/7008a0f9dacdb0a4fc76ce4d6bccc8de19ce14930c02bc2ba8aff0678bf7/Toaster%20Secure%20Scaffold%20RC-0.8.2.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:51:57 2020"}