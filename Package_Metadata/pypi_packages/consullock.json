{"info": {"author": "", "author_email": "", "bugtrack_url": null, "classifiers": [], "description": "|Build Status| |codecov| |PyPI version|\n\nConsul Lock\n===========\n\n*CLI and Python interface for easily managing Consul locks*\n\nAbout\n-----\n\n-  CLI & Python interface:\n\n   -  Acquire and release a lock.\n   -  Execute shell whilst holding a lock (releasing on exit).\n   -  Set TTL of the session that acquires a lock.\n   -  Blocking and non-blocking locking.\n   -  Lock acquire timeouts.\n   -  Add extra metadata to lock information (useful for monitoring who\n      is holding locks).\n   -  Specify lock event listeners to be fired before lock acquire is\n      attempted and if unable to acquire locked lock.\n\n-  CLI:\n\n   -  Release multiple locks with keys that match regular expression.\n   -  Meaningful exit codes (see ``configuration.py`` for details).\n   -  JSON output on stdout.\n   -  Add extra verbosity on stderr with ``-vv``.\n\n-  Python interface:\n\n   -  Release multiple locks.\n   -  Find and release multiple locks with keys that match regular\n      expression.\n   -  Type hinting.\n\nInstallation\n------------\n\nPrerequisites: - python >= 3.6\n\nThe tool can be installed from PyPi:\n\n.. code:: bash\n\n    pip install consullock\n\nBleeding edge versions can be installed directly from GitHub:\n\n.. code:: bash\n\n    pip install git+https://github.com/wtsi-hgi/consul-lock.git@master#egg=consullock\n\nUsage\n-----\n\nCLI\n~~~\n\nSetup\n^^^^^\n\nSet environment variables:\n\n.. code:: bash\n\n    export CONSUL_HTTP_ADDR=consul.example.com:8500\n    export CONSUL_HTTP_TOKEN=token\n\nGeneral\n^^^^^^^\n\n::\n\n    usage: consullock [-h] [-v] {unlock,lock,execute} ...\n\n    Tool to use locks in Consul (v4.2.0)\n\n    positional arguments:\n      {unlock,lock,execute}\n                            action\n        unlock              release a lock\n        lock                acquire a lock\n        execute             call executable whilst holding lock\n\n    optional arguments:\n      -h, --help            show this help message and exit\n      -v                    increase the level of log verbosity (add multiple\n                            increase further)\n\nLocking\n^^^^^^^\n\n::\n\n    usage: consullock lock [-h] [--session-ttl SESSION_TTL] [--non-blocking]\n                           [--timeout TIMEOUT] [--metadata METADATA]\n                           [--on-before-lock ON_BEFORE_LOCK [ON_BEFORE_LOCK ...]]\n                           [--on-already-locked ON_ALREADY_LOCKED [ON_ALREADY_LOCKED ...]]\n                           [-i I]\n                           key\n\n    positional arguments:\n      key                   the lock identifier\n\n    optional arguments:\n      -h, --help            show this help message and exit\n      --session-ttl SESSION_TTL\n                            time to live (ttl) in seconds of the session that will\n                            be created to hold the lock. Must be between 10s and\n                            86400s (inclusive). If set to 0, the session will not\n                            expire\n      --non-blocking        do not block if cannot lock straight away\n      --timeout TIMEOUT     give up trying to acquire the key after this many\n                            seconds (where 0 is never)\n      --metadata METADATA   additional metadata to add to the lock information\n                            (will be converted to JSON)\n      --on-before-lock ON_BEFORE_LOCK [ON_BEFORE_LOCK ...]\n                            path to executable that is to be called before an\n                            attempt is made to acquire a lock, where the lock key\n                            is passed as the first argument. Any failures of this\n                            executable are ignored\n      --on-already-locked ON_ALREADY_LOCKED [ON_ALREADY_LOCKED ...]\n                            path to executable that is to be called after an\n                            attempt has been made to acquire a lock but failed due\n                            to the lock already been taken, where the lock key is\n                            passed as the first argument. Any failures of this\n                            executable are ignored\n      -i I                  number of seconds between polls to acquire a locked\n                            lock\n\nUnlocking\n^^^^^^^^^\n\n::\n\n    usage: consullock unlock [-h] [-r] key\n\n    positional arguments:\n      key         the lock identifier\n\n    optional arguments:\n      -h, --help  show this help message and exit\n      -r          whether the key should be treated as a regular expression and to\n                  release all matching locks\n\nExecuting with lock\n^^^^^^^^^^^^^^^^^^^\n\n::\n\n    usage: consullock execute [-h] [--session-ttl SESSION_TTL] [--non-blocking]\n                              [--timeout TIMEOUT] [--metadata METADATA]\n                              [--on-before-lock ON_BEFORE_LOCK [ON_BEFORE_LOCK ...]]\n                              [--on-already-locked ON_ALREADY_LOCKED [ON_ALREADY_LOCKED ...]]\n                              [-i I]\n                              key executable\n\n    positional arguments:\n      key                   the lock identifier\n      executable            to execute in shell\n\n    optional arguments:\n      -h, --help            show this help message and exit\n      --session-ttl SESSION_TTL\n                            time to live (ttl) in seconds of the session that will\n                            be created to hold the lock. Must be between 10s and\n                            86400s (inclusive). If set to 0, the session will not\n                            expire\n      --non-blocking        do not block if cannot lock straight away\n      --timeout TIMEOUT     give up trying to acquire the key after this many\n                            seconds (where 0 is never)\n      --metadata METADATA   additional metadata to add to the lock information\n                            (will be converted to JSON)\n      --on-before-lock ON_BEFORE_LOCK [ON_BEFORE_LOCK ...]\n                            path to executable that is to be called before an\n                            attempt is made to acquire a lock, where the lock key\n                            is passed as the first argument. Any failures of this\n                            executable are ignored\n      --on-already-locked ON_ALREADY_LOCKED [ON_ALREADY_LOCKED ...]\n                            path to executable that is to be called after an\n                            attempt has been made to acquire a lock but failed due\n                            to the lock already been taken, where the lock key is\n                            passed as the first argument. Any failures of this\n                            executable are ignored\n      -i I                  number of seconds between polls to acquire a locked\n                            lock\n\nExamples\n^^^^^^^^\n\nAcquire lock\n''''''''''''\n\nBlock until acquires lock with key \"my/lock\", which will expire after 10\nminutes:\n\n::\n\n    $ consul-lock lock --session-ttl=600 my/lock\n    {\"created\": \"2017-11-30T14:55:49.322108\", \"key\": \"my/lock\", \"secondsToLock\": 2.6241003070026636e-05, \"session\": \"9b92744f-f1a9-db12-7873-ad44af5ae224\"}\n    $ echo $?\n    0 \n\nTry to acquire already locked \"my/lock\" but do not block:\n\n::\n\n    $ consul-lock lock --non-blocking my/lock\n    null\n    Unable to acquire lock: my/lock\n    $ echo $?\n    100\n\n(where ``null`` is the JSON output, written to stdout)\n\nAdd metadata to lock\n''''''''''''''''''''\n\n::\n\n    $ consul-lock lock --metadata={\"testing\": 123} my/lock\n    {\"created\": \"2017-12-05T12:26:13.717995\", \"key\": \"my/lock\", \"metadata\": {\"testing\": 123}, \"secondsToLock\": 4.327880731027108, \"session\": \"6ad662de-6e0c-8e0f-d92c-5fface60c49b\"}\n\nAcquire lock with event listeners\n'''''''''''''''''''''''''''''''''\n\n::\n\n    $ consul-lock lock --on-before-lock=./my-before-script.sh --on-already-locked=./my-locked-script.sh my/lock\n    {\"created\": \"2017-12-07T13:02:06.773088\", \"key\": \"my/lock\", \"secondsToLock\": 1.349498052150011e-05, \"session\": \"459266be-2a85-464e-aa08-eda97613a29c\"}\n\n*Note: if specifying event listeners in the form ``--x y``, you will\nneed to explicitly declare the end of the command options with a double\ndash, e.g.\n``consul-lock lock --on-before-lock ./my-before-script.sh -- my/lock``.*\n\nUnlock lock\n'''''''''''\n\n.. code:: bash\n\n    $ consul-lock unlock my/lock\n    [\"my/lock\"]\n    $ echo $?\n    0\n\nExecute shell with lock\n'''''''''''''''''''''''\n\n.. code:: bash\n\n    $ consul-lock execute my/lock ./my-executable\n    I am printed in \"my-executable\"\n\n*Note: the return code is the result of the executable*\n\nPython\n~~~~~~\n\n.. code:: python\n\n    from typing import Dict\n    from consullock.configuration import get_consul_configuration_from_environment\n    from consullock.managers import ConsulLockManager\n    from consullock.models import ConsulLockInformation\n\n    # Instantiate lock manager\n    lock_manager = ConsulLockManager(\n        consul_configuration=get_consul_configuration_from_environment(),\n        session_ttl_in_seconds=3600)\n    # Note: if the Consul configuration is not specified explicitly, an attempt to gather it from environmental variables \n    # will be made (see: https://www.consul.io/docs/commands/index.html#environment-variables).\n\n    # Use lock in context\n    with lock_manager.acquire(\"my/lock\"):\n        do_things_holding_lock()\n\n    # Get lock\n    lock = lock_manager.acquire(\"my/lock\", timeout=60, blocking=True, metadata=\"testing\")\n\n    # Find lock associated to a given key\n    lock = lock_manager.find(\"my/lock\")\n\n    # Find locks that match a regex\n    locks = lock_manager.find_regex(\"my/.*\")  # type: Dict[str, Optional[ConsulLockInformation]]\n\n    # Release single lock\n    lock_manager.release(\"my/lock\")\n\n    # Release many locks\n    lock_manager.release_all(\"my/lock-1\", \"my/lock-2\", \"my/lock-3\")\n\n    # Release locks with key matching regex\n    lock_manager.release_regex(\"my/.*\")\n\n    # Execute shell whilst holding lock (note: use context manager if executing Python!)\n    lock_manager.execute(\"my/lock\", \"echo Hello World\")\n\nDevelopment\n-----------\n\nTests\n~~~~~\n\nPrerequisites: - Docker (used to start Consul instances)\n\nInstall the test requirements:\n\n::\n\n    pip install -r test_requirements.txt\n\nRun tests with:\n\n::\n\n    PYTHONPATH=. python -m unittest discover -v -s consullock/tests\n\nAlternatives\n------------\n\n-  `alaa/consul-lock <https://github.com/alaa/consul-lock>`__ - Go tool\n   with CLI where the user has to deal with sessions.\n-  `fidian/consul-locker <https://github.com/fidian/consul-locker>`__ -\n   bash script that locks, executes and then releases.\n-  `KurToMe/python-consul-lock <https://github.com/KurToMe/python-consul-lock>`__\n   - unmaintained Python lock interface with with questionable\n   configuration.\n\n.. |Build Status| image:: https://travis-ci.org/wtsi-hgi/consul-lock.svg?branch=master\n   :target: https://travis-ci.org/wtsi-hgi/consul-lock\n.. |codecov| image:: https://codecov.io/gh/wtsi-hgi/consul-lock/branch/master/graph/badge.svg\n   :target: https://codecov.io/gh/wtsi-hgi/consul-lock\n.. |PyPI version| image:: https://badge.fury.io/py/consullock.svg\n   :target: https://badge.fury.io/py/consullock\n", "description_content_type": null, "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/wtsi-hgi/consul-lock", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "consullock", "package_url": "https://pypi.org/project/consullock/", "platform": "", "project_url": "https://pypi.org/project/consullock/", "project_urls": {"Homepage": "https://github.com/wtsi-hgi/consul-lock"}, "release_url": "https://pypi.org/project/consullock/4.2.0/", "requires_dist": null, "requires_python": "", "summary": "Tool to use locks in Consul", "version": "4.2.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><a href=\"https://travis-ci.org/wtsi-hgi/consul-lock\" rel=\"nofollow\"><img alt=\"Build Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/13e79f727d3ea39a7503b9f012ae86210dec507f/68747470733a2f2f7472617669732d63692e6f72672f777473692d6867692f636f6e73756c2d6c6f636b2e7376673f6272616e63683d6d6173746572\"></a> <a href=\"https://codecov.io/gh/wtsi-hgi/consul-lock\" rel=\"nofollow\"><img alt=\"codecov\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/cef22454563622161630b28d53bd4a6e97f46ef3/68747470733a2f2f636f6465636f762e696f2f67682f777473692d6867692f636f6e73756c2d6c6f636b2f6272616e63682f6d61737465722f67726170682f62616467652e737667\"></a> <a href=\"https://badge.fury.io/py/consullock\" rel=\"nofollow\"><img alt=\"PyPI version\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/40aa4e24d242c1b7320396e0a51fadba9439210e/68747470733a2f2f62616467652e667572792e696f2f70792f636f6e73756c6c6f636b2e737667\"></a></p>\n<div id=\"consul-lock\">\n<h2>Consul Lock</h2>\n<p><em>CLI and Python interface for easily managing Consul locks</em></p>\n<div id=\"about\">\n<h3>About</h3>\n<ul>\n<li>CLI &amp; Python interface:<ul>\n<li>Acquire and release a lock.</li>\n<li>Execute shell whilst holding a lock (releasing on exit).</li>\n<li>Set TTL of the session that acquires a lock.</li>\n<li>Blocking and non-blocking locking.</li>\n<li>Lock acquire timeouts.</li>\n<li>Add extra metadata to lock information (useful for monitoring who\nis holding locks).</li>\n<li>Specify lock event listeners to be fired before lock acquire is\nattempted and if unable to acquire locked lock.</li>\n</ul>\n</li>\n<li>CLI:<ul>\n<li>Release multiple locks with keys that match regular expression.</li>\n<li>Meaningful exit codes (see <tt>configuration.py</tt> for details).</li>\n<li>JSON output on stdout.</li>\n<li>Add extra verbosity on stderr with <tt><span class=\"pre\">-vv</span></tt>.</li>\n</ul>\n</li>\n<li>Python interface:<ul>\n<li>Release multiple locks.</li>\n<li>Find and release multiple locks with keys that match regular\nexpression.</li>\n<li>Type hinting.</li>\n</ul>\n</li>\n</ul>\n</div>\n<div id=\"installation\">\n<h3>Installation</h3>\n<p>Prerequisites: - python &gt;= 3.6</p>\n<p>The tool can be installed from PyPi:</p>\n<pre>pip install consullock\n</pre>\n<p>Bleeding edge versions can be installed directly from GitHub:</p>\n<pre>pip install git+https://github.com/wtsi-hgi/consul-lock.git@master#egg<span class=\"o\">=</span>consullock\n</pre>\n</div>\n<div id=\"usage\">\n<h3>Usage</h3>\n<div id=\"cli\">\n<h4>CLI</h4>\n<div id=\"setup\">\n<h5>Setup</h5>\n<p>Set environment variables:</p>\n<pre><span class=\"nb\">export</span> <span class=\"nv\">CONSUL_HTTP_ADDR</span><span class=\"o\">=</span>consul.example.com:8500\n<span class=\"nb\">export</span> <span class=\"nv\">CONSUL_HTTP_TOKEN</span><span class=\"o\">=</span>token\n</pre>\n</div>\n<div id=\"general\">\n<h5>General</h5>\n<pre>usage: consullock [-h] [-v] {unlock,lock,execute} ...\n\nTool to use locks in Consul (v4.2.0)\n\npositional arguments:\n  {unlock,lock,execute}\n                        action\n    unlock              release a lock\n    lock                acquire a lock\n    execute             call executable whilst holding lock\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -v                    increase the level of log verbosity (add multiple\n                        increase further)\n</pre>\n</div>\n<div id=\"locking\">\n<h5>Locking</h5>\n<pre>usage: consullock lock [-h] [--session-ttl SESSION_TTL] [--non-blocking]\n                       [--timeout TIMEOUT] [--metadata METADATA]\n                       [--on-before-lock ON_BEFORE_LOCK [ON_BEFORE_LOCK ...]]\n                       [--on-already-locked ON_ALREADY_LOCKED [ON_ALREADY_LOCKED ...]]\n                       [-i I]\n                       key\n\npositional arguments:\n  key                   the lock identifier\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --session-ttl SESSION_TTL\n                        time to live (ttl) in seconds of the session that will\n                        be created to hold the lock. Must be between 10s and\n                        86400s (inclusive). If set to 0, the session will not\n                        expire\n  --non-blocking        do not block if cannot lock straight away\n  --timeout TIMEOUT     give up trying to acquire the key after this many\n                        seconds (where 0 is never)\n  --metadata METADATA   additional metadata to add to the lock information\n                        (will be converted to JSON)\n  --on-before-lock ON_BEFORE_LOCK [ON_BEFORE_LOCK ...]\n                        path to executable that is to be called before an\n                        attempt is made to acquire a lock, where the lock key\n                        is passed as the first argument. Any failures of this\n                        executable are ignored\n  --on-already-locked ON_ALREADY_LOCKED [ON_ALREADY_LOCKED ...]\n                        path to executable that is to be called after an\n                        attempt has been made to acquire a lock but failed due\n                        to the lock already been taken, where the lock key is\n                        passed as the first argument. Any failures of this\n                        executable are ignored\n  -i I                  number of seconds between polls to acquire a locked\n                        lock\n</pre>\n</div>\n<div id=\"unlocking\">\n<h5>Unlocking</h5>\n<pre>usage: consullock unlock [-h] [-r] key\n\npositional arguments:\n  key         the lock identifier\n\noptional arguments:\n  -h, --help  show this help message and exit\n  -r          whether the key should be treated as a regular expression and to\n              release all matching locks\n</pre>\n</div>\n<div id=\"executing-with-lock\">\n<h5>Executing with lock</h5>\n<pre>usage: consullock execute [-h] [--session-ttl SESSION_TTL] [--non-blocking]\n                          [--timeout TIMEOUT] [--metadata METADATA]\n                          [--on-before-lock ON_BEFORE_LOCK [ON_BEFORE_LOCK ...]]\n                          [--on-already-locked ON_ALREADY_LOCKED [ON_ALREADY_LOCKED ...]]\n                          [-i I]\n                          key executable\n\npositional arguments:\n  key                   the lock identifier\n  executable            to execute in shell\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --session-ttl SESSION_TTL\n                        time to live (ttl) in seconds of the session that will\n                        be created to hold the lock. Must be between 10s and\n                        86400s (inclusive). If set to 0, the session will not\n                        expire\n  --non-blocking        do not block if cannot lock straight away\n  --timeout TIMEOUT     give up trying to acquire the key after this many\n                        seconds (where 0 is never)\n  --metadata METADATA   additional metadata to add to the lock information\n                        (will be converted to JSON)\n  --on-before-lock ON_BEFORE_LOCK [ON_BEFORE_LOCK ...]\n                        path to executable that is to be called before an\n                        attempt is made to acquire a lock, where the lock key\n                        is passed as the first argument. Any failures of this\n                        executable are ignored\n  --on-already-locked ON_ALREADY_LOCKED [ON_ALREADY_LOCKED ...]\n                        path to executable that is to be called after an\n                        attempt has been made to acquire a lock but failed due\n                        to the lock already been taken, where the lock key is\n                        passed as the first argument. Any failures of this\n                        executable are ignored\n  -i I                  number of seconds between polls to acquire a locked\n                        lock\n</pre>\n</div>\n<div id=\"examples\">\n<h5>Examples</h5>\n<div id=\"acquire-lock\">\n<h6>Acquire lock</h6>\n<p>Block until acquires lock with key \u201cmy/lock\u201d, which will expire after 10\nminutes:</p>\n<pre>$ consul-lock lock --session-ttl=600 my/lock\n{\"created\": \"2017-11-30T14:55:49.322108\", \"key\": \"my/lock\", \"secondsToLock\": 2.6241003070026636e-05, \"session\": \"9b92744f-f1a9-db12-7873-ad44af5ae224\"}\n$ echo $?\n0\n</pre>\n<p>Try to acquire already locked \u201cmy/lock\u201d but do not block:</p>\n<pre>$ consul-lock lock --non-blocking my/lock\nnull\nUnable to acquire lock: my/lock\n$ echo $?\n100\n</pre>\n<p>(where <tt>null</tt> is the JSON output, written to stdout)</p>\n</div>\n<div id=\"add-metadata-to-lock\">\n<h6>Add metadata to lock</h6>\n<pre>$ consul-lock lock --metadata={\"testing\": 123} my/lock\n{\"created\": \"2017-12-05T12:26:13.717995\", \"key\": \"my/lock\", \"metadata\": {\"testing\": 123}, \"secondsToLock\": 4.327880731027108, \"session\": \"6ad662de-6e0c-8e0f-d92c-5fface60c49b\"}\n</pre>\n</div>\n<div id=\"acquire-lock-with-event-listeners\">\n<h6>Acquire lock with event listeners</h6>\n<pre>$ consul-lock lock --on-before-lock=./my-before-script.sh --on-already-locked=./my-locked-script.sh my/lock\n{\"created\": \"2017-12-07T13:02:06.773088\", \"key\": \"my/lock\", \"secondsToLock\": 1.349498052150011e-05, \"session\": \"459266be-2a85-464e-aa08-eda97613a29c\"}\n</pre>\n<p><em>Note: if specifying event listeners in the form ``\u2013x y``, you will\nneed to explicitly declare the end of the command options with a double\ndash, e.g.\n``consul-lock lock \u2013on-before-lock ./my-before-script.sh \u2013 my/lock``.</em></p>\n</div>\n<div id=\"unlock-lock\">\n<h6>Unlock lock</h6>\n<pre>$ consul-lock unlock my/lock\n<span class=\"o\">[</span><span class=\"s2\">\"my/lock\"</span><span class=\"o\">]</span>\n$ <span class=\"nb\">echo</span> <span class=\"nv\">$?</span>\n<span class=\"m\">0</span>\n</pre>\n</div>\n<div id=\"execute-shell-with-lock\">\n<h6>Execute shell with lock</h6>\n<pre>$ consul-lock execute my/lock ./my-executable\nI am printed in <span class=\"s2\">\"my-executable\"</span>\n</pre>\n<p><em>Note: the return code is the result of the executable</em></p>\n</div>\n</div>\n</div>\n<div id=\"python\">\n<h4>Python</h4>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Dict</span>\n<span class=\"kn\">from</span> <span class=\"nn\">consullock.configuration</span> <span class=\"kn\">import</span> <span class=\"n\">get_consul_configuration_from_environment</span>\n<span class=\"kn\">from</span> <span class=\"nn\">consullock.managers</span> <span class=\"kn\">import</span> <span class=\"n\">ConsulLockManager</span>\n<span class=\"kn\">from</span> <span class=\"nn\">consullock.models</span> <span class=\"kn\">import</span> <span class=\"n\">ConsulLockInformation</span>\n\n<span class=\"c1\"># Instantiate lock manager</span>\n<span class=\"n\">lock_manager</span> <span class=\"o\">=</span> <span class=\"n\">ConsulLockManager</span><span class=\"p\">(</span>\n    <span class=\"n\">consul_configuration</span><span class=\"o\">=</span><span class=\"n\">get_consul_configuration_from_environment</span><span class=\"p\">(),</span>\n    <span class=\"n\">session_ttl_in_seconds</span><span class=\"o\">=</span><span class=\"mi\">3600</span><span class=\"p\">)</span>\n<span class=\"c1\"># Note: if the Consul configuration is not specified explicitly, an attempt to gather it from environmental variables</span>\n<span class=\"c1\"># will be made (see: https://www.consul.io/docs/commands/index.html#environment-variables).</span>\n\n<span class=\"c1\"># Use lock in context</span>\n<span class=\"k\">with</span> <span class=\"n\">lock_manager</span><span class=\"o\">.</span><span class=\"n\">acquire</span><span class=\"p\">(</span><span class=\"s2\">\"my/lock\"</span><span class=\"p\">):</span>\n    <span class=\"n\">do_things_holding_lock</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># Get lock</span>\n<span class=\"n\">lock</span> <span class=\"o\">=</span> <span class=\"n\">lock_manager</span><span class=\"o\">.</span><span class=\"n\">acquire</span><span class=\"p\">(</span><span class=\"s2\">\"my/lock\"</span><span class=\"p\">,</span> <span class=\"n\">timeout</span><span class=\"o\">=</span><span class=\"mi\">60</span><span class=\"p\">,</span> <span class=\"n\">blocking</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">metadata</span><span class=\"o\">=</span><span class=\"s2\">\"testing\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Find lock associated to a given key</span>\n<span class=\"n\">lock</span> <span class=\"o\">=</span> <span class=\"n\">lock_manager</span><span class=\"o\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"s2\">\"my/lock\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Find locks that match a regex</span>\n<span class=\"n\">locks</span> <span class=\"o\">=</span> <span class=\"n\">lock_manager</span><span class=\"o\">.</span><span class=\"n\">find_regex</span><span class=\"p\">(</span><span class=\"s2\">\"my/.*\"</span><span class=\"p\">)</span>  <span class=\"c1\"># type: Dict[str, Optional[ConsulLockInformation]]</span>\n\n<span class=\"c1\"># Release single lock</span>\n<span class=\"n\">lock_manager</span><span class=\"o\">.</span><span class=\"n\">release</span><span class=\"p\">(</span><span class=\"s2\">\"my/lock\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Release many locks</span>\n<span class=\"n\">lock_manager</span><span class=\"o\">.</span><span class=\"n\">release_all</span><span class=\"p\">(</span><span class=\"s2\">\"my/lock-1\"</span><span class=\"p\">,</span> <span class=\"s2\">\"my/lock-2\"</span><span class=\"p\">,</span> <span class=\"s2\">\"my/lock-3\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Release locks with key matching regex</span>\n<span class=\"n\">lock_manager</span><span class=\"o\">.</span><span class=\"n\">release_regex</span><span class=\"p\">(</span><span class=\"s2\">\"my/.*\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Execute shell whilst holding lock (note: use context manager if executing Python!)</span>\n<span class=\"n\">lock_manager</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"s2\">\"my/lock\"</span><span class=\"p\">,</span> <span class=\"s2\">\"echo Hello World\"</span><span class=\"p\">)</span>\n</pre>\n</div>\n</div>\n<div id=\"development\">\n<h3>Development</h3>\n<h3 id=\"tests\"><span class=\"section-subtitle\">Tests</span></h3>\n<p>Prerequisites: - Docker (used to start Consul instances)</p>\n<p>Install the test requirements:</p>\n<pre>pip install -r test_requirements.txt\n</pre>\n<p>Run tests with:</p>\n<pre>PYTHONPATH=. python -m unittest discover -v -s consullock/tests\n</pre>\n</div>\n<div id=\"alternatives\">\n<h3>Alternatives</h3>\n<ul>\n<li><a href=\"https://github.com/alaa/consul-lock\" rel=\"nofollow\">alaa/consul-lock</a> - Go tool\nwith CLI where the user has to deal with sessions.</li>\n<li><a href=\"https://github.com/fidian/consul-locker\" rel=\"nofollow\">fidian/consul-locker</a> -\nbash script that locks, executes and then releases.</li>\n<li><a href=\"https://github.com/KurToMe/python-consul-lock\" rel=\"nofollow\">KurToMe/python-consul-lock</a>\n- unmaintained Python lock interface with with questionable\nconfiguration.</li>\n</ul>\n</div>\n</div>\n\n          </div>"}, "last_serial": 3531249, "releases": {"1.0.0": [{"comment_text": "", "digests": {"md5": "4b5a753fedd135e849a2f19fc3918626", "sha256": "3c44f6a2f5a466c63a66dea9bf6eaa26cfd19ffa01524d16c114259c0942c6e3"}, "downloads": -1, "filename": "consullock-1.0.0.tar.gz", "has_sig": false, "md5_digest": "4b5a753fedd135e849a2f19fc3918626", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15793, "upload_time": "2017-12-01T11:07:56", "upload_time_iso_8601": "2017-12-01T11:07:56.552936Z", "url": "https://files.pythonhosted.org/packages/14/ff/c32142572268220f5b5b9f785346028c82049f4091dedee89f64db6afd5d/consullock-1.0.0.tar.gz", "yanked": false}], "1.0.0b0": [{"comment_text": "", "digests": {"md5": "5acfd98e749e6073bba9ae1fa7cbcf41", "sha256": "e432052d1279218d9c9e44b6bdb9397d893374f4714227e2435a64cbfaca918d"}, "downloads": -1, "filename": "consullock-1.0.0b0.tar.gz", "has_sig": false, "md5_digest": "5acfd98e749e6073bba9ae1fa7cbcf41", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 7066, "upload_time": "2017-11-17T16:10:49", "upload_time_iso_8601": "2017-11-17T16:10:49.859000Z", "url": "https://files.pythonhosted.org/packages/1a/61/388653526dd6f5c107785f592d58b2489f5a9d73b4c83d82c1b99b6eb4cd/consullock-1.0.0b0.tar.gz", "yanked": false}], "1.0.1": [{"comment_text": "", "digests": {"md5": "d8ce7b3f52d599650dc611cab2a1baa7", "sha256": "bc6698e9c9faeabf0523cec091b2d9f091422ba6bbcb923f564f325e795b4744"}, "downloads": -1, "filename": "consullock-1.0.1.tar.gz", "has_sig": false, "md5_digest": "d8ce7b3f52d599650dc611cab2a1baa7", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15780, "upload_time": "2017-12-01T11:22:13", "upload_time_iso_8601": "2017-12-01T11:22:13.880657Z", "url": "https://files.pythonhosted.org/packages/09/7d/ba256991fd43caae8a7f8e96d3f76f063fa724d44a71c30208be30598c65/consullock-1.0.1.tar.gz", "yanked": false}], "1.0.2": [{"comment_text": "", "digests": {"md5": "6fe7b7fa4829bae0acb90b081a7a7c73", "sha256": "0b273a56bfe57f21c42ef0906e0120469900192859df17cfabbd73cd91eb7a05"}, "downloads": -1, "filename": "consullock-1.0.2.tar.gz", "has_sig": false, "md5_digest": "6fe7b7fa4829bae0acb90b081a7a7c73", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15856, "upload_time": "2017-12-01T16:54:45", "upload_time_iso_8601": "2017-12-01T16:54:45.189103Z", "url": "https://files.pythonhosted.org/packages/a3/d6/bafde55d1b7bd77833a8861c94eafb9ebfb3160da13f82781dfb1a443b47/consullock-1.0.2.tar.gz", "yanked": false}], "1.1.0": [{"comment_text": "", "digests": {"md5": "537d0795265fc10d41d8b0b2ace9a0b4", "sha256": "7b0409770af3e19e8c8455bc91113c4e63b6c9958147028ee61eca59c3f2508c"}, "downloads": -1, "filename": "consullock-1.1.0.tar.gz", "has_sig": false, "md5_digest": "537d0795265fc10d41d8b0b2ace9a0b4", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 16772, "upload_time": "2017-12-05T12:51:30", "upload_time_iso_8601": "2017-12-05T12:51:30.480553Z", "url": "https://files.pythonhosted.org/packages/3b/4a/3a17c24ba7d5e474ade2057e7588c412a45d82959e208eb76b688282909b/consullock-1.1.0.tar.gz", "yanked": false}], "2.0.0": [{"comment_text": "", "digests": {"md5": "dd293c03d24592a12351bbed68461e93", "sha256": "17bf39138c3a2ece79e8ebde003fe8e5df125f45cc5b5bd4f4fb872e2aaeabbb"}, "downloads": -1, "filename": "consullock-2.0.0.tar.gz", "has_sig": false, "md5_digest": "dd293c03d24592a12351bbed68461e93", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 18706, "upload_time": "2017-12-05T17:02:14", "upload_time_iso_8601": "2017-12-05T17:02:14.811921Z", "url": "https://files.pythonhosted.org/packages/a7/6c/9ca979a0e9580fb3155592b6d879165b397c61c121326a26dc1675ac582a/consullock-2.0.0.tar.gz", "yanked": false}], "2.0.1": [{"comment_text": "", "digests": {"md5": "e17bb697e69245af4fa3b2902c73a595", "sha256": "a49acce8b975b1920f6b74672dffaaf7d2a4a5c90f67b794c5eddac7aff2102e"}, "downloads": -1, "filename": "consullock-2.0.1.tar.gz", "has_sig": false, "md5_digest": "e17bb697e69245af4fa3b2902c73a595", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 18867, "upload_time": "2017-12-06T10:33:18", "upload_time_iso_8601": "2017-12-06T10:33:18.620462Z", "url": "https://files.pythonhosted.org/packages/1c/8c/f8340cedb738e5dfb59e1f16ba0928e9cba83e11a962956d5e5727633a2a/consullock-2.0.1.tar.gz", "yanked": false}], "3.0.0": [{"comment_text": "", "digests": {"md5": "1ea5c3de9c82fbad07e02cf2b2d61d3f", "sha256": "dd6f7665d88633d7de5a170a7313aa4cd5acd6b984b1e1073018574546ade41f"}, "downloads": -1, "filename": "consullock-3.0.0.tar.gz", "has_sig": false, "md5_digest": "1ea5c3de9c82fbad07e02cf2b2d61d3f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 19275, "upload_time": "2017-12-06T17:09:10", "upload_time_iso_8601": "2017-12-06T17:09:10.644421Z", "url": "https://files.pythonhosted.org/packages/9b/a7/352db70351d624a8c72ac24d94f9442df7e38aee6b3de77db7bc753b9d7b/consullock-3.0.0.tar.gz", "yanked": false}], "4.0.0": [{"comment_text": "", "digests": {"md5": "b5c74e10c71e53c02ebc47feb8309ef0", "sha256": "d41b2db863fd7bd1af49c9edec28e43019aa299f0e46c45f5d581e751c068738"}, "downloads": -1, "filename": "consullock-4.0.0.tar.gz", "has_sig": false, "md5_digest": "b5c74e10c71e53c02ebc47feb8309ef0", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 20176, "upload_time": "2017-12-07T14:56:29", "upload_time_iso_8601": "2017-12-07T14:56:29.857815Z", "url": "https://files.pythonhosted.org/packages/73/2d/09727584a7991032afb67483bbada49ef6d22b66f11486ff3b3d4546ea40/consullock-4.0.0.tar.gz", "yanked": false}], "4.1.0": [{"comment_text": "", "digests": {"md5": "e252055ed7296dcee95519c875565650", "sha256": "7d88403f304a5153f5927658a1c0981274f08eb9140a23daf863655b9ab4c0cc"}, "downloads": -1, "filename": "consullock-4.1.0.tar.gz", "has_sig": false, "md5_digest": "e252055ed7296dcee95519c875565650", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 20393, "upload_time": "2018-01-18T14:12:36", "upload_time_iso_8601": "2018-01-18T14:12:36.709080Z", "url": "https://files.pythonhosted.org/packages/09/17/e58c91280dbd61fe231e38f4cc4557167a6ca00a0a2ede2a9e8c5f13f0ff/consullock-4.1.0.tar.gz", "yanked": false}], "4.2.0": [{"comment_text": "", "digests": {"md5": "3c134871031b55c5f9680b54fbbb4a7e", "sha256": "18a5953ec998325644d74977f40d25847c296aedc696b51204a068b3b457be3a"}, "downloads": -1, "filename": "consullock-4.2.0.tar.gz", "has_sig": false, "md5_digest": "3c134871031b55c5f9680b54fbbb4a7e", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 22361, "upload_time": "2018-01-29T11:56:27", "upload_time_iso_8601": "2018-01-29T11:56:27.121601Z", "url": "https://files.pythonhosted.org/packages/6d/4c/4d129d76ca74e3d785990fd6f10a44e08b8279e654a609b9c2a8c83a055b/consullock-4.2.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "3c134871031b55c5f9680b54fbbb4a7e", "sha256": "18a5953ec998325644d74977f40d25847c296aedc696b51204a068b3b457be3a"}, "downloads": -1, "filename": "consullock-4.2.0.tar.gz", "has_sig": false, "md5_digest": "3c134871031b55c5f9680b54fbbb4a7e", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 22361, "upload_time": "2018-01-29T11:56:27", "upload_time_iso_8601": "2018-01-29T11:56:27.121601Z", "url": "https://files.pythonhosted.org/packages/6d/4c/4d129d76ca74e3d785990fd6f10a44e08b8279e654a609b9c2a8c83a055b/consullock-4.2.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:43:38 2020"}