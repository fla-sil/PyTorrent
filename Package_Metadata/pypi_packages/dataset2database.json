{"info": {"author": "Alexandros Stergiou", "author_email": "alexstergiou5@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "# dataset2database\n\n![supported versions](https://img.shields.io/badge/python-2.7%2C%203.5-green.svg)\n[![Tweet](https://img.shields.io/twitter/url/http/shields.io.svg?style=social)](https://twitter.com/intent/tweet?text=dataset2database&video&to&sql&converter&url=https://github.com/alexandrosstergiou/dataset2database&hashtags=VideoConverter)\n----------------------\nAbout\n----------------------\n\nThe package is made as a solution when using video inputs in Machine Learning models. As extracting and storing frames in `.JPEG` files will quickly increase the memory requirements and more importantly the number of `inodes`, the package provides a convenient alternative. Video frames are stored as blobs at database file `.db` which can be read as quickly as the `.JPEG` files but without the additional large memory requirements.\n\n----------------------\nPackage requirements\n----------------------\nThe two required packages are `opencv` for image/frame loading and `numpy` for array manipulation. Make sure that both are installed before running any functions.\n\n**Multiprocessing:** The code uses multiprocessing for improving speeds, thus the total time required for the conversion varies across different processors. The code has been tested on an AMD Threadripper 2950X with an average conversion time of 48 minutes for ~500K videos.\n\n\n----------------------\nDataset structure\n----------------------\n\nThe package assumes a fixed dataset structure such as:\n\n```\n<dataset>    \n  \u2502\n  \u2514\u2500\u2500<class 1>\n  \u2502     \u2502\n  \u2502     \u2502\u2500\u2500\u2500 <video_data_1.mp4>\n  \u2502     \u2502\u2500\u2500\u2500 <video_data_2.mp4>\n  \u2502     \u2502\u2500\u2500\u2500 ...\n  \u2502    ...      \n  \u2502\n  \u2514\u2500\u2500\u2500<class 2>\n  \u2502      \u2502\n  \u2502      \u2502\u2500\u2500\u2500 <video_data_1.mp4>\n  \u2502      \u2502\u2500\u2500\u2500 <video_data_2.mp4>\n  \u2502      \u2502\u2500\u2500\u2500 ...\n ...    ...\n\n```\n\n----------------------\nUsage\n----------------------\n\nThe main code is at the `jpgs2single.py` file. To run the convertor simply call the `convert` function with the base directory of the dataset and the destination directory for where to save the generated databases.\n\n```python\nfrom dataset2database import convert\n#or\nfrom jpgs2singlefile import convert\n\nconvert(my_dataset_dir, my_target_dir)\n\n```\n\n----------------------\nFrames.db files\n----------------------\nVideo frames are stored in `frames.db` files with their video name and frame number as their `ObjID` and the frames array are stored as `blobs`. The name format is basically **<_video_name_>/_frame_ _ _[frame number in 5-digit format]_**\n\n![dataset2database](images/dataset2database.gif)\n\n**File viewer:** If you want to ensure that everything has been converted correctly, you can use [_SQLiteStudio_](https://sqlitestudio.pl/index.rvt) which provides an easy to use multi-platform interface (available for Windows, Mac and Ubuntu).\n\n----------------------\nDatabase loading\n----------------------\nLoading the database can easily be done with an SQL `SELECT` command based on a list of all frames with specified `ObjId`s. Then, with the help of `np.fromstring()` and `cv2.imdecode()` functions the images can be again converted to `uint8` arrays.\n\nAn example of data loading in python can be found below:\n\n```python\nimport sqlite3\nimport cv2\nimport numpy as np\n\ncon = sqlite3.connect('my_video_database.db')\ncur = con.cursor()\n\n\n# retrieve entire video from database (frames are unordered)\nframe_names = [\"{}/{}\".format(my_path.split('/')[-1],'frame_%05d'%(index+1)) for index in frame_indices]\nsql = \"SELECT Objid, frames FROM Images WHERE ObjId IN ({seq})\".format(seq=','.join(['?']*len(frame_names)))\nrow = cur.execute(sql,frame_names)\n\nids = []\nframes = []\ni = 0\n\nrow = row.fetchall()\n# Video order re-arangement\nfor ObjId, item in row:\n  #--- Decode blob\n  nparr  = np.fromstring(item, np.uint8)\n  img = cv2.imdecode(nparr, cv2.IMREAD_COLOR)\n  ids.append(ObjId)\n  frames.append(img)\n  i+=1\n\n# Ensuring correct order of frames\nframes = [frame for _, frame in sorted(zip(ids,frames), key=lambda pair: pair[0])]\n\n# (if required) array conversion [frames x height x width x channels]\nframes = np.asarray(frames)\n\ncur.close()\ncon.close()\n\n```\n\n-------------------------\nInstallation through git\n-------------------------\n\nPlease make sure, Git is installed in your machine:\n```\n$ sudo apt-get update\n$ sudo apt-get install git\n$ git clone https://github.com/alexandrosstergiou/dataset2database.git\n```\n\n\n-------------------------\nInstallation through pip\n-------------------------\n\nThe latest stable release is also available for download through pip\n```\n$ pip install dataset2databse\n```\n\n\n# Version history\n\n### 11 April 2020 : Version 0.1 - bug fixes for `convert()` function.\n### 6 April 2020 : Initial code created.\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "https://pypi.org/project/dataset2database/", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/alexandrosstergiou/dataset2database", "keywords": "SQLconverter,dataset2database,JPG2SQL", "license": "GPL-3.0", "maintainer": "", "maintainer_email": "", "name": "dataset2database", "package_url": "https://pypi.org/project/dataset2database/", "platform": "", "project_url": "https://pypi.org/project/dataset2database/", "project_urls": {"Download": "https://pypi.org/project/dataset2database/", "Homepage": "https://github.com/alexandrosstergiou/dataset2database"}, "release_url": "https://pypi.org/project/dataset2database/0.1/", "requires_dist": ["opencv-python (>=4.2.0.32)", "numpy (>=1.18.1)"], "requires_python": "", "summary": "Useful converter of videos to SQL databases for Python", "version": "0.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>dataset2database</h1>\n<h2><img alt=\"supported versions\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/69142d37e7c92bd483455043e3ac66afe876fd66/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f707974686f6e2d322e37253243253230332e352d677265656e2e737667\">\n<a href=\"https://twitter.com/intent/tweet?text=dataset2database&amp;video&amp;to&amp;sql&amp;converter&amp;url=https://github.com/alexandrosstergiou/dataset2database&amp;hashtags=VideoConverter\" rel=\"nofollow\"><img alt=\"Tweet\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/3c681f57e9ba5a57463ba379a8d5671b3c132cde/68747470733a2f2f696d672e736869656c64732e696f2f747769747465722f75726c2f687474702f736869656c64732e696f2e7376673f7374796c653d736f6369616c\"></a></h2>\n<h2>About</h2>\n<p>The package is made as a solution when using video inputs in Machine Learning models. As extracting and storing frames in <code>.JPEG</code> files will quickly increase the memory requirements and more importantly the number of <code>inodes</code>, the package provides a convenient alternative. Video frames are stored as blobs at database file <code>.db</code> which can be read as quickly as the <code>.JPEG</code> files but without the additional large memory requirements.</p>\n<hr>\n<h2>Package requirements</h2>\n<p>The two required packages are <code>opencv</code> for image/frame loading and <code>numpy</code> for array manipulation. Make sure that both are installed before running any functions.</p>\n<p><strong>Multiprocessing:</strong> The code uses multiprocessing for improving speeds, thus the total time required for the conversion varies across different processors. The code has been tested on an AMD Threadripper 2950X with an average conversion time of 48 minutes for ~500K videos.</p>\n<hr>\n<h2>Dataset structure</h2>\n<p>The package assumes a fixed dataset structure such as:</p>\n<pre><code>&lt;dataset&gt;    \n  \u2502\n  \u2514\u2500\u2500&lt;class 1&gt;\n  \u2502     \u2502\n  \u2502     \u2502\u2500\u2500\u2500 &lt;video_data_1.mp4&gt;\n  \u2502     \u2502\u2500\u2500\u2500 &lt;video_data_2.mp4&gt;\n  \u2502     \u2502\u2500\u2500\u2500 ...\n  \u2502    ...      \n  \u2502\n  \u2514\u2500\u2500\u2500&lt;class 2&gt;\n  \u2502      \u2502\n  \u2502      \u2502\u2500\u2500\u2500 &lt;video_data_1.mp4&gt;\n  \u2502      \u2502\u2500\u2500\u2500 &lt;video_data_2.mp4&gt;\n  \u2502      \u2502\u2500\u2500\u2500 ...\n ...    ...\n\n</code></pre>\n<hr>\n<h2>Usage</h2>\n<p>The main code is at the <code>jpgs2single.py</code> file. To run the convertor simply call the <code>convert</code> function with the base directory of the dataset and the destination directory for where to save the generated databases.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">dataset2database</span> <span class=\"kn\">import</span> <span class=\"n\">convert</span>\n<span class=\"c1\">#or</span>\n<span class=\"kn\">from</span> <span class=\"nn\">jpgs2singlefile</span> <span class=\"kn\">import</span> <span class=\"n\">convert</span>\n\n<span class=\"n\">convert</span><span class=\"p\">(</span><span class=\"n\">my_dataset_dir</span><span class=\"p\">,</span> <span class=\"n\">my_target_dir</span><span class=\"p\">)</span>\n</pre>\n<hr>\n<h2>Frames.db files</h2>\n<p>Video frames are stored in <code>frames.db</code> files with their video name and frame number as their <code>ObjID</code> and the frames array are stored as <code>blobs</code>. The name format is basically <strong>&lt;<em>video_name</em>&gt;/<em>frame</em> _ <em>[frame number in 5-digit format]</em></strong></p>\n<p><img alt=\"dataset2database\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/aeb94189f5859f683d80025337f062ddc617c421/696d616765732f646174617365743264617461626173652e676966\"></p>\n<p><strong>File viewer:</strong> If you want to ensure that everything has been converted correctly, you can use <a href=\"https://sqlitestudio.pl/index.rvt\" rel=\"nofollow\"><em>SQLiteStudio</em></a> which provides an easy to use multi-platform interface (available for Windows, Mac and Ubuntu).</p>\n<hr>\n<h2>Database loading</h2>\n<p>Loading the database can easily be done with an SQL <code>SELECT</code> command based on a list of all frames with specified <code>ObjId</code>s. Then, with the help of <code>np.fromstring()</code> and <code>cv2.imdecode()</code> functions the images can be again converted to <code>uint8</code> arrays.</p>\n<p>An example of data loading in python can be found below:</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">sqlite3</span>\n<span class=\"kn\">import</span> <span class=\"nn\">cv2</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n\n<span class=\"n\">con</span> <span class=\"o\">=</span> <span class=\"n\">sqlite3</span><span class=\"o\">.</span><span class=\"n\">connect</span><span class=\"p\">(</span><span class=\"s1\">'my_video_database.db'</span><span class=\"p\">)</span>\n<span class=\"n\">cur</span> <span class=\"o\">=</span> <span class=\"n\">con</span><span class=\"o\">.</span><span class=\"n\">cursor</span><span class=\"p\">()</span>\n\n\n<span class=\"c1\"># retrieve entire video from database (frames are unordered)</span>\n<span class=\"n\">frame_names</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s2\">\"</span><span class=\"si\">{}</span><span class=\"s2\">/</span><span class=\"si\">{}</span><span class=\"s2\">\"</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">my_path</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">'/'</span><span class=\"p\">)[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">],</span><span class=\"s1\">'frame_</span><span class=\"si\">%05d</span><span class=\"s1\">'</span><span class=\"o\">%</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">))</span> <span class=\"k\">for</span> <span class=\"n\">index</span> <span class=\"ow\">in</span> <span class=\"n\">frame_indices</span><span class=\"p\">]</span>\n<span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"s2\">\"SELECT Objid, frames FROM Images WHERE ObjId IN (</span><span class=\"si\">{seq}</span><span class=\"s2\">)\"</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">seq</span><span class=\"o\">=</span><span class=\"s1\">','</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">([</span><span class=\"s1\">'?'</span><span class=\"p\">]</span><span class=\"o\">*</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">frame_names</span><span class=\"p\">)))</span>\n<span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"n\">sql</span><span class=\"p\">,</span><span class=\"n\">frame_names</span><span class=\"p\">)</span>\n\n<span class=\"n\">ids</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"n\">frames</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n\n<span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"n\">row</span><span class=\"o\">.</span><span class=\"n\">fetchall</span><span class=\"p\">()</span>\n<span class=\"c1\"># Video order re-arangement</span>\n<span class=\"k\">for</span> <span class=\"n\">ObjId</span><span class=\"p\">,</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"n\">row</span><span class=\"p\">:</span>\n  <span class=\"c1\">#--- Decode blob</span>\n  <span class=\"n\">nparr</span>  <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">fromstring</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">uint8</span><span class=\"p\">)</span>\n  <span class=\"n\">img</span> <span class=\"o\">=</span> <span class=\"n\">cv2</span><span class=\"o\">.</span><span class=\"n\">imdecode</span><span class=\"p\">(</span><span class=\"n\">nparr</span><span class=\"p\">,</span> <span class=\"n\">cv2</span><span class=\"o\">.</span><span class=\"n\">IMREAD_COLOR</span><span class=\"p\">)</span>\n  <span class=\"n\">ids</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">ObjId</span><span class=\"p\">)</span>\n  <span class=\"n\">frames</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">img</span><span class=\"p\">)</span>\n  <span class=\"n\">i</span><span class=\"o\">+=</span><span class=\"mi\">1</span>\n\n<span class=\"c1\"># Ensuring correct order of frames</span>\n<span class=\"n\">frames</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">frame</span> <span class=\"k\">for</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">frame</span> <span class=\"ow\">in</span> <span class=\"nb\">sorted</span><span class=\"p\">(</span><span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">ids</span><span class=\"p\">,</span><span class=\"n\">frames</span><span class=\"p\">),</span> <span class=\"n\">key</span><span class=\"o\">=</span><span class=\"k\">lambda</span> <span class=\"n\">pair</span><span class=\"p\">:</span> <span class=\"n\">pair</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])]</span>\n\n<span class=\"c1\"># (if required) array conversion [frames x height x width x channels]</span>\n<span class=\"n\">frames</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">asarray</span><span class=\"p\">(</span><span class=\"n\">frames</span><span class=\"p\">)</span>\n\n<span class=\"n\">cur</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"p\">()</span>\n<span class=\"n\">con</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"p\">()</span>\n</pre>\n<hr>\n<h2>Installation through git</h2>\n<p>Please make sure, Git is installed in your machine:</p>\n<pre><code>$ sudo apt-get update\n$ sudo apt-get install git\n$ git clone https://github.com/alexandrosstergiou/dataset2database.git\n</code></pre>\n<hr>\n<h2>Installation through pip</h2>\n<p>The latest stable release is also available for download through pip</p>\n<pre><code>$ pip install dataset2databse\n</code></pre>\n<h1>Version history</h1>\n<h3>11 April 2020 : Version 0.1 - bug fixes for <code>convert()</code> function.</h3>\n<h3>6 April 2020 : Initial code created.</h3>\n\n          </div>"}, "last_serial": 6999449, "releases": {"0.0.1": [{"comment_text": "", "digests": {"md5": "36b46090a0ecff6329d6e757388934e9", "sha256": "efb5941718606095cb522ce7f943b901460a8389b9a2e2dcea5fdf1fb8783dd0"}, "downloads": -1, "filename": "dataset2database-0.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "36b46090a0ecff6329d6e757388934e9", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 14015, "upload_time": "2020-04-06T14:50:08", "upload_time_iso_8601": "2020-04-06T14:50:08.373151Z", "url": "https://files.pythonhosted.org/packages/f1/b7/3f9a50ee733cb9d55209e8037db7b63f101daba3dae0c0d3b7ee6d5faeef/dataset2database-0.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "9ac97a73aad9e2ed36c71e368a746cf3", "sha256": "f7d40cf817fbd43b02ffb67a96b5ec60c77f29d2aced9e651e928076f22db017"}, "downloads": -1, "filename": "dataset2database-0.0.1.tar.gz", "has_sig": false, "md5_digest": "9ac97a73aad9e2ed36c71e368a746cf3", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 1786, "upload_time": "2020-04-06T14:50:10", "upload_time_iso_8601": "2020-04-06T14:50:10.503702Z", "url": "https://files.pythonhosted.org/packages/f1/94/9fb4a8ccf16fc54105cd07ba13e8a825caf7d282dba0298e5cbb525ba0eb/dataset2database-0.0.1.tar.gz", "yanked": false}], "0.1": [{"comment_text": "", "digests": {"md5": "77209ec88d47b81fb7035271b4f2615c", "sha256": "f5747d3f65e2b0c99af630fb98ddfc54d7b6d5cb3212dcf20435f0991569aea1"}, "downloads": -1, "filename": "dataset2database-0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "77209ec88d47b81fb7035271b4f2615c", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 15488, "upload_time": "2020-04-11T12:58:55", "upload_time_iso_8601": "2020-04-11T12:58:55.316725Z", "url": "https://files.pythonhosted.org/packages/ab/23/354c9f75eade016f02a4363866f7754ecf977f058589acd0706bfbcbd86f/dataset2database-0.1-py3-none-any.whl", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "77209ec88d47b81fb7035271b4f2615c", "sha256": "f5747d3f65e2b0c99af630fb98ddfc54d7b6d5cb3212dcf20435f0991569aea1"}, "downloads": -1, "filename": "dataset2database-0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "77209ec88d47b81fb7035271b4f2615c", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 15488, "upload_time": "2020-04-11T12:58:55", "upload_time_iso_8601": "2020-04-11T12:58:55.316725Z", "url": "https://files.pythonhosted.org/packages/ab/23/354c9f75eade016f02a4363866f7754ecf977f058589acd0706bfbcbd86f/dataset2database-0.1-py3-none-any.whl", "yanked": false}], "timestamp": "Fri May  8 00:40:12 2020"}