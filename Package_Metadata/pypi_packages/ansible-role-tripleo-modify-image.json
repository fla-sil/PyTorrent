{"info": {"author": "TripleO Team", "author_email": "sbaker@redhat.com", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Intended Audience :: Developers", "Intended Audience :: Information Technology", "Intended Audience :: System Administrators", "License :: OSI Approved :: Apache Software License", "Topic :: Utilities"], "description": "TripleO Modify Image\n====================\n\nA role to allow modification to container images built for the TripleO project.\n\nRole Variables\n--------------\n\n.. list-table:: Variables used for modify image\n   :widths: auto\n   :header-rows: 1\n\n   * - Name\n     - Default Value\n     - Description\n   * - `source_image`\n     - `[undefined]`\n     - Mandatory fully qualified reference to the source image to be modified. The supplied Dockerfile will be copied and modified to make the FROM directive match this variable.\n   * - `modify_dir_path`\n     - `[undefined]`\n     - Mandatory path to the directory containing the Dockerfile to modify the image\n   * - `modified_append_tag`\n     - `date +-modified-%Y%m%d%H%M%S`\n     - String to be appended after the tag to indicate this is a modified version of the source image.\n   * - `target_image`\n     - `[undefined]`\n     - If set, the modified image will be tagged with `target_image + modified_append_tag`. If `target_image` is not set, the modified image will be tagged with `source_image + modified_append_tag`. If the purpose of the image is not changing, it may be enough to rely on the `source_image + modified_append_tag` tag to identify that this is a modified version of the source image.\n   * - `container_build_tool`\n     - `docker`\n     - Tool used to build containers, can be 'docker' or 'buildah'\n\n.. list-table:: Variables used for yum update\n   :widths: auto\n   :header-rows: 1\n\n   * - Name\n     - Default Value\n     - Description\n   * - `source_image`\n     - `[undefined]`\n     - See modify image variables\n   * - `modified_append_tag`\n     - `date +-modified-%Y%m%d%H%M%S`\n     - See modify image variables\n   * - `target_image`\n     - `''`\n     - See modify image variables\n   * - `update_repo`\n     - `''`\n     - If set, packages from this repo will be updated. Other repos will only be used for dependencies of these updates.\n   * - `yum_repos_dir_path`\n     - `None`\n     - Optional path of directory to be used as `/etc/yum.repos.d` during the update\n   * - `container_build_tool`\n     - `docker`\n     - See modify image variables\n\n\n.. list-table:: Variables used for dev install\n   :widths: auto\n   :header-rows: 1\n\n   * - Name\n     - Default Value\n     - Description\n   * - `source_image`\n     - `[undefined]`\n     - See modify image variables\n   * - `modified_append_tag`\n     - `date +-modified-%Y%m%d%H%M%S`\n     - See modify image variables\n   * - `target_image`\n     - `''`\n     - See modify image variables\n   * - `container_build_tool`\n     - `docker`\n     - See modify image variables\n   * - `refspecs`\n     - `[]`\n     - An array of project/refspec pairs that will be installed into the generated container. Currently only supports python source projects.\n   * - `python_dir`\n     - `[]`\n     - Directory which contains a Python project ready to be installed with pip.\n\n\nRequirements\n------------\n\n - ansible >= 2.4\n - python >= 2.6\n - docker-py >= 1.7.0\n - Docker API >= 1.20\n\nDependencies\n------------\n\nNone\n\nExample Playbooks\n-----------------\n\nModify Image\n~~~~~~~~~~~~\n\nThe following playbook will produce a modified image with the tag\n`:latest-modified-<timestamp>` based on the Dockerfile in the custom directory\n`/path/to/example_modify_dir`.\n\n.. code-block::\n\n    - hosts: localhost\n      tasks:\n      - name: include tripleo-modify-image\n        import_role:\n          name: tripleo-modify-image\n          tasks_from: modify_image.yml\n        vars:\n          source_image: docker.io/tripleomaster/centos-binary-nova-api:latest\n          modify_dir_path: /path/to/example_modify_dir\n          container_build_tool: docker # or buildah\n\nThe directory `example_modify_dir` contains the `Dockerfile` which will perform\nthe modification, for example:\n\n.. code-block::\n\n    # This will be replaced in the file Dockerfile.modified\n    FROM centos-binary-nova-api\n\n    # switch to root to install packages\n    USER root\n\n    # install packages\n    RUN curl \"https://bootstrap.pypa.io/get-pip.py\" -o \"/tmp/get-pip.py\"\n    RUN python /tmp/get-pip.py\n\n    # switch the container back to the default user\n    USER nova\n\nYum update\n~~~~~~~~~~\n\nThe following playbook will produce a modified image with the tag\n`:latest-updated` which will do a yum update using the host's /etc/yum.repos.d.\nThe yum update will only occur if there are differences between host and image\npackage versions. In this playbook the tasks\\_from is set as a variable instead\nof an `import_role` parameter.\n\n.. code-block::\n\n    - hosts: localhost\n      tasks:\n      - name: include tripleo-modify-image\n        import_role:\n          name: tripleo-modify-image\n        vars:\n          tasks_from: yum_update.yml\n          source_image: docker.io/tripleomaster/centos-binary-nova-api:latest\n          compare_host_packages: true\n          yum_repos_dir_path: /etc/yum.repos.d\n          modified_append_tag: updated\n          container_build_tool: docker # or buildah\n\nRPM install\n~~~~~~~~~~~\n\nThe following playbook will produce a modified image with RPMs from the\nspecified rpms\\_path on the local filesystem installed as a new layer\nfor the container. The new container tag is appened with the '-hotfix'\nsuffix. Useful for creating adhoc hotfix containers with local RPMs with no\nnetwork connectivity.\n\n.. code-block::\n\n    - hosts: localhost\n      tasks:\n      - name: include tripleo-modify-image\n        import_role:\n          name: tripleo-modify-image\n        vars:\n          tasks_from: rpm_install.yml\n          source_image: docker.io/tripleomaster/centos-binary-nova-api:latest\n          rpms_path: /foo/bar\n          modified_append_tag: -hotfix\n\nDev install\n~~~~~~~~~~~\n\nThe following playbook will produce a modified image with Python source\ncode installed via pip. To minimize dependencies within the container\nwe generate the sdist locally and then copy it into the resulting\ncontainer image as an sdist tarball to run pip install locally.\n\nIt can be used to pull a review from OpenDev Gerrit:\n\n.. code-block::\n\n    - hosts: localhost\n      connection: local\n      tasks:\n      - name: dev install heat-api\n        import_role:\n          name: tripleo-modify-image\n        vars:\n          tasks_from: dev_install.yml\n          source_image: docker.io/tripleomaster/centos-binary-heat-api:current-tripleo\n          refspecs:\n            -\n              project: heat\n              refspec: refs/changes/12/1234/3\n          modified_append_tag: -devel\n\nor it can be used to build an image from a local Python directory:\n\n.. code-block::\n\n    - hosts: localhost\n      connection: local\n      tasks:\n      - name: dev install heat-api\n        import_role:\n          name: tripleo-modify-image\n        vars:\n          tasks_from: dev_install.yml\n          source_image: docker.io/tripleomaster/centos-binary-heat-api:current-tripleo\n          modified_append_tag: -devel\n          python_dir:\n            - /home/joe/git/openstack/heat\n\nLicense\n-------\n\nApache 2.0\n\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://git.openstack.org/cgit/openstack/ansible-role-tripleo-modify-image", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "ansible-role-tripleo-modify-image", "package_url": "https://pypi.org/project/ansible-role-tripleo-modify-image/", "platform": "", "project_url": "https://pypi.org/project/ansible-role-tripleo-modify-image/", "project_urls": {"Homepage": "https://git.openstack.org/cgit/openstack/ansible-role-tripleo-modify-image"}, "release_url": "https://pypi.org/project/ansible-role-tripleo-modify-image/1.1.0/", "requires_dist": ["pbr (>=1.6)", "ansible"], "requires_python": "", "summary": "ansible-tripleo-modify-image - Ansible role to allow modification to container images built for the TripleO project.", "version": "1.1.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>TripleO Modify Image</h1>\n<p>A role to allow modification to container images built for the TripleO project.</p>\n<h2>Role Variables</h2>\n<p>.. list-table:: Variables used for modify image\n:widths: auto\n:header-rows: 1</p>\n<ul>\n<li>\n<ul>\n<li>Name</li>\n<li>Default Value</li>\n<li>Description</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>source_image</code></li>\n<li><code>[undefined]</code></li>\n<li>Mandatory fully qualified reference to the source image to be modified. The supplied Dockerfile will be copied and modified to make the FROM directive match this variable.</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>modify_dir_path</code></li>\n<li><code>[undefined]</code></li>\n<li>Mandatory path to the directory containing the Dockerfile to modify the image</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>modified_append_tag</code></li>\n<li><code>date +-modified-%Y%m%d%H%M%S</code></li>\n<li>String to be appended after the tag to indicate this is a modified version of the source image.</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>target_image</code></li>\n<li><code>[undefined]</code></li>\n<li>If set, the modified image will be tagged with <code>target_image + modified_append_tag</code>. If <code>target_image</code> is not set, the modified image will be tagged with <code>source_image + modified_append_tag</code>. If the purpose of the image is not changing, it may be enough to rely on the <code>source_image + modified_append_tag</code> tag to identify that this is a modified version of the source image.</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>container_build_tool</code></li>\n<li><code>docker</code></li>\n<li>Tool used to build containers, can be 'docker' or 'buildah'</li>\n</ul>\n</li>\n</ul>\n<p>.. list-table:: Variables used for yum update\n:widths: auto\n:header-rows: 1</p>\n<ul>\n<li>\n<ul>\n<li>Name</li>\n<li>Default Value</li>\n<li>Description</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>source_image</code></li>\n<li><code>[undefined]</code></li>\n<li>See modify image variables</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>modified_append_tag</code></li>\n<li><code>date +-modified-%Y%m%d%H%M%S</code></li>\n<li>See modify image variables</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>target_image</code></li>\n<li><code>''</code></li>\n<li>See modify image variables</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>update_repo</code></li>\n<li><code>''</code></li>\n<li>If set, packages from this repo will be updated. Other repos will only be used for dependencies of these updates.</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>yum_repos_dir_path</code></li>\n<li><code>None</code></li>\n<li>Optional path of directory to be used as <code>/etc/yum.repos.d</code> during the update</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>container_build_tool</code></li>\n<li><code>docker</code></li>\n<li>See modify image variables</li>\n</ul>\n</li>\n</ul>\n<p>.. list-table:: Variables used for dev install\n:widths: auto\n:header-rows: 1</p>\n<ul>\n<li>\n<ul>\n<li>Name</li>\n<li>Default Value</li>\n<li>Description</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>source_image</code></li>\n<li><code>[undefined]</code></li>\n<li>See modify image variables</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>modified_append_tag</code></li>\n<li><code>date +-modified-%Y%m%d%H%M%S</code></li>\n<li>See modify image variables</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>target_image</code></li>\n<li><code>''</code></li>\n<li>See modify image variables</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>container_build_tool</code></li>\n<li><code>docker</code></li>\n<li>See modify image variables</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>refspecs</code></li>\n<li><code>[]</code></li>\n<li>An array of project/refspec pairs that will be installed into the generated container. Currently only supports python source projects.</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><code>python_dir</code></li>\n<li><code>[]</code></li>\n<li>Directory which contains a Python project ready to be installed with pip.</li>\n</ul>\n</li>\n</ul>\n<h2>Requirements</h2>\n<ul>\n<li>ansible &gt;= 2.4</li>\n<li>python &gt;= 2.6</li>\n<li>docker-py &gt;= 1.7.0</li>\n<li>Docker API &gt;= 1.20</li>\n</ul>\n<h2>Dependencies</h2>\n<p>None</p>\n<h2>Example Playbooks</h2>\n<p>Modify Image</p>\n<pre><code>\nThe following playbook will produce a modified image with the tag\n`:latest-modified-&lt;timestamp&gt;` based on the Dockerfile in the custom directory\n`/path/to/example_modify_dir`.\n\n.. code-block::\n\n    - hosts: localhost\n      tasks:\n      - name: include tripleo-modify-image\n        import_role:\n          name: tripleo-modify-image\n          tasks_from: modify_image.yml\n        vars:\n          source_image: docker.io/tripleomaster/centos-binary-nova-api:latest\n          modify_dir_path: /path/to/example_modify_dir\n          container_build_tool: docker # or buildah\n\nThe directory `example_modify_dir` contains the `Dockerfile` which will perform\nthe modification, for example:\n\n.. code-block::\n\n    # This will be replaced in the file Dockerfile.modified\n    FROM centos-binary-nova-api\n\n    # switch to root to install packages\n    USER root\n\n    # install packages\n    RUN curl \"https://bootstrap.pypa.io/get-pip.py\" -o \"/tmp/get-pip.py\"\n    RUN python /tmp/get-pip.py\n\n    # switch the container back to the default user\n    USER nova\n\nYum update\n~~~~~~~~~~\n\nThe following playbook will produce a modified image with the tag\n`:latest-updated` which will do a yum update using the host's /etc/yum.repos.d.\nThe yum update will only occur if there are differences between host and image\npackage versions. In this playbook the tasks\\_from is set as a variable instead\nof an `import_role` parameter.\n\n.. code-block::\n\n    - hosts: localhost\n      tasks:\n      - name: include tripleo-modify-image\n        import_role:\n          name: tripleo-modify-image\n        vars:\n          tasks_from: yum_update.yml\n          source_image: docker.io/tripleomaster/centos-binary-nova-api:latest\n          compare_host_packages: true\n          yum_repos_dir_path: /etc/yum.repos.d\n          modified_append_tag: updated\n          container_build_tool: docker # or buildah\n\nRPM install\n~~~~~~~~~~~\n\nThe following playbook will produce a modified image with RPMs from the\nspecified rpms\\_path on the local filesystem installed as a new layer\nfor the container. The new container tag is appened with the '-hotfix'\nsuffix. Useful for creating adhoc hotfix containers with local RPMs with no\nnetwork connectivity.\n\n.. code-block::\n\n    - hosts: localhost\n      tasks:\n      - name: include tripleo-modify-image\n        import_role:\n          name: tripleo-modify-image\n        vars:\n          tasks_from: rpm_install.yml\n          source_image: docker.io/tripleomaster/centos-binary-nova-api:latest\n          rpms_path: /foo/bar\n          modified_append_tag: -hotfix\n\nDev install\n~~~~~~~~~~~\n\nThe following playbook will produce a modified image with Python source\ncode installed via pip. To minimize dependencies within the container\nwe generate the sdist locally and then copy it into the resulting\ncontainer image as an sdist tarball to run pip install locally.\n\nIt can be used to pull a review from OpenDev Gerrit:\n\n.. code-block::\n\n    - hosts: localhost\n      connection: local\n      tasks:\n      - name: dev install heat-api\n        import_role:\n          name: tripleo-modify-image\n        vars:\n          tasks_from: dev_install.yml\n          source_image: docker.io/tripleomaster/centos-binary-heat-api:current-tripleo\n          refspecs:\n            -\n              project: heat\n              refspec: refs/changes/12/1234/3\n          modified_append_tag: -devel\n\nor it can be used to build an image from a local Python directory:\n\n.. code-block::\n\n    - hosts: localhost\n      connection: local\n      tasks:\n      - name: dev install heat-api\n        import_role:\n          name: tripleo-modify-image\n        vars:\n          tasks_from: dev_install.yml\n          source_image: docker.io/tripleomaster/centos-binary-heat-api:current-tripleo\n          modified_append_tag: -devel\n          python_dir:\n            - /home/joe/git/openstack/heat\n\nLicense\n-------\n\nApache 2.0\n\n\n\n</code></pre>\n\n          </div>"}, "last_serial": 5469415, "releases": {"1.1.0": [{"comment_text": "", "digests": {"md5": "a078027f9fb15d232054ab9c0a916818", "sha256": "d57a72efe1c94b83f0cca8867fb161c4b91f7a1d20b01d9cd8e4c19707061dba"}, "downloads": -1, "filename": "ansible_role_tripleo_modify_image-1.1.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "a078027f9fb15d232054ab9c0a916818", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 19397, "upload_time": "2019-07-01T03:04:21", "upload_time_iso_8601": "2019-07-01T03:04:21.247082Z", "url": "https://files.pythonhosted.org/packages/fd/e4/aae3d16c0457c9a50505ee58b13561907d40808df59fa16ebc26eb3a7683/ansible_role_tripleo_modify_image-1.1.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "46b319aaf82e98d7b70c29ad8ee9b61f", "sha256": "60a9a7d702e536aeca309fab630da04e55cf7e2c5d952f93c03438f53165e413"}, "downloads": -1, "filename": "ansible-role-tripleo-modify-image-1.1.0.tar.gz", "has_sig": false, "md5_digest": "46b319aaf82e98d7b70c29ad8ee9b61f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 14876, "upload_time": "2019-07-01T03:04:25", "upload_time_iso_8601": "2019-07-01T03:04:25.437814Z", "url": "https://files.pythonhosted.org/packages/8f/99/e27671bd07faecb4a79d888349c418c3f720ca81b1eb43521059d2664e0c/ansible-role-tripleo-modify-image-1.1.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "a078027f9fb15d232054ab9c0a916818", "sha256": "d57a72efe1c94b83f0cca8867fb161c4b91f7a1d20b01d9cd8e4c19707061dba"}, "downloads": -1, "filename": "ansible_role_tripleo_modify_image-1.1.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "a078027f9fb15d232054ab9c0a916818", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 19397, "upload_time": "2019-07-01T03:04:21", "upload_time_iso_8601": "2019-07-01T03:04:21.247082Z", "url": "https://files.pythonhosted.org/packages/fd/e4/aae3d16c0457c9a50505ee58b13561907d40808df59fa16ebc26eb3a7683/ansible_role_tripleo_modify_image-1.1.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "46b319aaf82e98d7b70c29ad8ee9b61f", "sha256": "60a9a7d702e536aeca309fab630da04e55cf7e2c5d952f93c03438f53165e413"}, "downloads": -1, "filename": "ansible-role-tripleo-modify-image-1.1.0.tar.gz", "has_sig": false, "md5_digest": "46b319aaf82e98d7b70c29ad8ee9b61f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 14876, "upload_time": "2019-07-01T03:04:25", "upload_time_iso_8601": "2019-07-01T03:04:25.437814Z", "url": "https://files.pythonhosted.org/packages/8f/99/e27671bd07faecb4a79d888349c418c3f720ca81b1eb43521059d2664e0c/ansible-role-tripleo-modify-image-1.1.0.tar.gz", "yanked": false}], "timestamp": "Thu May  7 18:18:03 2020"}