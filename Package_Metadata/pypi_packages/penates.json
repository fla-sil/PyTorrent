{"info": {"author": "Matthieu Gallet", "author_email": "github@19pouces.net", "bugtrack_url": null, "classifiers": [], "description": "Penates\n=======\n\nGroup of Ansible tasks for configuring a basic private network with the following services:\n\n  * PKI (openssl)\n  * LDAP (openldap)\n  * DHCP (isc-dhcp-server)\n  * DNS (powerdns)\n  * NTP (ntpd)\n  * Kerberos (MIT kerberos)\n  * webservices (PenatesServer)\n  * pkinit for users\n\nProcesses\n---------\n\n  * a new machine is installed:\n  \n    * register itself (create Kerberos principal, private key, certificate, PTR DNS record, A/AAAA DNS record, SSHFP DNS record) and get a host keytab\n        GET https://directory01.{{ domain }}/no-auth/get_host_keytab/<hostname>\n    * get private key and certificate\n        GET https://directory01.{{ domain }}/auth/get_host_certificate/\n    * register SSH keys\n        POST https://directory01.{{ domain }}/auth/set_ssh_pub/\n    * register its MAC address with its (primary) IP address\n        GET https://directory01.{{ domain }}/auth/set_dhcp/<mac_address>/\n\n  * a new service is installed:\n   \n    * register itself (protocol://hostname:port/) with a description, register CNAME and SRV DNS records\n        GET https://directory01.{{ domain }}/auth/set_service/<scheme>/<hostname>/<port>/?keytab=<HTTP>&protocol=udp\n    * get private key and certificate\n        GET https://directory01.{{ domain }}/auth/get_service_certificate/<scheme>/<hostname>/<port>/?protocol=udp\n    * get keytab\n        GET https://directory01.{{ domain }}/auth/get_service_keytab/<scheme>/<hostname>/<port>/?protocol=udp\n    \n  * register a foreign domain name:\n        GET https://directory01.{{ domain }}/auth/set_extra_service/<hostname><?ip=<ip>\n    \n  * a new user is created by admin:\n  \n    * create password\n    * create certificate (email, authent)\n    * create ssh public key\n    * create private key\n\n\nTODO\n====\n\nStep 1\n------\n\n  * [OK] IP fixe\n  * [OK] set machine keytab/certificate/rsa ssh key\n  * [OK] NTP\n    * crypto authentication\n  * [OK] A/AAAA external records\n  * [OK] user creation\n  * [OK] group creation\n  * [OK] set user password\n  * [OK] get self certificate\n  * [OK] pkinit : kinit -X \"X509_user_identity=FILE:${cert}\" ${principal}  ; kinit -C FILE:${cert} ${principal}\n  * [OK] tests pour chaque \u00e9tape\n  * [OK] DANE\n  * [OK] DNSSEC\n  * SMTP\n    * [OK] syst\u00e8me (sans auth mais local uniquement)\n    * [OK] utilisateur (ldap)\n    * [OK] spamassassin\n    * [OK] dkim\n    * [OK] spf\n    * clamav\n    * utilisateur (kerberos)\n    \n  * [OK] IMAP4\n    * [OK] utilisateur (ldap)\n    * [OK] utilisateur (kerberos)\n\n  * [OK] kerberos authent on machines\n  * [OK] revoke certificate\n  * [OK] sudo for admins\n  * [OK] LDAP autz on machines (netgroups)\n  * utiliser DNSSEC\n  * external DNS config\n\nStep 2\n------\n\n  * fail2ban\n    * [OK] ssh\n    * [OK] dovecot\n    * opensmtpd\n    * kerberos\n  * [OK] logging\n    * [OK] centralization\n    * [OK] >= warning\n    * [OK] logrotate\n  * [OK] snmpd\n  * [OK] nrpe\n  * rkhunter\n  * [OK] ISO generation\n    * [OK] login\n    * [OK] name\n    * [OK] password1\n    * [OK] password2\n    * [OK] encrypt home\n    * [OK] configure LVM?\n  * [OK] CA generation\n  * supervision\n    * [OK] shinken\n    * [OK] nrpe\n    * graphite ?\n    * snmp ?\n\n  * [OK] TFTP server\n  * [OK] ubuntu mirror\n  * [OK] moneta mirror\n  * pypi mirror\n\nStep 3\n------\n\n  * [OK] XML profiles for iOS / OS X\n  * [OK] XMPP\n  * [OK] proxy HTTP + kerberos\n\nStep 4\n------\n\n  * [OK] Plex\n  * Seafile\n  * IRC bouncer\n  * IRC server\n  \n\nStep 5\n------\n\n  * Gitlab\n  * CardDAV & CalDAV\n  * Updoc\n  * Vagrant mirror\n  * Pypi mirror\n  * Asterisk\n  * Readthedocs\n  * iPython Notebook\n  \nStep 6\n------\n\n  * backup\n  * restauration depuis le backup\n  * VPN\n  * 802.1x\n  \nStep 7\n------\n\n  * cr\u00e9ation de packages Debian de fa\u00e7on automatique pour :\n\n    * plugins Shinken\n    * penatesserver\n    * updoc\n    * moneta\n    * pycharm\n    * intellij\n\nStep 8\n------\n\n  * infrastucture secondaire (LDAP, Kerberos, DNS, DHCP, NTP, SMTP)\n  * analyse de logs\n\nTODO\n----\n\n  * r\u00e9cup\u00e9ration de la conf pour les DNS secondaires\n  * ajouter un password admin sur penatesserver (header/get ?)\n  \n  * serveur d'installation :\n  \n    * DHCP\n    * miroir Ubuntu\n    * miroir Moneta pour les paquets suppl\u00e9mentaires\n    * serveur TFTP\n    * g\u00e9n\u00e9ration des clefs\n    \n  * poste d'administration\n  * remove machine\n  * remove service\n  * remove external service\n  * disable user\n  \n  \nKerberos Heimdal : backend LDAP -> bug dans Heimdal 1.6\nMail : remplacer opensmtpd par postfix + kerberos\n\nPour chaque service :\n\n  * [OK] check nrpe pour v\u00e9rifier que le process existe (1/h)\n  * [OK] check nrpe pour la validit\u00e9 du certificat (1/j)\n  * check nrpe pour la validit\u00e9 du keytab (+ groupe) (1/j)\n  * check nrpe firewall ouvert pour le port (1/j)\n  * check pour la qualit\u00e9 du SSL (1/j)\n  * enregistrement aupr\u00e8s de PenatesServer\n  * sauvegarde dans /var/backups\n  * logs dans syslog en ERROR\n  * fail2ban\n  * r\u00e9cup\u00e9ration de la sauvegarde \u00e0 l'installation (+cr\u00e9ation d'un fichier pour ne le faire qu'une fois)\n\nNotes\n-----\n\n  ldapsearch -x '(&(objectClass=posixAccount)(memberof=cn=Administrators,ou=CoreGroups,dc=test,dc=example,dc=org))' -LLL\n  ldapsearch -x '(&(objectClass=posixAccount)(memberof=cn=Users,ou=CoreGroups,dc=test,dc=example,dc=org))' -LLL\n\n\nbootstrap\n=========\n\nDeux cas sont possibles pour l'initialisation :\n\n  * serveur DHCP, acc\u00e8s internet et machine avec ansible\n  * machine avec ansible uniquement, sans acc\u00e8s internet\n    \nDans tous les cas, il est n\u00e9cessaire de disposer d'une machine fonctionnelle avec Ubuntu. Cette machine sera \u00e9galement \nutilis\u00e9e pour servir de miroir Ubuntu dans le cas 2. De plus, dans le cas 2, il est n\u00e9cessaire de pr\u00e9voir un moyen de \nstockage externe qui servira aux transferts des mises \u00e0 jour.\n \n Proc\u00e9dure compl\u00e8te :\n  - pr\u00e9paration de la machine de bootstrap, qui contiendra les clefs\n \n  - `generate_ca.yml` : pr\u00e9pare les clefs publiques et priv\u00e9es, ainsi que les certificats\n  - `generate_iso.yml` : pr\u00e9pare l'image d'installation \n  - `bootstrap.yml` : pr\u00e9pare la machine d'abord connect\u00e9e \u00e0 l'ancien r\u00e9seau puis qui permettra de cr\u00e9er le nouveau \n\n      * cas 1) \n          * reg\u00e9n\u00e8re les diff\u00e9rents paquets tierce-partie\n          * installe Apache et fait un miroir Ubuntu avec les paquets tierce-partie\n      * cas 2) \n          * installe un serveur DHCP avec le netboot \n          * clone du miroir officiel Ubuntu (environ 700 Go \u00e0 t\u00e9l\u00e9charger)\n          * reg\u00e9n\u00e8re les diff\u00e9rents paquets tierce-partie\n          * installe Apache avec la copie du miroir et fait un miroir Ubuntu avec les paquets tierce-partie\n\n  - `common_pass_1.yml` \n  installation de la machine qui servira de serveur principal avec comme sources.list la machine de bootstrap\n  \n  - installation du serveur d'installation\n\nProc\u00e9dure de bootstrap\n----------------------\n\n  * cr\u00e9ation d'un miroir complet sur une clef USB\n  * mise en place d'un DHCP facultatif\n  * si la clef est pr\u00e9sente, on utilise ce miroir\n  * copie de la clef sur le miroir ubuntu quand il est d\u00e9fini\n  * miroir ubuntu sur internet ou clef USB", "description_content_type": null, "docs_url": null, "download_url": "UNKNOWN", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "UNKNOWN", "keywords": null, "license": "CeCILL-B", "maintainer": null, "maintainer_email": null, "name": "penates", "package_url": "https://pypi.org/project/penates/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/penates/", "project_urls": {"Download": "UNKNOWN", "Homepage": "UNKNOWN"}, "release_url": "https://pypi.org/project/penates/0.2.0/", "requires_dist": null, "requires_python": null, "summary": "Suite", "version": "0.2.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            Penates<br>=======<br><br>Group of Ansible tasks for configuring a basic private network with the following services:<br><br>  * PKI (openssl)<br>  * LDAP (openldap)<br>  * DHCP (isc-dhcp-server)<br>  * DNS (powerdns)<br>  * NTP (ntpd)<br>  * Kerberos (MIT kerberos)<br>  * webservices (PenatesServer)<br>  * pkinit for users<br><br>Processes<br>---------<br><br>  * a new machine is installed:<br>  <br>    * register itself (create Kerberos principal, private key, certificate, PTR DNS record, A/AAAA DNS record, SSHFP DNS record) and get a host keytab<br>        GET https://directory01.{{ domain }}/no-auth/get_host_keytab/&lt;hostname&gt;<br>    * get private key and certificate<br>        GET https://directory01.{{ domain }}/auth/get_host_certificate/<br>    * register SSH keys<br>        POST https://directory01.{{ domain }}/auth/set_ssh_pub/<br>    * register its MAC address with its (primary) IP address<br>        GET https://directory01.{{ domain }}/auth/set_dhcp/&lt;mac_address&gt;/<br><br>  * a new service is installed:<br>   <br>    * register itself (protocol://hostname:port/) with a description, register CNAME and SRV DNS records<br>        GET https://directory01.{{ domain }}/auth/set_service/&lt;scheme&gt;/&lt;hostname&gt;/&lt;port&gt;/?keytab=&lt;HTTP&gt;&amp;protocol=udp<br>    * get private key and certificate<br>        GET https://directory01.{{ domain }}/auth/get_service_certificate/&lt;scheme&gt;/&lt;hostname&gt;/&lt;port&gt;/?protocol=udp<br>    * get keytab<br>        GET https://directory01.{{ domain }}/auth/get_service_keytab/&lt;scheme&gt;/&lt;hostname&gt;/&lt;port&gt;/?protocol=udp<br>    <br>  * register a foreign domain name:<br>        GET https://directory01.{{ domain }}/auth/set_extra_service/&lt;hostname&gt;&lt;?ip=&lt;ip&gt;<br>    <br>  * a new user is created by admin:<br>  <br>    * create password<br>    * create certificate (email, authent)<br>    * create ssh public key<br>    * create private key<br><br><br>TODO<br>====<br><br>Step 1<br>------<br><br>  * [OK] IP fixe<br>  * [OK] set machine keytab/certificate/rsa ssh key<br>  * [OK] NTP<br>    * crypto authentication<br>  * [OK] A/AAAA external records<br>  * [OK] user creation<br>  * [OK] group creation<br>  * [OK] set user password<br>  * [OK] get self certificate<br>  * [OK] pkinit : kinit -X \"X509_user_identity=FILE:${cert}\" ${principal}  ; kinit -C FILE:${cert} ${principal}<br>  * [OK] tests pour chaque \u00e9tape<br>  * [OK] DANE<br>  * [OK] DNSSEC<br>  * SMTP<br>    * [OK] syst\u00e8me (sans auth mais local uniquement)<br>    * [OK] utilisateur (ldap)<br>    * [OK] spamassassin<br>    * [OK] dkim<br>    * [OK] spf<br>    * clamav<br>    * utilisateur (kerberos)<br>    <br>  * [OK] IMAP4<br>    * [OK] utilisateur (ldap)<br>    * [OK] utilisateur (kerberos)<br><br>  * [OK] kerberos authent on machines<br>  * [OK] revoke certificate<br>  * [OK] sudo for admins<br>  * [OK] LDAP autz on machines (netgroups)<br>  * utiliser DNSSEC<br>  * external DNS config<br><br>Step 2<br>------<br><br>  * fail2ban<br>    * [OK] ssh<br>    * [OK] dovecot<br>    * opensmtpd<br>    * kerberos<br>  * [OK] logging<br>    * [OK] centralization<br>    * [OK] &gt;= warning<br>    * [OK] logrotate<br>  * [OK] snmpd<br>  * [OK] nrpe<br>  * rkhunter<br>  * [OK] ISO generation<br>    * [OK] login<br>    * [OK] name<br>    * [OK] password1<br>    * [OK] password2<br>    * [OK] encrypt home<br>    * [OK] configure LVM?<br>  * [OK] CA generation<br>  * supervision<br>    * [OK] shinken<br>    * [OK] nrpe<br>    * graphite ?<br>    * snmp ?<br><br>  * [OK] TFTP server<br>  * [OK] ubuntu mirror<br>  * [OK] moneta mirror<br>  * pypi mirror<br><br>Step 3<br>------<br><br>  * [OK] XML profiles for iOS / OS X<br>  * [OK] XMPP<br>  * [OK] proxy HTTP + kerberos<br><br>Step 4<br>------<br><br>  * [OK] Plex<br>  * Seafile<br>  * IRC bouncer<br>  * IRC server<br>  <br><br>Step 5<br>------<br><br>  * Gitlab<br>  * CardDAV &amp; CalDAV<br>  * Updoc<br>  * Vagrant mirror<br>  * Pypi mirror<br>  * Asterisk<br>  * Readthedocs<br>  * iPython Notebook<br>  <br>Step 6<br>------<br><br>  * backup<br>  * restauration depuis le backup<br>  * VPN<br>  * 802.1x<br>  <br>Step 7<br>------<br><br>  * cr\u00e9ation de packages Debian de fa\u00e7on automatique pour :<br><br>    * plugins Shinken<br>    * penatesserver<br>    * updoc<br>    * moneta<br>    * pycharm<br>    * intellij<br><br>Step 8<br>------<br><br>  * infrastucture secondaire (LDAP, Kerberos, DNS, DHCP, NTP, SMTP)<br>  * analyse de logs<br><br>TODO<br>----<br><br>  * r\u00e9cup\u00e9ration de la conf pour les DNS secondaires<br>  * ajouter un password admin sur penatesserver (header/get ?)<br>  <br>  * serveur d'installation :<br>  <br>    * DHCP<br>    * miroir Ubuntu<br>    * miroir Moneta pour les paquets suppl\u00e9mentaires<br>    * serveur TFTP<br>    * g\u00e9n\u00e9ration des clefs<br>    <br>  * poste d'administration<br>  * remove machine<br>  * remove service<br>  * remove external service<br>  * disable user<br>  <br>  <br>Kerberos Heimdal : backend LDAP -&gt; bug dans Heimdal 1.6<br>Mail : remplacer opensmtpd par postfix + kerberos<br><br>Pour chaque service :<br><br>  * [OK] check nrpe pour v\u00e9rifier que le process existe (1/h)<br>  * [OK] check nrpe pour la validit\u00e9 du certificat (1/j)<br>  * check nrpe pour la validit\u00e9 du keytab (+ groupe) (1/j)<br>  * check nrpe firewall ouvert pour le port (1/j)<br>  * check pour la qualit\u00e9 du SSL (1/j)<br>  * enregistrement aupr\u00e8s de PenatesServer<br>  * sauvegarde dans /var/backups<br>  * logs dans syslog en ERROR<br>  * fail2ban<br>  * r\u00e9cup\u00e9ration de la sauvegarde \u00e0 l'installation (+cr\u00e9ation d'un fichier pour ne le faire qu'une fois)<br><br>Notes<br>-----<br><br>  ldapsearch -x '(&amp;(objectClass=posixAccount)(memberof=cn=Administrators,ou=CoreGroups,dc=test,dc=example,dc=org))' -LLL<br>  ldapsearch -x '(&amp;(objectClass=posixAccount)(memberof=cn=Users,ou=CoreGroups,dc=test,dc=example,dc=org))' -LLL<br><br><br>bootstrap<br>=========<br><br>Deux cas sont possibles pour l'initialisation :<br><br>  * serveur DHCP, acc\u00e8s internet et machine avec ansible<br>  * machine avec ansible uniquement, sans acc\u00e8s internet<br>    <br>Dans tous les cas, il est n\u00e9cessaire de disposer d'une machine fonctionnelle avec Ubuntu. Cette machine sera \u00e9galement <br>utilis\u00e9e pour servir de miroir Ubuntu dans le cas 2. De plus, dans le cas 2, il est n\u00e9cessaire de pr\u00e9voir un moyen de <br>stockage externe qui servira aux transferts des mises \u00e0 jour.<br> <br> Proc\u00e9dure compl\u00e8te :<br>  - pr\u00e9paration de la machine de bootstrap, qui contiendra les clefs<br> <br>  - `generate_ca.yml` : pr\u00e9pare les clefs publiques et priv\u00e9es, ainsi que les certificats<br>  - `generate_iso.yml` : pr\u00e9pare l'image d'installation <br>  - `bootstrap.yml` : pr\u00e9pare la machine d'abord connect\u00e9e \u00e0 l'ancien r\u00e9seau puis qui permettra de cr\u00e9er le nouveau <br><br>      * cas 1) <br>          * reg\u00e9n\u00e8re les diff\u00e9rents paquets tierce-partie<br>          * installe Apache et fait un miroir Ubuntu avec les paquets tierce-partie<br>      * cas 2) <br>          * installe un serveur DHCP avec le netboot <br>          * clone du miroir officiel Ubuntu (environ 700 Go \u00e0 t\u00e9l\u00e9charger)<br>          * reg\u00e9n\u00e8re les diff\u00e9rents paquets tierce-partie<br>          * installe Apache avec la copie du miroir et fait un miroir Ubuntu avec les paquets tierce-partie<br><br>  - `common_pass_1.yml` <br>  installation de la machine qui servira de serveur principal avec comme sources.list la machine de bootstrap<br>  <br>  - installation du serveur d'installation<br><br>Proc\u00e9dure de bootstrap<br>----------------------<br><br>  * cr\u00e9ation d'un miroir complet sur une clef USB<br>  * mise en place d'un DHCP facultatif<br>  * si la clef est pr\u00e9sente, on utilise ce miroir<br>  * copie de la clef sur le miroir ubuntu quand il est d\u00e9fini<br>  * miroir ubuntu sur internet ou clef USB\n          </div>"}, "last_serial": 1939230, "releases": {"0.2.0": [{"comment_text": "", "digests": {"md5": "0b188588003fe9dfff43fe3d7ef2d232", "sha256": "52bcb326e0f380a51b82bfed2a9f9cf20ce1499e229d494b15ce6aafabe0bf2e"}, "downloads": -1, "filename": "penates-0.2.0.tar.gz", "has_sig": false, "md5_digest": "0b188588003fe9dfff43fe3d7ef2d232", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15395, "upload_time": "2016-02-04T10:33:42", "upload_time_iso_8601": "2016-02-04T10:33:42.949921Z", "url": "https://files.pythonhosted.org/packages/bc/ee/d346f79858ba141879b52468c46581dd6995b09978aba1a2e2fd55a4f2d5/penates-0.2.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "0b188588003fe9dfff43fe3d7ef2d232", "sha256": "52bcb326e0f380a51b82bfed2a9f9cf20ce1499e229d494b15ce6aafabe0bf2e"}, "downloads": -1, "filename": "penates-0.2.0.tar.gz", "has_sig": false, "md5_digest": "0b188588003fe9dfff43fe3d7ef2d232", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15395, "upload_time": "2016-02-04T10:33:42", "upload_time_iso_8601": "2016-02-04T10:33:42.949921Z", "url": "https://files.pythonhosted.org/packages/bc/ee/d346f79858ba141879b52468c46581dd6995b09978aba1a2e2fd55a4f2d5/penates-0.2.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 02:56:35 2020"}