{"info": {"author": "Simon Delamare", "author_email": "simon.delamare@ens-lyon.fr", "bugtrack_url": null, "classifiers": ["License :: OSI Approved :: MIT License", "Programming Language :: Python :: 3"], "description": "# Introduction\n\nKwollect is a framework for collecting metrics of IT infrastructures\n(performance, environmental, ...) and make them available to users.\n\nKwollect targets high frequency collection with lossless & long term storage of\nmetrics and focuses on out-of-band metrics: those not available from computers\noperating systems, but outside: sensors from PDUs, network devices, BMCs,\netc.\n\nKwollect is designed for integration with Job Schedulers, for instance when\ndeployed in High Performance Computing datacenters.\n\n\n## Design Overview\n\nKwollect is a framework more than an individual software: It uses as many as\n\"on the shelf\" components as possible.\n\nIn particular, it relies on a PostgreSQL database (with the TimescaleDB\nextension) to store every metrics, provides the user API, and deal with the\nbackend \"logic\".\n\nSome independent programs, called *kwollector*, collects the metrics from\nvarious devices and store them in the database (currently supported protocols\nare: SNMP, IPMI sensors, OmegaWatt wattmetre).\n\n\n# Usage\n\n## Metrics format\n\nEach metric data is associated with this information:\n- *timestamp*: The date of the measurement\n- *device_id*: The identifier of the device that is being measured\n- *metric_id*: The name of the metric being measured\n- *value*: The value of the metric when measurement is performed\n- *labels*: Some arbitrary additional values, as JSON (e.g. an alternative name\n  for the device)\n\n\n## Querying metrics values\n\nKwollect provides an API to retrieve collected metrics:\n\n```\ncurl 'http://kwollect.host:3000/rpc/get_metrics?devices=node-1,node-2&start_time=2020-01-06T13:35:00&end_time=2020-01-06T14:35:00'\n```\n\nIt also provides a graphical view of metrics.\n\nAs it uses a PostgreSQL database, regular SQL queries can be used:\n\n```\nSELECT timestamp, device_id, metrics_id, values\n  FROM metrics_by_device\n  WHERE device_id = 'node-1' AND timestamp > now() - interval '1 hour';\n```\n\n## Inserting metrics values\n\nIn addition to the use of *kwollectors*, it is possible to manually insert so\nmetrics using the API:\n\n```\ncurl http://kwollect.host:3000/rpc/insert_metrics \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H 'content-type: application/json' \\\n  -d '{\"timestamp\": \"2020-01-06 14:00:00\", \"device_id\": \"node-1\", \"metric_id\": \"example_metric\", \"value\": 42}'\n```\n\nInsertion requires the user to authenticate by providing an API token inside\n`$TOKEN` variable (see API section below)\n\nIt is also possible to insert multiple metrics at a time:\n\n```\ncurl http://kwollect.host:3000/rpc/insert_metrics \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H 'content-type: application/json' \\\n  -d '[\n  {\"device_id\": \"node-2\", \"metric_id\": \"example_metric1\", \"value\": 42},\n  {\"device_id\": \"node-2\", \"metric_id\": \"example_metric2\", \"value\": 22}\n  ]'\n```\n\nAn insertion may also be done using SQL under *metrics* table:\n\n```\nINSERT INTO metrics(timestamp, device_id, metric_id, value, labels)\n  VALUES ('2020-01-06 14:00:00', 'node-3', 'example_metric', 42, '{\"_device_alias\": \"node-3-admin\"}')\n```\n\n\n# Installation\n\n## Kwollect package\n\nThe kwollect package contains kwollector programs and database setup scripts. To install it, use:\n\n```\npip3 install kwollect\n```\n(a Debian [package is also available](http://graal.ens-lyon.fr/~sdelamar/data/kwollect_0.0.U_amd64.deb))\n\n\n## Database\n\nKwollect needs a [PostgreSQL](https://www.postgresql.org/) database with\n[TimescaleDB](https://www.timescale.com/) extension to store metrics.\n\nFor example, use these commands to install them on Debian Buster:\n\n```\nsudo sh -c \"echo 'deb https://packagecloud.io/timescale/timescaledb/debian/ `lsb_release -c -s` main' > /etc/apt/sources.list.d/timescaledb.list\"\nwget --quiet -O - https://packagecloud.io/timescale/timescaledb/gpgkey | sudo apt-key add -\nsudo apt update\nsudo apt-get install -y postgresql postgresql-client timescaledb-postgresql-11 postgresql-plpython3-11\n\n# TimescaleDB comes with a script to tune Postgres configuration that you might want to use:\nsudo cp /etc/postgresql/11/main/postgresql.conf /etc/postgresql/11/main/postgresql.conf-timescaledb_tune.backup\nsudo timescaledb-tune -yes -quiet\necho 'timescaledb.telemetry_level=off' | sudo tee -a /etc/postgresql/11/main/postgresql.conf\nsudo systemctl restart postgresql\n```\n\nThen, you can setup Kwollect database using the `kwollect-setup-db` tool. It is\nrequired to connect to the database with administrator privileges. For instance:\n\n```\nsudo su postgres -s /bin/sh -c \"kwollect-setup-db --kwollect_password changeme\"\n```\n\nSee `kwollect-setup-db --help` for more options. In particular,\n*chunk_interval_hour* should be chosen such as all metrics collected during\nthis period, in hours, fits in the memory available to Postgres (about one quarter\nof the entire memory, provided that one metric needs 200 bytes approx.)\n\n\n## API\n\nTo provide an HTTP API to users to get metrics collected, kwollect uses\n[Postgrest](http://postgrest.org).\n\nThese commands may be used to install Postgrest (see website for more info).\n```\nwget https://github.com/PostgREST/postgrest/releases/download/v6.0.2/postgrest-v6.0.2-linux-x64-static.tar.xz -O /tmp/postgrest.txz\ncd /tmp\ntar xf postgrest.txz\nchmod +x ./postgrest\nsudo mv ./postgrest /usr/local/bin/\n```\n\nPostgrest needs a configuration file. A working configuration file is given by\n*kwollector-setup-db* output. It looks like:\n\n```\ndb-uri = \"postgres://<db_user>:<db_pass>@<db_host>/<db_name>\"\ndb-schema = \"api\"\ndb-anon-role = \"kwuser_ro\"\njwt-secret = \"changemechangemechangemechangemechangeme\"\n```\n\n(See Postgrest documentation for the options meaning, but no change should be needed).\n\n*kwollector-setup-db* also outputs an *API token* that is needed to perform\nwrite access to the database.\n\nFinally, don't forget to start Postgres with `postgrest\n<path_to_configuration_file>`\n\n\n## Kwollector\n\nThe *kwollector* program collects metrics and stores them in the database. It\nmay run on a any host (provided it can communicate with the database and devices to\nmonitor).\n\n*kwollector* is available in the kwollect package. Start it with:\n\n```\nkwollector <path_to_configuration_file>\n```\n(a systemd `kwollector.service` file is included in the debian package)\n\n\nkwollector configuration file should contain:\n\n```\n# Path to directory containing metrics description\nmetrics_dir: /etc/kwollect/metrics.d/\n\n# Hostname of postgresql server\ndb_host: localhost \n\n# Database name\ndb_name: kwdb\n\n# Database user\ndb_user: kwuser\n\n# Database password\ndb_password: changeme\n\n# Log level\nlog_level: warning\n```\n(option may also be given on the command line, see `kwollector --help`)\n\n\n### Description of the metrics to fetch\n\nMetrics are described inside yaml files under `<metrics_dir>` directory\n(`/etc/kwollect/metrics.d/` by default). For instance, you may have one file per\ndevice containing all metrics to fetch on it.\n\nHere is an example of file content for describing metrics of a device *node-1*:\n\n```\n- name: idrac_power_watth_total\n  device_id: node-1\n  url: snmp://public@node-1-admin.domain.com/1.3.6.1.4.1.674.10892.5.4.600.60.1.7.1.1\n  update_every: 5000\n\n- name: idrac_power_watt\n  device_id: taurus-1\n  url: snmp://public@node-1-admin.domain.com/1.3.6.1.4.1.674.10892.5.4.600.30.1.6.1.3\n  update_every: 5000\n```\n\nEach metric should be described with:\n```\n- name:\n  device_id:\n  url:\n  update_every:\n  device_alias:\n  optional:\n```\n\nWhere:\n\n- `name` is an unique identifier for this metric (which may be used by several devices)\n\n- `device_id` is an identifier for the device from which the metric is collected\n\n- `url` specifies how and where to get the metric. Currently, SNMP and IPMI protocols are supported.\n  - For SNMP, `url` must be in the form `snmp://<community>@<host_address>/<oid>`. For instance:\n\n    `snmp://public@node-1-admin.domain.com/1.3.6.1.4.1.674.10892.5.4.600.30.1.6.1.3`\n\n  - For IPMI, `url` must be in the form\n    `ipmisensor://<user>:<password>@<host_address>/<id>`, where *user* and\n    *password* are credentials needed to connect to the device using IPMI\n    protocol, and *id* is the ID of the sensor to collect (as in the output of\n    `ipmi-sensor` command). For instance:\n\n    `url: ipmisensor://root:calvin@node-1-adminn.domain.com/20`\n\n    **IPMI protocol needs ipmi-sensor command to be available** (on a Debian\n    system, it is available in `freeipmi-tools` package)\n\n- *Optional* `update_every` specifies the interval between two successive\n  fetch for this metric. Default is 10 seconds.\n\n- *Optional* `device_alias` may be used to record an alternative name for this\n  metric's device (for instance, if you collect a metric related to a port on a\n  network device, you may want to use the device connected to this port as a\n  device alias)`\n\n- *Optional* `optional` field must be set to *true* if you don't want this metrics to be\n  collected by default (see bellow)\n\n\n\n\n## Graphical interface\n\nTODO\n\n\n# Advanced topics\n\n## Job scheduler integration\n\nKwollect may be associated to a [Job\nScheduler](https://en.wikipedia.org/wiki/Job_scheduler) to retrieve metrics\nassociated to a particular job.\n\nTo enable job scheduler integration, it is only needed to fill the\n`nodetime_per_job` view in Kwollect's PostgreSQL database. The view should return\nSQL data formatted as:\n\n```\n+------------+--------------------------+\n| Column     | Type                     |\n|------------+--------------------------+\n| job_id     | integer                  |\n| start_time | timestamp with time zone |\n| stop_time  | timestamp with time zone |\n| node       | text                     |\n+------------+--------------------------+\n```\n\nUsing one line for each *node* (which will be used as *device_id* to retrieve\nmetrics) involved in the job *job_id* which started at *start_time* and ended\nat *end_time* (`NULL` if the job is still running).\n\nWe provide such integration for the OAR job scheduler, where\n`nodetime_per_job` is automatically filled by querying the OAR database. The\n`kwollect-setup-db-oar` tool is available to perform the setup.\n\nWith `nodetime_per_job` correctly filled, it becomes possible to perform\nrequests on `metrics_by_job`, e.g.:\n\n```\nSELECT timestamp, device_id, metric_id, value FROM metrics_by_job WHERE job_id = 1234;\n```\n\nIt is also possible to provide the \"job_id\" argument when calling API:\n\n```\ncurl http://kwollect.host:3000/rpc/get_metrics -X POST -d 'job_id=1234'\n```\n\n\n## Optional metrics\n\nKwollect handles collecting some metrics \"on-demand\", for instance for metrics\nthat don't need to be collected anytime.\n\nThese metrics must be configured in kwollector using the *optional: true*\nparameter.\n\nSuch optional metric will only be collected for a particular device if the\ncorresponding *device_id* is present in the `promoted_metrics` table of the\nKwollect database.\n\nThis table can be filled according to specific needs (for instance, if Kwollect\nis integrated with a job scheduler, it can be configured to only collect\noptional metrics for devices associated to some specifically tagged jobs)\n\n(TODO: meilleur exemple, API, revoir format promoted_metrics)\n\n\n## Wattmetre\n\nA specific kwollector, called *kwollector-wattmetre*, is available to read and\nstore values from OmegaWatt wattmetre. It simply reads [output of OmegaWatt\nwattmetre reading program](https://gitlab.inria.fr/delamare/wattmetre-read) and\nstores values in the database. For instance in can be invoked with:\n\n```\nwattmetre-read /dev/ttyUSB0 42 20 | kwollector-wattmetre <path_to_configuration_file>\n```\n\nkwollector-wattmetre configuration file should contain:\n\n```\n# Wattmetre identifier, used as 'device_id'\nwattmetre_id: wattmetre\n\n# Path to optional wattmetre mapping file, see below\nmapping_file_path: ''\n\n# Credentials for DB connection, see kwollector documentation above\ndb_name: kwdb\ndb_user: kwuser\ndb_password: changeme\ndb_host: localhost\n\n# Log level\nlog_level: warning\n```\n(option may also be given on the command line, see `kwollector-wattmetre --help`)\n\nA wattmetre mapping file, describing devices connected to each port of the\nwattmetre, may be provided to associate metrics collected from a wattmetre port\nto the corresponding device. The file should contain one `device_id:\n[wattmetre_id-portX, wattmetre_id-portY]` line per device, containing the\ndevice identifier followed by the list of wattmetres and ports which power it.\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://gitlab.inria.fr/delamare/kwollect", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "kwollect", "package_url": "https://pypi.org/project/kwollect/", "platform": "", "project_url": "https://pypi.org/project/kwollect/", "project_urls": {"Homepage": "https://gitlab.inria.fr/delamare/kwollect"}, "release_url": "https://pypi.org/project/kwollect/0.0.3/", "requires_dist": ["PyJWT", "aiopg", "psycopg2-binary", "pyonf", "pysnmp", "pyyaml"], "requires_python": ">=3.7", "summary": "Kwollect framework for metrics collection", "version": "0.0.3", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>Introduction</h1>\n<p>Kwollect is a framework for collecting metrics of IT infrastructures\n(performance, environmental, ...) and make them available to users.</p>\n<p>Kwollect targets high frequency collection with lossless &amp; long term storage of\nmetrics and focuses on out-of-band metrics: those not available from computers\noperating systems, but outside: sensors from PDUs, network devices, BMCs,\netc.</p>\n<p>Kwollect is designed for integration with Job Schedulers, for instance when\ndeployed in High Performance Computing datacenters.</p>\n<h2>Design Overview</h2>\n<p>Kwollect is a framework more than an individual software: It uses as many as\n\"on the shelf\" components as possible.</p>\n<p>In particular, it relies on a PostgreSQL database (with the TimescaleDB\nextension) to store every metrics, provides the user API, and deal with the\nbackend \"logic\".</p>\n<p>Some independent programs, called <em>kwollector</em>, collects the metrics from\nvarious devices and store them in the database (currently supported protocols\nare: SNMP, IPMI sensors, OmegaWatt wattmetre).</p>\n<h1>Usage</h1>\n<h2>Metrics format</h2>\n<p>Each metric data is associated with this information:</p>\n<ul>\n<li><em>timestamp</em>: The date of the measurement</li>\n<li><em>device_id</em>: The identifier of the device that is being measured</li>\n<li><em>metric_id</em>: The name of the metric being measured</li>\n<li><em>value</em>: The value of the metric when measurement is performed</li>\n<li><em>labels</em>: Some arbitrary additional values, as JSON (e.g. an alternative name\nfor the device)</li>\n</ul>\n<h2>Querying metrics values</h2>\n<p>Kwollect provides an API to retrieve collected metrics:</p>\n<pre><code>curl 'http://kwollect.host:3000/rpc/get_metrics?devices=node-1,node-2&amp;start_time=2020-01-06T13:35:00&amp;end_time=2020-01-06T14:35:00'\n</code></pre>\n<p>It also provides a graphical view of metrics.</p>\n<p>As it uses a PostgreSQL database, regular SQL queries can be used:</p>\n<pre><code>SELECT timestamp, device_id, metrics_id, values\n  FROM metrics_by_device\n  WHERE device_id = 'node-1' AND timestamp &gt; now() - interval '1 hour';\n</code></pre>\n<h2>Inserting metrics values</h2>\n<p>In addition to the use of <em>kwollectors</em>, it is possible to manually insert so\nmetrics using the API:</p>\n<pre><code>curl http://kwollect.host:3000/rpc/insert_metrics \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H 'content-type: application/json' \\\n  -d '{\"timestamp\": \"2020-01-06 14:00:00\", \"device_id\": \"node-1\", \"metric_id\": \"example_metric\", \"value\": 42}'\n</code></pre>\n<p>Insertion requires the user to authenticate by providing an API token inside\n<code>$TOKEN</code> variable (see API section below)</p>\n<p>It is also possible to insert multiple metrics at a time:</p>\n<pre><code>curl http://kwollect.host:3000/rpc/insert_metrics \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H 'content-type: application/json' \\\n  -d '[\n  {\"device_id\": \"node-2\", \"metric_id\": \"example_metric1\", \"value\": 42},\n  {\"device_id\": \"node-2\", \"metric_id\": \"example_metric2\", \"value\": 22}\n  ]'\n</code></pre>\n<p>An insertion may also be done using SQL under <em>metrics</em> table:</p>\n<pre><code>INSERT INTO metrics(timestamp, device_id, metric_id, value, labels)\n  VALUES ('2020-01-06 14:00:00', 'node-3', 'example_metric', 42, '{\"_device_alias\": \"node-3-admin\"}')\n</code></pre>\n<h1>Installation</h1>\n<h2>Kwollect package</h2>\n<p>The kwollect package contains kwollector programs and database setup scripts. To install it, use:</p>\n<pre><code>pip3 install kwollect\n</code></pre>\n<p>(a Debian <a href=\"http://graal.ens-lyon.fr/%7Esdelamar/data/kwollect_0.0.U_amd64.deb\" rel=\"nofollow\">package is also available</a>)</p>\n<h2>Database</h2>\n<p>Kwollect needs a <a href=\"https://www.postgresql.org/\" rel=\"nofollow\">PostgreSQL</a> database with\n<a href=\"https://www.timescale.com/\" rel=\"nofollow\">TimescaleDB</a> extension to store metrics.</p>\n<p>For example, use these commands to install them on Debian Buster:</p>\n<pre><code>sudo sh -c \"echo 'deb https://packagecloud.io/timescale/timescaledb/debian/ `lsb_release -c -s` main' &gt; /etc/apt/sources.list.d/timescaledb.list\"\nwget --quiet -O - https://packagecloud.io/timescale/timescaledb/gpgkey | sudo apt-key add -\nsudo apt update\nsudo apt-get install -y postgresql postgresql-client timescaledb-postgresql-11 postgresql-plpython3-11\n\n# TimescaleDB comes with a script to tune Postgres configuration that you might want to use:\nsudo cp /etc/postgresql/11/main/postgresql.conf /etc/postgresql/11/main/postgresql.conf-timescaledb_tune.backup\nsudo timescaledb-tune -yes -quiet\necho 'timescaledb.telemetry_level=off' | sudo tee -a /etc/postgresql/11/main/postgresql.conf\nsudo systemctl restart postgresql\n</code></pre>\n<p>Then, you can setup Kwollect database using the <code>kwollect-setup-db</code> tool. It is\nrequired to connect to the database with administrator privileges. For instance:</p>\n<pre><code>sudo su postgres -s /bin/sh -c \"kwollect-setup-db --kwollect_password changeme\"\n</code></pre>\n<p>See <code>kwollect-setup-db --help</code> for more options. In particular,\n<em>chunk_interval_hour</em> should be chosen such as all metrics collected during\nthis period, in hours, fits in the memory available to Postgres (about one quarter\nof the entire memory, provided that one metric needs 200 bytes approx.)</p>\n<h2>API</h2>\n<p>To provide an HTTP API to users to get metrics collected, kwollect uses\n<a href=\"http://postgrest.org\" rel=\"nofollow\">Postgrest</a>.</p>\n<p>These commands may be used to install Postgrest (see website for more info).</p>\n<pre><code>wget https://github.com/PostgREST/postgrest/releases/download/v6.0.2/postgrest-v6.0.2-linux-x64-static.tar.xz -O /tmp/postgrest.txz\ncd /tmp\ntar xf postgrest.txz\nchmod +x ./postgrest\nsudo mv ./postgrest /usr/local/bin/\n</code></pre>\n<p>Postgrest needs a configuration file. A working configuration file is given by\n<em>kwollector-setup-db</em> output. It looks like:</p>\n<pre><code>db-uri = \"postgres://&lt;db_user&gt;:&lt;db_pass&gt;@&lt;db_host&gt;/&lt;db_name&gt;\"\ndb-schema = \"api\"\ndb-anon-role = \"kwuser_ro\"\njwt-secret = \"changemechangemechangemechangemechangeme\"\n</code></pre>\n<p>(See Postgrest documentation for the options meaning, but no change should be needed).</p>\n<p><em>kwollector-setup-db</em> also outputs an <em>API token</em> that is needed to perform\nwrite access to the database.</p>\n<p>Finally, don't forget to start Postgres with <code>postgrest &lt;path_to_configuration_file&gt;</code></p>\n<h2>Kwollector</h2>\n<p>The <em>kwollector</em> program collects metrics and stores them in the database. It\nmay run on a any host (provided it can communicate with the database and devices to\nmonitor).</p>\n<p><em>kwollector</em> is available in the kwollect package. Start it with:</p>\n<pre><code>kwollector &lt;path_to_configuration_file&gt;\n</code></pre>\n<p>(a systemd <code>kwollector.service</code> file is included in the debian package)</p>\n<p>kwollector configuration file should contain:</p>\n<pre><code># Path to directory containing metrics description\nmetrics_dir: /etc/kwollect/metrics.d/\n\n# Hostname of postgresql server\ndb_host: localhost \n\n# Database name\ndb_name: kwdb\n\n# Database user\ndb_user: kwuser\n\n# Database password\ndb_password: changeme\n\n# Log level\nlog_level: warning\n</code></pre>\n<p>(option may also be given on the command line, see <code>kwollector --help</code>)</p>\n<h3>Description of the metrics to fetch</h3>\n<p>Metrics are described inside yaml files under <code>&lt;metrics_dir&gt;</code> directory\n(<code>/etc/kwollect/metrics.d/</code> by default). For instance, you may have one file per\ndevice containing all metrics to fetch on it.</p>\n<p>Here is an example of file content for describing metrics of a device <em>node-1</em>:</p>\n<pre><code>- name: idrac_power_watth_total\n  device_id: node-1\n  url: snmp://public@node-1-admin.domain.com/1.3.6.1.4.1.674.10892.5.4.600.60.1.7.1.1\n  update_every: 5000\n\n- name: idrac_power_watt\n  device_id: taurus-1\n  url: snmp://public@node-1-admin.domain.com/1.3.6.1.4.1.674.10892.5.4.600.30.1.6.1.3\n  update_every: 5000\n</code></pre>\n<p>Each metric should be described with:</p>\n<pre><code>- name:\n  device_id:\n  url:\n  update_every:\n  device_alias:\n  optional:\n</code></pre>\n<p>Where:</p>\n<ul>\n<li>\n<p><code>name</code> is an unique identifier for this metric (which may be used by several devices)</p>\n</li>\n<li>\n<p><code>device_id</code> is an identifier for the device from which the metric is collected</p>\n</li>\n<li>\n<p><code>url</code> specifies how and where to get the metric. Currently, SNMP and IPMI protocols are supported.</p>\n<ul>\n<li>\n<p>For SNMP, <code>url</code> must be in the form <code>snmp://&lt;community&gt;@&lt;host_address&gt;/&lt;oid&gt;</code>. For instance:</p>\n<p><code>snmp://public@node-1-admin.domain.com/1.3.6.1.4.1.674.10892.5.4.600.30.1.6.1.3</code></p>\n</li>\n<li>\n<p>For IPMI, <code>url</code> must be in the form\n<code>ipmisensor://&lt;user&gt;:&lt;password&gt;@&lt;host_address&gt;/&lt;id&gt;</code>, where <em>user</em> and\n<em>password</em> are credentials needed to connect to the device using IPMI\nprotocol, and <em>id</em> is the ID of the sensor to collect (as in the output of\n<code>ipmi-sensor</code> command). For instance:</p>\n<p><code>url: ipmisensor://root:calvin@node-1-adminn.domain.com/20</code></p>\n<p><strong>IPMI protocol needs ipmi-sensor command to be available</strong> (on a Debian\nsystem, it is available in <code>freeipmi-tools</code> package)</p>\n</li>\n</ul>\n</li>\n<li>\n<p><em>Optional</em> <code>update_every</code> specifies the interval between two successive\nfetch for this metric. Default is 10 seconds.</p>\n</li>\n<li>\n<p><em>Optional</em> <code>device_alias</code> may be used to record an alternative name for this\nmetric's device (for instance, if you collect a metric related to a port on a\nnetwork device, you may want to use the device connected to this port as a\ndevice alias)`</p>\n</li>\n<li>\n<p><em>Optional</em> <code>optional</code> field must be set to <em>true</em> if you don't want this metrics to be\ncollected by default (see bellow)</p>\n</li>\n</ul>\n<h2>Graphical interface</h2>\n<p>TODO</p>\n<h1>Advanced topics</h1>\n<h2>Job scheduler integration</h2>\n<p>Kwollect may be associated to a <a href=\"https://en.wikipedia.org/wiki/Job_scheduler\" rel=\"nofollow\">Job\nScheduler</a> to retrieve metrics\nassociated to a particular job.</p>\n<p>To enable job scheduler integration, it is only needed to fill the\n<code>nodetime_per_job</code> view in Kwollect's PostgreSQL database. The view should return\nSQL data formatted as:</p>\n<pre><code>+------------+--------------------------+\n| Column     | Type                     |\n|------------+--------------------------+\n| job_id     | integer                  |\n| start_time | timestamp with time zone |\n| stop_time  | timestamp with time zone |\n| node       | text                     |\n+------------+--------------------------+\n</code></pre>\n<p>Using one line for each <em>node</em> (which will be used as <em>device_id</em> to retrieve\nmetrics) involved in the job <em>job_id</em> which started at <em>start_time</em> and ended\nat <em>end_time</em> (<code>NULL</code> if the job is still running).</p>\n<p>We provide such integration for the OAR job scheduler, where\n<code>nodetime_per_job</code> is automatically filled by querying the OAR database. The\n<code>kwollect-setup-db-oar</code> tool is available to perform the setup.</p>\n<p>With <code>nodetime_per_job</code> correctly filled, it becomes possible to perform\nrequests on <code>metrics_by_job</code>, e.g.:</p>\n<pre><code>SELECT timestamp, device_id, metric_id, value FROM metrics_by_job WHERE job_id = 1234;\n</code></pre>\n<p>It is also possible to provide the \"job_id\" argument when calling API:</p>\n<pre><code>curl http://kwollect.host:3000/rpc/get_metrics -X POST -d 'job_id=1234'\n</code></pre>\n<h2>Optional metrics</h2>\n<p>Kwollect handles collecting some metrics \"on-demand\", for instance for metrics\nthat don't need to be collected anytime.</p>\n<p>These metrics must be configured in kwollector using the <em>optional: true</em>\nparameter.</p>\n<p>Such optional metric will only be collected for a particular device if the\ncorresponding <em>device_id</em> is present in the <code>promoted_metrics</code> table of the\nKwollect database.</p>\n<p>This table can be filled according to specific needs (for instance, if Kwollect\nis integrated with a job scheduler, it can be configured to only collect\noptional metrics for devices associated to some specifically tagged jobs)</p>\n<p>(TODO: meilleur exemple, API, revoir format promoted_metrics)</p>\n<h2>Wattmetre</h2>\n<p>A specific kwollector, called <em>kwollector-wattmetre</em>, is available to read and\nstore values from OmegaWatt wattmetre. It simply reads <a href=\"https://gitlab.inria.fr/delamare/wattmetre-read\" rel=\"nofollow\">output of OmegaWatt\nwattmetre reading program</a> and\nstores values in the database. For instance in can be invoked with:</p>\n<pre><code>wattmetre-read /dev/ttyUSB0 42 20 | kwollector-wattmetre &lt;path_to_configuration_file&gt;\n</code></pre>\n<p>kwollector-wattmetre configuration file should contain:</p>\n<pre><code># Wattmetre identifier, used as 'device_id'\nwattmetre_id: wattmetre\n\n# Path to optional wattmetre mapping file, see below\nmapping_file_path: ''\n\n# Credentials for DB connection, see kwollector documentation above\ndb_name: kwdb\ndb_user: kwuser\ndb_password: changeme\ndb_host: localhost\n\n# Log level\nlog_level: warning\n</code></pre>\n<p>(option may also be given on the command line, see <code>kwollector-wattmetre --help</code>)</p>\n<p>A wattmetre mapping file, describing devices connected to each port of the\nwattmetre, may be provided to associate metrics collected from a wattmetre port\nto the corresponding device. The file should contain one <code>device_id: [wattmetre_id-portX, wattmetre_id-portY]</code> line per device, containing the\ndevice identifier followed by the list of wattmetres and ports which power it.</p>\n\n          </div>"}, "last_serial": 6986806, "releases": {"0.0.1": [{"comment_text": "", "digests": {"md5": "f19d8b3edc9bf0663325e7fabe170025", "sha256": "4da6f35b2dcd3fca5b260899680e0fe4ebe970ff24f0de9122ee37fb01f8599a"}, "downloads": -1, "filename": "kwollect-0.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "f19d8b3edc9bf0663325e7fabe170025", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 17760, "upload_time": "2020-02-18T11:32:13", "upload_time_iso_8601": "2020-02-18T11:32:13.571795Z", "url": "https://files.pythonhosted.org/packages/e5/8c/d70332582a9f15ef4a508466ede96beb1ee2850c3a4d7d5079a907c637e0/kwollect-0.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "44acd6690783dd34cac7b7564a68d6f9", "sha256": "1e263182e44e4b689e7bff7ad98f343e14697aadd2278e0978f6dc90ff8c9c54"}, "downloads": -1, "filename": "kwollect-0.0.1.tar.gz", "has_sig": false, "md5_digest": "44acd6690783dd34cac7b7564a68d6f9", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 19070, "upload_time": "2020-02-18T11:32:16", "upload_time_iso_8601": "2020-02-18T11:32:16.436676Z", "url": "https://files.pythonhosted.org/packages/c7/44/c83608fa8d09d5b4d665076c7402f08bba897f6caed5522d0a522c57d013/kwollect-0.0.1.tar.gz", "yanked": false}], "0.0.2": [{"comment_text": "", "digests": {"md5": "75705c2c5135edf8b0d3fbff9e06e871", "sha256": "7df647bab5e08b1abd6f5b05553c11cf4c83d341fb23ebfccccba9426a49602d"}, "downloads": -1, "filename": "kwollect-0.0.2-py3-none-any.whl", "has_sig": false, "md5_digest": "75705c2c5135edf8b0d3fbff9e06e871", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 22816, "upload_time": "2020-02-26T15:42:44", "upload_time_iso_8601": "2020-02-26T15:42:44.759085Z", "url": "https://files.pythonhosted.org/packages/24/97/e88528235876323cd2c5f4fcbd5a9e209525a525f6347c7210a4f11f0d7e/kwollect-0.0.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "ccb63013204495028868a4d98b33b83d", "sha256": "41e7d483af18846db525c04d10ec6dafa2043c8ff4a68360e996a8c0fc1c78cd"}, "downloads": -1, "filename": "kwollect-0.0.2.tar.gz", "has_sig": false, "md5_digest": "ccb63013204495028868a4d98b33b83d", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 20277, "upload_time": "2020-02-26T15:42:46", "upload_time_iso_8601": "2020-02-26T15:42:46.055904Z", "url": "https://files.pythonhosted.org/packages/e4/68/7ca1625b3116a5f96224d33a8edc71e27178ba2c2e50b67badf90541a6c0/kwollect-0.0.2.tar.gz", "yanked": false}], "0.0.3": [{"comment_text": "", "digests": {"md5": "7e297f8a5ebee51cb886c00195d431c7", "sha256": "2119ca08bb618e5cc12ab2a82520b24d39d8c341580fd9fd561bbc2fd22933be"}, "downloads": -1, "filename": "kwollect-0.0.3-py3-none-any.whl", "has_sig": false, "md5_digest": "7e297f8a5ebee51cb886c00195d431c7", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 19545, "upload_time": "2020-04-09T14:44:55", "upload_time_iso_8601": "2020-04-09T14:44:55.631727Z", "url": "https://files.pythonhosted.org/packages/dc/4f/4120fa585e421eab01cbaa605ed031d4faa31ef2142d7e8b73a342f5b09a/kwollect-0.0.3-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "99fea59d15dea41485e687796616cc63", "sha256": "8561fad91ce16e5555b8bf16a30df004955ed5a11c0b62e8759b9417c0cc61f5"}, "downloads": -1, "filename": "kwollect-0.0.3.tar.gz", "has_sig": false, "md5_digest": "99fea59d15dea41485e687796616cc63", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 21940, "upload_time": "2020-04-09T14:44:57", "upload_time_iso_8601": "2020-04-09T14:44:57.866791Z", "url": "https://files.pythonhosted.org/packages/1a/4d/e1fc45048c86c675beabfa932184366d577548f33de34ea5a2ffe4c0c461/kwollect-0.0.3.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "7e297f8a5ebee51cb886c00195d431c7", "sha256": "2119ca08bb618e5cc12ab2a82520b24d39d8c341580fd9fd561bbc2fd22933be"}, "downloads": -1, "filename": "kwollect-0.0.3-py3-none-any.whl", "has_sig": false, "md5_digest": "7e297f8a5ebee51cb886c00195d431c7", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 19545, "upload_time": "2020-04-09T14:44:55", "upload_time_iso_8601": "2020-04-09T14:44:55.631727Z", "url": "https://files.pythonhosted.org/packages/dc/4f/4120fa585e421eab01cbaa605ed031d4faa31ef2142d7e8b73a342f5b09a/kwollect-0.0.3-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "99fea59d15dea41485e687796616cc63", "sha256": "8561fad91ce16e5555b8bf16a30df004955ed5a11c0b62e8759b9417c0cc61f5"}, "downloads": -1, "filename": "kwollect-0.0.3.tar.gz", "has_sig": false, "md5_digest": "99fea59d15dea41485e687796616cc63", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 21940, "upload_time": "2020-04-09T14:44:57", "upload_time_iso_8601": "2020-04-09T14:44:57.866791Z", "url": "https://files.pythonhosted.org/packages/1a/4d/e1fc45048c86c675beabfa932184366d577548f33de34ea5a2ffe4c0c461/kwollect-0.0.3.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:48:28 2020"}