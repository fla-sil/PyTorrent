{"info": {"author": "Department for International Trade", "author_email": "", "bugtrack_url": null, "classifiers": ["Environment :: Web Environment", "Framework :: Django", "Framework :: Django :: 2.2", "Framework :: Django :: 3.0", "Intended Audience :: Developers", "Operating System :: OS Independent", "Programming Language :: Python", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: Implementation :: PyPy", "Topic :: Software Development :: Libraries :: Python Modules"], "description": "# Django-staff-sso-client\n\n[![CircleCI](https://circleci.com/gh/uktrade/django-staff-sso-client/tree/master.svg?style=svg)](https://circleci.com/gh/uktrade/django-staff-sso-client/tree/master)\n[![codecov](https://codecov.io/gh/uktrade/django-staff-sso-client/branch/master/graph/badge.svg)](https://codecov.io/gh/uktrade/django-staff-sso-client)\n![PyPI](https://img.shields.io/pypi/v/django-staff-sso-client.svg)\n![PyPI - Python Version](https://img.shields.io/pypi/pyversions/django-staff-sso-client.svg)\n![PyPI - Django Version](https://img.shields.io/pypi/djversions/django-staff-sso-client.svg)\n\n\nA Django client for `staff-sso`\n\n\n## Requirements\n\n[Python 3.6](https://www.python.org/downloads/release/python-368/)\n\n[Django>=2.22](https://www.djangoproject.com/)\n\nVersion 2+ of this package drops support for Django version below 2.22.\n\nFor Django versions `1.11 <= Django < 2.22` install v1.0.1:\n\n`pip install django-staff-sso-client==1.0.1`\n\nThis client assumes your app  has either `raven` or `sentry_sdk` installed\n\n[Raven Python](https://github.com/getsentry/raven-python)\n\n[Sentry SDK](https://github.com/getsentry/sentry-python)\n\n\n## Upgrade to version 1.0.0 considerations\n\nFrom version `1.0.0` the backend populates `User.USERNAME_FIELD` with the `user_id` rather than the `email`. This is\nto solve a bug affecting users with multiple email addresses.\nIf `MIGRATE_EMAIL_USER_ON_LOGIN` is `True`, the authentication backend tries to migrate existing users.\nIt is recommended to turn `MIGRATE_EMAIL_USER_ON_LOGIN` to `False` (defaults to `False`) if not needed or when all the users are migrated to avoid \ndouble database calls.\n\n### What happens if two email based users are migrated to user_id?\nImagine the scenario where Testo Useri has two different email based accounts:\n\n1) testo.user@foo.com\n2) testo_user@bar.com\n\nAs soon as they login with the first one, the account is converted to `user_id`.\nIf they try to login with the second one, the authentication backends cannot convert the account because an account with the\nsame `user_id` already exists.\nThe authentication backends will raise an exception, **this is intended behaviour**.\n\n\n## Installation\n\n`pip install django-staff-sso-client`\n\n## Configuration\n\nAdd the following to your settings file:\n\n```\nINSTALLED_APPS=[\n    [...]\n    'authbroker_client',\n]\n```\n\n```\n# authbroker config\nAUTHBROKER_URL = 'speak-to-webops-team-for-access'\nAUTHBROKER_CLIENT_ID = 'speak-to-webops-team-for-access'\nAUTHBROKER_CLIENT_SECRET = 'speak-to-webops-team-for-access'\nAUTHBROKER_STAFF_SSO_SCOPE = 'any-additional-scope-values'\n```\n\nAdd the `'authbroker_client.backends.AuthbrokerBackend'` authentication backend, e.g:\n\n```\nAUTHENTICATION_BACKENDS = [\n    'django.contrib.auth.backends.ModelBackend',\n    'authbroker_client.backends.AuthbrokerBackend',\n]\n```\n\nAdd the LOGIN_URL ( it must be '/auth/login' )\n\n```\nLOGIN_URL = reverse_lazy('authbroker_client:login')\n```\n\nAdd the LOGIN_REDIRECT_URL for e.g.\n```\nLOGIN_REDIRECT_URL = reverse_lazy('home_page')\n```\n\nThen finally add this to your main `urls.py` file:\n\n`path('auth/', include('authbroker_client.urls'))`\n\nor, if you're using Django<2:\n\n`url('^auth/', include('authbroker_client.urls', namespace='authbroker', app_name='authbroker_client'))`\n\n\nYou should now have an `/auth/login/` URL which directs users through the `staff-sso` login flow. Once a user is\nauthenticated via `staff-sso` (and chosen identify provider), they will be redirected back to your application.\nA local django user with a matching email address will then be logged in. The user entry will be created if it does\nnot already exist in the database.\n\nOnce authenticated, the user will be redirected to `settings.LOGIN_REDIRECT_URL`\n\nUse the django `@login_required` decorator to protect individual views, or if you want to protect all views use this middleware:\n\n```\nMIDDLEWARE = [\n    [...]\n    'authbroker_client.middleware.ProtectAllViewsMiddleware',\n]\n```\n\nif you do like to use admin interface  in your app, when using this module, you will also need to install and configure the [custom_usermodel](https://github.com/uktrade/django-staff-sso-usermodel).\n\n## TODO:\n\n* ensure has_valid_token() checks with `staff-sso` after grace period (e.g. 1 minute)\n* improve exception handling logic in `authbroker_client/views.py`\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/uktrade/django-staff-sso-client/", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "django-staff-sso-client", "package_url": "https://pypi.org/project/django-staff-sso-client/", "platform": "", "project_url": "https://pypi.org/project/django-staff-sso-client/", "project_urls": {"Homepage": "https://github.com/uktrade/django-staff-sso-client/"}, "release_url": "https://pypi.org/project/django-staff-sso-client/2.1.0/", "requires_dist": ["Django (<4,>=2.2)", "requests-oauthlib", "pytest (==5.3.5) ; extra == 'test'", "pytest-cov ; extra == 'test'", "pytest-sugar ; extra == 'test'", "flake8 (==3.0.4) ; extra == 'test'", "requests-mock ; extra == 'test'", "codecov ; extra == 'test'", "twine ; extra == 'test'", "wheel ; extra == 'test'", "setuptools ; extra == 'test'", "pytest-django ; extra == 'test'", "raven ; extra == 'test'"], "requires_python": "", "summary": "Reusable Django app to facilitate gov.uk Staff Single Sign On", "version": "2.1.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>Django-staff-sso-client</h1>\n<p><a href=\"https://circleci.com/gh/uktrade/django-staff-sso-client/tree/master\" rel=\"nofollow\"><img alt=\"CircleCI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/5549cfc4ab13c4c94fbd2281b74e1c4b30019962/68747470733a2f2f636972636c6563692e636f6d2f67682f756b74726164652f646a616e676f2d73746166662d73736f2d636c69656e742f747265652f6d61737465722e7376673f7374796c653d737667\"></a>\n<a href=\"https://codecov.io/gh/uktrade/django-staff-sso-client\" rel=\"nofollow\"><img alt=\"codecov\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/a8a465cf4febc12e370183fca081618c7d07a266/68747470733a2f2f636f6465636f762e696f2f67682f756b74726164652f646a616e676f2d73746166662d73736f2d636c69656e742f6272616e63682f6d61737465722f67726170682f62616467652e737667\"></a>\n<img alt=\"PyPI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/d068223de54d63fa086045bb67d1182d0b7a785f/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f646a616e676f2d73746166662d73736f2d636c69656e742e737667\">\n<img alt=\"PyPI - Python Version\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/87a90c5d12c029463bb68bbb1a87c60469ad9c9b/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f646a616e676f2d73746166662d73736f2d636c69656e742e737667\">\n<img alt=\"PyPI - Django Version\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/307028e9b9a1c684e60933bafc3ea6975541b01f/68747470733a2f2f696d672e736869656c64732e696f2f707970692f646a76657273696f6e732f646a616e676f2d73746166662d73736f2d636c69656e742e737667\"></p>\n<p>A Django client for <code>staff-sso</code></p>\n<h2>Requirements</h2>\n<p><a href=\"https://www.python.org/downloads/release/python-368/\" rel=\"nofollow\">Python 3.6</a></p>\n<p><a href=\"https://www.djangoproject.com/\" rel=\"nofollow\">Django&gt;=2.22</a></p>\n<p>Version 2+ of this package drops support for Django version below 2.22.</p>\n<p>For Django versions <code>1.11 &lt;= Django &lt; 2.22</code> install v1.0.1:</p>\n<p><code>pip install django-staff-sso-client==1.0.1</code></p>\n<p>This client assumes your app  has either <code>raven</code> or <code>sentry_sdk</code> installed</p>\n<p><a href=\"https://github.com/getsentry/raven-python\" rel=\"nofollow\">Raven Python</a></p>\n<p><a href=\"https://github.com/getsentry/sentry-python\" rel=\"nofollow\">Sentry SDK</a></p>\n<h2>Upgrade to version 1.0.0 considerations</h2>\n<p>From version <code>1.0.0</code> the backend populates <code>User.USERNAME_FIELD</code> with the <code>user_id</code> rather than the <code>email</code>. This is\nto solve a bug affecting users with multiple email addresses.\nIf <code>MIGRATE_EMAIL_USER_ON_LOGIN</code> is <code>True</code>, the authentication backend tries to migrate existing users.\nIt is recommended to turn <code>MIGRATE_EMAIL_USER_ON_LOGIN</code> to <code>False</code> (defaults to <code>False</code>) if not needed or when all the users are migrated to avoid\ndouble database calls.</p>\n<h3>What happens if two email based users are migrated to user_id?</h3>\n<p>Imagine the scenario where Testo Useri has two different email based accounts:</p>\n<ol>\n<li><a href=\"mailto:testo.user@foo.com\">testo.user@foo.com</a></li>\n<li><a href=\"mailto:testo_user@bar.com\">testo_user@bar.com</a></li>\n</ol>\n<p>As soon as they login with the first one, the account is converted to <code>user_id</code>.\nIf they try to login with the second one, the authentication backends cannot convert the account because an account with the\nsame <code>user_id</code> already exists.\nThe authentication backends will raise an exception, <strong>this is intended behaviour</strong>.</p>\n<h2>Installation</h2>\n<p><code>pip install django-staff-sso-client</code></p>\n<h2>Configuration</h2>\n<p>Add the following to your settings file:</p>\n<pre><code>INSTALLED_APPS=[\n    [...]\n    'authbroker_client',\n]\n</code></pre>\n<pre><code># authbroker config\nAUTHBROKER_URL = 'speak-to-webops-team-for-access'\nAUTHBROKER_CLIENT_ID = 'speak-to-webops-team-for-access'\nAUTHBROKER_CLIENT_SECRET = 'speak-to-webops-team-for-access'\nAUTHBROKER_STAFF_SSO_SCOPE = 'any-additional-scope-values'\n</code></pre>\n<p>Add the <code>'authbroker_client.backends.AuthbrokerBackend'</code> authentication backend, e.g:</p>\n<pre><code>AUTHENTICATION_BACKENDS = [\n    'django.contrib.auth.backends.ModelBackend',\n    'authbroker_client.backends.AuthbrokerBackend',\n]\n</code></pre>\n<p>Add the LOGIN_URL ( it must be '/auth/login' )</p>\n<pre><code>LOGIN_URL = reverse_lazy('authbroker_client:login')\n</code></pre>\n<p>Add the LOGIN_REDIRECT_URL for e.g.</p>\n<pre><code>LOGIN_REDIRECT_URL = reverse_lazy('home_page')\n</code></pre>\n<p>Then finally add this to your main <code>urls.py</code> file:</p>\n<p><code>path('auth/', include('authbroker_client.urls'))</code></p>\n<p>or, if you're using Django&lt;2:</p>\n<p><code>url('^auth/', include('authbroker_client.urls', namespace='authbroker', app_name='authbroker_client'))</code></p>\n<p>You should now have an <code>/auth/login/</code> URL which directs users through the <code>staff-sso</code> login flow. Once a user is\nauthenticated via <code>staff-sso</code> (and chosen identify provider), they will be redirected back to your application.\nA local django user with a matching email address will then be logged in. The user entry will be created if it does\nnot already exist in the database.</p>\n<p>Once authenticated, the user will be redirected to <code>settings.LOGIN_REDIRECT_URL</code></p>\n<p>Use the django <code>@login_required</code> decorator to protect individual views, or if you want to protect all views use this middleware:</p>\n<pre><code>MIDDLEWARE = [\n    [...]\n    'authbroker_client.middleware.ProtectAllViewsMiddleware',\n]\n</code></pre>\n<p>if you do like to use admin interface  in your app, when using this module, you will also need to install and configure the <a href=\"https://github.com/uktrade/django-staff-sso-usermodel\" rel=\"nofollow\">custom_usermodel</a>.</p>\n<h2>TODO:</h2>\n<ul>\n<li>ensure has_valid_token() checks with <code>staff-sso</code> after grace period (e.g. 1 minute)</li>\n<li>improve exception handling logic in <code>authbroker_client/views.py</code></li>\n</ul>\n\n          </div>"}, "last_serial": 6889755, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "a03b209ee2303c48b3cbaeabb0e8075f", "sha256": "acec2dd72a7d602baea1ce4c0ad3383906520327d3403898f9bb49070df10c81"}, "downloads": -1, "filename": "django_staff_sso_client-0.1.0-py3-none-any.whl", "has_sig": false, "md5_digest": "a03b209ee2303c48b3cbaeabb0e8075f", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 10328, "upload_time": "2019-04-01T14:42:22", "upload_time_iso_8601": "2019-04-01T14:42:22.806391Z", "url": "https://files.pythonhosted.org/packages/99/8b/58bd607502e0e06bf70b138e9e99fb39363af762800ef01e6abb6d0f430b/django_staff_sso_client-0.1.0-py3-none-any.whl", "yanked": false}], "0.2.0": [{"comment_text": "", "digests": {"md5": "4eebfe85e48eceb4a3c8d964ffaeab67", "sha256": "e29fca636ac3d71a47ed74481fb3b337b56ad7765141970dbac7ce0fc9f7716d"}, "downloads": -1, "filename": "django_staff_sso_client-0.2.0-py3-none-any.whl", "has_sig": false, "md5_digest": "4eebfe85e48eceb4a3c8d964ffaeab67", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 10387, "upload_time": "2019-04-01T15:06:28", "upload_time_iso_8601": "2019-04-01T15:06:28.021215Z", "url": "https://files.pythonhosted.org/packages/95/81/1760176cfe999c1fdf2180cbb627573580968acd6338e2b5c5ceba02296e/django_staff_sso_client-0.2.0-py3-none-any.whl", "yanked": false}], "0.3.0": [{"comment_text": "", "digests": {"md5": "d9ae85f7974f2e854fcb74ba7977e470", "sha256": "95b5ea10a2b8998497c0a549918fe8a52fc26cc1ede7c3be818a6ecbb8c1353d"}, "downloads": -1, "filename": "django_staff_sso_client-0.3.0-py3-none-any.whl", "has_sig": false, "md5_digest": "d9ae85f7974f2e854fcb74ba7977e470", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 10444, "upload_time": "2019-05-24T11:45:15", "upload_time_iso_8601": "2019-05-24T11:45:15.795981Z", "url": "https://files.pythonhosted.org/packages/88/9b/e88502ecda778c69a96a19fca548bc6e342680dc4e1e5fa7387ac96ffda5/django_staff_sso_client-0.3.0-py3-none-any.whl", "yanked": false}], "0.3.1": [{"comment_text": "", "digests": {"md5": "af460d51dcfce035e8c5e84de3e1fd46", "sha256": "e602d5873258d3a34287890a392416bef8515736c8069c2b5b1136261e81bb1f"}, "downloads": -1, "filename": "django_staff_sso_client-0.3.1-py3-none-any.whl", "has_sig": false, "md5_digest": "af460d51dcfce035e8c5e84de3e1fd46", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 10456, "upload_time": "2019-06-20T14:03:08", "upload_time_iso_8601": "2019-06-20T14:03:08.330555Z", "url": "https://files.pythonhosted.org/packages/b7/be/3ded34bc30af868e1a421532ca65ea9012ea7407ade34a0cf1ddf7e64009/django_staff_sso_client-0.3.1-py3-none-any.whl", "yanked": false}], "0.4.0": [{"comment_text": "", "digests": {"md5": "0a48aaa1ad205170a1bea48a775d1637", "sha256": "6cc781f9258278179c30f4d3e05f4b9d6d8b0b6609f5749e913d96c55c083c30"}, "downloads": -1, "filename": "django_staff_sso_client-0.4.0-py3-none-any.whl", "has_sig": false, "md5_digest": "0a48aaa1ad205170a1bea48a775d1637", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 10505, "upload_time": "2019-11-26T13:00:21", "upload_time_iso_8601": "2019-11-26T13:00:21.847324Z", "url": "https://files.pythonhosted.org/packages/df/97/071d2f6a501a83c3ce225aafad22e2509e83efe618b9ce7940fcffc47190/django_staff_sso_client-0.4.0-py3-none-any.whl", "yanked": false}], "1.0.0": [{"comment_text": "", "digests": {"md5": "b078685ce9c3ba278bb57c857140a99b", "sha256": "5a3cc397faecdce40c9ae2031df6f5bb3d2996fa2269c94188b9f9f9a0527c11"}, "downloads": -1, "filename": "django_staff_sso_client-1.0.0-py3-none-any.whl", "has_sig": false, "md5_digest": "b078685ce9c3ba278bb57c857140a99b", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 11395, "upload_time": "2019-11-28T12:18:05", "upload_time_iso_8601": "2019-11-28T12:18:05.961157Z", "url": "https://files.pythonhosted.org/packages/84/83/ed5fb1eda827c100b9f4027213e20755b546212bac767bd4b9fe9931ba44/django_staff_sso_client-1.0.0-py3-none-any.whl", "yanked": false}], "1.0.1": [{"comment_text": "", "digests": {"md5": "d8313905ef325396526ac1e6fd9c5a82", "sha256": "f66dc3cf0b077f0c84b52b4f0d3bc65bf402bf7468ff4f1a25f90a29f01cb092"}, "downloads": -1, "filename": "django_staff_sso_client-1.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "d8313905ef325396526ac1e6fd9c5a82", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 11430, "upload_time": "2019-12-19T15:26:31", "upload_time_iso_8601": "2019-12-19T15:26:31.432923Z", "url": "https://files.pythonhosted.org/packages/3f/3f/0778df305283ecd1786f1e15b31a7446d56ee72ed031215c588568a995d0/django_staff_sso_client-1.0.1-py3-none-any.whl", "yanked": false}], "2.0.0": [{"comment_text": "", "digests": {"md5": "b645eef7d3cfd41491fd1358c78293a4", "sha256": "157709bea134578cb336c8a9ac47041e36b4ecc7e540a3e2507d13936c4c35fd"}, "downloads": -1, "filename": "django_staff_sso_client-2.0.0-py3-none-any.whl", "has_sig": false, "md5_digest": "b645eef7d3cfd41491fd1358c78293a4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 11507, "upload_time": "2020-03-03T10:48:48", "upload_time_iso_8601": "2020-03-03T10:48:48.109318Z", "url": "https://files.pythonhosted.org/packages/d5/ca/29c5cf7b2b7d58ef39e0c8a68d9cea1f6e621de86dba5589cbfe884b1077/django_staff_sso_client-2.0.0-py3-none-any.whl", "yanked": false}], "2.0.1": [{"comment_text": "", "digests": {"md5": "962873aedc54e4166e52ddfc50bef43b", "sha256": "ba58f81f91abb2f987e1d50b0f2baeaf1ea2b98fa7aa94616597fa195fa10abd"}, "downloads": -1, "filename": "django_staff_sso_client-2.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "962873aedc54e4166e52ddfc50bef43b", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 11562, "upload_time": "2020-03-03T12:13:57", "upload_time_iso_8601": "2020-03-03T12:13:57.060972Z", "url": "https://files.pythonhosted.org/packages/dd/b7/45a1f9e568ec2837bac9803c5560428a9edd054864686636243b4b4c6492/django_staff_sso_client-2.0.1-py3-none-any.whl", "yanked": false}], "2.1.0": [{"comment_text": "", "digests": {"md5": "2c607fec99dcd486c6a48d1738bf96f1", "sha256": "6597394bd33196e8e7dae86d8b049580a62989c8cb51173bac50a753778f2d95"}, "downloads": -1, "filename": "django_staff_sso_client-2.1.0-py3-none-any.whl", "has_sig": false, "md5_digest": "2c607fec99dcd486c6a48d1738bf96f1", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 11743, "upload_time": "2020-03-26T17:21:39", "upload_time_iso_8601": "2020-03-26T17:21:39.610782Z", "url": "https://files.pythonhosted.org/packages/56/53/c4c99a7165389200b5705f36e7c3fb1b6c289b213ed43d833b837e380350/django_staff_sso_client-2.1.0-py3-none-any.whl", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "2c607fec99dcd486c6a48d1738bf96f1", "sha256": "6597394bd33196e8e7dae86d8b049580a62989c8cb51173bac50a753778f2d95"}, "downloads": -1, "filename": "django_staff_sso_client-2.1.0-py3-none-any.whl", "has_sig": false, "md5_digest": "2c607fec99dcd486c6a48d1738bf96f1", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 11743, "upload_time": "2020-03-26T17:21:39", "upload_time_iso_8601": "2020-03-26T17:21:39.610782Z", "url": "https://files.pythonhosted.org/packages/56/53/c4c99a7165389200b5705f36e7c3fb1b6c289b213ed43d833b837e380350/django_staff_sso_client-2.1.0-py3-none-any.whl", "yanked": false}], "timestamp": "Fri May  8 00:52:59 2020"}