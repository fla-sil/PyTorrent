{"info": {"author": "Thibault B\u00e9tr\u00e9mieux", "author_email": "thibault.betremieux@gmail.com", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Intended Audience :: Developers", "License :: Public Domain", "Operating System :: OS Independent", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7", "Programming Language :: Python :: 3.8"], "description": "[![CircleCI](https://circleci.com/gh/ThibTrip/pangres.svg?style=svg&circle-token=3e39be6b969ed02b41d259c279da0d9e63751506)](https://circleci.com/gh/ThibTrip/pangres) [![codecov](https://codecov.io/gh/ThibTrip/pangres/branch/master/graph/badge.svg)](https://codecov.io/gh/ThibTrip/pangres) [![PyPI version](https://img.shields.io/pypi/v/pangres)](https://img.shields.io/pypi/v/pangres)\n\n# pangres\n![pangres logo](logo.png)\n\n_Thanks to [freesvg.org](https://freesvg.org/) for the logo assets_\n\nUpsert with pandas DataFrames (<code>ON CONFLICT DO NOTHING</code> or <code>ON CONFLICT DO UPDATE</code>) for PostgreSQL, MySQL, SQlite and potentially other databases behaving like SQlite (untested) with some additional optional features (see features).\nAlso handles the creation of non existing SQL tables and schemas.\n\n# Features\n\n1. <i>(optional)</i> Automatical column creation (when a column exists in the DataFrame but not in the SQL table).\n2. <i>(optional)</i> Automatical column type alteration for columns that are empty in the SQL table (except for SQlite where alteration is limited).\n3. Creates the table if it is missing.\n4. Creates missing schemas in Postgres (and potentially other databases that have a schema system).\n5. JSON is supported (with pd.to_sql it does not work) with some exceptions (see [Gotchas and caveats](#Gotchas-and-caveats)).\n6. Fast (except for SQlite where some help is needed).\n7. Will work even if not all columns defined in the SQL table are there.\n8. SQL injection safe (schema, table and column names are escaped and values are given as parameters).\n\n# Tested with\n* Python 3.7.3 and Python 3.8.0\n* MySQL 5.7.29 using pymysql 0.9.3\n* PostgreSQL 9.6.17 using psycopg2 2.8.4\n* SQlite 3.28.0 using sqlite3 2.6.0\n\n# Gotchas and caveats\n\n## All flavors\n1. We can't create JSON columns automatically but we can insert JSON like objects (list, dict) in existing JSON columns.\n\n## Postgres\n\n1. \"%\", \")\" and \"(\" in column names will most likely cause errors with PostgreSQL (this is due to psycopg2 and also affect pd.to_sql). Use the function pangres.fix_psycopg2_bad_cols to \"clean\" the columns in the DataFrame. You'll also have to rename columns in the SQL table accordingly (if the table already exists).\n2. Even though we only do data type alteration on empty columns, since we don't want to lose column information (e.g. constraints) we use true column alteration (instead of drop+create) so the old data type must be castable to the new data type. Postgres seems a bit restrictive in this regard even when the columns are empty (e.g. BOOLEAN to TIMESTAMP is impossible).\n\n## SQlite\n1. **SQlite must be version 3.24.4 or higher**! UPSERT syntax did not exist before. \n2. Column type alteration is not possible for SQlite.\n3. SQlite inserts can be at worst 5 times slower than pd.to_sql for some reasons. If you can help please contact me!\n4. Inserts with 1000 columns or more are not supported due to a restriction of 999 parameters per queries. One way to fix this would inserting the columns progressively but this seems quite tricky. If you know a better way please contact me.\n\n## MySQL\n\n1. MySQL will often change the order of the primary keys in the SQL table when using INSERT... ON CONFLICT.. DO NOTHING/UPDATE. This seems to be the expected behavior so nothing we can do about it but please mind that!\n2. You may need to provide SQL dtypes e.g. if you have a primary key with text you will need to provide a character length (e.g. VARCHAR(50)) because MySQL does not support indices/primary keys with flexible text length. pd.to_sql has the same issue.\n\n\n# Notes\n\nThis is a library I was using in production in private with very good results and decided to publish.\n\nIdeally such features will be integrated into pandas since there is already a [PR on the way](https://github.com/pandas-dev/pandas/pull/29636)) and I would like to give the option to add columns via another PR.\n\nThere is also [pandabase](https://github.com/notsambeck/pandabase) which does almost the same thing (plus lots of extra features) but my implementation is different.\nBtw big thanks to pandabase and the sql part of pandas which helped a lot.\n\n# Installation\n```\npip install pangres\n```\nAdditionally depending on which database you want to work with you will need to install the corresponding library (note that SQlite is included in the standard library):\n\n* Postgres\n```\npip install psycopg2\n```\n\n* MySQL\n```\npip install pymysql\n```\n\n# Usage\nHead over to [pangres' wiki](https://github.com/ThibTrip/pangres/wiki)!\n\n# Contributing\n\nPull requests/issues are welcome.\n\n# Testing\n\nYou will need a SQlite, MySQL and Postgres database available for testing.\n\nClone pangres then set your curent working directory to the root of the cloned repository folder. Then use the commands below. You will have to replace the following variables in those commands:\n* SQLITE_CONNECTION_STRING: replace with a SQlite sqlalchemy connection string (e.g. \"sqlite:///test.db\")\n* POSTGRES_CONNECTION_STRING: replace with a Postgres sqlalchemy connection string (e.g. \"postgres:///user:password@localhost:5432/database\"). Specifying schema is optional for postgres (will default to public).\n* PG_SCHEMA (optional): schema for postgres (defaults to public)\n* MYSQL_CONNECTION_STRING: replace with a MySQL sqlalchemy connection string (e.g. \"mysql+pymysql:///user:password@localhost:3306/database\")\n\n```shell\n# 1. Create and activate the build environment\nconda env create -f environment.yml\nconda activate pangres-dev\n# 2. Install pangres in editable mode (changes are reflected upon reimporting)\npip install -e .\n# 3. Run pytest\n# -s prints stdout\n# -v prints test parameters\n# --cov=./pangres shows coverage only for pangres\n# --doctest-modules tests with doctest in all modules\npytest -s -v pangres --cov=pangres --doctest-modules --sqlite_conn=$SQLITE_CONNECTION_STRING --pg_conn=$POSTGRES_CONNECTION_STRING --mysql_conn=$MYSQL_CONNECTION_STRING --pg_schema=tests\n```", "description_content_type": "text/markdown", "docs_url": null, "download_url": "https://github.com/ThibTrip/pangres/archive/v2.1.tar.gz", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/ThibTrip/pangres", "keywords": "pandas,postgres", "license": "The Unlicense", "maintainer": "", "maintainer_email": "", "name": "pangres", "package_url": "https://pypi.org/project/pangres/", "platform": "", "project_url": "https://pypi.org/project/pangres/", "project_urls": {"Download": "https://github.com/ThibTrip/pangres/archive/v2.1.tar.gz", "Homepage": "https://github.com/ThibTrip/pangres"}, "release_url": "https://pypi.org/project/pangres/2.1/", "requires_dist": null, "requires_python": "", "summary": "Postgres insert update with pandas DataFrames.", "version": "2.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><a href=\"https://circleci.com/gh/ThibTrip/pangres\" rel=\"nofollow\"><img alt=\"CircleCI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/85d41e8d52bf5965e702711fb48b4c4340c1d9c6/68747470733a2f2f636972636c6563692e636f6d2f67682f54686962547269702f70616e677265732e7376673f7374796c653d73766726636972636c652d746f6b656e3d33653339626536623936396564303262343164323539633237396461306439653633373531353036\"></a> <a href=\"https://codecov.io/gh/ThibTrip/pangres\" rel=\"nofollow\"><img alt=\"codecov\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/e739568b1da69899aa555410e5978ea227ee8842/68747470733a2f2f636f6465636f762e696f2f67682f54686962547269702f70616e677265732f6272616e63682f6d61737465722f67726170682f62616467652e737667\"></a> <a href=\"https://img.shields.io/pypi/v/pangres\" rel=\"nofollow\"><img alt=\"PyPI version\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/01a2c847ef44e82d670003c8185bce6672540280/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f70616e67726573\"></a></p>\n<h1>pangres</h1>\n<p><img alt=\"pangres logo\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/388655114bc901a8aeb49270f41e805988057feb/6c6f676f2e706e67\"></p>\n<p><em>Thanks to <a href=\"https://freesvg.org/\" rel=\"nofollow\">freesvg.org</a> for the logo assets</em></p>\n<p>Upsert with pandas DataFrames (<code>ON CONFLICT DO NOTHING</code> or <code>ON CONFLICT DO UPDATE</code>) for PostgreSQL, MySQL, SQlite and potentially other databases behaving like SQlite (untested) with some additional optional features (see features).\nAlso handles the creation of non existing SQL tables and schemas.</p>\n<h1>Features</h1>\n<ol>\n<li><i>(optional)</i> Automatical column creation (when a column exists in the DataFrame but not in the SQL table).</li>\n<li><i>(optional)</i> Automatical column type alteration for columns that are empty in the SQL table (except for SQlite where alteration is limited).</li>\n<li>Creates the table if it is missing.</li>\n<li>Creates missing schemas in Postgres (and potentially other databases that have a schema system).</li>\n<li>JSON is supported (with pd.to_sql it does not work) with some exceptions (see <a href=\"#Gotchas-and-caveats\" rel=\"nofollow\">Gotchas and caveats</a>).</li>\n<li>Fast (except for SQlite where some help is needed).</li>\n<li>Will work even if not all columns defined in the SQL table are there.</li>\n<li>SQL injection safe (schema, table and column names are escaped and values are given as parameters).</li>\n</ol>\n<h1>Tested with</h1>\n<ul>\n<li>Python 3.7.3 and Python 3.8.0</li>\n<li>MySQL 5.7.29 using pymysql 0.9.3</li>\n<li>PostgreSQL 9.6.17 using psycopg2 2.8.4</li>\n<li>SQlite 3.28.0 using sqlite3 2.6.0</li>\n</ul>\n<h1>Gotchas and caveats</h1>\n<h2>All flavors</h2>\n<ol>\n<li>We can't create JSON columns automatically but we can insert JSON like objects (list, dict) in existing JSON columns.</li>\n</ol>\n<h2>Postgres</h2>\n<ol>\n<li>\"%\", \")\" and \"(\" in column names will most likely cause errors with PostgreSQL (this is due to psycopg2 and also affect pd.to_sql). Use the function pangres.fix_psycopg2_bad_cols to \"clean\" the columns in the DataFrame. You'll also have to rename columns in the SQL table accordingly (if the table already exists).</li>\n<li>Even though we only do data type alteration on empty columns, since we don't want to lose column information (e.g. constraints) we use true column alteration (instead of drop+create) so the old data type must be castable to the new data type. Postgres seems a bit restrictive in this regard even when the columns are empty (e.g. BOOLEAN to TIMESTAMP is impossible).</li>\n</ol>\n<h2>SQlite</h2>\n<ol>\n<li><strong>SQlite must be version 3.24.4 or higher</strong>! UPSERT syntax did not exist before.</li>\n<li>Column type alteration is not possible for SQlite.</li>\n<li>SQlite inserts can be at worst 5 times slower than pd.to_sql for some reasons. If you can help please contact me!</li>\n<li>Inserts with 1000 columns or more are not supported due to a restriction of 999 parameters per queries. One way to fix this would inserting the columns progressively but this seems quite tricky. If you know a better way please contact me.</li>\n</ol>\n<h2>MySQL</h2>\n<ol>\n<li>MySQL will often change the order of the primary keys in the SQL table when using INSERT... ON CONFLICT.. DO NOTHING/UPDATE. This seems to be the expected behavior so nothing we can do about it but please mind that!</li>\n<li>You may need to provide SQL dtypes e.g. if you have a primary key with text you will need to provide a character length (e.g. VARCHAR(50)) because MySQL does not support indices/primary keys with flexible text length. pd.to_sql has the same issue.</li>\n</ol>\n<h1>Notes</h1>\n<p>This is a library I was using in production in private with very good results and decided to publish.</p>\n<p>Ideally such features will be integrated into pandas since there is already a <a href=\"https://github.com/pandas-dev/pandas/pull/29636\" rel=\"nofollow\">PR on the way</a>) and I would like to give the option to add columns via another PR.</p>\n<p>There is also <a href=\"https://github.com/notsambeck/pandabase\" rel=\"nofollow\">pandabase</a> which does almost the same thing (plus lots of extra features) but my implementation is different.\nBtw big thanks to pandabase and the sql part of pandas which helped a lot.</p>\n<h1>Installation</h1>\n<pre><code>pip install pangres\n</code></pre>\n<p>Additionally depending on which database you want to work with you will need to install the corresponding library (note that SQlite is included in the standard library):</p>\n<ul>\n<li>Postgres</li>\n</ul>\n<pre><code>pip install psycopg2\n</code></pre>\n<ul>\n<li>MySQL</li>\n</ul>\n<pre><code>pip install pymysql\n</code></pre>\n<h1>Usage</h1>\n<p>Head over to <a href=\"https://github.com/ThibTrip/pangres/wiki\" rel=\"nofollow\">pangres' wiki</a>!</p>\n<h1>Contributing</h1>\n<p>Pull requests/issues are welcome.</p>\n<h1>Testing</h1>\n<p>You will need a SQlite, MySQL and Postgres database available for testing.</p>\n<p>Clone pangres then set your curent working directory to the root of the cloned repository folder. Then use the commands below. You will have to replace the following variables in those commands:</p>\n<ul>\n<li>SQLITE_CONNECTION_STRING: replace with a SQlite sqlalchemy connection string (e.g. \"sqlite:///test.db\")</li>\n<li>POSTGRES_CONNECTION_STRING: replace with a Postgres sqlalchemy connection string (e.g. \"postgres:///user:password@localhost:5432/database\"). Specifying schema is optional for postgres (will default to public).</li>\n<li>PG_SCHEMA (optional): schema for postgres (defaults to public)</li>\n<li>MYSQL_CONNECTION_STRING: replace with a MySQL sqlalchemy connection string (e.g. \"mysql+pymysql:///user:password@localhost:3306/database\")</li>\n</ul>\n<pre><span class=\"c1\"># 1. Create and activate the build environment</span>\nconda env create -f environment.yml\nconda activate pangres-dev\n<span class=\"c1\"># 2. Install pangres in editable mode (changes are reflected upon reimporting)</span>\npip install -e .\n<span class=\"c1\"># 3. Run pytest</span>\n<span class=\"c1\"># -s prints stdout</span>\n<span class=\"c1\"># -v prints test parameters</span>\n<span class=\"c1\"># --cov=./pangres shows coverage only for pangres</span>\n<span class=\"c1\"># --doctest-modules tests with doctest in all modules</span>\npytest -s -v pangres --cov<span class=\"o\">=</span>pangres --doctest-modules --sqlite_conn<span class=\"o\">=</span><span class=\"nv\">$SQLITE_CONNECTION_STRING</span> --pg_conn<span class=\"o\">=</span><span class=\"nv\">$POSTGRES_CONNECTION_STRING</span> --mysql_conn<span class=\"o\">=</span><span class=\"nv\">$MYSQL_CONNECTION_STRING</span> --pg_schema<span class=\"o\">=</span>tests\n</pre>\n\n          </div>"}, "last_serial": 7000918, "releases": {"1.3": [{"comment_text": "", "digests": {"md5": "636f3a705605ceb47ffe74b84a2293fe", "sha256": "c0c37004030cd219a6541dc9ffc50fdd43d5acca2f10676f40fd1abee1347e6d"}, "downloads": -1, "filename": "pangres-1.3.tar.gz", "has_sig": false, "md5_digest": "636f3a705605ceb47ffe74b84a2293fe", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15512, "upload_time": "2020-01-31T14:44:59", "upload_time_iso_8601": "2020-01-31T14:44:59.442823Z", "url": "https://files.pythonhosted.org/packages/82/d0/54fa7503060eb0c5f9085c4f5e37b4cc8f66c11cca70278f34d0882f38d5/pangres-1.3.tar.gz", "yanked": false}], "1.3.1": [{"comment_text": "", "digests": {"md5": "49713add47465cb03ad9feb480573668", "sha256": "87e3e3fc33cbe4ec73e167eefe5b21529039f3ae0289b688ffae79879025c824"}, "downloads": -1, "filename": "pangres-1.3.1.tar.gz", "has_sig": false, "md5_digest": "49713add47465cb03ad9feb480573668", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 15579, "upload_time": "2020-02-16T13:04:13", "upload_time_iso_8601": "2020-02-16T13:04:13.305342Z", "url": "https://files.pythonhosted.org/packages/1f/ff/16e09058f7221798886c108efe3158ab54d95b2da7f27e67ccf9605d7a7c/pangres-1.3.1.tar.gz", "yanked": false}], "2": [{"comment_text": "", "digests": {"md5": "8341b1d5d5e5c0619df23c9dc176b225", "sha256": "c637be46cb35a863c7ff42473e9605c4c5c0f0a8b1e2feea463ced561452a5cd"}, "downloads": -1, "filename": "pangres-2.tar.gz", "has_sig": false, "md5_digest": "8341b1d5d5e5c0619df23c9dc176b225", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 23415, "upload_time": "2020-04-04T21:20:25", "upload_time_iso_8601": "2020-04-04T21:20:25.894106Z", "url": "https://files.pythonhosted.org/packages/41/11/911563f4d4c374abc8ee5f72aab6eb2b39b54eeed8ca181d011ab2fa132f/pangres-2.tar.gz", "yanked": false}], "2.1": [{"comment_text": "", "digests": {"md5": "5a6e1381f79fa0ced53813e2092b1d1b", "sha256": "b0b419b8ea45328879f67db13853cb8d9efb7d90f1866af78dd9cd085311b43d"}, "downloads": -1, "filename": "pangres-2.1.tar.gz", "has_sig": false, "md5_digest": "5a6e1381f79fa0ced53813e2092b1d1b", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 24327, "upload_time": "2020-04-11T18:09:36", "upload_time_iso_8601": "2020-04-11T18:09:36.867902Z", "url": "https://files.pythonhosted.org/packages/a7/15/125dde6a6b92003826d3b9de092d9047eab32a7b57f4bd738f0c11f77d58/pangres-2.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "5a6e1381f79fa0ced53813e2092b1d1b", "sha256": "b0b419b8ea45328879f67db13853cb8d9efb7d90f1866af78dd9cd085311b43d"}, "downloads": -1, "filename": "pangres-2.1.tar.gz", "has_sig": false, "md5_digest": "5a6e1381f79fa0ced53813e2092b1d1b", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 24327, "upload_time": "2020-04-11T18:09:36", "upload_time_iso_8601": "2020-04-11T18:09:36.867902Z", "url": "https://files.pythonhosted.org/packages/a7/15/125dde6a6b92003826d3b9de092d9047eab32a7b57f4bd738f0c11f77d58/pangres-2.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 02:59:18 2020"}