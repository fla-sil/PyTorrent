{"info": {"author": "Jorge C. Leitao", "author_email": "jorgecarleitao@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "[![pipeline status](https://gitlab.com/jorgecarleitao/Starlette-oauth2-api/badges/master/pipeline.svg)](https://gitlab.com/jorgecarleitao/Starlette-oauth2-api/commits/master)\n[![coverage report](https://gitlab.com/jorgecarleitao/Starlette-oauth2-api/badges/master/coverage.svg)](https://gitlab.com/jorgecarleitao/Starlette-oauth2-api/commits/master)\n\n# Starlette OAuth2\n\nA Starlette middleware for authentication and authorization through JWT.\n\nThis middleware is intended to add authentication and authorization to an API (e.g. FastAPI) through access tokens provided by an external auth provider (e.g. Microsoft AD, Auth0).\nIts main use-case is when you have an API that relies on an external identity provider for authentication and authorization, and whose clients can request access tokens themselves. In this case, the API does not need to communicate with the identity provider - it only needs to validate that the access tokens are signed by the identity provider.\n\nThis middleware depends only on `python-jose`, which it uses to decode and validate JWTs.\n\n## How to install\n\n```\npip install starlette-oauth2-api\n```\n\n## How to use\n\nBelow is an example of how to use this middleware:\n\n```\nfrom starlette.applications import Starlette\nfrom starlette_oauth2_api import AuthenticateMiddleware\n\n\napp = Starlette()\napp.add_middleware(AuthenticateMiddleware,\n    providers={\n        'google': {\n            'keys': 'https://www.googleapis.com/oauth2/v3/certs',\n            'issuer': 'https://accounts.google.com',\n            'audience': '852159111111-xxxxxx.apps.googleusercontent.com',\n        }\n    },\n    public_paths={'/'},\n)\n```\n\nAt this point, every route except `/` requires an `authorization: Bearer {token}` where `token` must:\n\n* be a JWT\n* be issued by `issuer` to the audience `audience`\n* be signed by one of the keys in `https://www.googleapis.com/oauth2/v3/certs`\n* not have expired\n\nFailing any of the conditions above returns a 401 response, failing to contain the header with `Bearer ` returns a 400 response.\n\nWhen the request is valid, the Middlware adds all claims in the JWT to `oauth2-claims`, which can be accessed using\n\n```\n...\ndef home(request):\n    ...\n    request.scope['oauth2-claims']\n    ...\n```\n\nIn particular, if your identity provider provides custom claims, you can use these for authorization.\n\n## Details\n\nThe argument `providers` must be a dictionary whose keys are arbitrary, and its values must be a dictionary containing three keys:\n\n* `issuer`\n* `audience`\n* `keys`\n\n#### Issuer (iss)\n\nThis middleware uses the issuer to validate (by python-Jose) that the token was issued by a specific entity. Examples of issuers:\n\n* Microsoft: `https://login.microsoftonline.com/<ad_tenant_id>/v2.0`\n* Google: `https://accounts.google.com`\n\nThis value can be found at `https://.../.well-known/openid-configuration`, key `iss`.\n\n#### Audience (aud)\n\nLike the issuer, this middleware uses the audience to validate that the token was intended for this API.\nSome examples of audiences from out-there:\n\n* Microsoft: `https://<app-name>.azurewebsites.net`\n* Google: `<tenant>-<project>.apps.googleusercontent.com`\n\nThis value can be found when the application is configured in AD, which depends on the particular Identity\nprovider that you use.\n\n#### Keys (jwks)\n\n`keys` correspond to the public keys of the identity provider, whose corresponding (private) counterpart was used to sign the token. This middleware relies on Python-Jose to verify that the token was signed by the counterpart key of this field.\n\n`keys` can be a URL another object. When it is a URL, this middleware fetches the keys from it. Examples:\n\n* Microsoft: `https://login.microsoftonline.com/<tenant-id>/discovery/v2.0/keys`\n* Google: `https://www.googleapis.com/oauth2/v3/certs`\n\nThis URL can be found at `https://.../.well-known/openid-configuration`, key `jwks_uri`.\n\nWhen `keys` is another object, it represents a JWK, JWK set as per RFC 7517, or other (non-standard) variation that python-jose accepts. An example of its content:\n\n```\n{'keys': [\n    {\n        \"kid\": \"...\",\n        \"e\": \"AQAB\",\n        \"kty\": \"RSA\",\n        \"alg\": \"RS256\",\n        \"n\": \"...\",\n        \"use\": \"sig\"\n    },\n]}\n```\n\nThe tradeoff between providing a JWK set or a url is the following: on the one hand, if you provide a JWK set, this middleware does not need access to the public internet to validate tokens, and can thus be deployed on environments without it. On the other hand, JWK are eventually rotated by the\nidentity provider and you will have redeploy the application with the respective updated public keys.", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://gitlab.com/jorgecarleitao/starlette-oauth2-api", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "starlette-oauth2-api", "package_url": "https://pypi.org/project/starlette-oauth2-api/", "platform": "", "project_url": "https://pypi.org/project/starlette-oauth2-api/", "project_urls": {"Homepage": "https://gitlab.com/jorgecarleitao/starlette-oauth2-api"}, "release_url": "https://pypi.org/project/starlette-oauth2-api/0.2.0/", "requires_dist": null, "requires_python": "", "summary": "", "version": "0.2.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><a href=\"https://gitlab.com/jorgecarleitao/Starlette-oauth2-api/commits/master\" rel=\"nofollow\"><img alt=\"pipeline status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/0479a9d4b7a3ebda2779f6bd79ec3463d8e19aeb/68747470733a2f2f6769746c61622e636f6d2f6a6f7267656361726c656974616f2f537461726c657474652d6f61757468322d6170692f6261646765732f6d61737465722f706970656c696e652e737667\"></a>\n<a href=\"https://gitlab.com/jorgecarleitao/Starlette-oauth2-api/commits/master\" rel=\"nofollow\"><img alt=\"coverage report\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/43d225e7f30f3de5525d8ba7fd08a4646013887b/68747470733a2f2f6769746c61622e636f6d2f6a6f7267656361726c656974616f2f537461726c657474652d6f61757468322d6170692f6261646765732f6d61737465722f636f7665726167652e737667\"></a></p>\n<h1>Starlette OAuth2</h1>\n<p>A Starlette middleware for authentication and authorization through JWT.</p>\n<p>This middleware is intended to add authentication and authorization to an API (e.g. FastAPI) through access tokens provided by an external auth provider (e.g. Microsoft AD, Auth0).\nIts main use-case is when you have an API that relies on an external identity provider for authentication and authorization, and whose clients can request access tokens themselves. In this case, the API does not need to communicate with the identity provider - it only needs to validate that the access tokens are signed by the identity provider.</p>\n<p>This middleware depends only on <code>python-jose</code>, which it uses to decode and validate JWTs.</p>\n<h2>How to install</h2>\n<pre><code>pip install starlette-oauth2-api\n</code></pre>\n<h2>How to use</h2>\n<p>Below is an example of how to use this middleware:</p>\n<pre><code>from starlette.applications import Starlette\nfrom starlette_oauth2_api import AuthenticateMiddleware\n\n\napp = Starlette()\napp.add_middleware(AuthenticateMiddleware,\n    providers={\n        'google': {\n            'keys': 'https://www.googleapis.com/oauth2/v3/certs',\n            'issuer': 'https://accounts.google.com',\n            'audience': '852159111111-xxxxxx.apps.googleusercontent.com',\n        }\n    },\n    public_paths={'/'},\n)\n</code></pre>\n<p>At this point, every route except <code>/</code> requires an <code>authorization: Bearer {token}</code> where <code>token</code> must:</p>\n<ul>\n<li>be a JWT</li>\n<li>be issued by <code>issuer</code> to the audience <code>audience</code></li>\n<li>be signed by one of the keys in <code>https://www.googleapis.com/oauth2/v3/certs</code></li>\n<li>not have expired</li>\n</ul>\n<p>Failing any of the conditions above returns a 401 response, failing to contain the header with <code>Bearer</code> returns a 400 response.</p>\n<p>When the request is valid, the Middlware adds all claims in the JWT to <code>oauth2-claims</code>, which can be accessed using</p>\n<pre><code>...\ndef home(request):\n    ...\n    request.scope['oauth2-claims']\n    ...\n</code></pre>\n<p>In particular, if your identity provider provides custom claims, you can use these for authorization.</p>\n<h2>Details</h2>\n<p>The argument <code>providers</code> must be a dictionary whose keys are arbitrary, and its values must be a dictionary containing three keys:</p>\n<ul>\n<li><code>issuer</code></li>\n<li><code>audience</code></li>\n<li><code>keys</code></li>\n</ul>\n<h4>Issuer (iss)</h4>\n<p>This middleware uses the issuer to validate (by python-Jose) that the token was issued by a specific entity. Examples of issuers:</p>\n<ul>\n<li>Microsoft: <code>https://login.microsoftonline.com/&lt;ad_tenant_id&gt;/v2.0</code></li>\n<li>Google: <code>https://accounts.google.com</code></li>\n</ul>\n<p>This value can be found at <code>https://.../.well-known/openid-configuration</code>, key <code>iss</code>.</p>\n<h4>Audience (aud)</h4>\n<p>Like the issuer, this middleware uses the audience to validate that the token was intended for this API.\nSome examples of audiences from out-there:</p>\n<ul>\n<li>Microsoft: <code>https://&lt;app-name&gt;.azurewebsites.net</code></li>\n<li>Google: <code>&lt;tenant&gt;-&lt;project&gt;.apps.googleusercontent.com</code></li>\n</ul>\n<p>This value can be found when the application is configured in AD, which depends on the particular Identity\nprovider that you use.</p>\n<h4>Keys (jwks)</h4>\n<p><code>keys</code> correspond to the public keys of the identity provider, whose corresponding (private) counterpart was used to sign the token. This middleware relies on Python-Jose to verify that the token was signed by the counterpart key of this field.</p>\n<p><code>keys</code> can be a URL another object. When it is a URL, this middleware fetches the keys from it. Examples:</p>\n<ul>\n<li>Microsoft: <code>https://login.microsoftonline.com/&lt;tenant-id&gt;/discovery/v2.0/keys</code></li>\n<li>Google: <code>https://www.googleapis.com/oauth2/v3/certs</code></li>\n</ul>\n<p>This URL can be found at <code>https://.../.well-known/openid-configuration</code>, key <code>jwks_uri</code>.</p>\n<p>When <code>keys</code> is another object, it represents a JWK, JWK set as per RFC 7517, or other (non-standard) variation that python-jose accepts. An example of its content:</p>\n<pre><code>{'keys': [\n    {\n        \"kid\": \"...\",\n        \"e\": \"AQAB\",\n        \"kty\": \"RSA\",\n        \"alg\": \"RS256\",\n        \"n\": \"...\",\n        \"use\": \"sig\"\n    },\n]}\n</code></pre>\n<p>The tradeoff between providing a JWK set or a url is the following: on the one hand, if you provide a JWK set, this middleware does not need access to the public internet to validate tokens, and can thus be deployed on environments without it. On the other hand, JWK are eventually rotated by the\nidentity provider and you will have redeploy the application with the respective updated public keys.</p>\n\n          </div>"}, "last_serial": 7052588, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "3d8ec7db100fea9ab4c1ddb0848980f9", "sha256": "4ca63d51b3df0e2673991621dd7b7eb116ebfaf06cbd765ddd2a9fcc2e6bd048"}, "downloads": -1, "filename": "starlette-oauth2-api-0.1.0.tar.gz", "has_sig": false, "md5_digest": "3d8ec7db100fea9ab4c1ddb0848980f9", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3308, "upload_time": "2019-12-20T13:24:12", "upload_time_iso_8601": "2019-12-20T13:24:12.247028Z", "url": "https://files.pythonhosted.org/packages/00/ca/e7df283c0190e8470f334f1f71fb98efb8f7d2d72231474ee91f23771428/starlette-oauth2-api-0.1.0.tar.gz", "yanked": false}], "0.1.1": [{"comment_text": "", "digests": {"md5": "3276a3d24cd6e633a5bbe41c2e444891", "sha256": "d7a3f713ca90be621b8d6a8ea6c2db2a3f28b81f575300a736f6147c9572431b"}, "downloads": -1, "filename": "starlette-oauth2-api-0.1.1.tar.gz", "has_sig": false, "md5_digest": "3276a3d24cd6e633a5bbe41c2e444891", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3298, "upload_time": "2019-12-20T14:26:47", "upload_time_iso_8601": "2019-12-20T14:26:47.904796Z", "url": "https://files.pythonhosted.org/packages/a2/5f/5780ab251e0741216140058f96911dadef500bf28e29c8bd83052749af47/starlette-oauth2-api-0.1.1.tar.gz", "yanked": false}], "0.1.2": [{"comment_text": "", "digests": {"md5": "f03c917835db4f6bf1019a7cca50dc20", "sha256": "3b09fb5d0fc764f0326ba3ee22ebef60605a59f734b19f0501d1acaa955843e4"}, "downloads": -1, "filename": "starlette-oauth2-api-0.1.2.tar.gz", "has_sig": false, "md5_digest": "f03c917835db4f6bf1019a7cca50dc20", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3367, "upload_time": "2019-12-22T07:57:30", "upload_time_iso_8601": "2019-12-22T07:57:30.834557Z", "url": "https://files.pythonhosted.org/packages/a5/50/4dc15abb244900e5a1ac386e7c61175a165b35747dd3ccc989d5a73e32e8/starlette-oauth2-api-0.1.2.tar.gz", "yanked": false}], "0.2.0": [{"comment_text": "", "digests": {"md5": "38df87a12f32775ec48b3c459fe0438f", "sha256": "a291cfd8ad10bd542c6b28dfda1c70bdfd58794ad279a648498b9eca7a2fc884"}, "downloads": -1, "filename": "starlette-oauth2-api-0.2.0.tar.gz", "has_sig": false, "md5_digest": "38df87a12f32775ec48b3c459fe0438f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 4559, "upload_time": "2020-04-19T11:06:34", "upload_time_iso_8601": "2020-04-19T11:06:34.017342Z", "url": "https://files.pythonhosted.org/packages/35/6c/2ea690d773807cd51cc6a786367058ab508ff8619272a3b3b8c56a802297/starlette-oauth2-api-0.2.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "38df87a12f32775ec48b3c459fe0438f", "sha256": "a291cfd8ad10bd542c6b28dfda1c70bdfd58794ad279a648498b9eca7a2fc884"}, "downloads": -1, "filename": "starlette-oauth2-api-0.2.0.tar.gz", "has_sig": false, "md5_digest": "38df87a12f32775ec48b3c459fe0438f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 4559, "upload_time": "2020-04-19T11:06:34", "upload_time_iso_8601": "2020-04-19T11:06:34.017342Z", "url": "https://files.pythonhosted.org/packages/35/6c/2ea690d773807cd51cc6a786367058ab508ff8619272a3b3b8c56a802297/starlette-oauth2-api-0.2.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:02:36 2020"}