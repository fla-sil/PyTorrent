{"info": {"author": "Julian Gericke, LSD Information Technology", "author_email": "julian@lsd.co.za", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Environment :: Console", "Environment :: MacOS X", "Operating System :: MacOS :: MacOS X", "Operating System :: POSIX :: Linux", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.7", "Topic :: System :: Logging", "Topic :: System :: Monitoring", "Topic :: System :: Systems Administration"], "description": "[![Codeship Status for jgericke/automaton](https://app.codeship.com/projects/d8f9a710-6020-0137-cdfe-427ad6051c19/status?branch=master)](https://app.codeship.com/projects/343973) [![Docs](https://readthedocs.com/projects/lsd-automaton/badge/?version=latest)](https://readthedocs.com/projects/lsd-automaton/) [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT) [![Code style](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/python/black) [![codecov](https://codecov.io/gh/jgericke/automaton_engine/branch/master/graph/badge.svg)](https://codecov.io/gh/jgericke/automaton_engine)\n\n# Automaton Engine\n__Simple, Event-driven Automation in Python__\n\n![](docs/rsrc/automaton_logo.png)\n\n\nAutomaton Engine makes use of Elasticsearch as a general data aggregation layer. You feed your Automaton(s) queries\nvia environment variables (formatted in JSON). Based on the query result, you can chain actions together which\nAutomaton Engine will act on, passing query metadata off to action handlers and generally having a good time.\n\nBasically Automaton Engine is ***all*** about the following:\n\n1. Query Elasticsearch on a defined schedule\n2. Upon receiving a query response, execute defined actions and wait for a defined backoff period\n3. Return to querying\n4. ???\n5. Profit!\n\n## Current Actions \n\n* `notify` - Send a Rocket Chat webhook.\n* `awx` - Calls an Ansible AWX API endpoint.\n\n## Installation\n\nInstall via pip:\n```\n$ pip install automaton-engine\n```\n\nBuild from source:\n```\n$ git clone https://github.com/jgericke/automaton_engine.git\n$ python setup.py install\n```\n\nRun tests:\n```\n$ python setup.py test\n```\n\n\n## Example Workflow\n\n    1. Create an Elasticsearch query to read the number of orders being processed (assuming you have some sort of order system thats sending metrics to Elasticsearch...)\n    2. Create an Ansible AWX job template to scale up pods running in Kubernetes based (using say, extra_parameters or something)\n    3. Create an Automaton Engine instance that runs the above query, with an action to call the AWX job template based on query result\n    4. Good gravy, your pods are scaling on a transactional metric!\n\n## Automaton Features\n\n* Runs on python 3.7\n* Fully asynchronous.\n* Extendable (actions are functions created under automaton/actions).\n* Not your Grandad's Automaton Engine.\n\n## Adding Actions to Automaton Engine\n\n* Create a new action file: automaton_engine/actions/my_action.py\n* Actions are defined as a list within your `automaton` environment variable, and can be chained, for example the below action fires off a rocket chat webhook (this forms part of your AUTOMATON_ENGINE_CONFIG environment variable):\n\n```\n\"actions\": [\n    {\n        \"name\": \"notify.rocketchat_webhook\",\n        \"backoff_seconds\": 300, \n        \"parameters\": {\n            \"rocketchat_webhook\": \"https://my.rocketchat/hooks/my_webhook_id\",\n            \"rocketchat_message\": \"@here Things are happening!\\nView dashboard: https://my.kibana/goto/my_dashboard_id\",\n            \"rocketchat_timeout\": 20\n        }\n    }\n]\n```\n\n* When adding or extending an action, you need to make Automaton aware of the new action by adding it to automaton/automaton.py within the action_dispatcher (This will be simplified in the future). The below represents the action file and function name for ```actions/notify.py```.\n\n```\naction_dispatcher = {\n    \"notify.rocketchat_webhook\": notify.rocketchat_webhook \n}\n```\n\n### Creating An Automaton\n\nYou can launch Automaton Engine by defining the AUTOMATON_ENGINE_CONFIG environment variable, which has an expected structure as outlined below. When you're good to go, you can execute samples/auto.py which will gather all of the automatons you've defined and run them through the execution chain.\n\nHave a look at samples provided (```samples/```) to get a feel for scaffolding Automatons\n\n```\nexport AUTOMATON_ENGINE_LOGLEVEL='DEBUG'\nexport AUTOMATON_ENGINE_CONFIG='{ \n    \"automatons\": [\n        {\n            \"name\": \"my_neat_automaton\",\n            \"enabled\": True,\n            \"runonce\": False,\n            \"elasticsearch\": {\n                \"url\": \"https://http://my.elasticsearch:9200\",\n                \"timeout\": 10,\n                \"auth\": {\n                    \"username\": \"es_user\",\n                    \"password\": \"es_pass\",\n                },\n            },\n            \"elasticsearch_query\": {\n                \"query_interval\": 5,\n                \"query_endpoint\": \"/_search\",\n                \"query_type\": \"aggregations\",\n                \"query_name\": \"my_automaton_query\",\n                \"query_payload\": {\n\t\t\t\t\t\t\"size\": 0,\n\t\t\t\t\t\t\"query\": {\n\t\t\t\t\t\t    \"range\": {\n                                \"@timestamp\": {\n                                    \"gte\": \"now-1m\"\n                                }\n                            }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"aggregations\": {\n\t\t\t\t\t\t    \"bad_actors\": {\n                                \"terms\": {\n                                    \"field\": \"my_automaton_query.keyword\",\n                                    \"min_doc_count\": 1000\n                                }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n                },\n                \"query_response_mapping\": { \n                        \"key\": \"go_automaton_go\", \n                        \"doc_count\": \"hits\"\n                }\n            },\n            \"actions\": [\n                {\n                    \"name\": \"notify.rocketchat_webhook\",\n                    \"backoff_seconds\": 60,\n                    \"parameters\": {\n                        \"rocketchat_webhook\": \"https://my.rocketchat/hooks/my_webhook_id\",\n                        \"rocketchat_message\": \"@here Things are happening, Imma do stuff!\",\n                        \"rocketchat_timeout\": 10\n                    }\n                },\n                {\n                    \"name\": \"awx.api_call\",\n                    \"backoff_seconds\": 60,\n                    \"parameters\": {\n                        \"awx_url\": \"https://my.awx.url\",\n                        \"awx_context\": \"/api/v2/job_templates/1/launch/\",\n                        \"awx_timeout\": 20,\n                        \"awx_auth\": {\n                            \"username\": \"YXV0b21hdG9u\",\n                            \"password\": \"ZDY5VG5vZUdZYjdU\"\n                        }\n                    }\n                }\n            ]\n        }\n    ]\n}'\n```\n\n### Elasticsearch Authentication\n\nAutomaton now supports basic authentication for elasticsearch, to configure it add an \"auth\" section to your automaton configuration as per below:\n\n```\n            \"elasticsearch\": {\n                \"url\": \"https://http://my.elasticsearch:9200\",\n                \"timeout\": 10,\n                \"auth\": {\n                    \"username\": \"es_user\",\n                    \"password\": \"es_pass\",\n                },\n            },\n```\n\nNo elasticsearch authentication? No problem! Simply remove the auth stanza:\n\n```\n            \"elasticsearch\": {\n                \"url\": \"https://http://my.elasticsearch:9200\",\n                \"timeout\": 10,\n            },\n```\n\n#### Original Author(s)\n\n###### Julian Gericke\n###### (c) LSD\n###### [julian@lsd.co.za](mailto:julian@lsd.co.za)\n###### [Checkout LSD, your friendly OSS DevOps company!](https://lsd.co.za \"LSD Homepage\")\n\n#### Contributors\n\n- Maybe you?!\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/jgericke/automaton_engine", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "automaton-engine", "package_url": "https://pypi.org/project/automaton-engine/", "platform": "", "project_url": "https://pypi.org/project/automaton-engine/", "project_urls": {"Homepage": "https://github.com/jgericke/automaton_engine"}, "release_url": "https://pypi.org/project/automaton-engine/1.0.2/", "requires_dist": ["asyncio (>=3.4.3)", "aiohttp (>=3.5.4)", "biome (>=0.1.3)", "coverage (>=4.5.3) ; extra == 'dev'", "black (>=19.3b0) ; extra == 'dev'", "setuptools-black (>=0.1.4) ; extra == 'dev'", "flake8 (>=3.7.7) ; extra == 'dev'", "pre-commit (>=1.16.1) ; extra == 'dev'"], "requires_python": "~=3.7", "summary": "Simple, Event-driven Automation in Python using Elasticsearch data to inform automation decisions", "version": "1.0.2", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><a href=\"https://app.codeship.com/projects/343973\" rel=\"nofollow\"><img alt=\"Codeship Status for jgericke/automaton\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/f856f3c00892917fd1811001e1e85a2ff2422758/68747470733a2f2f6170702e636f6465736869702e636f6d2f70726f6a656374732f64386639613731302d363032302d303133372d636466652d3432376164363035316331392f7374617475733f6272616e63683d6d6173746572\"></a> <a href=\"https://readthedocs.com/projects/lsd-automaton/\" rel=\"nofollow\"><img alt=\"Docs\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/22f41e7d3f410c3c5539e9e3c8ad73422ad92009/68747470733a2f2f72656164746865646f63732e636f6d2f70726f6a656374732f6c73642d6175746f6d61746f6e2f62616467652f3f76657273696f6e3d6c6174657374\"></a> <a href=\"https://opensource.org/licenses/MIT\" rel=\"nofollow\"><img alt=\"License: MIT\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/8645b002dd7ec1b54275a80574942e7a318e03c6/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d79656c6c6f772e737667\"></a> <a href=\"https://github.com/python/black\" rel=\"nofollow\"><img alt=\"Code style\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/fbfdc7754183ecf079bc71ddeabaf88f6cbc5c00/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f64652532307374796c652d626c61636b2d3030303030302e737667\"></a> <a href=\"https://codecov.io/gh/jgericke/automaton_engine\" rel=\"nofollow\"><img alt=\"codecov\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/d8e568877b4b015c27869009dcc15d1a0c8a1d0f/68747470733a2f2f636f6465636f762e696f2f67682f6a67657269636b652f6175746f6d61746f6e5f656e67696e652f6272616e63682f6d61737465722f67726170682f62616467652e737667\"></a></p>\n<h1>Automaton Engine</h1>\n<p><strong>Simple, Event-driven Automation in Python</strong></p>\n<p><img alt=\"\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/ba31f5e4c8d02aca6121c871ea49b59dfbe676f0/646f63732f727372632f6175746f6d61746f6e5f6c6f676f2e706e67\"></p>\n<p>Automaton Engine makes use of Elasticsearch as a general data aggregation layer. You feed your Automaton(s) queries\nvia environment variables (formatted in JSON). Based on the query result, you can chain actions together which\nAutomaton Engine will act on, passing query metadata off to action handlers and generally having a good time.</p>\n<p>Basically Automaton Engine is <em><strong>all</strong></em> about the following:</p>\n<ol>\n<li>Query Elasticsearch on a defined schedule</li>\n<li>Upon receiving a query response, execute defined actions and wait for a defined backoff period</li>\n<li>Return to querying</li>\n<li>???</li>\n<li>Profit!</li>\n</ol>\n<h2>Current Actions</h2>\n<ul>\n<li><code>notify</code> - Send a Rocket Chat webhook.</li>\n<li><code>awx</code> - Calls an Ansible AWX API endpoint.</li>\n</ul>\n<h2>Installation</h2>\n<p>Install via pip:</p>\n<pre><code>$ pip install automaton-engine\n</code></pre>\n<p>Build from source:</p>\n<pre><code>$ git clone https://github.com/jgericke/automaton_engine.git\n$ python setup.py install\n</code></pre>\n<p>Run tests:</p>\n<pre><code>$ python setup.py test\n</code></pre>\n<h2>Example Workflow</h2>\n<pre><code>1. Create an Elasticsearch query to read the number of orders being processed (assuming you have some sort of order system thats sending metrics to Elasticsearch...)\n2. Create an Ansible AWX job template to scale up pods running in Kubernetes based (using say, extra_parameters or something)\n3. Create an Automaton Engine instance that runs the above query, with an action to call the AWX job template based on query result\n4. Good gravy, your pods are scaling on a transactional metric!\n</code></pre>\n<h2>Automaton Features</h2>\n<ul>\n<li>Runs on python 3.7</li>\n<li>Fully asynchronous.</li>\n<li>Extendable (actions are functions created under automaton/actions).</li>\n<li>Not your Grandad's Automaton Engine.</li>\n</ul>\n<h2>Adding Actions to Automaton Engine</h2>\n<ul>\n<li>Create a new action file: automaton_engine/actions/my_action.py</li>\n<li>Actions are defined as a list within your <code>automaton</code> environment variable, and can be chained, for example the below action fires off a rocket chat webhook (this forms part of your AUTOMATON_ENGINE_CONFIG environment variable):</li>\n</ul>\n<pre><code>\"actions\": [\n    {\n        \"name\": \"notify.rocketchat_webhook\",\n        \"backoff_seconds\": 300, \n        \"parameters\": {\n            \"rocketchat_webhook\": \"https://my.rocketchat/hooks/my_webhook_id\",\n            \"rocketchat_message\": \"@here Things are happening!\\nView dashboard: https://my.kibana/goto/my_dashboard_id\",\n            \"rocketchat_timeout\": 20\n        }\n    }\n]\n</code></pre>\n<ul>\n<li>When adding or extending an action, you need to make Automaton aware of the new action by adding it to automaton/automaton.py within the action_dispatcher (This will be simplified in the future). The below represents the action file and function name for <code>actions/notify.py</code>.</li>\n</ul>\n<pre><code>action_dispatcher = {\n    \"notify.rocketchat_webhook\": notify.rocketchat_webhook \n}\n</code></pre>\n<h3>Creating An Automaton</h3>\n<p>You can launch Automaton Engine by defining the AUTOMATON_ENGINE_CONFIG environment variable, which has an expected structure as outlined below. When you're good to go, you can execute samples/auto.py which will gather all of the automatons you've defined and run them through the execution chain.</p>\n<p>Have a look at samples provided (<code>samples/</code>) to get a feel for scaffolding Automatons</p>\n<pre><code>export AUTOMATON_ENGINE_LOGLEVEL='DEBUG'\nexport AUTOMATON_ENGINE_CONFIG='{ \n    \"automatons\": [\n        {\n            \"name\": \"my_neat_automaton\",\n            \"enabled\": True,\n            \"runonce\": False,\n            \"elasticsearch\": {\n                \"url\": \"https://http://my.elasticsearch:9200\",\n                \"timeout\": 10,\n                \"auth\": {\n                    \"username\": \"es_user\",\n                    \"password\": \"es_pass\",\n                },\n            },\n            \"elasticsearch_query\": {\n                \"query_interval\": 5,\n                \"query_endpoint\": \"/_search\",\n                \"query_type\": \"aggregations\",\n                \"query_name\": \"my_automaton_query\",\n                \"query_payload\": {\n\t\t\t\t\t\t\"size\": 0,\n\t\t\t\t\t\t\"query\": {\n\t\t\t\t\t\t    \"range\": {\n                                \"@timestamp\": {\n                                    \"gte\": \"now-1m\"\n                                }\n                            }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"aggregations\": {\n\t\t\t\t\t\t    \"bad_actors\": {\n                                \"terms\": {\n                                    \"field\": \"my_automaton_query.keyword\",\n                                    \"min_doc_count\": 1000\n                                }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n                },\n                \"query_response_mapping\": { \n                        \"key\": \"go_automaton_go\", \n                        \"doc_count\": \"hits\"\n                }\n            },\n            \"actions\": [\n                {\n                    \"name\": \"notify.rocketchat_webhook\",\n                    \"backoff_seconds\": 60,\n                    \"parameters\": {\n                        \"rocketchat_webhook\": \"https://my.rocketchat/hooks/my_webhook_id\",\n                        \"rocketchat_message\": \"@here Things are happening, Imma do stuff!\",\n                        \"rocketchat_timeout\": 10\n                    }\n                },\n                {\n                    \"name\": \"awx.api_call\",\n                    \"backoff_seconds\": 60,\n                    \"parameters\": {\n                        \"awx_url\": \"https://my.awx.url\",\n                        \"awx_context\": \"/api/v2/job_templates/1/launch/\",\n                        \"awx_timeout\": 20,\n                        \"awx_auth\": {\n                            \"username\": \"YXV0b21hdG9u\",\n                            \"password\": \"ZDY5VG5vZUdZYjdU\"\n                        }\n                    }\n                }\n            ]\n        }\n    ]\n}'\n</code></pre>\n<h3>Elasticsearch Authentication</h3>\n<p>Automaton now supports basic authentication for elasticsearch, to configure it add an \"auth\" section to your automaton configuration as per below:</p>\n<pre><code>            \"elasticsearch\": {\n                \"url\": \"https://http://my.elasticsearch:9200\",\n                \"timeout\": 10,\n                \"auth\": {\n                    \"username\": \"es_user\",\n                    \"password\": \"es_pass\",\n                },\n            },\n</code></pre>\n<p>No elasticsearch authentication? No problem! Simply remove the auth stanza:</p>\n<pre><code>            \"elasticsearch\": {\n                \"url\": \"https://http://my.elasticsearch:9200\",\n                \"timeout\": 10,\n            },\n</code></pre>\n<h4>Original Author(s)</h4>\n<h6>Julian Gericke</h6>\n<h6>(c) LSD</h6>\n<h6><a href=\"mailto:julian@lsd.co.za\">julian@lsd.co.za</a></h6>\n<h6><a href=\"https://lsd.co.za\" rel=\"nofollow\" title=\"LSD Homepage\">Checkout LSD, your friendly OSS DevOps company!</a></h6>\n<h4>Contributors</h4>\n<ul>\n<li>Maybe you?!</li>\n</ul>\n\n          </div>"}, "last_serial": 6147432, "releases": {"1.0.1": [{"comment_text": "", "digests": {"md5": "ddd8018d6c218a7e77b52aedd0f73bcc", "sha256": "1b3882350a44c546008de294b4a5b7ab97bec5ec1492cbf6b3711a17a1b421ba"}, "downloads": -1, "filename": "automaton_engine-1.0.1-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "ddd8018d6c218a7e77b52aedd0f73bcc", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": "~=3.7", "size": 10393, "upload_time": "2019-06-05T06:48:03", "upload_time_iso_8601": "2019-06-05T06:48:03.494030Z", "url": "https://files.pythonhosted.org/packages/c8/7d/5c4c4fafcd934bb182315b4ca5093eee690e2c769a0259cbff9147ff8c15/automaton_engine-1.0.1-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "4053d773822e50b4eed84d2f096ce096", "sha256": "f7760a473fb630bd88d73d66552d5b18ecac01cafe0333ef6c8bdc09add303c5"}, "downloads": -1, "filename": "automaton_engine-1.0.1.tar.gz", "has_sig": false, "md5_digest": "4053d773822e50b4eed84d2f096ce096", "packagetype": "sdist", "python_version": "source", "requires_python": "~=3.7", "size": 8762, "upload_time": "2019-06-05T06:34:38", "upload_time_iso_8601": "2019-06-05T06:34:38.005242Z", "url": "https://files.pythonhosted.org/packages/cb/26/7351be3a943415efb9ef9d6ce8b7b0f6b5b6155e9a3b276fb239c0f16c33/automaton_engine-1.0.1.tar.gz", "yanked": false}], "1.0.2": [{"comment_text": "", "digests": {"md5": "5d07c295b615938ad00369d75315e6e1", "sha256": "b250bcb54a36dd6f22063e67c8faedf4d35c21ea31f6dcd7ea69befec447e74f"}, "downloads": -1, "filename": "automaton_engine-1.0.2-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "5d07c295b615938ad00369d75315e6e1", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": "~=3.7", "size": 10773, "upload_time": "2019-11-16T16:03:53", "upload_time_iso_8601": "2019-11-16T16:03:53.601647Z", "url": "https://files.pythonhosted.org/packages/2a/dc/986827002503c9504d9d4a9a681d2f38b2971bb42d8688b67380ed62a7e6/automaton_engine-1.0.2-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "9d348a554b5325fd0f82b69e766b0e23", "sha256": "9c28e1926401d56c82334e3379c5df6e9a48bf85ade8ccdb221963d8fbc0feba"}, "downloads": -1, "filename": "automaton_engine-1.0.2.tar.gz", "has_sig": false, "md5_digest": "9d348a554b5325fd0f82b69e766b0e23", "packagetype": "sdist", "python_version": "source", "requires_python": "~=3.7", "size": 9594, "upload_time": "2019-11-16T16:03:55", "upload_time_iso_8601": "2019-11-16T16:03:55.364496Z", "url": "https://files.pythonhosted.org/packages/9a/85/2390f2bdd6e9b6d77755f130cce8bf36a70557833fb591fa69c3c4fa51ac/automaton_engine-1.0.2.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "5d07c295b615938ad00369d75315e6e1", "sha256": "b250bcb54a36dd6f22063e67c8faedf4d35c21ea31f6dcd7ea69befec447e74f"}, "downloads": -1, "filename": "automaton_engine-1.0.2-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "5d07c295b615938ad00369d75315e6e1", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": "~=3.7", "size": 10773, "upload_time": "2019-11-16T16:03:53", "upload_time_iso_8601": "2019-11-16T16:03:53.601647Z", "url": "https://files.pythonhosted.org/packages/2a/dc/986827002503c9504d9d4a9a681d2f38b2971bb42d8688b67380ed62a7e6/automaton_engine-1.0.2-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "9d348a554b5325fd0f82b69e766b0e23", "sha256": "9c28e1926401d56c82334e3379c5df6e9a48bf85ade8ccdb221963d8fbc0feba"}, "downloads": -1, "filename": "automaton_engine-1.0.2.tar.gz", "has_sig": false, "md5_digest": "9d348a554b5325fd0f82b69e766b0e23", "packagetype": "sdist", "python_version": "source", "requires_python": "~=3.7", "size": 9594, "upload_time": "2019-11-16T16:03:55", "upload_time_iso_8601": "2019-11-16T16:03:55.364496Z", "url": "https://files.pythonhosted.org/packages/9a/85/2390f2bdd6e9b6d77755f130cce8bf36a70557833fb591fa69c3c4fa51ac/automaton_engine-1.0.2.tar.gz", "yanked": false}], "timestamp": "Thu May  7 18:16:13 2020"}