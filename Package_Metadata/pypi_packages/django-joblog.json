{"info": {"author": "Stefan Berke", "author_email": "s.berke@netzkolchose.de", "bugtrack_url": null, "classifiers": ["Development Status :: 3 - Alpha", "Framework :: Django", "Framework :: Django :: 1.10", "Framework :: Django :: 2.0", "Intended Audience :: Developers", "License :: OSI Approved :: MIT License", "Natural Language :: English", "Operating System :: OS Independent", "Programming Language :: Python", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.3", "Programming Language :: Python :: 3.4", "Programming Language :: Python :: 3.5", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7", "Topic :: Software Development :: Libraries :: Python Modules"], "description": "# django-joblog v0.2.2\n\nA generic django-utility that helps to log stuff to the database.\n\n- [Installation](#installation)\n- [Usage](#usage)\n    - [Parallelism](#parallelism)\n    - [Context](#context)\n    - [DummyJobLogger](#dummyjoblogger)\n    - [Using the Model](#using-the-model)\n- [Configuration](#configuration)\n    - [DB alias](#db-alias)\n    - [Live updates](#live-updates)\n    - [Ping mode](#ping)\n- [Testing](#testing)\n    - [This repo](#the-repository)\n\n\n# Overview\n\n```python\nfrom django_joblog import JobLogger\n\nwith JobLogger(\"task-name\") as log:\n    log.log(\"task started\")\n    if 1 != 2:\n        log.error(\"The impossible happened!\") \n```\n\nThe following information is stored to the database for further inspection:\n- the task's name\n- the count of invocation for the specific task\n- start-time\n- end-time\n- duration \n- any log or error output \n- the exception trace, for exception occurring inside the `with`-block\n\nThis can be useful in conjuction with cronjobs and asynchronous tasks with, e.g., these libraries:\n[django-kronos](https://github.com/jgorset/django-kronos), \n[django-rq](https://github.com/rq/django-rq), [rabbitmq](https://www.rabbitmq.com/)...\n\n\n# Installation\n\n```bash\npip install django-joblog\n```\n\nThen add `django_joblog` to `INSTALLED_APPS` in your django `settings.py` and call `manage.py migrate`.\n\n## Requirements\n\n- [Python](https://www.python.org) 2 or 3\n- [Django](https://www.djangoproject.com) >= 1.10\n\n\n# Usage \n\n### Parallelism\n\nBy default, jobs are not allowed to run in parallel. This can be changed with `parallel=True` in \nthe `JobLogger` constructor. \n\n**If you start a JobLogger while a job with the same name is already\nrunning, a `django_joblog.JobIsAlreadyRunningError` is raised.** Additionally, a job log entry\nin the database will be created with `blocked` state.\n\nFor example, you might have a cronjob that runs every minute and looks for open tasks in the \ndatabase. If you wrap the task in a `JobLogger` you can be sure, that the tasks are not \nworked on in parallel:\n\n```python\nfrom django_joblog import JobLogger, JobIsAlreadyRunningError\n\ndef cronjob_open_task_worker():\n    if open_tasks():\n        with JobLogger(\"work-open-tasks\") as log:\n            work_open_tasks(log)\n            \n# to avoid the error message on multiple invocation:\ndef cronjob_open_task_worker():\n    if open_tasks():\n        try:\n            with JobLogger(\"work-open-tasks\") as log:\n                work_open_tasks(log)\n        except JobIsAlreadyRunningError:\n            pass\n```\n\n### Context\n\nTo change the logging-context within a job, use `JobLoggerContext`. \nIt might help to spot at which point an output is generated or an exception is thrown.\n\n```python\nfrom django_joblog import JobLogger, JobLoggerContext\n\nwith JobLogger(\"pull-the-api\") as log:\n    \n    credentials = get_credentials()\n    log.log(\"using user %s\" % credentials.name)\n    \n    with JobLoggerContext(log, \"api\"):\n        api = Api(credentials)\n        log.log(\"connected\")\n        \n        with JobLoggerContext(log, \"submit\"):\n            api.submit(data)\n            log.log(\"%s items submitted\" % len(data))\n            \n        with JobLoggerContext(log, \"check result\"):\n            log.log(api.check_result())\n```            \n\nThe log output in database will look like this:\n```\nusing user Herbert\napi: connected\napi:submit: 42 items submitted\napi:check result: 23 items updated\n```\n\nAn exception caught by the error log might look like this:\n```\napi:submit: IOError - Status code 404 returned for url https://my.api.com/submit\n File \"/home/user/python/awesome_project/api/Api.py, line 178, in Api._make_request\n   self.session.post(url, data=params)\n File \"/home/user/python/awesome_project/api/Api.py, line 66, in Api.submit\n   self._make_request(url, params)\n File \"/home/user/python/awesome_project/main.py, line 12\n   api.submit(data) \n```\n\nAs can be seen, a `JobLoggerContext` does not pop it's name from the context stack \nin case of an exception! Which means, catching exceptions within higher context levels \nthan where those exceptions where raised does not leave a valid context stack if \nyou resume work after the caught exception.    \n\n#### inspecting exceptions\n\nAn exception is kept in the `exception` property of the `JobLogger` instance:\n\n```python\nwith JobLogger(\"test-exception\") as job:\n    raise ValueError(\"This was bad\")\n\nassert isinstance(job.exception, ValueError)\nassert \"This was bad\" == str(job.exception)\nassert job.traceback\n```\n\n### DummyJobLogger\n\nYou can use the `DummyJobLogger` class to provide logging without storing stuff to the database. \nThis might be useful for debugging purposes, or if you run a function as a `manage.py`-task but\nneed database logging only for cronjobs.\n\nIn general, functions can be designed to work with a `JobLogger` but do not *require* it.\n\n```python\nfrom django_joblog import JobLogger, DummyJobLogger\n\ndef buy_eggs(log=None):\n    log = log or DummyJobLogger()\n    \n    log.log(\"Gonna buy some eggs!\")\n    ...\n\ndef cronjob_invokation():\n    with JobLogger(\"buy-eggs\") as log:\n        buy_eggs(log)\n        \ndef debug_invokation():\n    buy_eggs()\n\n```\n\n### Using the model\n\nBy default, there is a django admin view for the `JobLogModel`. \nYou can find the model, as usual, in `django_joblog.models`. \nPlease check the file [django_joblog/models.py](https://github.com/defgsus/django-joblog/blob/master/django_joblog/models.py)\nfor the specific fields. It's nothing special.\n\n![admin changelist screenshot](./docs/admin-changelist.png)\n\n\n# Configuration\n\nThe `django_joblog` app can be configured with an object in your django project `settings.py`, \nfor example:\n\n```python\nJOBLOG_CONFIG = {\n    # name of alternate database connection, to circumvent transactions on default connection\n    \"db_alias\": \"joblog\",\n    # enable .log and .error to write to database immediately\n    \"live_updates\": True,\n    # enable a constant update of job state - to check for jobs which went away without notice\n    \"ping\": True,\n    \"ping_interval\": 1,\n    # always print to console during jobs\n    \"print_to_console\": True\n}\n```\n\nThe whole object and all of it's fields are optional. \n\n### db_alias\n\n`db_alias` defines an alternative name for the database connection. \nThis name must be present in the `DATABASE` setting. \n\nOne does not normally need to define this setting unless you want to make sure that \n[Live updates](#live-updates) or using the [Ping mode](#ping) always work even when transactions\nare used inside the job body. Consider this example:\n\n```python\nfrom django.db import transaction\nfrom django_joblog import JobLogger\n\nwith JobLogger(\"my-job\") as job:\n    job.log(\"Outside transaction\")\n    with transaction.atomic():\n        job.log(\"Inside transaction\")\n        # ...other stuff...\n```   \n\nIf you are using [Live updates](#live-updates) and need to make sure that the second log \n(\"Inside transaction\") is immediately stored to the database you need to define a second \ndatabase connection. It can just be a copy of the `'default'` database setting.    \n\n### live updates\n\nSetting `live_updates` to `True` will store the current log and error texts as long with the current\njob duration to database whenever `JobLogger.log()` or `JobLogger.error()` are called.\n\n### ping\n\nSetting `ping` to `True` will spawn a separate thread when calling `with JobLogger(...)` that will \nconstantly update the joblog database with the current log text, error text and duration. \nThe update-interval is configured with `ping_interval` in seconds. \n\nNormally, if a job exits unexpectedly (segfault, power-off, restart of vm, etc..) it's state in \nthe database will stay `running` forever. \nNew jobs with the same name will be blocked from execution.\n\nHowever, enabling `ping` mode will make sure, that if a job (in database) who's `duration` is \nyet undefined or larger than the `ping_interval` can be considered stopped.  \n\nTo set those dangling job's database state to `vanished` use: \n```bash\n./manage.py joblog_cleanup\n```\nor \n```python\nfrom django_joblog.models import JobLogModel\nJobLogModel.cleanup()\n```\n\n\n# Testing\n\nUnit-tests are [Django-style](https://docs.djangoproject.com/en/2.0/topics/testing/overview/#running-tests) \nand are placed in [django_joblog/tests/](https://github.com/defgsus/django-joblog/blob/master/django_joblog/tests/).\n\nNote that the *parallel* tests will fail with the **Sqlite** backend, because of database-locking.\n\n## The repository\n\n[The repo](https://github.com/defgsus/django-joblog) contains a whole django project (`django_joblog_project`) \nfor ease of development. `setup.py` only exports the `django_joblog` app. \n\nThe default database backend is configured to **MySQL**.\n\nTo start the runserver or run the tests within the repo, open mysql console:\n\n```mysql\nCREATE USER 'django_logs_user'@'localhost' IDENTIFIED BY 'django_logs_pwd';\n\nCREATE DATABASE django_logs_test CHARACTER SET utf8 COLLATE utf8_general_ci;\n\nGRANT ALL ON django_logs_test.* TO 'django_logs_user'@'localhost';\nGRANT ALL ON django_logs_test_test.* TO 'django_logs_user'@'localhost';\n``` \n\nThen alternatively, depending on the python version:\n```bash\npip install MySQL-python    # for python 2\n\npip install PyMySQL         # for python 3\npip install mysqlclient     #   or alternatively\n```\n\nAnd finally:\n```bash\n./manage.py test\n\n# or\n./manage.py migrate\n./manage.py runserver\n```\n\n\n## Changelog\n## v0.2.5 - Nov/2019\n\n- add `JobLogger.exception` property for inspection after the run \n\n## v0.2.4 - Apr/2019\n\n- add 'blocked' state entry on failed parallel job runs \n\n## v0.2.3 \n\n- fix joblog model access\n\n## v0.2.2 \n\n- add `JOBLOG_CONFIG` setting\n- add `live_updates` and `ping` mode\n\n## v0.1.1 - Aug/2018\n\n- add search and filter to admin view\n\n## v0.1.0 - Jul/2018\n\n- make printing to console optional\n- add django unit-tests\n\n## v0.0.1 \n\n- Copy-pasted together from various private projects, 'sanitized' and repackaged for PyPi", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/defgsus/django-joblog", "keywords": "django database logging", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "django-joblog", "package_url": "https://pypi.org/project/django-joblog/", "platform": "", "project_url": "https://pypi.org/project/django-joblog/", "project_urls": {"Homepage": "https://github.com/defgsus/django-joblog"}, "release_url": "https://pypi.org/project/django-joblog/0.2.5/", "requires_dist": null, "requires_python": ">=2.6, <4", "summary": "A generic django-utility that helps to log stuff to the database.", "version": "0.2.5", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>django-joblog v0.2.2</h1>\n<p>A generic django-utility that helps to log stuff to the database.</p>\n<ul>\n<li><a href=\"#installation\" rel=\"nofollow\">Installation</a></li>\n<li><a href=\"#usage\" rel=\"nofollow\">Usage</a>\n<ul>\n<li><a href=\"#parallelism\" rel=\"nofollow\">Parallelism</a></li>\n<li><a href=\"#context\" rel=\"nofollow\">Context</a></li>\n<li><a href=\"#dummyjoblogger\" rel=\"nofollow\">DummyJobLogger</a></li>\n<li><a href=\"#using-the-model\" rel=\"nofollow\">Using the Model</a></li>\n</ul>\n</li>\n<li><a href=\"#configuration\" rel=\"nofollow\">Configuration</a>\n<ul>\n<li><a href=\"#db-alias\" rel=\"nofollow\">DB alias</a></li>\n<li><a href=\"#live-updates\" rel=\"nofollow\">Live updates</a></li>\n<li><a href=\"#ping\" rel=\"nofollow\">Ping mode</a></li>\n</ul>\n</li>\n<li><a href=\"#testing\" rel=\"nofollow\">Testing</a>\n<ul>\n<li><a href=\"#the-repository\" rel=\"nofollow\">This repo</a></li>\n</ul>\n</li>\n</ul>\n<h1>Overview</h1>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_joblog</span> <span class=\"kn\">import</span> <span class=\"n\">JobLogger</span>\n\n<span class=\"k\">with</span> <span class=\"n\">JobLogger</span><span class=\"p\">(</span><span class=\"s2\">\"task-name\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">log</span><span class=\"p\">:</span>\n    <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">\"task started\"</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"mi\">1</span> <span class=\"o\">!=</span> <span class=\"mi\">2</span><span class=\"p\">:</span>\n        <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"s2\">\"The impossible happened!\"</span><span class=\"p\">)</span> \n</pre>\n<p>The following information is stored to the database for further inspection:</p>\n<ul>\n<li>the task's name</li>\n<li>the count of invocation for the specific task</li>\n<li>start-time</li>\n<li>end-time</li>\n<li>duration</li>\n<li>any log or error output</li>\n<li>the exception trace, for exception occurring inside the <code>with</code>-block</li>\n</ul>\n<p>This can be useful in conjuction with cronjobs and asynchronous tasks with, e.g., these libraries:\n<a href=\"https://github.com/jgorset/django-kronos\" rel=\"nofollow\">django-kronos</a>,\n<a href=\"https://github.com/rq/django-rq\" rel=\"nofollow\">django-rq</a>, <a href=\"https://www.rabbitmq.com/\" rel=\"nofollow\">rabbitmq</a>...</p>\n<h1>Installation</h1>\n<pre>pip install django-joblog\n</pre>\n<p>Then add <code>django_joblog</code> to <code>INSTALLED_APPS</code> in your django <code>settings.py</code> and call <code>manage.py migrate</code>.</p>\n<h2>Requirements</h2>\n<ul>\n<li><a href=\"https://www.python.org\" rel=\"nofollow\">Python</a> 2 or 3</li>\n<li><a href=\"https://www.djangoproject.com\" rel=\"nofollow\">Django</a> &gt;= 1.10</li>\n</ul>\n<h1>Usage</h1>\n<h3>Parallelism</h3>\n<p>By default, jobs are not allowed to run in parallel. This can be changed with <code>parallel=True</code> in\nthe <code>JobLogger</code> constructor.</p>\n<p><strong>If you start a JobLogger while a job with the same name is already\nrunning, a <code>django_joblog.JobIsAlreadyRunningError</code> is raised.</strong> Additionally, a job log entry\nin the database will be created with <code>blocked</code> state.</p>\n<p>For example, you might have a cronjob that runs every minute and looks for open tasks in the\ndatabase. If you wrap the task in a <code>JobLogger</code> you can be sure, that the tasks are not\nworked on in parallel:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_joblog</span> <span class=\"kn\">import</span> <span class=\"n\">JobLogger</span><span class=\"p\">,</span> <span class=\"n\">JobIsAlreadyRunningError</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">cronjob_open_task_worker</span><span class=\"p\">():</span>\n    <span class=\"k\">if</span> <span class=\"n\">open_tasks</span><span class=\"p\">():</span>\n        <span class=\"k\">with</span> <span class=\"n\">JobLogger</span><span class=\"p\">(</span><span class=\"s2\">\"work-open-tasks\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">log</span><span class=\"p\">:</span>\n            <span class=\"n\">work_open_tasks</span><span class=\"p\">(</span><span class=\"n\">log</span><span class=\"p\">)</span>\n            \n<span class=\"c1\"># to avoid the error message on multiple invocation:</span>\n<span class=\"k\">def</span> <span class=\"nf\">cronjob_open_task_worker</span><span class=\"p\">():</span>\n    <span class=\"k\">if</span> <span class=\"n\">open_tasks</span><span class=\"p\">():</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"k\">with</span> <span class=\"n\">JobLogger</span><span class=\"p\">(</span><span class=\"s2\">\"work-open-tasks\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">log</span><span class=\"p\">:</span>\n                <span class=\"n\">work_open_tasks</span><span class=\"p\">(</span><span class=\"n\">log</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"n\">JobIsAlreadyRunningError</span><span class=\"p\">:</span>\n            <span class=\"k\">pass</span>\n</pre>\n<h3>Context</h3>\n<p>To change the logging-context within a job, use <code>JobLoggerContext</code>.\nIt might help to spot at which point an output is generated or an exception is thrown.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_joblog</span> <span class=\"kn\">import</span> <span class=\"n\">JobLogger</span><span class=\"p\">,</span> <span class=\"n\">JobLoggerContext</span>\n\n<span class=\"k\">with</span> <span class=\"n\">JobLogger</span><span class=\"p\">(</span><span class=\"s2\">\"pull-the-api\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">log</span><span class=\"p\">:</span>\n    \n    <span class=\"n\">credentials</span> <span class=\"o\">=</span> <span class=\"n\">get_credentials</span><span class=\"p\">()</span>\n    <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">\"using user </span><span class=\"si\">%s</span><span class=\"s2\">\"</span> <span class=\"o\">%</span> <span class=\"n\">credentials</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n    \n    <span class=\"k\">with</span> <span class=\"n\">JobLoggerContext</span><span class=\"p\">(</span><span class=\"n\">log</span><span class=\"p\">,</span> <span class=\"s2\">\"api\"</span><span class=\"p\">):</span>\n        <span class=\"n\">api</span> <span class=\"o\">=</span> <span class=\"n\">Api</span><span class=\"p\">(</span><span class=\"n\">credentials</span><span class=\"p\">)</span>\n        <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">\"connected\"</span><span class=\"p\">)</span>\n        \n        <span class=\"k\">with</span> <span class=\"n\">JobLoggerContext</span><span class=\"p\">(</span><span class=\"n\">log</span><span class=\"p\">,</span> <span class=\"s2\">\"submit\"</span><span class=\"p\">):</span>\n            <span class=\"n\">api</span><span class=\"o\">.</span><span class=\"n\">submit</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n            <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">\"</span><span class=\"si\">%s</span><span class=\"s2\"> items submitted\"</span> <span class=\"o\">%</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">))</span>\n            \n        <span class=\"k\">with</span> <span class=\"n\">JobLoggerContext</span><span class=\"p\">(</span><span class=\"n\">log</span><span class=\"p\">,</span> <span class=\"s2\">\"check result\"</span><span class=\"p\">):</span>\n            <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">api</span><span class=\"o\">.</span><span class=\"n\">check_result</span><span class=\"p\">())</span>\n</pre>\n<p>The log output in database will look like this:</p>\n<pre><code>using user Herbert\napi: connected\napi:submit: 42 items submitted\napi:check result: 23 items updated\n</code></pre>\n<p>An exception caught by the error log might look like this:</p>\n<pre><code>api:submit: IOError - Status code 404 returned for url https://my.api.com/submit\n File \"/home/user/python/awesome_project/api/Api.py, line 178, in Api._make_request\n   self.session.post(url, data=params)\n File \"/home/user/python/awesome_project/api/Api.py, line 66, in Api.submit\n   self._make_request(url, params)\n File \"/home/user/python/awesome_project/main.py, line 12\n   api.submit(data) \n</code></pre>\n<p>As can be seen, a <code>JobLoggerContext</code> does not pop it's name from the context stack\nin case of an exception! Which means, catching exceptions within higher context levels\nthan where those exceptions where raised does not leave a valid context stack if\nyou resume work after the caught exception.</p>\n<h4>inspecting exceptions</h4>\n<p>An exception is kept in the <code>exception</code> property of the <code>JobLogger</code> instance:</p>\n<pre><span class=\"k\">with</span> <span class=\"n\">JobLogger</span><span class=\"p\">(</span><span class=\"s2\">\"test-exception\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">job</span><span class=\"p\">:</span>\n    <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s2\">\"This was bad\"</span><span class=\"p\">)</span>\n\n<span class=\"k\">assert</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">job</span><span class=\"o\">.</span><span class=\"n\">exception</span><span class=\"p\">,</span> <span class=\"ne\">ValueError</span><span class=\"p\">)</span>\n<span class=\"k\">assert</span> <span class=\"s2\">\"This was bad\"</span> <span class=\"o\">==</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">job</span><span class=\"o\">.</span><span class=\"n\">exception</span><span class=\"p\">)</span>\n<span class=\"k\">assert</span> <span class=\"n\">job</span><span class=\"o\">.</span><span class=\"n\">traceback</span>\n</pre>\n<h3>DummyJobLogger</h3>\n<p>You can use the <code>DummyJobLogger</code> class to provide logging without storing stuff to the database.\nThis might be useful for debugging purposes, or if you run a function as a <code>manage.py</code>-task but\nneed database logging only for cronjobs.</p>\n<p>In general, functions can be designed to work with a <code>JobLogger</code> but do not <em>require</em> it.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_joblog</span> <span class=\"kn\">import</span> <span class=\"n\">JobLogger</span><span class=\"p\">,</span> <span class=\"n\">DummyJobLogger</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">buy_eggs</span><span class=\"p\">(</span><span class=\"n\">log</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"n\">log</span> <span class=\"o\">=</span> <span class=\"n\">log</span> <span class=\"ow\">or</span> <span class=\"n\">DummyJobLogger</span><span class=\"p\">()</span>\n    \n    <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">\"Gonna buy some eggs!\"</span><span class=\"p\">)</span>\n    <span class=\"o\">...</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">cronjob_invokation</span><span class=\"p\">():</span>\n    <span class=\"k\">with</span> <span class=\"n\">JobLogger</span><span class=\"p\">(</span><span class=\"s2\">\"buy-eggs\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">log</span><span class=\"p\">:</span>\n        <span class=\"n\">buy_eggs</span><span class=\"p\">(</span><span class=\"n\">log</span><span class=\"p\">)</span>\n        \n<span class=\"k\">def</span> <span class=\"nf\">debug_invokation</span><span class=\"p\">():</span>\n    <span class=\"n\">buy_eggs</span><span class=\"p\">()</span>\n</pre>\n<h3>Using the model</h3>\n<p>By default, there is a django admin view for the <code>JobLogModel</code>.\nYou can find the model, as usual, in <code>django_joblog.models</code>.\nPlease check the file <a href=\"https://github.com/defgsus/django-joblog/blob/master/django_joblog/models.py\" rel=\"nofollow\">django_joblog/models.py</a>\nfor the specific fields. It's nothing special.</p>\n<p><img alt=\"admin changelist screenshot\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/af1d4d5267d891c0cb128a6887afc822d1646b19/2e2f646f63732f61646d696e2d6368616e67656c6973742e706e67\"></p>\n<h1>Configuration</h1>\n<p>The <code>django_joblog</code> app can be configured with an object in your django project <code>settings.py</code>,\nfor example:</p>\n<pre><span class=\"n\">JOBLOG_CONFIG</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"c1\"># name of alternate database connection, to circumvent transactions on default connection</span>\n    <span class=\"s2\">\"db_alias\"</span><span class=\"p\">:</span> <span class=\"s2\">\"joblog\"</span><span class=\"p\">,</span>\n    <span class=\"c1\"># enable .log and .error to write to database immediately</span>\n    <span class=\"s2\">\"live_updates\"</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"c1\"># enable a constant update of job state - to check for jobs which went away without notice</span>\n    <span class=\"s2\">\"ping\"</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"s2\">\"ping_interval\"</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n    <span class=\"c1\"># always print to console during jobs</span>\n    <span class=\"s2\">\"print_to_console\"</span><span class=\"p\">:</span> <span class=\"kc\">True</span>\n<span class=\"p\">}</span>\n</pre>\n<p>The whole object and all of it's fields are optional.</p>\n<h3>db_alias</h3>\n<p><code>db_alias</code> defines an alternative name for the database connection.\nThis name must be present in the <code>DATABASE</code> setting.</p>\n<p>One does not normally need to define this setting unless you want to make sure that\n<a href=\"#live-updates\" rel=\"nofollow\">Live updates</a> or using the <a href=\"#ping\" rel=\"nofollow\">Ping mode</a> always work even when transactions\nare used inside the job body. Consider this example:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django.db</span> <span class=\"kn\">import</span> <span class=\"n\">transaction</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django_joblog</span> <span class=\"kn\">import</span> <span class=\"n\">JobLogger</span>\n\n<span class=\"k\">with</span> <span class=\"n\">JobLogger</span><span class=\"p\">(</span><span class=\"s2\">\"my-job\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">job</span><span class=\"p\">:</span>\n    <span class=\"n\">job</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">\"Outside transaction\"</span><span class=\"p\">)</span>\n    <span class=\"k\">with</span> <span class=\"n\">transaction</span><span class=\"o\">.</span><span class=\"n\">atomic</span><span class=\"p\">():</span>\n        <span class=\"n\">job</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">\"Inside transaction\"</span><span class=\"p\">)</span>\n        <span class=\"c1\"># ...other stuff...</span>\n</pre>\n<p>If you are using <a href=\"#live-updates\" rel=\"nofollow\">Live updates</a> and need to make sure that the second log\n(\"Inside transaction\") is immediately stored to the database you need to define a second\ndatabase connection. It can just be a copy of the <code>'default'</code> database setting.</p>\n<h3>live updates</h3>\n<p>Setting <code>live_updates</code> to <code>True</code> will store the current log and error texts as long with the current\njob duration to database whenever <code>JobLogger.log()</code> or <code>JobLogger.error()</code> are called.</p>\n<h3>ping</h3>\n<p>Setting <code>ping</code> to <code>True</code> will spawn a separate thread when calling <code>with JobLogger(...)</code> that will\nconstantly update the joblog database with the current log text, error text and duration.\nThe update-interval is configured with <code>ping_interval</code> in seconds.</p>\n<p>Normally, if a job exits unexpectedly (segfault, power-off, restart of vm, etc..) it's state in\nthe database will stay <code>running</code> forever.\nNew jobs with the same name will be blocked from execution.</p>\n<p>However, enabling <code>ping</code> mode will make sure, that if a job (in database) who's <code>duration</code> is\nyet undefined or larger than the <code>ping_interval</code> can be considered stopped.</p>\n<p>To set those dangling job's database state to <code>vanished</code> use:</p>\n<pre>./manage.py joblog_cleanup\n</pre>\n<p>or</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_joblog.models</span> <span class=\"kn\">import</span> <span class=\"n\">JobLogModel</span>\n<span class=\"n\">JobLogModel</span><span class=\"o\">.</span><span class=\"n\">cleanup</span><span class=\"p\">()</span>\n</pre>\n<h1>Testing</h1>\n<p>Unit-tests are <a href=\"https://docs.djangoproject.com/en/2.0/topics/testing/overview/#running-tests\" rel=\"nofollow\">Django-style</a>\nand are placed in <a href=\"https://github.com/defgsus/django-joblog/blob/master/django_joblog/tests/\" rel=\"nofollow\">django_joblog/tests/</a>.</p>\n<p>Note that the <em>parallel</em> tests will fail with the <strong>Sqlite</strong> backend, because of database-locking.</p>\n<h2>The repository</h2>\n<p><a href=\"https://github.com/defgsus/django-joblog\" rel=\"nofollow\">The repo</a> contains a whole django project (<code>django_joblog_project</code>)\nfor ease of development. <code>setup.py</code> only exports the <code>django_joblog</code> app.</p>\n<p>The default database backend is configured to <strong>MySQL</strong>.</p>\n<p>To start the runserver or run the tests within the repo, open mysql console:</p>\n<pre><span class=\"k\">CREATE</span> <span class=\"n\">USER</span> <span class=\"s1\">'django_logs_user'</span><span class=\"o\">@</span><span class=\"s1\">'localhost'</span> <span class=\"n\">IDENTIFIED</span> <span class=\"k\">BY</span> <span class=\"s1\">'django_logs_pwd'</span><span class=\"p\">;</span>\n\n<span class=\"k\">CREATE</span> <span class=\"k\">DATABASE</span> <span class=\"n\">django_logs_test</span> <span class=\"k\">CHARACTER</span> <span class=\"kt\">SET</span> <span class=\"n\">utf8</span> <span class=\"k\">COLLATE</span> <span class=\"n\">utf8_general_ci</span><span class=\"p\">;</span>\n\n<span class=\"k\">GRANT</span> <span class=\"k\">ALL</span> <span class=\"k\">ON</span> <span class=\"n\">django_logs_test</span><span class=\"p\">.</span><span class=\"o\">*</span> <span class=\"k\">TO</span> <span class=\"s1\">'django_logs_user'</span><span class=\"o\">@</span><span class=\"s1\">'localhost'</span><span class=\"p\">;</span>\n<span class=\"k\">GRANT</span> <span class=\"k\">ALL</span> <span class=\"k\">ON</span> <span class=\"n\">django_logs_test_test</span><span class=\"p\">.</span><span class=\"o\">*</span> <span class=\"k\">TO</span> <span class=\"s1\">'django_logs_user'</span><span class=\"o\">@</span><span class=\"s1\">'localhost'</span><span class=\"p\">;</span>\n</pre>\n<p>Then alternatively, depending on the python version:</p>\n<pre>pip install MySQL-python    <span class=\"c1\"># for python 2</span>\n\npip install PyMySQL         <span class=\"c1\"># for python 3</span>\npip install mysqlclient     <span class=\"c1\">#   or alternatively</span>\n</pre>\n<p>And finally:</p>\n<pre>./manage.py <span class=\"nb\">test</span>\n\n<span class=\"c1\"># or</span>\n./manage.py migrate\n./manage.py runserver\n</pre>\n<h2>Changelog</h2>\n<h2>v0.2.5 - Nov/2019</h2>\n<ul>\n<li>add <code>JobLogger.exception</code> property for inspection after the run</li>\n</ul>\n<h2>v0.2.4 - Apr/2019</h2>\n<ul>\n<li>add 'blocked' state entry on failed parallel job runs</li>\n</ul>\n<h2>v0.2.3</h2>\n<ul>\n<li>fix joblog model access</li>\n</ul>\n<h2>v0.2.2</h2>\n<ul>\n<li>add <code>JOBLOG_CONFIG</code> setting</li>\n<li>add <code>live_updates</code> and <code>ping</code> mode</li>\n</ul>\n<h2>v0.1.1 - Aug/2018</h2>\n<ul>\n<li>add search and filter to admin view</li>\n</ul>\n<h2>v0.1.0 - Jul/2018</h2>\n<ul>\n<li>make printing to console optional</li>\n<li>add django unit-tests</li>\n</ul>\n<h2>v0.0.1</h2>\n<ul>\n<li>Copy-pasted together from various private projects, 'sanitized' and repackaged for PyPi</li>\n</ul>\n\n          </div>"}, "last_serial": 6087943, "releases": {"0.1.1": [{"comment_text": "", "digests": {"md5": "f401cf779d3f2cd1d36132b3cbd3d58b", "sha256": "ec29974cd7e1bb0dd786081140b7bab621de072edb0667e4426cf6b8a129816b"}, "downloads": -1, "filename": "django-joblog-0.1.1.tar.gz", "has_sig": false, "md5_digest": "f401cf779d3f2cd1d36132b3cbd3d58b", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.6, <4", "size": 12224, "upload_time": "2018-08-01T15:58:17", "upload_time_iso_8601": "2018-08-01T15:58:17.768251Z", "url": "https://files.pythonhosted.org/packages/f7/87/6b829f0848a83efa22f7c184e77070f1259ca814e6686fc48fc2380ad716/django-joblog-0.1.1.tar.gz", "yanked": false}], "0.2.1": [{"comment_text": "", "digests": {"md5": "224f3c570459f5b553d90c8e6a80f077", "sha256": "70e5de3d649398e6bdb32f315933264e9e1593012c654eeaa9a403781fe6860b"}, "downloads": -1, "filename": "django-joblog-0.2.1.tar.gz", "has_sig": false, "md5_digest": "224f3c570459f5b553d90c8e6a80f077", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.6, <4", "size": 17319, "upload_time": "2019-04-15T20:22:16", "upload_time_iso_8601": "2019-04-15T20:22:16.469858Z", "url": "https://files.pythonhosted.org/packages/c0/bd/d4afbd70b0dbd249198eb182edaa61df3c775816144f5579c906a07f160a/django-joblog-0.2.1.tar.gz", "yanked": false}], "0.2.2": [{"comment_text": "", "digests": {"md5": "f916d2b7c0ef98e53ce50c1f0591b5de", "sha256": "2183dd81bddcecbbcf813e188f3144892dced8c90677581dbb14a614be9ba060"}, "downloads": -1, "filename": "django-joblog-0.2.2.tar.gz", "has_sig": false, "md5_digest": "f916d2b7c0ef98e53ce50c1f0591b5de", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.6, <4", "size": 17337, "upload_time": "2019-04-15T21:30:38", "upload_time_iso_8601": "2019-04-15T21:30:38.255584Z", "url": "https://files.pythonhosted.org/packages/f0/d1/54dfe0d4f79439ee4ba0fd6978254830ddd357186ee989131daf620e14c4/django-joblog-0.2.2.tar.gz", "yanked": false}], "0.2.3": [{"comment_text": "", "digests": {"md5": "a83a058e41601f4607bd27dc506a2bd7", "sha256": "8b669d798f13cf6b5b5b85f20fc2520f91b80bcb61947c9bfd3a5e45e90cd73d"}, "downloads": -1, "filename": "django-joblog-0.2.3.tar.gz", "has_sig": false, "md5_digest": "a83a058e41601f4607bd27dc506a2bd7", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.6, <4", "size": 17428, "upload_time": "2019-04-29T11:09:27", "upload_time_iso_8601": "2019-04-29T11:09:27.122783Z", "url": "https://files.pythonhosted.org/packages/c8/56/c685ce988dc5982ce85c41636afd8d5d1f80b56617417e2237505832c376/django-joblog-0.2.3.tar.gz", "yanked": false}], "0.2.4": [{"comment_text": "", "digests": {"md5": "a66f7fbcbf227c2237b4d2f1add10f81", "sha256": "498609e8c3246c259340db7d93b67d5b373cc5da7757e9f456ce3139d7b09271"}, "downloads": -1, "filename": "django-joblog-0.2.4.tar.gz", "has_sig": false, "md5_digest": "a66f7fbcbf227c2237b4d2f1add10f81", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.6, <4", "size": 18199, "upload_time": "2019-04-29T20:54:17", "upload_time_iso_8601": "2019-04-29T20:54:17.058775Z", "url": "https://files.pythonhosted.org/packages/bf/cb/e847a6a983d5ee13d91a4795da0f9a93bac1e49b40b9e937c0e31f62d428/django-joblog-0.2.4.tar.gz", "yanked": false}], "0.2.5": [{"comment_text": "", "digests": {"md5": "d9001c3fdb42532906694398cf6b3923", "sha256": "281fcf97c52a8372d573f8c9acf8587a79ddf206daed3c740b415f723d3f24d4"}, "downloads": -1, "filename": "django-joblog-0.2.5.tar.gz", "has_sig": false, "md5_digest": "d9001c3fdb42532906694398cf6b3923", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.6, <4", "size": 15911, "upload_time": "2019-11-06T15:18:57", "upload_time_iso_8601": "2019-11-06T15:18:57.576709Z", "url": "https://files.pythonhosted.org/packages/65/2e/c118a4687f7903e23b9de99d09f40c1591aaecf72d8d7fce96717d926a55/django-joblog-0.2.5.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "d9001c3fdb42532906694398cf6b3923", "sha256": "281fcf97c52a8372d573f8c9acf8587a79ddf206daed3c740b415f723d3f24d4"}, "downloads": -1, "filename": "django-joblog-0.2.5.tar.gz", "has_sig": false, "md5_digest": "d9001c3fdb42532906694398cf6b3923", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.6, <4", "size": 15911, "upload_time": "2019-11-06T15:18:57", "upload_time_iso_8601": "2019-11-06T15:18:57.576709Z", "url": "https://files.pythonhosted.org/packages/65/2e/c118a4687f7903e23b9de99d09f40c1591aaecf72d8d7fce96717d926a55/django-joblog-0.2.5.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:35:30 2020"}