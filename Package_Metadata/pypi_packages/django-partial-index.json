{"info": {"author": "Mattias Linnap", "author_email": "mattias@linnap.com", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Environment :: Web Environment", "Framework :: Django", "Framework :: Django :: 1.11", "Framework :: Django :: 2.0", "Framework :: Django :: 2.1", "Framework :: Django :: 2.2", "Intended Audience :: Developers", "License :: OSI Approved :: BSD License", "Operating System :: OS Independent", "Programming Language :: Python", "Programming Language :: Python :: 2", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.4", "Programming Language :: Python :: 3.5", "Programming Language :: Python :: 3.6", "Topic :: Database", "Topic :: Internet :: WWW/HTTP"], "description": "# django-partial-index\n\n[![Build Status](https://api.travis-ci.org/mattiaslinnap/django-partial-index.svg?branch=master)](https://travis-ci.org/mattiaslinnap/django-partial-index)\n[![PyPI version](https://badge.fury.io/py/django-partial-index.svg)](https://pypi.python.org/pypi/django-partial-index/)\n\nPartial (sometimes also called filtered or conditional) index support for Django.\n\nWith partial indexes, only some subset of the rows in the table have corresponding index entries.\nThis can be useful for optimizing index size and query speed, and to add unique constraints for only selected rows.\n\nMore info on partial indexes:\n\n* https://www.postgresql.org/docs/current/static/indexes-partial.html\n* https://sqlite.org/partialindex.html\n\n\n## Partial indexes now included in Django\n\nSince the release of [Django 2.2 LTS](https://docs.djangoproject.com/en/2.2/releases/2.2/) in April 2019,\npartial indexes are now supported by standard Django.\n\nThese are called [index conditions](https://docs.djangoproject.com/en/2.2/ref/models/indexes/#condition) there.\n\nThe django-partial-index package will live on in maintenance mode.\n\nIt can be useful if you are maintaining a project on and older version of Django, or wish to migrate django-partial-index indexes to Django 2.2 style on your own schedule.\n\n## Install\n\n`pip install django-partial-index`\n\nRequirements:\n\n* Django 1.11, 2.0, 2.1 or 2.2,\n* Python 2.7, 3.4, 3.5, 3.6 or 3.7 (as supported by the Django version),\n* PostgreSQL or SQLite database backend. (Partial indexes are not supported on MySQL, and require major hackery on Oracle.)\n\nAll Python versions which Django supports are also supported by this package. These are:\n\n* Django 1.11 - Python 2.7 and 3.4 - 3.7,\n* Django 2.0 - Python 3.4 - 3.7,\n* Django 2.1 - Python 3.5 - 3.7,\n* Django 2.2 - Python 3.5 - 3.7.\n\n\n## Usage\n\nSet up a PartialIndex and insert it into your model's class-based Meta.indexes list:\n\n```python\nfrom partial_index import PartialIndex, PQ\n\nclass MyModel(models.Model):\n    class Meta:\n        indexes = [\n            PartialIndex(fields=['user', 'room'], unique=True, where=PQ(deleted_at__isnull=True)),\n            PartialIndex(fields=['created_at'], unique=False, where=PQ(is_complete=False)),\n        ]\n```\n\nThe `PQ` uses the exact same syntax and supports all the same features as Django's `Q` objects ([see Django docs for a full tutorial](https://docs.djangoproject.com/en/1.11/topics/db/queries/#complex-lookups-with-q-objects)). It is provided for compatibility with Django 1.11.\n\nOf course, these (unique) indexes could be created by a handwritten [RunSQL migration](https://docs.djangoproject.com/en/1.11/ref/migration-operations/#runsql).\nBut the constraints are part of the business logic, and best kept close to the model definitions.\n\n### Partial unique constraints\n\nWith `unique=True`, this can be used to create unique constraints for a subset of the rows.\n\nFor example, you might have a model that has a deleted_at field to mark rows as archived instead of deleting them forever.\nYou wish to add unique constraints on \"alive\" rows, but allow multiple copies in the archive.\n[Django's unique_together](https://docs.djangoproject.com/en/1.11/ref/models/options/#unique-together) is not sufficient here, as that cannot\ndistinguish between the archived and alive rows.\n\n```python\nfrom partial_index import PartialIndex, PQ\n\nclass RoomBooking(models.Model):\n    user = models.ForeignKey(User)\n    room = models.ForeignKey(Room)\n    deleted_at = models.DateTimeField(null=True, blank=True)\n\n    class Meta:\n        # unique_together = [('user', 'room')] - Does not allow multiple deleted rows. Instead use:\n        indexes = [\n            PartialIndex(fields=['user', 'room'], unique=True, where=PQ(deleted_at__isnull=True))\n        ]\n```\n\n### Partial non-unique indexes\n\nWith `unique=False`, partial indexes can be used to optimise lookups that return only a small subset of the rows.\n\nFor example, you might have a job queue table which keeps an archive of millions of completed jobs. Among these are a few pending jobs,\nwhich you want to find with a `.filter(is_complete=0)` query.\n\n```python\nfrom partial_index import PartialIndex, PQ\n\nclass Job(models.Model):\n    created_at = models.DateTimeField(auto_now_add=True)\n    is_complete = models.IntegerField(default=0)\n\n    class Meta:\n        indexes = [\n            PartialIndex(fields=['created_at'], unique=False, where=PQ(is_complete=0))\n        ]\n```\n\nCompared to an usual full index on the `is_complete` field, this can be significantly smaller in disk and memory use, and faster to update.\n\n### Referencing multiple fields in the condition\n\nWith `F`-expressions, you can create conditions that reference multiple fields:\n\n```python\nfrom partial_index import PartialIndex, PQ, PF\n\nclass NotTheSameAgain(models.Model):\n    a = models.IntegerField()\n    b = models.IntegerField()\n\n    class Meta:\n        indexes = [\n            PartialIndex(fields=['a', 'b'], unique=True, where=PQ(a=PF('b'))),\n        ]\n```\n\nThis PartialIndex allows multiple copies of `(2, 3)`, but only a single copy of `(2, 2)` to exist in the database.\n\nThe `PF` uses the exact same syntax and supports all the same features as Django's `F` expressions ([see Django docs for a full tutorial](https://docs.djangoproject.com/en/1.11/ref/models/expressions/#f-expressions)). It is provided for compatibility with Django 1.11.\n\n### Unique validation on ModelForms\n\nUnique partial indexes are validated by the PostgreSQL and SQLite databases. When they reject an INSERT or UPDATE, Django raises a `IntegrityError` exception. This results in a `500 Server Error` status page in the browser if not handled before the database query is run.\n\nModelForms perform unique validation before saving an object, and present the user with a descriptive error message.\n\nAdding an index does not modify the parent model's unique validation, so partial index validations are not handled by them by default. To add that to your model, include the `ValidatePartialUniqueMixin` in your model definition:\n\n```python\nfrom partial_index import PartialIndex, PQ, ValidatePartialUniqueMixin\n\nclass MyModel(ValidatePartialUniqueMixin, models.Model):\n    class Meta:\n        indexes = [\n            PartialIndex(fields=['user', 'room'], unique=True, where=PQ(deleted_at__isnull=True)),\n        ]\n```\n\nNote that it should be added on the model itself, not the ModelForm class.\n\nAdding the mixin for non-unique partial indexes is unnecessary, as they cannot cause database IntegrityErrors.\n\n### Text-based where-conditions (deprecated)\n\nText-based where-conditions are deprecated and will be removed in the next release (0.6.0) of django-partial-index.\n\nThey are still supported in version 0.5.0 to simplify upgrading existing projects to the `PQ`-based indexes. New projects should not use them.\n\n\n```python\nfrom partial_index import PartialIndex\n\nclass TextExample(models.Model):\n    class Meta:\n        indexes = [\n            PartialIndex(fields=['user', 'room'], unique=True, where='deleted_at IS NULL'),\n            PartialIndex(fields=['created_at'], unique=False, where_postgresql='is_complete = false', where_sqlite='is_complete = 0')\n        ]\n```\n\n\n## Version History\n\n### 0.6.0 (latest)\n* Add support for Django 2.2.\n* Document (already existing) support for Django 2.1 and Python 3.7.\n\n### 0.5.2\n* Fix makemigrations for Django 1.11.\n* Make sure PQ and PF are imported directly from partial_index in migration files.\n\n### 0.5.1\n* Fix README formatting in PyPI.\n\n### 0.5.0\n* Add support for Q-object based where-expressions.\n* Deprecate support for text-based where-expressions. These will be removed in version 0.6.0.\n* Add ValidatePartialUniqueMixin for model classes. This adds partial unique index validation for ModelForms, avoiding an IntegrityError and instead showing an error message as with usual unique_together constraints.\n\n### 0.4.0\n* Add support for Django 2.0.\n\n### 0.3.0\n* Add support for separate `where_postgresql=''` and `where_sqlite=''` predicates, when the expression has different syntax on the two\n database backends and you wish to support both.\n\n### 0.2.1\n* Ensure that automatically generated index names depend on the \"unique\" and \"where\" parameters. Otherwise two indexes with the same fields would be considered identical by Django.\n\n### 0.2.0\n* Fully tested SQLite and PostgreSQL support.\n* Tests for generated SQL statements, adding and removing indexes, and that unique constraints work when inserting rows into the db tables.\n* Python 2.7, 3.4-3.6 support.\n\n### 0.1.1\n* Experimental SQLite support.\n\n### 0.1.0\n* First release, working but untested PostgreSQL support.\n\n## Future plans\n\n* Add a validation mixin for DRF Serializers.\n* Remove support for text-based where conditions.\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "https://github.com/mattiaslinnap/django-partial-index/archive/0.6.0.tar.gz", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/mattiaslinnap/django-partial-index", "keywords": "", "license": "BSD", "maintainer": "", "maintainer_email": "", "name": "django-partial-index", "package_url": "https://pypi.org/project/django-partial-index/", "platform": "", "project_url": "https://pypi.org/project/django-partial-index/", "project_urls": {"Download": "https://github.com/mattiaslinnap/django-partial-index/archive/0.6.0.tar.gz", "Homepage": "https://github.com/mattiaslinnap/django-partial-index"}, "release_url": "https://pypi.org/project/django-partial-index/0.6.0/", "requires_dist": null, "requires_python": "", "summary": "PostgreSQL and SQLite partial indexes for Django models", "version": "0.6.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>django-partial-index</h1>\n<p><a href=\"https://travis-ci.org/mattiaslinnap/django-partial-index\" rel=\"nofollow\"><img alt=\"Build Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/5bc697240ffd07e003ef47a41e5b18316ae668b0/68747470733a2f2f6170692e7472617669732d63692e6f72672f6d6174746961736c696e6e61702f646a616e676f2d7061727469616c2d696e6465782e7376673f6272616e63683d6d6173746572\"></a>\n<a href=\"https://pypi.python.org/pypi/django-partial-index/\" rel=\"nofollow\"><img alt=\"PyPI version\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/4c013b33145f7c86c5b4f8dc94c56e523ada1ca6/68747470733a2f2f62616467652e667572792e696f2f70792f646a616e676f2d7061727469616c2d696e6465782e737667\"></a></p>\n<p>Partial (sometimes also called filtered or conditional) index support for Django.</p>\n<p>With partial indexes, only some subset of the rows in the table have corresponding index entries.\nThis can be useful for optimizing index size and query speed, and to add unique constraints for only selected rows.</p>\n<p>More info on partial indexes:</p>\n<ul>\n<li><a href=\"https://www.postgresql.org/docs/current/static/indexes-partial.html\" rel=\"nofollow\">https://www.postgresql.org/docs/current/static/indexes-partial.html</a></li>\n<li><a href=\"https://sqlite.org/partialindex.html\" rel=\"nofollow\">https://sqlite.org/partialindex.html</a></li>\n</ul>\n<h2>Partial indexes now included in Django</h2>\n<p>Since the release of <a href=\"https://docs.djangoproject.com/en/2.2/releases/2.2/\" rel=\"nofollow\">Django 2.2 LTS</a> in April 2019,\npartial indexes are now supported by standard Django.</p>\n<p>These are called <a href=\"https://docs.djangoproject.com/en/2.2/ref/models/indexes/#condition\" rel=\"nofollow\">index conditions</a> there.</p>\n<p>The django-partial-index package will live on in maintenance mode.</p>\n<p>It can be useful if you are maintaining a project on and older version of Django, or wish to migrate django-partial-index indexes to Django 2.2 style on your own schedule.</p>\n<h2>Install</h2>\n<p><code>pip install django-partial-index</code></p>\n<p>Requirements:</p>\n<ul>\n<li>Django 1.11, 2.0, 2.1 or 2.2,</li>\n<li>Python 2.7, 3.4, 3.5, 3.6 or 3.7 (as supported by the Django version),</li>\n<li>PostgreSQL or SQLite database backend. (Partial indexes are not supported on MySQL, and require major hackery on Oracle.)</li>\n</ul>\n<p>All Python versions which Django supports are also supported by this package. These are:</p>\n<ul>\n<li>Django 1.11 - Python 2.7 and 3.4 - 3.7,</li>\n<li>Django 2.0 - Python 3.4 - 3.7,</li>\n<li>Django 2.1 - Python 3.5 - 3.7,</li>\n<li>Django 2.2 - Python 3.5 - 3.7.</li>\n</ul>\n<h2>Usage</h2>\n<p>Set up a PartialIndex and insert it into your model's class-based Meta.indexes list:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">partial_index</span> <span class=\"kn\">import</span> <span class=\"n\">PartialIndex</span><span class=\"p\">,</span> <span class=\"n\">PQ</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">MyModel</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">indexes</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">PartialIndex</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'user'</span><span class=\"p\">,</span> <span class=\"s1\">'room'</span><span class=\"p\">],</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">where</span><span class=\"o\">=</span><span class=\"n\">PQ</span><span class=\"p\">(</span><span class=\"n\">deleted_at__isnull</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)),</span>\n            <span class=\"n\">PartialIndex</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'created_at'</span><span class=\"p\">],</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">where</span><span class=\"o\">=</span><span class=\"n\">PQ</span><span class=\"p\">(</span><span class=\"n\">is_complete</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)),</span>\n        <span class=\"p\">]</span>\n</pre>\n<p>The <code>PQ</code> uses the exact same syntax and supports all the same features as Django's <code>Q</code> objects (<a href=\"https://docs.djangoproject.com/en/1.11/topics/db/queries/#complex-lookups-with-q-objects\" rel=\"nofollow\">see Django docs for a full tutorial</a>). It is provided for compatibility with Django 1.11.</p>\n<p>Of course, these (unique) indexes could be created by a handwritten <a href=\"https://docs.djangoproject.com/en/1.11/ref/migration-operations/#runsql\" rel=\"nofollow\">RunSQL migration</a>.\nBut the constraints are part of the business logic, and best kept close to the model definitions.</p>\n<h3>Partial unique constraints</h3>\n<p>With <code>unique=True</code>, this can be used to create unique constraints for a subset of the rows.</p>\n<p>For example, you might have a model that has a deleted_at field to mark rows as archived instead of deleting them forever.\nYou wish to add unique constraints on \"alive\" rows, but allow multiple copies in the archive.\n<a href=\"https://docs.djangoproject.com/en/1.11/ref/models/options/#unique-together\" rel=\"nofollow\">Django's unique_together</a> is not sufficient here, as that cannot\ndistinguish between the archived and alive rows.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">partial_index</span> <span class=\"kn\">import</span> <span class=\"n\">PartialIndex</span><span class=\"p\">,</span> <span class=\"n\">PQ</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">RoomBooking</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ForeignKey</span><span class=\"p\">(</span><span class=\"n\">User</span><span class=\"p\">)</span>\n    <span class=\"n\">room</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ForeignKey</span><span class=\"p\">(</span><span class=\"n\">Room</span><span class=\"p\">)</span>\n    <span class=\"n\">deleted_at</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">DateTimeField</span><span class=\"p\">(</span><span class=\"n\">null</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">blank</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"c1\"># unique_together = [('user', 'room')] - Does not allow multiple deleted rows. Instead use:</span>\n        <span class=\"n\">indexes</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">PartialIndex</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'user'</span><span class=\"p\">,</span> <span class=\"s1\">'room'</span><span class=\"p\">],</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">where</span><span class=\"o\">=</span><span class=\"n\">PQ</span><span class=\"p\">(</span><span class=\"n\">deleted_at__isnull</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">))</span>\n        <span class=\"p\">]</span>\n</pre>\n<h3>Partial non-unique indexes</h3>\n<p>With <code>unique=False</code>, partial indexes can be used to optimise lookups that return only a small subset of the rows.</p>\n<p>For example, you might have a job queue table which keeps an archive of millions of completed jobs. Among these are a few pending jobs,\nwhich you want to find with a <code>.filter(is_complete=0)</code> query.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">partial_index</span> <span class=\"kn\">import</span> <span class=\"n\">PartialIndex</span><span class=\"p\">,</span> <span class=\"n\">PQ</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Job</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">created_at</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">DateTimeField</span><span class=\"p\">(</span><span class=\"n\">auto_now_add</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n    <span class=\"n\">is_complete</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">IntegerField</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">indexes</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">PartialIndex</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'created_at'</span><span class=\"p\">],</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">where</span><span class=\"o\">=</span><span class=\"n\">PQ</span><span class=\"p\">(</span><span class=\"n\">is_complete</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">))</span>\n        <span class=\"p\">]</span>\n</pre>\n<p>Compared to an usual full index on the <code>is_complete</code> field, this can be significantly smaller in disk and memory use, and faster to update.</p>\n<h3>Referencing multiple fields in the condition</h3>\n<p>With <code>F</code>-expressions, you can create conditions that reference multiple fields:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">partial_index</span> <span class=\"kn\">import</span> <span class=\"n\">PartialIndex</span><span class=\"p\">,</span> <span class=\"n\">PQ</span><span class=\"p\">,</span> <span class=\"n\">PF</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">NotTheSameAgain</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">IntegerField</span><span class=\"p\">()</span>\n    <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">IntegerField</span><span class=\"p\">()</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">indexes</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">PartialIndex</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'a'</span><span class=\"p\">,</span> <span class=\"s1\">'b'</span><span class=\"p\">],</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">where</span><span class=\"o\">=</span><span class=\"n\">PQ</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"o\">=</span><span class=\"n\">PF</span><span class=\"p\">(</span><span class=\"s1\">'b'</span><span class=\"p\">))),</span>\n        <span class=\"p\">]</span>\n</pre>\n<p>This PartialIndex allows multiple copies of <code>(2, 3)</code>, but only a single copy of <code>(2, 2)</code> to exist in the database.</p>\n<p>The <code>PF</code> uses the exact same syntax and supports all the same features as Django's <code>F</code> expressions (<a href=\"https://docs.djangoproject.com/en/1.11/ref/models/expressions/#f-expressions\" rel=\"nofollow\">see Django docs for a full tutorial</a>). It is provided for compatibility with Django 1.11.</p>\n<h3>Unique validation on ModelForms</h3>\n<p>Unique partial indexes are validated by the PostgreSQL and SQLite databases. When they reject an INSERT or UPDATE, Django raises a <code>IntegrityError</code> exception. This results in a <code>500 Server Error</code> status page in the browser if not handled before the database query is run.</p>\n<p>ModelForms perform unique validation before saving an object, and present the user with a descriptive error message.</p>\n<p>Adding an index does not modify the parent model's unique validation, so partial index validations are not handled by them by default. To add that to your model, include the <code>ValidatePartialUniqueMixin</code> in your model definition:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">partial_index</span> <span class=\"kn\">import</span> <span class=\"n\">PartialIndex</span><span class=\"p\">,</span> <span class=\"n\">PQ</span><span class=\"p\">,</span> <span class=\"n\">ValidatePartialUniqueMixin</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">MyModel</span><span class=\"p\">(</span><span class=\"n\">ValidatePartialUniqueMixin</span><span class=\"p\">,</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">indexes</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">PartialIndex</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'user'</span><span class=\"p\">,</span> <span class=\"s1\">'room'</span><span class=\"p\">],</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">where</span><span class=\"o\">=</span><span class=\"n\">PQ</span><span class=\"p\">(</span><span class=\"n\">deleted_at__isnull</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)),</span>\n        <span class=\"p\">]</span>\n</pre>\n<p>Note that it should be added on the model itself, not the ModelForm class.</p>\n<p>Adding the mixin for non-unique partial indexes is unnecessary, as they cannot cause database IntegrityErrors.</p>\n<h3>Text-based where-conditions (deprecated)</h3>\n<p>Text-based where-conditions are deprecated and will be removed in the next release (0.6.0) of django-partial-index.</p>\n<p>They are still supported in version 0.5.0 to simplify upgrading existing projects to the <code>PQ</code>-based indexes. New projects should not use them.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">partial_index</span> <span class=\"kn\">import</span> <span class=\"n\">PartialIndex</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">TextExample</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">indexes</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">PartialIndex</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'user'</span><span class=\"p\">,</span> <span class=\"s1\">'room'</span><span class=\"p\">],</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">where</span><span class=\"o\">=</span><span class=\"s1\">'deleted_at IS NULL'</span><span class=\"p\">),</span>\n            <span class=\"n\">PartialIndex</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'created_at'</span><span class=\"p\">],</span> <span class=\"n\">unique</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">where_postgresql</span><span class=\"o\">=</span><span class=\"s1\">'is_complete = false'</span><span class=\"p\">,</span> <span class=\"n\">where_sqlite</span><span class=\"o\">=</span><span class=\"s1\">'is_complete = 0'</span><span class=\"p\">)</span>\n        <span class=\"p\">]</span>\n</pre>\n<h2>Version History</h2>\n<h3>0.6.0 (latest)</h3>\n<ul>\n<li>Add support for Django 2.2.</li>\n<li>Document (already existing) support for Django 2.1 and Python 3.7.</li>\n</ul>\n<h3>0.5.2</h3>\n<ul>\n<li>Fix makemigrations for Django 1.11.</li>\n<li>Make sure PQ and PF are imported directly from partial_index in migration files.</li>\n</ul>\n<h3>0.5.1</h3>\n<ul>\n<li>Fix README formatting in PyPI.</li>\n</ul>\n<h3>0.5.0</h3>\n<ul>\n<li>Add support for Q-object based where-expressions.</li>\n<li>Deprecate support for text-based where-expressions. These will be removed in version 0.6.0.</li>\n<li>Add ValidatePartialUniqueMixin for model classes. This adds partial unique index validation for ModelForms, avoiding an IntegrityError and instead showing an error message as with usual unique_together constraints.</li>\n</ul>\n<h3>0.4.0</h3>\n<ul>\n<li>Add support for Django 2.0.</li>\n</ul>\n<h3>0.3.0</h3>\n<ul>\n<li>Add support for separate <code>where_postgresql=''</code> and <code>where_sqlite=''</code> predicates, when the expression has different syntax on the two\ndatabase backends and you wish to support both.</li>\n</ul>\n<h3>0.2.1</h3>\n<ul>\n<li>Ensure that automatically generated index names depend on the \"unique\" and \"where\" parameters. Otherwise two indexes with the same fields would be considered identical by Django.</li>\n</ul>\n<h3>0.2.0</h3>\n<ul>\n<li>Fully tested SQLite and PostgreSQL support.</li>\n<li>Tests for generated SQL statements, adding and removing indexes, and that unique constraints work when inserting rows into the db tables.</li>\n<li>Python 2.7, 3.4-3.6 support.</li>\n</ul>\n<h3>0.1.1</h3>\n<ul>\n<li>Experimental SQLite support.</li>\n</ul>\n<h3>0.1.0</h3>\n<ul>\n<li>First release, working but untested PostgreSQL support.</li>\n</ul>\n<h2>Future plans</h2>\n<ul>\n<li>Add a validation mixin for DRF Serializers.</li>\n<li>Remove support for text-based where conditions.</li>\n</ul>\n\n          </div>"}, "last_serial": 5498201, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "e4f3f10a3f39ff9af8904958488f7e14", "sha256": "075737daed4096b4e4748a7e0638c881424ebc0a237a680fe9825a33dc5a1592"}, "downloads": -1, "filename": "django_partial_index-0.1.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "e4f3f10a3f39ff9af8904958488f7e14", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 5658, "upload_time": "2017-08-05T22:10:52", "upload_time_iso_8601": "2017-08-05T22:10:52.714994Z", "url": "https://files.pythonhosted.org/packages/1d/4b/2c18368dc4b593ac7dc1ce18a04ea22bc2756ca22cf066658151d8ea399e/django_partial_index-0.1.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "1f38f15509de9dfac06c619c5c5c5ec9", "sha256": "6103cbffd567a867622517a6d042ed7433bada0748a46ace63f625d55249dfed"}, "downloads": -1, "filename": "django-partial-index-0.1.0.tar.gz", "has_sig": false, "md5_digest": "1f38f15509de9dfac06c619c5c5c5ec9", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3270, "upload_time": "2017-08-05T22:10:55", "upload_time_iso_8601": "2017-08-05T22:10:55.818707Z", "url": "https://files.pythonhosted.org/packages/27/ae/5b6b23f2bb7055be4066d321d0dcc0529967919d1e54781b99eb0ec2c147/django-partial-index-0.1.0.tar.gz", "yanked": false}], "0.1.1": [{"comment_text": "", "digests": {"md5": "a44e07075e88838aa4b2fb72d3faffc5", "sha256": "4e15eb7c38872d451d5a9905b2480ff97714c437f77095df2ecb480b02a69ba2"}, "downloads": -1, "filename": "django_partial_index-0.1.1-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "a44e07075e88838aa4b2fb72d3faffc5", "packagetype": "bdist_wheel", "python_version": "3.6", "requires_python": null, "size": 6092, "upload_time": "2017-08-06T15:06:40", "upload_time_iso_8601": "2017-08-06T15:06:40.772964Z", "url": "https://files.pythonhosted.org/packages/62/98/36702d8977f1828be28b6304e7d419821c408a7d2803ea20fd61bb011736/django_partial_index-0.1.1-py2.py3-none-any.whl", "yanked": false}], "0.2.0": [{"comment_text": "", "digests": {"md5": "917b0e2a1b1b30287679041fa9d97234", "sha256": "930f7b9acbf3ccef6971fd0b97ffe57debedf177e2665f5c3738b15968fb11dc"}, "downloads": -1, "filename": "django_partial_index-0.2.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "917b0e2a1b1b30287679041fa9d97234", "packagetype": "bdist_wheel", "python_version": "3.6", "requires_python": null, "size": 6560, "upload_time": "2017-08-06T23:09:13", "upload_time_iso_8601": "2017-08-06T23:09:13.360149Z", "url": "https://files.pythonhosted.org/packages/fe/64/a567f11a61e4a65aec0b3ee4b107e2a61289942bd78b85369b7063cebaf5/django_partial_index-0.2.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "ebc7ebe3a738218c1bb016b7ab1331c2", "sha256": "e3510eb1364c7d121f67b27deebe13749471862763d9ef783154d912f9c967f1"}, "downloads": -1, "filename": "django-partial-index-0.2.0.tar.gz", "has_sig": false, "md5_digest": "ebc7ebe3a738218c1bb016b7ab1331c2", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3797, "upload_time": "2017-08-06T23:08:40", "upload_time_iso_8601": "2017-08-06T23:08:40.872989Z", "url": "https://files.pythonhosted.org/packages/47/2e/fb970501f82b71a17698a0e098b04fd3283937f2957f50b6343935ee6283/django-partial-index-0.2.0.tar.gz", "yanked": false}], "0.2.1": [{"comment_text": "", "digests": {"md5": "b832b9aa199d7fa4df04a515ac17cf91", "sha256": "fd07d464a5b0cd8c0b2afacef9b926b16b981b9cfe6c48985c64511a3d0a7eb5"}, "downloads": -1, "filename": "django_partial_index-0.2.1-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "b832b9aa199d7fa4df04a515ac17cf91", "packagetype": "bdist_wheel", "python_version": "3.6", "requires_python": null, "size": 7426, "upload_time": "2017-08-07T08:32:05", "upload_time_iso_8601": "2017-08-07T08:32:05.749132Z", "url": "https://files.pythonhosted.org/packages/d4/ca/b21ceea0344b7612e0300cf75f23ae00fd180600476e2713b1a06171b1ef/django_partial_index-0.2.1-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "484089a7faea77b01121cfe3ebdcddf6", "sha256": "c859f54be3b899400e814b60ddf21dc1eb5cdf33dc8b9e3c7dd5e90797817d61"}, "downloads": -1, "filename": "django-partial-index-0.2.1.tar.gz", "has_sig": false, "md5_digest": "484089a7faea77b01121cfe3ebdcddf6", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 4418, "upload_time": "2017-08-07T08:32:03", "upload_time_iso_8601": "2017-08-07T08:32:03.403813Z", "url": "https://files.pythonhosted.org/packages/0c/ae/139d7008d71d65fa627bb9c6a7d42801fbd81ad85bb01d3cffba72d0a6e4/django-partial-index-0.2.1.tar.gz", "yanked": false}], "0.3.0": [{"comment_text": "", "digests": {"md5": "b0b2da41c846a8465c52d98bb417a30e", "sha256": "469b19ac27229a1e7f94085d134ffb5aebbafc75704cb8f88149a5ac33a9ff49"}, "downloads": -1, "filename": "django_partial_index-0.3.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "b0b2da41c846a8465c52d98bb417a30e", "packagetype": "bdist_wheel", "python_version": "3.6", "requires_python": null, "size": 8925, "upload_time": "2017-08-07T10:07:20", "upload_time_iso_8601": "2017-08-07T10:07:20.125279Z", "url": "https://files.pythonhosted.org/packages/77/7e/eb4ed6750bf50da0daf9a0c0f9bae2d240acab3a30b05ef3b80d499487cf/django_partial_index-0.3.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "c328f0c57df1aeb7271312f05aaf04c8", "sha256": "120395537b57338951c49b150a88aa61f527496ad60259806441e326a8acabba"}, "downloads": -1, "filename": "django-partial-index-0.3.0.tar.gz", "has_sig": false, "md5_digest": "c328f0c57df1aeb7271312f05aaf04c8", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 5375, "upload_time": "2017-08-07T10:07:17", "upload_time_iso_8601": "2017-08-07T10:07:17.201346Z", "url": "https://files.pythonhosted.org/packages/0a/7d/a62405a7c1950e8a27ae71d5bfb7b725095c35f614820b9e7920bb173e7b/django-partial-index-0.3.0.tar.gz", "yanked": false}], "0.4.0": [{"comment_text": "", "digests": {"md5": "0f4d940575378d74a5c4435f42c19af0", "sha256": "f8f295c2fcdef6d1995f9802486761ea8af660560577f528e1c24e48a1e7030f"}, "downloads": -1, "filename": "django_partial_index-0.4.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "0f4d940575378d74a5c4435f42c19af0", "packagetype": "bdist_wheel", "python_version": "3.6", "requires_python": null, "size": 9266, "upload_time": "2018-01-05T19:15:57", "upload_time_iso_8601": "2018-01-05T19:15:57.938709Z", "url": "https://files.pythonhosted.org/packages/6a/a5/4f386f3884b12ef6a22044ecd9462726e579b7c4a0b8be0830e6dbbbf63f/django_partial_index-0.4.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "4324f25b22556b81bfce37885cf0a882", "sha256": "7ace7ef42d7003135eeb4626bc07222eceb590531d8ca0288dc7edb201bf6120"}, "downloads": -1, "filename": "django-partial-index-0.4.0.tar.gz", "has_sig": false, "md5_digest": "4324f25b22556b81bfce37885cf0a882", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 5672, "upload_time": "2018-01-05T19:16:05", "upload_time_iso_8601": "2018-01-05T19:16:05.256560Z", "url": "https://files.pythonhosted.org/packages/54/f7/1823eddf3aca4858221a7ddd1c24c910ba62b3e0bb315046f1981f4c6645/django-partial-index-0.4.0.tar.gz", "yanked": false}], "0.5.0": [{"comment_text": "", "digests": {"md5": "96cc6bd85725c9373c3a81c382cd6469", "sha256": "d9503c141469dbd91891b300e1b09df0f7958b73c712141a800e071f1e0b40f1"}, "downloads": -1, "filename": "django_partial_index-0.5.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "96cc6bd85725c9373c3a81c382cd6469", "packagetype": "bdist_wheel", "python_version": "3.6", "requires_python": null, "size": 10053, "upload_time": "2018-07-05T10:58:34", "upload_time_iso_8601": "2018-07-05T10:58:34.452809Z", "url": "https://files.pythonhosted.org/packages/23/1c/143f8c8e75d2ff7a5809958b61bbd509e921b6dc0725f82b1888d53cdc3f/django_partial_index-0.5.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "4da9f737c88af45c0678f7d98810edcf", "sha256": "9b8757d4587e1501c1fe3b1fc1dae70d7aefb4794ce94f2a9129fee7e9405638"}, "downloads": -1, "filename": "django-partial-index-0.5.0.tar.gz", "has_sig": false, "md5_digest": "4da9f737c88af45c0678f7d98810edcf", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 9058, "upload_time": "2018-07-05T10:58:32", "upload_time_iso_8601": "2018-07-05T10:58:32.306195Z", "url": "https://files.pythonhosted.org/packages/dc/2a/f2d6797f13cd39614c793de03984217f468e14c88957306c3aa87a7395c5/django-partial-index-0.5.0.tar.gz", "yanked": false}], "0.5.1": [{"comment_text": "", "digests": {"md5": "6cdad233773e377b54db329d26297026", "sha256": "7d81b6c5090537703e18160c50fd6d5dd23223fcaf02444cb8a1f75e7d3a49b0"}, "downloads": -1, "filename": "django_partial_index-0.5.1-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "6cdad233773e377b54db329d26297026", "packagetype": "bdist_wheel", "python_version": "3.6", "requires_python": null, "size": 10098, "upload_time": "2018-07-05T11:03:18", "upload_time_iso_8601": "2018-07-05T11:03:18.861366Z", "url": "https://files.pythonhosted.org/packages/70/33/99f3b93bb6ff2a67a7d03905bc889ef3a6194e6db2d67708cc3cb701e4c2/django_partial_index-0.5.1-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "fd81aabfa62620a02784fe81c7df62a9", "sha256": "11f1dc3bc43e3686534e5e9d9f3e5904907931a39dff3f885faa9e404651740c"}, "downloads": -1, "filename": "django-partial-index-0.5.1.tar.gz", "has_sig": false, "md5_digest": "fd81aabfa62620a02784fe81c7df62a9", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 9141, "upload_time": "2018-07-05T11:03:15", "upload_time_iso_8601": "2018-07-05T11:03:15.689243Z", "url": "https://files.pythonhosted.org/packages/c6/e8/8cbe79a48b256c29628f89ef3b705f46c95a3c861447871c0bbcb2356c09/django-partial-index-0.5.1.tar.gz", "yanked": false}], "0.5.2": [{"comment_text": "", "digests": {"md5": "66f80b2fc67bd7de50c42f31b78b11a4", "sha256": "1eae3c5274b7729e92b33bf06abe95b55288c2718904384907e18f88c3d82155"}, "downloads": -1, "filename": "django_partial_index-0.5.2-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "66f80b2fc67bd7de50c42f31b78b11a4", "packagetype": "bdist_wheel", "python_version": "3.6", "requires_python": null, "size": 10520, "upload_time": "2018-07-15T15:51:51", "upload_time_iso_8601": "2018-07-15T15:51:51.253710Z", "url": "https://files.pythonhosted.org/packages/76/57/97ae8951e79e8e01152e80e5d53143c478c4c83dafa6b04cf46005aec319/django_partial_index-0.5.2-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "8d331de145142d9511d5c368d161f4d0", "sha256": "8a805b52971a58cb78c925dbb976fecf59c662a1c767846061444a2587247804"}, "downloads": -1, "filename": "django-partial-index-0.5.2.tar.gz", "has_sig": false, "md5_digest": "8d331de145142d9511d5c368d161f4d0", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 11476, "upload_time": "2018-07-15T15:51:49", "upload_time_iso_8601": "2018-07-15T15:51:49.303858Z", "url": "https://files.pythonhosted.org/packages/dc/26/e04ef9c2e2876bb3dd63823c8633edac6c1352701a6d629251ea41df5535/django-partial-index-0.5.2.tar.gz", "yanked": false}], "0.6.0": [{"comment_text": "", "digests": {"md5": "00d39e24257c15d16277f5442cef6a73", "sha256": "77dde49b20560fc489ec7270484926fc175795d852344df9421f7feec283f783"}, "downloads": -1, "filename": "django_partial_index-0.6.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "00d39e24257c15d16277f5442cef6a73", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 11966, "upload_time": "2019-07-07T21:53:52", "upload_time_iso_8601": "2019-07-07T21:53:52.462778Z", "url": "https://files.pythonhosted.org/packages/69/84/5ffd927bc2805d62386804bf107d6ddef0fe75f305087347fb0a717874eb/django_partial_index-0.6.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "74850829055428b0b5e83712a3968e4b", "sha256": "c3c3b31c4fc73f772edd5ad3b8421cb410b5a5d681b45fc6d6956587952a5edb"}, "downloads": -1, "filename": "django-partial-index-0.6.0.tar.gz", "has_sig": false, "md5_digest": "74850829055428b0b5e83712a3968e4b", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 10044, "upload_time": "2019-07-07T21:53:53", "upload_time_iso_8601": "2019-07-07T21:53:53.780630Z", "url": "https://files.pythonhosted.org/packages/ca/0c/debd3f67abb4508e449e938c1e172dec1aac4ff7fff9d15048a32e8d41a0/django-partial-index-0.6.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "00d39e24257c15d16277f5442cef6a73", "sha256": "77dde49b20560fc489ec7270484926fc175795d852344df9421f7feec283f783"}, "downloads": -1, "filename": "django_partial_index-0.6.0-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "00d39e24257c15d16277f5442cef6a73", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 11966, "upload_time": "2019-07-07T21:53:52", "upload_time_iso_8601": "2019-07-07T21:53:52.462778Z", "url": "https://files.pythonhosted.org/packages/69/84/5ffd927bc2805d62386804bf107d6ddef0fe75f305087347fb0a717874eb/django_partial_index-0.6.0-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "74850829055428b0b5e83712a3968e4b", "sha256": "c3c3b31c4fc73f772edd5ad3b8421cb410b5a5d681b45fc6d6956587952a5edb"}, "downloads": -1, "filename": "django-partial-index-0.6.0.tar.gz", "has_sig": false, "md5_digest": "74850829055428b0b5e83712a3968e4b", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 10044, "upload_time": "2019-07-07T21:53:53", "upload_time_iso_8601": "2019-07-07T21:53:53.780630Z", "url": "https://files.pythonhosted.org/packages/ca/0c/debd3f67abb4508e449e938c1e172dec1aac4ff7fff9d15048a32e8d41a0/django-partial-index-0.6.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:55:14 2020"}