{"info": {"author": "Javier Llopis", "author_email": "javier@llopis.me", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Environment :: Console", "Intended Audience :: End Users/Desktop", "Intended Audience :: System Administrators", "License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python :: 3.7", "Topic :: Internet", "Topic :: Office/Business", "Topic :: System", "Topic :: System :: Monitoring", "Topic :: System :: Networking :: Monitoring", "Topic :: Utilities"], "description": "## UrlMonitor\n\nThis program is intended to be run periodically from cron or a systemd ``.timer`` service on GNU/Linux, a Periodic Task on Windows, or whatever you are using.\n\nWhen run, the program will check the URLs from its list, and, if they have changed since the last time they were checked, will run a series of actions as a result.\n\nThe list of URLs and actions to be run if changed are specified in a YAML file (by default called ``urllist.yml``). This file consist on a LIST of OBJECTS, each containing the fields name with a descriptive string, url with the url to be checked, and actions, which is a LIST of OBJECTS, where the key is the action name and the value are the arguments, which can be a STRING or a LIST of strings.\n\nAn example of urllist.yml file:\n\n```yaml\n---\n- name: Check for new versions of my favourite software\n  url: https://www.coolproject.org/download/files\n  actions:\n    - email_notify:\n        - joe@domain.com\n        - jill@somewhere.else.com\n\n- name: Get latest version of the software\n  url: https://www.coolproject.org/latest\n  actions:\n    - re_match:\n        - '[Ss]ource [Tt]arball.*<a href=\\\"([^\"]+)'\n    - run_script: download_and_build https://www.coolproject.org/{re_match[1]}\n```\n\nAs you can see on the last line, the arguments to the actions are expanded with the variables from previous actions, the url, the contents, the HTTP status code obtained while fetching the URL, etc.\n\n### Installation\n\nJust run the provided ``setup.py`` program:\n\n```\n$ python3 setup.py install\n```\n\n### Running\n\nYou can call the program with ``--help`` for the program options::\n\n\n    $ urlmonitor --help\n    usage: urlmonitor [-h] [--config FILE] [--persist-file FILE]\n                      [ymlfile [ymlfile ...]]\n\n    positional arguments:\n      ymlfile               Url check specification.\n\n    optional arguments:\n      -h, --help            show this help message and exit\n      --config FILE, -c FILE\n                            Configuration file.\n      --persist-file FILE, -p FILE\n                            Persistence file to store URL status. Default\n                            ./persistence.sqlite\n\n\n* The ``yml`` file(s) contain the URLs to check, as discussed above.\n* The ``--persist-file`` is a database that will be created in order to track whether the URLs have changed and when.\n* The ``--config`` file is a YAML file that specifies where the options are located. It is discussed on the next section.\n\n### Configuration\n\nUrlMonitor is configured using a YAML file containing an OBJECT with the different sections where you can specify:\n\n* Global variables (``set_vars``): available to all the actions.\n* Actions (``actions``): Each additional action individually, specifying its name, the Python module where it is located, and perhaps a set of configuration parameters.\n* Action directories (``action_dir``): Specify a directory containing Python files. Each Python file contains an action named like the file.\n* Action configurations (``action_config``): Contains an OBJECT whose entries are the names of the actions and the values are the configuration parameters for that action. Any action can be configured in this way, whether it has been specified using ``action`` or an ``action_dir``. Some predefined actions also need to be configured this way, for example the ``email_notify`` predefined action needs the parameter ``smtp_server`` to be set.\n* Logging configuration (``logging_config``): Contains the settings needed to call `logging.config.dictConfig()` as per the [Python standard library documentation](https://docs.python.org/3/library/logging.config.html#logging-config-dictschema). The logger name that will be used is `URLMONITOR`. If this section is not present, sensible defaults will be used.\n\nAn example of the configuration follows::\n\n~~~yaml\n---\n\n# define global variables for all the actions\nset_vars:\n    var1: 5.4\n    var2:\n        - list\n        - of\n        - \"strings\"\n    var3:\n        keys: of\n        a: dict\n\n# load all the actions in a directory\n#   all the .py files in the directory will be loaded\n#   if the module is action_name.py, the action name will be 'action_name'\n#   and will be initialised with the objects in its entry in an\n#   an 'actions_config' section\n#\naction_dir: /path/to/dir1\n\naction_dir:\n    # specify a list of paths\n    - /path/to/dir2\n    - /another/path/dir3\n\n# actions and configuration objects:\n# configuration objects are mappings that the actions need to initialise\n# themselves, like the smtp host in a 'mail_send' action or a database name\n# and connection parameters to look up/store stuff etc.\n#\n# The actions will be called (or not) at runtime with the url that's changed,\n# the contents of that url, and the variables with their values at that point.\n\nactions_config:\n        # configuration objects for actions defined on action_dir\n        # as opposed to actions defined in actions:\n        action_in_dir1:\n            update_url: https://www.someserver.com\n            something_or_another: 34\n\n        some_action_in_dir3:\n            parameter: value\n            another_parameter: another_value\n\n\nactions:\n    # always a list containing mappings of actions and configuration values\n\n                # should always have a name and module\n    - name: add_to_database\n      module: /path/to/module.py\n                # ad_hoc configuration parameters, defined and expected by\n                # each particular action\n      dbhost: host1.mynetwork\n      dbname: documents\n      dbuser: albert\n      dbpassword: hello0011\n\n    - name: another_action:\n      module: /the/path/to/another_action.py\n      foo: bar\n\nlogging_config:\n     # the following is passed directly to logging.config.dictConfig()\n     loggers:\n        URLMONITOR:\n            level: DEBUG\n            handlers:\n                - console\n     handlers:\n         console:\n             class: logging.StreamHandler\n             stream: ext://sys.stdout\n             level: DEBUG\n~~~\n\n### Predefined Actions\n\nThe following actions are available out of the box:\n\n#### set_vars\nSet global variables. The variables defined using this action are global and can be used by all the URL objects and their actions.\n\nExample:\n```yaml\nset_vars:\n   value_1: 34\n   list_var:\n      - item 1\n      - item 2\n      - another item\n```\n\n#### list_vars\nThis action lists all the variables and their values to the log. The log level must be debug.\n\n#### no_action\nThis is a dummy action. It does nothing.\n\n#### re_match\nSearch the content of the URL using one or more regular expressions passed as arguments. The regular expressions are applied using ``re.MULTILINE`` (see [Python's ``re`` module documentation](https://docs.python.org/3/library/re.html#re.MULTILINE) ) i.e. '^' matches the beginning of every line and '$' matches every end of line.\n\nAs a result, it creates two variables:\n\n* ``re_match``: A list of all the group matches in the first regular expression.\n* ``re_match_all``: A list containing the list of all group matches of all the regular expressions in the argument list, in the same order as they appear.\n\nExample:\n\n```yaml\n  - name: Get amount and code\n    url: http://www.interesting.com/amounts_codes/\n    actions:\n       - re_match:\n             - 'The amount is:\\s*([0-9]+)'\n             - 'Code\\s*(\\w+)'\n       - set_vars:\n            amount: {re_match[1]}\n            code: {re_match_all[1][1]}\n```\n\n#### email_notify\nSend an email with a notification of the URL change to the recipient email addresses specified in the argument list.\n\nExample:\n```yaml\n- name: Check for new versions of my favourite software\n  url: https://www.coolproject.org/download/files\n  actions:\n    - email_notify:\n        - joe@domain.com\n        - jill@somewhere.else.com\n```\n\nBefore this action can be used it must be configured in the yaml configuration file with the following parameters:\n\nName            | Value                   | Default value\n----------------|-------------------------|-------------\nsmtp_server     | server name             |\nfrom_address    | email address           | urlmonitor@hostname\nsmtp_port       | port number             | 25 for SMTP, 587 for SSL\nsmtp_encryption | SSL or STARTTLS         | empty, no encryption\nsmtp_user       | username                | empty, no smtp authentication\nsmtp_password   | password base64 encoded |\n\nConfiguration example:\n\n```yaml\n- actions_config:\n     email_notify:\n         smtp_server: mailhost.server.com\n         from_address: urlbot@mydomain.com\n         smtp_encryption: STARTTLS\n         smtp_port: 465\n         smtp_user: phil\n         smtp_password: aGVsbG8wMDExMjI=\n```\n\n#### run_script\nThis action runs a program whose command line is its argument list.\n\nExample:\n\n```yaml\n- name: Download the new file\n  url: https://www.filesite.net/targetfiles.html\n  actions:\n      - re_match: '<a href=\\\"(.*)\\\">The file'\n      - run_script: wget {re_match[1]}\n```\nThis action sets the following variables:\n\nVariable    | Value\n------------|-----------------------------------\nreturn_code | The exit code of the program\nerror       | The error encountered, if any\nstdout      | Whatever the program has written to its standard output\nstderr      | Whatever the program has written to its error output\n\n\n### Writing Custom Actions\nYou can write a custom action easily. You just need to write a Python module that exports a callable called ``action_object`` with the following signature:\n\n```python\ndef action_object(name, arglst, url, content, variables, log):\n    pass\n```\n\nWhere the arguments are:\n\nArgument  | Description\n----------|--------\nname      | The action name\narglst    | The list of arguments.\nurl       | The url that changed\ncontent   | The content (possibly HTML) of the url\nvariables | A mapping containing the variables and their values\nlog       | A logging object\n\nIf the arguments in ``arglst`` will be expanded by the calling routine and should contain the final value.\n\nIf your action requires configuration parameters, you can create a class that has a ``__call__`` method and instantiate into ``action_object``. At configuration time, the program will call the ``initialise`` method with a dictionary containing the configuration parameters as argument.\n\nIn order to simplify the process, the module ``actionbase`` provides the class ``Action`` from which your action can inherit. This already provides an ``initialise`` method which will install the configuration parameters, which you can access as instance attributes of ``action_object``. In addition, you should provide a list of expected parameters and a default value for those that can have one in the class variables ``check_cfg_vars`` and ``default_vars``. An exception is raised if a parameter that has been specified in ``check_cfg_vars`` is not found and there is no default value.\n\nAs an example, you can check the code for the ``email_notify`` action.\n\n```python\nfrom urlmonitor.actionbase import Action\n\nclass _EmailAction(Action):\n\n    check_cfg_vars = [ \"smtp_server\", \"from_address\", \"smtp_encryption\",\n            \"smtp_user\", \"smtp_password\", \"smtp_port\"]\n    default_vars = {\n        \"from_address\": \"urlmonitor@{}\".format(_NODE),\n        \"smtp_encryption\": None,\n        \"smtp_user\": None,\n        \"smtp_password\": \"\",\n        \"smtp_port\": 0,\n        }\n\n    ...\n\n    def __call__(self, name, arglst, url, content, variables, log):\n        ...\n        \naction_object = _EmailAction()\n```\n\n\n### License\n\nThis software is released under the **MIT License**", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/destrangis/urlmonitor", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "urlmonitor", "package_url": "https://pypi.org/project/urlmonitor/", "platform": "", "project_url": "https://pypi.org/project/urlmonitor/", "project_urls": {"Homepage": "https://github.com/destrangis/urlmonitor"}, "release_url": "https://pypi.org/project/urlmonitor/0.0.8/", "requires_dist": null, "requires_python": "", "summary": "Check url and run actions if changed", "version": "0.0.8", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h2>UrlMonitor</h2>\n<p>This program is intended to be run periodically from cron or a systemd <code>.timer</code> service on GNU/Linux, a Periodic Task on Windows, or whatever you are using.</p>\n<p>When run, the program will check the URLs from its list, and, if they have changed since the last time they were checked, will run a series of actions as a result.</p>\n<p>The list of URLs and actions to be run if changed are specified in a YAML file (by default called <code>urllist.yml</code>). This file consist on a LIST of OBJECTS, each containing the fields name with a descriptive string, url with the url to be checked, and actions, which is a LIST of OBJECTS, where the key is the action name and the value are the arguments, which can be a STRING or a LIST of strings.</p>\n<p>An example of urllist.yml file:</p>\n<pre><span class=\"nn\">---</span>\n<span class=\"p p-Indicator\">-</span> <span class=\"nt\">name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">Check for new versions of my favourite software</span>\n  <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">https://www.coolproject.org/download/files</span>\n  <span class=\"nt\">actions</span><span class=\"p\">:</span>\n    <span class=\"p p-Indicator\">-</span> <span class=\"nt\">email_notify</span><span class=\"p\">:</span>\n        <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">joe@domain.com</span>\n        <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">jill@somewhere.else.com</span>\n\n<span class=\"p p-Indicator\">-</span> <span class=\"nt\">name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">Get latest version of the software</span>\n  <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">https://www.coolproject.org/latest</span>\n  <span class=\"nt\">actions</span><span class=\"p\">:</span>\n    <span class=\"p p-Indicator\">-</span> <span class=\"nt\">re_match</span><span class=\"p\">:</span>\n        <span class=\"p p-Indicator\">-</span> <span class=\"s\">'[Ss]ource</span><span class=\"nv\"> </span><span class=\"s\">[Tt]arball.*&lt;a</span><span class=\"nv\"> </span><span class=\"s\">href=\\\"([^\"]+)'</span>\n    <span class=\"p p-Indicator\">-</span> <span class=\"nt\">run_script</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">download_and_build https://www.coolproject.org/{re_match[1]}</span>\n</pre>\n<p>As you can see on the last line, the arguments to the actions are expanded with the variables from previous actions, the url, the contents, the HTTP status code obtained while fetching the URL, etc.</p>\n<h3>Installation</h3>\n<p>Just run the provided <code>setup.py</code> program:</p>\n<pre><code>$ python3 setup.py install\n</code></pre>\n<h3>Running</h3>\n<p>You can call the program with <code>--help</code> for the program options::</p>\n<pre><code>$ urlmonitor --help\nusage: urlmonitor [-h] [--config FILE] [--persist-file FILE]\n                  [ymlfile [ymlfile ...]]\n\npositional arguments:\n  ymlfile               Url check specification.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --config FILE, -c FILE\n                        Configuration file.\n  --persist-file FILE, -p FILE\n                        Persistence file to store URL status. Default\n                        ./persistence.sqlite\n</code></pre>\n<ul>\n<li>The <code>yml</code> file(s) contain the URLs to check, as discussed above.</li>\n<li>The <code>--persist-file</code> is a database that will be created in order to track whether the URLs have changed and when.</li>\n<li>The <code>--config</code> file is a YAML file that specifies where the options are located. It is discussed on the next section.</li>\n</ul>\n<h3>Configuration</h3>\n<p>UrlMonitor is configured using a YAML file containing an OBJECT with the different sections where you can specify:</p>\n<ul>\n<li>Global variables (<code>set_vars</code>): available to all the actions.</li>\n<li>Actions (<code>actions</code>): Each additional action individually, specifying its name, the Python module where it is located, and perhaps a set of configuration parameters.</li>\n<li>Action directories (<code>action_dir</code>): Specify a directory containing Python files. Each Python file contains an action named like the file.</li>\n<li>Action configurations (<code>action_config</code>): Contains an OBJECT whose entries are the names of the actions and the values are the configuration parameters for that action. Any action can be configured in this way, whether it has been specified using <code>action</code> or an <code>action_dir</code>. Some predefined actions also need to be configured this way, for example the <code>email_notify</code> predefined action needs the parameter <code>smtp_server</code> to be set.</li>\n<li>Logging configuration (<code>logging_config</code>): Contains the settings needed to call <code>logging.config.dictConfig()</code> as per the <a href=\"https://docs.python.org/3/library/logging.config.html#logging-config-dictschema\" rel=\"nofollow\">Python standard library documentation</a>. The logger name that will be used is <code>URLMONITOR</code>. If this section is not present, sensible defaults will be used.</li>\n</ul>\n<p>An example of the configuration follows::</p>\n<pre><span class=\"nn\">---</span>\n\n<span class=\"c1\"># define global variables for all the actions</span>\n<span class=\"nt\">set_vars</span><span class=\"p\">:</span>\n    <span class=\"nt\">var1</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">5.4</span>\n    <span class=\"nt\">var2</span><span class=\"p\">:</span>\n        <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">list</span>\n        <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">of</span>\n        <span class=\"p p-Indicator\">-</span> <span class=\"s\">\"strings\"</span>\n    <span class=\"nt\">var3</span><span class=\"p\">:</span>\n        <span class=\"nt\">keys</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">of</span>\n        <span class=\"nt\">a</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">dict</span>\n\n<span class=\"c1\"># load all the actions in a directory</span>\n<span class=\"c1\">#   all the .py files in the directory will be loaded</span>\n<span class=\"c1\">#   if the module is action_name.py, the action name will be 'action_name'</span>\n<span class=\"c1\">#   and will be initialised with the objects in its entry in an</span>\n<span class=\"c1\">#   an 'actions_config' section</span>\n<span class=\"c1\">#</span>\n<span class=\"nt\">action_dir</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">/path/to/dir1</span>\n\n<span class=\"nt\">action_dir</span><span class=\"p\">:</span>\n    <span class=\"c1\"># specify a list of paths</span>\n    <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">/path/to/dir2</span>\n    <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">/another/path/dir3</span>\n\n<span class=\"c1\"># actions and configuration objects:</span>\n<span class=\"c1\"># configuration objects are mappings that the actions need to initialise</span>\n<span class=\"c1\"># themselves, like the smtp host in a 'mail_send' action or a database name</span>\n<span class=\"c1\"># and connection parameters to look up/store stuff etc.</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># The actions will be called (or not) at runtime with the url that's changed,</span>\n<span class=\"c1\"># the contents of that url, and the variables with their values at that point.</span>\n\n<span class=\"nt\">actions_config</span><span class=\"p\">:</span>\n        <span class=\"c1\"># configuration objects for actions defined on action_dir</span>\n        <span class=\"c1\"># as opposed to actions defined in actions:</span>\n        <span class=\"nt\">action_in_dir1</span><span class=\"p\">:</span>\n            <span class=\"nt\">update_url</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">https://www.someserver.com</span>\n            <span class=\"nt\">something_or_another</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">34</span>\n\n        <span class=\"nt\">some_action_in_dir3</span><span class=\"p\">:</span>\n            <span class=\"nt\">parameter</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">value</span>\n            <span class=\"nt\">another_parameter</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">another_value</span>\n\n\n<span class=\"nt\">actions</span><span class=\"p\">:</span>\n    <span class=\"c1\"># always a list containing mappings of actions and configuration values</span>\n\n                <span class=\"c1\"># should always have a name and module</span>\n    <span class=\"p p-Indicator\">-</span> <span class=\"nt\">name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">add_to_database</span>\n      <span class=\"nt\">module</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">/path/to/module.py</span>\n                <span class=\"l l-Scalar l-Scalar-Plain\"># ad_hoc configuration parameters, defined and expected by</span>\n                <span class=\"l l-Scalar l-Scalar-Plain\"># each particular action</span>\n      <span class=\"nt\">dbhost</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">host1.mynetwork</span>\n      <span class=\"nt\">dbname</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">documents</span>\n      <span class=\"nt\">dbuser</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">albert</span>\n      <span class=\"nt\">dbpassword</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">hello0011</span>\n\n    <span class=\"p p-Indicator\">-</span> <span class=\"nt\">name</span><span class=\"p\">:</span> <span class=\"nt\">another_action</span><span class=\"p\">:</span>\n      <span class=\"nt\">module</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">/the/path/to/another_action.py</span>\n      <span class=\"nt\">foo</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">bar</span>\n\n<span class=\"nt\">logging_config</span><span class=\"p\">:</span>\n     <span class=\"c1\"># the following is passed directly to logging.config.dictConfig()</span>\n     <span class=\"nt\">loggers</span><span class=\"p\">:</span>\n        <span class=\"nt\">URLMONITOR</span><span class=\"p\">:</span>\n            <span class=\"nt\">level</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">DEBUG</span>\n            <span class=\"nt\">handlers</span><span class=\"p\">:</span>\n                <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">console</span>\n     <span class=\"nt\">handlers</span><span class=\"p\">:</span>\n         <span class=\"nt\">console</span><span class=\"p\">:</span>\n             <span class=\"nt\">class</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">logging.StreamHandler</span>\n             <span class=\"nt\">stream</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">ext://sys.stdout</span>\n             <span class=\"nt\">level</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">DEBUG</span>\n</pre>\n<h3>Predefined Actions</h3>\n<p>The following actions are available out of the box:</p>\n<h4>set_vars</h4>\n<p>Set global variables. The variables defined using this action are global and can be used by all the URL objects and their actions.</p>\n<p>Example:</p>\n<pre><span class=\"nt\">set_vars</span><span class=\"p\">:</span>\n   <span class=\"nt\">value_1</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">34</span>\n   <span class=\"nt\">list_var</span><span class=\"p\">:</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">item 1</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">item 2</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">another item</span>\n</pre>\n<h4>list_vars</h4>\n<p>This action lists all the variables and their values to the log. The log level must be debug.</p>\n<h4>no_action</h4>\n<p>This is a dummy action. It does nothing.</p>\n<h4>re_match</h4>\n<p>Search the content of the URL using one or more regular expressions passed as arguments. The regular expressions are applied using <code>re.MULTILINE</code> (see <a href=\"https://docs.python.org/3/library/re.html#re.MULTILINE\" rel=\"nofollow\">Python's <code>re</code> module documentation</a> ) i.e. '^' matches the beginning of every line and '$' matches every end of line.</p>\n<p>As a result, it creates two variables:</p>\n<ul>\n<li><code>re_match</code>: A list of all the group matches in the first regular expression.</li>\n<li><code>re_match_all</code>: A list containing the list of all group matches of all the regular expressions in the argument list, in the same order as they appear.</li>\n</ul>\n<p>Example:</p>\n<pre>  <span class=\"p p-Indicator\">-</span> <span class=\"nt\">name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">Get amount and code</span>\n    <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">http://www.interesting.com/amounts_codes/</span>\n    <span class=\"nt\">actions</span><span class=\"p\">:</span>\n       <span class=\"p p-Indicator\">-</span> <span class=\"nt\">re_match</span><span class=\"p\">:</span>\n             <span class=\"p p-Indicator\">-</span> <span class=\"s\">'The</span><span class=\"nv\"> </span><span class=\"s\">amount</span><span class=\"nv\"> </span><span class=\"s\">is:\\s*([0-9]+)'</span>\n             <span class=\"p p-Indicator\">-</span> <span class=\"s\">'Code\\s*(\\w+)'</span>\n       <span class=\"p p-Indicator\">-</span> <span class=\"nt\">set_vars</span><span class=\"p\">:</span>\n            <span class=\"nt\">amount</span><span class=\"p\">:</span> <span class=\"p p-Indicator\">{</span><span class=\"nv\">re_match</span><span class=\"p p-Indicator\">[</span><span class=\"nv\">1</span><span class=\"p p-Indicator\">]}</span>\n            <span class=\"nt\">code</span><span class=\"p\">:</span> <span class=\"p p-Indicator\">{</span><span class=\"nv\">re_match_all</span><span class=\"p p-Indicator\">[</span><span class=\"nv\">1</span><span class=\"p p-Indicator\">][</span><span class=\"nv\">1</span><span class=\"p p-Indicator\">]}</span>\n</pre>\n<h4>email_notify</h4>\n<p>Send an email with a notification of the URL change to the recipient email addresses specified in the argument list.</p>\n<p>Example:</p>\n<pre><span class=\"p p-Indicator\">-</span> <span class=\"nt\">name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">Check for new versions of my favourite software</span>\n  <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">https://www.coolproject.org/download/files</span>\n  <span class=\"nt\">actions</span><span class=\"p\">:</span>\n    <span class=\"p p-Indicator\">-</span> <span class=\"nt\">email_notify</span><span class=\"p\">:</span>\n        <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">joe@domain.com</span>\n        <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">jill@somewhere.else.com</span>\n</pre>\n<p>Before this action can be used it must be configured in the yaml configuration file with the following parameters:</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Value</th>\n<th>Default value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>smtp_server</td>\n<td>server name</td>\n<td></td>\n</tr>\n<tr>\n<td>from_address</td>\n<td>email address</td>\n<td>urlmonitor@hostname</td>\n</tr>\n<tr>\n<td>smtp_port</td>\n<td>port number</td>\n<td>25 for SMTP, 587 for SSL</td>\n</tr>\n<tr>\n<td>smtp_encryption</td>\n<td>SSL or STARTTLS</td>\n<td>empty, no encryption</td>\n</tr>\n<tr>\n<td>smtp_user</td>\n<td>username</td>\n<td>empty, no smtp authentication</td>\n</tr>\n<tr>\n<td>smtp_password</td>\n<td>password base64 encoded</td>\n<td></td>\n</tr></tbody></table>\n<p>Configuration example:</p>\n<pre><span class=\"p p-Indicator\">-</span> <span class=\"nt\">actions_config</span><span class=\"p\">:</span>\n     <span class=\"nt\">email_notify</span><span class=\"p\">:</span>\n         <span class=\"nt\">smtp_server</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">mailhost.server.com</span>\n         <span class=\"nt\">from_address</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">urlbot@mydomain.com</span>\n         <span class=\"nt\">smtp_encryption</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">STARTTLS</span>\n         <span class=\"nt\">smtp_port</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">465</span>\n         <span class=\"nt\">smtp_user</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">phil</span>\n         <span class=\"nt\">smtp_password</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">aGVsbG8wMDExMjI=</span>\n</pre>\n<h4>run_script</h4>\n<p>This action runs a program whose command line is its argument list.</p>\n<p>Example:</p>\n<pre><span class=\"p p-Indicator\">-</span> <span class=\"nt\">name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">Download the new file</span>\n  <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">https://www.filesite.net/targetfiles.html</span>\n  <span class=\"nt\">actions</span><span class=\"p\">:</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"nt\">re_match</span><span class=\"p\">:</span> <span class=\"s\">'&lt;a</span><span class=\"nv\"> </span><span class=\"s\">href=\\\"(.*)\\\"&gt;The</span><span class=\"nv\"> </span><span class=\"s\">file'</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"nt\">run_script</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">wget {re_match[1]}</span>\n</pre>\n<p>This action sets the following variables:</p>\n<table>\n<thead>\n<tr>\n<th>Variable</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>return_code</td>\n<td>The exit code of the program</td>\n</tr>\n<tr>\n<td>error</td>\n<td>The error encountered, if any</td>\n</tr>\n<tr>\n<td>stdout</td>\n<td>Whatever the program has written to its standard output</td>\n</tr>\n<tr>\n<td>stderr</td>\n<td>Whatever the program has written to its error output</td>\n</tr></tbody></table>\n<h3>Writing Custom Actions</h3>\n<p>You can write a custom action easily. You just need to write a Python module that exports a callable called <code>action_object</code> with the following signature:</p>\n<pre><span class=\"k\">def</span> <span class=\"nf\">action_object</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">arglst</span><span class=\"p\">,</span> <span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">log</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n</pre>\n<p>Where the arguments are:</p>\n<table>\n<thead>\n<tr>\n<th>Argument</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>name</td>\n<td>The action name</td>\n</tr>\n<tr>\n<td>arglst</td>\n<td>The list of arguments.</td>\n</tr>\n<tr>\n<td>url</td>\n<td>The url that changed</td>\n</tr>\n<tr>\n<td>content</td>\n<td>The content (possibly HTML) of the url</td>\n</tr>\n<tr>\n<td>variables</td>\n<td>A mapping containing the variables and their values</td>\n</tr>\n<tr>\n<td>log</td>\n<td>A logging object</td>\n</tr></tbody></table>\n<p>If the arguments in <code>arglst</code> will be expanded by the calling routine and should contain the final value.</p>\n<p>If your action requires configuration parameters, you can create a class that has a <code>__call__</code> method and instantiate into <code>action_object</code>. At configuration time, the program will call the <code>initialise</code> method with a dictionary containing the configuration parameters as argument.</p>\n<p>In order to simplify the process, the module <code>actionbase</code> provides the class <code>Action</code> from which your action can inherit. This already provides an <code>initialise</code> method which will install the configuration parameters, which you can access as instance attributes of <code>action_object</code>. In addition, you should provide a list of expected parameters and a default value for those that can have one in the class variables <code>check_cfg_vars</code> and <code>default_vars</code>. An exception is raised if a parameter that has been specified in <code>check_cfg_vars</code> is not found and there is no default value.</p>\n<p>As an example, you can check the code for the <code>email_notify</code> action.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">urlmonitor.actionbase</span> <span class=\"kn\">import</span> <span class=\"n\">Action</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">_EmailAction</span><span class=\"p\">(</span><span class=\"n\">Action</span><span class=\"p\">):</span>\n\n    <span class=\"n\">check_cfg_vars</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"s2\">\"smtp_server\"</span><span class=\"p\">,</span> <span class=\"s2\">\"from_address\"</span><span class=\"p\">,</span> <span class=\"s2\">\"smtp_encryption\"</span><span class=\"p\">,</span>\n            <span class=\"s2\">\"smtp_user\"</span><span class=\"p\">,</span> <span class=\"s2\">\"smtp_password\"</span><span class=\"p\">,</span> <span class=\"s2\">\"smtp_port\"</span><span class=\"p\">]</span>\n    <span class=\"n\">default_vars</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"from_address\"</span><span class=\"p\">:</span> <span class=\"s2\">\"urlmonitor@</span><span class=\"si\">{}</span><span class=\"s2\">\"</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">_NODE</span><span class=\"p\">),</span>\n        <span class=\"s2\">\"smtp_encryption\"</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"smtp_user\"</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"smtp_password\"</span><span class=\"p\">:</span> <span class=\"s2\">\"\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"smtp_port\"</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n\n    <span class=\"o\">...</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">arglst</span><span class=\"p\">,</span> <span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">log</span><span class=\"p\">):</span>\n        <span class=\"o\">...</span>\n        \n<span class=\"n\">action_object</span> <span class=\"o\">=</span> <span class=\"n\">_EmailAction</span><span class=\"p\">()</span>\n</pre>\n<h3>License</h3>\n<p>This software is released under the <strong>MIT License</strong></p>\n\n          </div>"}, "last_serial": 5958860, "releases": {"0.0.4": [{"comment_text": "", "digests": {"md5": "5d23b035db08fe02b2fdb3900718c29a", "sha256": "0a57bc7d650ad69a5bea8f225a519cb207af9d948c9f7d243ac0b528a6115b29"}, "downloads": -1, "filename": "urlmonitor-0.0.4.tar.gz", "has_sig": false, "md5_digest": "5d23b035db08fe02b2fdb3900718c29a", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 17753, "upload_time": "2019-05-26T19:44:21", "upload_time_iso_8601": "2019-05-26T19:44:21.965282Z", "url": "https://files.pythonhosted.org/packages/6c/d1/5480daed713e68b54b23ebcca720995bcb97bc85b1ca02f9b0892eac0eb1/urlmonitor-0.0.4.tar.gz", "yanked": false}], "0.0.8": [{"comment_text": "", "digests": {"md5": "7d0f9d764808a4636015de94dd777b9a", "sha256": "810277b5b9c2a3746ca7ef2704679f2c9b2f0f1fe742ccf7adeeffe503d58ddd"}, "downloads": -1, "filename": "urlmonitor-0.0.8.tar.gz", "has_sig": false, "md5_digest": "7d0f9d764808a4636015de94dd777b9a", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 17799, "upload_time": "2019-10-11T07:50:43", "upload_time_iso_8601": "2019-10-11T07:50:43.865120Z", "url": "https://files.pythonhosted.org/packages/2b/a5/6af81eb046edc29f785641cdc476cd98d70f5b16d5e8232dea81c6faf285/urlmonitor-0.0.8.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "7d0f9d764808a4636015de94dd777b9a", "sha256": "810277b5b9c2a3746ca7ef2704679f2c9b2f0f1fe742ccf7adeeffe503d58ddd"}, "downloads": -1, "filename": "urlmonitor-0.0.8.tar.gz", "has_sig": false, "md5_digest": "7d0f9d764808a4636015de94dd777b9a", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 17799, "upload_time": "2019-10-11T07:50:43", "upload_time_iso_8601": "2019-10-11T07:50:43.865120Z", "url": "https://files.pythonhosted.org/packages/2b/a5/6af81eb046edc29f785641cdc476cd98d70f5b16d5e8232dea81c6faf285/urlmonitor-0.0.8.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:39:22 2020"}