{"info": {"author": "Ben Timby", "author_email": "btimby@smartfile.com", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Environment :: Web Environment", "Framework :: Django", "Intended Audience :: Developers", "Operating System :: OS Independent", "Programming Language :: Python"], "description": ".. image:: https://travis-ci.org/btimby/django-tpq.svg?branch=master\r\n   :alt: Travis CI Status\r\n   :target: https://travis-ci.org/btimby/django-tpq\r\n\r\n.. image:: https://coveralls.io/repos/github/btimby/django-tpq/badge.svg?branch=master\r\n    :target: https://coveralls.io/github/btimby/django-tpq?branch=master\r\n    :alt: Code Coverage\r\n\r\n.. image:: https://badge.fury.io/py/django-tpq.svg\r\n    :target: https://badge.fury.io/py/django-tpq\r\n\r\nTrivial Postgres Queue for Django\r\n=================================\r\n\r\nThis is a Django application that integrates\r\n`tpq <https://github.com/btimby/tpq/>`_. This application provides basic\r\nmessage queue capabilities as well as a high-level futures implementation.\r\n\r\nMessage Queue\r\n-------------\r\n\r\nTo implement a message queue, you must first create a model derived from the\r\nabstract ``BaseQueue`` model. Once done, create a migration for that model, then\r\nedit the migration to add some additional database objects (tpq does this for\r\nyou, but you must call it from the migration). Then migrate and use your queue.\r\n\r\n.. code:: python\r\n\r\n    from django_tpq.main.models import BaseQueue\r\n\r\n    class MyQueue(BaseQueue):\r\n        pass\r\n\r\n::\r\n\r\n    $ python manage.py makemigrations\r\n\r\nNow edit the migration and add the RunPython step as is done with the futures\r\n`initial migration <https://github.com/btimby/django-tpq/blob/master/django_tpq/futures/migrations/0001_initial.py>`_.\r\nYou will also need to customize the model name in the ``forward`` function.\r\n\r\n::\r\n\r\n    $ python manage.py migrate\r\n\r\n\r\n.. code:: python\r\n\r\n    from myapp.models import MyQueue\r\n\r\n    MyQueue.objects.enqueue({'field': 'value'})\r\n    message = MyQueue.objects.dequeue()\r\n\r\nFutures\r\n-------\r\n\r\nUsing the above as a foundation, a simple Futures implementation is provided.\r\nFirst you must register any function you wish to call asynchronously as a future.\r\nThen call that future. You can optionally wait or poll for the results.\r\n\r\n.. code:: python\r\n\r\n    import time\r\n\r\n    from django_tpq.futures.decorators import future\r\n\r\n\r\n    @future()\r\n    def long_running_function(*args):\r\n        time.sleep(100)\r\n\r\n    # You can execute the future without waiting for a result. This returns\r\n    # immediately and your future runs within another process (fire and forget).\r\n    long_running_function.async('argument_1')\r\n\r\n    # Or you can poll for the results (or check after you do some other work).\r\n    f = long_running_function.async('argument_1')\r\n\r\n    while True:\r\n        try:\r\n            r = f.result()\r\n        except Exception:\r\n            # Exceptions are re-raised.\r\n            LOGGER.exception('Future failed', exc_info)\r\n            break\r\n        else:\r\n            break\r\n        time.sleep(10)\r\n\r\n    print(r)\r\n\r\n    # Or optionally, you can block waiting for the result.\r\n    f = long_running_function.call('argument_1')\r\n\r\n    try:\r\n        r = f.result(wait=0)\r\n    except Exception:\r\n        # Exceptions are re-raised.\r\n        LOGGER.exception('Future failed', exc_info)\r\n\r\n    print(r)\r\n\r\nFunction calls are dispatched via a message queue. Arguments are pickled, so you\r\ncan send any picklable Python objects. Results are delivered via your configured\r\ncache. By default the ``default`` cache is used, but you can use the\r\n``FUTURES_RESULT_CACHE`` setting to provide an alternate name for the Django\r\ncache you want to be used for results. Results have a TTL of 60 minutes by\r\ndefault but you can adjust this using the ``FUTURES_RESULT_TTL`` setting.\r\n\r\n\\* Note that if you use a very short TTL and start polling after it has already\r\nexpired, you will never see results. Further, if you use wait, you will wait\r\nforever.\r\n\r\nFutures are executed by a daemon started using a Django management command.\r\n\r\n::\r\n\r\n    $ python manage.py futures_executor --help\r\n    usage: manage.py futures_executor [-h] [--version] [-v {0,1,2,3}]\r\n                                      [--settings SETTINGS]\r\n                                      [--pythonpath PYTHONPATH] [--traceback]\r\n                                      [--no-color] [--queue_name QUEUE_NAME]\r\n                                      [--once] [--wait WAIT]\r\n\r\n    Daemon to execute futures.\r\n\r\n    optional arguments:\r\n      -h, --help            show this help message and exit\r\n      --version             show program's version number and exit\r\n      -v {0,1,2,3}, --verbosity {0,1,2,3}\r\n                            Verbosity level; 0=minimal output, 1=normal output,\r\n                            2=verbose output, 3=very verbose output\r\n      --settings SETTINGS   The Python path to a settings module, e.g.\r\n                            \"myproject.settings.main\". If this isn't provided, the\r\n                            DJANGO_SETTINGS_MODULE environment variable will be\r\n                            used.\r\n      --pythonpath PYTHONPATH\r\n                            A directory to add to the Python path, e.g.\r\n                            \"/home/djangoprojects/myproject\".\r\n      --traceback           Raise on CommandError exceptions\r\n      --no-color            Don't colorize the command output.\r\n      --queue_name QUEUE_NAME\r\n                            The queue to monitor. default: futures.FutureQueue\r\n      --once                Run one, then exit.\r\n      --wait WAIT           Wait time. Useful with --once.\r\n\r\nSome future statistics are also stored in your Postgres database for reporting\r\npurposes.\r\n\r\n.. code:: python\r\n\r\n    from django_tpq.futures.models import FutureStat\r\n\r\n    FutureStat.objects.all()\r\n\r\nThe ``FutureStat`` model has the following fields.\r\n\r\n- ``name`` - The python module.function of the future.\r\n- ``running`` - The number of currently executing futures of this type.\r\n- ``total`` - The total number of executed futures of this type.\r\n- ``failed`` - The number of futures resulting in an exception.\r\n- ``last_seen`` - The timestamp of the most recent execution of the future.\r\n- ``first_seen`` - The timestamp of the least recent execution of the future.\r\n\r\nBeing a model, you can use the Django ORM to report on these fields any way you\r\nsee fit.", "description_content_type": null, "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/btimby/tpq/", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "django-tpq", "package_url": "https://pypi.org/project/django-tpq/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/django-tpq/", "project_urls": {"Homepage": "https://github.com/btimby/tpq/"}, "release_url": "https://pypi.org/project/django-tpq/1.9/", "requires_dist": null, "requires_python": "", "summary": "Trivial Postgres Queue for Django", "version": "1.9", "yanked": false, "html_description": "<div class=\"project-description\">\n            <a href=\"https://travis-ci.org/btimby/django-tpq\" rel=\"nofollow\"><img alt=\"Travis CI Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/b8cf22a4b7cce14f0c39636db5e94792bdf16082/68747470733a2f2f7472617669732d63692e6f72672f6274696d62792f646a616e676f2d7470712e7376673f6272616e63683d6d6173746572\"></a>\n<a href=\"https://coveralls.io/github/btimby/django-tpq?branch=master\" rel=\"nofollow\"><img alt=\"Code Coverage\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/0cd9eb5fb59c8161bb98878adcc87f00e9764234/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f6274696d62792f646a616e676f2d7470712f62616467652e7376673f6272616e63683d6d6173746572\"></a>\n<a href=\"https://badge.fury.io/py/django-tpq\" rel=\"nofollow\"><img alt=\"https://badge.fury.io/py/django-tpq.svg\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/6787e78e9ff0514c09343de1903f62fd0ebb81a9/68747470733a2f2f62616467652e667572792e696f2f70792f646a616e676f2d7470712e737667\"></a>\n<div id=\"trivial-postgres-queue-for-django\">\n<h2>Trivial Postgres Queue for Django</h2>\n<p>This is a Django application that integrates\n<a href=\"https://github.com/btimby/tpq/\" rel=\"nofollow\">tpq</a>. This application provides basic\nmessage queue capabilities as well as a high-level futures implementation.</p>\n<div id=\"message-queue\">\n<h3>Message Queue</h3>\n<p>To implement a message queue, you must first create a model derived from the\nabstract <tt>BaseQueue</tt> model. Once done, create a migration for that model, then\nedit the migration to add some additional database objects (tpq does this for\nyou, but you must call it from the migration). Then migrate and use your queue.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_tpq.main.models</span> <span class=\"kn\">import</span> <span class=\"n\">BaseQueue</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">MyQueue</span><span class=\"p\">(</span><span class=\"n\">BaseQueue</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n</pre>\n<pre>$ python manage.py makemigrations\n</pre>\n<p>Now edit the migration and add the RunPython step as is done with the futures\n<a href=\"https://github.com/btimby/django-tpq/blob/master/django_tpq/futures/migrations/0001_initial.py\" rel=\"nofollow\">initial migration</a>.\nYou will also need to customize the model name in the <tt>forward</tt> function.</p>\n<pre>$ python manage.py migrate\n</pre>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">myapp.models</span> <span class=\"kn\">import</span> <span class=\"n\">MyQueue</span>\n\n<span class=\"n\">MyQueue</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">enqueue</span><span class=\"p\">({</span><span class=\"s1\">'field'</span><span class=\"p\">:</span> <span class=\"s1\">'value'</span><span class=\"p\">})</span>\n<span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"n\">MyQueue</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">dequeue</span><span class=\"p\">()</span>\n</pre>\n</div>\n<div id=\"futures\">\n<h3>Futures</h3>\n<p>Using the above as a foundation, a simple Futures implementation is provided.\nFirst you must register any function you wish to call asynchronously as a future.\nThen call that future. You can optionally wait or poll for the results.</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">time</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django_tpq.futures.decorators</span> <span class=\"kn\">import</span> <span class=\"n\">future</span>\n\n\n<span class=\"nd\">@future</span><span class=\"p\">()</span>\n<span class=\"k\">def</span> <span class=\"nf\">long_running_function</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">):</span>\n    <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># You can execute the future without waiting for a result. This returns</span>\n<span class=\"c1\"># immediately and your future runs within another process (fire and forget).</span>\n<span class=\"n\">long_running_function</span><span class=\"o\">.</span><span class=\"k\">async</span><span class=\"p\">(</span><span class=\"s1\">'argument_1'</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Or you can poll for the results (or check after you do some other work).</span>\n<span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">long_running_function</span><span class=\"o\">.</span><span class=\"k\">async</span><span class=\"p\">(</span><span class=\"s1\">'argument_1'</span><span class=\"p\">)</span>\n\n<span class=\"k\">while</span> <span class=\"kc\">True</span><span class=\"p\">:</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"p\">()</span>\n    <span class=\"k\">except</span> <span class=\"ne\">Exception</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Exceptions are re-raised.</span>\n        <span class=\"n\">LOGGER</span><span class=\"o\">.</span><span class=\"n\">exception</span><span class=\"p\">(</span><span class=\"s1\">'Future failed'</span><span class=\"p\">,</span> <span class=\"n\">exc_info</span><span class=\"p\">)</span>\n        <span class=\"k\">break</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">break</span>\n    <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">)</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Or optionally, you can block waiting for the result.</span>\n<span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">long_running_function</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">(</span><span class=\"s1\">'argument_1'</span><span class=\"p\">)</span>\n\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"p\">(</span><span class=\"n\">wait</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"k\">except</span> <span class=\"ne\">Exception</span><span class=\"p\">:</span>\n    <span class=\"c1\"># Exceptions are re-raised.</span>\n    <span class=\"n\">LOGGER</span><span class=\"o\">.</span><span class=\"n\">exception</span><span class=\"p\">(</span><span class=\"s1\">'Future failed'</span><span class=\"p\">,</span> <span class=\"n\">exc_info</span><span class=\"p\">)</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)</span>\n</pre>\n<p>Function calls are dispatched via a message queue. Arguments are pickled, so you\ncan send any picklable Python objects. Results are delivered via your configured\ncache. By default the <tt>default</tt> cache is used, but you can use the\n<tt>FUTURES_RESULT_CACHE</tt> setting to provide an alternate name for the Django\ncache you want to be used for results. Results have a TTL of 60 minutes by\ndefault but you can adjust this using the <tt>FUTURES_RESULT_TTL</tt> setting.</p>\n<p>* Note that if you use a very short TTL and start polling after it has already\nexpired, you will never see results. Further, if you use wait, you will wait\nforever.</p>\n<p>Futures are executed by a daemon started using a Django management command.</p>\n<pre>$ python manage.py futures_executor --help\nusage: manage.py futures_executor [-h] [--version] [-v {0,1,2,3}]\n                                  [--settings SETTINGS]\n                                  [--pythonpath PYTHONPATH] [--traceback]\n                                  [--no-color] [--queue_name QUEUE_NAME]\n                                  [--once] [--wait WAIT]\n\nDaemon to execute futures.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --version             show program's version number and exit\n  -v {0,1,2,3}, --verbosity {0,1,2,3}\n                        Verbosity level; 0=minimal output, 1=normal output,\n                        2=verbose output, 3=very verbose output\n  --settings SETTINGS   The Python path to a settings module, e.g.\n                        \"myproject.settings.main\". If this isn't provided, the\n                        DJANGO_SETTINGS_MODULE environment variable will be\n                        used.\n  --pythonpath PYTHONPATH\n                        A directory to add to the Python path, e.g.\n                        \"/home/djangoprojects/myproject\".\n  --traceback           Raise on CommandError exceptions\n  --no-color            Don't colorize the command output.\n  --queue_name QUEUE_NAME\n                        The queue to monitor. default: futures.FutureQueue\n  --once                Run one, then exit.\n  --wait WAIT           Wait time. Useful with --once.\n</pre>\n<p>Some future statistics are also stored in your Postgres database for reporting\npurposes.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django_tpq.futures.models</span> <span class=\"kn\">import</span> <span class=\"n\">FutureStat</span>\n\n<span class=\"n\">FutureStat</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">()</span>\n</pre>\n<p>The <tt>FutureStat</tt> model has the following fields.</p>\n<ul>\n<li><tt>name</tt> - The python module.function of the future.</li>\n<li><tt>running</tt> - The number of currently executing futures of this type.</li>\n<li><tt>total</tt> - The total number of executed futures of this type.</li>\n<li><tt>failed</tt> - The number of futures resulting in an exception.</li>\n<li><tt>last_seen</tt> - The timestamp of the most recent execution of the future.</li>\n<li><tt>first_seen</tt> - The timestamp of the least recent execution of the future.</li>\n</ul>\n<p>Being a model, you can use the Django ORM to report on these fields any way you\nsee fit.</p>\n</div>\n</div>\n\n          </div>"}, "last_serial": 2874565, "releases": {"1.9": [{"comment_text": "", "digests": {"md5": "c53e01b3c561d9175ee83af68c265db9", "sha256": "7c6985ff1a12c2373d403678d5fe4b603bc9267cdbcdc89bbf8e8fabc2642227"}, "downloads": -1, "filename": "django_tpq-1.9.tar.gz", "has_sig": false, "md5_digest": "c53e01b3c561d9175ee83af68c265db9", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3683, "upload_time": "2017-05-15T04:35:02", "upload_time_iso_8601": "2017-05-15T04:35:02.039651Z", "url": "https://files.pythonhosted.org/packages/63/bb/019783c009bb4a46d2f1a2494d00867d33edd9b6c7d06d6caa663886d171/django_tpq-1.9.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "c53e01b3c561d9175ee83af68c265db9", "sha256": "7c6985ff1a12c2373d403678d5fe4b603bc9267cdbcdc89bbf8e8fabc2642227"}, "downloads": -1, "filename": "django_tpq-1.9.tar.gz", "has_sig": false, "md5_digest": "c53e01b3c561d9175ee83af68c265db9", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 3683, "upload_time": "2017-05-15T04:35:02", "upload_time_iso_8601": "2017-05-15T04:35:02.039651Z", "url": "https://files.pythonhosted.org/packages/63/bb/019783c009bb4a46d2f1a2494d00867d33edd9b6c7d06d6caa663886d171/django_tpq-1.9.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:52:23 2020"}