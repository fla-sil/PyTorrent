{"info": {"author": "George Osterweil", "author_email": "george@georgeosterweil.com", "bugtrack_url": null, "classifiers": ["License :: OSI Approved :: GNU General Public License v3 (GPLv3)", "Operating System :: Microsoft :: Windows", "Programming Language :: Python :: 3.7", "Topic :: Security", "Topic :: System :: Operating System"], "description": "# Winstrument\nWinstrument is a framework of modular scripts to aid in instrumenting Windows software using Frida for reverse engineering and attack surface analysis.\n\n### Contents\n* [Installation](#installation)\n* [Usage](#usage)\n* [Project Structure](#project-structure)\n* [Modules](#modules)\n* [CLI](#cli)\n* [Troubleshooting](#troubleshooting)\n* [Copyright](#copyright)\n\n## Installation\nThis project supports python 3.7.\nAssuming you already have Python and pip installed, simply:\n\n~~~\npip install winstrument\n~~~\nand then to execute the program, run:\n~~~\nwinstrument\n~~~\n\nIn some cases, such as a fresh Windows 10 install, you may encounter a SSL error in pip when installing Frida. If this happens, see [Troubleshooting](#troubleshooting) below.\n## Usage\n\nTo run the winstrument REPL, simply run `winstrument`.\nHere's a quick example of instrumenting `notepad.exe` with the `registry` module. For full info on the available CLI commands, see [the CLI section](#CLI) below.\n\n```\nPS C:\\winstrument> winstrument\n> set target C:\\Windows\\System32\\notepad.exe\n> use registry\n> run\nSpawned 1144\ninstrumented process with pid: 1144 and path: C:\\Windows\\System32\\notepad.exe\n\n<User closes notepad from GUI>\n\ndetached from 1144 for reason process-terminated\n> show registry\nmodule    time               target                           function          hkey                subkey                                                                       value\n--------  -----------------  -------------------------------  ----------------  ------------------  ---------------------------------------------------------------------------  ---------------------------------\nregistry  2019-08-19 07:03:07  C:\\Windows\\System32\\notepad.exe  RegGetValueW      0x2f4               SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize                 AppsUseLightTheme\n<...>\n```\n\nIn the above example, the user indicates the target process, in this case `notepad.exe`. They then indicate they want to use the `registry` module, which enumerates registry-related system calls made by the program. After the process is done (the user closes Notepad), the stored output can be viewed using `show registry`.\n## Project Structure\n\nThe main python file `winstrument.py` initializes the Frida device and spawns an instance of the target process. \n`cmdline.py` provides a commandline interface using cmd2. This is the main script entry point when Winstrument is run directly from the command line. The commands are documented below. \n\nIt then goes through each enabled module, instantiates it, and calls that modules's `load_scripts()` method to instrument the process.\nFinally, it calls `get_output()` and `on_finish()` for each module when detached from the target.\n\nModules are contained in .py files in the `modules/` directory. A module consists of a subclass of `base_module.BaseInstrumentation` which defines the code to inject, message handling for that injected code, and output.\nThe module APIs are defined further in the \"Modules\" section below.\n\nEach module stores metadata such as its description `modules/metadata.toml`. The section should be headed with the name of the module (case insensitive).\nFor example, here is the section corresponding to the `dlls`  module:\n\n~~~ toml\n[DLLS]\ndescription = \"\"\"Hooks LoadLibrary-family system calls and outputs DLL loads where part of the search path might be\nwritable by the current user or a low-privileged user group.\"\"\"\n~~~\n\nThe program stores settings in `settings.toml` in `%APPDATA%/winstrument`.\nAs most, if not all, modules will inject Javascript into the target process, the `modules/js/` directory contains Frida Javascript snippets which are loaded and injected by modules. \nThese files should have the same name as the module i.e. the module `dlls.py` would use JS from `js/dlls.js`.\n\n\n## Modules\n\nAs described above, each module subclasses `BaseInstrumentation` from `base_module.py`\n\nEach module should define its name (the name of the python and js files without the extension) as a static class attribute called `modulename`. \nModules may use or override the following methods from `BaseInstrumentation`:\n* `__init__(self,*args,**kwargs)` - In addition to any module specific init code, this constructor should call `super().__init__(*args,**kwargs)`.  \n* `load_script(self)` - This method generally should not need to be overridden, as the implementation in `BaseInstrumentation` should be sufficient for most use cases. To hook onto Frida events, override `register_callbacks()` instead. `load_script` should be used to load the javascript file to instrument, call `session.create_script` from Frida, add any desired callbacks, then calls the script objects's `load()` method to instrument.\n* `register_callbacks(self)` - Called by `BaseInstrumentation.load_script` prior to loading the script into the target process. Used to register events such as `_session.on('message')` etc. The `BaseInstrumentation` version adds a hook for on_message by default.\n* `write_message(message)` takes a JSON-like message as a dict, writes it the sqlite database and saves it to be output later.\n* `post_load(self)` Called by `BaseInstrumentation.load_script` after the script is loaded inside the target process. This could be used, for example, to call rpc methods exported by the script.\n* `get_output(self)` - Called by the main script when the target is detached. This method should return a list, where each entry is one MoudleMessage object (from `data/module_message.py`). Generally doesn't need to be overridden.\n* `on_message(self,message,data)` - Callback for handling the frida `message` event, which is triggered by `send` in injected JS\n* `on_finish(self)` - Callback called by the main script when the target becomes detached. Perform any cleanup operations required here.\n\n## CLI\n\nThe Winstrument shell provides the following commands:\n* `list` - Display all available and loaded modules\n* `load <modulename>`/`use <modulename>` - Enable the module with the given name\n* `unload <modulename>` - Disable the module with the given name\n* `set [setting [value]]` - With no arguments, show all settings and their values.  With one argument, show value of `setting`. With two arguments, set `setting` to `value`. Settings persist across multiple runs.\n* `show [modulename [format]]` - Display stored input from `modulename` in the specified `format`. Run without arguments to view a list of formatters.\n* `info <modulename>` - Prints a description of of the module with the given name.\n* `run` - Start instrumentation.\n* `q`/`quit`/`exit` - Quits the CLI (obviously).\n\n## Troubleshooting\n\n### Pip fails with \"SSL Certificate Verify Failed\" when installing Frida\nThis seems to occur mostly on a new installation of Windows. Frida's setup.py tries to pull a .egg file from https://files.pythonhosted.org. In some cases, this fails because the SSL certificate for that domain does not verify. This appears to be a side-effect of the way Windows loads root CAs. Windows seems to not ship all the root CAs in a default install, instead preferring to pull them as needed when websites are visited. As a result, the root CA that signed `files.pythonhosted.org`'s SSL cert might not be in the system trust store.\n\nTo resolve this issue, visit https://files.pythonhosted.org manually in Edge or Chrome to get Windows to add the root CA to its trust store, then try `pip install` again.\nNote that visiting the page in Firefox will **not** work, because Firefox uses its own trust store rather than the system store.\n\n\n## Copyright\nWinstrument is licensed under GPLv3. For more details see the LICENSE file.\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/nccgroup/Winstrument", "keywords": "winstrument instrumentation frida reverse engineering", "license": "GPLv3", "maintainer": "", "maintainer_email": "", "name": "winstrument", "package_url": "https://pypi.org/project/winstrument/", "platform": "", "project_url": "https://pypi.org/project/winstrument/", "project_urls": {"Homepage": "https://github.com/nccgroup/Winstrument"}, "release_url": "https://pypi.org/project/winstrument/0.1.0/", "requires_dist": ["attrs (==19.1.0)", "cmd2 (==0.9.15)", "colorama (==0.4.1)", "frida (<13.0.0,>=12.6.17)", "frida-tools (==3.0.0)", "pyperclip (==1.7.0)", "pyreadline (==2.1)", "pywin32 (==224)", "tabulate (==0.8.3)", "toml (==0.10.0)", "wcwidth (==0.1.7)"], "requires_python": ">=3.7.0", "summary": "", "version": "0.1.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>Winstrument</h1>\n<p>Winstrument is a framework of modular scripts to aid in instrumenting Windows software using Frida for reverse engineering and attack surface analysis.</p>\n<h3>Contents</h3>\n<ul>\n<li><a href=\"#installation\" rel=\"nofollow\">Installation</a></li>\n<li><a href=\"#usage\" rel=\"nofollow\">Usage</a></li>\n<li><a href=\"#project-structure\" rel=\"nofollow\">Project Structure</a></li>\n<li><a href=\"#modules\" rel=\"nofollow\">Modules</a></li>\n<li><a href=\"#cli\" rel=\"nofollow\">CLI</a></li>\n<li><a href=\"#troubleshooting\" rel=\"nofollow\">Troubleshooting</a></li>\n<li><a href=\"#copyright\" rel=\"nofollow\">Copyright</a></li>\n</ul>\n<h2>Installation</h2>\n<p>This project supports python 3.7.\nAssuming you already have Python and pip installed, simply:</p>\n<pre><code>pip install winstrument\n</code></pre>\n<p>and then to execute the program, run:</p>\n<pre><code>winstrument\n</code></pre>\n<p>In some cases, such as a fresh Windows 10 install, you may encounter a SSL error in pip when installing Frida. If this happens, see <a href=\"#troubleshooting\" rel=\"nofollow\">Troubleshooting</a> below.</p>\n<h2>Usage</h2>\n<p>To run the winstrument REPL, simply run <code>winstrument</code>.\nHere's a quick example of instrumenting <code>notepad.exe</code> with the <code>registry</code> module. For full info on the available CLI commands, see <a href=\"#CLI\" rel=\"nofollow\">the CLI section</a> below.</p>\n<pre><code>PS C:\\winstrument&gt; winstrument\n&gt; set target C:\\Windows\\System32\\notepad.exe\n&gt; use registry\n&gt; run\nSpawned 1144\ninstrumented process with pid: 1144 and path: C:\\Windows\\System32\\notepad.exe\n\n&lt;User closes notepad from GUI&gt;\n\ndetached from 1144 for reason process-terminated\n&gt; show registry\nmodule    time               target                           function          hkey                subkey                                                                       value\n--------  -----------------  -------------------------------  ----------------  ------------------  ---------------------------------------------------------------------------  ---------------------------------\nregistry  2019-08-19 07:03:07  C:\\Windows\\System32\\notepad.exe  RegGetValueW      0x2f4               SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize                 AppsUseLightTheme\n&lt;...&gt;\n</code></pre>\n<p>In the above example, the user indicates the target process, in this case <code>notepad.exe</code>. They then indicate they want to use the <code>registry</code> module, which enumerates registry-related system calls made by the program. After the process is done (the user closes Notepad), the stored output can be viewed using <code>show registry</code>.</p>\n<h2>Project Structure</h2>\n<p>The main python file <code>winstrument.py</code> initializes the Frida device and spawns an instance of the target process.\n<code>cmdline.py</code> provides a commandline interface using cmd2. This is the main script entry point when Winstrument is run directly from the command line. The commands are documented below.</p>\n<p>It then goes through each enabled module, instantiates it, and calls that modules's <code>load_scripts()</code> method to instrument the process.\nFinally, it calls <code>get_output()</code> and <code>on_finish()</code> for each module when detached from the target.</p>\n<p>Modules are contained in .py files in the <code>modules/</code> directory. A module consists of a subclass of <code>base_module.BaseInstrumentation</code> which defines the code to inject, message handling for that injected code, and output.\nThe module APIs are defined further in the \"Modules\" section below.</p>\n<p>Each module stores metadata such as its description <code>modules/metadata.toml</code>. The section should be headed with the name of the module (case insensitive).\nFor example, here is the section corresponding to the <code>dlls</code>  module:</p>\n<pre><span class=\"k\">[DLLS]</span>\n<span class=\"n\">description</span> <span class=\"o\">=</span> <span class=\"s\">\"\"\"Hooks LoadLibrary-family system calls and outputs DLL loads where part of the search path might be</span>\n<span class=\"s\">writable by the current user or a low-privileged user group.\"\"\"</span>\n</pre>\n<p>The program stores settings in <code>settings.toml</code> in <code>%APPDATA%/winstrument</code>.\nAs most, if not all, modules will inject Javascript into the target process, the <code>modules/js/</code> directory contains Frida Javascript snippets which are loaded and injected by modules.\nThese files should have the same name as the module i.e. the module <code>dlls.py</code> would use JS from <code>js/dlls.js</code>.</p>\n<h2>Modules</h2>\n<p>As described above, each module subclasses <code>BaseInstrumentation</code> from <code>base_module.py</code></p>\n<p>Each module should define its name (the name of the python and js files without the extension) as a static class attribute called <code>modulename</code>.\nModules may use or override the following methods from <code>BaseInstrumentation</code>:</p>\n<ul>\n<li><code>__init__(self,*args,**kwargs)</code> - In addition to any module specific init code, this constructor should call <code>super().__init__(*args,**kwargs)</code>.</li>\n<li><code>load_script(self)</code> - This method generally should not need to be overridden, as the implementation in <code>BaseInstrumentation</code> should be sufficient for most use cases. To hook onto Frida events, override <code>register_callbacks()</code> instead. <code>load_script</code> should be used to load the javascript file to instrument, call <code>session.create_script</code> from Frida, add any desired callbacks, then calls the script objects's <code>load()</code> method to instrument.</li>\n<li><code>register_callbacks(self)</code> - Called by <code>BaseInstrumentation.load_script</code> prior to loading the script into the target process. Used to register events such as <code>_session.on('message')</code> etc. The <code>BaseInstrumentation</code> version adds a hook for on_message by default.</li>\n<li><code>write_message(message)</code> takes a JSON-like message as a dict, writes it the sqlite database and saves it to be output later.</li>\n<li><code>post_load(self)</code> Called by <code>BaseInstrumentation.load_script</code> after the script is loaded inside the target process. This could be used, for example, to call rpc methods exported by the script.</li>\n<li><code>get_output(self)</code> - Called by the main script when the target is detached. This method should return a list, where each entry is one MoudleMessage object (from <code>data/module_message.py</code>). Generally doesn't need to be overridden.</li>\n<li><code>on_message(self,message,data)</code> - Callback for handling the frida <code>message</code> event, which is triggered by <code>send</code> in injected JS</li>\n<li><code>on_finish(self)</code> - Callback called by the main script when the target becomes detached. Perform any cleanup operations required here.</li>\n</ul>\n<h2>CLI</h2>\n<p>The Winstrument shell provides the following commands:</p>\n<ul>\n<li><code>list</code> - Display all available and loaded modules</li>\n<li><code>load &lt;modulename&gt;</code>/<code>use &lt;modulename&gt;</code> - Enable the module with the given name</li>\n<li><code>unload &lt;modulename&gt;</code> - Disable the module with the given name</li>\n<li><code>set [setting [value]]</code> - With no arguments, show all settings and their values.  With one argument, show value of <code>setting</code>. With two arguments, set <code>setting</code> to <code>value</code>. Settings persist across multiple runs.</li>\n<li><code>show [modulename [format]]</code> - Display stored input from <code>modulename</code> in the specified <code>format</code>. Run without arguments to view a list of formatters.</li>\n<li><code>info &lt;modulename&gt;</code> - Prints a description of of the module with the given name.</li>\n<li><code>run</code> - Start instrumentation.</li>\n<li><code>q</code>/<code>quit</code>/<code>exit</code> - Quits the CLI (obviously).</li>\n</ul>\n<h2>Troubleshooting</h2>\n<h3>Pip fails with \"SSL Certificate Verify Failed\" when installing Frida</h3>\n<p>This seems to occur mostly on a new installation of Windows. Frida's setup.py tries to pull a .egg file from <a href=\"https://files.pythonhosted.org\" rel=\"nofollow\">https://files.pythonhosted.org</a>. In some cases, this fails because the SSL certificate for that domain does not verify. This appears to be a side-effect of the way Windows loads root CAs. Windows seems to not ship all the root CAs in a default install, instead preferring to pull them as needed when websites are visited. As a result, the root CA that signed <code>files.pythonhosted.org</code>'s SSL cert might not be in the system trust store.</p>\n<p>To resolve this issue, visit <a href=\"https://files.pythonhosted.org\" rel=\"nofollow\">https://files.pythonhosted.org</a> manually in Edge or Chrome to get Windows to add the root CA to its trust store, then try <code>pip install</code> again.\nNote that visiting the page in Firefox will <strong>not</strong> work, because Firefox uses its own trust store rather than the system store.</p>\n<h2>Copyright</h2>\n<p>Winstrument is licensed under GPLv3. For more details see the LICENSE file.</p>\n\n          </div>"}, "last_serial": 6579901, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "d6c594898c69ce17935dd477618aacb1", "sha256": "c5383440e81332830153644ebcdb34d05a6dbc290a6d0054240542fc2083039f"}, "downloads": -1, "filename": "winstrument-0.1.0-py3.7.egg", "has_sig": false, "md5_digest": "d6c594898c69ce17935dd477618aacb1", "packagetype": "bdist_egg", "python_version": "3.7", "requires_python": ">=3.7.0", "size": 63214, "upload_time": "2020-02-06T02:23:11", "upload_time_iso_8601": "2020-02-06T02:23:11.948038Z", "url": "https://files.pythonhosted.org/packages/e8/e5/ad861b11e571dfefff826c7c6e364ec4450a49db86930b92e97e3fc4bd04/winstrument-0.1.0-py3.7.egg", "yanked": false}, {"comment_text": "", "digests": {"md5": "5b48eb2ebb13f6b6f62e20aefddc1ad4", "sha256": "487d0f116cfb51489c3589c4f7f5aca4851b608ddb52fc1796fd1dcb5fef7e62"}, "downloads": -1, "filename": "winstrument-0.1.0-py3-none-any.whl", "has_sig": false, "md5_digest": "5b48eb2ebb13f6b6f62e20aefddc1ad4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7.0", "size": 48882, "upload_time": "2020-02-06T02:23:10", "upload_time_iso_8601": "2020-02-06T02:23:10.011391Z", "url": "https://files.pythonhosted.org/packages/75/0b/3637f668e9ade8260ae47fd4da02b5e595885585d7050e91e90db8342eb8/winstrument-0.1.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "b9f9727c607a49d1fba5fd9789e780fa", "sha256": "d3e3914a70110caac0945190849e96e4e0075a4d56a742c99d30b84ad774e317"}, "downloads": -1, "filename": "winstrument-0.1.0.tar.gz", "has_sig": false, "md5_digest": "b9f9727c607a49d1fba5fd9789e780fa", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7.0", "size": 23765, "upload_time": "2020-02-06T02:23:13", "upload_time_iso_8601": "2020-02-06T02:23:13.024098Z", "url": "https://files.pythonhosted.org/packages/1f/1e/751730359e8893c038910a131e7b6ad1b802a875b3ab95166361aa3cb4de/winstrument-0.1.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "d6c594898c69ce17935dd477618aacb1", "sha256": "c5383440e81332830153644ebcdb34d05a6dbc290a6d0054240542fc2083039f"}, "downloads": -1, "filename": "winstrument-0.1.0-py3.7.egg", "has_sig": false, "md5_digest": "d6c594898c69ce17935dd477618aacb1", "packagetype": "bdist_egg", "python_version": "3.7", "requires_python": ">=3.7.0", "size": 63214, "upload_time": "2020-02-06T02:23:11", "upload_time_iso_8601": "2020-02-06T02:23:11.948038Z", "url": "https://files.pythonhosted.org/packages/e8/e5/ad861b11e571dfefff826c7c6e364ec4450a49db86930b92e97e3fc4bd04/winstrument-0.1.0-py3.7.egg", "yanked": false}, {"comment_text": "", "digests": {"md5": "5b48eb2ebb13f6b6f62e20aefddc1ad4", "sha256": "487d0f116cfb51489c3589c4f7f5aca4851b608ddb52fc1796fd1dcb5fef7e62"}, "downloads": -1, "filename": "winstrument-0.1.0-py3-none-any.whl", "has_sig": false, "md5_digest": "5b48eb2ebb13f6b6f62e20aefddc1ad4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7.0", "size": 48882, "upload_time": "2020-02-06T02:23:10", "upload_time_iso_8601": "2020-02-06T02:23:10.011391Z", "url": "https://files.pythonhosted.org/packages/75/0b/3637f668e9ade8260ae47fd4da02b5e595885585d7050e91e90db8342eb8/winstrument-0.1.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "b9f9727c607a49d1fba5fd9789e780fa", "sha256": "d3e3914a70110caac0945190849e96e4e0075a4d56a742c99d30b84ad774e317"}, "downloads": -1, "filename": "winstrument-0.1.0.tar.gz", "has_sig": false, "md5_digest": "b9f9727c607a49d1fba5fd9789e780fa", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7.0", "size": 23765, "upload_time": "2020-02-06T02:23:13", "upload_time_iso_8601": "2020-02-06T02:23:13.024098Z", "url": "https://files.pythonhosted.org/packages/1f/1e/751730359e8893c038910a131e7b6ad1b802a875b3ab95166361aa3cb4de/winstrument-0.1.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:28:51 2020"}