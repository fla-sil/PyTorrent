{"info": {"author": "Chris Laws", "author_email": "clawsicus@gmail.com", "bugtrack_url": null, "classifiers": ["Intended Audience :: Developers", "License :: OSI Approved :: MIT License", "Operating System :: OS Independent", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7", "Programming Language :: Python :: 3.8", "Topic :: System :: Monitoring"], "description": "![Build Status](https://github.com/claws/prometheus_metrics_proto/workflows/Build%20Workflow/badge.svg?branch=master) [![pypi](https://img.shields.io/pypi/v/prometheus_metrics_proto.svg)](https://pypi.python.org/pypi/prometheus_metrics_proto) ![License](https://img.shields.io/github/license/claws/prometheus_metrics_proto) ![pyversions](https://img.shields.io/pypi/pyversions/prometheus_metrics_proto) ![Style](https://img.shields.io/badge/code%20style-black-000000.svg)\n\n# prometheus_metrics_proto\n\nThe ``prometheus_metrics_proto`` package provides Prometheus Protobuf data\nstructures and a set of helper functions to assist generating Prometheus\nProtocol Buffer format metrics and serializing them in preparation for\nnetwork transfer.\n\nThe collection of metrics and the management of Summary Quantiles and\nHistogram Buckets are outside the scope of functionality provided by\nthis package.\n\nAn example of a project using ``prometheus_metrics_proto`` is\n[aioprometheus](https://github.com/claws/aioprometheus>) which uses it\nwithin the the BinaryFormatter.\n\nThe Protocol Buffer specification used by ``prometheus_metrics_proto`` was\nobtained from the Prometheus [client model[(<https://github.com/prometheus/client_model/blob/master/metrics.proto>)\nrepo.\n\n\n## Install\n\n```console\n$ pip install prometheus_metrics_proto\n```\n\n## Example\n\nThe ``prometheus_metrics_proto`` package provides helper functions to assist with\ngenerating Prometheus metrics objects.\n\nThe example below shows how these functions can be used to construct metrics\nand encode them into a format suitable to send to Prometheus server in a\nresponse.\n\n```python\n#!/usr/bin/env python\n\"\"\"\nThis script demonstrates the high level helper functions used to assist\ncreating various metrics kinds as well as how to encode the metrics into\na form that can be sent to Prometheus server.\n\"\"\"\n\nimport prometheus_metrics_proto as pmp\n\n\ndef main():\n\n    # Define some labels that we want added to all metrics. These labels are\n    # independent of the instance labels that define a metric as unique.\n    # These could be used to add hostname, app name, etc.\n    const_labels = {\"host\": \"examplehost\", \"app\": \"my_app\"}\n\n    # Create a Counter metric to track logged in users. This counter has\n    # 5 separate instances.\n    # We'll make use of the optional const_labels argument to add extra\n    # constant labels.\n    # We will also add a timestamp to the metric instances.\n    # We will request that the labels be sorted.\n    cm = pmp.create_counter(\n        \"logged_users_total\",\n        \"Logged users in the application.\",\n        (\n            ({\"country\": \"sp\", \"device\": \"desktop\"}, 520),\n            ({\"country\": \"us\", \"device\": \"mobile\"}, 654),\n            ({\"country\": \"uk\", \"device\": \"desktop\"}, 1001),\n            ({\"country\": \"de\", \"device\": \"desktop\"}, 995),\n            ({\"country\": \"zh\", \"device\": \"desktop\"}, 520),\n        ),\n        timestamp=True,\n        const_labels=const_labels,\n        ordered=True,\n    )\n\n    # Create a Gauge metric, similar to the counter above.\n    gm = pmp.create_gauge(\n        \"logged_users_total\",\n        \"Logged users in the application.\",\n        (\n            ({\"country\": \"sp\", \"device\": \"desktop\"}, 520),\n            ({\"country\": \"us\", \"device\": \"mobile\"}, 654),\n            ({\"country\": \"uk\", \"device\": \"desktop\"}, 1001),\n            ({\"country\": \"de\", \"device\": \"desktop\"}, 995),\n            ({\"country\": \"zh\", \"device\": \"desktop\"}, 520),\n        ),\n        timestamp=True,\n        const_labels=const_labels,\n        ordered=True,\n    )\n\n    # Now lets create a Summary and Histogram metric object. These forms\n    # of metrics are slightly more complicated.\n    #\n    # Remember, the collection of metrics and the management of Summary\n    # Quantiles and Histogram Buckets are outside the scope of\n    # functionality provided by this package.\n    #\n    # The following examples assume they are taking the data values from\n    # a management library that can also emit the sum and count fields\n    # expected for both Summary and Histogram metrics.\n\n    # Create a Summary metric. The values for a summary are slightly\n    # different to a Counter or Gauge. They are composed of a dict representing\n    # the various quantile values of the metric. The count and sum are\n    # expected to be present in this dict.\n    sm = pmp.create_summary(\n        \"request_payload_size_bytes\",\n        \"Request payload size in bytes.\",\n        (\n            ({\"route\": \"/\"}, {0.5: 4.0, 0.9: 5.2, 0.99: 5.2, \"sum\": 25.2, \"count\": 4}),\n            (\n                {\"route\": \"/data\"},\n                {0.5: 4.0, 0.9: 5.2, 0.99: 5.2, \"sum\": 25.2, \"count\": 4},\n            ),\n        ),\n        timestamp=True,\n        const_labels=const_labels,\n        ordered=True,\n    )\n\n    # Create a Histogram metric. The values for a histogram are slightly\n    # different to a Counter or Gauge. They are composed of a dict representing\n    # the various bucket values of the metric. The cumulative count and sum\n    # values are expected to be present in this dict.\n    #\n    # Libraries manageing buckets typically have add a POS_INF upper bound to\n    # catch values beyond the largest bucket bound. Simulate this behavior in\n    # the data below.\n    POS_INF = float(\"inf\")\n\n    hm = pmp.create_histogram(\n        \"request_latency_seconds\",\n        \"Request latency in seconds.\",\n        (\n            (\n                {\"route\": \"/\"},\n                {5.0: 3, 10.0: 2, 15.0: 1, POS_INF: 0, \"count\": 6, \"sum\": 46.0},\n            ),\n            (\n                {\"route\": \"/data\"},\n                {5.0: 3, 10.0: 2, 15.0: 1, POS_INF: 0, \"count\": 6, \"sum\": 46.0},\n            ),\n        ),\n        timestamp=True,\n        const_labels=const_labels,\n        ordered=True,\n    )\n\n    # Serialize a sequence of metrics into a payload suitable for network\n    # transmission.\n    input_metrics = (cm, gm, sm, hm)\n    payload = pmp.encode(*input_metrics)\n    assert isinstance(payload, bytes)\n\n    # De-serialize the payload into a sequence of MetricsFamily objects.\n    recovered_metrics = pmp.decode(payload)\n\n    # Confirm that the round trip re-produced the same number of metrics\n    # and that the metrics are identical.\n    assert len(recovered_metrics) == len(input_metrics)\n    for recovered_metric, input_metric in zip(recovered_metrics, input_metrics):\n        assert recovered_metric == input_metric\n\n    for metric in input_metrics:\n        print(metric)\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\nIf you simply want to access the Prometheus Protocol Buffer objects directly\nand generate instances yourself simply import them from the package as\nfollows:\n\n```python\nfrom prometheus_metrics_proto import (\n    COUNTER,\n    GAUGE,\n    SUMMARY,\n    HISTOGRAM,\n    Bucket,\n    Counter,\n    Gauge,\n    Histogram,\n    LabelPair,\n    Metric,\n    MetricFamily,\n    Summary,\n    Quantile)\n```\n\n## License\n\nThis project is released under the MIT license.\n\n\n## Background\n\nCreating metrics that can be ingested by Prometheus is relatively simple,\nbut does require knowledge of how they are composed.\n\nThe Prometheus server expects to ingest ``MetricsFamily`` objects when it\nscrapes an endpoint exposing Protocol Buffer format data.\n\nA ``MetricFamily`` object is a container that holds the metric name, a help\nstring and ``Metric`` objects. Each ``MetricFamily`` within the same\nexposition must have a unique name.\n\nA ``Metric`` object is a container for a single instance of a specific metric\ntype. Valid metric types are Counter, Gauge, Histogram and Summary. Each\n``Metric`` within the same ``MetricFamily`` must have a unique set of\n``LabelPair`` fields. This is commonly referred to as multi-dimensional metrics.\n\n\n## Development\n\n\n### Get the source\n\n```console\n$ git clone git@github.com:claws/prometheus_metrics_proto.git\n$ cd prometheus_metrics_proto\n```\n\n### Setup\n\nThe best way to work on `prometheus_metrics_proto` is to create a virtual env.\nThis isolates your work from other project's dependencies and ensures that any\ncommands are pointing at the correct tools.\n\n> You may need to explicitly specify which Python to use if you have\n> multiple Python's available on your system  (e.g. ``python3``,\n> ``python3.8``).\n\n```console\n$ python3 -m venv venv --prompt pmp\n$ source venv/bin/activate\n(pmp) $\n(pmp) $ pip install pip --upgrade\n```\n\n> The following steps assume you are operating in a virtual environment.\n\nTo exit the virtual environment simply type ``deactivate``.\n\n### Install Development Environment\n\nRules in the convenience Makefile depend on the development dependencies\nbeing installed. Install the developmental dependencies using ``pip``. Then\ninstall the `prometheus_metrics_proto` package (and its normal dependencies)\nin a way that allows you to edit the code after it is installed so that any\nchanges take effect immediately.\n\n```console\n(pmp) $ pip install -r requirements.dev.txt\n(pmp) $ pip install -e .\n```\n\nFamiliarise yourself with the convenience Makefile rules by running make\nwithout any rule specified.\n\n```console\n$ make\n```\n\n### Code Style\n\nThis project uses the Black code style formatter for consistent code style.\nA Makefile convenience rule is available to apply code style compliance.\n\n```console\n(pmp) $ make style\n```\n\n### Test\n\nThe easiest method to run all of the unit tests is to run the ``make test``\nrule from the top level directory. This runs the standard library ``unittest``\ntool which discovers all the unit tests and runs them.\n\n```console\n(pmp) $ make test\n```\n\nor\n\n```console\n(pmp) $ make test-verbose\n```\n\n### Coverage\n\nA Makefile convenience rule is available to check how much of the code is\ncovered by tests.\n\n```console\n(pmp) $ make coverage\n```\n\nThe test code coverage report can be found `here <htmlcov/index.html>`_\n\n\n### Regenerate\n\nThe project has placed the code stub (``prometheus_metrics_pb2.py``),\ngenerated by the Google Protocol Buffers code generation tool, under source\ncontrol.\n\nIf this file needs to be regenerated in the future use the following procedure:\n\n```console\n(pmp) $ make regenerate\n```\n\n## Release Process\n\nThe following steps are used to make a new software release:\n\n- Ensure that the version label in ``__init__.py`` is updated.\n\n- Create the distribution. This project produces an artefact called a pure\n  Python wheel. Only Python3 is supported by this package.\n\n  ```console\n  (pmp) $ make dist\n  ```\n\n- Test distribution. This involves creating a virtual environment, installing\n  the distribution in it and running the tests. These steps have been captured\n  for convenience in a Makefile rule.\n\n  ```console\n  (pmp) $ make dist-test\n  ```\n\n- Upload to PyPI.\n\n  ```console\n  (pmp) $ make dist-upload\n  ```\n\n- Create and push a repo tag to Github.\n\n  ```console\n  git tag YY.MM.MICRO -m \"A meaningful release tag comment\"\n  git tag  # check release tag is in list\n  git push --tags origin master\n  ```\n\n  - Github will create a release tarball at:\n\n    > https://github.com/{username}/{repo}/tarball/{tag}.tar.gz\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/claws/prometheus_metrics_proto", "keywords": "prometheus,monitoring,metrics", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "prometheus-metrics-proto", "package_url": "https://pypi.org/project/prometheus-metrics-proto/", "platform": "", "project_url": "https://pypi.org/project/prometheus-metrics-proto/", "project_urls": {"Homepage": "https://github.com/claws/prometheus_metrics_proto"}, "release_url": "https://pypi.org/project/prometheus-metrics-proto/18.1.2/", "requires_dist": ["protobuf"], "requires_python": "", "summary": "Prometheus binary format metrics data structures for Python client libraries", "version": "18.1.2", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><img alt=\"Build Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/5721c28574d779b3e77f207c644642fe2d5aa1ce/68747470733a2f2f6769746875622e636f6d2f636c6177732f70726f6d6574686575735f6d6574726963735f70726f746f2f776f726b666c6f77732f4275696c64253230576f726b666c6f772f62616467652e7376673f6272616e63683d6d6173746572\"> <a href=\"https://pypi.python.org/pypi/prometheus_metrics_proto\" rel=\"nofollow\"><img alt=\"pypi\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/b33c75a5096d4907a5ddbbba1c0fd0a5b87ba258/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f70726f6d6574686575735f6d6574726963735f70726f746f2e737667\"></a> <img alt=\"License\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/e8ca310820961a1e4f49bbb6d919a26c7219dc13/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f636c6177732f70726f6d6574686575735f6d6574726963735f70726f746f\"> <img alt=\"pyversions\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/a84c643238a4ef0b7003f88c1aee17a50292b296/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f70726f6d6574686575735f6d6574726963735f70726f746f\"> <img alt=\"Style\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/fbfdc7754183ecf079bc71ddeabaf88f6cbc5c00/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f64652532307374796c652d626c61636b2d3030303030302e737667\"></p>\n<h1>prometheus_metrics_proto</h1>\n<p>The <code>prometheus_metrics_proto</code> package provides Prometheus Protobuf data\nstructures and a set of helper functions to assist generating Prometheus\nProtocol Buffer format metrics and serializing them in preparation for\nnetwork transfer.</p>\n<p>The collection of metrics and the management of Summary Quantiles and\nHistogram Buckets are outside the scope of functionality provided by\nthis package.</p>\n<p>An example of a project using <code>prometheus_metrics_proto</code> is\n<a href=\"https://github.com/claws/aioprometheus%3E\" rel=\"nofollow\">aioprometheus</a> which uses it\nwithin the the BinaryFormatter.</p>\n<p>The Protocol Buffer specification used by <code>prometheus_metrics_proto</code> was\nobtained from the Prometheus [client model[(<a href=\"https://github.com/prometheus/client_model/blob/master/metrics.proto\" rel=\"nofollow\">https://github.com/prometheus/client_model/blob/master/metrics.proto</a>)\nrepo.</p>\n<h2>Install</h2>\n<pre><span class=\"gp\">$</span> pip install prometheus_metrics_proto\n</pre>\n<h2>Example</h2>\n<p>The <code>prometheus_metrics_proto</code> package provides helper functions to assist with\ngenerating Prometheus metrics objects.</p>\n<p>The example below shows how these functions can be used to construct metrics\nand encode them into a format suitable to send to Prometheus server in a\nresponse.</p>\n<pre><span class=\"ch\">#!/usr/bin/env python</span>\n<span class=\"sd\">\"\"\"</span>\n<span class=\"sd\">This script demonstrates the high level helper functions used to assist</span>\n<span class=\"sd\">creating various metrics kinds as well as how to encode the metrics into</span>\n<span class=\"sd\">a form that can be sent to Prometheus server.</span>\n<span class=\"sd\">\"\"\"</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">prometheus_metrics_proto</span> <span class=\"k\">as</span> <span class=\"nn\">pmp</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">main</span><span class=\"p\">():</span>\n\n    <span class=\"c1\"># Define some labels that we want added to all metrics. These labels are</span>\n    <span class=\"c1\"># independent of the instance labels that define a metric as unique.</span>\n    <span class=\"c1\"># These could be used to add hostname, app name, etc.</span>\n    <span class=\"n\">const_labels</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">\"host\"</span><span class=\"p\">:</span> <span class=\"s2\">\"examplehost\"</span><span class=\"p\">,</span> <span class=\"s2\">\"app\"</span><span class=\"p\">:</span> <span class=\"s2\">\"my_app\"</span><span class=\"p\">}</span>\n\n    <span class=\"c1\"># Create a Counter metric to track logged in users. This counter has</span>\n    <span class=\"c1\"># 5 separate instances.</span>\n    <span class=\"c1\"># We'll make use of the optional const_labels argument to add extra</span>\n    <span class=\"c1\"># constant labels.</span>\n    <span class=\"c1\"># We will also add a timestamp to the metric instances.</span>\n    <span class=\"c1\"># We will request that the labels be sorted.</span>\n    <span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">pmp</span><span class=\"o\">.</span><span class=\"n\">create_counter</span><span class=\"p\">(</span>\n        <span class=\"s2\">\"logged_users_total\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"Logged users in the application.\"</span><span class=\"p\">,</span>\n        <span class=\"p\">(</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"sp\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"desktop\"</span><span class=\"p\">},</span> <span class=\"mi\">520</span><span class=\"p\">),</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"us\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"mobile\"</span><span class=\"p\">},</span> <span class=\"mi\">654</span><span class=\"p\">),</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"uk\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"desktop\"</span><span class=\"p\">},</span> <span class=\"mi\">1001</span><span class=\"p\">),</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"de\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"desktop\"</span><span class=\"p\">},</span> <span class=\"mi\">995</span><span class=\"p\">),</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"zh\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"desktop\"</span><span class=\"p\">},</span> <span class=\"mi\">520</span><span class=\"p\">),</span>\n        <span class=\"p\">),</span>\n        <span class=\"n\">timestamp</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n        <span class=\"n\">const_labels</span><span class=\"o\">=</span><span class=\"n\">const_labels</span><span class=\"p\">,</span>\n        <span class=\"n\">ordered</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"c1\"># Create a Gauge metric, similar to the counter above.</span>\n    <span class=\"n\">gm</span> <span class=\"o\">=</span> <span class=\"n\">pmp</span><span class=\"o\">.</span><span class=\"n\">create_gauge</span><span class=\"p\">(</span>\n        <span class=\"s2\">\"logged_users_total\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"Logged users in the application.\"</span><span class=\"p\">,</span>\n        <span class=\"p\">(</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"sp\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"desktop\"</span><span class=\"p\">},</span> <span class=\"mi\">520</span><span class=\"p\">),</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"us\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"mobile\"</span><span class=\"p\">},</span> <span class=\"mi\">654</span><span class=\"p\">),</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"uk\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"desktop\"</span><span class=\"p\">},</span> <span class=\"mi\">1001</span><span class=\"p\">),</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"de\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"desktop\"</span><span class=\"p\">},</span> <span class=\"mi\">995</span><span class=\"p\">),</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"country\"</span><span class=\"p\">:</span> <span class=\"s2\">\"zh\"</span><span class=\"p\">,</span> <span class=\"s2\">\"device\"</span><span class=\"p\">:</span> <span class=\"s2\">\"desktop\"</span><span class=\"p\">},</span> <span class=\"mi\">520</span><span class=\"p\">),</span>\n        <span class=\"p\">),</span>\n        <span class=\"n\">timestamp</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n        <span class=\"n\">const_labels</span><span class=\"o\">=</span><span class=\"n\">const_labels</span><span class=\"p\">,</span>\n        <span class=\"n\">ordered</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"c1\"># Now lets create a Summary and Histogram metric object. These forms</span>\n    <span class=\"c1\"># of metrics are slightly more complicated.</span>\n    <span class=\"c1\">#</span>\n    <span class=\"c1\"># Remember, the collection of metrics and the management of Summary</span>\n    <span class=\"c1\"># Quantiles and Histogram Buckets are outside the scope of</span>\n    <span class=\"c1\"># functionality provided by this package.</span>\n    <span class=\"c1\">#</span>\n    <span class=\"c1\"># The following examples assume they are taking the data values from</span>\n    <span class=\"c1\"># a management library that can also emit the sum and count fields</span>\n    <span class=\"c1\"># expected for both Summary and Histogram metrics.</span>\n\n    <span class=\"c1\"># Create a Summary metric. The values for a summary are slightly</span>\n    <span class=\"c1\"># different to a Counter or Gauge. They are composed of a dict representing</span>\n    <span class=\"c1\"># the various quantile values of the metric. The count and sum are</span>\n    <span class=\"c1\"># expected to be present in this dict.</span>\n    <span class=\"n\">sm</span> <span class=\"o\">=</span> <span class=\"n\">pmp</span><span class=\"o\">.</span><span class=\"n\">create_summary</span><span class=\"p\">(</span>\n        <span class=\"s2\">\"request_payload_size_bytes\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"Request payload size in bytes.\"</span><span class=\"p\">,</span>\n        <span class=\"p\">(</span>\n            <span class=\"p\">({</span><span class=\"s2\">\"route\"</span><span class=\"p\">:</span> <span class=\"s2\">\"/\"</span><span class=\"p\">},</span> <span class=\"p\">{</span><span class=\"mf\">0.5</span><span class=\"p\">:</span> <span class=\"mf\">4.0</span><span class=\"p\">,</span> <span class=\"mf\">0.9</span><span class=\"p\">:</span> <span class=\"mf\">5.2</span><span class=\"p\">,</span> <span class=\"mf\">0.99</span><span class=\"p\">:</span> <span class=\"mf\">5.2</span><span class=\"p\">,</span> <span class=\"s2\">\"sum\"</span><span class=\"p\">:</span> <span class=\"mf\">25.2</span><span class=\"p\">,</span> <span class=\"s2\">\"count\"</span><span class=\"p\">:</span> <span class=\"mi\">4</span><span class=\"p\">}),</span>\n            <span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">\"route\"</span><span class=\"p\">:</span> <span class=\"s2\">\"/data\"</span><span class=\"p\">},</span>\n                <span class=\"p\">{</span><span class=\"mf\">0.5</span><span class=\"p\">:</span> <span class=\"mf\">4.0</span><span class=\"p\">,</span> <span class=\"mf\">0.9</span><span class=\"p\">:</span> <span class=\"mf\">5.2</span><span class=\"p\">,</span> <span class=\"mf\">0.99</span><span class=\"p\">:</span> <span class=\"mf\">5.2</span><span class=\"p\">,</span> <span class=\"s2\">\"sum\"</span><span class=\"p\">:</span> <span class=\"mf\">25.2</span><span class=\"p\">,</span> <span class=\"s2\">\"count\"</span><span class=\"p\">:</span> <span class=\"mi\">4</span><span class=\"p\">},</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">),</span>\n        <span class=\"n\">timestamp</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n        <span class=\"n\">const_labels</span><span class=\"o\">=</span><span class=\"n\">const_labels</span><span class=\"p\">,</span>\n        <span class=\"n\">ordered</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"c1\"># Create a Histogram metric. The values for a histogram are slightly</span>\n    <span class=\"c1\"># different to a Counter or Gauge. They are composed of a dict representing</span>\n    <span class=\"c1\"># the various bucket values of the metric. The cumulative count and sum</span>\n    <span class=\"c1\"># values are expected to be present in this dict.</span>\n    <span class=\"c1\">#</span>\n    <span class=\"c1\"># Libraries manageing buckets typically have add a POS_INF upper bound to</span>\n    <span class=\"c1\"># catch values beyond the largest bucket bound. Simulate this behavior in</span>\n    <span class=\"c1\"># the data below.</span>\n    <span class=\"n\">POS_INF</span> <span class=\"o\">=</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"s2\">\"inf\"</span><span class=\"p\">)</span>\n\n    <span class=\"n\">hm</span> <span class=\"o\">=</span> <span class=\"n\">pmp</span><span class=\"o\">.</span><span class=\"n\">create_histogram</span><span class=\"p\">(</span>\n        <span class=\"s2\">\"request_latency_seconds\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"Request latency in seconds.\"</span><span class=\"p\">,</span>\n        <span class=\"p\">(</span>\n            <span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">\"route\"</span><span class=\"p\">:</span> <span class=\"s2\">\"/\"</span><span class=\"p\">},</span>\n                <span class=\"p\">{</span><span class=\"mf\">5.0</span><span class=\"p\">:</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mf\">10.0</span><span class=\"p\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mf\">15.0</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">POS_INF</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"s2\">\"count\"</span><span class=\"p\">:</span> <span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"s2\">\"sum\"</span><span class=\"p\">:</span> <span class=\"mf\">46.0</span><span class=\"p\">},</span>\n            <span class=\"p\">),</span>\n            <span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">\"route\"</span><span class=\"p\">:</span> <span class=\"s2\">\"/data\"</span><span class=\"p\">},</span>\n                <span class=\"p\">{</span><span class=\"mf\">5.0</span><span class=\"p\">:</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mf\">10.0</span><span class=\"p\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mf\">15.0</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">POS_INF</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"s2\">\"count\"</span><span class=\"p\">:</span> <span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"s2\">\"sum\"</span><span class=\"p\">:</span> <span class=\"mf\">46.0</span><span class=\"p\">},</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">),</span>\n        <span class=\"n\">timestamp</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n        <span class=\"n\">const_labels</span><span class=\"o\">=</span><span class=\"n\">const_labels</span><span class=\"p\">,</span>\n        <span class=\"n\">ordered</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"c1\"># Serialize a sequence of metrics into a payload suitable for network</span>\n    <span class=\"c1\"># transmission.</span>\n    <span class=\"n\">input_metrics</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">,</span> <span class=\"n\">gm</span><span class=\"p\">,</span> <span class=\"n\">sm</span><span class=\"p\">,</span> <span class=\"n\">hm</span><span class=\"p\">)</span>\n    <span class=\"n\">payload</span> <span class=\"o\">=</span> <span class=\"n\">pmp</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">input_metrics</span><span class=\"p\">)</span>\n    <span class=\"k\">assert</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">payload</span><span class=\"p\">,</span> <span class=\"nb\">bytes</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># De-serialize the payload into a sequence of MetricsFamily objects.</span>\n    <span class=\"n\">recovered_metrics</span> <span class=\"o\">=</span> <span class=\"n\">pmp</span><span class=\"o\">.</span><span class=\"n\">decode</span><span class=\"p\">(</span><span class=\"n\">payload</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Confirm that the round trip re-produced the same number of metrics</span>\n    <span class=\"c1\"># and that the metrics are identical.</span>\n    <span class=\"k\">assert</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">recovered_metrics</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">input_metrics</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">recovered_metric</span><span class=\"p\">,</span> <span class=\"n\">input_metric</span> <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">recovered_metrics</span><span class=\"p\">,</span> <span class=\"n\">input_metrics</span><span class=\"p\">):</span>\n        <span class=\"k\">assert</span> <span class=\"n\">recovered_metric</span> <span class=\"o\">==</span> <span class=\"n\">input_metric</span>\n\n    <span class=\"k\">for</span> <span class=\"n\">metric</span> <span class=\"ow\">in</span> <span class=\"n\">input_metrics</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">metric</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s2\">\"__main__\"</span><span class=\"p\">:</span>\n    <span class=\"n\">main</span><span class=\"p\">()</span>\n</pre>\n<p>If you simply want to access the Prometheus Protocol Buffer objects directly\nand generate instances yourself simply import them from the package as\nfollows:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">prometheus_metrics_proto</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">COUNTER</span><span class=\"p\">,</span>\n    <span class=\"n\">GAUGE</span><span class=\"p\">,</span>\n    <span class=\"n\">SUMMARY</span><span class=\"p\">,</span>\n    <span class=\"n\">HISTOGRAM</span><span class=\"p\">,</span>\n    <span class=\"n\">Bucket</span><span class=\"p\">,</span>\n    <span class=\"n\">Counter</span><span class=\"p\">,</span>\n    <span class=\"n\">Gauge</span><span class=\"p\">,</span>\n    <span class=\"n\">Histogram</span><span class=\"p\">,</span>\n    <span class=\"n\">LabelPair</span><span class=\"p\">,</span>\n    <span class=\"n\">Metric</span><span class=\"p\">,</span>\n    <span class=\"n\">MetricFamily</span><span class=\"p\">,</span>\n    <span class=\"n\">Summary</span><span class=\"p\">,</span>\n    <span class=\"n\">Quantile</span><span class=\"p\">)</span>\n</pre>\n<h2>License</h2>\n<p>This project is released under the MIT license.</p>\n<h2>Background</h2>\n<p>Creating metrics that can be ingested by Prometheus is relatively simple,\nbut does require knowledge of how they are composed.</p>\n<p>The Prometheus server expects to ingest <code>MetricsFamily</code> objects when it\nscrapes an endpoint exposing Protocol Buffer format data.</p>\n<p>A <code>MetricFamily</code> object is a container that holds the metric name, a help\nstring and <code>Metric</code> objects. Each <code>MetricFamily</code> within the same\nexposition must have a unique name.</p>\n<p>A <code>Metric</code> object is a container for a single instance of a specific metric\ntype. Valid metric types are Counter, Gauge, Histogram and Summary. Each\n<code>Metric</code> within the same <code>MetricFamily</code> must have a unique set of\n<code>LabelPair</code> fields. This is commonly referred to as multi-dimensional metrics.</p>\n<h2>Development</h2>\n<h3>Get the source</h3>\n<pre><span class=\"gp\">$</span> git clone git@github.com:claws/prometheus_metrics_proto.git\n<span class=\"gp\">$</span> <span class=\"nb\">cd</span> prometheus_metrics_proto\n</pre>\n<h3>Setup</h3>\n<p>The best way to work on <code>prometheus_metrics_proto</code> is to create a virtual env.\nThis isolates your work from other project's dependencies and ensures that any\ncommands are pointing at the correct tools.</p>\n<blockquote>\n<p>You may need to explicitly specify which Python to use if you have\nmultiple Python's available on your system  (e.g. <code>python3</code>,\n<code>python3.8</code>).</p>\n</blockquote>\n<pre><span class=\"gp\">$</span> python3 -m venv venv --prompt pmp\n<span class=\"gp\">$</span> <span class=\"nb\">source</span> venv/bin/activate\n<span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span>\n<span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> pip install pip --upgrade\n</pre>\n<blockquote>\n<p>The following steps assume you are operating in a virtual environment.</p>\n</blockquote>\n<p>To exit the virtual environment simply type <code>deactivate</code>.</p>\n<h3>Install Development Environment</h3>\n<p>Rules in the convenience Makefile depend on the development dependencies\nbeing installed. Install the developmental dependencies using <code>pip</code>. Then\ninstall the <code>prometheus_metrics_proto</code> package (and its normal dependencies)\nin a way that allows you to edit the code after it is installed so that any\nchanges take effect immediately.</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> pip install -r requirements.dev.txt\n<span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> pip install -e .\n</pre>\n<p>Familiarise yourself with the convenience Makefile rules by running make\nwithout any rule specified.</p>\n<pre><span class=\"gp\">$</span> make\n</pre>\n<h3>Code Style</h3>\n<p>This project uses the Black code style formatter for consistent code style.\nA Makefile convenience rule is available to apply code style compliance.</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> make style\n</pre>\n<h3>Test</h3>\n<p>The easiest method to run all of the unit tests is to run the <code>make test</code>\nrule from the top level directory. This runs the standard library <code>unittest</code>\ntool which discovers all the unit tests and runs them.</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> make <span class=\"nb\">test</span>\n</pre>\n<p>or</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> make test-verbose\n</pre>\n<h3>Coverage</h3>\n<p>A Makefile convenience rule is available to check how much of the code is\ncovered by tests.</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> make coverage\n</pre>\n<p>The test code coverage report can be found <code>here &lt;htmlcov/index.html&gt;</code>_</p>\n<h3>Regenerate</h3>\n<p>The project has placed the code stub (<code>prometheus_metrics_pb2.py</code>),\ngenerated by the Google Protocol Buffers code generation tool, under source\ncontrol.</p>\n<p>If this file needs to be regenerated in the future use the following procedure:</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> make regenerate\n</pre>\n<h2>Release Process</h2>\n<p>The following steps are used to make a new software release:</p>\n<ul>\n<li>\n<p>Ensure that the version label in <code>__init__.py</code> is updated.</p>\n</li>\n<li>\n<p>Create the distribution. This project produces an artefact called a pure\nPython wheel. Only Python3 is supported by this package.</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> make dist\n</pre>\n</li>\n<li>\n<p>Test distribution. This involves creating a virtual environment, installing\nthe distribution in it and running the tests. These steps have been captured\nfor convenience in a Makefile rule.</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> make dist-test\n</pre>\n</li>\n<li>\n<p>Upload to PyPI.</p>\n<pre><span class=\"gp gp-VirtualEnv\">(pmp)</span> <span class=\"gp\">$</span> make dist-upload\n</pre>\n</li>\n<li>\n<p>Create and push a repo tag to Github.</p>\n<pre><span class=\"go\">git tag YY.MM.MICRO -m \"A meaningful release tag comment\"</span>\n<span class=\"go\">git tag  # check release tag is in list</span>\n<span class=\"go\">git push --tags origin master</span>\n</pre>\n<ul>\n<li>\n<p>Github will create a release tarball at:</p>\n<blockquote>\n<p><a href=\"https://github.com/%7Busername%7D/%7Brepo%7D/tarball/%7Btag%7D.tar.gz\" rel=\"nofollow\">https://github.com/{username}/{repo}/tarball/{tag}.tar.gz</a></p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n\n          </div>"}, "last_serial": 7031428, "releases": {"17.2.1": [{"comment_text": "", "digests": {"md5": "52f307959b750a94e0ed6ab3a280ac42", "sha256": "9c7a7eee74f31d378b2b19bebb3c6ebe8a35e527bce212b874ac0218b9be264e"}, "downloads": -1, "filename": "prometheus_metrics_proto-17.2.1.tar.gz", "has_sig": false, "md5_digest": "52f307959b750a94e0ed6ab3a280ac42", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6782, "upload_time": "2017-02-12T11:10:29", "upload_time_iso_8601": "2017-02-12T11:10:29.428462Z", "url": "https://files.pythonhosted.org/packages/de/68/bad7ee68c993f6145cb7140c7dede2e33bcdd75f4f7f9e71d6f9044f32e3/prometheus_metrics_proto-17.2.1.tar.gz", "yanked": false}], "18.1.1": [{"comment_text": "", "digests": {"md5": "b9f673b003f2dbcd2cb5a9244350acb8", "sha256": "f105139596373a0346462b71c49f5165d76f64c944e5b4b195aa701202095463"}, "downloads": -1, "filename": "prometheus_metrics_proto-18.1.1-py3-none-any.whl", "has_sig": false, "md5_digest": "b9f673b003f2dbcd2cb5a9244350acb8", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 16209, "upload_time": "2018-01-04T09:36:48", "upload_time_iso_8601": "2018-01-04T09:36:48.107903Z", "url": "https://files.pythonhosted.org/packages/43/74/f17ba3774139689c1bd3c0cdb9277b78e894d800a2df3d9bcf8d01e2698d/prometheus_metrics_proto-18.1.1-py3-none-any.whl", "yanked": false}], "18.1.2": [{"comment_text": "", "digests": {"md5": "1689f642efb62e4eeb4e79b0a3f85279", "sha256": "80a4547ae7927c72804b80839c829d4d60ece4d66ba4534d79d6bfa6eb3757d5"}, "downloads": -1, "filename": "prometheus_metrics_proto-18.1.2-py3-none-any.whl", "has_sig": false, "md5_digest": "1689f642efb62e4eeb4e79b0a3f85279", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 13833, "upload_time": "2020-04-16T11:18:48", "upload_time_iso_8601": "2020-04-16T11:18:48.687974Z", "url": "https://files.pythonhosted.org/packages/b3/7f/31df2a5cd5900d19d988b84c207065532e3b8cb11e4906e5bf4cf6311693/prometheus_metrics_proto-18.1.2-py3-none-any.whl", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "1689f642efb62e4eeb4e79b0a3f85279", "sha256": "80a4547ae7927c72804b80839c829d4d60ece4d66ba4534d79d6bfa6eb3757d5"}, "downloads": -1, "filename": "prometheus_metrics_proto-18.1.2-py3-none-any.whl", "has_sig": false, "md5_digest": "1689f642efb62e4eeb4e79b0a3f85279", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 13833, "upload_time": "2020-04-16T11:18:48", "upload_time_iso_8601": "2020-04-16T11:18:48.687974Z", "url": "https://files.pythonhosted.org/packages/b3/7f/31df2a5cd5900d19d988b84c207065532e3b8cb11e4906e5bf4cf6311693/prometheus_metrics_proto-18.1.2-py3-none-any.whl", "yanked": false}], "timestamp": "Fri May  8 03:17:08 2020"}