{"info": {"author": "Nathan Wilcox", "author_email": "nejucomo@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "=============\npreconditions\n=============\n\n``preconditions`` - A precondition decorator utility which relies on\n`parameter-name equivalence` for conciseness and consistency.\n\nExamples\n========\n\nFirst let's take a tour of examples. All examples assume the\n``preconditions`` decorator has been imported:\n\n.. code:: python\n\n   from preconditions import preconditions\n\nBasic type checking\n-------------------\n\nThe ``double`` `application function` requires that the ``i`` parameter\nis an ``int``, which is verified by a single `predicate` (the ``lambda``\nexpression):\n\n.. code:: python\n\n   @preconditions(lambda i: isinstance(i, int))\n   def double(i):\n       return 2*i\n\nMultiple predicates\n-------------------\n\nMultiple predicates may be specified:\n\n.. code:: python\n\n   @preconditions(\n       lambda i: isinstance(i, int),\n       lambda i: i > 0,\n       )\n   def double(i):\n       return 2*i\n\nNote that this is functionally equivalent to this single predicate\nversion:\n\n.. code:: python\n\n   @preconditions(\n       lambda i: isinstance(i, int) and i > 0,\n       )\n   def double(i):\n       return 2*i\n\nThe multi-predicate version should (eventually) have more specific\nerror reporting for a failure, while the single predicate version may\nbe more efficient.\n\nMultiple arguments\n------------------\n\nMultiple predicates can express preconditions for multiple arguments:\n\n.. code:: python\n\n   @preconditions(\n       lambda s: isinstance(s, unicode),\n       lambda n: isinstance(n, int) and n >= 0,\n       )\n   def repeat(s, n):\n       return s*n\n\nHowever, a *single predicate* can express preconditions for multiple\narguments. This allows `relational preconditions`:\n\n.. code:: python\n\n   @preconditions(\n       lambda a, b: a <= b\n       )\n   def strict_range(a, b):\n       return range(a, b)\n\nMethod preconditions\n--------------------\n\nPredicates can be expressed for methods, including relations to\n``self``. For example, a ``Monotonic`` instance ensures that each call to\n``.set`` must pass a value larger than any previous call:\n\n.. code:: python\n\n   class Monotonic (object):\n       def __init__(self):\n           self.v = 0\n\n       @preconditions(lambda self, v: v > self.v)\n       def set(self, v):\n           self.v = v\n\nPreconditions can be applied to special methods, such as ``__new__``,\n``__init__``, ``__call__``, etc...\n\n.. code:: python\n\n   class LinearRange (tuple):\n       @preconditions(\n              lambda a: isinstance(a, float),\n              lambda b: isinstance(b, float),\n              lambda a, b: a < b,\n              )\n       def __new__(cls, a, b):\n           return super(OrderedTuple, cls).__new__(cls, (a, b))\n\n       @preconditions(lambda w: 0 <= w < 1.0)\n       def __call__(self, w):\n           lo, hi = self\n           return w * (hi - lo) + lo\n\n       @preconditions(lambda x: self[0] <= x < self[1])\n       def invert(self, x):\n           lo, hi = self\n           return (x - lo) / (hi - lo)\n\nConcepts\n========\n\nAn `application function` may be guarded with `precondition\npredicates`. These `predicates` are callables passed to the\n``preconditions`` decorator. Consider this code:\n\n.. code:: python\n\n   @preconditions(\n       lambda a: isinstance(a, float) and a >= 0,\n       lambda b: isinstance(b, float) and b >= 0,\n       )\n   def area(a, b):\n       return a*b\n\nThe application function is ``area``, and it has two predicates defined\nwith ``lambda``, each of which ensures one of the arguments is a\nnon-negative float.\n\nParameter Name Equivalence\n--------------------------\n\nThe parameter names in a predicate must match parameter names in\nthe application function. This is known as `parameter name equivalence`\n[#]_.\n\n.. [#] This is a bit magical, relying on function introspection. The\n       design assumes the conciseness and consistency benefits outweigh\n       the potential confusion of \"magic\".\n\nOne exception to this rule is for default parameters within\npredicates. Default parameters may be used to associate some state at\npredicate definition time. For example:\n\n.. code:: python\n\n   scores = {}\n\n   @preconditions(\n       lambda color, _colors=['RED', 'GREEN', 'BLUE']: color in _colors\n       )\n   def get_color_score(color):\n       return scores[color]\n\nThis feature may be most convenient when there's a need to remember a\nlocal loop variable.\n\n.. FIXME: create an example.\n\nSimilar Projects\n================\n\n`covenant`_ - Code contracts for Python 3.\n\n.. _`covenant`: https://github.com/kisielk/covenant\n\n", "description_content_type": null, "docs_url": null, "download_url": "UNKNOWN", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/nejucomo/preconditions", "keywords": null, "license": "MIT", "maintainer": null, "maintainer_email": null, "name": "preconditions", "package_url": "https://pypi.org/project/preconditions/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/preconditions/", "project_urls": {"Download": "UNKNOWN", "Homepage": "https://github.com/nejucomo/preconditions"}, "release_url": "https://pypi.org/project/preconditions/0.1/", "requires_dist": null, "requires_python": null, "summary": "Flexible, concise preconditions.", "version": "0.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><tt>preconditions</tt> - A precondition decorator utility which relies on\n<cite>parameter-name equivalence</cite> for conciseness and consistency.</p>\n<div id=\"examples\">\n<h2>Examples</h2>\n<p>First let\u2019s take a tour of examples. All examples assume the\n<tt>preconditions</tt> decorator has been imported:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">preconditions</span> <span class=\"kn\">import</span> <span class=\"n\">preconditions</span>\n</pre>\n<div id=\"basic-type-checking\">\n<h3>Basic type checking</h3>\n<p>The <tt>double</tt> <cite>application function</cite> requires that the <tt>i</tt> parameter\nis an <tt>int</tt>, which is verified by a single <cite>predicate</cite> (the <tt>lambda</tt>\nexpression):</p>\n<pre><span class=\"nd\">@preconditions</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">i</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">))</span>\n<span class=\"k\">def</span> <span class=\"nf\">double</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"mi\">2</span><span class=\"o\">*</span><span class=\"n\">i</span>\n</pre>\n</div>\n<div id=\"multiple-predicates\">\n<h3>Multiple predicates</h3>\n<p>Multiple predicates may be specified:</p>\n<pre><span class=\"nd\">@preconditions</span><span class=\"p\">(</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">i</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">),</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">i</span><span class=\"p\">:</span> <span class=\"n\">i</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">double</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"mi\">2</span><span class=\"o\">*</span><span class=\"n\">i</span>\n</pre>\n<p>Note that this is functionally equivalent to this single predicate\nversion:</p>\n<pre><span class=\"nd\">@preconditions</span><span class=\"p\">(</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">i</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">i</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">double</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"mi\">2</span><span class=\"o\">*</span><span class=\"n\">i</span>\n</pre>\n<p>The multi-predicate version should (eventually) have more specific\nerror reporting for a failure, while the single predicate version may\nbe more efficient.</p>\n</div>\n<div id=\"multiple-arguments\">\n<h3>Multiple arguments</h3>\n<p>Multiple predicates can express preconditions for multiple arguments:</p>\n<pre><span class=\"nd\">@preconditions</span><span class=\"p\">(</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">s</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"n\">unicode</span><span class=\"p\">),</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">n</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">n</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">repeat</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">s</span><span class=\"o\">*</span><span class=\"n\">n</span>\n</pre>\n<p>However, a <em>single predicate</em> can express preconditions for multiple\narguments. This allows <cite>relational preconditions</cite>:</p>\n<pre><span class=\"nd\">@preconditions</span><span class=\"p\">(</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">:</span> <span class=\"n\">a</span> <span class=\"o\">&lt;=</span> <span class=\"n\">b</span>\n    <span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">strict_range</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">)</span>\n</pre>\n</div>\n<div id=\"method-preconditions\">\n<h3>Method preconditions</h3>\n<p>Predicates can be expressed for methods, including relations to\n<tt>self</tt>. For example, a <tt>Monotonic</tt> instance ensures that each call to\n<tt>.set</tt> must pass a value larger than any previous call:</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">Monotonic</span> <span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">v</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n\n    <span class=\"nd\">@preconditions</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">:</span> <span class=\"n\">v</span> <span class=\"o\">&gt;</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">v</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">set</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">v</span> <span class=\"o\">=</span> <span class=\"n\">v</span>\n</pre>\n<p>Preconditions can be applied to special methods, such as <tt>__new__</tt>,\n<tt>__init__</tt>, <tt>__call__</tt>, etc\u2026</p>\n<pre><span class=\"k\">class</span> <span class=\"nc\">LinearRange</span> <span class=\"p\">(</span><span class=\"nb\">tuple</span><span class=\"p\">):</span>\n    <span class=\"nd\">@preconditions</span><span class=\"p\">(</span>\n           <span class=\"k\">lambda</span> <span class=\"n\">a</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">),</span>\n           <span class=\"k\">lambda</span> <span class=\"n\">b</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">),</span>\n           <span class=\"k\">lambda</span> <span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">:</span> <span class=\"n\">a</span> <span class=\"o\">&lt;</span> <span class=\"n\">b</span><span class=\"p\">,</span>\n           <span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__new__</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">OrderedTuple</span><span class=\"p\">,</span> <span class=\"bp\">cls</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__new__</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">))</span>\n\n    <span class=\"nd\">@preconditions</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">w</span><span class=\"p\">:</span> <span class=\"mi\">0</span> <span class=\"o\">&lt;=</span> <span class=\"n\">w</span> <span class=\"o\">&lt;</span> <span class=\"mf\">1.0</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">w</span><span class=\"p\">):</span>\n        <span class=\"n\">lo</span><span class=\"p\">,</span> <span class=\"n\">hi</span> <span class=\"o\">=</span> <span class=\"bp\">self</span>\n        <span class=\"k\">return</span> <span class=\"n\">w</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">hi</span> <span class=\"o\">-</span> <span class=\"n\">lo</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"n\">lo</span>\n\n    <span class=\"nd\">@preconditions</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">&lt;=</span> <span class=\"n\">x</span> <span class=\"o\">&lt;</span> <span class=\"bp\">self</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n    <span class=\"k\">def</span> <span class=\"nf\">invert</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">):</span>\n        <span class=\"n\">lo</span><span class=\"p\">,</span> <span class=\"n\">hi</span> <span class=\"o\">=</span> <span class=\"bp\">self</span>\n        <span class=\"k\">return</span> <span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">-</span> <span class=\"n\">lo</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"n\">hi</span> <span class=\"o\">-</span> <span class=\"n\">lo</span><span class=\"p\">)</span>\n</pre>\n</div>\n</div>\n<div id=\"concepts\">\n<h2>Concepts</h2>\n<p>An <cite>application function</cite> may be guarded with <cite>precondition\npredicates</cite>. These <cite>predicates</cite> are callables passed to the\n<tt>preconditions</tt> decorator. Consider this code:</p>\n<pre><span class=\"nd\">@preconditions</span><span class=\"p\">(</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">a</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">a</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">b</span><span class=\"p\">:</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">b</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">area</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">a</span><span class=\"o\">*</span><span class=\"n\">b</span>\n</pre>\n<p>The application function is <tt>area</tt>, and it has two predicates defined\nwith <tt>lambda</tt>, each of which ensures one of the arguments is a\nnon-negative float.</p>\n<div id=\"parameter-name-equivalence\">\n<h3>Parameter Name Equivalence</h3>\n<p>The parameter names in a predicate must match parameter names in\nthe application function. This is known as <cite>parameter name equivalence</cite>\n<a href=\"#id2\" id=\"id1\" rel=\"nofollow\">[1]</a>.</p>\n<table id=\"id2\">\n<col><col>\n<tbody>\n<tr><td><a href=\"#id1\" rel=\"nofollow\">[1]</a></td><td>This is a bit magical, relying on function introspection. The\ndesign assumes the conciseness and consistency benefits outweigh\nthe potential confusion of \u201cmagic\u201d.</td></tr>\n</tbody>\n</table>\n<p>One exception to this rule is for default parameters within\npredicates. Default parameters may be used to associate some state at\npredicate definition time. For example:</p>\n<pre><span class=\"n\">scores</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n\n<span class=\"nd\">@preconditions</span><span class=\"p\">(</span>\n    <span class=\"k\">lambda</span> <span class=\"n\">color</span><span class=\"p\">,</span> <span class=\"n\">_colors</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'RED'</span><span class=\"p\">,</span> <span class=\"s1\">'GREEN'</span><span class=\"p\">,</span> <span class=\"s1\">'BLUE'</span><span class=\"p\">]:</span> <span class=\"n\">color</span> <span class=\"ow\">in</span> <span class=\"n\">_colors</span>\n    <span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_color_score</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">scores</span><span class=\"p\">[</span><span class=\"n\">color</span><span class=\"p\">]</span>\n</pre>\n<p>This feature may be most convenient when there\u2019s a need to remember a\nlocal loop variable.</p>\n</div>\n</div>\n<div id=\"similar-projects\">\n<h2>Similar Projects</h2>\n<p><a href=\"https://github.com/kisielk/covenant\" rel=\"nofollow\">covenant</a> - Code contracts for Python 3.</p>\n</div>\n\n          </div>"}, "last_serial": 1538162, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "c61bf4e2f5052ea8ff6903fa656a2e23", "sha256": "e783f97bee1e3302745a67575ce788fc98874968e1c9343b7e0cdfd5d4c13527"}, "downloads": -1, "filename": "preconditions-0.1.tar.gz", "has_sig": true, "md5_digest": "c61bf4e2f5052ea8ff6903fa656a2e23", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 5242, "upload_time": "2015-05-08T00:47:04", "upload_time_iso_8601": "2015-05-08T00:47:04.909639Z", "url": "https://files.pythonhosted.org/packages/5d/19/324c00d1399e5997c25d49ece9f9f68868621f06ea1f553671229d28601d/preconditions-0.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "c61bf4e2f5052ea8ff6903fa656a2e23", "sha256": "e783f97bee1e3302745a67575ce788fc98874968e1c9343b7e0cdfd5d4c13527"}, "downloads": -1, "filename": "preconditions-0.1.tar.gz", "has_sig": true, "md5_digest": "c61bf4e2f5052ea8ff6903fa656a2e23", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 5242, "upload_time": "2015-05-08T00:47:04", "upload_time_iso_8601": "2015-05-08T00:47:04.909639Z", "url": "https://files.pythonhosted.org/packages/5d/19/324c00d1399e5997c25d49ece9f9f68868621f06ea1f553671229d28601d/preconditions-0.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:20:03 2020"}