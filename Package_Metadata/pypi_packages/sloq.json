{"info": {"author": "Paul Scott, Duedil Limited", "author_email": "paul@duedil.com", "bugtrack_url": null, "classifiers": [], "description": "Python Sloq\n===========\n\nA slower queue implementation, guaranteeing that tasks are processsed at a maximum rate. ``SlowQueue`` aims to be directly comparable with the Queue API so that it can be dropped in as an alternative implementation, as with LIFOQueue and PriorityQueue, but currently (as this needn't be the case) will raise additional ValueErrors if you try to pass ``block=False`` or ``timeout`` > 0 to ``get`` methods. Some slamming is possible and is controllable using the `max_slam` keyword argument on the TokenBucket or SlowQueue instance.\n\nSee following example (taken from demo_sloq.py) or the unit tests for more:\n\n.. code-block:: python\n\n  from argparse import ArgumentParser\n  from threading import Thread, current_thread\n  import logging\n  import time\n\n  from sloq import SlowQueue\n\n\n  def main(args=None):\n      prog = ArgumentParser()\n      prog.add_argument(\"-n\", type=int, default=10, metavar=\"TASK_COUNT\",\n                        help=\"The number of tasks\")\n      prog.add_argument(\"-t\", type=float, default=1, metavar=\"TASK_INTERVAL\",\n                        help=\"The tick: seconds between tasks being released\")\n      prog.add_argument(\"-w\", type=int, default=3, metavar=\"WORKER_COUNT\",\n                        help=\"Number of workers\")\n      prog.add_argument(\"-d\", type=float, default=0, metavar=\"TASK_DURATION\",\n                        help=\"Duration of a single task\")\n      prog.add_argument(\"-s\", type=float, default=0, metavar=\"MAX_SLAM\",\n                        help=\"The maximum amount of slam to allow\")\n      args = prog.parse_args(args)\n\n      logger = logging.getLogger(__name__)\n      logger.setLevel(logging.INFO)\n      logger.addHandler(logging.StreamHandler())\n\n      test_queue(logger, args.t, args.n, args.d, args.w, args.s)\n\n\n  def test_queue(logger, tick=1, tasks=10, task_duration=0, worker_count=3,\n                 slam=0):\n      start_time = time.time()\n      sloq = SlowQueue(release_tick=tick, max_slam=slam)\n\n      # Begin the workers\n      for w in xrange(0, worker_count):\n          Thread(target=test_worker, args=(logger, start_time, sloq)).start()\n\n      # Populate the queue\n      for task in xrange(0, tasks):\n          sloq.put((task, task_duration))\n      for w in xrange(0, worker_count):\n          sloq.put((None, None))\n\n      sloq.join()\n\n\n  def test_worker(logger, start_time, queue):\n      while True:\n          task, sleep = queue.get()\n          if task is None:\n              logger.info(\"%s, Done\" % current_thread().name)\n              queue.task_done()\n              return\n          else:\n              logger.info(\"%s, Elapsed time: %0.2f, Task: %r\",\n                          current_thread().name, time.time() - start_time, task)\n              if sleep:\n                  time.sleep(sleep)\n              queue.task_done()\n\n\n  if __name__ == \"__main__\":\n      main()", "description_content_type": null, "docs_url": null, "download_url": "https://github.com/duedil-ltd/python-sloq/tarball/0.2", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/duedil-ltd/python-sloq", "keywords": "queue,rate,limit,slow,token,bucket", "license": "MIT", "maintainer": null, "maintainer_email": null, "name": "sloq", "package_url": "https://pypi.org/project/sloq/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/sloq/", "project_urls": {"Download": "https://github.com/duedil-ltd/python-sloq/tarball/0.2", "Homepage": "https://github.com/duedil-ltd/python-sloq"}, "release_url": "https://pypi.org/project/sloq/0.2/", "requires_dist": null, "requires_python": null, "summary": "Rate-limited Queue", "version": "0.2", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p>A slower queue implementation, guaranteeing that tasks are processsed at a maximum rate. <tt>SlowQueue</tt> aims to be directly comparable with the Queue API so that it can be dropped in as an alternative implementation, as with LIFOQueue and PriorityQueue, but currently (as this needn\u2019t be the case) will raise additional ValueErrors if you try to pass <tt>block=False</tt> or <tt>timeout</tt> &gt; 0 to <tt>get</tt> methods. Some slamming is possible and is controllable using the <cite>max_slam</cite> keyword argument on the TokenBucket or SlowQueue instance.</p>\n<p>See following example (taken from demo_sloq.py) or the unit tests for more:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">argparse</span> <span class=\"kn\">import</span> <span class=\"n\">ArgumentParser</span>\n<span class=\"kn\">from</span> <span class=\"nn\">threading</span> <span class=\"kn\">import</span> <span class=\"n\">Thread</span><span class=\"p\">,</span> <span class=\"n\">current_thread</span>\n<span class=\"kn\">import</span> <span class=\"nn\">logging</span>\n<span class=\"kn\">import</span> <span class=\"nn\">time</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">sloq</span> <span class=\"kn\">import</span> <span class=\"n\">SlowQueue</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"n\">prog</span> <span class=\"o\">=</span> <span class=\"n\">ArgumentParser</span><span class=\"p\">()</span>\n    <span class=\"n\">prog</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s2\">\"-n\"</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">metavar</span><span class=\"o\">=</span><span class=\"s2\">\"TASK_COUNT\"</span><span class=\"p\">,</span>\n                      <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">\"The number of tasks\"</span><span class=\"p\">)</span>\n    <span class=\"n\">prog</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s2\">\"-t\"</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">metavar</span><span class=\"o\">=</span><span class=\"s2\">\"TASK_INTERVAL\"</span><span class=\"p\">,</span>\n                      <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">\"The tick: seconds between tasks being released\"</span><span class=\"p\">)</span>\n    <span class=\"n\">prog</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s2\">\"-w\"</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"n\">metavar</span><span class=\"o\">=</span><span class=\"s2\">\"WORKER_COUNT\"</span><span class=\"p\">,</span>\n                      <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">\"Number of workers\"</span><span class=\"p\">)</span>\n    <span class=\"n\">prog</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s2\">\"-d\"</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">metavar</span><span class=\"o\">=</span><span class=\"s2\">\"TASK_DURATION\"</span><span class=\"p\">,</span>\n                      <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">\"Duration of a single task\"</span><span class=\"p\">)</span>\n    <span class=\"n\">prog</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s2\">\"-s\"</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">metavar</span><span class=\"o\">=</span><span class=\"s2\">\"MAX_SLAM\"</span><span class=\"p\">,</span>\n                      <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s2\">\"The maximum amount of slam to allow\"</span><span class=\"p\">)</span>\n    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">prog</span><span class=\"o\">.</span><span class=\"n\">parse_args</span><span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n\n    <span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">getLogger</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n    <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">setLevel</span><span class=\"p\">(</span><span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">INFO</span><span class=\"p\">)</span>\n    <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">addHandler</span><span class=\"p\">(</span><span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">StreamHandler</span><span class=\"p\">())</span>\n\n    <span class=\"n\">test_queue</span><span class=\"p\">(</span><span class=\"n\">logger</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">n</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">d</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">w</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">s</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">test_queue</span><span class=\"p\">(</span><span class=\"n\">logger</span><span class=\"p\">,</span> <span class=\"n\">tick</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">tasks</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">task_duration</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">worker_count</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span>\n               <span class=\"n\">slam</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">):</span>\n    <span class=\"n\">start_time</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">time</span><span class=\"p\">()</span>\n    <span class=\"n\">sloq</span> <span class=\"o\">=</span> <span class=\"n\">SlowQueue</span><span class=\"p\">(</span><span class=\"n\">release_tick</span><span class=\"o\">=</span><span class=\"n\">tick</span><span class=\"p\">,</span> <span class=\"n\">max_slam</span><span class=\"o\">=</span><span class=\"n\">slam</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Begin the workers</span>\n    <span class=\"k\">for</span> <span class=\"n\">w</span> <span class=\"ow\">in</span> <span class=\"n\">xrange</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">worker_count</span><span class=\"p\">):</span>\n        <span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"o\">=</span><span class=\"n\">test_worker</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">logger</span><span class=\"p\">,</span> <span class=\"n\">start_time</span><span class=\"p\">,</span> <span class=\"n\">sloq</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">start</span><span class=\"p\">()</span>\n\n    <span class=\"c1\"># Populate the queue</span>\n    <span class=\"k\">for</span> <span class=\"n\">task</span> <span class=\"ow\">in</span> <span class=\"n\">xrange</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">tasks</span><span class=\"p\">):</span>\n        <span class=\"n\">sloq</span><span class=\"o\">.</span><span class=\"n\">put</span><span class=\"p\">((</span><span class=\"n\">task</span><span class=\"p\">,</span> <span class=\"n\">task_duration</span><span class=\"p\">))</span>\n    <span class=\"k\">for</span> <span class=\"n\">w</span> <span class=\"ow\">in</span> <span class=\"n\">xrange</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">worker_count</span><span class=\"p\">):</span>\n        <span class=\"n\">sloq</span><span class=\"o\">.</span><span class=\"n\">put</span><span class=\"p\">((</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">))</span>\n\n    <span class=\"n\">sloq</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">test_worker</span><span class=\"p\">(</span><span class=\"n\">logger</span><span class=\"p\">,</span> <span class=\"n\">start_time</span><span class=\"p\">,</span> <span class=\"n\">queue</span><span class=\"p\">):</span>\n    <span class=\"k\">while</span> <span class=\"kc\">True</span><span class=\"p\">:</span>\n        <span class=\"n\">task</span><span class=\"p\">,</span> <span class=\"n\">sleep</span> <span class=\"o\">=</span> <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"n\">task</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">\"</span><span class=\"si\">%s</span><span class=\"s2\">, Done\"</span> <span class=\"o\">%</span> <span class=\"n\">current_thread</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n            <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"n\">task_done</span><span class=\"p\">()</span>\n            <span class=\"k\">return</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">\"</span><span class=\"si\">%s</span><span class=\"s2\">, Elapsed time: </span><span class=\"si\">%0.2f</span><span class=\"s2\">, Task: </span><span class=\"si\">%r</span><span class=\"s2\">\"</span><span class=\"p\">,</span>\n                        <span class=\"n\">current_thread</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">time</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">start_time</span><span class=\"p\">,</span> <span class=\"n\">task</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">sleep</span><span class=\"p\">:</span>\n                <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"n\">sleep</span><span class=\"p\">)</span>\n            <span class=\"n\">queue</span><span class=\"o\">.</span><span class=\"n\">task_done</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s2\">\"__main__\"</span><span class=\"p\">:</span>\n    <span class=\"n\">main</span><span class=\"p\">()</span>\n</pre>\n\n          </div>"}, "last_serial": 1115699, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "5798d8dd53ad1b05c162565e1cead605", "sha256": "8f426b639704ef6a718a3bd58b47f31d3501a8de3212a614fd5a84c07fcedfcd"}, "downloads": -1, "filename": "sloq-0.1.tar.gz", "has_sig": false, "md5_digest": "5798d8dd53ad1b05c162565e1cead605", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 4099, "upload_time": "2014-06-04T16:41:20", "upload_time_iso_8601": "2014-06-04T16:41:20.739529Z", "url": "https://files.pythonhosted.org/packages/8e/5f/7179514070bc0f3a9ef4edb6cf9d1495dd46aac3c55829c8fa30a22bc60c/sloq-0.1.tar.gz", "yanked": false}], "0.2": [{"comment_text": "", "digests": {"md5": "8533807b56b55fd5622aa2d9c3dd8ede", "sha256": "b85c72e97a80cf13d75107cc9d56a62e7f2d3817c0af262f623b24e7529dba21"}, "downloads": -1, "filename": "sloq-0.2.tar.gz", "has_sig": false, "md5_digest": "8533807b56b55fd5622aa2d9c3dd8ede", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 4380, "upload_time": "2014-06-05T14:22:59", "upload_time_iso_8601": "2014-06-05T14:22:59.500049Z", "url": "https://files.pythonhosted.org/packages/ce/91/e8be5e739c6c495812a635f0deea9b184c33be02b95c56f0ceada4d3b123/sloq-0.2.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "8533807b56b55fd5622aa2d9c3dd8ede", "sha256": "b85c72e97a80cf13d75107cc9d56a62e7f2d3817c0af262f623b24e7529dba21"}, "downloads": -1, "filename": "sloq-0.2.tar.gz", "has_sig": false, "md5_digest": "8533807b56b55fd5622aa2d9c3dd8ede", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 4380, "upload_time": "2014-06-05T14:22:59", "upload_time_iso_8601": "2014-06-05T14:22:59.500049Z", "url": "https://files.pythonhosted.org/packages/ce/91/e8be5e739c6c495812a635f0deea9b184c33be02b95c56f0ceada4d3b123/sloq-0.2.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:08:17 2020"}