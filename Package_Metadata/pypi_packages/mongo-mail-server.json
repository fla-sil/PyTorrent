{"info": {"author": "St\u00e9phane RAULT", "author_email": "stephane.rault@radicalspam.org", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Intended Audience :: Developers", "Intended Audience :: System Administrators", "License :: OSI Approved :: BSD License", "Operating System :: POSIX :: Linux", "Programming Language :: Python", "Programming Language :: Python :: 2", "Programming Language :: Python :: 2.7", "Topic :: Communications :: Email", "Topic :: Communications :: Email :: Mail Transport Agents"], "description": "=================\nMongo Mail Server\n=================\n\n**Gevent SMTP Server with MongoDB storage** \n\n|Build Status| |pypi downloads| |pypi version| |pypi licence| |requires status|\n\n**Demo:**\n\n- URL: http://188.165.254.60:8083\n- Login: admin@example.net\n- Password: password\n\n**Features:**\n\n- SMTP Server high performance with Gevent Coroutine_ ( fork of Gsmtpd_ )\n- Postfix XFORWARD_ extension\n- Record messages in MongoDB_\n- Ability to use a custom python plugin to edit the message before recording\n\n**The use in production is not yet guaranteed**\n\n.. contents:: **Table of Contents**\n    :depth: 1\n    :backlinks: none\n\nQuarantine mode example\n=======================\n\n**Mode for quarantine or statistics only**\n\n.. image:: http://espace-groupware.com/docs/mongo-mail/img/mongo-mail-quarantine.jpg\n   :alt: Mongo Mail Quarantine schema\n   :align: center\n\n- Network: smtp sender or recipient (with internet or local network)\n- Content Filter: amavisd-new with xxx_quarantine_to (smtp:) parameters\n- Configuration in amavisd.conf\n- Zero configuration for Postfix\n\nProxy mode example\n==================\n\n**Mode for statistics or honey pot**\n\n.. image:: http://espace-groupware.com/docs/mongo-mail/img/mongo-mail-proxy.jpg\n   :alt: Mongo Mail Proxy schema\n   :align: center\n   \n- Network: smtp sender or recipient (with internet or local network) \n- Optional: filtering after delivery to postfix by mongo mail\n\nFilter mode example\n===================\n\n**Mode for spam/virus filtering and statistics**\n\n.. image:: http://espace-groupware.com/docs/mongo-mail/img/mongo-mail-filter.jpg\n   :alt: Mongo Mail Filter schema\n   :align: center\n   \n- Network: smtp sender or recipient (with internet or local network) \n- Filtering: clamav/spamassassin with TCP connection (without amavisd-new)\n- Out filter: delivered so clean else\n\nImportant Notes\n===============\n\n- **Message is not transformed (unless in quarantine mode if MMS_REAL_RCPT=1)**\n\n- **Gross message is stored in GridFS after being compressed (zlib) and converted to base64**\n\n- **In proxy mode, the raw message is sent before the registration in MongoDB and is not saved if an error occurs while sending or all recipients are rejected** \n\nTested With\n-----------\n\n- Docker_ 1.4.1\n- Ubuntu_ 14.04\n- MongoDB_ 2.6.5\n- Python_ 2.7.6\n- Gevent_ 1.0\n- Pymongo2_8_ 2.8 and Pymongo_ 3.0 \n- Postfix_ 2.5.5\n- Amavisd-new_ 2.6.4\n\nMessage Data\n============\n\nBefore sent to MongoDB\n----------------------\n\n.. code:: python\n\n    {'client_address': '139.129.236.68',\n     'message': ObjectId('55252ae62d4b25262070a176'),\n     'rcpt': ['jean91@example.com'],\n     'rcpt_count': 1,\n     'rcpt_refused': {},\n     'received': datetime.datetime(2015, 4, 8, 13, 19, 34, 579000, tzinfo=tzutc()),\n     'sender': 'acollet@example.org',\n     'server': '127.0.0.1',\n     'store_key': '77bd8b356cf2c593e61a6c0a7cbc5572eb357a7b857adca402ee40021db34fa6',\n     'xforward': {'ADDR': '139.129.236.68',\n                  'HELO': 'mx.example.org',\n                  'NAME': 'mx.example.org'}}   \n                  \n    'message': ObjectId('55252ae62d4b25262070a176') is reference to data in Gridfs                                 \n                      \nAfter record in MongoDB - Read from mongo-mail-web\n--------------------------------------------------\n\n.. code:: python\n\n    {'_id': ObjectId('55252ae62d4b25262070a178'),\n     'client_address': u'139.129.236.68',\n     'completed': 0,\n     'errors_count': 0,\n     'events': [],\n     'files': [],\n     'files_count': 0,\n     'group_name': u'DEFAULT',\n     'headers': {},\n     'internal_field': 0,\n     'is_banned': 0,\n     'is_bounce': 0,\n     'is_in': 1,\n     'is_spam': 0,\n     'is_unchecked': 0,\n     'is_virus': 0,\n     'mark_for_delete': 0,\n     'message': ObjectId('55252ae62d4b25262070a176'),\n     'parsing_errors': [],\n     'queue': 1,\n     'rcpt': [u'jean91@example.com'],\n     'rcpt_count': 1,\n     'rcpt_refused': {},\n     'received': datetime.datetime(2015, 4, 8, 13, 19, 34, 579000, tzinfo=<bson.tz_util.FixedOffset object at 0x02B54E10>),\n     'sender': u'acollet@example.org',\n     'server': u'127.0.0.1',\n     'size': 0L,\n     'store_key': u'77bd8b356cf2c593e61a6c0a7cbc5572eb357a7b857adca402ee40021db34fa6',\n     'tags': [],\n     'xforward': {u'ADDR': u'139.129.236.68',\n      u'HELO': u'mx.example.org',\n      u'NAME': u'mx.example.org'}}\n\nAfter parsing with mongo-mail-web (completed task)\n--------------------------------------------------\n\n.. code:: python\n\n    {'_id': ObjectId('55252ae62d4b25262070a178'),\n     'client_address': u'139.129.236.68',\n     'completed': 1,\n     'country': u'CN',\n     'errors_count': 0,\n     'events': [],\n     'files': [],\n     'files_count': 0,\n     'group_name': u'DEFAULT',\n     'headers': {u'Content-Transfer-Encoding': [u'base64', {}],\n      u'Content-Type': [u'text/plain', {u'charset': u'utf-8'}],\n      u'Date': u'Wed, 08 Apr 2015 13:19:34 UTC',\n      u'From': u'\"Bertrand Auger\" <acollet@example.org>',\n      u'Message-Id': u'<20150408131934.10264.63423@admin-VAIO>',\n      u'Mime-Version': u'1.0',\n      u'Subject': u'Provident tempora ad quasi enim in ratione excepturi. Optio soluta culpa voluptas labore in. Voluptatem aliquid est rerum in est adipisci dolore.',\n      u'To': u'\"Thierry Leleu\" <jean91@example.com>',\n      u'X-Mailer': u'MessageFaker'},\n     'internal_field': 0,\n     'is_banned': 0,\n     'is_bounce': 0,\n     'is_in': 1,\n     'is_spam': 0,\n     'is_unchecked': 0,\n     'is_virus': 0,\n     'mark_for_delete': 0,\n     'message': ObjectId('55252ae62d4b25262070a176'),\n     'message_id': u'20150408131934.10264.63423@admin-VAIO',\n     'parsing_errors': [],\n     'queue': 1,\n     'rcpt': [u'jean91@example.com'],\n     'rcpt_count': 1,\n     'rcpt_refused': {},\n     'received': datetime.datetime(2015, 4, 8, 13, 19, 34, 579000, tzinfo=<bson.tz_util.FixedOffset object at 0x02AC4E10>),\n     'sender': u'acollet@example.org',\n     'sent': datetime.datetime(2015, 4, 8, 13, 19, 34, tzinfo=<bson.tz_util.FixedOffset object at 0x02AC4E10>),\n     'server': u'127.0.0.1',\n     'size': 636L,\n     'store_key': u'77bd8b356cf2c593e61a6c0a7cbc5572eb357a7b857adca402ee40021db34fa6',\n     'subject': u'Provident tempora ad quasi enim in ratione excepturi. Optio soluta culpa voluptas labore in. Voluptatem aliquid est rerum in est adipisci dolore.',\n     'tags': [],\n     'xforward': {u'ADDR': u'139.129.236.68',\n      u'HELO': u'mx.example.org',\n      u'NAME': u'mx.example.org'}}    \n\nOriginal Message\n----------------\n\n::\n\n    Content-Type: text/plain; charset=\"utf-8\"\n    MIME-Version: 1.0\n    Content-Transfer-Encoding: base64\n    X-Mailer: MessageFaker\n    Message-ID: <20150408131934.10264.63423@admin-VAIO>\n    From: \"Bertrand Auger\" <acollet@example.org>\n    To: \"Thierry Leleu\" <jean91@example.com>\n    Subject: Provident tempora ad quasi enim in ratione excepturi. Optio soluta\n     culpa voluptas labore in. Voluptatem aliquid est rerum in est adipisci\n     dolore.\n    Date: Wed, 08 Apr 2015 13:19:34 UTC\n    \n    U2l0IHZvbHVwdGF0ZSByZXJ1bSBjb3Jwb3JpcyBkb2xvcmlidXMgZW9zLiBRdWFzIGVvcyBub24g\n    bW9kaSBxdWlzLiBBbGlhcyB2ZWwgbGF1ZGFudGl1bSBtYWduaSBzdXNjaXBpdC4gRnVnaWF0IGV0\n    IHF1aXMgZXQgaW4gYWNjdXNhbXVzLg==\n\n\nInstallation\n============\n\nWithout Docker\n--------------\n\nRequired\n::::::::\n\n- MongoDB Server\n- Postfix or Amavisd-new\n- Python 2.7.6+ (< 3.x)\n- python-gevent 1.0+\n- recent setuptools and pip installer\n\nInstallation\n::::::::::::\n\n.. code:: bash\n\n    $ pip install mongo-mail-server\n\n    $ mongo-mail-server --help \n\n\nWith Docker\n-----------\n\nRequired\n::::::::\n\n- Docker 1.4+\n- MongoDB Server\n    \nMongoDB Server example\n::::::::::::::::::::::\n\nContenair based on Ubuntu 14.04 - Python 2.7\n\nImage from Dockerfile_\n\n.. code:: bash\n\n    $ docker pull dockerfile/mongodb\n    \n    $ docker run -d -p 27017:27017 --name mongodb dockerfile/mongodb mongod --smallfiles\n    \n    # Persist mongodb\n    $ docker run -v /home/persist/mongodb:/data/db -d -p 27017:27017 --name mongodb dockerfile/mongodb mongod --smallfiles\n\nBuild Mongo Mail Server image\n:::::::::::::::::::::::::::::\n\n.. code:: bash\n\n    $ git clone https://github.com/radical-software/mongo-mail-server.git\n    \n    $ cd mongo-mail-server && docker build -t mongo-mail-server .\n    \n    # help and verify\n    $ docker run -it --rm mongo-mail-server --help\n\nRun Mongo Mail Server\n:::::::::::::::::::::\n\n.. code:: bash\n\n    $ mongodb_ip=$(docker inspect -f '{{.NetworkSettings.IPAddress}}' mongodb)\n\n    # start for test\n    $ docker run -it --rm -e MMS_MONGODB_URI=mongodb://$mongodb_ip/message -p 172.17.42.1:14001:14001 mongo-mail-server\n\n    # start of background (optional: bind of docker0 interface)\n    # Add --restart=always for automatic restart \n    $ docker run -d --name mms -e MMS_MONGODB_URI=mongodb://$mongodb_ip/message -p 172.17.42.1:14001:14001 mongo-mail-server\n\n    # Logs\n    $ docker logs mms\n    2015-02-12 07:35:36 rs_smtpd_server: [INFO] - Starting SMTP Server - server[mongo-quarantine] - on 0.0.0.0:14001 (PID:1)\n\nConfiguration\n=============\n\nMMS_SERVER\n----------\n\nServer mode: mongo-quarantine | mongo-proxy | mongo-proxy | debug\n\n*Default*: mongo-quarantine\n\n.. code:: bash\n\n    # with command mode\n    $ export MMS_SERVER=mongo-quarantine\n    \n    # with docker environ\n    $ docker run -e MMS_SERVER=mongo-quarantine\n    \n    # with command arguments\n    $ mongo-mail-server --server mongo-quarantine \n\nMMS_HOST\n--------\n\n**Host bind**\n\n*Default*: 0.0.0.0\n\n.. code:: bash\n\n    # with command mode\n    $ export MMS_HOST=0.0.0.0\n    \n    # with docker environ\n    $ docker run -e MMS_HOST=0.0.0.0\n    \n    # with command arguments\n    $ mongo-mail-server --host 0.0.0.0 \n\nMMS_PORT\n--------\n\n**Port bind**\n\n*Default*: 14001\n\n.. code:: bash\n\n    # with command mode\n    $ export MMS_PORT=14001\n    \n    # with docker environ\n    $ docker run -e MMS_PORT=14001\n    \n    # with command arguments\n    $ mongo-mail-server --port 14001\n    \nMMS_MONGODB_URI\n---------------\n\n*Default*: mongodb://localhost/message\n\nhttp://docs.mongodb.org/manual/reference/connection-string/\n\n.. code:: bash\n\n    # with command mode\n    $ export MMS_MONGODB_URI=mongodb://localhost/message\n    \n    # with docker environ\n    $ docker run -e MMS_MONGODB_URI=mongodb://localhost/message\n    \n    # with command arguments\n    $ mongo-mail-server --mongo-host mongodb://localhost/message\n\n\nMMS_MONGODB_DATABASE\n--------------------\n\n**DB Name for recording mails**\n\n*Default*: message\n\n.. code:: bash\n\n    # with command mode\n    $ export MMS_MONGODB_DATABASE=message\n    \n    # with docker environ\n    $ docker run -e MMS_MONGODB_DATABASE=message\n    \n    # with command arguments\n    $ mongo-mail-server --mongo-database message\n\n\n\nMMS_MONGODB_COLLECTION\n----------------------\n\n**Collection Name for recording mails**\n\n*Default*: message\n\n.. code:: bash\n\n    # with command mode\n    $ export MMS_MONGODB_COLLECTION=message\n    \n    # with docker environ\n    $ docker run -e MMS_MONGODB_COLLECTION=message\n    \n    # with command arguments\n    $ mongo-mail-server --mongo-collection message\n     \nMMS_TIMEOUT\n-----------\n\n**Timeout for smtp transaction from Postfix**\n\n*Default: 600 (seconds)*\n\nMMS_DATA_SIZE_LIMIT\n-------------------\n\n**Size limit of message (in bytes)**\n\n*Default: 0 (no limit)*\n\nMMS_REAL_RCPT (for amavisd-new < 2.7.0)\n---------------------------------------\n\n**Replace smtp recipient by real recipients (for quarantine with amavisd-new)** \n\n*Default*: disable\n\n.. code:: bash\n\n    # with command mode\n    $ export MMS_REAL_RCPT=1\n    \n    # with docker environ\n    $ docker run -e MMS_REAL_RCPT=1\n    \n    # with command arguments\n    $ mongo-mail-server --real-rcpt\n    \nUsecase - Quarantine Mode configuration - with Amavis\n=====================================================\n\n**caution**\n\n::\n\n    Before amavisd-new 2.7.0 the recipient envelope is replaced by xxx_quarantine_to parameters\n    \n    Starting from 2.7.0, use macro '%a' in xxx_quarantine_to parameters\n\n**caution**\n\n::\n    \n    About IP Address of smtp sender:\n    \n    Amavis does not use the extension SMTPD FORWARD to send mails in quarantine. The original IP address is lost.\n    \n    The solution might be to use postfix to amavis output for quarantine and postfix then return the message to mongo-mail       \n    \n\nFor Archiving only\n------------------\n\n.. code:: bash\n\n    $ vi amavisd.conf\n    \n    # ip address and port of Mongo Mail Server\n    $archive_quarantine_method      = 'smtp:[172.17.42.1]:14001';\n    \n    # Any valid email address. Domain few not exist\n    $archive_quarantine_to          = 'archive-quarantine@localhost.net';\n    \n    # reload amavis\n\nFor Quarantine and Archiving\n----------------------------\n\n.. code:: bash\n\n    $ vi amavisd.conf\n\n    $archive_quarantine_method      = 'smtp:[172.17.42.1]:14001';\n    $archive_quarantine_to          = 'archive-quarantine@localhost.net';\n\n    $virus_quarantine_method        = $archive_quarantine_method;\n    $banned_files_quarantine_method = $archive_quarantine_method;\n    $spam_quarantine_method         = $archive_quarantine_method;\n    \n    # Not quarantine for clean mail - already stored with archive_quarantine_method\n    $clean_quarantine_method        = undef;\n    \n    # Not quarantine for bad header mail\n    $bad_header_quarantine_method   = undef;\n\n    $virus_quarantine_to            = $archive_quarantine_to;\n    $banned_quarantine_to           = $archive_quarantine_to;\n    $spam_quarantine_to             = $archive_quarantine_to;\n    \n    #OR\n    $virus_quarantine_to            = 'virus-quarantine@localhost.net';\n    $banned_quarantine_to           = 'banned-quarantine@localhost.net';\n    $spam_quarantine_to             = 'spam-quarantine@localhost.net';\n    \nUsecase - Proxy Mode - Honey pot\n================================\n\n**Dedicate a postfix server for this purpose**\n\n.. code:: bash\n\n    # main.cf - ip:port of Mongo Mail\n    smtpd_proxy_filter=127.0.0.1:14001\n    \n    # or with command line\n    $ postconf -e 'smtpd_proxy_filter=127.0.0.1:14001'\n    \n    # reload postfix\n    $ postix reload\n    \n\nUsing a plugin\n==============\n\n**The module must be in a package**\n\n.. code:: python\n\n    # just required apply(metadata=None, data=None) method\n\n    # examples/plugins/dummy_plugin.py - modify server field and print message\n    \n    import pprint\n    def apply(metadata=None, data=None):\n        metadata['server'] = \"1.1.1.1\"\n        pprint.pprint(metadata)    \n    \n    # Use:\n    $ mongo-mail-server --server debug --host 127.0.0.1 --port 14001 --plugin contrib.dummy_plugin start\n\n    # Use multiple plugins - run in the order of arguments\n    $ mongo-mail-server --server --plugin myplugin1 --plugin myplugin2 ...\n    \nSMTP Tests - With Telnet\n========================\n\n.. code:: bash\n\n    # Use 172.17.42.1 is binding of docker0 else:\n    $ mms_ip=$(docker inspect -f '{{.NetworkSettings.IPAddress}}' mms)\n\n    $ telnet $mms_ip 14001\n    \n    Trying 172.17.1.19...\n    Connected to 172.17.1.19.\n    Escape character is '^]'.\n    220 a88632d9a311 SMTPD at your service\n    \n    ehlo me.com\n    250-a88632d9a311 on plain\n    250-XFORWARD NAME ADDR PROTO HELO SOURCE PORT\n    250 HELP\n    \n    XFORWARD NAME=mail.test.fr ADDR=1.1.1.1 HELO=test.fr\n    250 Ok\n    \n    MAIL FROM:<contact@test.fr>\n    250 Ok\n    \n    RCPT TO:<contact@localhost.net>\n    250 Ok\n    \n    DATA\n    354 End data with <CR><LF>.<CR><LF>\n    Subject: Test\n    From: contact@test.fr\n    To: contact@localhost.net\n    \n    mytest\n    .\n    250 Ok: queued as ab80249748e0496b812b13c489a88002fbe102fc9c263b02a8b52101491f0128\n    \n    QUIT\n    221 Bye\n    Connection closed by foreign host.\n    \nUse mongofiles command\n======================\n\n.. code:: bash\n\n    $ mongofiles -d message list\n    72c0f4898db56d5e10037e3f7f0c2af68704c8b86a2405d98a3e44e89bb56481        2188\n    571329a72c31a914251fd6fdecb160403345ee143c194cfc442ab5bee6118918        2188\n    a8de0206f9978346326cbcc9ffd5df647728268c19e8564dd1c2790b6c1404f3        2192\n    ...    \n    \n    # Extract and write message to disk\n    $ mongofiles -d message get 75e3896c1c5d98a21fc14e9408e1b9be91ced60f2bc224416de63c975c9c2915\n    \n    # Convert with python\n    python -c \"import zlib,base64; print(str(zlib.decompress(base64.b64decode(open('75e3896c1c5d98a21fc14e9408e1b9be91ced60f2bc224416de63c975c9c2915', 'rb').read()))))\"\n\n    # Parse to email.Message and print as_string()\n    python -c \"import zlib,base64,email; print(email.message_from_string(str(zlib.decompress(base64.b64decode(open('75e3896c1c5d98a21fc14e9408e1b9be91ced60f2bc224416de63c975c9c2915', 'rb').read())))).as_string())\"\n        \n    \nTips\n====\n\nSMTP timeout\n------------\n\nUse MMS_TIMEOUT  in environment or --timeout\n\nSize of messages\n----------------\n\nUse MMS_DATA_SIZE_LIMIT in environment or --data-size-limit\n\nOpen Message with Python\n------------------------\n\n.. code:: python\n\n    >>> import os, zlib, base64\n    >>> from pprint import pprint as pp\n    >>> from email.parser import Parser, HeaderParser\n    >>> from pymongo import MongoClient\n    >>> from gridfs import GridFS\n    >>> client = MongoClient(os.environ.get('MMS_MONGODB_URI'))\n    >>> db = client['message']\n    >>> col = db['message']\n    >>> doc = col.find_one() \n    >>> fs = GridFS(db)\n    >>> msg_base64 = fs.get(doc['message']).read()\n    >>> msg_string = zlib.decompress(base64.b64decode(msg_base64))\n    >>> msg = Parser().parsestr(msg_string)\n    >>> msg\n    <email.message.Message instance at 0x7ff5e4054560>    \n\n\nTODO\n====\n\n- More tests\n- Travis tests\n- Monitoring with psutil\n- Filter tasks\n- Documentation of mongo-mail-reader command\n- Documentation en Fran\u00e7ais\n\nIdeas\n=====\n\n- Record to ElasticSearch\n- Sends statistics to graphite, statsd, influxdb\n\nContributing\n============\n\nTo contribute to the project, fork it on GitHub and send a pull request, all contributions and suggestions are welcome.\n\n.. _Gsmtpd: https://github.com/34nm/gsmtpd\n.. _MongoDB: http://mongodb.org/\n.. _Docker: https://www.docker.com/\n.. _Ubuntu: http://www.ubuntu.com/\n.. _Dockerfile: http://dockerfile.github.io/#/mongodb\n.. _Python: http://www.python.org/\n.. _Pymongo2_8: http://api.mongodb.org/python/2.8/\n.. _Pymongo: http://api.mongodb.org/python/current/index.html\n.. _Gevent: http://www.gevent.org/\n.. _Postfix: http://www.postfix.org\n.. _XFORWARD: http://www.postfix.org/XFORWARD_README.html\n.. _Amavisd-new: http://www.ijs.si/software/amavisd/\n.. _Clamav: http://clamav.net/\n.. _SpamAssassin: http://spamassassin.org/\n.. _Coroutine: http://en.wikipedia.org/wiki/Coroutine\n \n.. |Build Status| image:: https://travis-ci.org/radical-software/mongo-mail-server.svg?branch=master\n   :target: https://travis-ci.org/radical-software/mongo-mail-server\n   :alt: Travis Build Status\n\n.. |pypi downloads| image:: https://img.shields.io/pypi/dm/mongo-mail-server.svg\n    :target: https://pypi.python.org/pypi/mongo-mail-server\n    :alt: Number of PyPI downloads\n    \n.. |pypi version| image:: https://img.shields.io/pypi/v/mongo-mail-server.svg\n    :target: https://pypi.python.org/pypi/mongo-mail-server\n    :alt: Latest Version\n\n.. |pypi licence| image:: https://img.shields.io/pypi/l/mongo-mail-server.svg\n    :target: https://pypi.python.org/pypi/mongo-mail-server\n    :alt: License\n\n.. |pypi py_versions| image:: https://pypip.in/py_versions/mongo-mail-server/badge.svg\n    :target: https://pypi.python.org/pypi/mongo-mail-server\n    :alt: Supported Python versions\n\n.. |pypi dev_status| image:: https://pypip.in/status/mongo-mail-server/badge.svg\n    :target: https://pypi.python.org/pypi/mongo-mail-server\n    :alt: Development Status        \n    \n.. |requires status| image:: https://requires.io/github/radical-software/mongo-mail-server/requirements.svg?branch=master\n     :target: https://requires.io/github/radical-software/mongo-mail-server/requirements/?branch=master\n     :alt: Requirements Status", "description_content_type": null, "docs_url": null, "download_url": "UNKNOWN", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/radical-software/mongo-mail-server", "keywords": null, "license": "BSD", "maintainer": null, "maintainer_email": null, "name": "mongo-mail-server", "package_url": "https://pypi.org/project/mongo-mail-server/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/mongo-mail-server/", "project_urls": {"Download": "UNKNOWN", "Homepage": "https://github.com/radical-software/mongo-mail-server"}, "release_url": "https://pypi.org/project/mongo-mail-server/0.1.1/", "requires_dist": null, "requires_python": null, "summary": "Python SMTP server with Gevent for recording messages in MongoDB", "version": "0.1.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><strong>Gevent SMTP Server with MongoDB storage</strong></p>\n<p><a href=\"https://travis-ci.org/radical-software/mongo-mail-server\" rel=\"nofollow\"><img alt=\"Travis Build Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/3c5d11b51e7dcaadfd4987fcd40d51c6346dd671/68747470733a2f2f7472617669732d63692e6f72672f7261646963616c2d736f6674776172652f6d6f6e676f2d6d61696c2d7365727665722e7376673f6272616e63683d6d6173746572\"></a> <a href=\"https://pypi.python.org/pypi/mongo-mail-server\" rel=\"nofollow\"><img alt=\"Number of PyPI downloads\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/031f05e601566cfb5526dca47f2ee581db8e397b/68747470733a2f2f696d672e736869656c64732e696f2f707970692f646d2f6d6f6e676f2d6d61696c2d7365727665722e737667\"></a> <a href=\"https://pypi.python.org/pypi/mongo-mail-server\" rel=\"nofollow\"><img alt=\"Latest Version\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/5767fa08ce31b9b64a335d5837c7771f0c56f564/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f6d6f6e676f2d6d61696c2d7365727665722e737667\"></a> <a href=\"https://pypi.python.org/pypi/mongo-mail-server\" rel=\"nofollow\"><img alt=\"License\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/fbd6bd0951ad1190d5dbf5eb81d956c0e6098db3/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f6d6f6e676f2d6d61696c2d7365727665722e737667\"></a> <a href=\"https://requires.io/github/radical-software/mongo-mail-server/requirements/?branch=master\" rel=\"nofollow\"><img alt=\"Requirements Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/15bea28d4be7ab6d639cc5d475528e060f1348f6/68747470733a2f2f72657175697265732e696f2f6769746875622f7261646963616c2d736f6674776172652f6d6f6e676f2d6d61696c2d7365727665722f726571756972656d656e74732e7376673f6272616e63683d6d6173746572\"></a></p>\n<p><strong>Demo:</strong></p>\n<ul>\n<li>URL: <a href=\"http://188.165.254.60:8083\" rel=\"nofollow\">http://188.165.254.60:8083</a></li>\n<li>Login: <a href=\"mailto:admin%40example.net\">admin<span>@</span>example<span>.</span>net</a></li>\n<li>Password: password</li>\n</ul>\n<p><strong>Features:</strong></p>\n<ul>\n<li>SMTP Server high performance with Gevent <a href=\"http://en.wikipedia.org/wiki/Coroutine\" rel=\"nofollow\">Coroutine</a> ( fork of <a href=\"https://github.com/34nm/gsmtpd\" rel=\"nofollow\">Gsmtpd</a> )</li>\n<li>Postfix <a href=\"http://www.postfix.org/XFORWARD_README.html\" rel=\"nofollow\">XFORWARD</a> extension</li>\n<li>Record messages in <a href=\"http://mongodb.org/\" rel=\"nofollow\">MongoDB</a></li>\n<li>Ability to use a custom python plugin to edit the message before recording</li>\n</ul>\n<p><strong>The use in production is not yet guaranteed</strong></p>\n<div id=\"table-of-contents\">\n<p><strong>Table of Contents</strong></p>\n<ul>\n<li><a href=\"#quarantine-mode-example\" id=\"id3\" rel=\"nofollow\">Quarantine mode example</a></li>\n<li><a href=\"#proxy-mode-example\" id=\"id4\" rel=\"nofollow\">Proxy mode example</a></li>\n<li><a href=\"#filter-mode-example\" id=\"id5\" rel=\"nofollow\">Filter mode example</a></li>\n<li><a href=\"#important-notes\" id=\"id6\" rel=\"nofollow\">Important Notes</a></li>\n<li><a href=\"#message-data\" id=\"id7\" rel=\"nofollow\">Message Data</a></li>\n<li><a href=\"#installation\" id=\"id8\" rel=\"nofollow\">Installation</a></li>\n<li><a href=\"#configuration\" id=\"id9\" rel=\"nofollow\">Configuration</a></li>\n<li><a href=\"#usecase-quarantine-mode-configuration-with-amavis\" id=\"id10\" rel=\"nofollow\">Usecase - Quarantine Mode configuration - with Amavis</a></li>\n<li><a href=\"#usecase-proxy-mode-honey-pot\" id=\"id11\" rel=\"nofollow\">Usecase - Proxy Mode - Honey pot</a></li>\n<li><a href=\"#using-a-plugin\" id=\"id12\" rel=\"nofollow\">Using a plugin</a></li>\n<li><a href=\"#smtp-tests-with-telnet\" id=\"id13\" rel=\"nofollow\">SMTP Tests - With Telnet</a></li>\n<li><a href=\"#use-mongofiles-command\" id=\"id14\" rel=\"nofollow\">Use mongofiles command</a></li>\n<li><a href=\"#tips\" id=\"id15\" rel=\"nofollow\">Tips</a></li>\n<li><a href=\"#todo\" id=\"id16\" rel=\"nofollow\">TODO</a></li>\n<li><a href=\"#ideas\" id=\"id17\" rel=\"nofollow\">Ideas</a></li>\n<li><a href=\"#contributing\" id=\"id18\" rel=\"nofollow\">Contributing</a></li>\n</ul>\n</div>\n<div id=\"quarantine-mode-example\">\n<h2>Quarantine mode example</h2>\n<p><strong>Mode for quarantine or statistics only</strong></p>\n<img alt=\"Mongo Mail Quarantine schema\" class=\"align-center\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/be1128c257c0ed649b9d49d3d64912369f248d16/687474703a2f2f6573706163652d67726f7570776172652e636f6d2f646f63732f6d6f6e676f2d6d61696c2f696d672f6d6f6e676f2d6d61696c2d71756172616e74696e652e6a7067\">\n<ul>\n<li>Network: smtp sender or recipient (with internet or local network)</li>\n<li>Content Filter: amavisd-new with xxx_quarantine_to (smtp:) parameters</li>\n<li>Configuration in amavisd.conf</li>\n<li>Zero configuration for Postfix</li>\n</ul>\n</div>\n<div id=\"proxy-mode-example\">\n<h2>Proxy mode example</h2>\n<p><strong>Mode for statistics or honey pot</strong></p>\n<img alt=\"Mongo Mail Proxy schema\" class=\"align-center\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/50f9c67e859b61daa9e48985651e0ac7bc51dcd9/687474703a2f2f6573706163652d67726f7570776172652e636f6d2f646f63732f6d6f6e676f2d6d61696c2f696d672f6d6f6e676f2d6d61696c2d70726f78792e6a7067\">\n<ul>\n<li>Network: smtp sender or recipient (with internet or local network)</li>\n<li>Optional: filtering after delivery to postfix by mongo mail</li>\n</ul>\n</div>\n<div id=\"filter-mode-example\">\n<h2>Filter mode example</h2>\n<p><strong>Mode for spam/virus filtering and statistics</strong></p>\n<img alt=\"Mongo Mail Filter schema\" class=\"align-center\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/f8da1a31d0b1e2b68b4f2867bcfa83383332de82/687474703a2f2f6573706163652d67726f7570776172652e636f6d2f646f63732f6d6f6e676f2d6d61696c2f696d672f6d6f6e676f2d6d61696c2d66696c7465722e6a7067\">\n<ul>\n<li>Network: smtp sender or recipient (with internet or local network)</li>\n<li>Filtering: clamav/spamassassin with TCP connection (without amavisd-new)</li>\n<li>Out filter: delivered so clean else</li>\n</ul>\n</div>\n<div id=\"important-notes\">\n<h2>Important Notes</h2>\n<ul>\n<li><strong>Message is not transformed (unless in quarantine mode if MMS_REAL_RCPT=1)</strong></li>\n<li><strong>Gross message is stored in GridFS after being compressed (zlib) and converted to base64</strong></li>\n<li><strong>In proxy mode, the raw message is sent before the registration in MongoDB and is not saved if an error occurs while sending or all recipients are rejected</strong></li>\n</ul>\n<div id=\"tested-with\">\n<h3>Tested With</h3>\n<ul>\n<li><a href=\"https://www.docker.com/\" rel=\"nofollow\">Docker</a> 1.4.1</li>\n<li><a href=\"http://www.ubuntu.com/\" rel=\"nofollow\">Ubuntu</a> 14.04</li>\n<li><a href=\"http://mongodb.org/\" rel=\"nofollow\">MongoDB</a> 2.6.5</li>\n<li><a href=\"http://www.python.org/\" rel=\"nofollow\">Python</a> 2.7.6</li>\n<li><a href=\"http://www.gevent.org/\" rel=\"nofollow\">Gevent</a> 1.0</li>\n<li><a href=\"http://api.mongodb.org/python/2.8/\" rel=\"nofollow\">Pymongo2_8</a> 2.8 and <a href=\"http://api.mongodb.org/python/current/index.html\" rel=\"nofollow\">Pymongo</a> 3.0</li>\n<li><a href=\"http://www.postfix.org\" rel=\"nofollow\">Postfix</a> 2.5.5</li>\n<li><a href=\"http://www.ijs.si/software/amavisd/\" rel=\"nofollow\">Amavisd-new</a> 2.6.4</li>\n</ul>\n</div>\n</div>\n<div id=\"message-data\">\n<h2>Message Data</h2>\n<div id=\"before-sent-to-mongodb\">\n<h3>Before sent to MongoDB</h3>\n<pre><span class=\"p\">{</span><span class=\"s1\">'client_address'</span><span class=\"p\">:</span> <span class=\"s1\">'139.129.236.68'</span><span class=\"p\">,</span>\n <span class=\"s1\">'message'</span><span class=\"p\">:</span> <span class=\"n\">ObjectId</span><span class=\"p\">(</span><span class=\"s1\">'55252ae62d4b25262070a176'</span><span class=\"p\">),</span>\n <span class=\"s1\">'rcpt'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s1\">'jean91@example.com'</span><span class=\"p\">],</span>\n <span class=\"s1\">'rcpt_count'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n <span class=\"s1\">'rcpt_refused'</span><span class=\"p\">:</span> <span class=\"p\">{},</span>\n <span class=\"s1\">'received'</span><span class=\"p\">:</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">datetime</span><span class=\"p\">(</span><span class=\"mi\">2015</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">13</span><span class=\"p\">,</span> <span class=\"mi\">19</span><span class=\"p\">,</span> <span class=\"mi\">34</span><span class=\"p\">,</span> <span class=\"mi\">579000</span><span class=\"p\">,</span> <span class=\"n\">tzinfo</span><span class=\"o\">=</span><span class=\"n\">tzutc</span><span class=\"p\">()),</span>\n <span class=\"s1\">'sender'</span><span class=\"p\">:</span> <span class=\"s1\">'acollet@example.org'</span><span class=\"p\">,</span>\n <span class=\"s1\">'server'</span><span class=\"p\">:</span> <span class=\"s1\">'127.0.0.1'</span><span class=\"p\">,</span>\n <span class=\"s1\">'store_key'</span><span class=\"p\">:</span> <span class=\"s1\">'77bd8b356cf2c593e61a6c0a7cbc5572eb357a7b857adca402ee40021db34fa6'</span><span class=\"p\">,</span>\n <span class=\"s1\">'xforward'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s1\">'ADDR'</span><span class=\"p\">:</span> <span class=\"s1\">'139.129.236.68'</span><span class=\"p\">,</span>\n              <span class=\"s1\">'HELO'</span><span class=\"p\">:</span> <span class=\"s1\">'mx.example.org'</span><span class=\"p\">,</span>\n              <span class=\"s1\">'NAME'</span><span class=\"p\">:</span> <span class=\"s1\">'mx.example.org'</span><span class=\"p\">}}</span>\n\n<span class=\"s1\">'message'</span><span class=\"p\">:</span> <span class=\"n\">ObjectId</span><span class=\"p\">(</span><span class=\"s1\">'55252ae62d4b25262070a176'</span><span class=\"p\">)</span> <span class=\"ow\">is</span> <span class=\"n\">reference</span> <span class=\"n\">to</span> <span class=\"n\">data</span> <span class=\"ow\">in</span> <span class=\"n\">Gridfs</span>\n</pre>\n</div>\n<div id=\"after-record-in-mongodb-read-from-mongo-mail-web\">\n<h3>After record in MongoDB - Read from mongo-mail-web</h3>\n<pre><span class=\"p\">{</span><span class=\"s1\">'_id'</span><span class=\"p\">:</span> <span class=\"n\">ObjectId</span><span class=\"p\">(</span><span class=\"s1\">'55252ae62d4b25262070a178'</span><span class=\"p\">),</span>\n <span class=\"s1\">'client_address'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'139.129.236.68'</span><span class=\"p\">,</span>\n <span class=\"s1\">'completed'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'errors_count'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'events'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"s1\">'files'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"s1\">'files_count'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'group_name'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'DEFAULT'</span><span class=\"p\">,</span>\n <span class=\"s1\">'headers'</span><span class=\"p\">:</span> <span class=\"p\">{},</span>\n <span class=\"s1\">'internal_field'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_banned'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_bounce'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_in'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_spam'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_unchecked'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_virus'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'mark_for_delete'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'message'</span><span class=\"p\">:</span> <span class=\"n\">ObjectId</span><span class=\"p\">(</span><span class=\"s1\">'55252ae62d4b25262070a176'</span><span class=\"p\">),</span>\n <span class=\"s1\">'parsing_errors'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"s1\">'queue'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n <span class=\"s1\">'rcpt'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"sa\">u</span><span class=\"s1\">'jean91@example.com'</span><span class=\"p\">],</span>\n <span class=\"s1\">'rcpt_count'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n <span class=\"s1\">'rcpt_refused'</span><span class=\"p\">:</span> <span class=\"p\">{},</span>\n <span class=\"s1\">'received'</span><span class=\"p\">:</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">datetime</span><span class=\"p\">(</span><span class=\"mi\">2015</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">13</span><span class=\"p\">,</span> <span class=\"mi\">19</span><span class=\"p\">,</span> <span class=\"mi\">34</span><span class=\"p\">,</span> <span class=\"mi\">579000</span><span class=\"p\">,</span> <span class=\"n\">tzinfo</span><span class=\"o\">=&lt;</span><span class=\"n\">bson</span><span class=\"o\">.</span><span class=\"n\">tz_util</span><span class=\"o\">.</span><span class=\"n\">FixedOffset</span> <span class=\"nb\">object</span> <span class=\"n\">at</span> <span class=\"mh\">0x02B54E10</span><span class=\"o\">&gt;</span><span class=\"p\">),</span>\n <span class=\"s1\">'sender'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'acollet@example.org'</span><span class=\"p\">,</span>\n <span class=\"s1\">'server'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'127.0.0.1'</span><span class=\"p\">,</span>\n <span class=\"s1\">'size'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"n\">L</span><span class=\"p\">,</span>\n <span class=\"s1\">'store_key'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'77bd8b356cf2c593e61a6c0a7cbc5572eb357a7b857adca402ee40021db34fa6'</span><span class=\"p\">,</span>\n <span class=\"s1\">'tags'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"s1\">'xforward'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"sa\">u</span><span class=\"s1\">'ADDR'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'139.129.236.68'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'HELO'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'mx.example.org'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'NAME'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'mx.example.org'</span><span class=\"p\">}}</span>\n</pre>\n</div>\n<div id=\"after-parsing-with-mongo-mail-web-completed-task\">\n<h3>After parsing with mongo-mail-web (completed task)</h3>\n<pre><span class=\"p\">{</span><span class=\"s1\">'_id'</span><span class=\"p\">:</span> <span class=\"n\">ObjectId</span><span class=\"p\">(</span><span class=\"s1\">'55252ae62d4b25262070a178'</span><span class=\"p\">),</span>\n <span class=\"s1\">'client_address'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'139.129.236.68'</span><span class=\"p\">,</span>\n <span class=\"s1\">'completed'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n <span class=\"s1\">'country'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'CN'</span><span class=\"p\">,</span>\n <span class=\"s1\">'errors_count'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'events'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"s1\">'files'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"s1\">'files_count'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'group_name'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'DEFAULT'</span><span class=\"p\">,</span>\n <span class=\"s1\">'headers'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"sa\">u</span><span class=\"s1\">'Content-Transfer-Encoding'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"sa\">u</span><span class=\"s1\">'base64'</span><span class=\"p\">,</span> <span class=\"p\">{}],</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'Content-Type'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"sa\">u</span><span class=\"s1\">'text/plain'</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"sa\">u</span><span class=\"s1\">'charset'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'utf-8'</span><span class=\"p\">}],</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'Date'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'Wed, 08 Apr 2015 13:19:34 UTC'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'From'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'\"Bertrand Auger\" &lt;acollet@example.org&gt;'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'Message-Id'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'&lt;20150408131934.10264.63423@admin-VAIO&gt;'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'Mime-Version'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'1.0'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'Subject'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'Provident tempora ad quasi enim in ratione excepturi. Optio soluta culpa voluptas labore in. Voluptatem aliquid est rerum in est adipisci dolore.'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'To'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'\"Thierry Leleu\" &lt;jean91@example.com&gt;'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'X-Mailer'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'MessageFaker'</span><span class=\"p\">},</span>\n <span class=\"s1\">'internal_field'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_banned'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_bounce'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_in'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_spam'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_unchecked'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'is_virus'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'mark_for_delete'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n <span class=\"s1\">'message'</span><span class=\"p\">:</span> <span class=\"n\">ObjectId</span><span class=\"p\">(</span><span class=\"s1\">'55252ae62d4b25262070a176'</span><span class=\"p\">),</span>\n <span class=\"s1\">'message_id'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'20150408131934.10264.63423@admin-VAIO'</span><span class=\"p\">,</span>\n <span class=\"s1\">'parsing_errors'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"s1\">'queue'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n <span class=\"s1\">'rcpt'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"sa\">u</span><span class=\"s1\">'jean91@example.com'</span><span class=\"p\">],</span>\n <span class=\"s1\">'rcpt_count'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n <span class=\"s1\">'rcpt_refused'</span><span class=\"p\">:</span> <span class=\"p\">{},</span>\n <span class=\"s1\">'received'</span><span class=\"p\">:</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">datetime</span><span class=\"p\">(</span><span class=\"mi\">2015</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">13</span><span class=\"p\">,</span> <span class=\"mi\">19</span><span class=\"p\">,</span> <span class=\"mi\">34</span><span class=\"p\">,</span> <span class=\"mi\">579000</span><span class=\"p\">,</span> <span class=\"n\">tzinfo</span><span class=\"o\">=&lt;</span><span class=\"n\">bson</span><span class=\"o\">.</span><span class=\"n\">tz_util</span><span class=\"o\">.</span><span class=\"n\">FixedOffset</span> <span class=\"nb\">object</span> <span class=\"n\">at</span> <span class=\"mh\">0x02AC4E10</span><span class=\"o\">&gt;</span><span class=\"p\">),</span>\n <span class=\"s1\">'sender'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'acollet@example.org'</span><span class=\"p\">,</span>\n <span class=\"s1\">'sent'</span><span class=\"p\">:</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">datetime</span><span class=\"p\">(</span><span class=\"mi\">2015</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">13</span><span class=\"p\">,</span> <span class=\"mi\">19</span><span class=\"p\">,</span> <span class=\"mi\">34</span><span class=\"p\">,</span> <span class=\"n\">tzinfo</span><span class=\"o\">=&lt;</span><span class=\"n\">bson</span><span class=\"o\">.</span><span class=\"n\">tz_util</span><span class=\"o\">.</span><span class=\"n\">FixedOffset</span> <span class=\"nb\">object</span> <span class=\"n\">at</span> <span class=\"mh\">0x02AC4E10</span><span class=\"o\">&gt;</span><span class=\"p\">),</span>\n <span class=\"s1\">'server'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'127.0.0.1'</span><span class=\"p\">,</span>\n <span class=\"s1\">'size'</span><span class=\"p\">:</span> <span class=\"mi\">636</span><span class=\"n\">L</span><span class=\"p\">,</span>\n <span class=\"s1\">'store_key'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'77bd8b356cf2c593e61a6c0a7cbc5572eb357a7b857adca402ee40021db34fa6'</span><span class=\"p\">,</span>\n <span class=\"s1\">'subject'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'Provident tempora ad quasi enim in ratione excepturi. Optio soluta culpa voluptas labore in. Voluptatem aliquid est rerum in est adipisci dolore.'</span><span class=\"p\">,</span>\n <span class=\"s1\">'tags'</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n <span class=\"s1\">'xforward'</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"sa\">u</span><span class=\"s1\">'ADDR'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'139.129.236.68'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'HELO'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'mx.example.org'</span><span class=\"p\">,</span>\n  <span class=\"sa\">u</span><span class=\"s1\">'NAME'</span><span class=\"p\">:</span> <span class=\"sa\">u</span><span class=\"s1\">'mx.example.org'</span><span class=\"p\">}}</span>\n</pre>\n</div>\n<div id=\"original-message\">\n<h3>Original Message</h3>\n<pre>Content-Type: text/plain; charset=\"utf-8\"\nMIME-Version: 1.0\nContent-Transfer-Encoding: base64\nX-Mailer: MessageFaker\nMessage-ID: &lt;20150408131934.10264.63423@admin-VAIO&gt;\nFrom: \"Bertrand Auger\" &lt;acollet@example.org&gt;\nTo: \"Thierry Leleu\" &lt;jean91@example.com&gt;\nSubject: Provident tempora ad quasi enim in ratione excepturi. Optio soluta\n culpa voluptas labore in. Voluptatem aliquid est rerum in est adipisci\n dolore.\nDate: Wed, 08 Apr 2015 13:19:34 UTC\n\nU2l0IHZvbHVwdGF0ZSByZXJ1bSBjb3Jwb3JpcyBkb2xvcmlidXMgZW9zLiBRdWFzIGVvcyBub24g\nbW9kaSBxdWlzLiBBbGlhcyB2ZWwgbGF1ZGFudGl1bSBtYWduaSBzdXNjaXBpdC4gRnVnaWF0IGV0\nIHF1aXMgZXQgaW4gYWNjdXNhbXVzLg==\n</pre>\n</div>\n</div>\n<div id=\"installation\">\n<h2>Installation</h2>\n<div id=\"without-docker\">\n<h3>Without Docker</h3>\n<div id=\"required\">\n<h4>Required</h4>\n<ul>\n<li>MongoDB Server</li>\n<li>Postfix or Amavisd-new</li>\n<li>Python 2.7.6+ (&lt; 3.x)</li>\n<li>python-gevent 1.0+</li>\n<li>recent setuptools and pip installer</li>\n</ul>\n</div>\n<div id=\"id1\">\n<h4>Installation</h4>\n<pre>$ pip install mongo-mail-server\n\n$ mongo-mail-server --help\n</pre>\n</div>\n</div>\n<div id=\"with-docker\">\n<h3>With Docker</h3>\n<div id=\"id2\">\n<h4>Required</h4>\n<ul>\n<li>Docker 1.4+</li>\n<li>MongoDB Server</li>\n</ul>\n</div>\n<div id=\"mongodb-server-example\">\n<h4>MongoDB Server example</h4>\n<p>Contenair based on Ubuntu 14.04 - Python 2.7</p>\n<p>Image from <a href=\"http://dockerfile.github.io/#/mongodb\" rel=\"nofollow\">Dockerfile</a></p>\n<pre>$ docker pull dockerfile/mongodb\n\n$ docker run -d -p <span class=\"m\">27017</span>:27017 --name mongodb dockerfile/mongodb mongod --smallfiles\n\n<span class=\"c1\"># Persist mongodb\n</span>$ docker run -v /home/persist/mongodb:/data/db -d -p <span class=\"m\">27017</span>:27017 --name mongodb dockerfile/mongodb mongod --smallfiles\n</pre>\n</div>\n<div id=\"build-mongo-mail-server-image\">\n<h4>Build Mongo Mail Server image</h4>\n<pre>$ git clone https://github.com/radical-software/mongo-mail-server.git\n\n$ <span class=\"nb\">cd</span> mongo-mail-server <span class=\"o\">&amp;&amp;</span> docker build -t mongo-mail-server .\n\n<span class=\"c1\"># help and verify\n</span>$ docker run -it --rm mongo-mail-server --help\n</pre>\n</div>\n<div id=\"run-mongo-mail-server\">\n<h4>Run Mongo Mail Server</h4>\n<pre>$ <span class=\"nv\">mongodb_ip</span><span class=\"o\">=</span><span class=\"k\">$(</span>docker inspect -f <span class=\"s1\">'{{.NetworkSettings.IPAddress}}'</span> mongodb<span class=\"k\">)</span>\n\n<span class=\"c1\"># start for test\n</span>$ docker run -it --rm -e <span class=\"nv\">MMS_MONGODB_URI</span><span class=\"o\">=</span>mongodb://<span class=\"nv\">$mongodb_ip</span>/message -p <span class=\"m\">172</span>.17.42.1:14001:14001 mongo-mail-server\n\n<span class=\"c1\"># start of background (optional: bind of docker0 interface)\n# Add --restart=always for automatic restart\n</span>$ docker run -d --name mms -e <span class=\"nv\">MMS_MONGODB_URI</span><span class=\"o\">=</span>mongodb://<span class=\"nv\">$mongodb_ip</span>/message -p <span class=\"m\">172</span>.17.42.1:14001:14001 mongo-mail-server\n\n<span class=\"c1\"># Logs\n</span>$ docker logs mms\n<span class=\"m\">2015</span>-02-12 <span class=\"m\">07</span>:35:36 rs_smtpd_server: <span class=\"o\">[</span>INFO<span class=\"o\">]</span> - Starting SMTP Server - server<span class=\"o\">[</span>mongo-quarantine<span class=\"o\">]</span> - on <span class=\"m\">0</span>.0.0.0:14001 <span class=\"o\">(</span>PID:1<span class=\"o\">)</span>\n</pre>\n</div>\n</div>\n</div>\n<div id=\"configuration\">\n<h2>Configuration</h2>\n<div id=\"mms-server\">\n<h3>MMS_SERVER</h3>\n<p>Server mode: mongo-quarantine | mongo-proxy | mongo-proxy | debug</p>\n<p><em>Default</em>: mongo-quarantine</p>\n<pre><span class=\"c1\"># with command mode\n</span>$ <span class=\"nb\">export</span> <span class=\"nv\">MMS_SERVER</span><span class=\"o\">=</span>mongo-quarantine\n\n<span class=\"c1\"># with docker environ\n</span>$ docker run -e <span class=\"nv\">MMS_SERVER</span><span class=\"o\">=</span>mongo-quarantine\n\n<span class=\"c1\"># with command arguments\n</span>$ mongo-mail-server --server mongo-quarantine\n</pre>\n</div>\n<div id=\"mms-host\">\n<h3>MMS_HOST</h3>\n<p><strong>Host bind</strong></p>\n<p><em>Default</em>: 0.0.0.0</p>\n<pre><span class=\"c1\"># with command mode\n</span>$ <span class=\"nb\">export</span> <span class=\"nv\">MMS_HOST</span><span class=\"o\">=</span><span class=\"m\">0</span>.0.0.0\n\n<span class=\"c1\"># with docker environ\n</span>$ docker run -e <span class=\"nv\">MMS_HOST</span><span class=\"o\">=</span><span class=\"m\">0</span>.0.0.0\n\n<span class=\"c1\"># with command arguments\n</span>$ mongo-mail-server --host <span class=\"m\">0</span>.0.0.0\n</pre>\n</div>\n<div id=\"mms-port\">\n<h3>MMS_PORT</h3>\n<p><strong>Port bind</strong></p>\n<p><em>Default</em>: 14001</p>\n<pre><span class=\"c1\"># with command mode\n</span>$ <span class=\"nb\">export</span> <span class=\"nv\">MMS_PORT</span><span class=\"o\">=</span><span class=\"m\">14001</span>\n\n<span class=\"c1\"># with docker environ\n</span>$ docker run -e <span class=\"nv\">MMS_PORT</span><span class=\"o\">=</span><span class=\"m\">14001</span>\n\n<span class=\"c1\"># with command arguments\n</span>$ mongo-mail-server --port <span class=\"m\">14001</span>\n</pre>\n</div>\n<div id=\"mms-mongodb-uri\">\n<h3>MMS_MONGODB_URI</h3>\n<p><em>Default</em>: mongodb://localhost/message</p>\n<p><a href=\"http://docs.mongodb.org/manual/reference/connection-string/\" rel=\"nofollow\">http://docs.mongodb.org/manual/reference/connection-string/</a></p>\n<pre><span class=\"c1\"># with command mode\n</span>$ <span class=\"nb\">export</span> <span class=\"nv\">MMS_MONGODB_URI</span><span class=\"o\">=</span>mongodb://localhost/message\n\n<span class=\"c1\"># with docker environ\n</span>$ docker run -e <span class=\"nv\">MMS_MONGODB_URI</span><span class=\"o\">=</span>mongodb://localhost/message\n\n<span class=\"c1\"># with command arguments\n</span>$ mongo-mail-server --mongo-host mongodb://localhost/message\n</pre>\n</div>\n<div id=\"mms-mongodb-database\">\n<h3>MMS_MONGODB_DATABASE</h3>\n<p><strong>DB Name for recording mails</strong></p>\n<p><em>Default</em>: message</p>\n<pre><span class=\"c1\"># with command mode\n</span>$ <span class=\"nb\">export</span> <span class=\"nv\">MMS_MONGODB_DATABASE</span><span class=\"o\">=</span>message\n\n<span class=\"c1\"># with docker environ\n</span>$ docker run -e <span class=\"nv\">MMS_MONGODB_DATABASE</span><span class=\"o\">=</span>message\n\n<span class=\"c1\"># with command arguments\n</span>$ mongo-mail-server --mongo-database message\n</pre>\n</div>\n<div id=\"mms-mongodb-collection\">\n<h3>MMS_MONGODB_COLLECTION</h3>\n<p><strong>Collection Name for recording mails</strong></p>\n<p><em>Default</em>: message</p>\n<pre><span class=\"c1\"># with command mode\n</span>$ <span class=\"nb\">export</span> <span class=\"nv\">MMS_MONGODB_COLLECTION</span><span class=\"o\">=</span>message\n\n<span class=\"c1\"># with docker environ\n</span>$ docker run -e <span class=\"nv\">MMS_MONGODB_COLLECTION</span><span class=\"o\">=</span>message\n\n<span class=\"c1\"># with command arguments\n</span>$ mongo-mail-server --mongo-collection message\n</pre>\n</div>\n<div id=\"mms-timeout\">\n<h3>MMS_TIMEOUT</h3>\n<p><strong>Timeout for smtp transaction from Postfix</strong></p>\n<p><em>Default: 600 (seconds)</em></p>\n</div>\n<div id=\"mms-data-size-limit\">\n<h3>MMS_DATA_SIZE_LIMIT</h3>\n<p><strong>Size limit of message (in bytes)</strong></p>\n<p><em>Default: 0 (no limit)</em></p>\n</div>\n<div id=\"mms-real-rcpt-for-amavisd-new-2-7-0\">\n<h3>MMS_REAL_RCPT (for amavisd-new &lt; 2.7.0)</h3>\n<p><strong>Replace smtp recipient by real recipients (for quarantine with amavisd-new)</strong></p>\n<p><em>Default</em>: disable</p>\n<pre><span class=\"c1\"># with command mode\n</span>$ <span class=\"nb\">export</span> <span class=\"nv\">MMS_REAL_RCPT</span><span class=\"o\">=</span><span class=\"m\">1</span>\n\n<span class=\"c1\"># with docker environ\n</span>$ docker run -e <span class=\"nv\">MMS_REAL_RCPT</span><span class=\"o\">=</span><span class=\"m\">1</span>\n\n<span class=\"c1\"># with command arguments\n</span>$ mongo-mail-server --real-rcpt\n</pre>\n</div>\n</div>\n<div id=\"usecase-quarantine-mode-configuration-with-amavis\">\n<h2>Usecase - Quarantine Mode configuration - with Amavis</h2>\n<p><strong>caution</strong></p>\n<pre>Before amavisd-new 2.7.0 the recipient envelope is replaced by xxx_quarantine_to parameters\n\nStarting from 2.7.0, use macro '%a' in xxx_quarantine_to parameters\n</pre>\n<p><strong>caution</strong></p>\n<pre>About IP Address of smtp sender:\n\nAmavis does not use the extension SMTPD FORWARD to send mails in quarantine. The original IP address is lost.\n\nThe solution might be to use postfix to amavis output for quarantine and postfix then return the message to mongo-mail\n</pre>\n<div id=\"for-archiving-only\">\n<h3>For Archiving only</h3>\n<pre>$ vi amavisd.conf\n\n<span class=\"c1\"># ip address and port of Mongo Mail Server\n</span><span class=\"nv\">$archive_quarantine_method</span>      <span class=\"o\">=</span> <span class=\"s1\">'smtp:[172.17.42.1]:14001'</span><span class=\"p\">;</span>\n\n<span class=\"c1\"># Any valid email address. Domain few not exist\n</span><span class=\"nv\">$archive_quarantine_to</span>          <span class=\"o\">=</span> <span class=\"s1\">'archive-quarantine@localhost.net'</span><span class=\"p\">;</span>\n\n<span class=\"c1\"># reload amavis</span>\n</pre>\n</div>\n<div id=\"for-quarantine-and-archiving\">\n<h3>For Quarantine and Archiving</h3>\n<pre>$ vi amavisd.conf\n\n<span class=\"nv\">$archive_quarantine_method</span>      <span class=\"o\">=</span> <span class=\"s1\">'smtp:[172.17.42.1]:14001'</span><span class=\"p\">;</span>\n<span class=\"nv\">$archive_quarantine_to</span>          <span class=\"o\">=</span> <span class=\"s1\">'archive-quarantine@localhost.net'</span><span class=\"p\">;</span>\n\n<span class=\"nv\">$virus_quarantine_method</span>        <span class=\"o\">=</span> <span class=\"nv\">$archive_quarantine_method</span><span class=\"p\">;</span>\n<span class=\"nv\">$banned_files_quarantine_method</span> <span class=\"o\">=</span> <span class=\"nv\">$archive_quarantine_method</span><span class=\"p\">;</span>\n<span class=\"nv\">$spam_quarantine_method</span>         <span class=\"o\">=</span> <span class=\"nv\">$archive_quarantine_method</span><span class=\"p\">;</span>\n\n<span class=\"c1\"># Not quarantine for clean mail - already stored with archive_quarantine_method\n</span><span class=\"nv\">$clean_quarantine_method</span>        <span class=\"o\">=</span> undef<span class=\"p\">;</span>\n\n<span class=\"c1\"># Not quarantine for bad header mail\n</span><span class=\"nv\">$bad_header_quarantine_method</span>   <span class=\"o\">=</span> undef<span class=\"p\">;</span>\n\n<span class=\"nv\">$virus_quarantine_to</span>            <span class=\"o\">=</span> <span class=\"nv\">$archive_quarantine_to</span><span class=\"p\">;</span>\n<span class=\"nv\">$banned_quarantine_to</span>           <span class=\"o\">=</span> <span class=\"nv\">$archive_quarantine_to</span><span class=\"p\">;</span>\n<span class=\"nv\">$spam_quarantine_to</span>             <span class=\"o\">=</span> <span class=\"nv\">$archive_quarantine_to</span><span class=\"p\">;</span>\n\n<span class=\"c1\">#OR\n</span><span class=\"nv\">$virus_quarantine_to</span>            <span class=\"o\">=</span> <span class=\"s1\">'virus-quarantine@localhost.net'</span><span class=\"p\">;</span>\n<span class=\"nv\">$banned_quarantine_to</span>           <span class=\"o\">=</span> <span class=\"s1\">'banned-quarantine@localhost.net'</span><span class=\"p\">;</span>\n<span class=\"nv\">$spam_quarantine_to</span>             <span class=\"o\">=</span> <span class=\"s1\">'spam-quarantine@localhost.net'</span><span class=\"p\">;</span>\n</pre>\n</div>\n</div>\n<div id=\"usecase-proxy-mode-honey-pot\">\n<h2>Usecase - Proxy Mode - Honey pot</h2>\n<p><strong>Dedicate a postfix server for this purpose</strong></p>\n<pre><span class=\"c1\"># main.cf - ip:port of Mongo Mail\n</span><span class=\"nv\">smtpd_proxy_filter</span><span class=\"o\">=</span><span class=\"m\">127</span>.0.0.1:14001\n\n<span class=\"c1\"># or with command line\n</span>$ postconf -e <span class=\"s1\">'smtpd_proxy_filter=127.0.0.1:14001'</span>\n\n<span class=\"c1\"># reload postfix\n</span>$ postix reload\n</pre>\n</div>\n<div id=\"using-a-plugin\">\n<h2>Using a plugin</h2>\n<p><strong>The module must be in a package</strong></p>\n<pre><span class=\"c1\"># just required apply(metadata=None, data=None) method</span>\n\n<span class=\"c1\"># examples/plugins/dummy_plugin.py - modify server field and print message</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">pprint</span>\n<span class=\"k\">def</span> <span class=\"nf\">apply</span><span class=\"p\">(</span><span class=\"n\">metadata</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"n\">metadata</span><span class=\"p\">[</span><span class=\"s1\">'server'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"1.1.1.1\"</span>\n    <span class=\"n\">pprint</span><span class=\"o\">.</span><span class=\"n\">pprint</span><span class=\"p\">(</span><span class=\"n\">metadata</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Use:</span>\n<span class=\"err\">$</span> <span class=\"n\">mongo</span><span class=\"o\">-</span><span class=\"n\">mail</span><span class=\"o\">-</span><span class=\"n\">server</span> <span class=\"o\">--</span><span class=\"n\">server</span> <span class=\"n\">debug</span> <span class=\"o\">--</span><span class=\"n\">host</span> <span class=\"mf\">127.0</span><span class=\"o\">.</span><span class=\"mf\">0.1</span> <span class=\"o\">--</span><span class=\"n\">port</span> <span class=\"mi\">14001</span> <span class=\"o\">--</span><span class=\"n\">plugin</span> <span class=\"n\">contrib</span><span class=\"o\">.</span><span class=\"n\">dummy_plugin</span> <span class=\"n\">start</span>\n\n<span class=\"c1\"># Use multiple plugins - run in the order of arguments</span>\n<span class=\"err\">$</span> <span class=\"n\">mongo</span><span class=\"o\">-</span><span class=\"n\">mail</span><span class=\"o\">-</span><span class=\"n\">server</span> <span class=\"o\">--</span><span class=\"n\">server</span> <span class=\"o\">--</span><span class=\"n\">plugin</span> <span class=\"n\">myplugin1</span> <span class=\"o\">--</span><span class=\"n\">plugin</span> <span class=\"n\">myplugin2</span> <span class=\"o\">...</span>\n</pre>\n</div>\n<div id=\"smtp-tests-with-telnet\">\n<h2>SMTP Tests - With Telnet</h2>\n<pre><span class=\"c1\"># Use 172.17.42.1 is binding of docker0 else:\n</span>$ <span class=\"nv\">mms_ip</span><span class=\"o\">=</span><span class=\"k\">$(</span>docker inspect -f <span class=\"s1\">'{{.NetworkSettings.IPAddress}}'</span> mms<span class=\"k\">)</span>\n\n$ telnet <span class=\"nv\">$mms_ip</span> <span class=\"m\">14001</span>\n\nTrying <span class=\"m\">172</span>.17.1.19...\nConnected to <span class=\"m\">172</span>.17.1.19.\nEscape character is <span class=\"s1\">'^]'</span>.\n<span class=\"m\">220</span> a88632d9a311 SMTPD at your service\n\nehlo me.com\n<span class=\"m\">250</span>-a88632d9a311 on plain\n<span class=\"m\">250</span>-XFORWARD NAME ADDR PROTO HELO SOURCE PORT\n<span class=\"m\">250</span> HELP\n\nXFORWARD <span class=\"nv\">NAME</span><span class=\"o\">=</span>mail.test.fr <span class=\"nv\">ADDR</span><span class=\"o\">=</span><span class=\"m\">1</span>.1.1.1 <span class=\"nv\">HELO</span><span class=\"o\">=</span>test.fr\n<span class=\"m\">250</span> Ok\n\nMAIL FROM:&lt;contact@test.fr&gt;\n<span class=\"m\">250</span> Ok\n\nRCPT TO:&lt;contact@localhost.net&gt;\n<span class=\"m\">250</span> Ok\n\nDATA\n<span class=\"m\">354</span> End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;\nSubject: Test\nFrom: contact@test.fr\nTo: contact@localhost.net\n\nmytest\n.\n<span class=\"m\">250</span> Ok: queued as ab80249748e0496b812b13c489a88002fbe102fc9c263b02a8b52101491f0128\n\nQUIT\n<span class=\"m\">221</span> Bye\nConnection closed by foreign host.\n</pre>\n</div>\n<div id=\"use-mongofiles-command\">\n<h2>Use mongofiles command</h2>\n<pre>$ mongofiles -d message list\n72c0f4898db56d5e10037e3f7f0c2af68704c8b86a2405d98a3e44e89bb56481        <span class=\"m\">2188</span>\n571329a72c31a914251fd6fdecb160403345ee143c194cfc442ab5bee6118918        <span class=\"m\">2188</span>\na8de0206f9978346326cbcc9ffd5df647728268c19e8564dd1c2790b6c1404f3        <span class=\"m\">2192</span>\n...\n\n<span class=\"c1\"># Extract and write message to disk\n</span>$ mongofiles -d message get 75e3896c1c5d98a21fc14e9408e1b9be91ced60f2bc224416de63c975c9c2915\n\n<span class=\"c1\"># Convert with python\n</span>python -c <span class=\"s2\">\"import zlib,base64; print(str(zlib.decompress(base64.b64decode(open('75e3896c1c5d98a21fc14e9408e1b9be91ced60f2bc224416de63c975c9c2915', 'rb').read()))))\"</span>\n\n<span class=\"c1\"># Parse to email.Message and print as_string()\n</span>python -c <span class=\"s2\">\"import zlib,base64,email; print(email.message_from_string(str(zlib.decompress(base64.b64decode(open('75e3896c1c5d98a21fc14e9408e1b9be91ced60f2bc224416de63c975c9c2915', 'rb').read())))).as_string())\"</span>\n</pre>\n</div>\n<div id=\"tips\">\n<h2>Tips</h2>\n<div id=\"smtp-timeout\">\n<h3>SMTP timeout</h3>\n<p>Use MMS_TIMEOUT  in environment or \u2013timeout</p>\n</div>\n<div id=\"size-of-messages\">\n<h3>Size of messages</h3>\n<p>Use MMS_DATA_SIZE_LIMIT in environment or \u2013data-size-limit</p>\n</div>\n<div id=\"open-message-with-python\">\n<h3>Open Message with Python</h3>\n<pre><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"kn\">import</span> <span class=\"nn\">os</span><span class=\"o\">,</span> <span class=\"nn\">zlib</span><span class=\"o\">,</span> <span class=\"nn\">base64</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"kn\">from</span> <span class=\"nn\">pprint</span> <span class=\"kn\">import</span> <span class=\"n\">pprint</span> <span class=\"k\">as</span> <span class=\"n\">pp</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"kn\">from</span> <span class=\"nn\">email.parser</span> <span class=\"kn\">import</span> <span class=\"n\">Parser</span><span class=\"p\">,</span> <span class=\"n\">HeaderParser</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"kn\">from</span> <span class=\"nn\">pymongo</span> <span class=\"kn\">import</span> <span class=\"n\">MongoClient</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"kn\">from</span> <span class=\"nn\">gridfs</span> <span class=\"kn\">import</span> <span class=\"n\">GridFS</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"n\">MongoClient</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">'MMS_MONGODB_URI'</span><span class=\"p\">))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">db</span> <span class=\"o\">=</span> <span class=\"n\">client</span><span class=\"p\">[</span><span class=\"s1\">'message'</span><span class=\"p\">]</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">col</span> <span class=\"o\">=</span> <span class=\"n\">db</span><span class=\"p\">[</span><span class=\"s1\">'message'</span><span class=\"p\">]</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">doc</span> <span class=\"o\">=</span> <span class=\"n\">col</span><span class=\"o\">.</span><span class=\"n\">find_one</span><span class=\"p\">()</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">fs</span> <span class=\"o\">=</span> <span class=\"n\">GridFS</span><span class=\"p\">(</span><span class=\"n\">db</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">msg_base64</span> <span class=\"o\">=</span> <span class=\"n\">fs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">doc</span><span class=\"p\">[</span><span class=\"s1\">'message'</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">msg_string</span> <span class=\"o\">=</span> <span class=\"n\">zlib</span><span class=\"o\">.</span><span class=\"n\">decompress</span><span class=\"p\">(</span><span class=\"n\">base64</span><span class=\"o\">.</span><span class=\"n\">b64decode</span><span class=\"p\">(</span><span class=\"n\">msg_base64</span><span class=\"p\">))</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">Parser</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">parsestr</span><span class=\"p\">(</span><span class=\"n\">msg_string</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">msg</span>\n<span class=\"o\">&lt;</span><span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"o\">.</span><span class=\"n\">Message</span> <span class=\"n\">instance</span> <span class=\"n\">at</span> <span class=\"mh\">0x7ff5e4054560</span><span class=\"o\">&gt;</span>\n</pre>\n</div>\n</div>\n<div id=\"todo\">\n<h2>TODO</h2>\n<ul>\n<li>More tests</li>\n<li>Travis tests</li>\n<li>Monitoring with psutil</li>\n<li>Filter tasks</li>\n<li>Documentation of mongo-mail-reader command</li>\n<li>Documentation en Fran\u00e7ais</li>\n</ul>\n</div>\n<div id=\"ideas\">\n<h2>Ideas</h2>\n<ul>\n<li>Record to ElasticSearch</li>\n<li>Sends statistics to graphite, statsd, influxdb</li>\n</ul>\n</div>\n<div id=\"contributing\">\n<h2>Contributing</h2>\n<p>To contribute to the project, fork it on GitHub and send a pull request, all contributions and suggestions are welcome.</p>\n</div>\n\n          </div>"}, "last_serial": 1531215, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "3d9ae1ecc8380f0789c3c739c12568d3", "sha256": "edb540bdbfaa99f3f2419728f3d7259d99296eeebae3f9da534bc0af2f86c6ef"}, "downloads": -1, "filename": "mongo-mail-server-0.1.0.zip", "has_sig": false, "md5_digest": "3d9ae1ecc8380f0789c3c739c12568d3", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 35674, "upload_time": "2015-04-09T07:48:10", "upload_time_iso_8601": "2015-04-09T07:48:10.727257Z", "url": "https://files.pythonhosted.org/packages/bd/4d/40507e931780bd387c918f428e03efcbb1b70275e7b7a121292f9fe620c4/mongo-mail-server-0.1.0.zip", "yanked": false}], "0.1.1": [{"comment_text": "", "digests": {"md5": "19437c0eef9265b654ddf5bdc28de11f", "sha256": "9288a5426db54856c803578f4c3b55d9d42c43097e055d2c621c40961dce6d62"}, "downloads": -1, "filename": "mongo-mail-server-0.1.1.zip", "has_sig": false, "md5_digest": "19437c0eef9265b654ddf5bdc28de11f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 36927, "upload_time": "2015-05-03T07:16:53", "upload_time_iso_8601": "2015-05-03T07:16:53.415677Z", "url": "https://files.pythonhosted.org/packages/da/d6/814eb3358b5adab413f2dfe46d5ae3570364e35c22fd43d0bf2211ec54fc/mongo-mail-server-0.1.1.zip", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "19437c0eef9265b654ddf5bdc28de11f", "sha256": "9288a5426db54856c803578f4c3b55d9d42c43097e055d2c621c40961dce6d62"}, "downloads": -1, "filename": "mongo-mail-server-0.1.1.zip", "has_sig": false, "md5_digest": "19437c0eef9265b654ddf5bdc28de11f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 36927, "upload_time": "2015-05-03T07:16:53", "upload_time_iso_8601": "2015-05-03T07:16:53.415677Z", "url": "https://files.pythonhosted.org/packages/da/d6/814eb3358b5adab413f2dfe46d5ae3570364e35c22fd43d0bf2211ec54fc/mongo-mail-server-0.1.1.zip", "yanked": false}], "timestamp": "Fri May  8 00:52:16 2020"}