{"info": {"author": "howmp", "author_email": "zhaopeiyuan6@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "# pyminhook\n\n\u6b64\u5e93\u662f\u5bf9[minhook](https://github.com/TsudaKageyu/minhook/)\u7684python\u5305\u88c5\uff0c\u4ec5\u652f\u6301windows\u3002\n\n\u7528\u6cd5\u5982\u4e0b\n\n```py\nimport ctypes\nfrom ctypes import wintypes\nfrom minhook import *\nif __name__ == \"__main__\":\n\n    class TestHook(Hook):\n        prototype = ctypes.WINFUNCTYPE(wintypes.HANDLE, wintypes.LPCWSTR)\n        modname = 'kernel32'\n        apiname = 'GetModuleHandleW'\n\n        def detour(self, lpModuleName):\n            print('before hook param', lpModuleName)\n            ret = self.fp_orginal(lpModuleName)\n            print('after hook ret = %08X' % ret)\n            return ret\n\n    h = TestHook()\n    print('-' * 32)\n    print('call 1 ret = %08X' % h.fp_target('kernel32'))\n    print('-' * 32)\n    h.disable()\n    print('call 2 ret = %08X' % h.fp_target('ntdll'))\n    print('-' * 32)\n    h.enable()\n    print('call 3 ret = %08X' % h.fp_target('user32'))\n```\n\n\u8f93\u51fa\u5982\u4e0b:\n\n```txt\n--------------------------------\nbefore hook param kernel32\nafter hook ret = 7FF970430000\ncall 1 ret = 7FF970430000\n--------------------------------\ncall 2 ret = 7FF9718E0000\n--------------------------------\nbefore hook param user32\nafter hook ret = 7FF970120000\ncall 3 ret = 7FF970120000\n```\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/howmp/pyminhook", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "pyminhook", "package_url": "https://pypi.org/project/pyminhook/", "platform": "", "project_url": "https://pypi.org/project/pyminhook/", "project_urls": {"Homepage": "https://github.com/howmp/pyminhook"}, "release_url": "https://pypi.org/project/pyminhook/0.1/", "requires_dist": null, "requires_python": ">=3.7", "summary": "MinHook warp of Python", "version": "0.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>pyminhook</h1>\n<p>\u6b64\u5e93\u662f\u5bf9<a href=\"https://github.com/TsudaKageyu/minhook/\" rel=\"nofollow\">minhook</a>\u7684python\u5305\u88c5\uff0c\u4ec5\u652f\u6301windows\u3002</p>\n<p>\u7528\u6cd5\u5982\u4e0b</p>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">ctypes</span>\n<span class=\"kn\">from</span> <span class=\"nn\">ctypes</span> <span class=\"kn\">import</span> <span class=\"n\">wintypes</span>\n<span class=\"kn\">from</span> <span class=\"nn\">minhook</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s2\">\"__main__\"</span><span class=\"p\">:</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">TestHook</span><span class=\"p\">(</span><span class=\"n\">Hook</span><span class=\"p\">):</span>\n        <span class=\"n\">prototype</span> <span class=\"o\">=</span> <span class=\"n\">ctypes</span><span class=\"o\">.</span><span class=\"n\">WINFUNCTYPE</span><span class=\"p\">(</span><span class=\"n\">wintypes</span><span class=\"o\">.</span><span class=\"n\">HANDLE</span><span class=\"p\">,</span> <span class=\"n\">wintypes</span><span class=\"o\">.</span><span class=\"n\">LPCWSTR</span><span class=\"p\">)</span>\n        <span class=\"n\">modname</span> <span class=\"o\">=</span> <span class=\"s1\">'kernel32'</span>\n        <span class=\"n\">apiname</span> <span class=\"o\">=</span> <span class=\"s1\">'GetModuleHandleW'</span>\n\n        <span class=\"k\">def</span> <span class=\"nf\">detour</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">lpModuleName</span><span class=\"p\">):</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'before hook param'</span><span class=\"p\">,</span> <span class=\"n\">lpModuleName</span><span class=\"p\">)</span>\n            <span class=\"n\">ret</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fp_orginal</span><span class=\"p\">(</span><span class=\"n\">lpModuleName</span><span class=\"p\">)</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'after hook ret = </span><span class=\"si\">%08X</span><span class=\"s1\">'</span> <span class=\"o\">%</span> <span class=\"n\">ret</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">ret</span>\n\n    <span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">TestHook</span><span class=\"p\">()</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'-'</span> <span class=\"o\">*</span> <span class=\"mi\">32</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'call 1 ret = </span><span class=\"si\">%08X</span><span class=\"s1\">'</span> <span class=\"o\">%</span> <span class=\"n\">h</span><span class=\"o\">.</span><span class=\"n\">fp_target</span><span class=\"p\">(</span><span class=\"s1\">'kernel32'</span><span class=\"p\">))</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'-'</span> <span class=\"o\">*</span> <span class=\"mi\">32</span><span class=\"p\">)</span>\n    <span class=\"n\">h</span><span class=\"o\">.</span><span class=\"n\">disable</span><span class=\"p\">()</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'call 2 ret = </span><span class=\"si\">%08X</span><span class=\"s1\">'</span> <span class=\"o\">%</span> <span class=\"n\">h</span><span class=\"o\">.</span><span class=\"n\">fp_target</span><span class=\"p\">(</span><span class=\"s1\">'ntdll'</span><span class=\"p\">))</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'-'</span> <span class=\"o\">*</span> <span class=\"mi\">32</span><span class=\"p\">)</span>\n    <span class=\"n\">h</span><span class=\"o\">.</span><span class=\"n\">enable</span><span class=\"p\">()</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'call 3 ret = </span><span class=\"si\">%08X</span><span class=\"s1\">'</span> <span class=\"o\">%</span> <span class=\"n\">h</span><span class=\"o\">.</span><span class=\"n\">fp_target</span><span class=\"p\">(</span><span class=\"s1\">'user32'</span><span class=\"p\">))</span>\n</pre>\n<p>\u8f93\u51fa\u5982\u4e0b:</p>\n<pre>--------------------------------\nbefore hook param kernel32\nafter hook ret = 7FF970430000\ncall 1 ret = 7FF970430000\n--------------------------------\ncall 2 ret = 7FF9718E0000\n--------------------------------\nbefore hook param user32\nafter hook ret = 7FF970120000\ncall 3 ret = 7FF970120000\n</pre>\n\n          </div>"}, "last_serial": 6217163, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "d9d546c140e56dd06c0b46e57095be57", "sha256": "cc1738298e59abe60a76e46ea26210e0b5cf82bf6a16e7284925570d6befa348"}, "downloads": -1, "filename": "pyminhook-0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "d9d546c140e56dd06c0b46e57095be57", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 18686, "upload_time": "2019-11-29T08:19:48", "upload_time_iso_8601": "2019-11-29T08:19:48.656618Z", "url": "https://files.pythonhosted.org/packages/ed/ba/38cfdb0e1738ff14a75a2aecc1cb33c7d9da37f2ea5f325019848431024e/pyminhook-0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "3d8d3f7a0eaeca82c059585780dc1506", "sha256": "a9ae9cb63d403f9649e27fa85d9163648ed3dfb7bb35e73c8fbdde295a5a43fb"}, "downloads": -1, "filename": "pyminhook-0.1.tar.gz", "has_sig": false, "md5_digest": "3d8d3f7a0eaeca82c059585780dc1506", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 19422, "upload_time": "2019-11-29T08:19:51", "upload_time_iso_8601": "2019-11-29T08:19:51.195883Z", "url": "https://files.pythonhosted.org/packages/2b/db/cf2fa04d3ad1cf228ab8bcb5e9a6ed15c75acb4aab71d4db540f2339e8d7/pyminhook-0.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "d9d546c140e56dd06c0b46e57095be57", "sha256": "cc1738298e59abe60a76e46ea26210e0b5cf82bf6a16e7284925570d6befa348"}, "downloads": -1, "filename": "pyminhook-0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "d9d546c140e56dd06c0b46e57095be57", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 18686, "upload_time": "2019-11-29T08:19:48", "upload_time_iso_8601": "2019-11-29T08:19:48.656618Z", "url": "https://files.pythonhosted.org/packages/ed/ba/38cfdb0e1738ff14a75a2aecc1cb33c7d9da37f2ea5f325019848431024e/pyminhook-0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "3d8d3f7a0eaeca82c059585780dc1506", "sha256": "a9ae9cb63d403f9649e27fa85d9163648ed3dfb7bb35e73c8fbdde295a5a43fb"}, "downloads": -1, "filename": "pyminhook-0.1.tar.gz", "has_sig": false, "md5_digest": "3d8d3f7a0eaeca82c059585780dc1506", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 19422, "upload_time": "2019-11-29T08:19:51", "upload_time_iso_8601": "2019-11-29T08:19:51.195883Z", "url": "https://files.pythonhosted.org/packages/2b/db/cf2fa04d3ad1cf228ab8bcb5e9a6ed15c75acb4aab71d4db540f2339e8d7/pyminhook-0.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:02:05 2020"}