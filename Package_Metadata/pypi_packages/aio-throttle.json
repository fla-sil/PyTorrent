{"info": {"author": "Yury Pliner", "author_email": "yury.pliner@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "This library is inspired by [this book](https://landing.google.com/sre/sre-book/chapters/handling-overload/) and this implementation https://github.com/vostok/throttling.\n\nFeatures:\n1. Set capacity(max parallel requests) and queue(max queued requests) limits.\n1. Per-consumer limits. For instance, to not allow any consumer to use more than 70% of service's capacity.\n1. Per-request priorities. For instance, to not allow requests with lowest priority to be queued or to now allow requests with normal priority to use more than 90% of service's capacity. \n\nExample:\n```python\nfrom aio_throttle import Throttler, MaxFractionCapacityQuota, ThrottlePriority, ThrottleResult\n\ncapacity_limit = 100\nqueue_limit = 200\nconsumer_quotas = [MaxFractionCapacityQuota(0.7)]\npriority_quotas = [MaxFractionCapacityQuota(0.9, ThrottlePriority.NORMAL)]\nthrottler = Throttler(capacity_limit, queue_limit, consumer_quotas, priority_quotas)\n\nasync with throttler.throttle(consumer, priority) as result:\n    ... # check if result is ThrottleResult.ACCEPTED or not\n```\n\n\nExample of integration with `aiohttp`:\n```python\nfrom typing import Awaitable, Callable\n\nfrom aiohttp import web\nfrom aiohttp.web_middlewares import middleware\nfrom aiohttp.web_request import Request\nfrom aiohttp.web_response import StreamResponse\n\nfrom aio_throttle import Throttler, ThrottlePriority\n\nHandler = Callable[[Request], Awaitable[StreamResponse]]\n\n\n@middleware\nasync def middleware(request: Request, handler: Handler) -> StreamResponse:\n    throttler: Throttler = request.app['throttler']\n    service = request.headers.get('X-Service', 'UNKNOWN')\n    priority = ThrottlePriority(request.headers.get('X-Request-Priority', ThrottlePriority.NORMAL))\n    async with throttler.throttle(service, priority) as result:\n        if not result:\n            return web.Response(status=503)\n        return await handler(request)\n```\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/Pliner/aio-throttle", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "aio-throttle", "package_url": "https://pypi.org/project/aio-throttle/", "platform": "", "project_url": "https://pypi.org/project/aio-throttle/", "project_urls": {"Homepage": "https://github.com/Pliner/aio-throttle"}, "release_url": "https://pypi.org/project/aio-throttle/1.2.1/", "requires_dist": null, "requires_python": ">=3.7", "summary": "A simple throttling package", "version": "1.2.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p>This library is inspired by <a href=\"https://landing.google.com/sre/sre-book/chapters/handling-overload/\" rel=\"nofollow\">this book</a> and this implementation <a href=\"https://github.com/vostok/throttling\" rel=\"nofollow\">https://github.com/vostok/throttling</a>.</p>\n<p>Features:</p>\n<ol>\n<li>Set capacity(max parallel requests) and queue(max queued requests) limits.</li>\n<li>Per-consumer limits. For instance, to not allow any consumer to use more than 70% of service's capacity.</li>\n<li>Per-request priorities. For instance, to not allow requests with lowest priority to be queued or to now allow requests with normal priority to use more than 90% of service's capacity.</li>\n</ol>\n<p>Example:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">aio_throttle</span> <span class=\"kn\">import</span> <span class=\"n\">Throttler</span><span class=\"p\">,</span> <span class=\"n\">MaxFractionCapacityQuota</span><span class=\"p\">,</span> <span class=\"n\">ThrottlePriority</span><span class=\"p\">,</span> <span class=\"n\">ThrottleResult</span>\n\n<span class=\"n\">capacity_limit</span> <span class=\"o\">=</span> <span class=\"mi\">100</span>\n<span class=\"n\">queue_limit</span> <span class=\"o\">=</span> <span class=\"mi\">200</span>\n<span class=\"n\">consumer_quotas</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">MaxFractionCapacityQuota</span><span class=\"p\">(</span><span class=\"mf\">0.7</span><span class=\"p\">)]</span>\n<span class=\"n\">priority_quotas</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">MaxFractionCapacityQuota</span><span class=\"p\">(</span><span class=\"mf\">0.9</span><span class=\"p\">,</span> <span class=\"n\">ThrottlePriority</span><span class=\"o\">.</span><span class=\"n\">NORMAL</span><span class=\"p\">)]</span>\n<span class=\"n\">throttler</span> <span class=\"o\">=</span> <span class=\"n\">Throttler</span><span class=\"p\">(</span><span class=\"n\">capacity_limit</span><span class=\"p\">,</span> <span class=\"n\">queue_limit</span><span class=\"p\">,</span> <span class=\"n\">consumer_quotas</span><span class=\"p\">,</span> <span class=\"n\">priority_quotas</span><span class=\"p\">)</span>\n\n<span class=\"k\">async</span> <span class=\"k\">with</span> <span class=\"n\">throttler</span><span class=\"o\">.</span><span class=\"n\">throttle</span><span class=\"p\">(</span><span class=\"n\">consumer</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">result</span><span class=\"p\">:</span>\n    <span class=\"o\">...</span> <span class=\"c1\"># check if result is ThrottleResult.ACCEPTED or not</span>\n</pre>\n<p>Example of integration with <code>aiohttp</code>:</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Awaitable</span><span class=\"p\">,</span> <span class=\"n\">Callable</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">aiohttp</span> <span class=\"kn\">import</span> <span class=\"n\">web</span>\n<span class=\"kn\">from</span> <span class=\"nn\">aiohttp.web_middlewares</span> <span class=\"kn\">import</span> <span class=\"n\">middleware</span>\n<span class=\"kn\">from</span> <span class=\"nn\">aiohttp.web_request</span> <span class=\"kn\">import</span> <span class=\"n\">Request</span>\n<span class=\"kn\">from</span> <span class=\"nn\">aiohttp.web_response</span> <span class=\"kn\">import</span> <span class=\"n\">StreamResponse</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">aio_throttle</span> <span class=\"kn\">import</span> <span class=\"n\">Throttler</span><span class=\"p\">,</span> <span class=\"n\">ThrottlePriority</span>\n\n<span class=\"n\">Handler</span> <span class=\"o\">=</span> <span class=\"n\">Callable</span><span class=\"p\">[[</span><span class=\"n\">Request</span><span class=\"p\">],</span> <span class=\"n\">Awaitable</span><span class=\"p\">[</span><span class=\"n\">StreamResponse</span><span class=\"p\">]]</span>\n\n\n<span class=\"nd\">@middleware</span>\n<span class=\"k\">async</span> <span class=\"k\">def</span> <span class=\"nf\">middleware</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">:</span> <span class=\"n\">Request</span><span class=\"p\">,</span> <span class=\"n\">handler</span><span class=\"p\">:</span> <span class=\"n\">Handler</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">StreamResponse</span><span class=\"p\">:</span>\n    <span class=\"n\">throttler</span><span class=\"p\">:</span> <span class=\"n\">Throttler</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">app</span><span class=\"p\">[</span><span class=\"s1\">'throttler'</span><span class=\"p\">]</span>\n    <span class=\"n\">service</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">headers</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">'X-Service'</span><span class=\"p\">,</span> <span class=\"s1\">'UNKNOWN'</span><span class=\"p\">)</span>\n    <span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"n\">ThrottlePriority</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">headers</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">'X-Request-Priority'</span><span class=\"p\">,</span> <span class=\"n\">ThrottlePriority</span><span class=\"o\">.</span><span class=\"n\">NORMAL</span><span class=\"p\">))</span>\n    <span class=\"k\">async</span> <span class=\"k\">with</span> <span class=\"n\">throttler</span><span class=\"o\">.</span><span class=\"n\">throttle</span><span class=\"p\">(</span><span class=\"n\">service</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">result</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">result</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">web</span><span class=\"o\">.</span><span class=\"n\">Response</span><span class=\"p\">(</span><span class=\"n\">status</span><span class=\"o\">=</span><span class=\"mi\">503</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"k\">await</span> <span class=\"n\">handler</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n</pre>\n\n          </div>"}, "last_serial": 6053815, "releases": {"1.0.0": [{"comment_text": "", "digests": {"md5": "17bdb1f3de7183eea2e1c2a4e4df9cd7", "sha256": "b0d8c29b2a448ff811b21f8b0051f18a6fa7b2537656abd7741c446a0243b98c"}, "downloads": -1, "filename": "aio_throttle-1.0.0-py3-none-any.whl", "has_sig": false, "md5_digest": "17bdb1f3de7183eea2e1c2a4e4df9cd7", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 5940, "upload_time": "2019-09-21T08:55:57", "upload_time_iso_8601": "2019-09-21T08:55:57.039476Z", "url": "https://files.pythonhosted.org/packages/56/55/cc9d09d2996761647814946827fb32a44ff0d97aac3a89dc40830da0cd69/aio_throttle-1.0.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "c60d98ac54665db311b1a466afc0934d", "sha256": "c1949acaa580905ebd002c6473389ca425ec222db807c821931d041d07e3d36c"}, "downloads": -1, "filename": "aio-throttle-1.0.0.tar.gz", "has_sig": false, "md5_digest": "c60d98ac54665db311b1a466afc0934d", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 3981, "upload_time": "2019-09-21T08:55:59", "upload_time_iso_8601": "2019-09-21T08:55:59.222342Z", "url": "https://files.pythonhosted.org/packages/00/6a/8cc683cd33028f9eaa8b33ea39b325a917664e4da1a37644b9187915c57f/aio-throttle-1.0.0.tar.gz", "yanked": false}], "1.0.1": [{"comment_text": "", "digests": {"md5": "238bc117cb379bb89fcf2eccf883d1c2", "sha256": "e2ffd76ed2c31461e1c5ea6d069ebddb575e19c3813509819ae099f6a159fc0f"}, "downloads": -1, "filename": "aio_throttle-1.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "238bc117cb379bb89fcf2eccf883d1c2", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 6001, "upload_time": "2019-10-28T18:29:24", "upload_time_iso_8601": "2019-10-28T18:29:24.731310Z", "url": "https://files.pythonhosted.org/packages/3a/d9/412b7bf7972b61df142eac23b7b03ff16b62827473614fa3bf7e0d7234bb/aio_throttle-1.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "f6a58cf019b11e85db1d3b81a4241e98", "sha256": "6a46232480cf48c66ff094ea267fdff6774b62ceac5078b0cc1a93479ba38b4f"}, "downloads": -1, "filename": "aio-throttle-1.0.1.tar.gz", "has_sig": false, "md5_digest": "f6a58cf019b11e85db1d3b81a4241e98", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 4101, "upload_time": "2019-10-28T18:29:27", "upload_time_iso_8601": "2019-10-28T18:29:27.215787Z", "url": "https://files.pythonhosted.org/packages/34/71/8cabf5b47d3801f62e0ac4ba615632dcbe14e203f1dbec63e91cd602910c/aio-throttle-1.0.1.tar.gz", "yanked": false}], "1.1.0": [{"comment_text": "", "digests": {"md5": "fa2f0a55897db3bae7c5389f7d777cff", "sha256": "d0b0b577fd62ad80361076648cff94823b321787fdb5d74b6448ae455c48feec"}, "downloads": -1, "filename": "aio_throttle-1.1.0-py3-none-any.whl", "has_sig": false, "md5_digest": "fa2f0a55897db3bae7c5389f7d777cff", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 6020, "upload_time": "2019-10-30T10:05:18", "upload_time_iso_8601": "2019-10-30T10:05:18.893521Z", "url": "https://files.pythonhosted.org/packages/45/8f/9bbf3da60a63bd16bcb84c305f5546de64e4f6e5531bef99090d4f969190/aio_throttle-1.1.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "c8de0dd07e9319d224768e65e85282ea", "sha256": "8a1b4bd60ee86efe340797551751df0c3618cf9f7513d0e4f627a906318a2126"}, "downloads": -1, "filename": "aio-throttle-1.1.0.tar.gz", "has_sig": false, "md5_digest": "c8de0dd07e9319d224768e65e85282ea", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 4135, "upload_time": "2019-10-30T10:05:20", "upload_time_iso_8601": "2019-10-30T10:05:20.703506Z", "url": "https://files.pythonhosted.org/packages/84/18/eb8d53e3e504da5850ee004f1ca2b7d966f415e59e1210f9b3c6b1b244d6/aio-throttle-1.1.0.tar.gz", "yanked": false}], "1.2.0": [{"comment_text": "", "digests": {"md5": "23d6097c2cc0b328aef906c6b1d4ed5a", "sha256": "3032821855bb82b6a9ae03af3499e6fafa094e917bb60595f2df2945730b50ef"}, "downloads": -1, "filename": "aio_throttle-1.2.0-py3-none-any.whl", "has_sig": false, "md5_digest": "23d6097c2cc0b328aef906c6b1d4ed5a", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 6009, "upload_time": "2019-10-30T16:51:22", "upload_time_iso_8601": "2019-10-30T16:51:22.872393Z", "url": "https://files.pythonhosted.org/packages/77/60/cd8c918770db5ad81c1e93f0842189264fef8750ac5d2b88e98d8a01a569/aio_throttle-1.2.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "717a9a567de84158900af199e564798c", "sha256": "b49fe27d45affe884b53ba59bae3a7c51e8f5830592bd4342ab723b4adf5fc7b"}, "downloads": -1, "filename": "aio-throttle-1.2.0.tar.gz", "has_sig": false, "md5_digest": "717a9a567de84158900af199e564798c", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 4117, "upload_time": "2019-10-30T16:51:26", "upload_time_iso_8601": "2019-10-30T16:51:26.609919Z", "url": "https://files.pythonhosted.org/packages/ad/b7/3eda8555bd5b55a318073b12077d1df98f662e8cffdfa2fddc30190ced66/aio-throttle-1.2.0.tar.gz", "yanked": false}], "1.2.1": [{"comment_text": "", "digests": {"md5": "93e0fb01c6a555a86aa9147c0f6a18b4", "sha256": "28ffac30d3b25296f0e5ab6a018c49f1bcc6855562d6e5a899cb1231bf287240"}, "downloads": -1, "filename": "aio_throttle-1.2.1-py3-none-any.whl", "has_sig": false, "md5_digest": "93e0fb01c6a555a86aa9147c0f6a18b4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 6074, "upload_time": "2019-10-30T17:18:02", "upload_time_iso_8601": "2019-10-30T17:18:02.964728Z", "url": "https://files.pythonhosted.org/packages/f2/a0/449b74591bb3369ad0ec13b448e9a62ad1f48dc4a7ab47147baeea4b4c9b/aio_throttle-1.2.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "8e62acd41b042a928f34da6fc6cb1936", "sha256": "e1780409295b0c6938a5979ce0c3c61b2ed3db96734c4e924316ff16daa562f9"}, "downloads": -1, "filename": "aio-throttle-1.2.1.tar.gz", "has_sig": false, "md5_digest": "8e62acd41b042a928f34da6fc6cb1936", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 4179, "upload_time": "2019-10-30T17:18:04", "upload_time_iso_8601": "2019-10-30T17:18:04.229292Z", "url": "https://files.pythonhosted.org/packages/d3/3f/fa6f60fc626b32b658666ff7b0d1ee465c689e9db337e23243a3a55d12ad/aio-throttle-1.2.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "93e0fb01c6a555a86aa9147c0f6a18b4", "sha256": "28ffac30d3b25296f0e5ab6a018c49f1bcc6855562d6e5a899cb1231bf287240"}, "downloads": -1, "filename": "aio_throttle-1.2.1-py3-none-any.whl", "has_sig": false, "md5_digest": "93e0fb01c6a555a86aa9147c0f6a18b4", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.7", "size": 6074, "upload_time": "2019-10-30T17:18:02", "upload_time_iso_8601": "2019-10-30T17:18:02.964728Z", "url": "https://files.pythonhosted.org/packages/f2/a0/449b74591bb3369ad0ec13b448e9a62ad1f48dc4a7ab47147baeea4b4c9b/aio_throttle-1.2.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "8e62acd41b042a928f34da6fc6cb1936", "sha256": "e1780409295b0c6938a5979ce0c3c61b2ed3db96734c4e924316ff16daa562f9"}, "downloads": -1, "filename": "aio-throttle-1.2.1.tar.gz", "has_sig": false, "md5_digest": "8e62acd41b042a928f34da6fc6cb1936", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7", "size": 4179, "upload_time": "2019-10-30T17:18:04", "upload_time_iso_8601": "2019-10-30T17:18:04.229292Z", "url": "https://files.pythonhosted.org/packages/d3/3f/fa6f60fc626b32b658666ff7b0d1ee465c689e9db337e23243a3a55d12ad/aio-throttle-1.2.1.tar.gz", "yanked": false}], "timestamp": "Thu May  7 16:20:41 2020"}