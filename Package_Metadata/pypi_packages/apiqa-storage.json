{"info": {"author": "pik-software", "author_email": "no-reply@pik-software.ru", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Intended Audience :: Developers", "License :: OSI Approved :: MIT License", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7", "Topic :: Software Development"], "description": "# apiqa-storage #\n\nThis project aim is to provide user storage backend on minio\nfor all apiqa django projects.\n\n## HowToUse ##\n\n* Add `apiqa-storage` to `requirements.txt`.\n\n```\n# Minio file storage\ngit+https://github.com/pik-software/apiqa-storage.git#egg=apiqa-storage\n```\n\n* Add `apiqa_storage` to `INSTALLED_APPS` in settings file.\n\n```python\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    ...,\n    'apiqa_storage'\n]\n```\n\n* Add mixin `ModelWithAttachmentsMixin` to any model. Make and run migrations.\n\n```python\nfrom apiqa_storage.models import ModelWithAttachmentsMixin\n\nclass UserFile(ModelWithAttachmentsMixin, ...):\n    ...\n```\n\n* Add serializer mixin at the beginning and add `attachments`,\n `attachment_ids` to fields.\n\n```python\nfrom apiqa_storage.serializers import AttachmentsSerializerMixin\n\nclass ModelWithAttachmentsSerializer(AttachmentsSerializerMixin, ...):\n    ...\n\n    class Meta:\n        ...\n        fields = (..., 'attachments', 'attachment_ids')\n```\n\n* Add download and upload file urls to urlpatterns.\n\n```python\nfrom django.urls import path, include\n\nurlpatterns = [\n    path('attachments/', include('apiqa_storage.urls')),\n]\n```\n\n* Or add staff download file url to urlpatterns.\n\n```python\nfrom django.urls import path, include\n\nurlpatterns = [  # noqa\n    path('attachments/', include('apiqa_storage.staff_urls')),\n]\n```\n\n* Add clean files task to celery beat config.\n\n```python\nfrom celery.schedules import crontab\nbeat_schedule = {\n    # apiqa-storage clean files\n    'purge_attachments': {\n        'task': 'apiqa_storage.tasks.purge_attachments',\n        'schedule': crontab(hour=5)\n    },\n}\n```\n\n* Add required minio settings. Create bucket on minio!\n[django minio storage usage](https://django-minio-storage.readthedocs.io/en/latest/usage/)\n\n```python\nMINIO_STORAGE_ENDPOINT = 'minio:9000'\nMINIO_STORAGE_ACCESS_KEY = ...\nMINIO_STORAGE_SECRET_KEY = ...\nMINIO_STORAGE_BUCKET_NAME = 'local-static'\n```\n* Other settings\n  * **MINIO_STORAGE_MAX_FILE_SIZE**: File size limit for upload, humanfriendly value. \n  See https://humanfriendly.readthedocs.io/en/latest/readme.html#a-note-about-size-units. Default 100M\n  * **MINIO_STORAGE_MAX_FILE_NAME_LEN**: File name length limit. Use for database char limit. Default 100\n  * **MINIO_STORAGE_MAX_FILES_COUNT**: Limit of files in one object. For example 5 files in ticket. None - is unlimited. Default None\n  * **MINIO_STORAGE_USE_HTTPS**: Use https for connect to minio. Default False\n  * **MINIO_STORAGE_CLEAN_PERIOD**: Delete files without related objects after N days. Default 30\n\n* Run test\n\n```bash\npip install -r requirements.txt\npip install -r requirements.dev.txt\ndocker-compose up\npytest --cov .\n```\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/pik-software/apiqa-storage.git", "keywords": "apiqo django", "license": "", "maintainer": "", "maintainer_email": "", "name": "apiqa-storage", "package_url": "https://pypi.org/project/apiqa-storage/", "platform": "", "project_url": "https://pypi.org/project/apiqa-storage/", "project_urls": {"Bug Reports": "https://gitlab.pik-software.ru/apiqa/apiqa-storage/issues", "Funding": "https://gitlab.pik-software.ru/apiqa/apiqa-storage", "Homepage": "https://github.com/pik-software/apiqa-storage.git", "Say Thanks!": "https://saythanks.io/to/pik_software", "Source": "https://gitlab.pik-software.ru/apiqa/apiqa-storage"}, "release_url": "https://pypi.org/project/apiqa-storage/2.7/", "requires_dist": ["django (>=2.1)", "djangorestframework (>=3.9)", "humanfriendly (>=4.18)", "python-slugify (>=1.2.6)", "minio (==5.0.6)", "celery", "responses (==0.10.5) ; extra == 'dev'", "prospector (==1.1.4) ; extra == 'dev'", "pycodestyle (<2.4.0,>=2.0.0) ; extra == 'dev'", "pylint-django (==0.9.4) ; extra == 'dev'", "pylint (==2.1.1) ; extra == 'dev'", "factory-boy ; extra == 'dev'", "freezegun (==0.3.10) ; extra == 'dev'", "pdbpp (==0.9.2) ; extra == 'dev'", "pytest-xdist (==1.22.2) ; extra == 'dev'", "pytest (==3.8.2) ; extra == 'dev'", "pytest-cov (==2.5.1) ; extra == 'dev'", "pytest-django (==3.4.3) ; extra == 'dev'", "pytest-benchmark (==3.1.1) ; extra == 'dev'", "pytest-mock (==1.9.0) ; extra == 'dev'", "mypy (>=0.600) ; extra == 'dev'", "psycopg2-binary (==2.7.5) ; extra == 'dev'", "dj-database-url (==0.4.2) ; extra == 'dev'", "twine (>=3.1.1) ; extra == 'dev'"], "requires_python": "~=3.6", "summary": "Apiqa user storage backend for django projects", "version": "2.7", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>apiqa-storage</h1>\n<p>This project aim is to provide user storage backend on minio\nfor all apiqa django projects.</p>\n<h2>HowToUse</h2>\n<ul>\n<li>Add <code>apiqa-storage</code> to <code>requirements.txt</code>.</li>\n</ul>\n<pre><code># Minio file storage\ngit+https://github.com/pik-software/apiqa-storage.git#egg=apiqa-storage\n</code></pre>\n<ul>\n<li>Add <code>apiqa_storage</code> to <code>INSTALLED_APPS</code> in settings file.</li>\n</ul>\n<pre><span class=\"n\">INSTALLED_APPS</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"s1\">'django.contrib.admin'</span><span class=\"p\">,</span>\n    <span class=\"o\">...</span><span class=\"p\">,</span>\n    <span class=\"s1\">'apiqa_storage'</span>\n<span class=\"p\">]</span>\n</pre>\n<ul>\n<li>Add mixin <code>ModelWithAttachmentsMixin</code> to any model. Make and run migrations.</li>\n</ul>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">apiqa_storage.models</span> <span class=\"kn\">import</span> <span class=\"n\">ModelWithAttachmentsMixin</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">UserFile</span><span class=\"p\">(</span><span class=\"n\">ModelWithAttachmentsMixin</span><span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">):</span>\n    <span class=\"o\">...</span>\n</pre>\n<ul>\n<li>Add serializer mixin at the beginning and add <code>attachments</code>,\n<code>attachment_ids</code> to fields.</li>\n</ul>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">apiqa_storage.serializers</span> <span class=\"kn\">import</span> <span class=\"n\">AttachmentsSerializerMixin</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">ModelWithAttachmentsSerializer</span><span class=\"p\">(</span><span class=\"n\">AttachmentsSerializerMixin</span><span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">):</span>\n    <span class=\"o\">...</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"o\">...</span>\n        <span class=\"n\">fields</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"s1\">'attachments'</span><span class=\"p\">,</span> <span class=\"s1\">'attachment_ids'</span><span class=\"p\">)</span>\n</pre>\n<ul>\n<li>Add download and upload file urls to urlpatterns.</li>\n</ul>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django.urls</span> <span class=\"kn\">import</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">include</span>\n\n<span class=\"n\">urlpatterns</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s1\">'attachments/'</span><span class=\"p\">,</span> <span class=\"n\">include</span><span class=\"p\">(</span><span class=\"s1\">'apiqa_storage.urls'</span><span class=\"p\">)),</span>\n<span class=\"p\">]</span>\n</pre>\n<ul>\n<li>Or add staff download file url to urlpatterns.</li>\n</ul>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django.urls</span> <span class=\"kn\">import</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">include</span>\n\n<span class=\"n\">urlpatterns</span> <span class=\"o\">=</span> <span class=\"p\">[</span>  <span class=\"c1\"># noqa</span>\n    <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s1\">'attachments/'</span><span class=\"p\">,</span> <span class=\"n\">include</span><span class=\"p\">(</span><span class=\"s1\">'apiqa_storage.staff_urls'</span><span class=\"p\">)),</span>\n<span class=\"p\">]</span>\n</pre>\n<ul>\n<li>Add clean files task to celery beat config.</li>\n</ul>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">celery.schedules</span> <span class=\"kn\">import</span> <span class=\"n\">crontab</span>\n<span class=\"n\">beat_schedule</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"c1\"># apiqa-storage clean files</span>\n    <span class=\"s1\">'purge_attachments'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s1\">'task'</span><span class=\"p\">:</span> <span class=\"s1\">'apiqa_storage.tasks.purge_attachments'</span><span class=\"p\">,</span>\n        <span class=\"s1\">'schedule'</span><span class=\"p\">:</span> <span class=\"n\">crontab</span><span class=\"p\">(</span><span class=\"n\">hour</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n    <span class=\"p\">},</span>\n<span class=\"p\">}</span>\n</pre>\n<ul>\n<li>Add required minio settings. Create bucket on minio!\n<a href=\"https://django-minio-storage.readthedocs.io/en/latest/usage/\" rel=\"nofollow\">django minio storage usage</a></li>\n</ul>\n<pre><span class=\"n\">MINIO_STORAGE_ENDPOINT</span> <span class=\"o\">=</span> <span class=\"s1\">'minio:9000'</span>\n<span class=\"n\">MINIO_STORAGE_ACCESS_KEY</span> <span class=\"o\">=</span> <span class=\"o\">...</span>\n<span class=\"n\">MINIO_STORAGE_SECRET_KEY</span> <span class=\"o\">=</span> <span class=\"o\">...</span>\n<span class=\"n\">MINIO_STORAGE_BUCKET_NAME</span> <span class=\"o\">=</span> <span class=\"s1\">'local-static'</span>\n</pre>\n<ul>\n<li>\n<p>Other settings</p>\n<ul>\n<li><strong>MINIO_STORAGE_MAX_FILE_SIZE</strong>: File size limit for upload, humanfriendly value.\nSee <a href=\"https://humanfriendly.readthedocs.io/en/latest/readme.html#a-note-about-size-units\" rel=\"nofollow\">https://humanfriendly.readthedocs.io/en/latest/readme.html#a-note-about-size-units</a>. Default 100M</li>\n<li><strong>MINIO_STORAGE_MAX_FILE_NAME_LEN</strong>: File name length limit. Use for database char limit. Default 100</li>\n<li><strong>MINIO_STORAGE_MAX_FILES_COUNT</strong>: Limit of files in one object. For example 5 files in ticket. None - is unlimited. Default None</li>\n<li><strong>MINIO_STORAGE_USE_HTTPS</strong>: Use https for connect to minio. Default False</li>\n<li><strong>MINIO_STORAGE_CLEAN_PERIOD</strong>: Delete files without related objects after N days. Default 30</li>\n</ul>\n</li>\n<li>\n<p>Run test</p>\n</li>\n</ul>\n<pre>pip install -r requirements.txt\npip install -r requirements.dev.txt\ndocker-compose up\npytest --cov .\n</pre>\n\n          </div>"}, "last_serial": 7118506, "releases": {"2.5.3": [{"comment_text": "", "digests": {"md5": "5b5bd0fd32bb05775429bc8f37617746", "sha256": "f5094038d0ab5bc93ad7fac425ee826f2640719d8aa81e71566bd7719e916512"}, "downloads": -1, "filename": "apiqa_storage-2.5.3-py3-none-any.whl", "has_sig": false, "md5_digest": "5b5bd0fd32bb05775429bc8f37617746", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": "~=3.6", "size": 14550, "upload_time": "2020-01-17T08:28:50", "upload_time_iso_8601": "2020-01-17T08:28:50.924972Z", "url": "https://files.pythonhosted.org/packages/65/ba/b36fb0a32e1e6626332af12a625592370bfd357d6709bb717a744749006e/apiqa_storage-2.5.3-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "3003a809805199f89f08f3a8cf7c3446", "sha256": "f40f34cd46118551528f6b7d62137ead03c5b6303424b720c07a7f7b3d6e879a"}, "downloads": -1, "filename": "apiqa-storage-2.5.3.tar.gz", "has_sig": false, "md5_digest": "3003a809805199f89f08f3a8cf7c3446", "packagetype": "sdist", "python_version": "source", "requires_python": "~=3.6", "size": 10067, "upload_time": "2020-01-17T08:29:39", "upload_time_iso_8601": "2020-01-17T08:29:39.958981Z", "url": "https://files.pythonhosted.org/packages/71/d4/bd4a5a5557399f284f0c53a670b2c78b570ccc16589cfd9fa6af8f29fbf8/apiqa-storage-2.5.3.tar.gz", "yanked": false}], "2.5.4": [{"comment_text": "", "digests": {"md5": "6f3900aa0ac21b020d457405dced0383", "sha256": "6e5e7ea6427264efcbe435ad4cdc7dddd145af02f2262df53e5b68bf5cf2c722"}, "downloads": -1, "filename": "apiqa_storage-2.5.4-py3-none-any.whl", "has_sig": false, "md5_digest": "6f3900aa0ac21b020d457405dced0383", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": "~=3.6", "size": 14549, "upload_time": "2020-01-17T08:28:53", "upload_time_iso_8601": "2020-01-17T08:28:53.919251Z", "url": "https://files.pythonhosted.org/packages/91/44/dd27978964da702c03f3909cf513003f1004b2cc8aef4c68502d613a745d/apiqa_storage-2.5.4-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "380ab2f9bf13cbe6226cf7f4febbc509", "sha256": "4b91207eb6ce264fbfbd2b099442ec0c3452964a69fccb22c77a0ac08e8fc28b"}, "downloads": -1, "filename": "apiqa-storage-2.5.4.tar.gz", "has_sig": false, "md5_digest": "380ab2f9bf13cbe6226cf7f4febbc509", "packagetype": "sdist", "python_version": "source", "requires_python": "~=3.6", "size": 10072, "upload_time": "2020-01-17T08:29:41", "upload_time_iso_8601": "2020-01-17T08:29:41.394871Z", "url": "https://files.pythonhosted.org/packages/22/3c/1b7970d8f07853f17e7c4aea869e42d498aff2754ce9617a7bdba7ec98fb/apiqa-storage-2.5.4.tar.gz", "yanked": false}], "2.6": [{"comment_text": "", "digests": {"md5": "3016429aea579ad78b053e1bbceac633", "sha256": "d37c0700d938beb3be53450ea8b9b57b8ab5b931088572c9b468dae7721a66d3"}, "downloads": -1, "filename": "apiqa_storage-2.6-py3-none-any.whl", "has_sig": false, "md5_digest": "3016429aea579ad78b053e1bbceac633", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": "~=3.6", "size": 16885, "upload_time": "2020-02-06T10:40:54", "upload_time_iso_8601": "2020-02-06T10:40:54.720463Z", "url": "https://files.pythonhosted.org/packages/0e/07/7f5e23a29b77b500b00ea4f2c4811a0362d6f1081d8d379a73da7e122013/apiqa_storage-2.6-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "9b06bb6419df3321cca76de7d84e7877", "sha256": "fcbc8912d9bdc435c549a678a3e388d8b966a17ee92f76165a83da87f5d83171"}, "downloads": -1, "filename": "apiqa-storage-2.6.tar.gz", "has_sig": false, "md5_digest": "9b06bb6419df3321cca76de7d84e7877", "packagetype": "sdist", "python_version": "source", "requires_python": "~=3.6", "size": 11772, "upload_time": "2020-02-06T10:40:57", "upload_time_iso_8601": "2020-02-06T10:40:57.969125Z", "url": "https://files.pythonhosted.org/packages/fa/2e/fc82d85e6c7b2bcb53808d741004efed56f55819f17dfef8c15478e94f91/apiqa-storage-2.6.tar.gz", "yanked": false}], "2.7": [{"comment_text": "", "digests": {"md5": "4e58dd751c4d5851b48f5357959a8efe", "sha256": "e3f264826c30fc58faefcb984cd8abd4a38bc5c766c6b28f4ea498ef5466cfef"}, "downloads": -1, "filename": "apiqa_storage-2.7-py3-none-any.whl", "has_sig": false, "md5_digest": "4e58dd751c4d5851b48f5357959a8efe", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": "~=3.6", "size": 17609, "upload_time": "2020-04-28T09:07:04", "upload_time_iso_8601": "2020-04-28T09:07:04.578901Z", "url": "https://files.pythonhosted.org/packages/a4/09/e6bd053a64a096e289fa0f91c628d0f6de8349f22604260485e406aa8323/apiqa_storage-2.7-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "0b55727f3d8d2ffa23bb69e6036f939b", "sha256": "36b5e8e36feaca38ee5df894cbedf19c49843d4a48a71647bad78c767198d77c"}, "downloads": -1, "filename": "apiqa-storage-2.7.tar.gz", "has_sig": false, "md5_digest": "0b55727f3d8d2ffa23bb69e6036f939b", "packagetype": "sdist", "python_version": "source", "requires_python": "~=3.6", "size": 12076, "upload_time": "2020-04-28T09:07:08", "upload_time_iso_8601": "2020-04-28T09:07:08.532436Z", "url": "https://files.pythonhosted.org/packages/f5/33/7f4c0ad5244531cf793c58d3770d19bff05a74ba5100c54d633724da82bb/apiqa-storage-2.7.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "4e58dd751c4d5851b48f5357959a8efe", "sha256": "e3f264826c30fc58faefcb984cd8abd4a38bc5c766c6b28f4ea498ef5466cfef"}, "downloads": -1, "filename": "apiqa_storage-2.7-py3-none-any.whl", "has_sig": false, "md5_digest": "4e58dd751c4d5851b48f5357959a8efe", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": "~=3.6", "size": 17609, "upload_time": "2020-04-28T09:07:04", "upload_time_iso_8601": "2020-04-28T09:07:04.578901Z", "url": "https://files.pythonhosted.org/packages/a4/09/e6bd053a64a096e289fa0f91c628d0f6de8349f22604260485e406aa8323/apiqa_storage-2.7-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "0b55727f3d8d2ffa23bb69e6036f939b", "sha256": "36b5e8e36feaca38ee5df894cbedf19c49843d4a48a71647bad78c767198d77c"}, "downloads": -1, "filename": "apiqa-storage-2.7.tar.gz", "has_sig": false, "md5_digest": "0b55727f3d8d2ffa23bb69e6036f939b", "packagetype": "sdist", "python_version": "source", "requires_python": "~=3.6", "size": 12076, "upload_time": "2020-04-28T09:07:08", "upload_time_iso_8601": "2020-04-28T09:07:08.532436Z", "url": "https://files.pythonhosted.org/packages/f5/33/7f4c0ad5244531cf793c58d3770d19bff05a74ba5100c54d633724da82bb/apiqa-storage-2.7.tar.gz", "yanked": false}], "timestamp": "Thu May  7 18:17:47 2020"}