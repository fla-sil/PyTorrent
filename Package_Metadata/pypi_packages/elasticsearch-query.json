{"info": {"author": "Maciej Brencz", "author_email": "macbre@wikia-inc.com", "bugtrack_url": null, "classifiers": [], "description": "elasticsearch-query\n===================\n\n[![PyPI](https://img.shields.io/pypi/v/elasticsearch-query.svg)](https://pypi.python.org/pypi/elasticsearch-query)\n[![Build Status](https://travis-ci.org/macbre/elasticsearch-query.svg?branch=master)](https://travis-ci.org/macbre/elasticsearch-query)\n\nRun queries against Kibana's Elasticsearch that gets logs from Logstash. Forked from [Wikia's `kibana.py`](https://github.com/Wikia/python-commons/blob/master/wikia/common/kibana/kibana.py).\n\n```\npip install elasticsearch-query\n```\n\n## Basic Usage\n\n```python\nfrom elasticsearch_query import ElasticsearchQuery\nes_query = ElasticsearchQuery(es_host='es.prod', since=12345, period=900, index_prefix='logstash-my-app')\n```\n\n`es_host` needs to be specified with a host of Elasticsearch instance to connect.\n\nProvide either `since` (absolute timestamp) or `period` (last N seconds):\n\n* `since`: UNIX timestamp data should be fetched since (if None, then period specifies the last n seconds).\n* `period`: period (in seconds) before now() to be used when since is empty (defaults to last 15 minutes).\n\n`index_prefix` argument will be used to build indices names to query in.\nThey should follow the `index-name-YYYY.MM.DD` naming convention, e.g. `logstash-my-app-2014.08.19`.\n\n### `get_rows`\n\n> Returns data matching the given query (provided as a `dict`).\n\n```python\nes_query.get_rows(match={\"tags\": 'edge-cache-requestmessage'}, limit=2000)\n```\n\n* `match`: query to be run against log messages (ex. {\"@message\": \"Foo Bar DB queries\"}).\n* `limit`: the number of results (defaults to 10).\n\n### `query_by_string`\n\n> Returns data matching the given query string (provided as a [Lucene query](https://lucene.apache.org/core/2_9_4/queryparsersyntax.html)).\n\n```python\nes_query.query_by_string(query='@message:\"^PHP Fatal\"', limit=2000)\nes_query.query_by_string(query='@message:\"^PHP Fatal\"', fields=['@message', '@es_query_host'], limit=2000)\n```\n\n* `query`: query string to be run against log messages (ex. `@message:\"^PHP Fatal\"`).\n* `fields`: optional list of fields to fetch\n* `limit`: the number of results (defaults to 10).\n\n### `query_by_sql`\n\n> Returns data matching the given [SQL query](https://www.elastic.co/guide/en/elasticsearch/reference/current/sql-commands.html).\n\nThis feature [requires](https://www.elastic.co/blog/opening-x-pack-phase-1-complete) **non-OSS version** of Elasticsearch (\"To be clear, while the X-Pack source code is now available in the public repositories, it isn\u2019t under an Open Source license\").\n\n```python\nes_query.query_by_sql(sql='SELECT host FROM \"app-requests\" WHERE host = \\'app2.prod\\'')\n```\n\n* `sql`: [SQL query](https://www.elastic.co/guide/en/elasticsearch/reference/current/sql-commands.html) to be run\n\n### `count`\n\n> Returns number of matching entries\n\n```python\nes_query.count(query='@message:\"^PHP Fatal\"')\n```\n\n## Integration tests\n\n`elasticsearch-query` comes with integration tests suite. `.travis.yml` will install elasticsearch OSS version and run them.\n\nBut you can also run it locally. Simply pass `ES_TEST_HOST=<elasticsearch IP>` env variable when running tests (`make test`).", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/macbre/elasticsearch-query", "keywords": "logstash kibana elasticsearch logging", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "elasticsearch-query", "package_url": "https://pypi.org/project/elasticsearch-query/", "platform": "", "project_url": "https://pypi.org/project/elasticsearch-query/", "project_urls": {"Homepage": "https://github.com/macbre/elasticsearch-query"}, "release_url": "https://pypi.org/project/elasticsearch-query/2.4.0/", "requires_dist": null, "requires_python": "", "summary": "Run queries against Kibana's Elasticsearch that gets logs from Logstash.", "version": "2.4.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>elasticsearch-query</h1>\n<p><a href=\"https://pypi.python.org/pypi/elasticsearch-query\" rel=\"nofollow\"><img alt=\"PyPI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/3042a70ac80c07659810aba1977d5d2e2a6ff79b/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f656c61737469637365617263682d71756572792e737667\"></a>\n<a href=\"https://travis-ci.org/macbre/elasticsearch-query\" rel=\"nofollow\"><img alt=\"Build Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/5daf9aac93adc586c7037ad7a00fd38c721708cc/68747470733a2f2f7472617669732d63692e6f72672f6d61636272652f656c61737469637365617263682d71756572792e7376673f6272616e63683d6d6173746572\"></a></p>\n<p>Run queries against Kibana's Elasticsearch that gets logs from Logstash. Forked from <a href=\"https://github.com/Wikia/python-commons/blob/master/wikia/common/kibana/kibana.py\" rel=\"nofollow\">Wikia's <code>kibana.py</code></a>.</p>\n<pre><code>pip install elasticsearch-query\n</code></pre>\n<h2>Basic Usage</h2>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">elasticsearch_query</span> <span class=\"kn\">import</span> <span class=\"n\">ElasticsearchQuery</span>\n<span class=\"n\">es_query</span> <span class=\"o\">=</span> <span class=\"n\">ElasticsearchQuery</span><span class=\"p\">(</span><span class=\"n\">es_host</span><span class=\"o\">=</span><span class=\"s1\">'es.prod'</span><span class=\"p\">,</span> <span class=\"n\">since</span><span class=\"o\">=</span><span class=\"mi\">12345</span><span class=\"p\">,</span> <span class=\"n\">period</span><span class=\"o\">=</span><span class=\"mi\">900</span><span class=\"p\">,</span> <span class=\"n\">index_prefix</span><span class=\"o\">=</span><span class=\"s1\">'logstash-my-app'</span><span class=\"p\">)</span>\n</pre>\n<p><code>es_host</code> needs to be specified with a host of Elasticsearch instance to connect.</p>\n<p>Provide either <code>since</code> (absolute timestamp) or <code>period</code> (last N seconds):</p>\n<ul>\n<li><code>since</code>: UNIX timestamp data should be fetched since (if None, then period specifies the last n seconds).</li>\n<li><code>period</code>: period (in seconds) before now() to be used when since is empty (defaults to last 15 minutes).</li>\n</ul>\n<p><code>index_prefix</code> argument will be used to build indices names to query in.\nThey should follow the <code>index-name-YYYY.MM.DD</code> naming convention, e.g. <code>logstash-my-app-2014.08.19</code>.</p>\n<h3><code>get_rows</code></h3>\n<blockquote>\n<p>Returns data matching the given query (provided as a <code>dict</code>).</p>\n</blockquote>\n<pre><span class=\"n\">es_query</span><span class=\"o\">.</span><span class=\"n\">get_rows</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">\"tags\"</span><span class=\"p\">:</span> <span class=\"s1\">'edge-cache-requestmessage'</span><span class=\"p\">},</span> <span class=\"n\">limit</span><span class=\"o\">=</span><span class=\"mi\">2000</span><span class=\"p\">)</span>\n</pre>\n<ul>\n<li><code>match</code>: query to be run against log messages (ex. {\"@message\": \"Foo Bar DB queries\"}).</li>\n<li><code>limit</code>: the number of results (defaults to 10).</li>\n</ul>\n<h3><code>query_by_string</code></h3>\n<blockquote>\n<p>Returns data matching the given query string (provided as a <a href=\"https://lucene.apache.org/core/2_9_4/queryparsersyntax.html\" rel=\"nofollow\">Lucene query</a>).</p>\n</blockquote>\n<pre><span class=\"n\">es_query</span><span class=\"o\">.</span><span class=\"n\">query_by_string</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"o\">=</span><span class=\"s1\">'@message:\"^PHP Fatal\"'</span><span class=\"p\">,</span> <span class=\"n\">limit</span><span class=\"o\">=</span><span class=\"mi\">2000</span><span class=\"p\">)</span>\n<span class=\"n\">es_query</span><span class=\"o\">.</span><span class=\"n\">query_by_string</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"o\">=</span><span class=\"s1\">'@message:\"^PHP Fatal\"'</span><span class=\"p\">,</span> <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'@message'</span><span class=\"p\">,</span> <span class=\"s1\">'@es_query_host'</span><span class=\"p\">],</span> <span class=\"n\">limit</span><span class=\"o\">=</span><span class=\"mi\">2000</span><span class=\"p\">)</span>\n</pre>\n<ul>\n<li><code>query</code>: query string to be run against log messages (ex. <code>@message:\"^PHP Fatal\"</code>).</li>\n<li><code>fields</code>: optional list of fields to fetch</li>\n<li><code>limit</code>: the number of results (defaults to 10).</li>\n</ul>\n<h3><code>query_by_sql</code></h3>\n<blockquote>\n<p>Returns data matching the given <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/sql-commands.html\" rel=\"nofollow\">SQL query</a>.</p>\n</blockquote>\n<p>This feature <a href=\"https://www.elastic.co/blog/opening-x-pack-phase-1-complete\" rel=\"nofollow\">requires</a> <strong>non-OSS version</strong> of Elasticsearch (\"To be clear, while the X-Pack source code is now available in the public repositories, it isn\u2019t under an Open Source license\").</p>\n<pre><span class=\"n\">es_query</span><span class=\"o\">.</span><span class=\"n\">query_by_sql</span><span class=\"p\">(</span><span class=\"n\">sql</span><span class=\"o\">=</span><span class=\"s1\">'SELECT host FROM \"app-requests\" WHERE host = </span><span class=\"se\">\\'</span><span class=\"s1\">app2.prod</span><span class=\"se\">\\'</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n</pre>\n<ul>\n<li><code>sql</code>: <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/sql-commands.html\" rel=\"nofollow\">SQL query</a> to be run</li>\n</ul>\n<h3><code>count</code></h3>\n<blockquote>\n<p>Returns number of matching entries</p>\n</blockquote>\n<pre><span class=\"n\">es_query</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"o\">=</span><span class=\"s1\">'@message:\"^PHP Fatal\"'</span><span class=\"p\">)</span>\n</pre>\n<h2>Integration tests</h2>\n<p><code>elasticsearch-query</code> comes with integration tests suite. <code>.travis.yml</code> will install elasticsearch OSS version and run them.</p>\n<p>But you can also run it locally. Simply pass <code>ES_TEST_HOST=&lt;elasticsearch IP&gt;</code> env variable when running tests (<code>make test</code>).</p>\n\n          </div>"}, "last_serial": 4573044, "releases": {"2.3.0": [{"comment_text": "", "digests": {"md5": "a651dfe630678782317db84fc23faaac", "sha256": "d588e99740666562c178c5c7c81471827ca143950cfd08107f1f61766372542b"}, "downloads": -1, "filename": "elasticsearch-query-2.3.0.tar.gz", "has_sig": false, "md5_digest": "a651dfe630678782317db84fc23faaac", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 5538, "upload_time": "2018-12-04T21:46:14", "upload_time_iso_8601": "2018-12-04T21:46:14.168152Z", "url": "https://files.pythonhosted.org/packages/a1/57/f3382a8002cfc1dd3f56a454f689b42054d9093890dd86c0b3ab6807209f/elasticsearch-query-2.3.0.tar.gz", "yanked": false}], "2.4.0": [{"comment_text": "", "digests": {"md5": "e276d00353f02042dfdd783d2b43660c", "sha256": "1b90afd45f5ad0427af87583f9d3ce1c699aa09043fc0f72d36e6d666a968821"}, "downloads": -1, "filename": "elasticsearch-query-2.4.0.tar.gz", "has_sig": false, "md5_digest": "e276d00353f02042dfdd783d2b43660c", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6388, "upload_time": "2018-12-07T19:16:33", "upload_time_iso_8601": "2018-12-07T19:16:33.337973Z", "url": "https://files.pythonhosted.org/packages/dc/4a/86ce2ef588b3815c751f721b859462edd95e44e9e2ed64e431049f7468fc/elasticsearch-query-2.4.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "e276d00353f02042dfdd783d2b43660c", "sha256": "1b90afd45f5ad0427af87583f9d3ce1c699aa09043fc0f72d36e6d666a968821"}, "downloads": -1, "filename": "elasticsearch-query-2.4.0.tar.gz", "has_sig": false, "md5_digest": "e276d00353f02042dfdd783d2b43660c", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6388, "upload_time": "2018-12-07T19:16:33", "upload_time_iso_8601": "2018-12-07T19:16:33.337973Z", "url": "https://files.pythonhosted.org/packages/dc/4a/86ce2ef588b3815c751f721b859462edd95e44e9e2ed64e431049f7468fc/elasticsearch-query-2.4.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:46:59 2020"}