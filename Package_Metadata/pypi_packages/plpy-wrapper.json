{"info": {"author": "Shmuel Kamensky", "author_email": "", "bugtrack_url": null, "classifiers": [], "description": "# plpy-wrapper\n\n[![black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)\n[![docs](https://readthedocs.org/projects/plpy-wrapper-dev/badge/?version=latest)](https://plpy-wrapper-dev.readthedocs.io/en/latest/)\n[![license](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)\n[![pypi](https://badge.fury.io/py/plpy-wrapper.svg)](https://pypi.python.org/pypi/plpy-wrapper/)\n[![HitCount](http://hits.dwyl.com/skamensky/plpy-wrapper.svg)](http://hits.dwyl.com/skamensky/plpy-wrapper)\n\nTable of Contents\n=================\n\n  * [Terminology](#terminology)\n  * [Documentation](#documentation)\n  * [Why](#why)\n  * [Who should use this?](#who-should-use-this)\n  * [Getting Started](#getting-started)\n    * [Prerequisites](#prerequisites)\n    * [Installation](#installation)\n    * [How to use](#how-to-use)\n    * [Examples](#examples)\n  * [Running the tests](#running-the-tests)\n  * [Technologies](#technologies)\n  * [Scope of the project](#scope-of-the-project)\n  * [Project status](#project-status)\n  * [What does plpython stand for?](#what-does-plpython-stand-for)\n  * [TODO](#todo)\n  * [A Note on the Development Environment](#a-note-on-the-development-environment)\n  * [Further Reading](#further-reading)\n\n\nTerminology\n------------------\n* `procedural language` A language in which one can write user-defined functions to access database functionality. The most well known and used in the Postgres world is `PL/pgsql`\n* `plpython` - The procedural language plpython which allows python code to run in the Postgres Runtime\n* `plpy` The only package that is imported automatically by the Python interpreter embedded in Postgres. This package cannot be imported outside of the Postgres runtime and is used to access Postgres DB functionality such as querying or logging       \n* `plpy-wrapper` This package which is a convenience wrapper around plpy\n\n\nDocumentation\n------------------\nCheck out the documentation [here](https://plpy-wrapper.readthedocs.io/)\nSee the [documentation readme](/docs/README.md) for information on building the documentation.\n\nWhy\n------------------\nThe reason I wrote plpy-wrapper was to explore how two of some of my favorite technologies, Postgres, and Python\nlive and cooperate with one another.\n\nWho should use this?\n------------------\nIt's difficult to justify the use of this in large-scale or security-conscious projects.\nThe main reason doesn't have anything to do with this package itself, but rather the fact that plpython is an untrusted procedural language - meaning that it can run arbitrary code on your Postgres server.  \n\nAs phrased by the [postgres documentation](https://www.postgresql.org/docs/12/plpython.html#docComments):\n>PL/Python is only available as an \"untrusted\" language, meaning it does not offer any way of restricting what users can do in it and is therefore named plpython\n \n\nHowever, there are some good reasons to use plpython in general and therefore plpy-wrapper as well.\n1. You don't want to learn PL/pgSQL but you want to write user-defined functions in Postgres\n2. You want to use a python package that already does exactly what you want it to do \n3. You have code you already wrote in Python and want to use it in Postgres\n4. You are curious\n5. It's a personal server and you have full control over the environment and Python is cool\n\nGetting Started\n------------------\n#### Prerequisites\nMake sure to have Postgres installed on your system.\nThe Postgres installation should have been compiled with support for plpython as a supported procedural language.\nBy default most installations come with that baked in. When in doubt you can look in the [dockerfile](/testing/docker/Dockerfile) \nfor an example of an environment that this package will definitely run in.\n\nMake sure you've installed plpython as a procedural language in a Postgres session. This package only supports plpython3.\nYou can do that by running the following code snippet\n\n```postgres-psql\nCREATE EXTENSION plpython3u;\n```\n\n#### Installation\n\nOn the same machine as your Postgres installation, install plpy-wrapper.\nHowever the package gets installed, it must end up in the [Python Path](https://docs.python.org/3.8/using/cmdline.html#envvar-PYTHONPATH).\nThe way the embedded Python interpreter running inside of the Postgres runtime knows how to access outside Python packages (such as this one), is through the Python Path.\nSo however you install this package, make sure it ends up on the Python Path.\n\nThe two easiest ways to install plpy-wrapper are through pip\n\nUsing pypi\n```shell script\npip install plpy-wrapper\n```\n\nUsing github\n\n```shell script\npip install git+https://github.com/skamensky/plpy-wrapper\n```\n\n#### How to use\nThe best way to learn about how to use this package is by reading the [tests](/testing/tests.py).\n\nYou can also read some examples below or open an issue if something is unclear.\n\n\n#### Examples\nThe trigger creation utility attempts to satisfy a simple use case where you want to create a trigger on every event for a given table. \n\nThis code \n```postgres-sql\nDO\n$$\nfrom plpy_wrapper import utilities,PLPYWrapper\nutilities.create_plpython_triggers(PLPYWrapper(globals()),'customer','contact')\n$$ language plpython3u;\n```\n\nResults in the following triggers definitions being executed on the `contact` table in the `customer` schema\nin order to captures all row events. \n\n```postgres-psql\ncreate trigger trig_customer_contact_after\n    after insert or update or delete\n    on contact\n    for each row\nexecute procedure func_customer_contact_trigger_controller();\n```\nAnd\n\n```postgres-psql\ncreate trigger trig_customer_contact_before\n    before insert or update or delete\n    on contact\n    for each row\nexecute procedure func_customer_contact_trigger_controller();\n```\nThe `func_customer_contact_trigger_controller` will autogenerate to the following definition, but could also be changed:\n\n```postgres-psql\ncreate function func_customer_contact_trigger_controller() returns trigger\n    language plpython3u\nas\n$$\nfrom plpy_wrapper import PLPYWrapper,Trigger\nclass _Contact(Trigger):\n\n    def before_insert(self):\n        #put your before insert logic here (or delete this method if you don't want anything to happen before insert)\n        pass\n\n    def after_insert(self):\n        #put your after insert logic here (or delete this method if you don't want anything to happen after insert)\n        pass\n\n    def before_update(self):\n        #put your before update logic here (or delete this method if you don't want anything to happen before update)\n        pass\n\n    def after_update(self):\n        #put your after update logic here (or delete this method if you don't want anything to happen after update)\n        pass\n\n    def before_delete(self):\n        #put your before delete logic here (or delete this method if you don't want anything to happen before delete)\n        pass\n\n    def after_delete(self):\n        #put your before after delete logic here (or delete this method if you don't want anything to happen after delete)\n        pass\n\ntrigger_handler = _Contact(PLPYWrapper(globals()))\n#this runs the appropriate method\ntrigger_handler.execute()\n#based on changes you made to the data or events you initiated, this tells postgres to change data, skip the event, etc.\n#The return value is only relevant in BEFORE/INSTEAD OF triggers\nreturn trigger_handler.trigger_return_val\n$$;\n```\n\nRunning the tests\n------------------\nYou can read more about how tests work and how to run them in the [tests readme](/testing/README.md).\n\nTechnologies\n------------------\n* Python\n* Postgres\n\nScope of the project\n------------------\nAs of now, plpy-wrapper is a simple wrapper around plpy. The main utilities someone could find in it\nare:\n1. Simplifying writing triggers in plpython and avoiding some common pitfalls (for example by using the autogenerated trigger above you don't need to worry about persisting changes you've made to the row in the trigger by returning the string 'OK'. This package does that for you).\n2. Performing a specific action before or after every function call to plpy (sort of how you would use decorators)\n\nHowever, I am open to contributions and extending the scope of this package to be a more full-fledged wrapper as long as the changes are useful enough to a broad audience. \n\nProject status\n------------------ \nWhatever comes before Alpha. Given that this project was written mainly for fun and curiosity I can see it never being touched again.\n\nWhat does plpython3u stand for?\n------------------\nThe `pl` part of plpython stands for procedural language\n\nThe `python` part stands for Python \u2665\n\nThe `3` part stands for python 3.\n\nThe `u` part stands for untrusted (you can what untrusted means in the [Who should use this?](#who-should-use-this) section).\n\nTODO\n------------------\n* Finish writing tests\n* Add CI\n* Create coverage badge and improve coverage\n\nA Note on the Development Environment\n------------------\nThis package was developed on Windows and therefore bash scripts are batch scripts and some file paths may be in Windows formats. \n\nSorry! I'm still in the process of transferring my development environment to WSL.\n\nFurther Reading\n------------------\nhttps://www.postgresql.org/docs/current/plpython.html", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/skamensky/plpy-wrapper/", "keywords": "postgres plpython plpy wrapper", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "plpy-wrapper", "package_url": "https://pypi.org/project/plpy-wrapper/", "platform": "", "project_url": "https://pypi.org/project/plpy-wrapper/", "project_urls": {"Homepage": "https://github.com/skamensky/plpy-wrapper/"}, "release_url": "https://pypi.org/project/plpy-wrapper/0.1/", "requires_dist": null, "requires_python": ">=3.7, <=3.8", "summary": "", "version": "0.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>plpy-wrapper</h1>\n<p><a href=\"https://github.com/psf/black\" rel=\"nofollow\"><img alt=\"black\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/fbfdc7754183ecf079bc71ddeabaf88f6cbc5c00/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f64652532307374796c652d626c61636b2d3030303030302e737667\"></a>\n<a href=\"https://plpy-wrapper-dev.readthedocs.io/en/latest/\" rel=\"nofollow\"><img alt=\"docs\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/d6217fff399927bd20b8f572911d2f4b7ce7197c/68747470733a2f2f72656164746865646f63732e6f72672f70726f6a656374732f706c70792d777261707065722d6465762f62616467652f3f76657273696f6e3d6c6174657374\"></a>\n<a href=\"https://opensource.org/licenses/MIT\" rel=\"nofollow\"><img alt=\"license\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/4150014b4dfdd7b565fa18de88e9bb1b8ccd7c08/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d626c75652e737667\"></a>\n<a href=\"https://pypi.python.org/pypi/plpy-wrapper/\" rel=\"nofollow\"><img alt=\"pypi\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/59db634f84c684949ed063f11131a022f07910ca/68747470733a2f2f62616467652e667572792e696f2f70792f706c70792d777261707065722e737667\"></a>\n<a href=\"http://hits.dwyl.com/skamensky/plpy-wrapper\" rel=\"nofollow\"><img alt=\"HitCount\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/c28e6398c4cb96dd24bb7f769424857fdec9bd09/687474703a2f2f686974732e6477796c2e636f6d2f736b616d656e736b792f706c70792d777261707065722e737667\"></a></p>\n<h1>Table of Contents</h1>\n<ul>\n<li><a href=\"#terminology\" rel=\"nofollow\">Terminology</a></li>\n<li><a href=\"#documentation\" rel=\"nofollow\">Documentation</a></li>\n<li><a href=\"#why\" rel=\"nofollow\">Why</a></li>\n<li><a href=\"#who-should-use-this\" rel=\"nofollow\">Who should use this?</a></li>\n<li><a href=\"#getting-started\" rel=\"nofollow\">Getting Started</a>\n<ul>\n<li><a href=\"#prerequisites\" rel=\"nofollow\">Prerequisites</a></li>\n<li><a href=\"#installation\" rel=\"nofollow\">Installation</a></li>\n<li><a href=\"#how-to-use\" rel=\"nofollow\">How to use</a></li>\n<li><a href=\"#examples\" rel=\"nofollow\">Examples</a></li>\n</ul>\n</li>\n<li><a href=\"#running-the-tests\" rel=\"nofollow\">Running the tests</a></li>\n<li><a href=\"#technologies\" rel=\"nofollow\">Technologies</a></li>\n<li><a href=\"#scope-of-the-project\" rel=\"nofollow\">Scope of the project</a></li>\n<li><a href=\"#project-status\" rel=\"nofollow\">Project status</a></li>\n<li><a href=\"#what-does-plpython-stand-for\" rel=\"nofollow\">What does plpython stand for?</a></li>\n<li><a href=\"#todo\" rel=\"nofollow\">TODO</a></li>\n<li><a href=\"#a-note-on-the-development-environment\" rel=\"nofollow\">A Note on the Development Environment</a></li>\n<li><a href=\"#further-reading\" rel=\"nofollow\">Further Reading</a></li>\n</ul>\n<h2>Terminology</h2>\n<ul>\n<li><code>procedural language</code> A language in which one can write user-defined functions to access database functionality. The most well known and used in the Postgres world is <code>PL/pgsql</code></li>\n<li><code>plpython</code> - The procedural language plpython which allows python code to run in the Postgres Runtime</li>\n<li><code>plpy</code> The only package that is imported automatically by the Python interpreter embedded in Postgres. This package cannot be imported outside of the Postgres runtime and is used to access Postgres DB functionality such as querying or logging</li>\n<li><code>plpy-wrapper</code> This package which is a convenience wrapper around plpy</li>\n</ul>\n<h2>Documentation</h2>\n<p>Check out the documentation <a href=\"https://plpy-wrapper.readthedocs.io/\" rel=\"nofollow\">here</a>\nSee the <a href=\"/docs/README.md\" rel=\"nofollow\">documentation readme</a> for information on building the documentation.</p>\n<h2>Why</h2>\n<p>The reason I wrote plpy-wrapper was to explore how two of some of my favorite technologies, Postgres, and Python\nlive and cooperate with one another.</p>\n<h2>Who should use this?</h2>\n<p>It's difficult to justify the use of this in large-scale or security-conscious projects.\nThe main reason doesn't have anything to do with this package itself, but rather the fact that plpython is an untrusted procedural language - meaning that it can run arbitrary code on your Postgres server.</p>\n<p>As phrased by the <a href=\"https://www.postgresql.org/docs/12/plpython.html#docComments\" rel=\"nofollow\">postgres documentation</a>:</p>\n<blockquote>\n<p>PL/Python is only available as an \"untrusted\" language, meaning it does not offer any way of restricting what users can do in it and is therefore named plpython</p>\n</blockquote>\n<p>However, there are some good reasons to use plpython in general and therefore plpy-wrapper as well.</p>\n<ol>\n<li>You don't want to learn PL/pgSQL but you want to write user-defined functions in Postgres</li>\n<li>You want to use a python package that already does exactly what you want it to do</li>\n<li>You have code you already wrote in Python and want to use it in Postgres</li>\n<li>You are curious</li>\n<li>It's a personal server and you have full control over the environment and Python is cool</li>\n</ol>\n<h2>Getting Started</h2>\n<h4>Prerequisites</h4>\n<p>Make sure to have Postgres installed on your system.\nThe Postgres installation should have been compiled with support for plpython as a supported procedural language.\nBy default most installations come with that baked in. When in doubt you can look in the <a href=\"/testing/docker/Dockerfile\" rel=\"nofollow\">dockerfile</a>\nfor an example of an environment that this package will definitely run in.</p>\n<p>Make sure you've installed plpython as a procedural language in a Postgres session. This package only supports plpython3.\nYou can do that by running the following code snippet</p>\n<pre>CREATE EXTENSION plpython3u;\n</pre>\n<h4>Installation</h4>\n<p>On the same machine as your Postgres installation, install plpy-wrapper.\nHowever the package gets installed, it must end up in the <a href=\"https://docs.python.org/3.8/using/cmdline.html#envvar-PYTHONPATH\" rel=\"nofollow\">Python Path</a>.\nThe way the embedded Python interpreter running inside of the Postgres runtime knows how to access outside Python packages (such as this one), is through the Python Path.\nSo however you install this package, make sure it ends up on the Python Path.</p>\n<p>The two easiest ways to install plpy-wrapper are through pip</p>\n<p>Using pypi</p>\n<pre>pip install plpy-wrapper\n</pre>\n<p>Using github</p>\n<pre>pip install git+https://github.com/skamensky/plpy-wrapper\n</pre>\n<h4>How to use</h4>\n<p>The best way to learn about how to use this package is by reading the <a href=\"/testing/tests.py\" rel=\"nofollow\">tests</a>.</p>\n<p>You can also read some examples below or open an issue if something is unclear.</p>\n<h4>Examples</h4>\n<p>The trigger creation utility attempts to satisfy a simple use case where you want to create a trigger on every event for a given table.</p>\n<p>This code</p>\n<pre>DO\n$$\nfrom plpy_wrapper import utilities,PLPYWrapper\nutilities.create_plpython_triggers(PLPYWrapper(globals()),'customer','contact')\n$$ language plpython3u;\n</pre>\n<p>Results in the following triggers definitions being executed on the <code>contact</code> table in the <code>customer</code> schema\nin order to captures all row events.</p>\n<pre>create trigger trig_customer_contact_after\n    after insert or update or delete\n    on contact\n    for each row\nexecute procedure func_customer_contact_trigger_controller();\n</pre>\n<p>And</p>\n<pre>create trigger trig_customer_contact_before\n    before insert or update or delete\n    on contact\n    for each row\nexecute procedure func_customer_contact_trigger_controller();\n</pre>\n<p>The <code>func_customer_contact_trigger_controller</code> will autogenerate to the following definition, but could also be changed:</p>\n<pre>create function func_customer_contact_trigger_controller() returns trigger\n    language plpython3u\nas\n$$\nfrom plpy_wrapper import PLPYWrapper,Trigger\nclass _Contact(Trigger):\n\n    def before_insert(self):\n        #put your before insert logic here (or delete this method if you don't want anything to happen before insert)\n        pass\n\n    def after_insert(self):\n        #put your after insert logic here (or delete this method if you don't want anything to happen after insert)\n        pass\n\n    def before_update(self):\n        #put your before update logic here (or delete this method if you don't want anything to happen before update)\n        pass\n\n    def after_update(self):\n        #put your after update logic here (or delete this method if you don't want anything to happen after update)\n        pass\n\n    def before_delete(self):\n        #put your before delete logic here (or delete this method if you don't want anything to happen before delete)\n        pass\n\n    def after_delete(self):\n        #put your before after delete logic here (or delete this method if you don't want anything to happen after delete)\n        pass\n\ntrigger_handler = _Contact(PLPYWrapper(globals()))\n#this runs the appropriate method\ntrigger_handler.execute()\n#based on changes you made to the data or events you initiated, this tells postgres to change data, skip the event, etc.\n#The return value is only relevant in BEFORE/INSTEAD OF triggers\nreturn trigger_handler.trigger_return_val\n$$;\n</pre>\n<h2>Running the tests</h2>\n<p>You can read more about how tests work and how to run them in the <a href=\"/testing/README.md\" rel=\"nofollow\">tests readme</a>.</p>\n<h2>Technologies</h2>\n<ul>\n<li>Python</li>\n<li>Postgres</li>\n</ul>\n<h2>Scope of the project</h2>\n<p>As of now, plpy-wrapper is a simple wrapper around plpy. The main utilities someone could find in it\nare:</p>\n<ol>\n<li>Simplifying writing triggers in plpython and avoiding some common pitfalls (for example by using the autogenerated trigger above you don't need to worry about persisting changes you've made to the row in the trigger by returning the string 'OK'. This package does that for you).</li>\n<li>Performing a specific action before or after every function call to plpy (sort of how you would use decorators)</li>\n</ol>\n<p>However, I am open to contributions and extending the scope of this package to be a more full-fledged wrapper as long as the changes are useful enough to a broad audience.</p>\n<h2>Project status</h2>\n<p>Whatever comes before Alpha. Given that this project was written mainly for fun and curiosity I can see it never being touched again.</p>\n<h2>What does plpython3u stand for?</h2>\n<p>The <code>pl</code> part of plpython stands for procedural language</p>\n<p>The <code>python</code> part stands for Python \u2665</p>\n<p>The <code>3</code> part stands for python 3.</p>\n<p>The <code>u</code> part stands for untrusted (you can what untrusted means in the <a href=\"#who-should-use-this\" rel=\"nofollow\">Who should use this?</a> section).</p>\n<h2>TODO</h2>\n<ul>\n<li>Finish writing tests</li>\n<li>Add CI</li>\n<li>Create coverage badge and improve coverage</li>\n</ul>\n<h2>A Note on the Development Environment</h2>\n<p>This package was developed on Windows and therefore bash scripts are batch scripts and some file paths may be in Windows formats.</p>\n<p>Sorry! I'm still in the process of transferring my development environment to WSL.</p>\n<h2>Further Reading</h2>\n<p><a href=\"https://www.postgresql.org/docs/current/plpython.html\" rel=\"nofollow\">https://www.postgresql.org/docs/current/plpython.html</a></p>\n\n          </div>"}, "last_serial": 7031386, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "a135fdea10c1a07c8916f0b6592590ca", "sha256": "e619c9e798895b4d38d5cefc480215a6c80dc9b4a250cc50ef2ddd56542973e1"}, "downloads": -1, "filename": "plpy-wrapper-0.1.tar.gz", "has_sig": false, "md5_digest": "a135fdea10c1a07c8916f0b6592590ca", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7, <=3.8", "size": 16187, "upload_time": "2020-04-16T11:17:20", "upload_time_iso_8601": "2020-04-16T11:17:20.819999Z", "url": "https://files.pythonhosted.org/packages/b7/9f/18f8171a180dd517003ea33105c75932decc32ba66591a6458f80f89a611/plpy-wrapper-0.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "a135fdea10c1a07c8916f0b6592590ca", "sha256": "e619c9e798895b4d38d5cefc480215a6c80dc9b4a250cc50ef2ddd56542973e1"}, "downloads": -1, "filename": "plpy-wrapper-0.1.tar.gz", "has_sig": false, "md5_digest": "a135fdea10c1a07c8916f0b6592590ca", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.7, <=3.8", "size": 16187, "upload_time": "2020-04-16T11:17:20", "upload_time_iso_8601": "2020-04-16T11:17:20.819999Z", "url": "https://files.pythonhosted.org/packages/b7/9f/18f8171a180dd517003ea33105c75932decc32ba66591a6458f80f89a611/plpy-wrapper-0.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 02:52:30 2020"}