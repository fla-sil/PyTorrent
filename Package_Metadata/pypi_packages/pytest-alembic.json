{"info": {"author": "Dan Cardin", "author_email": "ddcardin@gmail.com", "bugtrack_url": null, "classifiers": ["Framework :: Pytest", "License :: OSI Approved :: MIT License", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.5", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7", "Programming Language :: Python :: 3.8"], "description": "![CircleCI](https://img.shields.io/circleci/build/gh/schireson/pytest-alembic/master) [![codecov](https://codecov.io/gh/schireson/pytest-alembic/branch/master/graph/badge.svg)](https://codecov.io/gh/schireson/pytest-alembic) [![Documentation Status](https://readthedocs.org/projects/pytest-alembic/badge/?version=latest)](https://pytest-alembic.readthedocs.io/en/latest/?badge=latest)\n\n\n## Introduction\n\nA pytest plugin to test alembic migrations (with default tests) and which enables\nyou to write tests specific to your migrations.\n\n```bash\n$ pip install pytest-alembic\n$ pytest --test-alembic\n\n...\n::pytest_alembic/tests/model_definitions_match_ddl <- . PASSED           [ 25%]\n::pytest_alembic/tests/single_head_revision <- . PASSED                  [ 50%]\n::pytest_alembic/tests/up_down_consistency <- . PASSED                   [ 75%]\n::pytest_alembic/tests/upgrade <- . PASSED                               [100%]\n\n============================== 4 passed in 2.32s ===============================\n```\n\n\n## The pitch\n\nHave you ever merged a change to your models and you forgot to generate a migration?\n\nHave you ever written a migration only to realize that it fails when there's data in the table?\n\nHave you ever written a **perfect** migration only to merge it and later find out that someone\nelse merged also merged a migration and your CD is now broken!?\n\n`pytest-alembic` is meant to (with a little help) solve all these problems and more. Note, due to\na few different factors, there **may** be some [minimal required setup](http://pytest-alembic.readthedocs.io/en/latest/setup.html);\nhowever most of it is boilerplate akin to the setup required for alembic itself.\n\n### Built-in Tests\n\n* **test_single_head_revision**\n\n  Assert that there only exists one head revision.\n\n  We're not sure what realistic scenario involves a diverging history to be desirable. We\n  have only seen it be the result of uncaught merge conflicts resulting in a diverged history,\n  which lazily breaks during deployment.\n\n\n* **test_upgrade**\n\n  Assert that the revision history can be run through from base to head.\n\n\n* **test_model_definitions_match_ddl**\n\n  Assert that the state of the migrations matches the state of the models describing the DDL.\n\n  In general, the set of migrations in the history should coalesce into DDL which is described\n  by the current set of models. Therefore, a call to `revision --autogenerate` should always\n  generate an empty migration (e.g. find no difference between your database (i.e. migrations\n  history) and your models).\n\n\n* **test_up_down_consistency**\n\n  Assert that all downgrades succeed.\n\n  While downgrading may not be lossless operation data-wise, there\u2019s a theory of database\n  migrations that says that the revisions in existence for a database should be able to go\n  from an entirely blank schema to the finished product, and back again.\n\n\n### Custom Tests\n\nFor more information, see the docs for [custom tests](http://pytest-alembic.readthedocs.io/en/latest/custom_tests.html)\n(example below) or [custom static data](http://pytest-alembic.readthedocs.io/en/latest/custom_data.html)\n(to be inserted automatically before a given revision).\n\nSometimes when writing a particularly knarly data migration, it helps to be able to practice a\nlittle timely TDD, since there's always the potential you'll trash your actual production data.\n\nWith `pytest-alembic`, you can write tests directly, in the same way that you would normally,\nthrough the use of the `alembic_runner` fixture.\n\n```python\ndef test_knarly_migration_xyz123(alembic_engine, alembic_runner):\n    # Migrate up to, but not including this new migration\n    alembic_runner.migrate_up_before('xyz123')\n\n    # Perform some very specific data setup, because this migration is sooooo complex.\n    # ...\n    alembic_engine.execute(table.insert(id=1, name='foo'))\n\n    alembic_runner.migrate_up_one()\n```\n\n`alembic_runner` has a number of methods designed to make it convenient to change the state of\nyour database up, down, and all around.\n\n\n## Installing\n\n```bash\npip install \"pytest-alembic\"\n```\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/schireson/pytest-alembic", "keywords": "pytest,sqlalchemy,alembic,migration,revision", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "pytest-alembic", "package_url": "https://pypi.org/project/pytest-alembic/", "platform": "", "project_url": "https://pypi.org/project/pytest-alembic/", "project_urls": {"Homepage": "https://github.com/schireson/pytest-alembic", "Repository": "https://github.com/schireson/pytest-alembic"}, "release_url": "https://pypi.org/project/pytest-alembic/0.2.1/", "requires_dist": ["pytest (>=1.0)", "alembic", "sqlalchemy", "dataclasses; python_version <= \"3.7\""], "requires_python": ">=3.5,<4", "summary": "A pytest plugin for verifying alembic migrations.", "version": "0.2.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p><img alt=\"CircleCI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/2f68a9accec6fff7ac799f2dfb67b5dae18e0815/68747470733a2f2f696d672e736869656c64732e696f2f636972636c6563692f6275696c642f67682f736368697265736f6e2f7079746573742d616c656d6269632f6d6173746572\"> <a href=\"https://codecov.io/gh/schireson/pytest-alembic\" rel=\"nofollow\"><img alt=\"codecov\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/cf50f608a89df183e40fe63ca54924c61224c559/68747470733a2f2f636f6465636f762e696f2f67682f736368697265736f6e2f7079746573742d616c656d6269632f6272616e63682f6d61737465722f67726170682f62616467652e737667\"></a> <a href=\"https://pytest-alembic.readthedocs.io/en/latest/?badge=latest\" rel=\"nofollow\"><img alt=\"Documentation Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/32b8e583ad36e4c095b9e0bdac6f1a578f632aec/68747470733a2f2f72656164746865646f63732e6f72672f70726f6a656374732f7079746573742d616c656d6269632f62616467652f3f76657273696f6e3d6c6174657374\"></a></p>\n<h2>Introduction</h2>\n<p>A pytest plugin to test alembic migrations (with default tests) and which enables\nyou to write tests specific to your migrations.</p>\n<pre>$ pip install pytest-alembic\n$ pytest --test-alembic\n\n...\n::pytest_alembic/tests/model_definitions_match_ddl &lt;- . PASSED           <span class=\"o\">[</span> <span class=\"m\">25</span>%<span class=\"o\">]</span>\n::pytest_alembic/tests/single_head_revision &lt;- . PASSED                  <span class=\"o\">[</span> <span class=\"m\">50</span>%<span class=\"o\">]</span>\n::pytest_alembic/tests/up_down_consistency &lt;- . PASSED                   <span class=\"o\">[</span> <span class=\"m\">75</span>%<span class=\"o\">]</span>\n::pytest_alembic/tests/upgrade &lt;- . PASSED                               <span class=\"o\">[</span><span class=\"m\">100</span>%<span class=\"o\">]</span>\n\n<span class=\"o\">==============================</span> <span class=\"m\">4</span> passed in <span class=\"m\">2</span>.32s <span class=\"o\">===============================</span>\n</pre>\n<h2>The pitch</h2>\n<p>Have you ever merged a change to your models and you forgot to generate a migration?</p>\n<p>Have you ever written a migration only to realize that it fails when there's data in the table?</p>\n<p>Have you ever written a <strong>perfect</strong> migration only to merge it and later find out that someone\nelse merged also merged a migration and your CD is now broken!?</p>\n<p><code>pytest-alembic</code> is meant to (with a little help) solve all these problems and more. Note, due to\na few different factors, there <strong>may</strong> be some <a href=\"http://pytest-alembic.readthedocs.io/en/latest/setup.html\" rel=\"nofollow\">minimal required setup</a>;\nhowever most of it is boilerplate akin to the setup required for alembic itself.</p>\n<h3>Built-in Tests</h3>\n<ul>\n<li>\n<p><strong>test_single_head_revision</strong></p>\n<p>Assert that there only exists one head revision.</p>\n<p>We're not sure what realistic scenario involves a diverging history to be desirable. We\nhave only seen it be the result of uncaught merge conflicts resulting in a diverged history,\nwhich lazily breaks during deployment.</p>\n</li>\n<li>\n<p><strong>test_upgrade</strong></p>\n<p>Assert that the revision history can be run through from base to head.</p>\n</li>\n<li>\n<p><strong>test_model_definitions_match_ddl</strong></p>\n<p>Assert that the state of the migrations matches the state of the models describing the DDL.</p>\n<p>In general, the set of migrations in the history should coalesce into DDL which is described\nby the current set of models. Therefore, a call to <code>revision --autogenerate</code> should always\ngenerate an empty migration (e.g. find no difference between your database (i.e. migrations\nhistory) and your models).</p>\n</li>\n<li>\n<p><strong>test_up_down_consistency</strong></p>\n<p>Assert that all downgrades succeed.</p>\n<p>While downgrading may not be lossless operation data-wise, there\u2019s a theory of database\nmigrations that says that the revisions in existence for a database should be able to go\nfrom an entirely blank schema to the finished product, and back again.</p>\n</li>\n</ul>\n<h3>Custom Tests</h3>\n<p>For more information, see the docs for <a href=\"http://pytest-alembic.readthedocs.io/en/latest/custom_tests.html\" rel=\"nofollow\">custom tests</a>\n(example below) or <a href=\"http://pytest-alembic.readthedocs.io/en/latest/custom_data.html\" rel=\"nofollow\">custom static data</a>\n(to be inserted automatically before a given revision).</p>\n<p>Sometimes when writing a particularly knarly data migration, it helps to be able to practice a\nlittle timely TDD, since there's always the potential you'll trash your actual production data.</p>\n<p>With <code>pytest-alembic</code>, you can write tests directly, in the same way that you would normally,\nthrough the use of the <code>alembic_runner</code> fixture.</p>\n<pre><span class=\"k\">def</span> <span class=\"nf\">test_knarly_migration_xyz123</span><span class=\"p\">(</span><span class=\"n\">alembic_engine</span><span class=\"p\">,</span> <span class=\"n\">alembic_runner</span><span class=\"p\">):</span>\n    <span class=\"c1\"># Migrate up to, but not including this new migration</span>\n    <span class=\"n\">alembic_runner</span><span class=\"o\">.</span><span class=\"n\">migrate_up_before</span><span class=\"p\">(</span><span class=\"s1\">'xyz123'</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Perform some very specific data setup, because this migration is sooooo complex.</span>\n    <span class=\"c1\"># ...</span>\n    <span class=\"n\">alembic_engine</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"n\">table</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"nb\">id</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">'foo'</span><span class=\"p\">))</span>\n\n    <span class=\"n\">alembic_runner</span><span class=\"o\">.</span><span class=\"n\">migrate_up_one</span><span class=\"p\">()</span>\n</pre>\n<p><code>alembic_runner</code> has a number of methods designed to make it convenient to change the state of\nyour database up, down, and all around.</p>\n<h2>Installing</h2>\n<pre>pip install <span class=\"s2\">\"pytest-alembic\"</span>\n</pre>\n\n          </div>"}, "last_serial": 6937899, "releases": {"0.2.1": [{"comment_text": "", "digests": {"md5": "0f88f612c0deb4dc5fa8ea6f6bccab48", "sha256": "de67c357e449d20b56fcd5033d9c389496043550ebdbb2d08de556c3b2d0d802"}, "downloads": -1, "filename": "pytest_alembic-0.2.1-py3-none-any.whl", "has_sig": false, "md5_digest": "0f88f612c0deb4dc5fa8ea6f6bccab48", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.5,<4", "size": 15010, "upload_time": "2020-04-02T18:38:11", "upload_time_iso_8601": "2020-04-02T18:38:11.417967Z", "url": "https://files.pythonhosted.org/packages/0a/72/60cb248f50eef5779e52db8091561e59b0fdf07c5b00ea92ce62b1e8efaf/pytest_alembic-0.2.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "e09b8b6dbd43076fa83b381821010f07", "sha256": "1fe2caf1a0d9954ba477c0a109f06b7da1a659df6b2871aec3786881eef5c6a9"}, "downloads": -1, "filename": "pytest-alembic-0.2.1.tar.gz", "has_sig": false, "md5_digest": "e09b8b6dbd43076fa83b381821010f07", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.5,<4", "size": 12242, "upload_time": "2020-04-02T18:38:09", "upload_time_iso_8601": "2020-04-02T18:38:09.102230Z", "url": "https://files.pythonhosted.org/packages/37/5e/f699c72cc01b644b70027e920578d18db9c552aa7f823d53dcbef60ec792/pytest-alembic-0.2.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "0f88f612c0deb4dc5fa8ea6f6bccab48", "sha256": "de67c357e449d20b56fcd5033d9c389496043550ebdbb2d08de556c3b2d0d802"}, "downloads": -1, "filename": "pytest_alembic-0.2.1-py3-none-any.whl", "has_sig": false, "md5_digest": "0f88f612c0deb4dc5fa8ea6f6bccab48", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.5,<4", "size": 15010, "upload_time": "2020-04-02T18:38:11", "upload_time_iso_8601": "2020-04-02T18:38:11.417967Z", "url": "https://files.pythonhosted.org/packages/0a/72/60cb248f50eef5779e52db8091561e59b0fdf07c5b00ea92ce62b1e8efaf/pytest_alembic-0.2.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "e09b8b6dbd43076fa83b381821010f07", "sha256": "1fe2caf1a0d9954ba477c0a109f06b7da1a659df6b2871aec3786881eef5c6a9"}, "downloads": -1, "filename": "pytest-alembic-0.2.1.tar.gz", "has_sig": false, "md5_digest": "e09b8b6dbd43076fa83b381821010f07", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.5,<4", "size": 12242, "upload_time": "2020-04-02T18:38:09", "upload_time_iso_8601": "2020-04-02T18:38:09.102230Z", "url": "https://files.pythonhosted.org/packages/37/5e/f699c72cc01b644b70027e920578d18db9c552aa7f823d53dcbef60ec792/pytest-alembic-0.2.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 02:55:27 2020"}