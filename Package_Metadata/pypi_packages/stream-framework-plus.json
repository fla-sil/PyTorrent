{"info": {"author": "Thierry Schellenbach", "author_email": "thierryschellenbach@gmail.com", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Framework :: Django", "Intended Audience :: Developers", "Intended Audience :: System Administrators", "License :: OSI Approved :: GNU General Public License (GPL)", "Natural Language :: English", "Operating System :: OS Independent", "Programming Language :: Python", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3.7", "Topic :: Scientific/Engineering :: Mathematics", "Topic :: Software Development", "Topic :: Software Development :: Libraries :: Python Modules"], "description": "Stream Framework\n----------------\n\n[![Build Status](https://travis-ci.org/tschellenbach/Stream-Framework.svg?branch=master)](https://travis-ci.org/tschellenbach/Stream-Framework)\n[![StackShare](https://img.shields.io/badge/tech-stack-0690fa.svg?style=flat)](https://stackshare.io/stream/stream-framework)\n\n\n## Activity Streams & Newsfeeds ##\n\n<p align=\"center\">\n  <img src=\"https://dvqg2dogggmn6.cloudfront.net/images/mood-home.png\" alt=\"Examples of what you can build\" title=\"What you can build\"/>\n</p>\n\nStream Framework is a Python library which allows you to build activity streams & newsfeeds using Cassandra and/or Redis. If you're not using python have a look at [Stream][stream-url], which supports Node, Ruby, PHP, Python, Go, Scala, Java and REST.\n\nExamples of what you can build are:\n\n* Activity streams such as seen on Github\n* A Twitter style newsfeed\n* A feed like Instagram/ Pinterest\n* Facebook style newsfeeds\n* A notification system\n\n(Feeds are also commonly called: Activity Streams, activity feeds, news streams.)\n\n## Stream ##\n\n<a href=\"https://getstream.io/\"><img src=\"http://dvqg2dogggmn6.cloudfront.net/images/getstream-dot-io-logo-light.png\" alt=\"Build scalable newsfeeds and activity streams using getstream.io\" title=\"Build scalable newsfeeds and activity streams using getstream.io\" width=\"300px\"/></a>\n\nStream Framework's authors also offer a web service for building scalable newsfeeds & activity streams at [Stream][stream-url].\nIt allows you to create your feeds by talking to a beautiful and easy to use REST API. There are clients available for Node, Ruby, PHP, Python, Go, Scala and Java. The [Get Started](https://getstream.io/get_started/#intro) page explains the API & concept in a few clicks. It's a lot easier to use, free up to 3 million feed updates and saves you the hassle of maintaining Cassandra, Redis, Faye, RabbitMQ and Celery workers.\n\n\n## Background Articles ##\n\nA lot has been written about the best approaches to building feed based systems.\nHere's a collection of some of the talks:\n\n-   [Twitter 2013][twitter_2013]: Redis based, database fallback, very similar to Fashiolista's old approach.\n-   [Etsy feed scaling][etsy]: Gearman, separate scoring and aggregation steps, rollups - aggregation part two\n-   [LinkedIn ranked feeds][linkedin]\n-   [Facebook history][facebook]\n-   [Django project with good naming conventions][djproject]\n-   [Activity stream specification][activity_stream]\n-   [Quora post on best practices][quora]\n-   [Quora scaling a social network feed][quora2]\n-   [Redis ruby example][redisruby]\n-   [FriendFeed approach][friendfeed]\n-   [Thoonk setup][thoonk]\n-   [Yahoo Research Paper][yahoo]\n-   [Twitter\u2019s approach][twitter]\n-   [Cassandra at Instagram][instagram]\n-   [Relevancy at Etsy][etsy_relevancy]\n-   [Zite architecture overview][zite]\n-   [Ranked feeds with ES][es]\n-   [Riak at Xing - by Dr. Stefan Kaes & Sebastian R\u00f6bke][xing]\n-   [Riak and Scala at Yammer][yammer]\n\n\n\n\n## Stream Framework ##\n\n\n**Installation**\n\nInstallation through `pip` is recommended::\n\n    $ pip install stream-framework\n\nBy default `stream-framework` does not install the required dependencies for redis and cassandra:\n\n***Install stream-framework with Redis dependencies***\n\n    $ pip install stream-framework[redis]\n\n***Install stream-framework with Cassandra dependencies***\n\n    $ pip install stream-framework[cassandra]\n\n***Install stream-framework with both Redis and Cassandra dependencies***\n\n    $ pip install stream-framework[redis,cassandra]\n\n\n**Authors & Contributors**\n\n * Thierry Schellenbach ([thierry@getstream.io](mailto:thierry@getstream.io))\n * Tommaso Barbugli ([tommaso@getstream.io](mailto:tommaso@getstream.io))\n * Anislav Atanasov\n * Guyon Mor\u00e9e\n\n**Resources**\n\n * [Documentation]\n * [Bug Tracker]\n * [Code]\n * [Travis CI]\n * [Stackoverflow]\n\n**Example application**\n\nWe've included a [Pinterest-like example application][example_app_link] based on Stream Framework.\n\n**Tutorials**\n\n * [Pinterest-style feed example app][mellowmorning_example]\n\n\n## Using Stream Framework ##\n\nThis quick example will show you how to publish a \"Pin\" to all your followers. So let's create an activity for the item you just pinned.\n\n```python\nfrom stream_framework.activity import Activity\n\n\ndef create_activity(pin):\n    activity = Activity(\n        pin.user_id,\n        PinVerb,\n        pin.id,\n        pin.influencer_id,\n        time=make_naive(pin.created_at, pytz.utc),\n        extra_context=dict(item_id=pin.item_id)\n    )\n    return activity\n```\n\nNext up we want to start publishing this activity on several feeds.\nFirst of all, we want to insert it into your personal feed, and then into your followers' feeds.\nLet's start by defining these feeds.\n\n```python\n\nfrom stream_framework.feeds.redis import RedisFeed\n\n\nclass UserPinFeed(PinFeed):\n    key_format = 'feed:user:%(user_id)s'\n\n\nclass PinFeed(RedisFeed):\n    key_format = 'feed:normal:%(user_id)s'\n```\n\nWriting to these feeds is very simple. For instance to write to the feed of user 13 one would do:\n\n```python\n\nfeed = UserPinFeed(13)\nfeed.add(activity)\n```\n\nBut we don't want to publish to just one users feed. We want to publish to the feeds of all users which follow you.\nThis action is called a \"fanout\" and is abstracted away in the manager class.\nWe need to subclass the Manager class and tell it how we can figure out which users follow us.\n\n```python\n\nfrom stream_framework.feed_managers.base import Manager\n\n\nclass PinManager(Manager):\n    feed_classes = dict(\n        normal=PinFeed,\n    )\n    user_feed_class = UserPinFeed\n\n    def add_pin(self, pin):\n        activity = pin.create_activity()\n        # add user activity adds it to the user feed, and starts the fanout\n        self.add_user_activity(pin.user_id, activity)\n\n    def get_user_follower_ids(self, user_id):\n        ids = Follow.objects.filter(target=user_id).values_list('user_id', flat=True)\n        return {FanoutPriority.HIGH:ids}\n\nmanager = PinManager()\n```\n\nNow that the manager class is set up, broadcasting a pin becomes as easy as:\n\n```python\nmanager.add_pin(pin)\n```\n\nCalling this method will insert the pin into your personal feed and into all the feeds of users which follow you.\nIt does so by spawning many small tasks via Celery. In Django (or any other framework) you can now show the users feed.\n\n```python\n# django example\n\n@login_required\ndef feed(request):\n    '''\n    Items pinned by the people you follow\n    '''\n    context = RequestContext(request)\n    feed = manager.get_feeds(request.user.id)['normal']\n    activities = list(feed[:25])\n    context['activities'] = activities\n    response = render_to_response('core/feed.html', context)\n    return response\n\n```\n\nThis example only briefly covered how Stream Framework works.\nThe full explanation can be found on [the documentation][Documentation].\n\n## Features ##\n\nStream Framework uses Celery and Redis/Cassandra to build a system with heavy writes and extremely light reads.\nIt features:\n\n  - Asynchronous tasks (All the heavy lifting happens in the background, your users don't wait for it)\n  - Reusable components (You will need to make tradeoffs based on your use cases, Stream Framework doesn't get in your way)\n  - Full Cassandra and Redis support\n  - The Cassandra storage uses the new CQL3 and Python-Driver packages, which give you access to the latest Cassandra features.\n  - Build for the extremely performant Cassandra 2.1. 2.2 and 3.3 also pass the test suite, but no production experience.\n\n<!-- links -->\n\n[stream-url]: https://getstream.io/\n[fashiolista]: http://www.fashiolista.com/\n[blog]: https://getstream.io/blog/introducing-the-stream-framework/\n[stream_js]: https://github.com/tschellenbach/stream-js\n[stream_python]: https://github.com/tschellenbach/stream-python\n[stream_php]: https://github.com/tbarbugli/stream-php\n[stream_ruby]: https://github.com/tbarbugli/stream-ruby\n[fashiolista_flat]: http://www.fashiolista.com/feed/?feed_type=F\n[fashiolista_aggregated]: http://www.fashiolista.com/feed/?feed_type=A\n[fashiolista_notification]: http://www.fashiolista.com/my_style/notification/\n[example_app_link]: https://github.com/tbarbugli/stream_framework_example\n[twitter_2013]: http://highscalability.com/blog/2013/7/8/the-architecture-twitter-uses-to-deal-with-150m-active-users.html\n[etsy]: http://www.slideshare.net/danmckinley/etsy-activity-feeds-architecture/\n[quora]: http://www.quora.com/What-are-best-practices-for-building-something-like-a-News-Feed?q=news+feeds\n[linkedin]: https://engineering.linkedin.com/blog/2016/03/followfeed--linkedin-s-feed-made-faster-and-smarter\n[facebook]: http://www.infoq.com/presentations/Facebook-Software-Stack\n[djproject]: https://github.com/justquick/django-activity-stream\n[activity_stream]: http://activitystrea.ms/specs/atom/1.0/\n[quora2]: http://www.quora.com/What-are-the-scaling-issues-to-keep-in-mind-while-developing-a-social-network-feed\n[redisruby]: http://blog.waxman.me/how-to-build-a-fast-news-feed-in-redis\n[friendfeed]: http://backchannel.org/blog/friendfeed-schemaless-mysql\n[thoonk]: http://blog.thoonk.com/\n[yahoo]: http://jeffterrace.com/docs/feeding-frenzy-sigmod10-web.pdf\n[twitter]: http://www.slideshare.net/nkallen/q-con-3770885\n[instagram]: http://planetcassandra.org/blog/post/instagram-making-the-switch-to-cassandra-from-redis-75-instasavings\n[etsy_relevancy]: http://mimno.infosci.cornell.edu/info6150/readings/p1640-hu.pdf\n[zite]: http://blog.zite.com/2012/01/11/zite-under-the-hood/\n[es]: https://speakerdeck.com/viadeoteam/a-personalized-news-feed\n[xing]: https://www.youtube.com/watch?v=38yKu5HR-tM\n[yammer]: http://basho.com/posts/business/riak-and-scala-at-yammer/\n[mellowmorning_example]: http://www.mellowmorning.com/2013/10/18/scalable-pinterest-tutorial-feedly-redis/\n[Documentation]: https://stream-framework.readthedocs.io/\n[Bug Tracker]: https://github.com/tschellenbach/Stream-Framework/issues\n[Code]: http://github.com/tschellenbach/Stream-Framework\n[Travis CI]: http://travis-ci.org/tschellenbach/Stream-Framework/\n[Stackoverflow]: http://stackoverflow.com/questions/tagged/stream-framework\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/tschellenbach/Stream-Framework/", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "stream-framework-plus", "package_url": "https://pypi.org/project/stream-framework-plus/", "platform": "", "project_url": "https://pypi.org/project/stream-framework-plus/", "project_urls": {"Homepage": "https://github.com/tschellenbach/Stream-Framework/"}, "release_url": "https://pypi.org/project/stream-framework-plus/1.4.0.1/", "requires_dist": ["celery (>=3.0.0)", "six", "cassandra-driver (>=2.7.2) ; extra == 'cassandra'", "redis (>=3.0) ; extra == 'redis'", "Django (>=1.3) ; extra == 'test'", "mock ; extra == 'test'", "pep8 ; extra == 'test'", "unittest2 ; extra == 'test'", "pytest ; extra == 'test'"], "requires_python": "", "summary": "Stream Framework allows you to build complex feed and caching structures using Redis.", "version": "1.4.0.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h2>Stream Framework</h2>\n<p><a href=\"https://travis-ci.org/tschellenbach/Stream-Framework\" rel=\"nofollow\"><img alt=\"Build Status\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/0b45f49546f280da62a864b1d0572b2b1d6b5fef/68747470733a2f2f7472617669732d63692e6f72672f74736368656c6c656e626163682f53747265616d2d4672616d65776f726b2e7376673f6272616e63683d6d6173746572\"></a>\n<a href=\"https://stackshare.io/stream/stream-framework\" rel=\"nofollow\"><img alt=\"StackShare\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/a4109662d6303004f3aae0f646c765afc5d576d3/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f746563682d737461636b2d3036393066612e7376673f7374796c653d666c6174\"></a></p>\n<h2>Activity Streams &amp; Newsfeeds</h2>\n<p align=\"center\">\n  <img alt=\"Examples of what you can build\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/8bfbf20bceacde74d3c5f42e4cdfca8ca951390a/68747470733a2f2f6476716732646f6767676d6e362e636c6f756466726f6e742e6e65742f696d616765732f6d6f6f642d686f6d652e706e67\">\n</p>\n<p>Stream Framework is a Python library which allows you to build activity streams &amp; newsfeeds using Cassandra and/or Redis. If you're not using python have a look at <a href=\"https://getstream.io/\" rel=\"nofollow\">Stream</a>, which supports Node, Ruby, PHP, Python, Go, Scala, Java and REST.</p>\n<p>Examples of what you can build are:</p>\n<ul>\n<li>Activity streams such as seen on Github</li>\n<li>A Twitter style newsfeed</li>\n<li>A feed like Instagram/ Pinterest</li>\n<li>Facebook style newsfeeds</li>\n<li>A notification system</li>\n</ul>\n<p>(Feeds are also commonly called: Activity Streams, activity feeds, news streams.)</p>\n<h2>Stream</h2>\n<p><a href=\"https://getstream.io/\" rel=\"nofollow\"><img alt=\"Build scalable newsfeeds and activity streams using getstream.io\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/1eb693bf44a1f0d2193aaf7081c1c458748e8a85/687474703a2f2f6476716732646f6767676d6e362e636c6f756466726f6e742e6e65742f696d616765732f67657473747265616d2d646f742d696f2d6c6f676f2d6c696768742e706e67\" width=\"300px\"></a></p>\n<p>Stream Framework's authors also offer a web service for building scalable newsfeeds &amp; activity streams at <a href=\"https://getstream.io/\" rel=\"nofollow\">Stream</a>.\nIt allows you to create your feeds by talking to a beautiful and easy to use REST API. There are clients available for Node, Ruby, PHP, Python, Go, Scala and Java. The <a href=\"https://getstream.io/get_started/#intro\" rel=\"nofollow\">Get Started</a> page explains the API &amp; concept in a few clicks. It's a lot easier to use, free up to 3 million feed updates and saves you the hassle of maintaining Cassandra, Redis, Faye, RabbitMQ and Celery workers.</p>\n<h2>Background Articles</h2>\n<p>A lot has been written about the best approaches to building feed based systems.\nHere's a collection of some of the talks:</p>\n<ul>\n<li><a href=\"http://highscalability.com/blog/2013/7/8/the-architecture-twitter-uses-to-deal-with-150m-active-users.html\" rel=\"nofollow\">Twitter 2013</a>: Redis based, database fallback, very similar to Fashiolista's old approach.</li>\n<li><a href=\"http://www.slideshare.net/danmckinley/etsy-activity-feeds-architecture/\" rel=\"nofollow\">Etsy feed scaling</a>: Gearman, separate scoring and aggregation steps, rollups - aggregation part two</li>\n<li><a href=\"https://engineering.linkedin.com/blog/2016/03/followfeed--linkedin-s-feed-made-faster-and-smarter\" rel=\"nofollow\">LinkedIn ranked feeds</a></li>\n<li><a href=\"http://www.infoq.com/presentations/Facebook-Software-Stack\" rel=\"nofollow\">Facebook history</a></li>\n<li><a href=\"https://github.com/justquick/django-activity-stream\" rel=\"nofollow\">Django project with good naming conventions</a></li>\n<li><a href=\"http://activitystrea.ms/specs/atom/1.0/\" rel=\"nofollow\">Activity stream specification</a></li>\n<li><a href=\"http://www.quora.com/What-are-best-practices-for-building-something-like-a-News-Feed?q=news+feeds\" rel=\"nofollow\">Quora post on best practices</a></li>\n<li><a href=\"http://www.quora.com/What-are-the-scaling-issues-to-keep-in-mind-while-developing-a-social-network-feed\" rel=\"nofollow\">Quora scaling a social network feed</a></li>\n<li><a href=\"http://blog.waxman.me/how-to-build-a-fast-news-feed-in-redis\" rel=\"nofollow\">Redis ruby example</a></li>\n<li><a href=\"http://backchannel.org/blog/friendfeed-schemaless-mysql\" rel=\"nofollow\">FriendFeed approach</a></li>\n<li><a href=\"http://blog.thoonk.com/\" rel=\"nofollow\">Thoonk setup</a></li>\n<li><a href=\"http://jeffterrace.com/docs/feeding-frenzy-sigmod10-web.pdf\" rel=\"nofollow\">Yahoo Research Paper</a></li>\n<li><a href=\"http://www.slideshare.net/nkallen/q-con-3770885\" rel=\"nofollow\">Twitter\u2019s approach</a></li>\n<li><a href=\"http://planetcassandra.org/blog/post/instagram-making-the-switch-to-cassandra-from-redis-75-instasavings\" rel=\"nofollow\">Cassandra at Instagram</a></li>\n<li><a href=\"http://mimno.infosci.cornell.edu/info6150/readings/p1640-hu.pdf\" rel=\"nofollow\">Relevancy at Etsy</a></li>\n<li><a href=\"http://blog.zite.com/2012/01/11/zite-under-the-hood/\" rel=\"nofollow\">Zite architecture overview</a></li>\n<li><a href=\"https://speakerdeck.com/viadeoteam/a-personalized-news-feed\" rel=\"nofollow\">Ranked feeds with ES</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=38yKu5HR-tM\" rel=\"nofollow\">Riak at Xing - by Dr. Stefan Kaes &amp; Sebastian R\u00f6bke</a></li>\n<li><a href=\"http://basho.com/posts/business/riak-and-scala-at-yammer/\" rel=\"nofollow\">Riak and Scala at Yammer</a></li>\n</ul>\n<h2>Stream Framework</h2>\n<p><strong>Installation</strong></p>\n<p>Installation through <code>pip</code> is recommended::</p>\n<pre><code>$ pip install stream-framework\n</code></pre>\n<p>By default <code>stream-framework</code> does not install the required dependencies for redis and cassandra:</p>\n<p><em><strong>Install stream-framework with Redis dependencies</strong></em></p>\n<pre><code>$ pip install stream-framework[redis]\n</code></pre>\n<p><em><strong>Install stream-framework with Cassandra dependencies</strong></em></p>\n<pre><code>$ pip install stream-framework[cassandra]\n</code></pre>\n<p><em><strong>Install stream-framework with both Redis and Cassandra dependencies</strong></em></p>\n<pre><code>$ pip install stream-framework[redis,cassandra]\n</code></pre>\n<p><strong>Authors &amp; Contributors</strong></p>\n<ul>\n<li>Thierry Schellenbach (<a href=\"mailto:thierry@getstream.io\">thierry@getstream.io</a>)</li>\n<li>Tommaso Barbugli (<a href=\"mailto:tommaso@getstream.io\">tommaso@getstream.io</a>)</li>\n<li>Anislav Atanasov</li>\n<li>Guyon Mor\u00e9e</li>\n</ul>\n<p><strong>Resources</strong></p>\n<ul>\n<li><a href=\"https://stream-framework.readthedocs.io/\" rel=\"nofollow\">Documentation</a></li>\n<li><a href=\"https://github.com/tschellenbach/Stream-Framework/issues\" rel=\"nofollow\">Bug Tracker</a></li>\n<li><a href=\"http://github.com/tschellenbach/Stream-Framework\" rel=\"nofollow\">Code</a></li>\n<li><a href=\"http://travis-ci.org/tschellenbach/Stream-Framework/\" rel=\"nofollow\">Travis CI</a></li>\n<li><a href=\"http://stackoverflow.com/questions/tagged/stream-framework\" rel=\"nofollow\">Stackoverflow</a></li>\n</ul>\n<p><strong>Example application</strong></p>\n<p>We've included a <a href=\"https://github.com/tbarbugli/stream_framework_example\" rel=\"nofollow\">Pinterest-like example application</a> based on Stream Framework.</p>\n<p><strong>Tutorials</strong></p>\n<ul>\n<li><a href=\"http://www.mellowmorning.com/2013/10/18/scalable-pinterest-tutorial-feedly-redis/\" rel=\"nofollow\">Pinterest-style feed example app</a></li>\n</ul>\n<h2>Using Stream Framework</h2>\n<p>This quick example will show you how to publish a \"Pin\" to all your followers. So let's create an activity for the item you just pinned.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">stream_framework.activity</span> <span class=\"kn\">import</span> <span class=\"n\">Activity</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">create_activity</span><span class=\"p\">(</span><span class=\"n\">pin</span><span class=\"p\">):</span>\n    <span class=\"n\">activity</span> <span class=\"o\">=</span> <span class=\"n\">Activity</span><span class=\"p\">(</span>\n        <span class=\"n\">pin</span><span class=\"o\">.</span><span class=\"n\">user_id</span><span class=\"p\">,</span>\n        <span class=\"n\">PinVerb</span><span class=\"p\">,</span>\n        <span class=\"n\">pin</span><span class=\"o\">.</span><span class=\"n\">id</span><span class=\"p\">,</span>\n        <span class=\"n\">pin</span><span class=\"o\">.</span><span class=\"n\">influencer_id</span><span class=\"p\">,</span>\n        <span class=\"n\">time</span><span class=\"o\">=</span><span class=\"n\">make_naive</span><span class=\"p\">(</span><span class=\"n\">pin</span><span class=\"o\">.</span><span class=\"n\">created_at</span><span class=\"p\">,</span> <span class=\"n\">pytz</span><span class=\"o\">.</span><span class=\"n\">utc</span><span class=\"p\">),</span>\n        <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">item_id</span><span class=\"o\">=</span><span class=\"n\">pin</span><span class=\"o\">.</span><span class=\"n\">item_id</span><span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">activity</span>\n</pre>\n<p>Next up we want to start publishing this activity on several feeds.\nFirst of all, we want to insert it into your personal feed, and then into your followers' feeds.\nLet's start by defining these feeds.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">stream_framework.feeds.redis</span> <span class=\"kn\">import</span> <span class=\"n\">RedisFeed</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">UserPinFeed</span><span class=\"p\">(</span><span class=\"n\">PinFeed</span><span class=\"p\">):</span>\n    <span class=\"n\">key_format</span> <span class=\"o\">=</span> <span class=\"s1\">'feed:user:</span><span class=\"si\">%(user_id)s</span><span class=\"s1\">'</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PinFeed</span><span class=\"p\">(</span><span class=\"n\">RedisFeed</span><span class=\"p\">):</span>\n    <span class=\"n\">key_format</span> <span class=\"o\">=</span> <span class=\"s1\">'feed:normal:</span><span class=\"si\">%(user_id)s</span><span class=\"s1\">'</span>\n</pre>\n<p>Writing to these feeds is very simple. For instance to write to the feed of user 13 one would do:</p>\n<pre><span class=\"n\">feed</span> <span class=\"o\">=</span> <span class=\"n\">UserPinFeed</span><span class=\"p\">(</span><span class=\"mi\">13</span><span class=\"p\">)</span>\n<span class=\"n\">feed</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">activity</span><span class=\"p\">)</span>\n</pre>\n<p>But we don't want to publish to just one users feed. We want to publish to the feeds of all users which follow you.\nThis action is called a \"fanout\" and is abstracted away in the manager class.\nWe need to subclass the Manager class and tell it how we can figure out which users follow us.</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">stream_framework.feed_managers.base</span> <span class=\"kn\">import</span> <span class=\"n\">Manager</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PinManager</span><span class=\"p\">(</span><span class=\"n\">Manager</span><span class=\"p\">):</span>\n    <span class=\"n\">feed_classes</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">(</span>\n        <span class=\"n\">normal</span><span class=\"o\">=</span><span class=\"n\">PinFeed</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">user_feed_class</span> <span class=\"o\">=</span> <span class=\"n\">UserPinFeed</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">add_pin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pin</span><span class=\"p\">):</span>\n        <span class=\"n\">activity</span> <span class=\"o\">=</span> <span class=\"n\">pin</span><span class=\"o\">.</span><span class=\"n\">create_activity</span><span class=\"p\">()</span>\n        <span class=\"c1\"># add user activity adds it to the user feed, and starts the fanout</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add_user_activity</span><span class=\"p\">(</span><span class=\"n\">pin</span><span class=\"o\">.</span><span class=\"n\">user_id</span><span class=\"p\">,</span> <span class=\"n\">activity</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_user_follower_ids</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">user_id</span><span class=\"p\">):</span>\n        <span class=\"n\">ids</span> <span class=\"o\">=</span> <span class=\"n\">Follow</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"o\">=</span><span class=\"n\">user_id</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">values_list</span><span class=\"p\">(</span><span class=\"s1\">'user_id'</span><span class=\"p\">,</span> <span class=\"n\">flat</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"p\">{</span><span class=\"n\">FanoutPriority</span><span class=\"o\">.</span><span class=\"n\">HIGH</span><span class=\"p\">:</span><span class=\"n\">ids</span><span class=\"p\">}</span>\n\n<span class=\"n\">manager</span> <span class=\"o\">=</span> <span class=\"n\">PinManager</span><span class=\"p\">()</span>\n</pre>\n<p>Now that the manager class is set up, broadcasting a pin becomes as easy as:</p>\n<pre><span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">add_pin</span><span class=\"p\">(</span><span class=\"n\">pin</span><span class=\"p\">)</span>\n</pre>\n<p>Calling this method will insert the pin into your personal feed and into all the feeds of users which follow you.\nIt does so by spawning many small tasks via Celery. In Django (or any other framework) you can now show the users feed.</p>\n<pre><span class=\"c1\"># django example</span>\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">feed</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"sd\">'''</span>\n<span class=\"sd\">    Items pinned by the people you follow</span>\n<span class=\"sd\">    '''</span>\n    <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"n\">RequestContext</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n    <span class=\"n\">feed</span> <span class=\"o\">=</span> <span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">get_feeds</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">id</span><span class=\"p\">)[</span><span class=\"s1\">'normal'</span><span class=\"p\">]</span>\n    <span class=\"n\">activities</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">feed</span><span class=\"p\">[:</span><span class=\"mi\">25</span><span class=\"p\">])</span>\n    <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s1\">'activities'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">activities</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">render_to_response</span><span class=\"p\">(</span><span class=\"s1\">'core/feed.html'</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">response</span>\n</pre>\n<p>This example only briefly covered how Stream Framework works.\nThe full explanation can be found on <a href=\"https://stream-framework.readthedocs.io/\" rel=\"nofollow\">the documentation</a>.</p>\n<h2>Features</h2>\n<p>Stream Framework uses Celery and Redis/Cassandra to build a system with heavy writes and extremely light reads.\nIt features:</p>\n<ul>\n<li>Asynchronous tasks (All the heavy lifting happens in the background, your users don't wait for it)</li>\n<li>Reusable components (You will need to make tradeoffs based on your use cases, Stream Framework doesn't get in your way)</li>\n<li>Full Cassandra and Redis support</li>\n<li>The Cassandra storage uses the new CQL3 and Python-Driver packages, which give you access to the latest Cassandra features.</li>\n<li>Build for the extremely performant Cassandra 2.1. 2.2 and 3.3 also pass the test suite, but no production experience.</li>\n</ul>\n\n\n          </div>"}, "last_serial": 5781866, "releases": {"1.4.0.1": [{"comment_text": "", "digests": {"md5": "71974808eb08983db838c9da3a464ef1", "sha256": "ed31571d52ddc61b83eca0d6897558ddc20ea4659850fc74e11da989436797b4"}, "downloads": -1, "filename": "stream_framework_plus-1.4.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "71974808eb08983db838c9da3a464ef1", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 97321, "upload_time": "2019-09-04T15:15:26", "upload_time_iso_8601": "2019-09-04T15:15:26.302549Z", "url": "https://files.pythonhosted.org/packages/93/7c/a9bfb97aa18f14429b8d1acf5a0315ca2c950027a6a5eb3d973de81836e0/stream_framework_plus-1.4.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "046ff398b73222579e06012599a75f6a", "sha256": "15f97aaf3cb799e8e333a49d8bb8b358419cd70c35d3942d8bd54535b5975b3a"}, "downloads": -1, "filename": "stream-framework-plus-1.4.0.1.tar.gz", "has_sig": false, "md5_digest": "046ff398b73222579e06012599a75f6a", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 69094, "upload_time": "2019-09-04T15:15:29", "upload_time_iso_8601": "2019-09-04T15:15:29.750785Z", "url": "https://files.pythonhosted.org/packages/45/05/a25286d91845a79df51ba75eb13f23f0b925fa361943c9789464ee2fd3ae/stream-framework-plus-1.4.0.1.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "71974808eb08983db838c9da3a464ef1", "sha256": "ed31571d52ddc61b83eca0d6897558ddc20ea4659850fc74e11da989436797b4"}, "downloads": -1, "filename": "stream_framework_plus-1.4.0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "71974808eb08983db838c9da3a464ef1", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 97321, "upload_time": "2019-09-04T15:15:26", "upload_time_iso_8601": "2019-09-04T15:15:26.302549Z", "url": "https://files.pythonhosted.org/packages/93/7c/a9bfb97aa18f14429b8d1acf5a0315ca2c950027a6a5eb3d973de81836e0/stream_framework_plus-1.4.0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "046ff398b73222579e06012599a75f6a", "sha256": "15f97aaf3cb799e8e333a49d8bb8b358419cd70c35d3942d8bd54535b5975b3a"}, "downloads": -1, "filename": "stream-framework-plus-1.4.0.1.tar.gz", "has_sig": false, "md5_digest": "046ff398b73222579e06012599a75f6a", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 69094, "upload_time": "2019-09-04T15:15:29", "upload_time_iso_8601": "2019-09-04T15:15:29.750785Z", "url": "https://files.pythonhosted.org/packages/45/05/a25286d91845a79df51ba75eb13f23f0b925fa361943c9789464ee2fd3ae/stream-framework-plus-1.4.0.1.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:01:22 2020"}