{"info": {"author": "Justin Pierce", "author_email": "jupierce@redhat.com", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Intended Audience :: Developers", "Intended Audience :: Information Technology", "License :: OSI Approved :: Apache Software License", "Operating System :: OS Independent", "Programming Language :: Python", "Programming Language :: Python :: 2", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: 3", "Programming Language :: Python :: 3.5", "Topic :: Utilities"], "description": "# Openshift Python Client\n<!-- Install doctoc with `npm install -g doctoc`  then `doctoc README.md --github` -->\n\n<!-- START doctoc generated TOC please keep comment here to allow auto update -->\n<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->\n**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*\n\n- [Overview](#overview)\n- [Reader Prerequisites](#reader-prerequisites)\n- [Setup](#setup)\n  - [Prerequisites](#prerequisites)\n  - [Installation Instructions](#installation-instructions)\n    - [Using PIP](#using-pip)\n    - [For development](#for-development)\n- [Usage](#usage)\n  - [Quickstart](#quickstart)\n  - [Selectors](#selectors)\n  - [APIObjects](#apiobjects)\n  - [Making changes to APIObjects](#making-changes-to-apiobjects)\n  - [Running within a Pod](#running-within-a-pod)\n  - [Tracking oc invocations](#tracking-oc-invocations)\n  - [Time limits](#time-limits)\n  - [Advanced contexts](#advanced-contexts)\n  - [Something missing?](#something-missing)\n  - [Running oc on a bastion host](#running-oc-on-a-bastion-host)\n  - [Gathering reports and logs with selectors](#gathering-reports-and-logs-with-selectors)\n  - [Advanced verbs:](#advanced-verbs)\n- [Examples](#examples)\n- [Environment Variables](#environment-variables)\n  - [Defaults when invoking `oc`](#defaults-when-invoking-oc)\n  - [Master timeout](#master-timeout)\n  - [SSH Client Host](#ssh-client-host)\n\n<!-- END doctoc generated TOC please keep comment here to allow auto update -->\n\n## Overview\nThe [openshift-client-python](https://www.github.com/openshift/openshift-client-python) library aims to provide a readable, concise, comprehensive, and fluent\nAPI for rich interactions with an [OpenShift](https://www.openshift.com) cluster. Unlike other clients, this library exclusively uses the command\nline tool (oc) to achieve the interactions. This approach comes with important benefits and disadvantages when compared\nto other client libraries.\n\nPros:\n- No additional software needs to be installed on the cluster. If a system with python support can (1) invoke `oc`\nlocally OR (2) ssh to a host and invoke `oc`, you can use the library.\n- Portable. If you have python and `oc` working, you don't need to worry about OpenShift versions or machine architectures.\n- Custom resources are supported and treated just like any other resource. There is no need to generate code to support them.\n- Quick to learn. If you understand the `oc` command line interface, you can use this library.\n\nCons:\n- This API is not intended to implement something as complex as a controller. For example, it does not implement\nwatch functionality. If you can't imagine accomplishing your use case through CLI interactions, this API is probably \nnot the right starting point for it. \n- If you care about whether a REST API returns a particular error code, this API is probably not for you. Since it\nis based on the CLI, high level return codes are used to determine success or failure.\n\n## Reader Prerequisites\n* Familiarity with OpenShift [command line interface](https://docs.openshift.org/latest/cli_reference/basic_cli_operations.html)\nis highly encouraged before exploring the API's features. The API leverages the [oc](https://docs.openshift.org/latest/cli_reference/index.html)\nbinary and, in many cases, passes method arguments directly on to the command line. This document cannot, therefore,\nprovide a complete description of all possible OpenShift interactions -- the user may need to reference\nthe CLI documentation to find the pass-through arguments a given interaction requires.\n\n* A familiarity with Python is assumed.\n\n## Setup\n### Prerequisites\n1. Download and install the OpenShift [command-line Tools](https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/) needed to access your OpenShift cluster.\n\n### Installation Instructions\n\n#### Using PIP\n1. Install the `openshift-client` module from PyPI.\n    ```bash\n    sudo pip install openshift-client\n    ```\n\n#### For development\n1. Git clone https://github.com/openshift/openshift-client-python.git (or your fork).\n2. Append ./packages to your PYTHONPATH environment variable (e.g. export PYTHONPATH=$(pwd)/packages:$PYTHONPATH).\n3. Write and run your python script!\n\n## Usage\n\n### Quickstart\nAny standard Python application should be able to use the API if it imports the openshift package. The simplest\npossible way to begin using the API is login to your target cluster before running your first application.\n\nCan you run `oc project` successfully from the command line? Then write your app!\n\n```python\n#!/usr/bin/python\nimport openshift as oc\n\nprint('OpenShift client version: {}'.format(oc.get_client_version()))\nprint('OpenShift server version: {}'.format(oc.get_server_version()))\n\n# Set a project context for all inner `oc` invocations and limit execution to 10 minutes\nwith oc.project('openshift-infra'), oc.timeout(10*60):\n    # Print the list of qualified pod names (e.g. ['pod/xyz', 'pod/abc', ...]  in the current project\n    print('Found the following pods in {}: {}'.format(oc.get_project_name(), oc.selector('pods').qnames()))\n\n    # Read in the current state of the pod resources and represent them as python objects\n    for pod_obj in oc.selector('pods').objects():\n\n        # The APIObject class exposes several convenience methods for interacting with objects\n        print('Analyzing pod: {}'.format(pod_obj.name()))\n        pod_obj.print_logs(timestamps=True, tail=15)\n\n        # If you need access to the underlying resource definition, get a Model instance for the resource\n        pod_model = pod_obj.model\n\n        # Model objects enable dot notation and allow you to navigate through resources\n        # to an arbitrary depth without checking if any ancestor elements exist.\n        # In the following example, there is no need for boilerplate like:\n        #    `if .... 'ownerReferences' in pod_model['metadata'] ....`\n        # Fields that do not resolve will always return oc.Missing which \n        # is a singleton and can also be treated as an empty dict.\n        for owner in pod_model.metadata.ownerReferences:  # ownerReferences == oc.Missing if not present in resource\n            # elements of a Model are also instances of Model or ListModel\n            if owner.kind is not oc.Missing:  # Compare as singleton\n                print('  pod owned by a {}'.format(owner.kind))  # e.g. pod was created by a StatefulSet\n\n```\n\n### Selectors\nSelectors are a central concept used by the API to interact with collections\nof OpenShift resources. As the name implies, a \"selector\" selects zero or\nmore resources on a server which satisfy user specified criteria. An apt\nmetaphor for a selector might be a prepared SQL statement which can be\nused again and again to select rows from a database.\n\n```python\n# Create a selector which selects all projects.\nproject_selector = oc.selector(\"projects\")\n\n# Print the qualified name (i.e. \"kind/name\") of each resource selected.\nprint(\"Project names: \" + project_selector.qnames())\n\n# Count the number of projects on the server.\nprint(\"Number of projects: \" + project_selector.count_existing())\n\n# Selectors can also be created with a list of names.\nsa_selector = oc.selector([\"serviceaccount/deployer\", \"serviceaccount/builder\"])\n\n# Performing an operation will act on all selected resources. In this case,\n# both serviceaccounts are labeled.\nsa_selector.label({\"mylabel\" : \"myvalue\"})\n\n# Selectors can also select based on kind and labels.\nsa_label_selector = oc.selector(\"sa\", labels={\"mylabel\":\"myvalue\"})\n\n# We should find the service accounts we just labeled.\nprint(\"Found labeled serviceaccounts: \" + sa_label_selector.names())\n\n# Create a selector for a set of kinds.\nprint(oc.selector(['dc', 'daemonset']).describe())\n```\n\nThe output should look something like this:\n\n```\nProject names: [u'projects/default', u'projects/kube-system', u'projects/myproject', u'projects/openshift', u'projects/openshift-infra', u'projects/temp-1495937701365', u'projects/temp-1495937860505', u'projects/temp-1495937908009']\nNumber of projects: 8\nFound labeled serviceaccounts: [u'serviceaccounts/builder', u'serviceaccounts/deployer']\n```\n\n### APIObjects\n\nSelectors allow you to perform \"verb\" level operations on a set of objects, but\nwhat if you want to interact objects at a schema level?\n\n```python\nprojects_sel = oc.selector(\"projects\")\n\n# .objects() will perform the selection and return a list of APIObjects\n# which model the selected resources.\nprojects = projects_sel.objects()\n\nprint(\"Selected \" + len(projects) + \" projects\")\n\n# Let's store one of the project APIObjects for easy access.\nproject = projects[0]\n\n# The APIObject exposes methods providing simple access to metadata and common operations.\nprint('The project is: {}/{}'.format(project.kind(), project.name()))\nproject.label({ 'mylabel': 'myvalue' })\n\n# And the APIObject allow you to interact with an object's data via the 'model' attribute.\n# The Model is similar to a standard dict, but also allows dot notation to access elements\n# of the structured data.\nprint('Annotations:\\n{}\\n'.format(project.model.metadata.annotations))\n\n# There is no need to perform the verbose 'in' checking you may be familiar with when\n# exploring a Model object. Accessing Model attributes will always return a value. If the\n# any component of a path into the object does not exist in the underlying model, the\n# singleton 'Missing' will be returned.\n\nif project.model.metadata.annotations.myannotation is oc.Missing:\n    print(\"This object has not been annotated yet\")\n\n# If a field in the model contains special characters, use standard Python notation\n# to access the key instead of dot notation.\nif project.model.metadata.annotations['my-annotation'] is oc.Missing:\n    print(\"This object has not been annotated yet\")\n\n# For debugging, you can always see the state of the underlying model by printing the\n# APIObject as JSON.\nprint('{}'.format(project.as_json()))\n\n# Or getting deep copy dict. Changes made to this dict will not affect the APIObject.\nd = project.as_dict()\n\n# Model objects also simplify looking through kubernetes style lists. For example, can_match\n# returns True if the modeled list contains an object with the subset of attributes specified.\n# If this example, we are checking if the a node's kubelet is reporting Ready:\noc.selector('node/alpha').object().model.status.conditions.can_match(\n    {\n        'type': 'Ready',\n        'status': \"True\",\n    }\n)\n\n# can_match can also ensure nest objects and list are present within a resource. Several\n# of these types of checks are already implemented in the openshift.status module.\ndef is_route_admitted(apiobj):\n    return apiobj.model.status.can_match({\n        'ingress': [\n            {\n                'conditions': [\n                    {\n                        'type': 'Admitted',\n                        'status': 'True',\n                    }\n                ]\n            }\n        ]\n    })\n```\n\n\n### Making changes to APIObjects\n```python\n# APIObject exposes simple interfaces to delete and patch the resource it represents.\n# But, more interestingly, you can make detailed changes to the model and apply those\n# changes to the API.\n\nproject.model.metadata.labels['my_label'] = 'myvalue'\nproject.apply()\n\n# If modifying the underlying API resources could be contentious, use the more robust\n# modify_and_apply method which can retry the operation multiple times -- refreshing\n# with the current object state between failures.\n\n# First, define a function that will make changes to the model.\ndef make_model_change(apiobj):\n    apiobj.model.data['somefile.yaml'] = 'wyxz'\n    return True\n\n# modify_and_apply will call the function and attempt to apply its changes to the model\n# if it returns True. If the apply is rejected by the API, the function will pull\n# the latest object content, call make_model_change again, and try the apply again\n# up to the specified retry account.\nconfigmap.modify_and_apply(make_model_change, retries=5)\n\n\n# For best results, ensure the function passed to modify_and_apply is idempotent:\n\ndef set_unmanaged_in_cvo(apiobj):\n    desired_entry = {\n        'group': 'config.openshift.io/v1',\n        'kind': 'ClusterOperator',\n        'name': 'openshift-samples',\n        'unmanaged': True,\n    }\n\n    if apiobj.model.spec.overrides.can_match(desired_entry):\n        # No change required\n        return False\n\n    if not apiobj.model.spec.overrides:\n        apiobj.model.spec.overrides = []\n\n    context.progress('Attempting to disable CVO interest in openshift-samples operator')\n    apiobj.model.spec.overrides.append(desired_entry)\n    return True\n\nresult, changed = oc.selector('clusterversion.config.openshift.io/version').object().modify_and_apply(set_unmanaged_in_cvo)\nif changed:\n    context.report_change('Instructed CVO to ignore openshift-samples operator')\n\n```\n\n\n### Running within a Pod\nIt is simple to use the API within a Pod. The `oc` binary automatically\ndetects it is running within a container and automatically uses the Pod's serviceaccount token/cacert.\n\n### Tracking oc invocations\nIt is good practice to setup at least one tracking context within your application so that\nyou will be able to easily analyze what `oc` invocations were made on your behalf and the result\nof those operations. *Note that details about all `oc` invocations performed within the context will\nbe stored within the tracker. Therefore, do not use a single tracker for a continuously running\nprocess -- it will consume memory for every oc invocation.*\n\n```python\n#!/usr/bin/python\nimport openshift as oc\n\nwith oc.tracking() as tracker:\n    try:\n        print('Current user: {}'.format(oc.whoami()))\n    except:\n        print('Error acquiring current username')\n\n    # Print out details about the invocations made within this context.\n    print(tracker.get_result())\n```\n\nIn this case, the tracking output would look something like:\n```json\n{\n    \"status\": 0, \n    \"operation\": \"tracking\", \n    \"actions\": [\n        {\n            \"status\": 0, \n            \"verb\": \"project\", \n            \"references\": {}, \n            \"in\": null, \n            \"out\": \"aos-cd\\n\", \n            \"err\": \"\", \n            \"cmd\": [\n                \"oc\", \n                \"project\", \n                \"-q\"\n            ], \n            \"elapsed_time\": 0.15344810485839844, \n            \"internal\": false, \n            \"timeout\": false, \n            \"last_attempt\": true\n        }, \n        {\n            \"status\": 0, \n            \"verb\": \"whoami\", \n            \"references\": {}, \n            \"in\": null, \n            \"out\": \"aos-ci-jenkins\\n\", \n            \"err\": \"\", \n            \"cmd\": [\n                \"oc\", \n                \"whoami\"\n            ], \n            \"elapsed_time\": 0.6328380107879639, \n            \"internal\": false, \n            \"timeout\": false, \n            \"last_attempt\": true\n        }\n    ]\n}\n```\n\nAlternatively, you can record actions yourself by passing an action_handler to the tracking \ncontextmanager. Your action handler will be invoked each time an `oc` invocation completes.\n\n```python\ndef print_action(action):\n    print('Performed: {} - status={}'.format(action.cmd, action.status))\n\nwith oc.tracking(action_handler=print_action):\n    try:\n        print('Current project: {}'.format(oc.get_project_name()))\n        print('Current user: {}'.format(oc.whoami()))\n    except:\n        print('Error acquiring details about project/user')\n\n```\n\n### Time limits\nHave a script you want to ensure succeeds or fails within a specific period of time? Use\na `timeout` context. Timeout contexts can be nested - if any timeout context expires, \nthe current oc invocation will be killed. \n\n```python\n#!/usr/bin/python\nimport openshift as oc\n\ndef node_is_ready(node):\n    ready = node.model.status.conditions.can_match({\n        'type': 'Ready',\n        'status': 'True',\n    })\n    return ready\n\n\nprint(\"Waiting for up to 15 minutes for at least 6 nodes to be ready...\")\nwith oc.timeout(15 * 60):\n    oc.selector('nodes').until_all(6, success_func=node_is_ready)\n    print(\"All detected nodes are reporting ready\")\n```        \n\nYou will be able to see in `tracking` context results that a timeout occurred for an affected\ninvocation. The `timeout` field will be set to `True`.\n\n### Advanced contexts\nIf you are unable to use a KUBECONFIG environment variable or need fine grained control over the \nserver/credentials you communicate with for each invocation, use openshift-client-python contexts. \nContexts can be nested and cause oc invocations within them to use the most recently established \ncontext information.\n\n```python\nwith oc.api_server('https:///....'):  # use the specified api server for nested oc invocations.\n\n    with oc.token('abc..'):  # --server=... --token=abc... will be included in inner oc invocations.\n        print(\"Current project: \" + oc.get_project_name())\n\n    with oc.token('def..'):  # --server=... --token=def... will be included in inner oc invocations.\n        print(\"Current project: \" + oc.get_project_name())\n```\n\nYou can control the loglevel specified  for `oc` invocations.\n```python\nwith oc.loglevel(6):\n   # all oc invocations within this context will be invoked with --loglevel=6\n    oc...   \n```\n\nYou ask `oc` to skip TLS verification if necessary.\n```python\nwith oc.tls_verify(enable=False):\n   # all oc invocations within this context will be invoked with --insecure-skip-tls-verify\n    oc...   \n```\n\n### Something missing?\nMost common API iterations have abstractions, but if there is no openshift-client-python API \nexposing the `oc` function you want to run, you can always use `oc.invoke` to directly pass arguments to \nan `oc` invocation on your host.\n\n```python\n# oc adm policy add-scc-to-user privileged -z my-sa-name\noc.invoke('adm', ['policy', 'add-scc-to-user', 'privileged', '-z', 'my-sa-name'])\n```\n\n### Running oc on a bastion host\n\nIs your oc binary on a remote host? No problem. Easily remote all CLI interactions over SSH using the client_host\ncontext. Before running this command, you will need to load your ssh agent up with a key\nappropriate to the target client host.\n\n```python\nwith openshift.client_host(hostname=\"my.cluster.com\", username=\"root\", auto_add_host=True):\n    # oc invocations will take place on my.cluster.com host as the root user.\n    print(\"Current project: \" + oc.get_project_name())\n```\n\nUsing this model, your Python script will run exactly where you launch it, but all oc invocations will\noccur on the remote host.\n\n### Gathering reports and logs with selectors\n\nVarious objects within OpenShift have logs associated with them:\n- pods\n- deployments\n- daemonsets\n- statefulsets\n- builds\n- etc..\n\nA selector can gather logs from pods associated with each (and for each container within those pods). Each\nlog will be a unique value in the dictionary returned.\n\n```python\n# Print logs for all pods associated with all daemonsets & deployments in openshift-monitoring namespace.\nwith oc.project('openshift-monitoring'):\n    for k, v in oc.selector(['daemonset', 'deployment']).logs(tail=500).iteritems():\n        print('Container: {}\\n{}\\n\\n'.format(k, v))\n```\n\nThe above example would output something like:\n```\nContainer: openshift-monitoring:pod/node-exporter-hw5r5(node-exporter)\ntime=\"2018-10-22T21:07:36Z\" level=info msg=\"Starting node_exporter (version=0.16.0, branch=, revision=)\" source=\"node_exporter.go:82\"\ntime=\"2018-10-22T21:07:36Z\" level=info msg=\"Enabled collectors:\" source=\"node_exporter.go:90\"\ntime=\"2018-10-22T21:07:36Z\" level=info msg=\" - arp\" source=\"node_exporter.go:97\"\n...\n```\n\nNote that these logs are held in memory. Use tail or other available method parameters to ensure \npredictable and efficient results.\n\nTo simplify even further, you can ask the library to pretty-print the logs for you:\n```python\noc.selector(['daemonset', 'deployment']).print_logs()\n```\n\nAnd to quickly pull together significant diagnostic data on selected objects, use `report()` or `print_report()`. \nA report includes the following information for each selected object, if available:\n- `object` - The current state of the object.\n- `describe` - The output of describe on the object.\n- `logs` - If applicable, a map of logs -- one of each container associated with the object. \n\n```python\n# Pretty-print a detail set of data about all deploymentconfigs, builds, and configmaps in the \n# current namespace context.\noc.selector(['dc', 'build', 'configmap']).print_report()\n```\n\n### Advanced verbs:\n\nRunning oc exec on a pod.\n```python\n    result = oc.selector('pod/alertmanager-main-0').object().execute(['cat'],\n                                                                     container_name='alertmanager',\n                                                                     stdin='stdin for cat')\n    print(result.out())\n```\n\nFinding all pods running on a node:\n```python\nwith oc.client_host():\n    for node_name in oc.selector('nodes').qnames():\n        print('Pods running on node: {}'.format(node_name))\n            for pod_obj in oc.get_pods_by_node(node_name):\n                print('  {}'.format(pod_obj.fqname()))\n```\n\nExample output:\n```\n...\nPods running on node: node/ip-172-31-18-183.ca-central-1.compute.internal\n  72-sus:pod/sus-1-vgnmx\n  ameen-blog:pod/ameen-blog-2-t68qn\n  appejemplo:pod/ejemplo-1-txdt7\n  axxx:pod/mysql-5-lx2bc\n...\n```\n\n## Examples\n\n- [Some unit tests](examples/cluster_tests.py)\n\n## Environment Variables\nTo allow openshift-client-python applications to be portable between environments without needing to be modified, \nyou can specify many default contexts in the environment. \n\n### Defaults when invoking `oc`\nEstablishing explicit contexts within an application will override these environment defaults.\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_OC_PATH` - default path to use when invoking `oc`\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_CONFIG_PATH` - default `--config` argument\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_API_SERVER` - default `--server` argument\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_CA_CERT_PATH` - default `--cacert` argument\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_PROJECT` - default `--namespace` argument\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_OC_LOGLEVEL` - default `--loglevel` argument\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_SKIP_TLS_VERIFY` - default `--insecure-skip-tls-verify`\n\n### Master timeout\nDefines an implicit outer timeout(..) context for the entire application. This allows you to ensure\nthat an application terminates within a reasonable time, even if the author of the application has\nnot included explicit timeout contexts. Like any `timeout` context, this value is not overridden\nby subsequent `timeout` contexts within the application. It provides an upper bound for the entire\napplication's oc interactions.\n\n- `OPENSHIFT_CLIENT_PYTHON_MASTER_TIMEOUT` \n\n### SSH Client Host\nIn some cases, it is desirable to run an openshift-client-python application using a local `oc` binary and \nin other cases, the `oc` binary resides on a remote client. Encoding this decision in the application\nitself is unnecessary.\n\nSimply wrap you application in a `client_host` context without arguments. This will try to pull \nclient host information from environment variables if they are present. If they are not present,\nthe application will execute on the local host.\n\nFor example, the following application will ssh to `OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_HOSTNAME` if it is defined\nin the environment. Otherwise, `oc` interactions will be executed on the host running the python application.\n\n```python\nwith oc.client_host():  # if OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_HOSTNAME if not defined in the environment, this is a no-op\n    print( 'Found nodes: {}'.format(oc.selector('nodes').qnames()) ) \n```\n\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_HOSTNAME` - The hostname on which the `oc` binary resides\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_USERNAME` - Username to use for the ssh connection (optional)\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_PORT` - SSH port to use (optional; defaults to 22)\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_AUTO_ADD` - Defaults to `false`. If set to `true`, unknown hosts will automatically be trusted.\n- `OPENSHIFT_CLIENT_PYTHON_DEFAULT_LOAD_SYSTEM_HOST_KEYS` - Defaults to `true`. If true, the local known hosts information will be used.\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/openshift/openshift-client-python", "keywords": "OpenShift", "license": "", "maintainer": "Brad Williams", "maintainer_email": "brawilli@redhat.com", "name": "openshift-client", "package_url": "https://pypi.org/project/openshift-client/", "platform": "", "project_url": "https://pypi.org/project/openshift-client/", "project_urls": {"Homepage": "https://github.com/openshift/openshift-client-python"}, "release_url": "https://pypi.org/project/openshift-client/1.0.3/", "requires_dist": ["six", "pyyaml", "paramiko"], "requires_python": "", "summary": "OpenShift python client", "version": "1.0.3", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>Openshift Python Client</h1>\n\n\n\n<p><strong>Table of Contents</strong>  <em>generated with <a href=\"https://github.com/thlorenz/doctoc\" rel=\"nofollow\">DocToc</a></em></p>\n<ul>\n<li><a href=\"#overview\" rel=\"nofollow\">Overview</a></li>\n<li><a href=\"#reader-prerequisites\" rel=\"nofollow\">Reader Prerequisites</a></li>\n<li><a href=\"#setup\" rel=\"nofollow\">Setup</a>\n<ul>\n<li><a href=\"#prerequisites\" rel=\"nofollow\">Prerequisites</a></li>\n<li><a href=\"#installation-instructions\" rel=\"nofollow\">Installation Instructions</a>\n<ul>\n<li><a href=\"#using-pip\" rel=\"nofollow\">Using PIP</a></li>\n<li><a href=\"#for-development\" rel=\"nofollow\">For development</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#usage\" rel=\"nofollow\">Usage</a>\n<ul>\n<li><a href=\"#quickstart\" rel=\"nofollow\">Quickstart</a></li>\n<li><a href=\"#selectors\" rel=\"nofollow\">Selectors</a></li>\n<li><a href=\"#apiobjects\" rel=\"nofollow\">APIObjects</a></li>\n<li><a href=\"#making-changes-to-apiobjects\" rel=\"nofollow\">Making changes to APIObjects</a></li>\n<li><a href=\"#running-within-a-pod\" rel=\"nofollow\">Running within a Pod</a></li>\n<li><a href=\"#tracking-oc-invocations\" rel=\"nofollow\">Tracking oc invocations</a></li>\n<li><a href=\"#time-limits\" rel=\"nofollow\">Time limits</a></li>\n<li><a href=\"#advanced-contexts\" rel=\"nofollow\">Advanced contexts</a></li>\n<li><a href=\"#something-missing\" rel=\"nofollow\">Something missing?</a></li>\n<li><a href=\"#running-oc-on-a-bastion-host\" rel=\"nofollow\">Running oc on a bastion host</a></li>\n<li><a href=\"#gathering-reports-and-logs-with-selectors\" rel=\"nofollow\">Gathering reports and logs with selectors</a></li>\n<li><a href=\"#advanced-verbs\" rel=\"nofollow\">Advanced verbs:</a></li>\n</ul>\n</li>\n<li><a href=\"#examples\" rel=\"nofollow\">Examples</a></li>\n<li><a href=\"#environment-variables\" rel=\"nofollow\">Environment Variables</a>\n<ul>\n<li><a href=\"#defaults-when-invoking-oc\" rel=\"nofollow\">Defaults when invoking <code>oc</code></a></li>\n<li><a href=\"#master-timeout\" rel=\"nofollow\">Master timeout</a></li>\n<li><a href=\"#ssh-client-host\" rel=\"nofollow\">SSH Client Host</a></li>\n</ul>\n</li>\n</ul>\n\n<h2>Overview</h2>\n<p>The <a href=\"https://www.github.com/openshift/openshift-client-python\" rel=\"nofollow\">openshift-client-python</a> library aims to provide a readable, concise, comprehensive, and fluent\nAPI for rich interactions with an <a href=\"https://www.openshift.com\" rel=\"nofollow\">OpenShift</a> cluster. Unlike other clients, this library exclusively uses the command\nline tool (oc) to achieve the interactions. This approach comes with important benefits and disadvantages when compared\nto other client libraries.</p>\n<p>Pros:</p>\n<ul>\n<li>No additional software needs to be installed on the cluster. If a system with python support can (1) invoke <code>oc</code>\nlocally OR (2) ssh to a host and invoke <code>oc</code>, you can use the library.</li>\n<li>Portable. If you have python and <code>oc</code> working, you don't need to worry about OpenShift versions or machine architectures.</li>\n<li>Custom resources are supported and treated just like any other resource. There is no need to generate code to support them.</li>\n<li>Quick to learn. If you understand the <code>oc</code> command line interface, you can use this library.</li>\n</ul>\n<p>Cons:</p>\n<ul>\n<li>This API is not intended to implement something as complex as a controller. For example, it does not implement\nwatch functionality. If you can't imagine accomplishing your use case through CLI interactions, this API is probably\nnot the right starting point for it.</li>\n<li>If you care about whether a REST API returns a particular error code, this API is probably not for you. Since it\nis based on the CLI, high level return codes are used to determine success or failure.</li>\n</ul>\n<h2>Reader Prerequisites</h2>\n<ul>\n<li>\n<p>Familiarity with OpenShift <a href=\"https://docs.openshift.org/latest/cli_reference/basic_cli_operations.html\" rel=\"nofollow\">command line interface</a>\nis highly encouraged before exploring the API's features. The API leverages the <a href=\"https://docs.openshift.org/latest/cli_reference/index.html\" rel=\"nofollow\">oc</a>\nbinary and, in many cases, passes method arguments directly on to the command line. This document cannot, therefore,\nprovide a complete description of all possible OpenShift interactions -- the user may need to reference\nthe CLI documentation to find the pass-through arguments a given interaction requires.</p>\n</li>\n<li>\n<p>A familiarity with Python is assumed.</p>\n</li>\n</ul>\n<h2>Setup</h2>\n<h3>Prerequisites</h3>\n<ol>\n<li>Download and install the OpenShift <a href=\"https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/\" rel=\"nofollow\">command-line Tools</a> needed to access your OpenShift cluster.</li>\n</ol>\n<h3>Installation Instructions</h3>\n<h4>Using PIP</h4>\n<ol>\n<li>Install the <code>openshift-client</code> module from PyPI.\n<pre>sudo pip install openshift-client\n</pre>\n</li>\n</ol>\n<h4>For development</h4>\n<ol>\n<li>Git clone <a href=\"https://github.com/openshift/openshift-client-python.git\" rel=\"nofollow\">https://github.com/openshift/openshift-client-python.git</a> (or your fork).</li>\n<li>Append ./packages to your PYTHONPATH environment variable (e.g. export PYTHONPATH=$(pwd)/packages:$PYTHONPATH).</li>\n<li>Write and run your python script!</li>\n</ol>\n<h2>Usage</h2>\n<h3>Quickstart</h3>\n<p>Any standard Python application should be able to use the API if it imports the openshift package. The simplest\npossible way to begin using the API is login to your target cluster before running your first application.</p>\n<p>Can you run <code>oc project</code> successfully from the command line? Then write your app!</p>\n<pre><span class=\"ch\">#!/usr/bin/python</span>\n<span class=\"kn\">import</span> <span class=\"nn\">openshift</span> <span class=\"k\">as</span> <span class=\"nn\">oc</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'OpenShift client version: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">get_client_version</span><span class=\"p\">()))</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'OpenShift server version: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">get_server_version</span><span class=\"p\">()))</span>\n\n<span class=\"c1\"># Set a project context for all inner `oc` invocations and limit execution to 10 minutes</span>\n<span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">project</span><span class=\"p\">(</span><span class=\"s1\">'openshift-infra'</span><span class=\"p\">),</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">timeout</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"o\">*</span><span class=\"mi\">60</span><span class=\"p\">):</span>\n    <span class=\"c1\"># Print the list of qualified pod names (e.g. ['pod/xyz', 'pod/abc', ...]  in the current project</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Found the following pods in </span><span class=\"si\">{}</span><span class=\"s1\">: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">get_project_name</span><span class=\"p\">(),</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s1\">'pods'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">qnames</span><span class=\"p\">()))</span>\n\n    <span class=\"c1\"># Read in the current state of the pod resources and represent them as python objects</span>\n    <span class=\"k\">for</span> <span class=\"n\">pod_obj</span> <span class=\"ow\">in</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s1\">'pods'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">():</span>\n\n        <span class=\"c1\"># The APIObject class exposes several convenience methods for interacting with objects</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Analyzing pod: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">pod_obj</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">()))</span>\n        <span class=\"n\">pod_obj</span><span class=\"o\">.</span><span class=\"n\">print_logs</span><span class=\"p\">(</span><span class=\"n\">timestamps</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">tail</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># If you need access to the underlying resource definition, get a Model instance for the resource</span>\n        <span class=\"n\">pod_model</span> <span class=\"o\">=</span> <span class=\"n\">pod_obj</span><span class=\"o\">.</span><span class=\"n\">model</span>\n\n        <span class=\"c1\"># Model objects enable dot notation and allow you to navigate through resources</span>\n        <span class=\"c1\"># to an arbitrary depth without checking if any ancestor elements exist.</span>\n        <span class=\"c1\"># In the following example, there is no need for boilerplate like:</span>\n        <span class=\"c1\">#    `if .... 'ownerReferences' in pod_model['metadata'] ....`</span>\n        <span class=\"c1\"># Fields that do not resolve will always return oc.Missing which </span>\n        <span class=\"c1\"># is a singleton and can also be treated as an empty dict.</span>\n        <span class=\"k\">for</span> <span class=\"n\">owner</span> <span class=\"ow\">in</span> <span class=\"n\">pod_model</span><span class=\"o\">.</span><span class=\"n\">metadata</span><span class=\"o\">.</span><span class=\"n\">ownerReferences</span><span class=\"p\">:</span>  <span class=\"c1\"># ownerReferences == oc.Missing if not present in resource</span>\n            <span class=\"c1\"># elements of a Model are also instances of Model or ListModel</span>\n            <span class=\"k\">if</span> <span class=\"n\">owner</span><span class=\"o\">.</span><span class=\"n\">kind</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">Missing</span><span class=\"p\">:</span>  <span class=\"c1\"># Compare as singleton</span>\n                <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'  pod owned by a </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">owner</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"p\">))</span>  <span class=\"c1\"># e.g. pod was created by a StatefulSet</span>\n</pre>\n<h3>Selectors</h3>\n<p>Selectors are a central concept used by the API to interact with collections\nof OpenShift resources. As the name implies, a \"selector\" selects zero or\nmore resources on a server which satisfy user specified criteria. An apt\nmetaphor for a selector might be a prepared SQL statement which can be\nused again and again to select rows from a database.</p>\n<pre><span class=\"c1\"># Create a selector which selects all projects.</span>\n<span class=\"n\">project_selector</span> <span class=\"o\">=</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s2\">\"projects\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Print the qualified name (i.e. \"kind/name\") of each resource selected.</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Project names: \"</span> <span class=\"o\">+</span> <span class=\"n\">project_selector</span><span class=\"o\">.</span><span class=\"n\">qnames</span><span class=\"p\">())</span>\n\n<span class=\"c1\"># Count the number of projects on the server.</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Number of projects: \"</span> <span class=\"o\">+</span> <span class=\"n\">project_selector</span><span class=\"o\">.</span><span class=\"n\">count_existing</span><span class=\"p\">())</span>\n\n<span class=\"c1\"># Selectors can also be created with a list of names.</span>\n<span class=\"n\">sa_selector</span> <span class=\"o\">=</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">([</span><span class=\"s2\">\"serviceaccount/deployer\"</span><span class=\"p\">,</span> <span class=\"s2\">\"serviceaccount/builder\"</span><span class=\"p\">])</span>\n\n<span class=\"c1\"># Performing an operation will act on all selected resources. In this case,</span>\n<span class=\"c1\"># both serviceaccounts are labeled.</span>\n<span class=\"n\">sa_selector</span><span class=\"o\">.</span><span class=\"n\">label</span><span class=\"p\">({</span><span class=\"s2\">\"mylabel\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"myvalue\"</span><span class=\"p\">})</span>\n\n<span class=\"c1\"># Selectors can also select based on kind and labels.</span>\n<span class=\"n\">sa_label_selector</span> <span class=\"o\">=</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s2\">\"sa\"</span><span class=\"p\">,</span> <span class=\"n\">labels</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">\"mylabel\"</span><span class=\"p\">:</span><span class=\"s2\">\"myvalue\"</span><span class=\"p\">})</span>\n\n<span class=\"c1\"># We should find the service accounts we just labeled.</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Found labeled serviceaccounts: \"</span> <span class=\"o\">+</span> <span class=\"n\">sa_label_selector</span><span class=\"o\">.</span><span class=\"n\">names</span><span class=\"p\">())</span>\n\n<span class=\"c1\"># Create a selector for a set of kinds.</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">([</span><span class=\"s1\">'dc'</span><span class=\"p\">,</span> <span class=\"s1\">'daemonset'</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">describe</span><span class=\"p\">())</span>\n</pre>\n<p>The output should look something like this:</p>\n<pre><code>Project names: [u'projects/default', u'projects/kube-system', u'projects/myproject', u'projects/openshift', u'projects/openshift-infra', u'projects/temp-1495937701365', u'projects/temp-1495937860505', u'projects/temp-1495937908009']\nNumber of projects: 8\nFound labeled serviceaccounts: [u'serviceaccounts/builder', u'serviceaccounts/deployer']\n</code></pre>\n<h3>APIObjects</h3>\n<p>Selectors allow you to perform \"verb\" level operations on a set of objects, but\nwhat if you want to interact objects at a schema level?</p>\n<pre><span class=\"n\">projects_sel</span> <span class=\"o\">=</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s2\">\"projects\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># .objects() will perform the selection and return a list of APIObjects</span>\n<span class=\"c1\"># which model the selected resources.</span>\n<span class=\"n\">projects</span> <span class=\"o\">=</span> <span class=\"n\">projects_sel</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">()</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Selected \"</span> <span class=\"o\">+</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">projects</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"s2\">\" projects\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Let's store one of the project APIObjects for easy access.</span>\n<span class=\"n\">project</span> <span class=\"o\">=</span> <span class=\"n\">projects</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n<span class=\"c1\"># The APIObject exposes methods providing simple access to metadata and common operations.</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'The project is: </span><span class=\"si\">{}</span><span class=\"s1\">/</span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"p\">(),</span> <span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">()))</span>\n<span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">label</span><span class=\"p\">({</span> <span class=\"s1\">'mylabel'</span><span class=\"p\">:</span> <span class=\"s1\">'myvalue'</span> <span class=\"p\">})</span>\n\n<span class=\"c1\"># And the APIObject allow you to interact with an object's data via the 'model' attribute.</span>\n<span class=\"c1\"># The Model is similar to a standard dict, but also allows dot notation to access elements</span>\n<span class=\"c1\"># of the structured data.</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Annotations:</span><span class=\"se\">\\n</span><span class=\"si\">{}</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">metadata</span><span class=\"o\">.</span><span class=\"n\">annotations</span><span class=\"p\">))</span>\n\n<span class=\"c1\"># There is no need to perform the verbose 'in' checking you may be familiar with when</span>\n<span class=\"c1\"># exploring a Model object. Accessing Model attributes will always return a value. If the</span>\n<span class=\"c1\"># any component of a path into the object does not exist in the underlying model, the</span>\n<span class=\"c1\"># singleton 'Missing' will be returned.</span>\n\n<span class=\"k\">if</span> <span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">metadata</span><span class=\"o\">.</span><span class=\"n\">annotations</span><span class=\"o\">.</span><span class=\"n\">myannotation</span> <span class=\"ow\">is</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">Missing</span><span class=\"p\">:</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"This object has not been annotated yet\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># If a field in the model contains special characters, use standard Python notation</span>\n<span class=\"c1\"># to access the key instead of dot notation.</span>\n<span class=\"k\">if</span> <span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">metadata</span><span class=\"o\">.</span><span class=\"n\">annotations</span><span class=\"p\">[</span><span class=\"s1\">'my-annotation'</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">Missing</span><span class=\"p\">:</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"This object has not been annotated yet\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># For debugging, you can always see the state of the underlying model by printing the</span>\n<span class=\"c1\"># APIObject as JSON.</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'</span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">as_json</span><span class=\"p\">()))</span>\n\n<span class=\"c1\"># Or getting deep copy dict. Changes made to this dict will not affect the APIObject.</span>\n<span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">as_dict</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># Model objects also simplify looking through kubernetes style lists. For example, can_match</span>\n<span class=\"c1\"># returns True if the modeled list contains an object with the subset of attributes specified.</span>\n<span class=\"c1\"># If this example, we are checking if the a node's kubelet is reporting Ready:</span>\n<span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s1\">'node/alpha'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">status</span><span class=\"o\">.</span><span class=\"n\">conditions</span><span class=\"o\">.</span><span class=\"n\">can_match</span><span class=\"p\">(</span>\n    <span class=\"p\">{</span>\n        <span class=\"s1\">'type'</span><span class=\"p\">:</span> <span class=\"s1\">'Ready'</span><span class=\"p\">,</span>\n        <span class=\"s1\">'status'</span><span class=\"p\">:</span> <span class=\"s2\">\"True\"</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">)</span>\n\n<span class=\"c1\"># can_match can also ensure nest objects and list are present within a resource. Several</span>\n<span class=\"c1\"># of these types of checks are already implemented in the openshift.status module.</span>\n<span class=\"k\">def</span> <span class=\"nf\">is_route_admitted</span><span class=\"p\">(</span><span class=\"n\">apiobj</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">apiobj</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">status</span><span class=\"o\">.</span><span class=\"n\">can_match</span><span class=\"p\">({</span>\n        <span class=\"s1\">'ingress'</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"p\">{</span>\n                <span class=\"s1\">'conditions'</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                    <span class=\"p\">{</span>\n                        <span class=\"s1\">'type'</span><span class=\"p\">:</span> <span class=\"s1\">'Admitted'</span><span class=\"p\">,</span>\n                        <span class=\"s1\">'status'</span><span class=\"p\">:</span> <span class=\"s1\">'True'</span><span class=\"p\">,</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">]</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">]</span>\n    <span class=\"p\">})</span>\n</pre>\n<h3>Making changes to APIObjects</h3>\n<pre><span class=\"c1\"># APIObject exposes simple interfaces to delete and patch the resource it represents.</span>\n<span class=\"c1\"># But, more interestingly, you can make detailed changes to the model and apply those</span>\n<span class=\"c1\"># changes to the API.</span>\n\n<span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">metadata</span><span class=\"o\">.</span><span class=\"n\">labels</span><span class=\"p\">[</span><span class=\"s1\">'my_label'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">'myvalue'</span>\n<span class=\"n\">project</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># If modifying the underlying API resources could be contentious, use the more robust</span>\n<span class=\"c1\"># modify_and_apply method which can retry the operation multiple times -- refreshing</span>\n<span class=\"c1\"># with the current object state between failures.</span>\n\n<span class=\"c1\"># First, define a function that will make changes to the model.</span>\n<span class=\"k\">def</span> <span class=\"nf\">make_model_change</span><span class=\"p\">(</span><span class=\"n\">apiobj</span><span class=\"p\">):</span>\n    <span class=\"n\">apiobj</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s1\">'somefile.yaml'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">'wyxz'</span>\n    <span class=\"k\">return</span> <span class=\"kc\">True</span>\n\n<span class=\"c1\"># modify_and_apply will call the function and attempt to apply its changes to the model</span>\n<span class=\"c1\"># if it returns True. If the apply is rejected by the API, the function will pull</span>\n<span class=\"c1\"># the latest object content, call make_model_change again, and try the apply again</span>\n<span class=\"c1\"># up to the specified retry account.</span>\n<span class=\"n\">configmap</span><span class=\"o\">.</span><span class=\"n\">modify_and_apply</span><span class=\"p\">(</span><span class=\"n\">make_model_change</span><span class=\"p\">,</span> <span class=\"n\">retries</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\"># For best results, ensure the function passed to modify_and_apply is idempotent:</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">set_unmanaged_in_cvo</span><span class=\"p\">(</span><span class=\"n\">apiobj</span><span class=\"p\">):</span>\n    <span class=\"n\">desired_entry</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"s1\">'group'</span><span class=\"p\">:</span> <span class=\"s1\">'config.openshift.io/v1'</span><span class=\"p\">,</span>\n        <span class=\"s1\">'kind'</span><span class=\"p\">:</span> <span class=\"s1\">'ClusterOperator'</span><span class=\"p\">,</span>\n        <span class=\"s1\">'name'</span><span class=\"p\">:</span> <span class=\"s1\">'openshift-samples'</span><span class=\"p\">,</span>\n        <span class=\"s1\">'unmanaged'</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">apiobj</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">spec</span><span class=\"o\">.</span><span class=\"n\">overrides</span><span class=\"o\">.</span><span class=\"n\">can_match</span><span class=\"p\">(</span><span class=\"n\">desired_entry</span><span class=\"p\">):</span>\n        <span class=\"c1\"># No change required</span>\n        <span class=\"k\">return</span> <span class=\"kc\">False</span>\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">apiobj</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">spec</span><span class=\"o\">.</span><span class=\"n\">overrides</span><span class=\"p\">:</span>\n        <span class=\"n\">apiobj</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">spec</span><span class=\"o\">.</span><span class=\"n\">overrides</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n    <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">progress</span><span class=\"p\">(</span><span class=\"s1\">'Attempting to disable CVO interest in openshift-samples operator'</span><span class=\"p\">)</span>\n    <span class=\"n\">apiobj</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">spec</span><span class=\"o\">.</span><span class=\"n\">overrides</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">desired_entry</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"kc\">True</span>\n\n<span class=\"n\">result</span><span class=\"p\">,</span> <span class=\"n\">changed</span> <span class=\"o\">=</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s1\">'clusterversion.config.openshift.io/version'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">modify_and_apply</span><span class=\"p\">(</span><span class=\"n\">set_unmanaged_in_cvo</span><span class=\"p\">)</span>\n<span class=\"k\">if</span> <span class=\"n\">changed</span><span class=\"p\">:</span>\n    <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">report_change</span><span class=\"p\">(</span><span class=\"s1\">'Instructed CVO to ignore openshift-samples operator'</span><span class=\"p\">)</span>\n</pre>\n<h3>Running within a Pod</h3>\n<p>It is simple to use the API within a Pod. The <code>oc</code> binary automatically\ndetects it is running within a container and automatically uses the Pod's serviceaccount token/cacert.</p>\n<h3>Tracking oc invocations</h3>\n<p>It is good practice to setup at least one tracking context within your application so that\nyou will be able to easily analyze what <code>oc</code> invocations were made on your behalf and the result\nof those operations. <em>Note that details about all <code>oc</code> invocations performed within the context will\nbe stored within the tracker. Therefore, do not use a single tracker for a continuously running\nprocess -- it will consume memory for every oc invocation.</em></p>\n<pre><span class=\"ch\">#!/usr/bin/python</span>\n<span class=\"kn\">import</span> <span class=\"nn\">openshift</span> <span class=\"k\">as</span> <span class=\"nn\">oc</span>\n\n<span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">tracking</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">tracker</span><span class=\"p\">:</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Current user: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">whoami</span><span class=\"p\">()))</span>\n    <span class=\"k\">except</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Error acquiring current username'</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Print out details about the invocations made within this context.</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">tracker</span><span class=\"o\">.</span><span class=\"n\">get_result</span><span class=\"p\">())</span>\n</pre>\n<p>In this case, the tracking output would look something like:</p>\n<pre><span class=\"p\">{</span>\n    <span class=\"nt\">\"status\"</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span> \n    <span class=\"nt\">\"operation\"</span><span class=\"p\">:</span> <span class=\"s2\">\"tracking\"</span><span class=\"p\">,</span> \n    <span class=\"nt\">\"actions\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">\"status\"</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"verb\"</span><span class=\"p\">:</span> <span class=\"s2\">\"project\"</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"references\"</span><span class=\"p\">:</span> <span class=\"p\">{},</span> \n            <span class=\"nt\">\"in\"</span><span class=\"p\">:</span> <span class=\"kc\">null</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"out\"</span><span class=\"p\">:</span> <span class=\"s2\">\"aos-cd\\n\"</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"err\"</span><span class=\"p\">:</span> <span class=\"s2\">\"\"</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"cmd\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"s2\">\"oc\"</span><span class=\"p\">,</span> \n                <span class=\"s2\">\"project\"</span><span class=\"p\">,</span> \n                <span class=\"s2\">\"-q\"</span>\n            <span class=\"p\">],</span> \n            <span class=\"nt\">\"elapsed_time\"</span><span class=\"p\">:</span> <span class=\"mf\">0.15344810485839844</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"internal\"</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"timeout\"</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"last_attempt\"</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n        <span class=\"p\">},</span> \n        <span class=\"p\">{</span>\n            <span class=\"nt\">\"status\"</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"verb\"</span><span class=\"p\">:</span> <span class=\"s2\">\"whoami\"</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"references\"</span><span class=\"p\">:</span> <span class=\"p\">{},</span> \n            <span class=\"nt\">\"in\"</span><span class=\"p\">:</span> <span class=\"kc\">null</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"out\"</span><span class=\"p\">:</span> <span class=\"s2\">\"aos-ci-jenkins\\n\"</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"err\"</span><span class=\"p\">:</span> <span class=\"s2\">\"\"</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"cmd\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"s2\">\"oc\"</span><span class=\"p\">,</span> \n                <span class=\"s2\">\"whoami\"</span>\n            <span class=\"p\">],</span> \n            <span class=\"nt\">\"elapsed_time\"</span><span class=\"p\">:</span> <span class=\"mf\">0.6328380107879639</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"internal\"</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"timeout\"</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span> \n            <span class=\"nt\">\"last_attempt\"</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</pre>\n<p>Alternatively, you can record actions yourself by passing an action_handler to the tracking\ncontextmanager. Your action handler will be invoked each time an <code>oc</code> invocation completes.</p>\n<pre><span class=\"k\">def</span> <span class=\"nf\">print_action</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"p\">):</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Performed: </span><span class=\"si\">{}</span><span class=\"s1\"> - status=</span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"o\">.</span><span class=\"n\">cmd</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"o\">.</span><span class=\"n\">status</span><span class=\"p\">))</span>\n\n<span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">tracking</span><span class=\"p\">(</span><span class=\"n\">action_handler</span><span class=\"o\">=</span><span class=\"n\">print_action</span><span class=\"p\">):</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Current project: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">get_project_name</span><span class=\"p\">()))</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Current user: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">whoami</span><span class=\"p\">()))</span>\n    <span class=\"k\">except</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Error acquiring details about project/user'</span><span class=\"p\">)</span>\n</pre>\n<h3>Time limits</h3>\n<p>Have a script you want to ensure succeeds or fails within a specific period of time? Use\na <code>timeout</code> context. Timeout contexts can be nested - if any timeout context expires,\nthe current oc invocation will be killed.</p>\n<pre><span class=\"ch\">#!/usr/bin/python</span>\n<span class=\"kn\">import</span> <span class=\"nn\">openshift</span> <span class=\"k\">as</span> <span class=\"nn\">oc</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">node_is_ready</span><span class=\"p\">(</span><span class=\"n\">node</span><span class=\"p\">):</span>\n    <span class=\"n\">ready</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">status</span><span class=\"o\">.</span><span class=\"n\">conditions</span><span class=\"o\">.</span><span class=\"n\">can_match</span><span class=\"p\">({</span>\n        <span class=\"s1\">'type'</span><span class=\"p\">:</span> <span class=\"s1\">'Ready'</span><span class=\"p\">,</span>\n        <span class=\"s1\">'status'</span><span class=\"p\">:</span> <span class=\"s1\">'True'</span><span class=\"p\">,</span>\n    <span class=\"p\">})</span>\n    <span class=\"k\">return</span> <span class=\"n\">ready</span>\n\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Waiting for up to 15 minutes for at least 6 nodes to be ready...\"</span><span class=\"p\">)</span>\n<span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">timeout</span><span class=\"p\">(</span><span class=\"mi\">15</span> <span class=\"o\">*</span> <span class=\"mi\">60</span><span class=\"p\">):</span>\n    <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s1\">'nodes'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">until_all</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"n\">success_func</span><span class=\"o\">=</span><span class=\"n\">node_is_ready</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"All detected nodes are reporting ready\"</span><span class=\"p\">)</span>\n</pre>\n<p>You will be able to see in <code>tracking</code> context results that a timeout occurred for an affected\ninvocation. The <code>timeout</code> field will be set to <code>True</code>.</p>\n<h3>Advanced contexts</h3>\n<p>If you are unable to use a KUBECONFIG environment variable or need fine grained control over the\nserver/credentials you communicate with for each invocation, use openshift-client-python contexts.\nContexts can be nested and cause oc invocations within them to use the most recently established\ncontext information.</p>\n<pre><span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">api_server</span><span class=\"p\">(</span><span class=\"s1\">'https:///....'</span><span class=\"p\">):</span>  <span class=\"c1\"># use the specified api server for nested oc invocations.</span>\n\n    <span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">token</span><span class=\"p\">(</span><span class=\"s1\">'abc..'</span><span class=\"p\">):</span>  <span class=\"c1\"># --server=... --token=abc... will be included in inner oc invocations.</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Current project: \"</span> <span class=\"o\">+</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">get_project_name</span><span class=\"p\">())</span>\n\n    <span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">token</span><span class=\"p\">(</span><span class=\"s1\">'def..'</span><span class=\"p\">):</span>  <span class=\"c1\"># --server=... --token=def... will be included in inner oc invocations.</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Current project: \"</span> <span class=\"o\">+</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">get_project_name</span><span class=\"p\">())</span>\n</pre>\n<p>You can control the loglevel specified  for <code>oc</code> invocations.</p>\n<pre><span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">loglevel</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">):</span>\n   <span class=\"c1\"># all oc invocations within this context will be invoked with --loglevel=6</span>\n    <span class=\"n\">oc</span><span class=\"o\">...</span>   \n</pre>\n<p>You ask <code>oc</code> to skip TLS verification if necessary.</p>\n<pre><span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">tls_verify</span><span class=\"p\">(</span><span class=\"n\">enable</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n   <span class=\"c1\"># all oc invocations within this context will be invoked with --insecure-skip-tls-verify</span>\n    <span class=\"n\">oc</span><span class=\"o\">...</span>   \n</pre>\n<h3>Something missing?</h3>\n<p>Most common API iterations have abstractions, but if there is no openshift-client-python API\nexposing the <code>oc</code> function you want to run, you can always use <code>oc.invoke</code> to directly pass arguments to\nan <code>oc</code> invocation on your host.</p>\n<pre><span class=\"c1\"># oc adm policy add-scc-to-user privileged -z my-sa-name</span>\n<span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">invoke</span><span class=\"p\">(</span><span class=\"s1\">'adm'</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">'policy'</span><span class=\"p\">,</span> <span class=\"s1\">'add-scc-to-user'</span><span class=\"p\">,</span> <span class=\"s1\">'privileged'</span><span class=\"p\">,</span> <span class=\"s1\">'-z'</span><span class=\"p\">,</span> <span class=\"s1\">'my-sa-name'</span><span class=\"p\">])</span>\n</pre>\n<h3>Running oc on a bastion host</h3>\n<p>Is your oc binary on a remote host? No problem. Easily remote all CLI interactions over SSH using the client_host\ncontext. Before running this command, you will need to load your ssh agent up with a key\nappropriate to the target client host.</p>\n<pre><span class=\"k\">with</span> <span class=\"n\">openshift</span><span class=\"o\">.</span><span class=\"n\">client_host</span><span class=\"p\">(</span><span class=\"n\">hostname</span><span class=\"o\">=</span><span class=\"s2\">\"my.cluster.com\"</span><span class=\"p\">,</span> <span class=\"n\">username</span><span class=\"o\">=</span><span class=\"s2\">\"root\"</span><span class=\"p\">,</span> <span class=\"n\">auto_add_host</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n    <span class=\"c1\"># oc invocations will take place on my.cluster.com host as the root user.</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Current project: \"</span> <span class=\"o\">+</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">get_project_name</span><span class=\"p\">())</span>\n</pre>\n<p>Using this model, your Python script will run exactly where you launch it, but all oc invocations will\noccur on the remote host.</p>\n<h3>Gathering reports and logs with selectors</h3>\n<p>Various objects within OpenShift have logs associated with them:</p>\n<ul>\n<li>pods</li>\n<li>deployments</li>\n<li>daemonsets</li>\n<li>statefulsets</li>\n<li>builds</li>\n<li>etc..</li>\n</ul>\n<p>A selector can gather logs from pods associated with each (and for each container within those pods). Each\nlog will be a unique value in the dictionary returned.</p>\n<pre><span class=\"c1\"># Print logs for all pods associated with all daemonsets &amp; deployments in openshift-monitoring namespace.</span>\n<span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">project</span><span class=\"p\">(</span><span class=\"s1\">'openshift-monitoring'</span><span class=\"p\">):</span>\n    <span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">([</span><span class=\"s1\">'daemonset'</span><span class=\"p\">,</span> <span class=\"s1\">'deployment'</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">logs</span><span class=\"p\">(</span><span class=\"n\">tail</span><span class=\"o\">=</span><span class=\"mi\">500</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">iteritems</span><span class=\"p\">():</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Container: </span><span class=\"si\">{}</span><span class=\"se\">\\n</span><span class=\"si\">{}</span><span class=\"se\">\\n\\n</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">))</span>\n</pre>\n<p>The above example would output something like:</p>\n<pre><code>Container: openshift-monitoring:pod/node-exporter-hw5r5(node-exporter)\ntime=\"2018-10-22T21:07:36Z\" level=info msg=\"Starting node_exporter (version=0.16.0, branch=, revision=)\" source=\"node_exporter.go:82\"\ntime=\"2018-10-22T21:07:36Z\" level=info msg=\"Enabled collectors:\" source=\"node_exporter.go:90\"\ntime=\"2018-10-22T21:07:36Z\" level=info msg=\" - arp\" source=\"node_exporter.go:97\"\n...\n</code></pre>\n<p>Note that these logs are held in memory. Use tail or other available method parameters to ensure\npredictable and efficient results.</p>\n<p>To simplify even further, you can ask the library to pretty-print the logs for you:</p>\n<pre><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">([</span><span class=\"s1\">'daemonset'</span><span class=\"p\">,</span> <span class=\"s1\">'deployment'</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">print_logs</span><span class=\"p\">()</span>\n</pre>\n<p>And to quickly pull together significant diagnostic data on selected objects, use <code>report()</code> or <code>print_report()</code>.\nA report includes the following information for each selected object, if available:</p>\n<ul>\n<li><code>object</code> - The current state of the object.</li>\n<li><code>describe</code> - The output of describe on the object.</li>\n<li><code>logs</code> - If applicable, a map of logs -- one of each container associated with the object.</li>\n</ul>\n<pre><span class=\"c1\"># Pretty-print a detail set of data about all deploymentconfigs, builds, and configmaps in the </span>\n<span class=\"c1\"># current namespace context.</span>\n<span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">([</span><span class=\"s1\">'dc'</span><span class=\"p\">,</span> <span class=\"s1\">'build'</span><span class=\"p\">,</span> <span class=\"s1\">'configmap'</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">print_report</span><span class=\"p\">()</span>\n</pre>\n<h3>Advanced verbs:</h3>\n<p>Running oc exec on a pod.</p>\n<pre>    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s1\">'pod/alertmanager-main-0'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">([</span><span class=\"s1\">'cat'</span><span class=\"p\">],</span>\n                                                                     <span class=\"n\">container_name</span><span class=\"o\">=</span><span class=\"s1\">'alertmanager'</span><span class=\"p\">,</span>\n                                                                     <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"s1\">'stdin for cat'</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">out</span><span class=\"p\">())</span>\n</pre>\n<p>Finding all pods running on a node:</p>\n<pre><span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">client_host</span><span class=\"p\">():</span>\n    <span class=\"k\">for</span> <span class=\"n\">node_name</span> <span class=\"ow\">in</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s1\">'nodes'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">qnames</span><span class=\"p\">():</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Pods running on node: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">node_name</span><span class=\"p\">))</span>\n            <span class=\"k\">for</span> <span class=\"n\">pod_obj</span> <span class=\"ow\">in</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">get_pods_by_node</span><span class=\"p\">(</span><span class=\"n\">node_name</span><span class=\"p\">):</span>\n                <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'  </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">pod_obj</span><span class=\"o\">.</span><span class=\"n\">fqname</span><span class=\"p\">()))</span>\n</pre>\n<p>Example output:</p>\n<pre><code>...\nPods running on node: node/ip-172-31-18-183.ca-central-1.compute.internal\n  72-sus:pod/sus-1-vgnmx\n  ameen-blog:pod/ameen-blog-2-t68qn\n  appejemplo:pod/ejemplo-1-txdt7\n  axxx:pod/mysql-5-lx2bc\n...\n</code></pre>\n<h2>Examples</h2>\n<ul>\n<li><a href=\"examples/cluster_tests.py\" rel=\"nofollow\">Some unit tests</a></li>\n</ul>\n<h2>Environment Variables</h2>\n<p>To allow openshift-client-python applications to be portable between environments without needing to be modified,\nyou can specify many default contexts in the environment.</p>\n<h3>Defaults when invoking <code>oc</code></h3>\n<p>Establishing explicit contexts within an application will override these environment defaults.</p>\n<ul>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_OC_PATH</code> - default path to use when invoking <code>oc</code></li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_CONFIG_PATH</code> - default <code>--config</code> argument</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_API_SERVER</code> - default <code>--server</code> argument</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_CA_CERT_PATH</code> - default <code>--cacert</code> argument</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_PROJECT</code> - default <code>--namespace</code> argument</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_OC_LOGLEVEL</code> - default <code>--loglevel</code> argument</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_SKIP_TLS_VERIFY</code> - default <code>--insecure-skip-tls-verify</code></li>\n</ul>\n<h3>Master timeout</h3>\n<p>Defines an implicit outer timeout(..) context for the entire application. This allows you to ensure\nthat an application terminates within a reasonable time, even if the author of the application has\nnot included explicit timeout contexts. Like any <code>timeout</code> context, this value is not overridden\nby subsequent <code>timeout</code> contexts within the application. It provides an upper bound for the entire\napplication's oc interactions.</p>\n<ul>\n<li><code>OPENSHIFT_CLIENT_PYTHON_MASTER_TIMEOUT</code></li>\n</ul>\n<h3>SSH Client Host</h3>\n<p>In some cases, it is desirable to run an openshift-client-python application using a local <code>oc</code> binary and\nin other cases, the <code>oc</code> binary resides on a remote client. Encoding this decision in the application\nitself is unnecessary.</p>\n<p>Simply wrap you application in a <code>client_host</code> context without arguments. This will try to pull\nclient host information from environment variables if they are present. If they are not present,\nthe application will execute on the local host.</p>\n<p>For example, the following application will ssh to <code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_HOSTNAME</code> if it is defined\nin the environment. Otherwise, <code>oc</code> interactions will be executed on the host running the python application.</p>\n<pre><span class=\"k\">with</span> <span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">client_host</span><span class=\"p\">():</span>  <span class=\"c1\"># if OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_HOSTNAME if not defined in the environment, this is a no-op</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span> <span class=\"s1\">'Found nodes: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">oc</span><span class=\"o\">.</span><span class=\"n\">selector</span><span class=\"p\">(</span><span class=\"s1\">'nodes'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">qnames</span><span class=\"p\">())</span> <span class=\"p\">)</span> \n</pre>\n<ul>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_HOSTNAME</code> - The hostname on which the <code>oc</code> binary resides</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_USERNAME</code> - Username to use for the ssh connection (optional)</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_PORT</code> - SSH port to use (optional; defaults to 22)</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_SSH_AUTO_ADD</code> - Defaults to <code>false</code>. If set to <code>true</code>, unknown hosts will automatically be trusted.</li>\n<li><code>OPENSHIFT_CLIENT_PYTHON_DEFAULT_LOAD_SYSTEM_HOST_KEYS</code> - Defaults to <code>true</code>. If true, the local known hosts information will be used.</li>\n</ul>\n\n          </div>"}, "last_serial": 7086843, "releases": {"1.0.2": [{"comment_text": "", "digests": {"md5": "9a98732d54bdbd2f1ea9f384b2f47b45", "sha256": "df512e5b4d37ca4f7b88dd39966df1337de2acbfab26e00210021988910c4306"}, "downloads": -1, "filename": "openshift_client-1.0.2-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "9a98732d54bdbd2f1ea9f384b2f47b45", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 71516, "upload_time": "2020-04-23T16:12:56", "upload_time_iso_8601": "2020-04-23T16:12:56.227086Z", "url": "https://files.pythonhosted.org/packages/1f/4d/644b0d765fc4e69ae1aa2c7f0a6b6d5a1feb30cdee22d9111195da9cf937/openshift_client-1.0.2-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "d0bf706a2ce9397dfa3ff5bf0e4e717d", "sha256": "339739190ad4ff8825a8c6a75436a7ce6fb8e37e5696cf9b54cdfc50fa1a3977"}, "downloads": -1, "filename": "openshift-client-1.0.2.tar.gz", "has_sig": false, "md5_digest": "d0bf706a2ce9397dfa3ff5bf0e4e717d", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 75305, "upload_time": "2020-04-23T16:12:58", "upload_time_iso_8601": "2020-04-23T16:12:58.921851Z", "url": "https://files.pythonhosted.org/packages/76/4b/0eed2a279138ae89fae411cc712343ecd4b86874ebde0ccaaa445a111045/openshift-client-1.0.2.tar.gz", "yanked": false}], "1.0.3": [{"comment_text": "", "digests": {"md5": "72fe6418899725ef6fd9d5d710392514", "sha256": "f0b11509bb77e8a646701240af940473b53754ff615326ec854bbf3a05ac3be6"}, "downloads": -1, "filename": "openshift_client-1.0.3-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "72fe6418899725ef6fd9d5d710392514", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 71540, "upload_time": "2020-04-23T19:35:40", "upload_time_iso_8601": "2020-04-23T19:35:40.816920Z", "url": "https://files.pythonhosted.org/packages/2a/78/1e22bedea5ed7fd7e18bb5e7b8cd3f63b363dbdbe19b8c0feb0a1c2c4b02/openshift_client-1.0.3-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "a070924fa5de199f03b641aee8ed102c", "sha256": "7449f91024c9fa9eed780915db50e1d446de2af77632a16fc5d7a6d19f7b4958"}, "downloads": -1, "filename": "openshift-client-1.0.3.tar.gz", "has_sig": false, "md5_digest": "a070924fa5de199f03b641aee8ed102c", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 75374, "upload_time": "2020-04-23T19:35:42", "upload_time_iso_8601": "2020-04-23T19:35:42.762772Z", "url": "https://files.pythonhosted.org/packages/e7/10/35d8f261768ff74ba2bffa7c32b6bdd17122a305e72b88595c9c48500b30/openshift-client-1.0.3.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "72fe6418899725ef6fd9d5d710392514", "sha256": "f0b11509bb77e8a646701240af940473b53754ff615326ec854bbf3a05ac3be6"}, "downloads": -1, "filename": "openshift_client-1.0.3-py2.py3-none-any.whl", "has_sig": false, "md5_digest": "72fe6418899725ef6fd9d5d710392514", "packagetype": "bdist_wheel", "python_version": "py2.py3", "requires_python": null, "size": 71540, "upload_time": "2020-04-23T19:35:40", "upload_time_iso_8601": "2020-04-23T19:35:40.816920Z", "url": "https://files.pythonhosted.org/packages/2a/78/1e22bedea5ed7fd7e18bb5e7b8cd3f63b363dbdbe19b8c0feb0a1c2c4b02/openshift_client-1.0.3-py2.py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "a070924fa5de199f03b641aee8ed102c", "sha256": "7449f91024c9fa9eed780915db50e1d446de2af77632a16fc5d7a6d19f7b4958"}, "downloads": -1, "filename": "openshift-client-1.0.3.tar.gz", "has_sig": false, "md5_digest": "a070924fa5de199f03b641aee8ed102c", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 75374, "upload_time": "2020-04-23T19:35:42", "upload_time_iso_8601": "2020-04-23T19:35:42.762772Z", "url": "https://files.pythonhosted.org/packages/e7/10/35d8f261768ff74ba2bffa7c32b6bdd17122a305e72b88595c9c48500b30/openshift-client-1.0.3.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:02:34 2020"}