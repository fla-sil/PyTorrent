{"info": {"author": "Jinyu Xie", "author_email": "xjygr08@gmail.com", "bugtrack_url": null, "classifiers": [], "description": "# simglucose\nA Type-1 Diabetes simulator implemented in Python for Reinforcement Learning purpose\n\nThis simulator is a python implementation of the FDA-approved [UVa/Padova Simulator (2008 version)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4454102/) for research purpose only. The simulator includes 30 virtual patients, 10 adolescents, 10 adults, 10 children. \n\n - Note: simglucose only supports python3.\n\n| Animation                                                                                         | CVGA Plot                                                                      | BG Trace Plot                                                                                    | Risk Index Stats                                                                                                 |\n|---------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|\n| ![animation screenshot](https://github.com/jxx123/simglucose/blob/master/screenshots/animate.png) | ![CVGA](https://github.com/jxx123/simglucose/blob/master/screenshots/CVGA.png) | ![BG Trace Plot](https://github.com/jxx123/simglucose/blob/master/screenshots/BG_trace_plot.png) | ![Risk Index Stats](https://github.com/jxx123/simglucose/blob/master/screenshots/risk_index.png) |\n\n  <!-- ![Zone Stats](https://github.com/jxx123/simglucose/blob/master/screenshots/zone_stats.png) -->\n\n## Main Features\n- Simulation enviroment follows [OpenAI gym](https://github.com/openai/gym) and [rllab](https://github.com/rll/rllab) APIs. It returns observation, reward, done, info at each step, which means the simulator is \"reinforcement-learning-ready\".\n- Supports customized reward function. The reward function is a function of blood glucose measurements in the last hour. By default, the reward at each step is `risk[t-1] - risk[t]`. `risk[t]` is the risk index at time `t` defined in this [paper](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2903980/pdf/dia.2008.0138.pdf). \n- Supports parallel computing. The simulator simulates mutliple patients parallelly using [pathos multiprocessing package](https://github.com/uqfoundation/pathos) (you are free to turn parallel off by setting `parallel=False`).\n- The simulator provides a random scenario generator (`from simglucose.simulation.scenario_gen import RandomScenario`) and a customized scenario generator (`from simglucose.simulation.scenario import CustomScenario`). Commandline user-interface will guide you through the scenario settings.\n- The simulator provides the most basic basal-bolus controller for now. It provides very simple syntax to implement your own controller, like Model Predictive Control, PID control, reinforcement learning control, etc. \n- You can specify random seed in case you want to repeat your experiments.\n- The simulator will generate several plots for performance analysis after simulation. The plots include blood glucose trace plot, Control Variability Grid Analysis (CVGA) plot, statistics plot of blood glucose in different zones, risk indices statistics plot.\n- NOTE: `animate` and `parallel` cannot be set to `True` at the same time in macOS. Most backends of matplotlib in macOS is not thread-safe. Windows has not been tested. Let me know the results if anybody has tested it out.\n\n## Installation\nIt is highly recommended to use `pip` to install `simglucose`, follow this [link](https://pip.pypa.io/en/stable/installing/) to install pip.\n\nAuto installation:\n```bash\npip install simglucose\n```\n\nManual installation: \n```bash\ngit clone https://github.com/jxx123/simglucose.git\ncd simglucose\n```\nIf you have `pip` installed, then\n```bash\npip install -e .\n```\nIf you do not have `pip`, then\n```bash\npython setup.py install\n```\n\nIf [rllab (optional)](https://github.com/rll/rllab) is installed, the package will utilize some functionalities in rllab.\n\nNote: there might be some minor differences between auto install version and manual install version. Use `git clone` and manual installation to get the latest version.\n\n## Quick Start\n### Use simglucose as a simulator and test controllers\nRun the simulator user interface\n```python\nfrom simglucose.simulation.user_interface import simulate\nsimulate()\n```\n\nYou are free to implement your own controller, and test it in the simulator. For example,\n```python\nfrom simglucose.simulation.user_interface import simulate\nfrom simglucose.controller.base import Controller, Action\n\n\nclass MyController(Controller):\n    def __init__(self, init_state):\n        self.init_state = init_state\n        self.state = init_state\n\n    def policy(self, observation, reward, done, **info):\n        '''\n        Every controller must have this implementation!\n        ----\n        Inputs:\n        observation - a namedtuple defined in simglucose.simulation.env. For\n                      now, it only has one entry: blood glucose level measured\n                      by CGM sensor.\n        reward      - current reward returned by environment\n        done        - True, game over. False, game continues\n        info        - additional information as key word arguments,\n                      simglucose.simulation.env.T1DSimEnv returns patient_name\n                      and sample_time\n        ----\n        Output:\n        action - a namedtuple defined at the beginning of this file. The\n                 controller action contains two entries: basal, bolus\n        '''\n        self.state = observation\n        action = Action(basal=0, bolus=0)\n        return action\n\n    def reset(self):\n        '''\n        Reset the controller state to inital state, must be implemented\n        '''\n        self.state = self.init_state\n\n\nctrller = MyController(0)\nsimulate(controller=ctrller)\n```\n\nThese two examples can also be found in examples\\ folder.\n\nIn fact, you can specify a lot more simulation parameters through `simulation`:\n```python\nsimulate(sim_time=my_sim_time,\n         scenario=my_scenario,\n         controller=my_controller,\n         start_time=my_start_time,\n         save_path=my_save_path,\n         animate=False,\n         parallel=True)\n```\n### OpenAI Gym usage\n- Using default reward\n```python\nimport gym\n\n# Register gym environment. By specifying kwargs,\n# you are able to choose which patient to simulate.\n# patient_name must be 'adolescent#001' to 'adolescent#010',\n# or 'adult#001' to 'adult#010', or 'child#001' to 'child#010'\nfrom gym.envs.registration import register\nregister(\n    id='simglucose-adolescent2-v0',\n    entry_point='simglucose.envs:T1DSimEnv',\n    kwargs={'patient_name': 'adolescent#002'}\n)\n\nenv = gym.make('simglucose-adolescent2-v0')\n\nobservation = env.reset()\nfor t in range(100):\n    env.render(mode='human')\n    print(observation)\n    # Action in the gym environment is a scalar\n    # representing the basal insulin, which differs from\n    # the regular controller action outside the gym\n    # environment (a tuple (basal, bolus)).\n    # In the perfect situation, the agent should be able\n    # to control the glucose only through basal instead\n    # of asking patient to take bolus\n    action = env.action_space.sample()\n    observation, reward, done, info = env.step(action)\n    if done:\n        print(\"Episode finished after {} timesteps\".format(t + 1))\n        break\n```\n- Customized reward function\n```python\nimport gym\nfrom gym.envs.registration import register\n\n\ndef custom_reward(BG_last_hour):\n    if BG_last_hour[-1] > 180:\n        return -1\n    elif BG_last_hour[-1] < 70:\n        return -2\n    else:\n        return 1\n\n\nregister(\n    id='simglucose-adolescent2-v0',\n    entry_point='simglucose.envs:T1DSimEnv',\n    kwargs={'patient_name': 'adolescent#002',\n            'reward_fun': custom_reward}\n)\n\nenv = gym.make('simglucose-adolescent2-v0')\n\nreward = 1\ndone = False\n\nobservation = env.reset()\nfor t in range(200):\n    env.render(mode='human')\n    action = env.action_space.sample()\n    observation, reward, done, info = env.step(action)\n    print(observation)\n    print(\"Reward = {}\".format(reward))\n    if done:\n        print(\"Episode finished after {} timesteps\".format(t + 1))\n        break\n```\n\n### rllab usage\n```python\nfrom rllab.algos.ddpg import DDPG\nfrom rllab.envs.normalized_env import normalize\nfrom rllab.exploration_strategies.ou_strategy import OUStrategy\nfrom rllab.policies.deterministic_mlp_policy import DeterministicMLPPolicy\nfrom rllab.q_functions.continuous_mlp_q_function import ContinuousMLPQFunction\nfrom rllab.envs.gym_env import GymEnv\nfrom gym.envs.registration import register\n\nregister(\n    id='simglucose-adolescent2-v0',\n    entry_point='simglucose.envs:T1DSimEnv',\n    kwargs={'patient_name': 'adolescent#002'}\n)\n\nenv = GymEnv('simglucose-adolescent2-v0')\nenv = normalize(env)\n\npolicy = DeterministicMLPPolicy(\n    env_spec=env.spec,\n    # The neural network policy should have two hidden layers, each with 32 hidden units.\n    hidden_sizes=(32, 32)\n)\n\nes = OUStrategy(env_spec=env.spec)\n\nqf = ContinuousMLPQFunction(env_spec=env.spec)\n\nalgo = DDPG(\n    env=env,\n    policy=policy,\n    es=es,\n    qf=qf,\n    batch_size=32,\n    max_path_length=100,\n    epoch_length=1000,\n    min_pool_size=10000,\n    n_epochs=1000,\n    discount=0.99,\n    scale_reward=0.01,\n    qf_learning_rate=1e-3,\n    policy_learning_rate=1e-4\n)\nalgo.train()\n```\n\n## Advanced Usage\nYou can create the simulation objects, and run batch simulation. For example,\n```python\nfrom simglucose.simulation.env import T1DSimEnv\nfrom simglucose.controller.basal_bolus_ctrller import BBController\nfrom simglucose.sensor.cgm import CGMSensor\nfrom simglucose.actuator.pump import InsulinPump\nfrom simglucose.patient.t1dpatient import T1DPatient\nfrom simglucose.simulation.scenario_gen import RandomScenario\nfrom simglucose.simulation.scenario import CustomScenario\nfrom simglucose.simulation.sim_engine import SimObj, sim, batch_sim\nfrom datetime import timedelta\nfrom datetime import datetime\n\n# specify start_time as the beginning of today\nnow = datetime.now()\nstart_time = datetime.combine(now.date(), datetime.min.time())\n\n# --------- Create Random Scenario --------------\n# Specify results saving path\npath = './results'\n\n# Create a simulation environment\npatient = T1DPatient.withName('adolescent#001')\nsensor = CGMSensor.withName('Dexcom', seed=1)\npump = InsulinPump.withName('Insulet')\nscenario = RandomScenario(start_time=start_time, seed=1)\nenv = T1DSimEnv(patient, sensor, pump, scenario)\n\n# Create a controller\ncontroller = BBController()\n\n# Put them together to create a simulation object\ns1 = SimObj(env, controller, timedelta(days=1), animate=False, path=path)\nresults1 = sim(s1)\nprint(results1)\n\n# --------- Create Custom Scenario --------------\n# Create a simulation environment\npatient = T1DPatient.withName('adolescent#001')\nsensor = CGMSensor.withName('Dexcom', seed=1)\npump = InsulinPump.withName('Insulet')\n# custom scenario is a list of tuples (time, meal_size)\nscen = [(7, 45), (12, 70), (16, 15), (18, 80), (23, 10)]\nscenario = CustomScenario(start_time=start_time, scenario=scen)\nenv = T1DSimEnv(patient, sensor, pump, scenario)\n\n# Create a controller\ncontroller = BBController()\n\n# Put them together to create a simulation object\ns2 = SimObj(env, controller, timedelta(days=1), animate=False, path=path)\nresults2 = sim(s2)\nprint(results2)\n\n\n# --------- batch simulation --------------\n# Re-initialize simulation objects\ns1.reset()\ns2.reset()\n\n# create a list of SimObj, and call batch_sim\ns = [s1, s2]\nresults = batch_sim(s, parallel=True)\nprint(results)\n```\n\nRun analysis offline\n```python\nfrom simglucose.analysis.report import report\nimport pandas as pd\nimport os\nimport glob\n\n# the path where results are saved\npath = os.path.join('.', 'results', '2017-12-31_17-46-32')\nos.chdir(path)\n# find all csv with pattern *#*.csv, e.g. adolescent#001.csv\nfilename = glob.glob('*#*.csv')\nname = [_f[:-4] for _f in filename]   # get the filename without extension\ndf = pd.concat([pd.read_csv(f, index_col=0) for f in filename], keys=name)\nreport(df)\n```\n## Release Notes\n### 9/10/2018\n- Controller `policy` method gets access to all the current patient state through `info['patient_state']`.\n### 2/26/2018\n- Support customized reward function.\n### 1/10/2018\n- Added workaround to select patient when make gym environment: register gym environment by passing kwargs of patient_name.\n### 1/7/2018\n- Added OpenAI gym support, use `gym.make('simglucose-v0')` to make the enviroment.\n- Noticed issue: the patient name selection is not available in gym.make for now. The patient name has to be hard-coded in the constructor of `simglucose.envs.T1DSimEnv`.\n\n## Reporting issues\nShoot me any bugs, enhancements or even discussion by [creating issues](https://github.com/jxx123/simglucose/issues/new).\n\n## How to contribute\nThe following instruction is originally from the [contribution instructions of sklearn](https://github.com/scikit-learn/scikit-learn/blob/master/CONTRIBUTING.md).\n\nThe preferred workflow for contributing to simglucose is to fork the\n[main repository](https://github.com/jxx123/simglucose) on\nGitHub, clone, and develop on a branch. Steps:\n\n1. Fork the [project repository](https://github.com/jxx123/simglucose)\n   by clicking on the 'Fork' button near the top right of the page. This creates\n   a copy of the code under your GitHub user account. For more details on\n   how to fork a repository see [this guide](https://help.github.com/articles/fork-a-repo/).\n\n2. Clone your fork of the simglucose repo from your GitHub account to your local disk:\n\n   ```bash\n   $ git clone git@github.com:YourLogin/simglucose.git\n   $ cd simglucose\n   ```\n\n3. Create a ``feature`` branch to hold your development changes:\n\n   ```bash\n   $ git checkout -b my-feature\n   ```\n\n   Always use a ``feature`` branch. It's good practice to **never work on the ``master`` branch**!\n\n4. Develop the feature on your feature branch. Add changed files using ``git add`` and then ``git commit`` files:\n\n   ```bash\n   $ git add modified_files\n   $ git commit\n   ```\n\n   to record your changes in Git, then push the changes to your GitHub account with:\n\n   ```bash\n   $ git push -u origin my-feature\n   ```\n\n5. Follow [these instructions](https://help.github.com/articles/creating-a-pull-request-from-a-fork)\nto create a pull request from your fork. This will send an email to the committers.\n\n(If any of the above seems like magic to you, please look up the\n[Git documentation](https://git-scm.com/documentation) on the web, or ask a friend or another contributor for help.)\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/jxx123/simglucose", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "simglucose", "package_url": "https://pypi.org/project/simglucose/", "platform": "", "project_url": "https://pypi.org/project/simglucose/", "project_urls": {"Homepage": "https://github.com/jxx123/simglucose"}, "release_url": "https://pypi.org/project/simglucose/0.2.1/", "requires_dist": ["pandas", "numpy", "scipy", "matplotlib", "pathos", "gym (==0.9.4)"], "requires_python": "", "summary": "A Type-1 Diabetes Simulator as a Reinforcement Learning Environment in OpenAI gym or rllab (python implementation of UVa/Padova Simulator)", "version": "0.2.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>simglucose</h1>\n<p>A Type-1 Diabetes simulator implemented in Python for Reinforcement Learning purpose</p>\n<p>This simulator is a python implementation of the FDA-approved <a href=\"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4454102/\" rel=\"nofollow\">UVa/Padova Simulator (2008 version)</a> for research purpose only. The simulator includes 30 virtual patients, 10 adolescents, 10 adults, 10 children.</p>\n<ul>\n<li>Note: simglucose only supports python3.</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Animation</th>\n<th align=\"left\">CVGA Plot</th>\n<th>BG Trace Plot</th>\n<th>Risk Index Stats</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img alt=\"animation screenshot\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/9061470993fec0d60e59923f841746a3f30c33a4/68747470733a2f2f6769746875622e636f6d2f6a78783132332f73696d676c75636f73652f626c6f622f6d61737465722f73637265656e73686f74732f616e696d6174652e706e67\"></td>\n<td align=\"left\"><img alt=\"CVGA\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/9c9e6d374ce0dc4d4353a00c0deaa78b7cd6d080/68747470733a2f2f6769746875622e636f6d2f6a78783132332f73696d676c75636f73652f626c6f622f6d61737465722f73637265656e73686f74732f435647412e706e67\"></td>\n<td><img alt=\"BG Trace Plot\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/2eb0080dab3632e60523cd11fea60d11957aa802/68747470733a2f2f6769746875622e636f6d2f6a78783132332f73696d676c75636f73652f626c6f622f6d61737465722f73637265656e73686f74732f42475f74726163655f706c6f742e706e67\"></td>\n<td><img alt=\"Risk Index Stats\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/9e9436b6ea47c9ec31e1e508a620398c7528e29b/68747470733a2f2f6769746875622e636f6d2f6a78783132332f73696d676c75636f73652f626c6f622f6d61737465722f73637265656e73686f74732f7269736b5f696e6465782e706e67\"></td>\n</tr></tbody></table>\n  \n<h2>Main Features</h2>\n<ul>\n<li>Simulation enviroment follows <a href=\"https://github.com/openai/gym\" rel=\"nofollow\">OpenAI gym</a> and <a href=\"https://github.com/rll/rllab\" rel=\"nofollow\">rllab</a> APIs. It returns observation, reward, done, info at each step, which means the simulator is \"reinforcement-learning-ready\".</li>\n<li>Supports customized reward function. The reward function is a function of blood glucose measurements in the last hour. By default, the reward at each step is <code>risk[t-1] - risk[t]</code>. <code>risk[t]</code> is the risk index at time <code>t</code> defined in this <a href=\"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2903980/pdf/dia.2008.0138.pdf\" rel=\"nofollow\">paper</a>.</li>\n<li>Supports parallel computing. The simulator simulates mutliple patients parallelly using <a href=\"https://github.com/uqfoundation/pathos\" rel=\"nofollow\">pathos multiprocessing package</a> (you are free to turn parallel off by setting <code>parallel=False</code>).</li>\n<li>The simulator provides a random scenario generator (<code>from simglucose.simulation.scenario_gen import RandomScenario</code>) and a customized scenario generator (<code>from simglucose.simulation.scenario import CustomScenario</code>). Commandline user-interface will guide you through the scenario settings.</li>\n<li>The simulator provides the most basic basal-bolus controller for now. It provides very simple syntax to implement your own controller, like Model Predictive Control, PID control, reinforcement learning control, etc.</li>\n<li>You can specify random seed in case you want to repeat your experiments.</li>\n<li>The simulator will generate several plots for performance analysis after simulation. The plots include blood glucose trace plot, Control Variability Grid Analysis (CVGA) plot, statistics plot of blood glucose in different zones, risk indices statistics plot.</li>\n<li>NOTE: <code>animate</code> and <code>parallel</code> cannot be set to <code>True</code> at the same time in macOS. Most backends of matplotlib in macOS is not thread-safe. Windows has not been tested. Let me know the results if anybody has tested it out.</li>\n</ul>\n<h2>Installation</h2>\n<p>It is highly recommended to use <code>pip</code> to install <code>simglucose</code>, follow this <a href=\"https://pip.pypa.io/en/stable/installing/\" rel=\"nofollow\">link</a> to install pip.</p>\n<p>Auto installation:</p>\n<pre>pip install simglucose\n</pre>\n<p>Manual installation:</p>\n<pre>git clone https://github.com/jxx123/simglucose.git\n<span class=\"nb\">cd</span> simglucose\n</pre>\n<p>If you have <code>pip</code> installed, then</p>\n<pre>pip install -e .\n</pre>\n<p>If you do not have <code>pip</code>, then</p>\n<pre>python setup.py install\n</pre>\n<p>If <a href=\"https://github.com/rll/rllab\" rel=\"nofollow\">rllab (optional)</a> is installed, the package will utilize some functionalities in rllab.</p>\n<p>Note: there might be some minor differences between auto install version and manual install version. Use <code>git clone</code> and manual installation to get the latest version.</p>\n<h2>Quick Start</h2>\n<h3>Use simglucose as a simulator and test controllers</h3>\n<p>Run the simulator user interface</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">simglucose.simulation.user_interface</span> <span class=\"kn\">import</span> <span class=\"n\">simulate</span>\n<span class=\"n\">simulate</span><span class=\"p\">()</span>\n</pre>\n<p>You are free to implement your own controller, and test it in the simulator. For example,</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">simglucose.simulation.user_interface</span> <span class=\"kn\">import</span> <span class=\"n\">simulate</span>\n<span class=\"kn\">from</span> <span class=\"nn\">simglucose.controller.base</span> <span class=\"kn\">import</span> <span class=\"n\">Controller</span><span class=\"p\">,</span> <span class=\"n\">Action</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">MyController</span><span class=\"p\">(</span><span class=\"n\">Controller</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">init_state</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">init_state</span> <span class=\"o\">=</span> <span class=\"n\">init_state</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">=</span> <span class=\"n\">init_state</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">policy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">observation</span><span class=\"p\">,</span> <span class=\"n\">reward</span><span class=\"p\">,</span> <span class=\"n\">done</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">info</span><span class=\"p\">):</span>\n        <span class=\"sd\">'''</span>\n<span class=\"sd\">        Every controller must have this implementation!</span>\n<span class=\"sd\">        ----</span>\n<span class=\"sd\">        Inputs:</span>\n<span class=\"sd\">        observation - a namedtuple defined in simglucose.simulation.env. For</span>\n<span class=\"sd\">                      now, it only has one entry: blood glucose level measured</span>\n<span class=\"sd\">                      by CGM sensor.</span>\n<span class=\"sd\">        reward      - current reward returned by environment</span>\n<span class=\"sd\">        done        - True, game over. False, game continues</span>\n<span class=\"sd\">        info        - additional information as key word arguments,</span>\n<span class=\"sd\">                      simglucose.simulation.env.T1DSimEnv returns patient_name</span>\n<span class=\"sd\">                      and sample_time</span>\n<span class=\"sd\">        ----</span>\n<span class=\"sd\">        Output:</span>\n<span class=\"sd\">        action - a namedtuple defined at the beginning of this file. The</span>\n<span class=\"sd\">                 controller action contains two entries: basal, bolus</span>\n<span class=\"sd\">        '''</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">=</span> <span class=\"n\">observation</span>\n        <span class=\"n\">action</span> <span class=\"o\">=</span> <span class=\"n\">Action</span><span class=\"p\">(</span><span class=\"n\">basal</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">bolus</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">action</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">reset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">'''</span>\n<span class=\"sd\">        Reset the controller state to inital state, must be implemented</span>\n<span class=\"sd\">        '''</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">state</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">init_state</span>\n\n\n<span class=\"n\">ctrller</span> <span class=\"o\">=</span> <span class=\"n\">MyController</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">simulate</span><span class=\"p\">(</span><span class=\"n\">controller</span><span class=\"o\">=</span><span class=\"n\">ctrller</span><span class=\"p\">)</span>\n</pre>\n<p>These two examples can also be found in examples\\ folder.</p>\n<p>In fact, you can specify a lot more simulation parameters through <code>simulation</code>:</p>\n<pre><span class=\"n\">simulate</span><span class=\"p\">(</span><span class=\"n\">sim_time</span><span class=\"o\">=</span><span class=\"n\">my_sim_time</span><span class=\"p\">,</span>\n         <span class=\"n\">scenario</span><span class=\"o\">=</span><span class=\"n\">my_scenario</span><span class=\"p\">,</span>\n         <span class=\"n\">controller</span><span class=\"o\">=</span><span class=\"n\">my_controller</span><span class=\"p\">,</span>\n         <span class=\"n\">start_time</span><span class=\"o\">=</span><span class=\"n\">my_start_time</span><span class=\"p\">,</span>\n         <span class=\"n\">save_path</span><span class=\"o\">=</span><span class=\"n\">my_save_path</span><span class=\"p\">,</span>\n         <span class=\"n\">animate</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n         <span class=\"n\">parallel</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre>\n<h3>OpenAI Gym usage</h3>\n<ul>\n<li>Using default reward</li>\n</ul>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">gym</span>\n\n<span class=\"c1\"># Register gym environment. By specifying kwargs,</span>\n<span class=\"c1\"># you are able to choose which patient to simulate.</span>\n<span class=\"c1\"># patient_name must be 'adolescent#001' to 'adolescent#010',</span>\n<span class=\"c1\"># or 'adult#001' to 'adult#010', or 'child#001' to 'child#010'</span>\n<span class=\"kn\">from</span> <span class=\"nn\">gym.envs.registration</span> <span class=\"kn\">import</span> <span class=\"n\">register</span>\n<span class=\"n\">register</span><span class=\"p\">(</span>\n    <span class=\"nb\">id</span><span class=\"o\">=</span><span class=\"s1\">'simglucose-adolescent2-v0'</span><span class=\"p\">,</span>\n    <span class=\"n\">entry_point</span><span class=\"o\">=</span><span class=\"s1\">'simglucose.envs:T1DSimEnv'</span><span class=\"p\">,</span>\n    <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'patient_name'</span><span class=\"p\">:</span> <span class=\"s1\">'adolescent#002'</span><span class=\"p\">}</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">gym</span><span class=\"o\">.</span><span class=\"n\">make</span><span class=\"p\">(</span><span class=\"s1\">'simglucose-adolescent2-v0'</span><span class=\"p\">)</span>\n\n<span class=\"n\">observation</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">reset</span><span class=\"p\">()</span>\n<span class=\"k\">for</span> <span class=\"n\">t</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"p\">):</span>\n    <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s1\">'human'</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">observation</span><span class=\"p\">)</span>\n    <span class=\"c1\"># Action in the gym environment is a scalar</span>\n    <span class=\"c1\"># representing the basal insulin, which differs from</span>\n    <span class=\"c1\"># the regular controller action outside the gym</span>\n    <span class=\"c1\"># environment (a tuple (basal, bolus)).</span>\n    <span class=\"c1\"># In the perfect situation, the agent should be able</span>\n    <span class=\"c1\"># to control the glucose only through basal instead</span>\n    <span class=\"c1\"># of asking patient to take bolus</span>\n    <span class=\"n\">action</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">action_space</span><span class=\"o\">.</span><span class=\"n\">sample</span><span class=\"p\">()</span>\n    <span class=\"n\">observation</span><span class=\"p\">,</span> <span class=\"n\">reward</span><span class=\"p\">,</span> <span class=\"n\">done</span><span class=\"p\">,</span> <span class=\"n\">info</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">step</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">done</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Episode finished after </span><span class=\"si\">{}</span><span class=\"s2\"> timesteps\"</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">t</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">))</span>\n        <span class=\"k\">break</span>\n</pre>\n<ul>\n<li>Customized reward function</li>\n</ul>\n<pre><span class=\"kn\">import</span> <span class=\"nn\">gym</span>\n<span class=\"kn\">from</span> <span class=\"nn\">gym.envs.registration</span> <span class=\"kn\">import</span> <span class=\"n\">register</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">custom_reward</span><span class=\"p\">(</span><span class=\"n\">BG_last_hour</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">BG_last_hour</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">180</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"mi\">1</span>\n    <span class=\"k\">elif</span> <span class=\"n\">BG_last_hour</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">&lt;</span> <span class=\"mi\">70</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"o\">-</span><span class=\"mi\">2</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"mi\">1</span>\n\n\n<span class=\"n\">register</span><span class=\"p\">(</span>\n    <span class=\"nb\">id</span><span class=\"o\">=</span><span class=\"s1\">'simglucose-adolescent2-v0'</span><span class=\"p\">,</span>\n    <span class=\"n\">entry_point</span><span class=\"o\">=</span><span class=\"s1\">'simglucose.envs:T1DSimEnv'</span><span class=\"p\">,</span>\n    <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'patient_name'</span><span class=\"p\">:</span> <span class=\"s1\">'adolescent#002'</span><span class=\"p\">,</span>\n            <span class=\"s1\">'reward_fun'</span><span class=\"p\">:</span> <span class=\"n\">custom_reward</span><span class=\"p\">}</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">gym</span><span class=\"o\">.</span><span class=\"n\">make</span><span class=\"p\">(</span><span class=\"s1\">'simglucose-adolescent2-v0'</span><span class=\"p\">)</span>\n\n<span class=\"n\">reward</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n<span class=\"n\">done</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">observation</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">reset</span><span class=\"p\">()</span>\n<span class=\"k\">for</span> <span class=\"n\">t</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">200</span><span class=\"p\">):</span>\n    <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s1\">'human'</span><span class=\"p\">)</span>\n    <span class=\"n\">action</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">action_space</span><span class=\"o\">.</span><span class=\"n\">sample</span><span class=\"p\">()</span>\n    <span class=\"n\">observation</span><span class=\"p\">,</span> <span class=\"n\">reward</span><span class=\"p\">,</span> <span class=\"n\">done</span><span class=\"p\">,</span> <span class=\"n\">info</span> <span class=\"o\">=</span> <span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">step</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">observation</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Reward = </span><span class=\"si\">{}</span><span class=\"s2\">\"</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">reward</span><span class=\"p\">))</span>\n    <span class=\"k\">if</span> <span class=\"n\">done</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Episode finished after </span><span class=\"si\">{}</span><span class=\"s2\"> timesteps\"</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">t</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">))</span>\n        <span class=\"k\">break</span>\n</pre>\n<h3>rllab usage</h3>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">rllab.algos.ddpg</span> <span class=\"kn\">import</span> <span class=\"n\">DDPG</span>\n<span class=\"kn\">from</span> <span class=\"nn\">rllab.envs.normalized_env</span> <span class=\"kn\">import</span> <span class=\"n\">normalize</span>\n<span class=\"kn\">from</span> <span class=\"nn\">rllab.exploration_strategies.ou_strategy</span> <span class=\"kn\">import</span> <span class=\"n\">OUStrategy</span>\n<span class=\"kn\">from</span> <span class=\"nn\">rllab.policies.deterministic_mlp_policy</span> <span class=\"kn\">import</span> <span class=\"n\">DeterministicMLPPolicy</span>\n<span class=\"kn\">from</span> <span class=\"nn\">rllab.q_functions.continuous_mlp_q_function</span> <span class=\"kn\">import</span> <span class=\"n\">ContinuousMLPQFunction</span>\n<span class=\"kn\">from</span> <span class=\"nn\">rllab.envs.gym_env</span> <span class=\"kn\">import</span> <span class=\"n\">GymEnv</span>\n<span class=\"kn\">from</span> <span class=\"nn\">gym.envs.registration</span> <span class=\"kn\">import</span> <span class=\"n\">register</span>\n\n<span class=\"n\">register</span><span class=\"p\">(</span>\n    <span class=\"nb\">id</span><span class=\"o\">=</span><span class=\"s1\">'simglucose-adolescent2-v0'</span><span class=\"p\">,</span>\n    <span class=\"n\">entry_point</span><span class=\"o\">=</span><span class=\"s1\">'simglucose.envs:T1DSimEnv'</span><span class=\"p\">,</span>\n    <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'patient_name'</span><span class=\"p\">:</span> <span class=\"s1\">'adolescent#002'</span><span class=\"p\">}</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">GymEnv</span><span class=\"p\">(</span><span class=\"s1\">'simglucose-adolescent2-v0'</span><span class=\"p\">)</span>\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">normalize</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">)</span>\n\n<span class=\"n\">policy</span> <span class=\"o\">=</span> <span class=\"n\">DeterministicMLPPolicy</span><span class=\"p\">(</span>\n    <span class=\"n\">env_spec</span><span class=\"o\">=</span><span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">spec</span><span class=\"p\">,</span>\n    <span class=\"c1\"># The neural network policy should have two hidden layers, each with 32 hidden units.</span>\n    <span class=\"n\">hidden_sizes</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">32</span><span class=\"p\">,</span> <span class=\"mi\">32</span><span class=\"p\">)</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">es</span> <span class=\"o\">=</span> <span class=\"n\">OUStrategy</span><span class=\"p\">(</span><span class=\"n\">env_spec</span><span class=\"o\">=</span><span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">spec</span><span class=\"p\">)</span>\n\n<span class=\"n\">qf</span> <span class=\"o\">=</span> <span class=\"n\">ContinuousMLPQFunction</span><span class=\"p\">(</span><span class=\"n\">env_spec</span><span class=\"o\">=</span><span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">spec</span><span class=\"p\">)</span>\n\n<span class=\"n\">algo</span> <span class=\"o\">=</span> <span class=\"n\">DDPG</span><span class=\"p\">(</span>\n    <span class=\"n\">env</span><span class=\"o\">=</span><span class=\"n\">env</span><span class=\"p\">,</span>\n    <span class=\"n\">policy</span><span class=\"o\">=</span><span class=\"n\">policy</span><span class=\"p\">,</span>\n    <span class=\"n\">es</span><span class=\"o\">=</span><span class=\"n\">es</span><span class=\"p\">,</span>\n    <span class=\"n\">qf</span><span class=\"o\">=</span><span class=\"n\">qf</span><span class=\"p\">,</span>\n    <span class=\"n\">batch_size</span><span class=\"o\">=</span><span class=\"mi\">32</span><span class=\"p\">,</span>\n    <span class=\"n\">max_path_length</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span>\n    <span class=\"n\">epoch_length</span><span class=\"o\">=</span><span class=\"mi\">1000</span><span class=\"p\">,</span>\n    <span class=\"n\">min_pool_size</span><span class=\"o\">=</span><span class=\"mi\">10000</span><span class=\"p\">,</span>\n    <span class=\"n\">n_epochs</span><span class=\"o\">=</span><span class=\"mi\">1000</span><span class=\"p\">,</span>\n    <span class=\"n\">discount</span><span class=\"o\">=</span><span class=\"mf\">0.99</span><span class=\"p\">,</span>\n    <span class=\"n\">scale_reward</span><span class=\"o\">=</span><span class=\"mf\">0.01</span><span class=\"p\">,</span>\n    <span class=\"n\">qf_learning_rate</span><span class=\"o\">=</span><span class=\"mf\">1e-3</span><span class=\"p\">,</span>\n    <span class=\"n\">policy_learning_rate</span><span class=\"o\">=</span><span class=\"mf\">1e-4</span>\n<span class=\"p\">)</span>\n<span class=\"n\">algo</span><span class=\"o\">.</span><span class=\"n\">train</span><span class=\"p\">()</span>\n</pre>\n<h2>Advanced Usage</h2>\n<p>You can create the simulation objects, and run batch simulation. For example,</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">simglucose.simulation.env</span> <span class=\"kn\">import</span> <span class=\"n\">T1DSimEnv</span>\n<span class=\"kn\">from</span> <span class=\"nn\">simglucose.controller.basal_bolus_ctrller</span> <span class=\"kn\">import</span> <span class=\"n\">BBController</span>\n<span class=\"kn\">from</span> <span class=\"nn\">simglucose.sensor.cgm</span> <span class=\"kn\">import</span> <span class=\"n\">CGMSensor</span>\n<span class=\"kn\">from</span> <span class=\"nn\">simglucose.actuator.pump</span> <span class=\"kn\">import</span> <span class=\"n\">InsulinPump</span>\n<span class=\"kn\">from</span> <span class=\"nn\">simglucose.patient.t1dpatient</span> <span class=\"kn\">import</span> <span class=\"n\">T1DPatient</span>\n<span class=\"kn\">from</span> <span class=\"nn\">simglucose.simulation.scenario_gen</span> <span class=\"kn\">import</span> <span class=\"n\">RandomScenario</span>\n<span class=\"kn\">from</span> <span class=\"nn\">simglucose.simulation.scenario</span> <span class=\"kn\">import</span> <span class=\"n\">CustomScenario</span>\n<span class=\"kn\">from</span> <span class=\"nn\">simglucose.simulation.sim_engine</span> <span class=\"kn\">import</span> <span class=\"n\">SimObj</span><span class=\"p\">,</span> <span class=\"n\">sim</span><span class=\"p\">,</span> <span class=\"n\">batch_sim</span>\n<span class=\"kn\">from</span> <span class=\"nn\">datetime</span> <span class=\"kn\">import</span> <span class=\"n\">timedelta</span>\n<span class=\"kn\">from</span> <span class=\"nn\">datetime</span> <span class=\"kn\">import</span> <span class=\"n\">datetime</span>\n\n<span class=\"c1\"># specify start_time as the beginning of today</span>\n<span class=\"n\">now</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">now</span><span class=\"p\">()</span>\n<span class=\"n\">start_time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">combine</span><span class=\"p\">(</span><span class=\"n\">now</span><span class=\"o\">.</span><span class=\"n\">date</span><span class=\"p\">(),</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">min</span><span class=\"o\">.</span><span class=\"n\">time</span><span class=\"p\">())</span>\n\n<span class=\"c1\"># --------- Create Random Scenario --------------</span>\n<span class=\"c1\"># Specify results saving path</span>\n<span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s1\">'./results'</span>\n\n<span class=\"c1\"># Create a simulation environment</span>\n<span class=\"n\">patient</span> <span class=\"o\">=</span> <span class=\"n\">T1DPatient</span><span class=\"o\">.</span><span class=\"n\">withName</span><span class=\"p\">(</span><span class=\"s1\">'adolescent#001'</span><span class=\"p\">)</span>\n<span class=\"n\">sensor</span> <span class=\"o\">=</span> <span class=\"n\">CGMSensor</span><span class=\"o\">.</span><span class=\"n\">withName</span><span class=\"p\">(</span><span class=\"s1\">'Dexcom'</span><span class=\"p\">,</span> <span class=\"n\">seed</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">pump</span> <span class=\"o\">=</span> <span class=\"n\">InsulinPump</span><span class=\"o\">.</span><span class=\"n\">withName</span><span class=\"p\">(</span><span class=\"s1\">'Insulet'</span><span class=\"p\">)</span>\n<span class=\"n\">scenario</span> <span class=\"o\">=</span> <span class=\"n\">RandomScenario</span><span class=\"p\">(</span><span class=\"n\">start_time</span><span class=\"o\">=</span><span class=\"n\">start_time</span><span class=\"p\">,</span> <span class=\"n\">seed</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">T1DSimEnv</span><span class=\"p\">(</span><span class=\"n\">patient</span><span class=\"p\">,</span> <span class=\"n\">sensor</span><span class=\"p\">,</span> <span class=\"n\">pump</span><span class=\"p\">,</span> <span class=\"n\">scenario</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Create a controller</span>\n<span class=\"n\">controller</span> <span class=\"o\">=</span> <span class=\"n\">BBController</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># Put them together to create a simulation object</span>\n<span class=\"n\">s1</span> <span class=\"o\">=</span> <span class=\"n\">SimObj</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">,</span> <span class=\"n\">controller</span><span class=\"p\">,</span> <span class=\"n\">timedelta</span><span class=\"p\">(</span><span class=\"n\">days</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">animate</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">path</span><span class=\"p\">)</span>\n<span class=\"n\">results1</span> <span class=\"o\">=</span> <span class=\"n\">sim</span><span class=\"p\">(</span><span class=\"n\">s1</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">results1</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># --------- Create Custom Scenario --------------</span>\n<span class=\"c1\"># Create a simulation environment</span>\n<span class=\"n\">patient</span> <span class=\"o\">=</span> <span class=\"n\">T1DPatient</span><span class=\"o\">.</span><span class=\"n\">withName</span><span class=\"p\">(</span><span class=\"s1\">'adolescent#001'</span><span class=\"p\">)</span>\n<span class=\"n\">sensor</span> <span class=\"o\">=</span> <span class=\"n\">CGMSensor</span><span class=\"o\">.</span><span class=\"n\">withName</span><span class=\"p\">(</span><span class=\"s1\">'Dexcom'</span><span class=\"p\">,</span> <span class=\"n\">seed</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">pump</span> <span class=\"o\">=</span> <span class=\"n\">InsulinPump</span><span class=\"o\">.</span><span class=\"n\">withName</span><span class=\"p\">(</span><span class=\"s1\">'Insulet'</span><span class=\"p\">)</span>\n<span class=\"c1\"># custom scenario is a list of tuples (time, meal_size)</span>\n<span class=\"n\">scen</span> <span class=\"o\">=</span> <span class=\"p\">[(</span><span class=\"mi\">7</span><span class=\"p\">,</span> <span class=\"mi\">45</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span> <span class=\"mi\">70</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">,</span> <span class=\"mi\">15</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"mi\">18</span><span class=\"p\">,</span> <span class=\"mi\">80</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"mi\">23</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">)]</span>\n<span class=\"n\">scenario</span> <span class=\"o\">=</span> <span class=\"n\">CustomScenario</span><span class=\"p\">(</span><span class=\"n\">start_time</span><span class=\"o\">=</span><span class=\"n\">start_time</span><span class=\"p\">,</span> <span class=\"n\">scenario</span><span class=\"o\">=</span><span class=\"n\">scen</span><span class=\"p\">)</span>\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">T1DSimEnv</span><span class=\"p\">(</span><span class=\"n\">patient</span><span class=\"p\">,</span> <span class=\"n\">sensor</span><span class=\"p\">,</span> <span class=\"n\">pump</span><span class=\"p\">,</span> <span class=\"n\">scenario</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Create a controller</span>\n<span class=\"n\">controller</span> <span class=\"o\">=</span> <span class=\"n\">BBController</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># Put them together to create a simulation object</span>\n<span class=\"n\">s2</span> <span class=\"o\">=</span> <span class=\"n\">SimObj</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">,</span> <span class=\"n\">controller</span><span class=\"p\">,</span> <span class=\"n\">timedelta</span><span class=\"p\">(</span><span class=\"n\">days</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">animate</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">path</span><span class=\"p\">)</span>\n<span class=\"n\">results2</span> <span class=\"o\">=</span> <span class=\"n\">sim</span><span class=\"p\">(</span><span class=\"n\">s2</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">results2</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\"># --------- batch simulation --------------</span>\n<span class=\"c1\"># Re-initialize simulation objects</span>\n<span class=\"n\">s1</span><span class=\"o\">.</span><span class=\"n\">reset</span><span class=\"p\">()</span>\n<span class=\"n\">s2</span><span class=\"o\">.</span><span class=\"n\">reset</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># create a list of SimObj, and call batch_sim</span>\n<span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">s1</span><span class=\"p\">,</span> <span class=\"n\">s2</span><span class=\"p\">]</span>\n<span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"n\">batch_sim</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"n\">parallel</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">results</span><span class=\"p\">)</span>\n</pre>\n<p>Run analysis offline</p>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">simglucose.analysis.report</span> <span class=\"kn\">import</span> <span class=\"n\">report</span>\n<span class=\"kn\">import</span> <span class=\"nn\">pandas</span> <span class=\"k\">as</span> <span class=\"nn\">pd</span>\n<span class=\"kn\">import</span> <span class=\"nn\">os</span>\n<span class=\"kn\">import</span> <span class=\"nn\">glob</span>\n\n<span class=\"c1\"># the path where results are saved</span>\n<span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"s1\">'.'</span><span class=\"p\">,</span> <span class=\"s1\">'results'</span><span class=\"p\">,</span> <span class=\"s1\">'2017-12-31_17-46-32'</span><span class=\"p\">)</span>\n<span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">chdir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n<span class=\"c1\"># find all csv with pattern *#*.csv, e.g. adolescent#001.csv</span>\n<span class=\"n\">filename</span> <span class=\"o\">=</span> <span class=\"n\">glob</span><span class=\"o\">.</span><span class=\"n\">glob</span><span class=\"p\">(</span><span class=\"s1\">'*#*.csv'</span><span class=\"p\">)</span>\n<span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">_f</span><span class=\"p\">[:</span><span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">_f</span> <span class=\"ow\">in</span> <span class=\"n\">filename</span><span class=\"p\">]</span>   <span class=\"c1\"># get the filename without extension</span>\n<span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">concat</span><span class=\"p\">([</span><span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_csv</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">,</span> <span class=\"n\">index_col</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"n\">filename</span><span class=\"p\">],</span> <span class=\"n\">keys</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">)</span>\n<span class=\"n\">report</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">)</span>\n</pre>\n<h2>Release Notes</h2>\n<h3>9/10/2018</h3>\n<ul>\n<li>Controller <code>policy</code> method gets access to all the current patient state through <code>info['patient_state']</code>.</li>\n</ul>\n<h3>2/26/2018</h3>\n<ul>\n<li>Support customized reward function.</li>\n</ul>\n<h3>1/10/2018</h3>\n<ul>\n<li>Added workaround to select patient when make gym environment: register gym environment by passing kwargs of patient_name.</li>\n</ul>\n<h3>1/7/2018</h3>\n<ul>\n<li>Added OpenAI gym support, use <code>gym.make('simglucose-v0')</code> to make the enviroment.</li>\n<li>Noticed issue: the patient name selection is not available in gym.make for now. The patient name has to be hard-coded in the constructor of <code>simglucose.envs.T1DSimEnv</code>.</li>\n</ul>\n<h2>Reporting issues</h2>\n<p>Shoot me any bugs, enhancements or even discussion by <a href=\"https://github.com/jxx123/simglucose/issues/new\" rel=\"nofollow\">creating issues</a>.</p>\n<h2>How to contribute</h2>\n<p>The following instruction is originally from the <a href=\"https://github.com/scikit-learn/scikit-learn/blob/master/CONTRIBUTING.md\" rel=\"nofollow\">contribution instructions of sklearn</a>.</p>\n<p>The preferred workflow for contributing to simglucose is to fork the\n<a href=\"https://github.com/jxx123/simglucose\" rel=\"nofollow\">main repository</a> on\nGitHub, clone, and develop on a branch. Steps:</p>\n<ol>\n<li>\n<p>Fork the <a href=\"https://github.com/jxx123/simglucose\" rel=\"nofollow\">project repository</a>\nby clicking on the 'Fork' button near the top right of the page. This creates\na copy of the code under your GitHub user account. For more details on\nhow to fork a repository see <a href=\"https://help.github.com/articles/fork-a-repo/\" rel=\"nofollow\">this guide</a>.</p>\n</li>\n<li>\n<p>Clone your fork of the simglucose repo from your GitHub account to your local disk:</p>\n<pre>$ git clone git@github.com:YourLogin/simglucose.git\n$ <span class=\"nb\">cd</span> simglucose\n</pre>\n</li>\n<li>\n<p>Create a <code>feature</code> branch to hold your development changes:</p>\n<pre>$ git checkout -b my-feature\n</pre>\n<p>Always use a <code>feature</code> branch. It's good practice to <strong>never work on the <code>master</code> branch</strong>!</p>\n</li>\n<li>\n<p>Develop the feature on your feature branch. Add changed files using <code>git add</code> and then <code>git commit</code> files:</p>\n<pre>$ git add modified_files\n$ git commit\n</pre>\n<p>to record your changes in Git, then push the changes to your GitHub account with:</p>\n<pre>$ git push -u origin my-feature\n</pre>\n</li>\n<li>\n<p>Follow <a href=\"https://help.github.com/articles/creating-a-pull-request-from-a-fork\" rel=\"nofollow\">these instructions</a>\nto create a pull request from your fork. This will send an email to the committers.</p>\n</li>\n</ol>\n<p>(If any of the above seems like magic to you, please look up the\n<a href=\"https://git-scm.com/documentation\" rel=\"nofollow\">Git documentation</a> on the web, or ask a friend or another contributor for help.)</p>\n\n          </div>"}, "last_serial": 4259786, "releases": {"0.1.0": [{"comment_text": "", "digests": {"md5": "d5dac2cce4ca4e1bea8eb8fbb1439bf6", "sha256": "9cea86d5874307fa2b6dbdd8407fb485ec8b0f88c26d4a7bfbf493cd4a59120c"}, "downloads": -1, "filename": "simglucose-0.1.0.tar.gz", "has_sig": false, "md5_digest": "d5dac2cce4ca4e1bea8eb8fbb1439bf6", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 29748, "upload_time": "2018-01-01T03:20:20", "upload_time_iso_8601": "2018-01-01T03:20:20.622357Z", "url": "https://files.pythonhosted.org/packages/7c/fb/f0c1230743d4e8ebd152c06e3ee0a571a72147c0a81c8f344d882d96e8c8/simglucose-0.1.0.tar.gz", "yanked": false}], "0.1.1": [{"comment_text": "", "digests": {"md5": "7f8874bf7af12af7472cc112c8dd019e", "sha256": "711b13c7e7c74867773f99dac991602b9743fdf90b169e449d5ae9b6c3a3beae"}, "downloads": -1, "filename": "simglucose-0.1.1.tar.gz", "has_sig": false, "md5_digest": "7f8874bf7af12af7472cc112c8dd019e", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 29759, "upload_time": "2018-01-01T03:34:48", "upload_time_iso_8601": "2018-01-01T03:34:48.074769Z", "url": "https://files.pythonhosted.org/packages/0e/d7/6c253ed8375e670b59c8ec31f8e0ebb0ace9115e7d406649c06a238e762b/simglucose-0.1.1.tar.gz", "yanked": false}], "0.1.2": [{"comment_text": "", "digests": {"md5": "89f8cc32fc72011a095e1b36b2e4e7bb", "sha256": "1f7c75023f94dcac2bd0b80fbe332b662a9ac38702c67ebe31b23ee4aba92a7f"}, "downloads": -1, "filename": "simglucose-0.1.2.tar.gz", "has_sig": false, "md5_digest": "89f8cc32fc72011a095e1b36b2e4e7bb", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 30155, "upload_time": "2018-01-01T15:02:13", "upload_time_iso_8601": "2018-01-01T15:02:13.548902Z", "url": "https://files.pythonhosted.org/packages/7b/02/d7b847002e895985523113961a56f085e62738d549892304f966eb2f866b/simglucose-0.1.2.tar.gz", "yanked": false}], "0.1.3": [{"comment_text": "", "digests": {"md5": "17bfe56b9a5835e15baebe54a18604cb", "sha256": "eb5940ac51ac2e6cafe36aafb2a98e818e70da6322bf73fe11cd67117e6072a2"}, "downloads": -1, "filename": "simglucose-0.1.3.tar.gz", "has_sig": false, "md5_digest": "17bfe56b9a5835e15baebe54a18604cb", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 584301, "upload_time": "2018-01-02T04:20:05", "upload_time_iso_8601": "2018-01-02T04:20:05.691771Z", "url": "https://files.pythonhosted.org/packages/d3/08/c183f19cd49a51846183fd356899ddfc049cdd6c05a7ced7f0232d912258/simglucose-0.1.3.tar.gz", "yanked": false}], "0.1.4": [{"comment_text": "", "digests": {"md5": "2155d295e3755b0c04cbdaee72cb5fbe", "sha256": "b43c71abec913cdb547e6bd290cd30c8e8e121c2cf4f6ee95faf3f1174442806"}, "downloads": -1, "filename": "simglucose-0.1.4.tar.gz", "has_sig": false, "md5_digest": "2155d295e3755b0c04cbdaee72cb5fbe", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 584749, "upload_time": "2018-01-03T05:14:39", "upload_time_iso_8601": "2018-01-03T05:14:39.524159Z", "url": "https://files.pythonhosted.org/packages/bb/e5/fb2f694df51c3d7e8f02a3627da485c31e3615dddf323cb86b7468644a31/simglucose-0.1.4.tar.gz", "yanked": false}], "0.1.5": [{"comment_text": "", "digests": {"md5": "f375b8738aa385199ce766de2ed003b4", "sha256": "8fed14185625fe28cf7ba57fc8a5c3fd1bfadb31d29ac7fccfec476bded0ce4b"}, "downloads": -1, "filename": "simglucose-0.1.5.tar.gz", "has_sig": false, "md5_digest": "f375b8738aa385199ce766de2ed003b4", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 587033, "upload_time": "2018-01-08T04:09:35", "upload_time_iso_8601": "2018-01-08T04:09:35.134430Z", "url": "https://files.pythonhosted.org/packages/69/54/d0a37439635d9d77685754e3000b530017aee96504f3a6739a01bab0b445/simglucose-0.1.5.tar.gz", "yanked": false}], "0.1.6": [{"comment_text": "", "digests": {"md5": "2ac5a1a3ed54af13a5764d6aa9bbe1c7", "sha256": "1689535114666a43719323feb5d0a86ee335448f8c09bc444e91b9b49c361d02"}, "downloads": -1, "filename": "simglucose-0.1.6.tar.gz", "has_sig": false, "md5_digest": "2ac5a1a3ed54af13a5764d6aa9bbe1c7", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 586513, "upload_time": "2018-01-12T02:45:28", "upload_time_iso_8601": "2018-01-12T02:45:28.382403Z", "url": "https://files.pythonhosted.org/packages/1b/6d/c397c038ae6dded1463d663ce7675cea8a27e69fd04566ecb8cb14a88893/simglucose-0.1.6.tar.gz", "yanked": false}], "0.1.7": [{"comment_text": "", "digests": {"md5": "44b76e63a3769fc1850c8a0ade466c68", "sha256": "49a7adfd812af0ca415d83ca06feff9faae98207fcf9e3f3fa99d4b411628f97"}, "downloads": -1, "filename": "simglucose-0.1.7.tar.gz", "has_sig": false, "md5_digest": "44b76e63a3769fc1850c8a0ade466c68", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 589151, "upload_time": "2018-01-29T02:39:12", "upload_time_iso_8601": "2018-01-29T02:39:12.780144Z", "url": "https://files.pythonhosted.org/packages/ea/c9/779234250287af24a0b53ac828c005619a698d7794870cd88b05ad3c53a0/simglucose-0.1.7.tar.gz", "yanked": false}], "0.1.8": [{"comment_text": "", "digests": {"md5": "783b140da77f30638372ea98a2820dcc", "sha256": "32da8fbc4f8e87a49d2b23b60d80f5fd418a564b074f2eb1f9ad389b2be37da6"}, "downloads": -1, "filename": "simglucose-0.1.8.tar.gz", "has_sig": false, "md5_digest": "783b140da77f30638372ea98a2820dcc", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 588930, "upload_time": "2018-02-14T05:23:46", "upload_time_iso_8601": "2018-02-14T05:23:46.078417Z", "url": "https://files.pythonhosted.org/packages/70/58/7cd27e5284633e95ad65283827e6e8e328b279e660c5119179a86153e2b5/simglucose-0.1.8.tar.gz", "yanked": false}], "0.1.9": [{"comment_text": "", "digests": {"md5": "b2837733e6d14d72e3584c8dbcfb10cf", "sha256": "23f2a4005eed4c66c07ed4870b3b5eaae5765e341240565019abc7ac88c3baaa"}, "downloads": -1, "filename": "simglucose-0.1.9.tar.gz", "has_sig": false, "md5_digest": "b2837733e6d14d72e3584c8dbcfb10cf", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 589061, "upload_time": "2018-02-27T03:46:08", "upload_time_iso_8601": "2018-02-27T03:46:08.480933Z", "url": "https://files.pythonhosted.org/packages/a5/fc/5dd7745181034f36b460ce8c05ceed76bd354ababcbc74352784bfb23eec/simglucose-0.1.9.tar.gz", "yanked": false}], "0.2.0": [{"comment_text": "", "digests": {"md5": "d16ef030336ab25d0011cd91c641aabf", "sha256": "5dbe0229b552491776f75a4281548a822089dccc2d63da515df398623e9682ed"}, "downloads": -1, "filename": "simglucose-0.2.0-py3-none-any.whl", "has_sig": false, "md5_digest": "d16ef030336ab25d0011cd91c641aabf", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 35492, "upload_time": "2018-09-11T02:34:56", "upload_time_iso_8601": "2018-09-11T02:34:56.843722Z", "url": "https://files.pythonhosted.org/packages/6a/21/b73c1394b255bb60de2a9da3a113180f4fc5f107d7b426cfc7ad016fe80b/simglucose-0.2.0-py3-none-any.whl", "yanked": false}], "0.2.1": [{"comment_text": "", "digests": {"md5": "f8bab5e2169087b05b742f787b3c3bfa", "sha256": "3b5ec0df53e69592492217330246469295455226b72336859433284f9c97a07e"}, "downloads": -1, "filename": "simglucose-0.2.1-py3-none-any.whl", "has_sig": false, "md5_digest": "f8bab5e2169087b05b742f787b3c3bfa", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 40466, "upload_time": "2018-09-11T02:48:09", "upload_time_iso_8601": "2018-09-11T02:48:09.461385Z", "url": "https://files.pythonhosted.org/packages/e1/25/65287b014ef84ccb0c0173cb04c2b3e1068022444dc8f5619e18cad3dc71/simglucose-0.2.1-py3-none-any.whl", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "f8bab5e2169087b05b742f787b3c3bfa", "sha256": "3b5ec0df53e69592492217330246469295455226b72336859433284f9c97a07e"}, "downloads": -1, "filename": "simglucose-0.2.1-py3-none-any.whl", "has_sig": false, "md5_digest": "f8bab5e2169087b05b742f787b3c3bfa", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 40466, "upload_time": "2018-09-11T02:48:09", "upload_time_iso_8601": "2018-09-11T02:48:09.461385Z", "url": "https://files.pythonhosted.org/packages/e1/25/65287b014ef84ccb0c0173cb04c2b3e1068022444dc8f5619e18cad3dc71/simglucose-0.2.1-py3-none-any.whl", "yanked": false}], "timestamp": "Fri May  8 03:11:14 2020"}