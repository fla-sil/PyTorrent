{"info": {"author": "GoPythonGo.com", "author_email": "info@gopythongo.com", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Intended Audience :: Developers", "Intended Audience :: System Administrators", "License :: OSI Approved :: BSD License", "Operating System :: POSIX", "Programming Language :: Python :: 3 :: Only"], "description": "django-postgresql-setrole\n=========================\n\nA Django application that executes `SET ROLE` on every connection to PostgreSQL\nopened by Django. This is useful if you're using external authentication\nmanagers like `Hashicorp Vault <http://vaultproject.io/>`__\\ .\n\nPostgreSQL's user model (\"roles\") assigns every object created in a database/\ntablespace/schema an \"owner\". Said owner is the *only* user that can modify or\ndrop the object. This means that user credentials leased from Vault which\nexpire after some time, can't be used to create or migrate tables unless you\nuse the same user name every time (which would defeat the purpose).\n\nThe solution is to create an \"owner role\". In layman's terms \"a group that has\nall necessary permissions on the database and the INHERIT attribute and will\nact as the 'sudo' user for leased users from the authentication manager\". All\nusers created by the authentication manager will then be assigned this group\nand when they connect to the database execute \"SET ROLE <owner role>\", thereby\nmaking all objects created owned by the owner role.\n\n\nHow do I use this Django application?\n-------------------------------------\nAdd `postgresql_setrole` to `INSTALLED_APPS`. Then in `settings.DATABASES` add\n\n.. code-block:: python\n\n    DATABASES = {\n        \"default\": {\n            ...,  # other settings\n            \"SET_ROLE\": \"mydatabaseowner\",\n        }.\n    }\n\n\nWhy is SET ROLE necessary?\n--------------------------\nThe `INHERIT` attribute is not bidirectional. So if a (user) role is assigned\na (group) role it inherits the group's permissions, but the group does not\ngain any rights on objects created by the user role.\n\nSo what you want is the (group) owner role to own everything.\n\n\nHow do I set this up?\n---------------------\nOn your shell as the `postgres` superuser:\n\n.. code-block:: shell\n\n    # --- create an admin role for Vault\n    # no create database\n    # encrypt password\n    # do not inherit rights\n    # can create roles\n    # not a superuser\n    createuser -D -E -I -l -r -S vaultadmin\n\n    # --- create an owner role for your database\n    # no create database\n    # encrypt password\n    # do not inherit rights\n    # can't create roles\n    # not a superuser\n    createuser -D -E -I -L -R -S mydatabaseowner\n    createdb -E utf8 -O mydatabaseowner mydatabase\n\nThen configure Vault to create roles like this:\n\n.. code-block:: shell\n\n    $ vault mount -path=postgresql database\n    $ vault write postgresql/config/mydatabase \\\n                      plugin_name=postgresql-database-plugin \\\n                      allowed_roles=\"mydatabase_fullaccess\" \\\n                      connection_url=\"postgresql://mydatapaseowner:[mydatabasepassword]@localhost:5432/\"\n    $ vault write postgresql/roles/mydatabase_fullaccess -\n    {\n        \"db_name\": \"mydatabase\",\n        \"default_ttl\": \"10m\",\n        \"max_ttl\": \"1h\",\n        \"creation_statements\": \"CREATE ROLE \\\"{{name}}\\\" WITH LOGIN ENCRYPTED PASSWORD '{{password}}' VALID UNTIL '{{expiration}}' IN ROLE \\\"mydatabaseowner\\\" INHERIT NOCREATEROLE NOCREATEDB NOSUPERUSER NOREPLICATION NOBYPASSRLS;\",\n        \"revocation_statements\": \"DROP ROLE \\\"name\\\";\"\n    }\n\nThen users created by Vault when they log in must run\n\n.. code-block:: sql\n\n    SET ROLE \"mydatabaseowner\";\n\nThis ensures that all created tables and other objects belong to\n`mydatabaseowner`.\n\n\nLicense\n=======\n\nCopyright (c) 2016-2017, Jonas Maurus\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this\n   list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright notice,\n   this list of conditions and the following disclaimer in the documentation\n   and/or other materials provided with the distribution.\n\n3. Neither the name of the copyright holder nor the names of its contributors\n   may be used to endorse or promote products derived from this software\n   without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\nOR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n\n", "description_content_type": null, "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/jdelic/django-postgresql-setrole/", "keywords": "", "license": "", "maintainer": "", "maintainer_email": "", "name": "django-postgresql-setrole", "package_url": "https://pypi.org/project/django-postgresql-setrole/", "platform": "", "project_url": "https://pypi.org/project/django-postgresql-setrole/", "project_urls": {"Homepage": "https://github.com/jdelic/django-postgresql-setrole/"}, "release_url": "https://pypi.org/project/django-postgresql-setrole/1.0.10/", "requires_dist": null, "requires_python": "", "summary": "Execute SET ROLE on every PostgreSQL connection in the Django ORM", "version": "1.0.10", "yanked": false, "html_description": "<div class=\"project-description\">\n            <div id=\"django-postgresql-setrole\">\n<h2>django-postgresql-setrole</h2>\n<p>A Django application that executes <cite>SET ROLE</cite> on every connection to PostgreSQL\nopened by Django. This is useful if you\u2019re using external authentication\nmanagers like <a href=\"http://vaultproject.io/\" rel=\"nofollow\">Hashicorp Vault</a>.</p>\n<p>PostgreSQL\u2019s user model (\u201croles\u201d) assigns every object created in a database/\ntablespace/schema an \u201cowner\u201d. Said owner is the <em>only</em> user that can modify or\ndrop the object. This means that user credentials leased from Vault which\nexpire after some time, can\u2019t be used to create or migrate tables unless you\nuse the same user name every time (which would defeat the purpose).</p>\n<p>The solution is to create an \u201cowner role\u201d. In layman\u2019s terms \u201ca group that has\nall necessary permissions on the database and the INHERIT attribute and will\nact as the \u2018sudo\u2019 user for leased users from the authentication manager\u201d. All\nusers created by the authentication manager will then be assigned this group\nand when they connect to the database execute \u201cSET ROLE &lt;owner role&gt;\u201d, thereby\nmaking all objects created owned by the owner role.</p>\n<div id=\"how-do-i-use-this-django-application\">\n<h3>How do I use this Django application?</h3>\n<p>Add <cite>postgresql_setrole</cite> to <cite>INSTALLED_APPS</cite>. Then in <cite>settings.DATABASES</cite> add</p>\n<pre><span class=\"n\">DATABASES</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s2\">\"default\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"o\">...</span><span class=\"p\">,</span>  <span class=\"c1\"># other settings</span>\n        <span class=\"s2\">\"SET_ROLE\"</span><span class=\"p\">:</span> <span class=\"s2\">\"mydatabaseowner\"</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span><span class=\"o\">.</span>\n<span class=\"p\">}</span>\n</pre>\n</div>\n<div id=\"why-is-set-role-necessary\">\n<h3>Why is SET ROLE necessary?</h3>\n<p>The <cite>INHERIT</cite> attribute is not bidirectional. So if a (user) role is assigned\na (group) role it inherits the group\u2019s permissions, but the group does not\ngain any rights on objects created by the user role.</p>\n<p>So what you want is the (group) owner role to own everything.</p>\n</div>\n<div id=\"how-do-i-set-this-up\">\n<h3>How do I set this up?</h3>\n<p>On your shell as the <cite>postgres</cite> superuser:</p>\n<pre><span class=\"c1\"># --- create an admin role for Vault\n# no create database\n# encrypt password\n# do not inherit rights\n# can create roles\n# not a superuser\n</span>createuser -D -E -I -l -r -S vaultadmin\n\n<span class=\"c1\"># --- create an owner role for your database\n# no create database\n# encrypt password\n# do not inherit rights\n# can't create roles\n# not a superuser\n</span>createuser -D -E -I -L -R -S mydatabaseowner\ncreatedb -E utf8 -O mydatabaseowner mydatabase\n</pre>\n<p>Then configure Vault to create roles like this:</p>\n<pre>$ vault mount -path<span class=\"o\">=</span>postgresql database\n$ vault write postgresql/config/mydatabase <span class=\"se\">\\\n</span>                  <span class=\"nv\">plugin_name</span><span class=\"o\">=</span>postgresql-database-plugin <span class=\"se\">\\\n</span>                  <span class=\"nv\">allowed_roles</span><span class=\"o\">=</span><span class=\"s2\">\"mydatabase_fullaccess\"</span> <span class=\"se\">\\\n</span>                  <span class=\"nv\">connection_url</span><span class=\"o\">=</span><span class=\"s2\">\"postgresql://mydatapaseowner:[mydatabasepassword]@localhost:5432/\"</span>\n$ vault write postgresql/roles/mydatabase_fullaccess -\n<span class=\"o\">{</span>\n    <span class=\"s2\">\"db_name\"</span>: <span class=\"s2\">\"mydatabase\"</span>,\n    <span class=\"s2\">\"default_ttl\"</span>: <span class=\"s2\">\"10m\"</span>,\n    <span class=\"s2\">\"max_ttl\"</span>: <span class=\"s2\">\"1h\"</span>,\n    <span class=\"s2\">\"creation_statements\"</span>: <span class=\"s2\">\"CREATE ROLE \\\"{{name}}\\\" WITH LOGIN ENCRYPTED PASSWORD '{{password}}' VALID UNTIL '{{expiration}}' IN ROLE \\\"mydatabaseowner\\\" INHERIT NOCREATEROLE NOCREATEDB NOSUPERUSER NOREPLICATION NOBYPASSRLS;\"</span>,\n    <span class=\"s2\">\"revocation_statements\"</span>: <span class=\"s2\">\"DROP ROLE \\\"name\\\";\"</span>\n<span class=\"o\">}</span>\n</pre>\n<p>Then users created by Vault when they log in must run</p>\n<pre><span class=\"k\">SET</span> <span class=\"k\">ROLE</span> <span class=\"ss\">\"mydatabaseowner\"</span><span class=\"p\">;</span>\n</pre>\n<p>This ensures that all created tables and other objects belong to\n<cite>mydatabaseowner</cite>.</p>\n</div>\n</div>\n<div id=\"license\">\n<h2>License</h2>\n<p>Copyright (c) 2016-2017, Jonas Maurus\nAll rights reserved.</p>\n<p>Redistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:</p>\n<ol>\n<li>Redistributions of source code must retain the above copyright notice, this\nlist of conditions and the following disclaimer.</li>\n<li>Redistributions in binary form must reproduce the above copyright notice,\nthis list of conditions and the following disclaimer in the documentation\nand/or other materials provided with the distribution.</li>\n<li>Neither the name of the copyright holder nor the names of its contributors\nmay be used to endorse or promote products derived from this software\nwithout specific prior written permission.</li>\n</ol>\n<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \u201cAS IS\u201d AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\nOR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>\n</div>\n\n          </div>"}, "last_serial": 3214994, "releases": {"1.0.10": [{"comment_text": "", "digests": {"md5": "e565557e9070c08975622e4f6c973db1", "sha256": "376cf0316d3bcba268d94e09c3de3f2ee9f5c1f966c1efa852da711d7a69806c"}, "downloads": -1, "filename": "django_postgresql_setrole-1.0.10-py3-none-any.whl", "has_sig": false, "md5_digest": "e565557e9070c08975622e4f6c973db1", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 7331, "upload_time": "2017-09-30T13:52:54", "upload_time_iso_8601": "2017-09-30T13:52:54.903503Z", "url": "https://files.pythonhosted.org/packages/32/c3/c053e59952a1506dab7253ca98fe009bc0a5105925bdf669e756a2ac4322/django_postgresql_setrole-1.0.10-py3-none-any.whl", "yanked": false}], "1.0.7": [{"comment_text": "", "digests": {"md5": "a540f6244444027b1e06429fc7a24110", "sha256": "97bc1859cac76605704cd7fea60631d21edbe1b6147f8dc79a5538ea192623ab"}, "downloads": -1, "filename": "django_postgresql_setrole-1.0.7-py3-none-any.whl", "has_sig": false, "md5_digest": "a540f6244444027b1e06429fc7a24110", "packagetype": "bdist_wheel", "python_version": "3.4", "requires_python": null, "size": 6863, "upload_time": "2016-09-25T20:10:57", "upload_time_iso_8601": "2016-09-25T20:10:57.172390Z", "url": "https://files.pythonhosted.org/packages/b5/11/e515640809a8a19bc82195cc681bf05a9abc03a1047f5c0f6d032b25cca3/django_postgresql_setrole-1.0.7-py3-none-any.whl", "yanked": false}], "1.0.8": [{"comment_text": "", "digests": {"md5": "671cce99598bb100dd15788bf8fec88a", "sha256": "1bc5a7f3d19e2d0b1ecc6cbe756a3680b49a2f7adb2ed1115d2230447d872e1e"}, "downloads": -1, "filename": "django_postgresql_setrole-1.0.8-py3-none-any.whl", "has_sig": false, "md5_digest": "671cce99598bb100dd15788bf8fec88a", "packagetype": "bdist_wheel", "python_version": "3.4", "requires_python": null, "size": 7052, "upload_time": "2017-02-07T15:45:08", "upload_time_iso_8601": "2017-02-07T15:45:08.958273Z", "url": "https://files.pythonhosted.org/packages/ba/c7/cb832117b330a09817ac0c50896ec096311e7ebc1ab55744b5d2ca5ef664/django_postgresql_setrole-1.0.8-py3-none-any.whl", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "e565557e9070c08975622e4f6c973db1", "sha256": "376cf0316d3bcba268d94e09c3de3f2ee9f5c1f966c1efa852da711d7a69806c"}, "downloads": -1, "filename": "django_postgresql_setrole-1.0.10-py3-none-any.whl", "has_sig": false, "md5_digest": "e565557e9070c08975622e4f6c973db1", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 7331, "upload_time": "2017-09-30T13:52:54", "upload_time_iso_8601": "2017-09-30T13:52:54.903503Z", "url": "https://files.pythonhosted.org/packages/32/c3/c053e59952a1506dab7253ca98fe009bc0a5105925bdf669e756a2ac4322/django_postgresql_setrole-1.0.10-py3-none-any.whl", "yanked": false}], "timestamp": "Fri May  8 00:54:50 2020"}