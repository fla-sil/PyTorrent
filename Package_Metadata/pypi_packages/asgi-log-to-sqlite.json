{"info": {"author": "Simon Willison", "author_email": "", "bugtrack_url": null, "classifiers": [], "description": "# asgi-log-to-sqlite\n\n[![PyPI](https://img.shields.io/pypi/v/asgi-log-to-sqlite.svg)](https://pypi.org/project/asgi-log-to-sqlite/)\n[![CircleCI](https://circleci.com/gh/simonw/asgi-log-to-sqlite.svg?style=svg)](https://circleci.com/gh/simonw/asgi-log-to-sqlite)\n[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](https://github.com/simonw/asgi-log-to-sqlite/blob/master/LICENSE)\n\nASGI middleware for logging traffic to a SQLite database\n\nSee [Logging to SQLite using ASGI middleware](https://simonwillison.net/2019/Dec/16/logging-sqlite-asgi-middleware/) for background on this project.\n\n## Installation\n\n    pip install asgi-log-to-sqlite\n\n## Usage\n\n```python\nfrom asgi_log_to_sqlite import AsgiLogToSqlite\nfrom my_asgi_app import app\n\n\napp = AsgiLogToSqlite(app, \"/tmp/log.db\")\n```\n\nRequests to your ASGI app will now be logged to the SQLite database file at `/tmp/log.db`.\n\n## Schema\n\nThe database used to log requests has one key table - `requests` - and 6 lookup tables: `paths`, `user_agents`, `referers`, `accept_languages`, `content_types` and `query_strings`.\n\nThe full schema is as follows:\n\n```sql\nCREATE TABLE [paths] (\n   [id] INTEGER PRIMARY KEY,\n   [name] TEXT\n);\nCREATE UNIQUE INDEX idx_paths_name\n                ON paths (name);\nCREATE TABLE [user_agents] (\n   [id] INTEGER PRIMARY KEY,\n   [name] TEXT\n);\nCREATE UNIQUE INDEX idx_user_agents_name\n                ON user_agents (name);\nCREATE TABLE [referers] (\n   [id] INTEGER PRIMARY KEY,\n   [name] TEXT\n);\nCREATE UNIQUE INDEX idx_referers_name\n                ON referers (name);\nCREATE TABLE [accept_languages] (\n   [id] INTEGER PRIMARY KEY,\n   [name] TEXT\n);\nCREATE UNIQUE INDEX idx_accept_languages_name\n                ON accept_languages (name);\nCREATE TABLE [content_types] (\n   [id] INTEGER PRIMARY KEY,\n   [name] TEXT\n);\nCREATE UNIQUE INDEX idx_content_types_name\n                ON content_types (name);\nCREATE TABLE [query_strings] (\n   [id] INTEGER PRIMARY KEY,\n   [name] TEXT\n);\nCREATE UNIQUE INDEX idx_query_strings_name\n                ON query_strings (name);\nCREATE TABLE [requests] (\n   [start] FLOAT,\n   [method] TEXT,\n   [path] INTEGER REFERENCES [paths]([id]),\n   [query_string] INTEGER REFERENCES [query_strings]([id]),\n   [user_agent] INTEGER REFERENCES [user_agents]([id]),\n   [referer] INTEGER REFERENCES [referers]([id]),\n   [accept_language] INTEGER REFERENCES [accept_languages]([id]),\n   [http_status] INTEGER,\n   [content_type] INTEGER REFERENCES [content_types]([id]),\n   [client_ip] TEXT,\n   [duration] FLOAT,\n   [body_size] INTEGER\n);\n```\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/simonw/asgi-log-to-sqlite", "keywords": "", "license": "Apache License, Version 2.0", "maintainer": "", "maintainer_email": "", "name": "asgi-log-to-sqlite", "package_url": "https://pypi.org/project/asgi-log-to-sqlite/", "platform": "", "project_url": "https://pypi.org/project/asgi-log-to-sqlite/", "project_urls": {"Homepage": "https://github.com/simonw/asgi-log-to-sqlite"}, "release_url": "https://pypi.org/project/asgi-log-to-sqlite/0.1.1/", "requires_dist": ["sqlite-utils (~=2.3.1)", "pytest ; extra == 'test'", "pytest-asyncio ; extra == 'test'", "asgiref (==3.1.2) ; extra == 'test'"], "requires_python": "", "summary": "ASGI middleware for logging traffic to a SQLite database", "version": "0.1.1", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>asgi-log-to-sqlite</h1>\n<p><a href=\"https://pypi.org/project/asgi-log-to-sqlite/\" rel=\"nofollow\"><img alt=\"PyPI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/aa3fb917eaeedead6dc3f57eb605f60aa7b37cad/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f617367692d6c6f672d746f2d73716c6974652e737667\"></a>\n<a href=\"https://circleci.com/gh/simonw/asgi-log-to-sqlite\" rel=\"nofollow\"><img alt=\"CircleCI\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/fa9390cb6af69671ff5f4a14774e32b159e12094/68747470733a2f2f636972636c6563692e636f6d2f67682f73696d6f6e772f617367692d6c6f672d746f2d73716c6974652e7376673f7374796c653d737667\"></a>\n<a href=\"https://github.com/simonw/asgi-log-to-sqlite/blob/master/LICENSE\" rel=\"nofollow\"><img alt=\"License\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/bad0ad2a7195b40874e3a10488118122d89489fd/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d417061636865253230322e302d626c75652e737667\"></a></p>\n<p>ASGI middleware for logging traffic to a SQLite database</p>\n<p>See <a href=\"https://simonwillison.net/2019/Dec/16/logging-sqlite-asgi-middleware/\" rel=\"nofollow\">Logging to SQLite using ASGI middleware</a> for background on this project.</p>\n<h2>Installation</h2>\n<pre><code>pip install asgi-log-to-sqlite\n</code></pre>\n<h2>Usage</h2>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">asgi_log_to_sqlite</span> <span class=\"kn\">import</span> <span class=\"n\">AsgiLogToSqlite</span>\n<span class=\"kn\">from</span> <span class=\"nn\">my_asgi_app</span> <span class=\"kn\">import</span> <span class=\"n\">app</span>\n\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">AsgiLogToSqlite</span><span class=\"p\">(</span><span class=\"n\">app</span><span class=\"p\">,</span> <span class=\"s2\">\"/tmp/log.db\"</span><span class=\"p\">)</span>\n</pre>\n<p>Requests to your ASGI app will now be logged to the SQLite database file at <code>/tmp/log.db</code>.</p>\n<h2>Schema</h2>\n<p>The database used to log requests has one key table - <code>requests</code> - and 6 lookup tables: <code>paths</code>, <code>user_agents</code>, <code>referers</code>, <code>accept_languages</code>, <code>content_types</code> and <code>query_strings</code>.</p>\n<p>The full schema is as follows:</p>\n<pre><span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"p\">[</span><span class=\"n\">paths</span><span class=\"p\">]</span> <span class=\"p\">(</span>\n   <span class=\"p\">[</span><span class=\"n\">id</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">PRIMARY</span> <span class=\"k\">KEY</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"nb\">TEXT</span>\n<span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">UNIQUE</span> <span class=\"k\">INDEX</span> <span class=\"n\">idx_paths_name</span>\n                <span class=\"k\">ON</span> <span class=\"n\">paths</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"p\">[</span><span class=\"n\">user_agents</span><span class=\"p\">]</span> <span class=\"p\">(</span>\n   <span class=\"p\">[</span><span class=\"n\">id</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">PRIMARY</span> <span class=\"k\">KEY</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"nb\">TEXT</span>\n<span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">UNIQUE</span> <span class=\"k\">INDEX</span> <span class=\"n\">idx_user_agents_name</span>\n                <span class=\"k\">ON</span> <span class=\"n\">user_agents</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"p\">[</span><span class=\"n\">referers</span><span class=\"p\">]</span> <span class=\"p\">(</span>\n   <span class=\"p\">[</span><span class=\"n\">id</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">PRIMARY</span> <span class=\"k\">KEY</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"nb\">TEXT</span>\n<span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">UNIQUE</span> <span class=\"k\">INDEX</span> <span class=\"n\">idx_referers_name</span>\n                <span class=\"k\">ON</span> <span class=\"n\">referers</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"p\">[</span><span class=\"n\">accept_languages</span><span class=\"p\">]</span> <span class=\"p\">(</span>\n   <span class=\"p\">[</span><span class=\"n\">id</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">PRIMARY</span> <span class=\"k\">KEY</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"nb\">TEXT</span>\n<span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">UNIQUE</span> <span class=\"k\">INDEX</span> <span class=\"n\">idx_accept_languages_name</span>\n                <span class=\"k\">ON</span> <span class=\"n\">accept_languages</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"p\">[</span><span class=\"n\">content_types</span><span class=\"p\">]</span> <span class=\"p\">(</span>\n   <span class=\"p\">[</span><span class=\"n\">id</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">PRIMARY</span> <span class=\"k\">KEY</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"nb\">TEXT</span>\n<span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">UNIQUE</span> <span class=\"k\">INDEX</span> <span class=\"n\">idx_content_types_name</span>\n                <span class=\"k\">ON</span> <span class=\"n\">content_types</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"p\">[</span><span class=\"n\">query_strings</span><span class=\"p\">]</span> <span class=\"p\">(</span>\n   <span class=\"p\">[</span><span class=\"n\">id</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">PRIMARY</span> <span class=\"k\">KEY</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"nb\">TEXT</span>\n<span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">UNIQUE</span> <span class=\"k\">INDEX</span> <span class=\"n\">idx_query_strings_name</span>\n                <span class=\"k\">ON</span> <span class=\"n\">query_strings</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">);</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"p\">[</span><span class=\"n\">requests</span><span class=\"p\">]</span> <span class=\"p\">(</span>\n   <span class=\"p\">[</span><span class=\"k\">start</span><span class=\"p\">]</span> <span class=\"nb\">FLOAT</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"k\">method</span><span class=\"p\">]</span> <span class=\"nb\">TEXT</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">REFERENCES</span> <span class=\"p\">[</span><span class=\"n\">paths</span><span class=\"p\">]([</span><span class=\"n\">id</span><span class=\"p\">]),</span>\n   <span class=\"p\">[</span><span class=\"n\">query_string</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">REFERENCES</span> <span class=\"p\">[</span><span class=\"n\">query_strings</span><span class=\"p\">]([</span><span class=\"n\">id</span><span class=\"p\">]),</span>\n   <span class=\"p\">[</span><span class=\"n\">user_agent</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">REFERENCES</span> <span class=\"p\">[</span><span class=\"n\">user_agents</span><span class=\"p\">]([</span><span class=\"n\">id</span><span class=\"p\">]),</span>\n   <span class=\"p\">[</span><span class=\"n\">referer</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">REFERENCES</span> <span class=\"p\">[</span><span class=\"n\">referers</span><span class=\"p\">]([</span><span class=\"n\">id</span><span class=\"p\">]),</span>\n   <span class=\"p\">[</span><span class=\"n\">accept_language</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">REFERENCES</span> <span class=\"p\">[</span><span class=\"n\">accept_languages</span><span class=\"p\">]([</span><span class=\"n\">id</span><span class=\"p\">]),</span>\n   <span class=\"p\">[</span><span class=\"n\">http_status</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">content_type</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span> <span class=\"k\">REFERENCES</span> <span class=\"p\">[</span><span class=\"n\">content_types</span><span class=\"p\">]([</span><span class=\"n\">id</span><span class=\"p\">]),</span>\n   <span class=\"p\">[</span><span class=\"n\">client_ip</span><span class=\"p\">]</span> <span class=\"nb\">TEXT</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">duration</span><span class=\"p\">]</span> <span class=\"nb\">FLOAT</span><span class=\"p\">,</span>\n   <span class=\"p\">[</span><span class=\"n\">body_size</span><span class=\"p\">]</span> <span class=\"nb\">INTEGER</span>\n<span class=\"p\">);</span>\n</pre>\n\n          </div>"}, "last_serial": 6691796, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "4191b059ad64b35b738e6d039171344d", "sha256": "819fea6012b7ae37bf62ce29584bb2b25c029fa4f758d247c5e11448f8b7d19d"}, "downloads": -1, "filename": "asgi_log_to_sqlite-0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "4191b059ad64b35b738e6d039171344d", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 7268, "upload_time": "2019-12-16T20:30:58", "upload_time_iso_8601": "2019-12-16T20:30:58.769308Z", "url": "https://files.pythonhosted.org/packages/04/21/875bdaf103c40da654c5883a78b53bdffac78eabad5fb0ffb584ee586ab2/asgi_log_to_sqlite-0.1-py3-none-any.whl", "yanked": false}], "0.1.1": [{"comment_text": "", "digests": {"md5": "a3530f6a38756b57db988ab2721d120b", "sha256": "c8a99b2c755389fc110a5e1c63247adaa82b93cf78cbaad449b5b341e1257d1c"}, "downloads": -1, "filename": "asgi_log_to_sqlite-0.1.1-py3-none-any.whl", "has_sig": false, "md5_digest": "a3530f6a38756b57db988ab2721d120b", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 7372, "upload_time": "2020-02-24T20:17:02", "upload_time_iso_8601": "2020-02-24T20:17:02.287436Z", "url": "https://files.pythonhosted.org/packages/75/5c/1df94bafebe64fc54f223978fb4f189fad8f8ffe7a8e913c24881eb2263d/asgi_log_to_sqlite-0.1.1-py3-none-any.whl", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "a3530f6a38756b57db988ab2721d120b", "sha256": "c8a99b2c755389fc110a5e1c63247adaa82b93cf78cbaad449b5b341e1257d1c"}, "downloads": -1, "filename": "asgi_log_to_sqlite-0.1.1-py3-none-any.whl", "has_sig": false, "md5_digest": "a3530f6a38756b57db988ab2721d120b", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": null, "size": 7372, "upload_time": "2020-02-24T20:17:02", "upload_time_iso_8601": "2020-02-24T20:17:02.287436Z", "url": "https://files.pythonhosted.org/packages/75/5c/1df94bafebe64fc54f223978fb4f189fad8f8ffe7a8e913c24881eb2263d/asgi_log_to_sqlite-0.1.1-py3-none-any.whl", "yanked": false}], "timestamp": "Thu May  7 18:17:01 2020"}