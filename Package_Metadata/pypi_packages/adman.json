{"info": {"author": "Jonathon Reinhart", "author_email": "Jonathon.Reinhart@gmail.com", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Environment :: Console", "Intended Audience :: System Administrators", "License :: OSI Approved :: MIT License", "Natural Language :: English", "Operating System :: POSIX :: Linux", "Topic :: System :: Systems Administration :: Authentication/Directory"], "description": "adman\n=====\nA tool for performing some automated Active Directory management.\n\nThis tool can perform various maintenance tasks against an Active Directory:\n- Assignment of `uidNumber`/`gidNumber` attributes for users, computers and groups\n- Ensure UPN suffix consistency\n- Email users about expiring passwords\n- *Future:* Home directory creation / management\n\n\nAdman can run on any Linux system; the host system does not even need to be\njoined to the domain. Adman typically runs with a dedicated user (e.g.\n`domain-janitor`) and uses a Kerberos keytab, rather than password-based authentication.\n\nAdman assigns UID/GID numbers sequentially from a user-defined range, and stores\nthe next-highest value in the `msSFU30MaxUidNumber`/`msSFU30MaxGidNumber`\nattributes in LDAP. This ensures that even if users/groups are removed, UID/GID\nvalues will not be re-used.\n\n\n# Getting Started\n\n## Installation\nWhere possible, it is preferable to install Python packages using your Linux\ndistribution's package manager, rather than from PyPI (using pip). This helps\navoid package conflicts.\n\nThe following Python packages are required:\n- `setuptools` -- For installation\n- [`python-ldap`](https://www.python-ldap.org)\n- [`dnspython`](http://www.dnspython.org)\n- [`PyYAML`](https://pyyaml.org)\n\nAlso, your system must have the GSSAPI module for SASL authentication.\n\nDebian:\n```\napt install python3-setuptools python3-ldap python3-dnspython python3-yaml libsasl2-modules-gssapi-mit\n```\n*Note: `python3-ldap` is only available in Debian Buster.*\n\nFedora:\n```\ndnf install python3-setuptools python3-ldap python3-dns python3-pyyaml cyrus-sasl-gssapi\n```\n\nThen install adman:\n```\ntar xf adman-*.tar.gz\ncd adman-*\npython3 setup.py install\n```\n\n\n## Domain Janitor setup\n\n### Samba\n\nCreate the domain-janitor user and set its password to not expire:\n```\nsamba-tool user create domain-janitor --random-password\nsamba-tool user setexpiry --noexpiry domain-janitor\n```\n\nAdd the user to `Domain Admins`:\n```\nsamba-tool group addmembers 'Domain Admins' domain-janitor\n```\n\nExport the user's Kerberos keytab:\n```\nsamba-tool domain exportkeytab --principal='domain-janitor' domain-janitor.keytab\n```\n\n### Windows\nTODO\n\n\n\n## Configuration\nBy default, Adman looks for its config file at:\n- `/etc/adman/config.yml` when run as `root`\n- `~/.config/adman/config.yml` when run as a normal user\n\nTo configure:\n- Copy `example_config.yml` to the appropriate path.\n- Edit the configuration options as necessary.\n  - At a minimum, the `domain` field needs to be updated.\n- Copy the expored keytab to the path specified in `config.yml`\n  (this defaults to `domain-janitor.keytab` in the same directory).\n  - **Ensure that `domain-janitor.keytab` is carefully protected!**\n\n\n## First run\n\nFirst the state fields need initialized:\n```\nadman -c adman_config.yml state init\n```\n\nNow user / group IDs can be assigned:\n```\n# adman -c adman_config.yml assign\n```\n\n\n## Run automatically\nNote that `adman` will likely be installed in a path not normally searched by `cron`,\nso we use the full path (`which adman`).\n\nTo perform all automated maintenance (assign IDs, UPNs) every minute,\nrun `crontab -e` and add this line:\n```\n*/1 * * * * \t/usr/local/bin/adman -c /etc/adman_config.yml allmaint\n```\n\n\n\n# Troubleshooting\n\n### No worthy mechs found\n```\nldap.AUTH_UNKNOWN: {'desc': 'Unknown authentication method', 'errno': 22, 'info': 'SASL(-4): no mechanism available: No worthy mechs found'}\n```\n\nYou need to install the GSSAPI SASL modules. On Debian:\n```\napt install libsasl2-modules-gssapi-mit\n```\n\n\n### Insufficient access\n```\nldap.INSUFFICIENT_ACCESS: {'desc': 'Insufficient access', 'info': '00002098: Object CN=adtest,CN=ypservers,CN=ypServ30,CN=RpcServices,CN=System,DC=ad-test,DC=vx has no write property access\\n'}\n```\n\nThe user needs to be a member of `Domain Admins`.\n\nOnce this change has been made, you must remove the stale credential cache. E.g.:\n```\nrm /tmp/domain-janitor.cc\n```\n\n### Server not found in Kerberos database\n```\nSASL: GSSAPI Error: Unspecified GSS failure. Minor code may provide more information (Server not found in Kerberos database).\n```\n\nVarious problems can lead to this error. One common case I've encountered is\nthat a reverse DNS (PTR) record does not exist for the DC(s).", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://gitlab.com/JonathonReinhart/adman", "keywords": "", "license": "MIT", "maintainer": "", "maintainer_email": "", "name": "adman", "package_url": "https://pypi.org/project/adman/", "platform": "", "project_url": "https://pypi.org/project/adman/", "project_urls": {"Homepage": "https://gitlab.com/JonathonReinhart/adman"}, "release_url": "https://pypi.org/project/adman/0.5.0/", "requires_dist": null, "requires_python": ">=3.4.0", "summary": "Active Directory Automated Maintenance", "version": "0.5.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>adman</h1>\n<p>A tool for performing some automated Active Directory management.</p>\n<p>This tool can perform various maintenance tasks against an Active Directory:</p>\n<ul>\n<li>Assignment of <code>uidNumber</code>/<code>gidNumber</code> attributes for users, computers and groups</li>\n<li>Ensure UPN suffix consistency</li>\n<li>Email users about expiring passwords</li>\n<li><em>Future:</em> Home directory creation / management</li>\n</ul>\n<p>Adman can run on any Linux system; the host system does not even need to be\njoined to the domain. Adman typically runs with a dedicated user (e.g.\n<code>domain-janitor</code>) and uses a Kerberos keytab, rather than password-based authentication.</p>\n<p>Adman assigns UID/GID numbers sequentially from a user-defined range, and stores\nthe next-highest value in the <code>msSFU30MaxUidNumber</code>/<code>msSFU30MaxGidNumber</code>\nattributes in LDAP. This ensures that even if users/groups are removed, UID/GID\nvalues will not be re-used.</p>\n<h1>Getting Started</h1>\n<h2>Installation</h2>\n<p>Where possible, it is preferable to install Python packages using your Linux\ndistribution's package manager, rather than from PyPI (using pip). This helps\navoid package conflicts.</p>\n<p>The following Python packages are required:</p>\n<ul>\n<li><code>setuptools</code> -- For installation</li>\n<li><a href=\"https://www.python-ldap.org\" rel=\"nofollow\"><code>python-ldap</code></a></li>\n<li><a href=\"http://www.dnspython.org\" rel=\"nofollow\"><code>dnspython</code></a></li>\n<li><a href=\"https://pyyaml.org\" rel=\"nofollow\"><code>PyYAML</code></a></li>\n</ul>\n<p>Also, your system must have the GSSAPI module for SASL authentication.</p>\n<p>Debian:</p>\n<pre><code>apt install python3-setuptools python3-ldap python3-dnspython python3-yaml libsasl2-modules-gssapi-mit\n</code></pre>\n<p><em>Note: <code>python3-ldap</code> is only available in Debian Buster.</em></p>\n<p>Fedora:</p>\n<pre><code>dnf install python3-setuptools python3-ldap python3-dns python3-pyyaml cyrus-sasl-gssapi\n</code></pre>\n<p>Then install adman:</p>\n<pre><code>tar xf adman-*.tar.gz\ncd adman-*\npython3 setup.py install\n</code></pre>\n<h2>Domain Janitor setup</h2>\n<h3>Samba</h3>\n<p>Create the domain-janitor user and set its password to not expire:</p>\n<pre><code>samba-tool user create domain-janitor --random-password\nsamba-tool user setexpiry --noexpiry domain-janitor\n</code></pre>\n<p>Add the user to <code>Domain Admins</code>:</p>\n<pre><code>samba-tool group addmembers 'Domain Admins' domain-janitor\n</code></pre>\n<p>Export the user's Kerberos keytab:</p>\n<pre><code>samba-tool domain exportkeytab --principal='domain-janitor' domain-janitor.keytab\n</code></pre>\n<h3>Windows</h3>\n<p>TODO</p>\n<h2>Configuration</h2>\n<p>By default, Adman looks for its config file at:</p>\n<ul>\n<li><code>/etc/adman/config.yml</code> when run as <code>root</code></li>\n<li><code>~/.config/adman/config.yml</code> when run as a normal user</li>\n</ul>\n<p>To configure:</p>\n<ul>\n<li>Copy <code>example_config.yml</code> to the appropriate path.</li>\n<li>Edit the configuration options as necessary.\n<ul>\n<li>At a minimum, the <code>domain</code> field needs to be updated.</li>\n</ul>\n</li>\n<li>Copy the expored keytab to the path specified in <code>config.yml</code>\n(this defaults to <code>domain-janitor.keytab</code> in the same directory).\n<ul>\n<li><strong>Ensure that <code>domain-janitor.keytab</code> is carefully protected!</strong></li>\n</ul>\n</li>\n</ul>\n<h2>First run</h2>\n<p>First the state fields need initialized:</p>\n<pre><code>adman -c adman_config.yml state init\n</code></pre>\n<p>Now user / group IDs can be assigned:</p>\n<pre><code># adman -c adman_config.yml assign\n</code></pre>\n<h2>Run automatically</h2>\n<p>Note that <code>adman</code> will likely be installed in a path not normally searched by <code>cron</code>,\nso we use the full path (<code>which adman</code>).</p>\n<p>To perform all automated maintenance (assign IDs, UPNs) every minute,\nrun <code>crontab -e</code> and add this line:</p>\n<pre><code>*/1 * * * * \t/usr/local/bin/adman -c /etc/adman_config.yml allmaint\n</code></pre>\n<h1>Troubleshooting</h1>\n<h3>No worthy mechs found</h3>\n<pre><code>ldap.AUTH_UNKNOWN: {'desc': 'Unknown authentication method', 'errno': 22, 'info': 'SASL(-4): no mechanism available: No worthy mechs found'}\n</code></pre>\n<p>You need to install the GSSAPI SASL modules. On Debian:</p>\n<pre><code>apt install libsasl2-modules-gssapi-mit\n</code></pre>\n<h3>Insufficient access</h3>\n<pre><code>ldap.INSUFFICIENT_ACCESS: {'desc': 'Insufficient access', 'info': '00002098: Object CN=adtest,CN=ypservers,CN=ypServ30,CN=RpcServices,CN=System,DC=ad-test,DC=vx has no write property access\\n'}\n</code></pre>\n<p>The user needs to be a member of <code>Domain Admins</code>.</p>\n<p>Once this change has been made, you must remove the stale credential cache. E.g.:</p>\n<pre><code>rm /tmp/domain-janitor.cc\n</code></pre>\n<h3>Server not found in Kerberos database</h3>\n<pre><code>SASL: GSSAPI Error: Unspecified GSS failure. Minor code may provide more information (Server not found in Kerberos database).\n</code></pre>\n<p>Various problems can lead to this error. One common case I've encountered is\nthat a reverse DNS (PTR) record does not exist for the DC(s).</p>\n\n          </div>"}, "last_serial": 6833071, "releases": {"0.0.2": [{"comment_text": "", "digests": {"md5": "d954584b253bd3f5b03d46e724765864", "sha256": "7c73381f29f492e7909facf02081d31fa4ba58b316f691da9678bf251a693390"}, "downloads": -1, "filename": "adman-0.0.2.tar.gz", "has_sig": false, "md5_digest": "d954584b253bd3f5b03d46e724765864", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 14083, "upload_time": "2019-07-16T13:11:47", "upload_time_iso_8601": "2019-07-16T13:11:47.082812Z", "url": "https://files.pythonhosted.org/packages/90/d3/5c6cd4496c03801c28cb3dc9a0c59c27cb56c0fe9619f977a0381e401211/adman-0.0.2.tar.gz", "yanked": false}], "0.1.0": [{"comment_text": "", "digests": {"md5": "21301480bb0803ffed21bfeba58ad8a7", "sha256": "5dda779213ec7eafee2174f1d148cb2efe0ec42f571b792f2717e5cd5a45b2a9"}, "downloads": -1, "filename": "adman-0.1.0.tar.gz", "has_sig": false, "md5_digest": "21301480bb0803ffed21bfeba58ad8a7", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 15154, "upload_time": "2019-07-19T02:04:39", "upload_time_iso_8601": "2019-07-19T02:04:39.112879Z", "url": "https://files.pythonhosted.org/packages/3a/3b/430a6670b4de571f8253d4a17687d62b78d94ae3b4965122eee125665f34/adman-0.1.0.tar.gz", "yanked": false}], "0.2.0": [{"comment_text": "", "digests": {"md5": "ea153300907177759fb7372fd5162c46", "sha256": "53a6fdda0f11689820562357b490534a640947e54c18f7919d8bf2434c45317a"}, "downloads": -1, "filename": "adman-0.2.0.tar.gz", "has_sig": false, "md5_digest": "ea153300907177759fb7372fd5162c46", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 18310, "upload_time": "2019-12-27T19:17:01", "upload_time_iso_8601": "2019-12-27T19:17:01.147520Z", "url": "https://files.pythonhosted.org/packages/67/df/45881ba9dd50c10b52faa0ad1c2861676de35e1c0adcdafe1af4fb89d111/adman-0.2.0.tar.gz", "yanked": false}], "0.2.1": [{"comment_text": "", "digests": {"md5": "1c68e12208abbe1f985fcdc941087720", "sha256": "07899ef74b848c6ed6631cd88413500eb86f3280fd6aa1bb5dea560b749b898b"}, "downloads": -1, "filename": "adman-0.2.1.tar.gz", "has_sig": false, "md5_digest": "1c68e12208abbe1f985fcdc941087720", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 19654, "upload_time": "2020-01-06T20:24:37", "upload_time_iso_8601": "2020-01-06T20:24:37.166193Z", "url": "https://files.pythonhosted.org/packages/90/32/66b78ae32fe5b08fc07f33336a5adc1ba28e724e5df5bc48022a1fdbaa30/adman-0.2.1.tar.gz", "yanked": false}], "0.2.2": [{"comment_text": "", "digests": {"md5": "0867156e2c48e7c80fe8098207dfd293", "sha256": "f75a291479eb84658bb1d1314fa3ef29d4465bdce053cc1cee6cc103db74169b"}, "downloads": -1, "filename": "adman-0.2.2.tar.gz", "has_sig": false, "md5_digest": "0867156e2c48e7c80fe8098207dfd293", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 19985, "upload_time": "2020-01-18T00:24:28", "upload_time_iso_8601": "2020-01-18T00:24:28.374623Z", "url": "https://files.pythonhosted.org/packages/55/e5/22b6fdc852451302d9bf964ebadb25b49c4ba96523b9dedeb9ac5d86138f/adman-0.2.2.tar.gz", "yanked": false}], "0.2.3": [{"comment_text": "", "digests": {"md5": "580a66d61b1e047c1bcc84a8d2ce1583", "sha256": "0ff5d56c98b3a1686fdb9b2ae576020af7fe44d01eeb1752baa82725ff6a525d"}, "downloads": -1, "filename": "adman-0.2.3.tar.gz", "has_sig": false, "md5_digest": "580a66d61b1e047c1bcc84a8d2ce1583", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 22879, "upload_time": "2020-02-11T06:08:31", "upload_time_iso_8601": "2020-02-11T06:08:31.829368Z", "url": "https://files.pythonhosted.org/packages/4e/37/823974a240207c0f686cecd03a4060ca4d8633826f8fcc269abbb68da10e/adman-0.2.3.tar.gz", "yanked": false}], "0.3.0": [{"comment_text": "", "digests": {"md5": "7d0430083738af29ff5f0bbe25acfa28", "sha256": "4ea274c9d0cdf4b7e7ca67554a1452f8efe2ec7375e1b9ea3912dfe0a79684c2"}, "downloads": -1, "filename": "adman-0.3.0.tar.gz", "has_sig": false, "md5_digest": "7d0430083738af29ff5f0bbe25acfa28", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 23539, "upload_time": "2020-02-16T21:46:42", "upload_time_iso_8601": "2020-02-16T21:46:42.029934Z", "url": "https://files.pythonhosted.org/packages/99/8c/221e96d9778e4fbbb302a90cdae90b6757d196ce7e88524b6db27b6e6b7f/adman-0.3.0.tar.gz", "yanked": false}], "0.4.0": [{"comment_text": "", "digests": {"md5": "556fd858681ed43be0f8e3801b5ea571", "sha256": "328b08ef491af4fba040eb7f458e8b5a26f7dfbb5c42e349fd4af6c01114d14a"}, "downloads": -1, "filename": "adman-0.4.0.tar.gz", "has_sig": false, "md5_digest": "556fd858681ed43be0f8e3801b5ea571", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 23910, "upload_time": "2020-02-19T03:27:09", "upload_time_iso_8601": "2020-02-19T03:27:09.711676Z", "url": "https://files.pythonhosted.org/packages/0b/5c/0b4d740c96fc39be778e39dba2a95e7a53687ac4602aa169c65bef6f0e50/adman-0.4.0.tar.gz", "yanked": false}], "0.5.0": [{"comment_text": "", "digests": {"md5": "4b1370e40e23f3a2eb91d89abae40404", "sha256": "9a35e6b885e3f7f2bbafc9867b66e7611b49db0e52c3c6ae26d608010bf68bba"}, "downloads": -1, "filename": "adman-0.5.0.tar.gz", "has_sig": false, "md5_digest": "4b1370e40e23f3a2eb91d89abae40404", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 28288, "upload_time": "2020-03-18T03:13:26", "upload_time_iso_8601": "2020-03-18T03:13:26.901502Z", "url": "https://files.pythonhosted.org/packages/1b/24/96aa2c571505a75efafd656e47ddd067d6e6e036c1219d35d1eb2c133ea3/adman-0.5.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "4b1370e40e23f3a2eb91d89abae40404", "sha256": "9a35e6b885e3f7f2bbafc9867b66e7611b49db0e52c3c6ae26d608010bf68bba"}, "downloads": -1, "filename": "adman-0.5.0.tar.gz", "has_sig": false, "md5_digest": "4b1370e40e23f3a2eb91d89abae40404", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.4.0", "size": 28288, "upload_time": "2020-03-18T03:13:26", "upload_time_iso_8601": "2020-03-18T03:13:26.901502Z", "url": "https://files.pythonhosted.org/packages/1b/24/96aa2c571505a75efafd656e47ddd067d6e6e036c1219d35d1eb2c133ea3/adman-0.5.0.tar.gz", "yanked": false}], "timestamp": "Thu May  7 16:23:22 2020"}