{"info": {"author": "Jim Fulton", "author_email": "jim@zope.com", "bugtrack_url": null, "classifiers": [], "description": "********************\nAjax Support\n********************\n\nThe zc.ajaxform package provides framework to support:\n\n- A single-class application model\n\n- Nested-application support\n\n- Integration with zope.formlib\n\n.. contents::\n\nDetailed Documentation\n**********************\n\nApplication support\n===================\n\nThe zc.ajaxform.application module provides support for writing ajax\n[#ajax]_ applications.  This framework started out as an experiment in\nsimplifying writing applications with Zope 3.  I was frustrated with\nZCML situps and generally too much indirection.  I ended up with a\nmodel that I'm pretty happy with.  It might not be for everybody. :)\n\nThe basic idea is that an application can be provided using a single\nZope 3 view plus necessary resource-library definitions.  This view\nhas a URL.  It typically provides many ajax methods whose URLs have the\nview URL as a base.\n\nMany applications can be implemented using a simple class that can be\nregistered as a view.\n\nLet's look at a simple stupid application. :)\n\n::\n\n  import zc.ajaxform.application\n  import zope.exceptions\n  \n  class Calculator(zc.ajaxform.application.Trusted,\n                   zc.ajaxform.application.Application):\n  \n      resource_library_name = None\n  \n      @zc.ajaxform.application.jsonpage\n      def about(self):\n          return 'Calculator 1.0'\n  \n      @zc.ajaxform.application.jsonpage\n      def operations(self):\n          return ['add', \"subtract\"]\n  \n      @zc.ajaxform.application.jsonpage\n      def value(self):\n          return dict(value=getattr(self.context, 'calculator_value', 0))\n  \n      def do_add(self, value):\n          value += getattr(self.context, 'calculator_value', 0)\n          self.context.calculator_value = value\n          return dict(value=value)\n      \n      @zc.ajaxform.application.jsonpage\n      def add(self, value):\n          if not isinstance(value, int):\n              return dict(error=\"The value must be an integer!\")\n          return self.do_add(value)\n      \n      @zc.ajaxform.application.jsonpage\n      def subtract(self, value):\n          if not isinstance(value, int):\n              raise zope.exceptions.UserError(\n                  \"The value must be an integer!\")\n          return self.do_add(-value)\n  \n      @zc.ajaxform.application.jsonpage\n      def noop(self):\n          pass\n  \n      @zc.ajaxform.application.page\n      def none(self):\n          return \"null\"\n  \n      @zc.ajaxform.application.jsonpage\n      def echo_form(self):\n          def maybe_file(v):\n              if hasattr(v, 'read'):\n                  return (\"<File upload name=%r content-type=%r size=%r>\"\n                          % (v.filename, v.headers['content-type'], len(v.read()))\n                          )\n              else:\n                  return v\n          \n          return dict(\n              (name, maybe_file(v))\n              for (name, v) in self.request.form.items()\n              )\n  \n  \n      @zc.ajaxform.application.jsonpage\n      def doh(self):\n          raise TypeError(\"Doh!\")\n      \n\n\n\nWe subclass zc.ajaxform.application.Trusted. This is a minimal\nbase class that provides a constructor that takes a context and a\nrequest and removes the security proxy from the context.  It\noverrides the constructor from zc.ajaxform.application.Application.\n\nWe also subclass zc.ajaxform.application.Application.  This is a base\nclass that provides:\n\n- a basic constructor that takes context and request arguments and sets\n  corresponding attributes,\n\n- traversal to attributes that provide IBrowserPublisher with\n  conversion of dots to underscores,\n\n- a default \"page\" named index.html,\n\n- a template method that returns an HTML page with an empty head.\n\n- an index_html method that loads a resource library and calls the\n  template,\n\n- an interface declaration that it provides IBrowserPublisher, and\n\n- an adapter declaration that adapts\n  zope.traversing.interfaces.IContainmentRoot and\n  zope.publisher.interfaces.browser.IBrowserRequest.\n\nThe main goals of this base class are to make it easy to load\nJavascript and to make it easy to define ajax methods to support the\nJavascript. For that reason, we provide a traverser that traverses to\nobject attributes that provide IBrowserPublisher.  The\nzc.ajaxform.application.jsonpage decorator is also an important part of\nthis. It makes methods accessible and automatically marshals their\nresult to JSON [#jsoninput]_.  There's also a\nzc.ajaxform.application.page decorator that makes methods accessible\nwithout the automatic marshalling.  The use of a default page, rather\nthan just a __call__ method is to cause the URL base to be the view,\nrather than the view's context.  This allows the Javascript code to\nuse relative URLs to refer to the ajax methods.\n\nThe class expects subclasses to define a resource_library_name\nattribute [#missing_resource_library_name]_.  For these applications,\nyou pretty much always want to use an associated Javascript file and\nother resources (supporting JS, CSS, etc.).  You can suppress the use\nof the resource library by setting the value of this attribute to\nNone.\n\nFor applications that build pages totally in Javascript, the default\ntemplate is adequate.  For applications that need to support\nnon-Javascript-enabled browsers, that want to support search-engine\noptimization [#sso]_, or that want to provide some Javascript data\nduring the initial page load, a custom template can be provided by\nsimply overriding the template method with a page template or a method\nthat calls one.\n\nThe view can be registered with a simple adapter registration:\n\n::\n\n  <configure xmlns=\"http://namespaces.zope.org/zope\">\n    <adapter name=\"calculator.html\"\n             factory=\"zc.ajaxform.calculator_example.Calculator\"\n             permission=\"zope.View\"\n             />\n  </configure>\n\n\n\nIf we wanted to register it for an object other than the an\nIContainmentRoot, we could just provide specifically adapted interfaces\nor classes in the registration.\n\nLet's access the calculator with a test browser\n\n    >>> import zope.testbrowser.testing\n    >>> browser = zope.testbrowser.testing.Browser()\n    >>> browser.open('http://localhost/')\n    Traceback (most recent call last):\n    ...\n    HTTPError: HTTP Error 401: Unauthorized\n\nBecause our view was registered to require zope.View, the request was\nunauthorized.  Let's login. In the demo setup, we login by just\nproviding a login form variable. \n\n    >>> browser.open('http://localhost/calculator.html?login')\n    >>> print browser.contents # doctest: +NORMALIZE_WHITESPACE\n    <html><head>\n    <base href=\"http://localhost/calculator.html/index.html\" />\n    </head></html>\n\nWe registered our view as calculator.html. Because of the way it sets the\nbrowser default page for itself, it becomes the base href for the\npage.  This allows us to access ajax methods using relative URLs.\n\nOur calculator view provides a value method.  It uses the\nzc.ajaxform.application.jsonpage decorator. This does 2 things:\n\n- Arranges that the method can be traversed to,\n\n- marshals the result to JSON.\n\nThe way results are marshalled to JSON deserves some\nexplanation.  To support automation of ajax calls, we:\n\n- Always return objects\n- If there is an error, we include:\n  - an error property providing an error messahe, and/or\n  - when handling form submissions, an errors property with am object value\n    mapping field names to field-specific error messages.\n\n::\n\n    >>> import simplejson\n\n    >>> browser.open('http://localhost/@@calculator.html/value')\n    >>> simplejson.loads(browser.contents)\n    {u'value': 0}\n\n    >>> browser.open('http://localhost/@@calculator.html/add?value=hi')\n    >>> simplejson.loads(browser.contents)\n    {u'error': u'The value must be an integer!'}\n\nThings other than a dictionary can be returned:\n\n    >>> browser.open('http://localhost/@@calculator.html/about')\n    >>> simplejson.loads(browser.contents)\n    u'Calculator 1.0'\n\n    >>> browser.open('http://localhost/@@calculator.html/operations')\n    >>> simplejson.loads(browser.contents)\n    [u'add', u'subtract']\n\nIf you want to marshal JSON yourself, you can use the\nzc.ajaxform.application.jsonpage decorator:\n\n    >>> browser.open('http://localhost/@@calculator.html/none')\n\nAn alternative way to return errors is to raise user errors, as is\ndone by the subtract method in our example:\n\n    >>> browser.open('http://localhost/@@calculator.html/subtract?value=hi')\n    >>> simplejson.loads(browser.contents)\n    {u'error': u'The value must be an integer!'}\n\nThis works because there is a view registered for\nzope.exceptions.interfaces.IUserError, and\nzc.ajaxform.interfaces.IAjaxRequest.\n\nTesting support\n===============\n\nzc.ajaxform.testing has some helper functions to make it easier to test\najax calls.\n\nThe zc.ajaxform.testing.FormServer class provides some convenience for\nmaking ajax calls in which data are sent as form data and returned as\nJSON.  The class takes a browser and returns an object that can be\ncalled to make server calls:\n\n    >>> import zc.ajaxform.testing, pprint\n    >>> server = zc.ajaxform.testing.FormServer(browser)\n\n    >>> pprint.pprint(server('/calculator.html/echo_form',\n    ...               {'a': 1.0}, b=[1, 2, 3], c=True, d='d', e=u'e\\u1234'\n    ...               ), width=1)\n    {u'a': u'1.0',\n     u'b': [u'1',\n            u'2',\n            u'3'],\n     u'c': u'1',\n     u'd': u'd',\n     u'e': u'e\\u1234'}\n\nWhen we call the server, we pass a URL to invoke, which may be\nrelative, a optional dictionary of parameter values, and optional\nkeyword arguments.  \n\nNote that the application will recieve data as strings, which is what\nwe see echoed back in the example above.\n\nIf the application is written using Zope, then we can enable Zope form\nmarshalling, by passing a True value when we create the server:\n\n    >>> server = zc.ajaxform.testing.FormServer(browser, True)\n    >>> pprint.pprint(server('/calculator.html/echo_form',\n    ...               {'a': 1.0}, b=[1, 2, 3], c=True, d='d', e=u'e\\u1234'\n    ...               ), width=1)\n    {u'a': 1.0,\n     u'b': [1,\n            2,\n            3],\n     u'c': True,\n     u'd': u'd',\n     u'e': u'e\\u1234'}\n\n    >>> pprint.pprint(server('/calculator.html/add', {'value': 1}), width=1)\n    {u'value': 1}\n\n    >>> pprint.pprint(server('/calculator.html/add', value=1), width=1)\n    {u'value': 2}\n\nThe methods called are assumed to return JSON and the resulting data\nis converted back into Python.\n\nThe function pprint method combines pprint and calling:\n\n    >>> server.pprint('/calculator.html/add', {'value': 1})\n    {u'value': 3}\n\n    >>> server.pprint('/calculator.html/add', value=1)\n    {u'value': 4}\n\n    >>> server.pprint('/calculator.html/echo_form',\n    ...               {'a': 1.0}, b=[1, 2, 3], c=True, d='d', e=u'e\\u1234'\n    ...               )\n    {u'a': 1.0,\n     u'b': [1,\n            2,\n            3],\n     u'c': True,\n     u'd': u'd',\n     u'e': u'e\\u1234'}\n\nIn the future, there will be versions of these functions that send\ndata as JSON.\n\nWe can include file-upload data by including a 3-tuple with a file\nname, a content type, and a data string:\n\n    >>> server.pprint('/calculator.html/echo_form',\n    ...               b=[1, 2, 3], c=True, d='d',\n    ...               file=('foo.xml', 'test/xml', '<foo></foo>'), \n    ...               )\n    {u'b': [1,\n            2,\n            3],\n     u'c': True,\n     u'd': u'd',\n     u'file': u\"<File upload name=u'foo.xml' content-type='test/xml' size=11>\"}\n\nas a convenience, you can pass a URL string to the server constructor,\nwhich will create a browser for you that has opened that URL.  You can\nalso omit the brower and an unopened browser will be created.\n\n\n    >>> server = zc.ajaxform.testing.FormServer(\n    ...     'http://localhost/calculator.html?login')\n    >>> server.browser.url\n    'http://localhost/calculator.html?login'\n\n    >>> server.pprint('/calculator.html/echo_form', x=1)\n    {u'x': u'1'}\n\n    >>> server = zc.ajaxform.testing.FormServer(zope_form_marshalling=True)\n    >>> server.browser.open('http://localhost/calculator.html?login')\n    >>> server.pprint('/calculator.html/echo_form', x=1)\n    {u'x': 1}\n\nIn the example above, we didn't provide a browser, but we provided the\nzope_form_marshalling flag as a keyword option.\n\n\n.. Edge case: we can't traverse to undecorated methods:\n\n    >>> server.pprint('/calculator.html/do_add', value=1)\n    Traceback (most recent call last):\n    ...\n    HTTPError: HTTP Error 404: Not Found\n\n\n\"Library\" applications\n======================\n\nThe \"application\" model described above is pretty appealing in its\nsimplicity -- at least to me. :)  Usually, we'd like to make out\napplications a bit more flexible in their use.  In particular, we\noften want to assemble applications together. At the Javascript level,\nthis often means having an application return a panel that can be used\nin some higher-level layout.  At the server level, we need to provide\na way to access application logic within some larger context.  There\nare two parts to this:\n\n1. The containing application needs to support traversal to the\n   sub-application.  \n\n2. The subapplication needs to know how it was traversed to, at least\n   if it generates URLs.  For example, the form machinery [#forms]_\n   generates URLs for action handlers.\n\nSub-application should expose the URL needed to access then as a\nbase_href attribute. This is usually a relative URL relative to the base\napplication. \n\nThere are a number of classes defined in zc.ajaxform.application that\nhelp with creating sub-applications:\n\nSubApplication\n    This class, which Application subclasses, provides traversal to\n    attributes that provide IBrowserPublisher.  It also stamps\n    IAjaxRequest on the request object when an object is traversed\n    [#iajaxrequest]_ .\n\n    (Maybe this request stamping should be done further down the\n    traversal chain or perhaps only done if X-Requested-With is\n    xmlhttprequest.)\n\nPublicTraversable\n    This class provides security declarations that allow objects to be\n    traversable publically.  This is appropriate for sub-applications\n    that want the same protections as the object being traversed.\n\nLet's look at our calculator example as a subapplication:\n\n::\n\n  import zc.ajaxform.application\n  import zope.exceptions\n  \n  class Container(zc.ajaxform.application.Application):\n  \n      resource_library_name = None\n  \n      @property\n      def calc(self):\n          return Calculator(self.context, self.request, base_href='calc')\n  \n  \n  class Calculator(zc.ajaxform.application.Trusted,\n                   zc.ajaxform.application.SubApplication,\n                   zc.ajaxform.application.PublicTraversable,\n                   ):\n  \n      @zc.ajaxform.application.jsonpage\n      def operations(self):\n          return [['add', self.base_href+'/add'],\n                  ['add', self.base_href+'/subtract'],\n                  ]\n                  \n      @zc.ajaxform.application.jsonpage\n      def value(self):\n          return dict(value=getattr(self.context, 'calculator_value', 0))\n  \n      def do_add(self, value):\n          value += getattr(self.context, 'calculator_value', 0)\n          self.context.calculator_value = value\n          return dict(value=value)\n      \n      @zc.ajaxform.application.jsonpage\n      def add(self, value):\n          if not isinstance(value, int):\n              return dict(error=\"The value must be an integer!\")\n          return self.do_add(value)\n      \n      @zc.ajaxform.application.jsonpage\n      def subtract(self, value):\n          if not isinstance(value, int):\n              raise zope.exceptions.UserError(\n                  \"The value must be an integer!\")\n          return self.do_add(-value)\n  \n\n\n\nHere, we've defined a container application that simply provides\ntraversal to a calculator subapplication as a static property.  It\ncreates the calculator with the application's context and request.  It\npasses a base_href as a keyword argument, which SubApplication's\nconstructor accepts.  Our ZCML configuration is pretty simple:\n\n::\n\n  <configure xmlns=\"http://namespaces.zope.org/zope\">\n    <include package=\"zope.app.component\" file=\"meta.zcml\" />\n    <adapter name=\"container.html\"\n             factory=\"zc.ajaxform.calculator_subapplication_example.Container\"\n             permission=\"zope.View\"\n             />\n  </configure>\n\n\n\nUsing the container application, we access the calculator via the\ncontainer:\n\n    >>> server.pprint('http://localhost/@@container.html/calc/add', value=1)\n    {u'value': 5}\n\nWe've updated the operations method to include the URL for each\noperation, which is computed based on the base_href:\n\n    >>> server.pprint('http://localhost/@@container.html/calc/operations')\n    [[u'add',\n      u'calc/add'],\n     [u'add',\n      u'calc/subtract']]\n\n\nNote that we didn't make any security declarations for the Calculator\nclass.  We're relying on the protection for the container.  If we\nrestart the browser, we see, indeed, that we can't access the\ncalculator:\n\n    >>> server = zc.ajaxform.testing.FormServer()\n    >>> server.pprint('http://localhost/@@container.html/calc/operations')\n    {u'session_expired': True}\n\nDynamic Traversal\n=================\n\nIn the previous example, we traversed to a sub-application using a\nstatic property.  Sometimes, we need to traverse dynamically.  We\nmight have a container application with a variable number of\nsubapplications. Examples include a portlet container and a system for\nmanaging user-defined data types.  In the later case, as users define\nnew data types, one or more applications get defined for each type.\n\nzc.ajaxform.application provides a helper descriptor that allows custom\ntraversers to be implemented with simple Python methods.  Let's look\nat a simple example.\n\n    >>> import zc.ajaxform.application   \n    >>> class Foo:\n    ...     def __str__(self):\n    ...         return 'a '+self.__class__.__name__\n    ...\n    ...     @zc.ajaxform.application.traverser\n    ...     def demo_traverse(self, request, name):\n    ...         return \"traverse: %s %s %s\" % (self, request, name)\n\nThis is a rather silly traverser for demonstration purposes that just\nreturnes a transformed name.\n\n    >>> foo = Foo()\n    >>> foo.demo_traverse.publishTraverse(\"a request\", \"xxx\")\n    'traverse: a Foo a request xxx'\n\nWe can still call the method:\n\n    >>> foo.demo_traverse(\"a request\", \"xxx\")\n    'traverse: a Foo a request xxx'\n\nThe method provides IBrowserPublisher:\n\n    >>> import zope.publisher.interfaces.browser\n    >>> zope.publisher.interfaces.browser.IBrowserPublisher.providedBy(\n    ...     foo.demo_traverse)\n    True\n\nThe descriptor has a security declaration that allows it to be\ntraversed but not called from untrusted code:\n\n    >>> import zope.security.checker\n    >>> checker = zope.security.checker.getChecker(\n    ...     zope.security.checker.ProxyFactory(foo.demo_traverse))\n    >>> checker.get_permissions\n    {'publishTraverse': Global(CheckerPublic,zope.security.checker)}\n\n    >>> checker.set_permissions\n    {}\n\nAcquisition\n===========\n\nApplications and sub-applications have __parent__ properties that\nreturn their context.  This is to support frameworks that ise\n__parent__ to perform acquisition.\n\n   >>> class MyApp(zc.ajaxform.application.Application):\n   ...     pass\n\n   >>> myapp = MyApp(foo, None)\n   >>> myapp.__parent__ is foo\n   True\n\n   >>> class MySubApp(zc.ajaxform.application.SubApplication):\n   ...     pass\n\n   >>> mysubapp = MySubApp(foo, None)\n   >>> mysubapp.__parent__ is foo\n   True\n\n\nSystem Errors\n=============\n\n    System errors will be rendered as json.\n\n    >>> server = zc.ajaxform.testing.FormServer(\n    ...     'http://localhost/calculator.html?login')\n    >>> server('/calculator.html/doh')\n    Traceback (most recent call last):\n    ...\n    HTTPError: HTTP Error 500: Internal Server Error\n\n    >>> pprint.pprint(simplejson.loads(server.browser.contents), width=1)\n    {u'error': u'TypeError: Doh!'}\n\n.. [#ajax] Technically, these aren't really AJAX applications, since\n   we rarely. if ever, use XML as a serialization format.  To\n   emphasize this I'll use lower-case \"ajax\" to refer to the generic\n   approach of making low-level calls from Javascript rather than\n   doing page loads.\n\n.. [#jsoninput] In the near future, there will also be support for\n   JSON method input.  This will provide a number of benefits:\n\n   - It will provide more automatic marshaling of non-string\n     data. Now, we either have to de-marshal in the server application\n     code or embed marshaling data into parameter names in client\n     code.\n\n   - It will allow richer data structures than is practical with form data.\n\n   - It will probably allow faster ajax requests because:\n\n     - Server-side de-marshalling is done with highly optimized code\n       in simplejson.\n\n     - We will assume that data passed are valid method arguments and\n       avoid method introspection.\n\n.. [#missing_resource_library_name] A custom attribute error message\n   is used if this attribute is missing that tries to be more\n   informative than the default attribute error.\n\n.. [#sso]  For search-engine optimization, one generally wants a\n   content page to actually contain its content.  If one depends on\n   Javascript-enabled browsers, one can improve performance and\n   search-engine optimization by adding ancilary data in Javascript,\n   so as not to dilute the content.\n\n.. [#forms] See form.txt.\n\n.. [#iajaxrequest] Traversing into a subapplication adds IAjaxRequest to the\n   list of interfaces provided by the request.\n\n    >>> import zc.ajaxform.application\n    >>> import zc.ajaxform.interfaces\n    >>> import zope.publisher.browser\n    >>> request = zope.publisher.browser.TestRequest()\n    >>> class SubApp(zc.ajaxform.application.SubApplication):\n    ...      @zc.ajaxform.application.jsonpage\n    ...      def foo(self):\n    ...          return 'bar'\n    >>> subapp = SubApp(object(), request)\n\n  Now let's try traversing into the subapplication:\n\n    >>> zc.ajaxform.interfaces.IAjaxRequest.providedBy(request)\n    False\n    >>> subapp.publishTraverse(request, 'foo')()\n    '\"bar\"'\n    >>> zc.ajaxform.interfaces.IAjaxRequest.providedBy(request)\n    True\n\n  Note that the request keeps any provided interfaces:\n\n    >>> request = zope.publisher.browser.TestRequest()\n    >>> class IMyInterface(zope.interface.Interface):\n    ...     pass\n    >>> zope.interface.directlyProvides(request, IMyInterface)\n    >>> subapp.publishTraverse(request, 'foo')()\n    '\"bar\"'\n    >>> IMyInterface.providedBy(request)\n    True\n\n\nSystem Error Logging\n====================\n\nWhen an error is generated, zope.app.publishing checks to see if the\nerror handler provides the System Error interface. If so, zope.app.publishing\nlogs the error.\n\nRather than use this indirect method of logging, there is an explicit\nstatement in ExceptionView that imports the logging module and logs and error\nitself. We can test this with the zope.testing.loggingsupport functions.\n\n    First we set up loggingsupport. This keeps track of all error messages\n    written via the module passed as the parameter. In this case, zc.ajaxform.\n\n    >>> import logging\n    >>> import zope.testing.loggingsupport\n    >>> log_handler = zope.testing.loggingsupport.InstalledHandler('zc.ajaxform')\n\n    Then we create an error.\n\n    >>> server = zc.ajaxform.testing.FormServer(\n    ...     'http://localhost/calculator.html?login')\n    >>> server('/calculator.html/doh')\n    Traceback (most recent call last):\n    ...\n    HTTPError: HTTP Error 500: Internal Server Error\n\n    ...And check to see that it was logged.\n\n    >>> print log_handler\n    zc.ajaxform.application ERROR\n      SysError created by zc.ajaxform\n\nForm Processing\n===============\n\nzc.ajaxform.form provides support for server-generated forms based on\nthe zope.formlib library.\n\nForms are meant to be used as parts of larger applications.  A form\nprovides output of JSON data for building javascript forms.  Forms also\nprovide validation and call actions with validated data to perform\nactions on form submit.\n\nTo create a form, just create a form class as a subclass of\nzc.ajaxform.form.Form. This base class provides:\n\n- an ajax __call__ method that returns a form definition,\n\n- traversal to form actions, in much the same way that\n  zc.ajaxform.application.Application [#application]_ provides traversal\n  to json methods,\n\n- a definitions method that can be used by ajax methods to get a form\n  definition as Python data, and\n\n- a getObjectData method for getting initial form data from an\n  existing object.\n\nHere's a simple example:\n\n::\n\n  import zc.ajaxform.application\n  import zc.ajaxform.interfaces\n  import zc.ajaxform.widgets\n  import zc.ajaxform.form\n  import zope.component\n  import zope.interface\n  import zope.formlib\n  import zope.schema\n  \n  class IAddress(zope.interface.Interface):\n  \n      street = zope.schema.TextLine(\n          title = u\"Street\",\n          description = u\"The street\",\n          )\n  \n      city = zope.schema.TextLine(\n          title = u\"City\",\n          description = u\"The city\",\n          )\n  \n      awesomeness = zope.schema.Int(\n          title = u\"Awesomeness\",\n          description = u\"The awesomeness on a scale of 1 to 10\",\n          min = 1,\n          max = 10,\n          )\n  \n  \n  class Pets(zc.sourcefactory.basic.BasicSourceFactory):\n  \n      def getValues(self):\n          return (u'Dog', u'Cat', u'Fish')\n  \n  \n  class Pet(zope.schema.TextLine):\n      \"\"\"A textline representing a pet.\n  \n      This is just a textline, but we also have a source of common pets that\n      the user can choose from.\n      \"\"\"\n  \n  class IPerson(zope.interface.Interface):\n  \n      first_name = zope.schema.TextLine(\n          title = u\"First name\",\n          description = u\"Given name.\",\n          default= u'Happy'\n          )\n  \n      last_name = zope.schema.TextLine(\n          title = u\"Last name\",\n          description = u\"Family name.\",\n          default= u'Camper'\n          )\n  \n      favorite_color = zope.schema.TextLine(\n          title = u\"Favorite color\",\n          required = False,\n          default= u'Blue'\n          )\n  \n      age = zope.schema.Int(\n          title = u\"Age\",\n          description = u\"Age in years\",\n          min = 0,\n          max = 200,\n          default= 23\n          )\n  \n      happy = zope.schema.Bool(\n          title = u\"Happy\",\n          description = u\"Are they happy?\",\n          default= True\n          )\n  \n      pet = Pet(\n          title=u'Pet',\n          description=u'This person\\'s best friend.',\n          required=False,\n          )\n  \n      temperment = zope.schema.Choice(\n          title = u\"Temperment\",\n          description = u\"What is the person like?\",\n          values = ['Nice', 'Mean', 'Ornery', 'Right Neighborly'],\n          default = u'Right Neighborly'\n          )\n  \n      weight = zope.schema.Decimal(\n          title = u\"Weight\",\n          description = u\"Weight in lbs?\"\n          )\n  \n      description = zope.schema.Text(\n          title = u\"Description\",\n          description = u\"What do they look like?\",\n          default = u'10ft tall\\nRazor sharp scales.'\n          )\n  \n      secret = zope.schema.TextLine(\n          title = u\"Secret Key\",\n          description = u\"Don't tell anybody\",\n          default = u'5ecret sauce'\n          )\n  \n      siblings = zope.schema.Int(\n          title = u\"Siblings\",\n          description = u\"Number of siblings\",\n          min = 0,\n          max = 8,\n          default = 1\n          )\n  \n      addresses = zope.schema.List(\n          title = u'Addresses',\n          description = u\"All my wonderful homes\",\n          value_type = zope.schema.Object(schema=IAddress),\n          default= [{'street':'123 fake street',\n                     'city': 'fakeville',\n                     'awesomeness': '9'},\n                    {'street':'345 false street',\n                     'city': 'falsetown',\n                     'awesomeness': '9001'}\n                   ]\n          )\n  \n      other = zope.schema.Text(\n          title = u\"Other\",\n          description = u\"Any other notes\",\n          default = u\"I've got a magic toenail\"\n          )\n  \n  class Person:\n  \n      zope.interface.implements(IPerson)\n  \n      def __init__(self, first_name, last_name, favorite_color, age, happy,\n                   pet, temperment, weight, description, secret, siblings,\n                   addresses, other):\n          self.first_name = first_name\n          self.last_name = last_name\n          self.favorite_color = favorite_color\n          self.age = age\n          self.happy = happy\n          self.pet = pet\n          self.temperment = temperment\n          self.weight = weight\n          self.description = description\n          self.secret = secret\n          self.siblings = siblings\n          self.addresses = addresses\n          self.other = other\n  \n  \n  class FormExample(zc.ajaxform.application.Application):\n  \n      resource_library_name = None\n  \n      class ExampleForm(zc.ajaxform.form.Form):\n  \n          leftFields = ('first_name', 'last_name', 'age', 'other')\n          form_fields = zope.formlib.form.Fields(IPerson)\n          form_fields['secret'].custom_widget = zc.ajaxform.widgets.Hidden\n          form_fields['siblings'].custom_widget = zc.ajaxform.widgets.NumberSpinner\n  \n          @zope.formlib.form.action(\"Register\")\n          def register(self, action, data):\n              person = Person(**data)\n              return dict(\n                  data = data,\n                  self_class_name = self.__class__.__name__,\n                  self_app_class_name = self.app.__class__.__name__,\n                  self_context_class_name = self.context.__class__.__name__\n                  )\n  \n  \n  class PetWidget(zc.ajaxform.widgets.ComboBox):\n      zope.component.adapts(\n          Pet,\n          zc.ajaxform.interfaces.IAjaxRequest)\n      zope.interface.implements(\n          zc.ajaxform.interfaces.IInputWidget)\n  \n      def __init__(self, context, request):\n          super(PetWidget, self).__init__(context, Pets(), request)\n\n\n\nNote that we've nested our form definition in an application.  We can\ndefine the form class elsewhere and use it, but if a form is only used\nin an application, then it's often easiest to define it within an\napplication class.  Forms are instantiated by calling them with a\nsingle argument.  This argument, the application, becomes the form's `app`\nattribute.  The application's context becomes the form's context.  Form\nclasses are automatically instantiated when a form class is assigned to\nan attribute in a class and accessed through an instance\n[#form_classes_are_descriptors]_.\n\nLet's try accessing our form, which can be found in its python form\nin form_example.py:\n\n    >>> import zope.testbrowser.testing\n    >>> from zc.ajaxform.testing import call_form, print_form\n    >>> browser = zope.testbrowser.testing.Browser()\n    >>> browser.open('http://localhost/form.html?login')\n    >>> print_form(browser, 'http://localhost/form.html/ExampleForm')\n    {u'definition': {u'actions': [{u'label': u'Register',\n                                   u'name': u'ExampleForm.actions.register',\n                                   u'url': u'ExampleForm/register'}],\n                     u'left_fields': {u'addresses': False,\n                                      u'age': True,\n                                      u'description': False,\n                                      u'favorite_color': False,\n                                      u'first_name': True,\n                                      u'happy': False,\n                                      u'last_name': True,\n                                      u'other': True,\n                                      u'pet': False,\n                                      u'secret': False,\n                                      u'siblings': False,\n                                      u'temperment': False,\n                                      u'weight': False},\n                     u'prefix': u'ExampleForm',\n                     u'widgets': [{u'fieldHint': u'Given name.',\n                                   u'fieldLabel': u'First name',\n                                   u'id': u'first_name',\n                                   u'minLength': 0,\n                                   u'name': u'first_name',\n                                   u'required': True,\n                                   u'value': u'Happy',\n                                   u'widget_constructor': u'zope.schema.TextLine'},\n                                  {u'fieldHint': u'Family name.',\n                                   u'fieldLabel': u'Last name',\n                                   u'id': u'last_name',\n                                   u'minLength': 0,\n                                   u'name': u'last_name',\n                                   u'required': True,\n                                   u'value': u'Camper',\n                                   u'widget_constructor': u'zope.schema.TextLine'},\n                                  {u'fieldHint': u'',\n                                   u'fieldLabel': u'Favorite color',\n                                   u'id': u'favorite_color',\n                                   u'minLength': 0,\n                                   u'name': u'favorite_color',\n                                   u'required': False,\n                                   u'value': u'Blue',\n                                   u'widget_constructor': u'zope.schema.TextLine'},\n                                  {u'allowBlank': False,\n                                   u'fieldHint': u'Age in years',\n                                   u'fieldLabel': u'Age',\n                                   u'field_max': 200,\n                                   u'field_min': 0,\n                                   u'id': u'age',\n                                   u'name': u'age',\n                                   u'required': True,\n                                   u'value': u'23',\n                                   u'widget_constructor': u'zope.schema.Int'},\n                                  {u'fieldHint': u'Are they happy?',\n                                   u'fieldLabel': u'Happy',\n                                   u'id': u'happy',\n                                   u'name': u'happy',\n                                   u'required': True,\n                                   u'value': True,\n                                   u'widget_constructor': u'zope.schema.Bool'},\n                                  {u'fieldHint': u\"This person's best friend.\",\n                                   u'fieldLabel': u'Pet',\n                                   u'id': u'pet',\n                                   u'name': u'pet',\n                                   u'required': False,\n                                   u'values': [[u'c935d187f0b998ef720390f85014ed1e',\n                                                u'Dog'],\n                                               [u'fa3ebd6742c360b2d9652b7f78d9bd7d',\n                                                u'Cat'],\n                                               [u'071642fa72ba780ee90ed36350d82745',\n                                                u'Fish']],\n                                   u'widget_constructor': u'zc.ajaxform.widgets.ComboBox'},\n                                  {u'allowBlank': False,\n                                   u'fieldHint': u'What is the person like?',\n                                   u'fieldLabel': u'Temperment',\n                                   u'hiddenName': u'temperment.value',\n                                   u'id': u'temperment',\n                                   u'name': u'temperment',\n                                   u'required': True,\n                                   u'value': u'Right Neighborly',\n                                   u'values': [[u'Nice',\n                                                u'Nice'],\n                                               [u'Mean',\n                                                u'Mean'],\n                                               [u'Ornery',\n                                                u'Ornery'],\n                                               [u'Right Neighborly',\n                                                u'Right Neighborly']],\n                                   u'widget_constructor': u'zope.schema.Choice'},\n                                  {u'allowBlank': False,\n                                   u'fieldHint': u'Weight in lbs?',\n                                   u'fieldLabel': u'Weight',\n                                   u'id': u'weight',\n                                   u'name': u'weight',\n                                   u'required': True,\n                                   u'widget_constructor': u'zope.schema.Decimal'},\n                                  {u'fieldHint': u'What do they look like?',\n                                   u'fieldLabel': u'Description',\n                                   u'id': u'description',\n                                   u'minLength': 0,\n                                   u'name': u'description',\n                                   u'required': True,\n                                   u'value': u'10ft tall\\nRazor sharp scales.',\n                                   u'widget_constructor': u'zope.schema.Text'},\n                                  {u'fieldHint': u\"Don't tell anybody\",\n                                   u'fieldLabel': u'Secret Key',\n                                   u'id': u'secret',\n                                   u'name': u'secret',\n                                   u'required': True,\n                                   u'value': u'5ecret sauce',\n                                   u'widget_constructor': u'zc.ajaxform.widgets.Hidden'},\n                                  {u'allowBlank': False,\n                                   u'fieldHint': u'Number of siblings',\n                                   u'fieldLabel': u'Siblings',\n                                   u'field_max': 8,\n                                   u'field_min': 0,\n                                   u'id': u'siblings',\n                                   u'name': u'siblings',\n                                   u'required': True,\n                                   u'value': u'1',\n                                   u'widget_constructor': u'zc.ajaxform.widgets.NumberSpinner'},\n                                  {u'fieldHint': u'All my wonderful homes',\n                                   u'fieldLabel': u'Addresses',\n                                   u'id': u'addresses',\n                                   u'name': u'addresses',\n                                   u'record_schema': {u'readonly': False,\n                                                      u'widgets': [{u'fieldHint': u'The street',\n                                                                    u'fieldLabel': u'Street',\n                                                                    u'id': u'street',\n                                                                    u'minLength': 0,\n                                                                    u'name': u'street',\n                                                                    u'required': True,\n                                                                    u'widget_constructor': u'zope.schema.TextLine'},\n                                                                   {u'fieldHint': u'The city',\n                                                                    u'fieldLabel': u'City',\n                                                                    u'id': u'city',\n                                                                    u'minLength': 0,\n                                                                    u'name': u'city',\n                                                                    u'required': True,\n                                                                    u'widget_constructor': u'zope.schema.TextLine'},\n                                                                   {u'allowBlank': False,\n                                                                    u'fieldHint': u'The awesomeness on a scale of 1 to 10',\n                                                                    u'fieldLabel': u'Awesomeness',\n                                                                    u'field_max': 10,\n                                                                    u'field_min': 1,\n                                                                    u'id': u'awesomeness',\n                                                                    u'name': u'awesomeness',\n                                                                    u'required': True,\n                                                                    u'widget_constructor': u'zope.schema.Int'}]},\n                                   u'required': True,\n                                   u'value': [{u'awesomeness': u'9',\n                                               u'city': u'fakeville',\n                                               u'street': u'123 fake street'},\n                                              {u'awesomeness': u'9001',\n                                               u'city': u'falsetown',\n                                               u'street': u'345 false street'}],\n                                   u'widget_constructor': u'zope.schema.List'},\n                                  {u'fieldHint': u'Any other notes',\n                                   u'fieldLabel': u'Other',\n                                   u'id': u'other',\n                                   u'minLength': 0,\n                                   u'name': u'other',\n                                   u'required': True,\n                                   u'value': u\"I've got a magic toenail\",\n                                   u'widget_constructor': u'zope.schema.Text'}]}}\n\nOur application is at: \"http://localhost/form.html\". The form is\nexposed as an ajax method named \"ExampleForm\", which comes from the attribute\nname in the class definition.\n\nThe form definition contains both action definitions and widget\ndefinitions. The widget definitions may be full js field definitions\nor name a widget_constructor, which is a Javascript helper provided by\nthe zc.ajaxform resource library that provides additional information,\nlike Javascript validators, that can't be expressed in JSON.\n\nThere is an action definition for each action defined in the form.  The\naction information includes the url to post the result to, relative to\nthe application.\n\nNote that the name of the form class is used as the form prefix and\nthat the form prefix is used as the prefix for widget and action names\nand ids [#actionids]_.\n\nLet's post a result back:\n\n    >>> print_form(browser, 'http://localhost/form.html/ExampleForm/register',\n    ...            {'first_name': 'Bob',\n    ...             'last_name': '',\n    ...             'favorite_color': '',\n    ...             'age': '-1',\n    ...             })\n    {u'errors': {u'addresses': u'Addresses: Missing Input',\n                 u'age': u'Value is too small',\n                 u'description': u'Description: Missing Input',\n                 u'last_name': u'Last name: Missing Input',\n                 u'other': u'Other: Missing Input',\n                 u'secret': u'Secret Key: Missing Input',\n                 u'siblings': u'Siblings: Missing Input',\n                 u'temperment': u'Temperment: Missing Input',\n                 u'weight': u'Weight: Missing Input'}}\n\nThe result had 9 problems:\n\n- We didn't provide a last name, description, secret key,\n  number of siblings, temperment, or weight, which are all required\n\n- In the form we did not specify deleting either of our two current\n  address records, but also ommitted their data, and the first of them\n  reported a missing field. Following this we will delete them both and\n  add a new record.\n\n- We specified an invalid age.\n\nLet's pass valid data:\n\n    >>> print_form(browser, 'http://localhost/form.html/ExampleForm/register',\n    ...            {'first_name': 'Bob',\n    ...             'last_name': 'Zope',\n    ...             'favorite_color': '',\n    ...             'age': '11',\n    ...             'addresses.street.0': '123 Fake Ln.',\n    ...             'addresses.city.0': 'Fakeville',\n    ...             'addresses.awesomeness.0': 7,\n    ...             'description': 'Hello',\n    ...             'other': 'So nice to meet you',\n    ...             'secret': 'Oh nothing',\n    ...             'siblings': 1,\n    ...             'temperment': 'Nice',\n    ...             'weight': '170.5',\n    ...             'pet': 'Carrier Pigeon'\n    ...             })\n    {u'data': {u'addresses': [{u'awesomeness': 7,\n                               u'city': u'Fakeville',\n                               u'street': u'123 Fake Ln.'}],\n               u'age': 11,\n               u'description': u'Hello',\n               u'favorite_color': u'',\n               u'first_name': u'Bob',\n               u'happy': False,\n               u'last_name': u'Zope',\n               u'other': u'So nice to meet you',\n               u'pet': u'Carrier Pigeon',\n               u'secret': u'Oh nothing',\n               u'siblings': 1,\n               u'temperment': u'Nice',\n               u'weight': u'170.5'},\n     u'self_app_class_name': u'FormExample',\n     u'self_class_name': u'ExampleForm',\n     u'self_context_class_name': u'Folder'}\n\nHere we get a successful result.  Our contrived action in the example\nsimply echoed back the data it was passed,  Note, in particular that:\n\n- the data keys have the form prefix removed, and\n\n- the value of the age key is an integer, since the field was an\n  integer field.\n\nNote that for the list field, the original request added a prefix of the list\nfield name to prevent collisions with a field with the same name in another\nlist field (if it existed).\n\nThe action also prints out the classes of its self argument, its app\nand its context. Actions are methods of forms so their `self` argument is the\nform. The form's `app` is the app through which it is accessed and\n`context` is the app's context.\n\nFor list widgets if a field in its record is missing and it is required, the\nerror reported lists the field name:\n\n    >>> print_form(browser, 'http://localhost/form.html/ExampleForm/register',\n    ...            {'first_name': 'Bob',\n    ...             'last_name': 'Zope',\n    ...             'favorite_color': '',\n    ...             'age': '11',\n    ...             'addresses.street.0': '123 Fake Ln.',\n    ...             'addresses.city.0': 'Fakeville',\n    ...             'addresses.awesomeness.0': 7,\n    ...             'addresses.street.1': 'The 2nd Missing field St.',\n    ...             'addresses.awesomeness.1': 3,\n    ...             'description': 'Hello',\n    ...             'other': 'So nice to meet you',\n    ...             'secret': 'Oh nothing',\n    ...             'siblings': 1,\n    ...             'temperment': 'Nice',\n    ...             'weight': '170.5',\n    ...             'pet': 'Carrier Pigeon'\n    ...             })\n    {u'errors': {u'addresses': u'City: Missing Input'}}\n\nLet's provide this value now:\n\n    >>> print_form(browser, 'http://localhost/form.html/ExampleForm/register',\n    ...            {'first_name': 'Bob',\n    ...             'last_name': 'Zope',\n    ...             'favorite_color': '',\n    ...             'age': '11',\n    ...             'addresses.street.0': '123 Fake Ln.',\n    ...             'addresses.city.0': 'Fakeville',\n    ...             'addresses.awesomeness.0': 7,\n    ...             'addresses.street.1': 'The 2nd Missing field St.',\n    ...             'addresses.city.1': 'A Void',\n    ...             'addresses.awesomeness.1': '3',\n    ...             'description': 'Hello',\n    ...             'other': 'So nice to meet you',\n    ...             'secret': 'Oh nothing',\n    ...             'siblings': 1,\n    ...             'temperment': 'Nice',\n    ...             'weight': '170.5',\n    ...             'pet': 'Carrier Pigeon'\n    ...             })\n    {u'data': {u'addresses': [{u'awesomeness': 7,\n                               u'city': u'Fakeville',\n                               u'street': u'123 Fake Ln.'},\n                              {u'awesomeness': 3,\n                               u'city': u'A Void',\n                               u'street': u'The 2nd Missing field St.'}],\n               u'age': 11,\n               u'description': u'Hello',\n               u'favorite_color': u'',\n               u'first_name': u'Bob',\n               u'happy': False,\n               u'last_name': u'Zope',\n               u'other': u'So nice to meet you',\n               u'pet': u'Carrier Pigeon',\n               u'secret': u'Oh nothing',\n               u'siblings': 1,\n               u'temperment': u'Nice',\n               u'weight': u'170.5'},\n     u'self_app_class_name': u'FormExample',\n     u'self_class_name': u'ExampleForm',\n     u'self_context_class_name': u'Folder'}\n\n\nReordering items in a list is accomplished by reordering the suffix for the\nrecord fields:\n\n    >>> print_form(browser, 'http://localhost/form.html/ExampleForm/register',\n    ...            {'first_name': 'Bob',\n    ...             'last_name': 'Zope',\n    ...             'favorite_color': '',\n    ...             'age': '11',\n    ...             'addresses.street.1': '123 Fake Ln.',\n    ...             'addresses.city.1': 'Fakeville',\n    ...             'addresses.awesomeness.1': 7,\n    ...             'addresses.street.0': 'The 2nd Missing field St.',\n    ...             'addresses.city.0': 'A Void',\n    ...             'addresses.awesomeness.0': 3,\n    ...             'description': 'Hello',\n    ...             'other': 'So nice to meet you',\n    ...             'secret': 'Oh nothing',\n    ...             'siblings': 1,\n    ...             'temperment': 'Nice',\n    ...             'weight': '170.5',\n    ...             'pet': 'Carrier Pigeon'\n    ...             })\n    {u'data': {u'addresses': [{u'awesomeness': 3,\n                               u'city': u'A Void',\n                               u'street': u'The 2nd Missing field St.'},\n                              {u'awesomeness': 7,\n                               u'city': u'Fakeville',\n                               u'street': u'123 Fake Ln.'}],\n               u'age': 11,\n               u'description': u'Hello',\n               u'favorite_color': u'',\n               u'first_name': u'Bob',\n               u'happy': False,\n               u'last_name': u'Zope',\n               u'other': u'So nice to meet you',\n               u'pet': u'Carrier Pigeon',\n               u'secret': u'Oh nothing',\n               u'siblings': 1,\n               u'temperment': u'Nice',\n               u'weight': u'170.5'},\n     u'self_app_class_name': u'FormExample',\n     u'self_class_name': u'ExampleForm',\n     u'self_context_class_name': u'Folder'}\n\n\n\nGetting definitions from Python\n-------------------------------\n\nSometimes we want to get form definitions from Python.  The form\n__call__ method returns a JSON string.  We can get Python data by\ncalling get_definition.\n\n    >>> import zc.ajaxform.form_example\n    >>> import zope.publisher.browser\n    >>> request = zope.publisher.browser.TestRequest()\n    >>> import zc.ajaxform.interfaces\n    >>> import zope.interface\n    >>> zope.interface.alsoProvides(\n    ...     request, zc.ajaxform.interfaces.IAjaxRequest)\n    >>> ex = zc.ajaxform.form_example.FormExample(None, request)\n    >>> from pprint import pprint\n    >>> pprint(ex.ExampleForm.get_definition(), width=1)\n    {'actions': [{'label': 'Register',\n                  'name': u'ExampleForm.actions.register',\n                  'url': u'ExampleForm/register'}],\n     'left_fields': {'addresses': False,\n                     'age': True,\n                     'description': False,\n                     'favorite_color': False,\n                     'first_name': True,\n                     'happy': False,\n                     'last_name': True,\n                     'other': True,\n                     'pet': False,\n                     'secret': False,\n                     'siblings': False,\n                     'temperment': False,\n                     'weight': False},\n     'prefix': 'ExampleForm',\n     'widgets': [{'fieldHint': u'Given name.',\n                  'fieldLabel': u'First name',\n                  'id': 'first_name',\n                  'minLength': 0,\n                  'name': 'first_name',\n                  'required': True,\n                  'value': u'Happy',\n                  'widget_constructor': 'zope.schema.TextLine'},\n                 {'fieldHint': u'Family name.',\n                  'fieldLabel': u'Last name',\n                  'id': 'last_name',\n                  'minLength': 0,\n                  'name': 'last_name',\n                  'required': True,\n                  'value': u'Camper',\n                  'widget_constructor': 'zope.schema.TextLine'},\n                 {'fieldHint': u'',\n                  'fieldLabel': u'Favorite color',\n                  'id': 'favorite_color',\n                  'minLength': 0,\n                  'name': 'favorite_color',\n                  'required': False,\n                  'value': u'Blue',\n                  'widget_constructor': 'zope.schema.TextLine'},\n                 {'allowBlank': False,\n                  'fieldHint': u'Age in years',\n                  'fieldLabel': u'Age',\n                  'field_max': 200,\n                  'field_min': 0,\n                  'id': 'age',\n                  'name': 'age',\n                  'required': True,\n                  'value': u'23',\n                  'widget_constructor': 'zope.schema.Int'},\n                 {'fieldHint': u'Are they happy?',\n                  'fieldLabel': u'Happy',\n                  'id': 'happy',\n                  'name': 'happy',\n                  'required': True,\n                  'value': True,\n                  'widget_constructor': 'zope.schema.Bool'},\n                 {'fieldHint': u\"This person's best friend.\",\n                  'fieldLabel': u'Pet',\n                  'id': 'pet',\n                  'name': 'pet',\n                  'required': False,\n                  'values': [['c935d187f0b998ef720390f85014ed1e',\n                              u'Dog'],\n                             ['fa3ebd6742c360b2d9652b7f78d9bd7d',\n                              u'Cat'],\n                             ['071642fa72ba780ee90ed36350d82745',\n                              u'Fish']],\n                  'widget_constructor': 'zc.ajaxform.widgets.ComboBox'},\n                 {'allowBlank': False,\n                  'fieldHint': u'What is the person like?',\n                  'fieldLabel': u'Temperment',\n                  'hiddenName': 'temperment.value',\n                  'id': 'temperment',\n                  'name': 'temperment',\n                  'required': True,\n                  'value': 'Right Neighborly',\n                  'values': [['Nice',\n                              u'Nice'],\n                             ['Mean',\n                              u'Mean'],\n                             ['Ornery',\n                              u'Ornery'],\n                             ['Right Neighborly',\n                              u'Right Neighborly']],\n                  'widget_constructor': 'zope.schema.Choice'},\n                 {'allowBlank': False,\n                  'fieldHint': u'Weight in lbs?',\n                  'fieldLabel': u'Weight',\n                  'id': 'weight',\n                  'name': 'weight',\n                  'required': True,\n                  'widget_constructor': 'zope.schema.Decimal'},\n                 {'fieldHint': u'What do they look like?',\n                  'fieldLabel': u'Description',\n                  'id': 'description',\n                  'minLength': 0,\n                  'name': 'description',\n                  'required': True,\n                  'value': u'10ft tall\\nRazor sharp scales.',\n                  'widget_constructor': 'zope.schema.Text'},\n                 {'fieldHint': u\"Don't tell anybody\",\n                  'fieldLabel': u'Secret Key',\n                  'id': 'secret',\n                  'name': 'secret',\n                  'required': True,\n                  'value': u'5ecret sauce',\n                  'widget_constructor': 'zc.ajaxform.widgets.Hidden'},\n                 {'allowBlank': False,\n                  'fieldHint': u'Number of siblings',\n                  'fieldLabel': u'Siblings',\n                  'field_max': 8,\n                  'field_min': 0,\n                  'id': 'siblings',\n                  'name': 'siblings',\n                  'required': True,\n                  'value': u'1',\n                  'widget_constructor': 'zc.ajaxform.widgets.NumberSpinner'},\n                 {'fieldHint': u'All my wonderful homes',\n                  'fieldLabel': u'Addresses',\n                  'id': 'addresses',\n                  'name': 'addresses',\n                  'record_schema': {'readonly': False,\n                                    'widgets': [{'fieldHint': u'The street',\n                                                 'fieldLabel': u'Street',\n                                                 'id': 'street',\n                                                 'minLength': 0,\n                                                 'name': 'street',\n                                                 'required': True,\n                                                 'widget_constructor': 'zope.schema.TextLine'},\n                                                {'fieldHint': u'The city',\n                                                 'fieldLabel': u'City',\n                                                 'id': 'city',\n                                                 'minLength': 0,\n                                                 'name': 'city',\n                                                 'required': True,\n                                                 'widget_constructor': 'zope.schema.TextLine'},\n                                                {'allowBlank': False,\n                                                 'fieldHint': u'The awesomeness on a scale of 1 to 10',\n                                                 'fieldLabel': u'Awesomeness',\n                                                 'field_max': 10,\n                                                 'field_min': 1,\n                                                 'id': 'awesomeness',\n                                                 'name': 'awesomeness',\n                                                 'required': True,\n                                                 'widget_constructor': 'zope.schema.Int'}]},\n                  'required': True,\n                  'value': [{'awesomeness': u'9',\n                             'city': u'fakeville',\n                             'street': u'123 fake street'},\n                            {'awesomeness': u'9001',\n                             'city': u'falsetown',\n                             'street': u'345 false street'}],\n                  'widget_constructor': 'zope.schema.List'},\n                 {'fieldHint': u'Any other notes',\n                  'fieldLabel': u'Other',\n                  'id': 'other',\n                  'minLength': 0,\n                  'name': 'other',\n                  'required': True,\n                  'value': u\"I've got a magic toenail\",\n                  'widget_constructor': 'zope.schema.Text'}]}\n\nNote that we had to stamp the request with IAjaxRequest.  This is done\nduring application traversal.  We need it so widgets can get looked\nup.\n\n\nBase and prefix\n---------------\n\nForms have base_href and prefix variables.  The base_href is used to compute\nURLs for form actions.  A form's base_href defaults to its class name.\nThe form's base_href also includes the base_href of its app, if its app has\na base_href. This is useful for sub-applications. Let's give our sample\napplication a base_href attribute as if it were a sub-application:\n\n    >>> ex = zc.ajaxform.form_example.FormExample(None, request)\n    >>> ex.base_href = 'sample'\n    >>> ex.ExampleForm.base_href\n    'sample/ExampleForm'\n\n    >>> pprint(ex.ExampleForm.get_definition(), width=1)\n    {'actions': [{'label': 'Register',\n                  'name': u'sample.ExampleForm.actions.register',\n                  'url': u'sample/ExampleForm/register'}],\n     'left_fields': {'addresses': False,\n                     'age': True,\n                     'description': False,\n                     'favorite_color': False,\n                     'first_name': True,\n                     'happy': False,\n                     'last_name': True,\n                     'other': True,\n                     'pet': False,\n                     'secret': False,\n                     'siblings': False,\n                     'temperment': False,\n                     'weight': False},\n     'prefix': 'sample.ExampleForm',\n     'widgets': [{'fieldHint': u'Given name.',\n                  'fieldLabel': u'First name',\n                  'id': 'first_name',\n                  'minLength': 0,\n                  'name': 'first_name',\n                  'required': True,\n                  'value': u'Happy',\n                  'widget_constructor': 'zope.schema.TextLine'},\n                 {'fieldHint': u'Family name.',\n                  'fieldLabel': u'Last name',\n                  'id': 'last_name',\n                  'minLength': 0,\n                  'name': 'last_name',\n                  'required': True,\n                  'value': u'Camper',\n                  'widget_constructor': 'zope.schema.TextLine'},\n                 {'fieldHint': u'',\n                  'fieldLabel': u'Favorite color',\n                  'id': 'favorite_color',\n                  'minLength': 0,\n                  'name': 'favorite_color',\n                  'required': False,\n                  'value': u'Blue',\n                  'widget_constructor': 'zope.schema.TextLine'},\n                 {'allowBlank': False,\n                  'fieldHint': u'Age in years',\n                  'fieldLabel': u'Age',\n                  'field_max': 200,\n                  'field_min': 0,\n                  'id': 'age',\n                  'name': 'age',\n                  'required': True,\n                  'value': u'23',\n                  'widget_constructor': 'zope.schema.Int'},\n                 {'fieldHint': u'Are they happy?',\n                  'fieldLabel': u'Happy',\n                  'id': 'happy',\n                  'name': 'happy',\n                  'required': True,\n                  'value': True,\n                  'widget_constructor': 'zope.schema.Bool'},\n                 {'fieldHint': u\"This person's best friend.\",\n                  'fieldLabel': u'Pet',\n                  'id': 'pet',\n                  'name': 'pet',\n                  'required': False,\n                  'values': [['c935d187f0b998ef720390f85014ed1e',\n                              u'Dog'],\n                             ['fa3ebd6742c360b2d9652b7f78d9bd7d',\n                              u'Cat'],\n                             ['071642fa72ba780ee90ed36350d82745',\n                              u'Fish']],\n                  'widget_constructor': 'zc.ajaxform.widgets.ComboBox'},\n                 {'allowBlank': False,\n                  'fieldHint': u'What is the person like?',\n                  'fieldLabel': u'Temperment',\n                  'hiddenName': 'temperment.value',\n                  'id': 'temperment',\n                  'name': 'temperment',\n                  'required': True,\n                  'value': 'Right Neighborly',\n                  'values': [['Nice',\n                              u'Nice'],\n                             ['Mean',\n                              u'Mean'],\n                             ['Ornery',\n                              u'Ornery'],\n                             ['Right Neighborly',\n                              u'Right Neighborly']],\n                  'widget_constructor': 'zope.schema.Choice'},\n                 {'allowBlank': False,\n                  'fieldHint': u'Weight in lbs?',\n                  'fieldLabel': u'Weight',\n                  'id': 'weight',\n                  'name': 'weight',\n                  'required': True,\n                  'widget_constructor': 'zope.schema.Decimal'},\n                 {'fieldHint': u'What do they look like?',\n                  'fieldLabel': u'Description',\n                  'id': 'description',\n                  'minLength': 0,\n                  'name': 'description',\n                  'required': True,\n                  'value': u'10ft tall\\nRazor sharp scales.',\n                  'widget_constructor': 'zope.schema.Text'},\n                 {'fieldHint': u\"Don't tell anybody\",\n                  'fieldLabel': u'Secret Key',\n                  'id': 'secret',\n                  'name': 'secret',\n                  'required': True,\n                  'value': u'5ecret sauce',\n                  'widget_constructor': 'zc.ajaxform.widgets.Hidden'},\n                 {'allowBlank': False,\n                  'fieldHint': u'Number of siblings',\n                  'fieldLabel': u'Siblings',\n                  'field_max': 8,\n                  'field_min': 0,\n                  'id': 'siblings',\n                  'name': 'siblings',\n                  'required': True,\n                  'value': u'1',\n                  'widget_constructor': 'zc.ajaxform.widgets.NumberSpinner'},\n                 {'fieldHint': u'All my wonderful homes',\n                  'fieldLabel': u'Addresses',\n                  'id': 'addresses',\n                  'name': 'addresses',\n                  'record_schema': {'readonly': False,\n                                    'widgets': [{'fieldHint': u'The street',\n                                                 'fieldLabel': u'Street',\n                                                 'id': 'street',\n                                                 'minLength': 0,\n                                                 'name': 'street',\n                                                 'required': True,\n                                                 'widget_constructor': 'zope.schema.TextLine'},\n                                                {'fieldHint': u'The city',\n                                                 'fieldLabel': u'City',\n                                                 'id': 'city',\n                                                 'minLength': 0,\n                                                 'name': 'city',\n                                                 'required': True,\n                                                 'widget_constructor': 'zope.schema.TextLine'},\n                                                {'allowBlank': False,\n                                                 'fieldHint': u'The awesomeness on a scale of 1 to 10',\n                                                 'fieldLabel': u'Awesomeness',\n                                                 'field_max': 10,\n                                                 'field_min': 1,\n                                                 'id': 'awesomeness',\n                                                 'name': 'awesomeness',\n                                                 'required': True,\n                                                 'widget_constructor': 'zope.schema.Int'}]},\n                  'required': True,\n                  'value': [{'awesomeness': u'9',\n                             'city': u'fakeville',\n                             'street': u'123 fake street'},\n                            {'awesomeness': u'9001',\n                             'city': u'falsetown',\n                             'street': u'345 false street'}],\n                  'widget_constructor': 'zope.schema.List'},\n                 {'fieldHint': u'Any other notes',\n                  'fieldLabel': u'Other',\n                  'id': 'other',\n                  'minLength': 0,\n                  'name': 'other',\n                  'required': True,\n                  'value': u\"I've got a magic toenail\",\n                  'widget_constructor': 'zope.schema.Text'}]}\n\nNote that the action URL now includes \"sample/\" as a prefix.  Also\nnote that the widget and action names have \"\" as a prefix.  The\nform prefix is simply its base with \"/\"s converted to \".\"s.\n\n    >>> ex.ExampleForm.prefix\n    'sample.ExampleForm'\n\n\nForm data\n---------\n\nAjax forms are a bit different from normal web forms because the data\nand the form definition can be fetched separately.  For example, we\nmay use the same form to edit multiple objects.  Form objects have a\ngetObjectData method that returns data suitable for editing form field\nvalues.  Let's create a person and use out form to get data for them:\n\n    >>> bob = zc.ajaxform.form_example.Person(\n    ...     first_name='bob',\n    ...     last_name='smith',\n    ...     favorite_color=None,\n    ...     age=11,\n    ...     happy=True,\n    ...     pet=u'Cockatiel',\n    ...     temperment='Nice',\n    ...     weight = 175.5,\n    ...     description = 'A real cool guy',\n    ...     secret = 'Noone knows!',\n    ...     siblings = 1,\n    ...     addresses = [],\n    ...     other = 'stuff')\n    >>> pprint(ex.ExampleForm.getObjectData(bob), width=1)\n    {'addresses': [],\n     'age': u'11',\n     'description': u'A real cool guy',\n     'first_name': u'bob',\n     'happy': True,\n     'last_name': u'smith',\n     'other': u'stuff',\n     'pet': u'Cockatiel',\n     'secret': u'Noone knows!',\n     'siblings': u'1',\n     'temperment': 'Nice',\n     'weight': u'175.5'}\n\nWe didn't set the favorite_color for the person, so it is ommitted\nfrom the data.\n\nWe can pass in a dictionary of values that take precedence over object data:\n\n    >>> pprint(ex.ExampleForm.getObjectData(\n    ...            bob, {'age': u'1'}),\n    ...        width=1)\n    {'addresses': [],\n     'age': u'1',\n     'description': u'A real cool guy',\n     'first_name': u'bob',\n     'happy': True,\n     'last_name': u'smith',\n     'other': u'stuff',\n     'pet': u'Cockatiel',\n     'secret': u'Noone knows!',\n     'siblings': u'1',\n     'temperment': 'Nice',\n     'weight': u'175.5'}\n\n\nDisplay Options\n---------------\n\nAdditional display options may be sent in the widget definition if the widget\ncan be adapted to `IDisplayOptions`.  The result of the adaptation only need\nbe JSON serializable.\n\n    >>> import zope.app.form.interfaces\n\n    >>> def example_options(widget):\n    ...     field, name = widget.context, widget.context.__name__\n    ...     if name == 'favorite_color':\n    ...         return {'picker': 'crayons'}\n    ...     elif name == 'secret':\n    ...         return 'super-secret'\n    ...     else:\n    ...         return None\n\n    >>> site_manager = zope.component.getSiteManager()\n    >>> site_manager.registerAdapter(\n    ...     example_options,\n    ...     required=(zope.app.form.interfaces.IWidget,),\n    ...     provided=zc.ajaxform.interfaces.IDisplayOptions)\n\n    >>> result = call_form(\n    ...     browser, 'http://localhost/form.html/ExampleForm')\n\n    >>> widgets = result['definition']['widgets']\n    >>> for widget in widgets:\n    ...     if widget.get('display_options'):\n    ...         print widget['name'] + ':', widget['display_options']\n    favorite_color: {u'picker': u'crayons'}\n    secret: super-secret\n\nFinally, clean up.\n\n    >>> site_manager.unregisterAdapter(\n    ...     example_options,\n    ...     required=(zope.app.form.interfaces.IWidget,),\n    ...     provided=zc.ajaxform.interfaces.IDisplayOptions)\n    True\n\n\nTo-do (maybe)\n-------------\n\nMore widgets!\n\nInterface invariants\n\nActions:\n\n- conditions\n\n- validators\n\n- failure handlers\n\n\n.. [#application] See application.txt\n\n.. [#form_classes_are_descriptors] Form classes are also\n   descriptors. They get called with the instance they're accessed\n   through.\n\n.. [#actionids] The Javascript code that sets up action buttons uses\n   action name as the button's ID.\n\nDownload\n********", "description_content_type": null, "docs_url": null, "download_url": "UNKNOWN", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "UNKNOWN", "keywords": null, "license": "ZPL 2.1", "maintainer": null, "maintainer_email": null, "name": "zc.ajaxform", "package_url": "https://pypi.org/project/zc.ajaxform/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/zc.ajaxform/", "project_urls": {"Download": "UNKNOWN", "Homepage": "UNKNOWN"}, "release_url": "https://pypi.org/project/zc.ajaxform/0.7.0/", "requires_dist": null, "requires_python": null, "summary": "UNKNOWN", "version": "0.7.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            ********************<br>Ajax Support<br>********************<br><br>The zc.ajaxform package provides framework to support:<br><br>- A single-class application model<br><br>- Nested-application support<br><br>- Integration with zope.formlib<br><br>.. contents::<br><br>Detailed Documentation<br>**********************<br><br>Application support<br>===================<br><br>The zc.ajaxform.application module provides support for writing ajax<br>[#ajax]_ applications.  This framework started out as an experiment in<br>simplifying writing applications with Zope 3.  I was frustrated with<br>ZCML situps and generally too much indirection.  I ended up with a<br>model that I'm pretty happy with.  It might not be for everybody. :)<br><br>The basic idea is that an application can be provided using a single<br>Zope 3 view plus necessary resource-library definitions.  This view<br>has a URL.  It typically provides many ajax methods whose URLs have the<br>view URL as a base.<br><br>Many applications can be implemented using a simple class that can be<br>registered as a view.<br><br>Let's look at a simple stupid application. :)<br><br>::<br><br>  import zc.ajaxform.application<br>  import zope.exceptions<br>  <br>  class Calculator(zc.ajaxform.application.Trusted,<br>                   zc.ajaxform.application.Application):<br>  <br>      resource_library_name = None<br>  <br>      @zc.ajaxform.application.jsonpage<br>      def about(self):<br>          return 'Calculator 1.0'<br>  <br>      @zc.ajaxform.application.jsonpage<br>      def operations(self):<br>          return ['add', \"subtract\"]<br>  <br>      @zc.ajaxform.application.jsonpage<br>      def value(self):<br>          return dict(value=getattr(self.context, 'calculator_value', 0))<br>  <br>      def do_add(self, value):<br>          value += getattr(self.context, 'calculator_value', 0)<br>          self.context.calculator_value = value<br>          return dict(value=value)<br>      <br>      @zc.ajaxform.application.jsonpage<br>      def add(self, value):<br>          if not isinstance(value, int):<br>              return dict(error=\"The value must be an integer!\")<br>          return self.do_add(value)<br>      <br>      @zc.ajaxform.application.jsonpage<br>      def subtract(self, value):<br>          if not isinstance(value, int):<br>              raise zope.exceptions.UserError(<br>                  \"The value must be an integer!\")<br>          return self.do_add(-value)<br>  <br>      @zc.ajaxform.application.jsonpage<br>      def noop(self):<br>          pass<br>  <br>      @zc.ajaxform.application.page<br>      def none(self):<br>          return \"null\"<br>  <br>      @zc.ajaxform.application.jsonpage<br>      def echo_form(self):<br>          def maybe_file(v):<br>              if hasattr(v, 'read'):<br>                  return (\"&lt;File upload name=%r content-type=%r size=%r&gt;\"<br>                          % (v.filename, v.headers['content-type'], len(v.read()))<br>                          )<br>              else:<br>                  return v<br>          <br>          return dict(<br>              (name, maybe_file(v))<br>              for (name, v) in self.request.form.items()<br>              )<br>  <br>  <br>      @zc.ajaxform.application.jsonpage<br>      def doh(self):<br>          raise TypeError(\"Doh!\")<br>      <br><br><br><br>We subclass zc.ajaxform.application.Trusted. This is a minimal<br>base class that provides a constructor that takes a context and a<br>request and removes the security proxy from the context.  It<br>overrides the constructor from zc.ajaxform.application.Application.<br><br>We also subclass zc.ajaxform.application.Application.  This is a base<br>class that provides:<br><br>- a basic constructor that takes context and request arguments and sets<br>  corresponding attributes,<br><br>- traversal to attributes that provide IBrowserPublisher with<br>  conversion of dots to underscores,<br><br>- a default \"page\" named index.html,<br><br>- a template method that returns an HTML page with an empty head.<br><br>- an index_html method that loads a resource library and calls the<br>  template,<br><br>- an interface declaration that it provides IBrowserPublisher, and<br><br>- an adapter declaration that adapts<br>  zope.traversing.interfaces.IContainmentRoot and<br>  zope.publisher.interfaces.browser.IBrowserRequest.<br><br>The main goals of this base class are to make it easy to load<br>Javascript and to make it easy to define ajax methods to support the<br>Javascript. For that reason, we provide a traverser that traverses to<br>object attributes that provide IBrowserPublisher.  The<br>zc.ajaxform.application.jsonpage decorator is also an important part of<br>this. It makes methods accessible and automatically marshals their<br>result to JSON [#jsoninput]_.  There's also a<br>zc.ajaxform.application.page decorator that makes methods accessible<br>without the automatic marshalling.  The use of a default page, rather<br>than just a __call__ method is to cause the URL base to be the view,<br>rather than the view's context.  This allows the Javascript code to<br>use relative URLs to refer to the ajax methods.<br><br>The class expects subclasses to define a resource_library_name<br>attribute [#missing_resource_library_name]_.  For these applications,<br>you pretty much always want to use an associated Javascript file and<br>other resources (supporting JS, CSS, etc.).  You can suppress the use<br>of the resource library by setting the value of this attribute to<br>None.<br><br>For applications that build pages totally in Javascript, the default<br>template is adequate.  For applications that need to support<br>non-Javascript-enabled browsers, that want to support search-engine<br>optimization [#sso]_, or that want to provide some Javascript data<br>during the initial page load, a custom template can be provided by<br>simply overriding the template method with a page template or a method<br>that calls one.<br><br>The view can be registered with a simple adapter registration:<br><br>::<br><br>  &lt;configure xmlns=\"http://namespaces.zope.org/zope\"&gt;<br>    &lt;adapter name=\"calculator.html\"<br>             factory=\"zc.ajaxform.calculator_example.Calculator\"<br>             permission=\"zope.View\"<br>             /&gt;<br>  &lt;/configure&gt;<br><br><br><br>If we wanted to register it for an object other than the an<br>IContainmentRoot, we could just provide specifically adapted interfaces<br>or classes in the registration.<br><br>Let's access the calculator with a test browser<br><br>    &gt;&gt;&gt; import zope.testbrowser.testing<br>    &gt;&gt;&gt; browser = zope.testbrowser.testing.Browser()<br>    &gt;&gt;&gt; browser.open('http://localhost/')<br>    Traceback (most recent call last):<br>    ...<br>    HTTPError: HTTP Error 401: Unauthorized<br><br>Because our view was registered to require zope.View, the request was<br>unauthorized.  Let's login. In the demo setup, we login by just<br>providing a login form variable. <br><br>    &gt;&gt;&gt; browser.open('http://localhost/calculator.html?login')<br>    &gt;&gt;&gt; print browser.contents # doctest: +NORMALIZE_WHITESPACE<br>    &lt;html&gt;&lt;head&gt;<br>    &lt;base href=\"http://localhost/calculator.html/index.html\" /&gt;<br>    &lt;/head&gt;&lt;/html&gt;<br><br>We registered our view as calculator.html. Because of the way it sets the<br>browser default page for itself, it becomes the base href for the<br>page.  This allows us to access ajax methods using relative URLs.<br><br>Our calculator view provides a value method.  It uses the<br>zc.ajaxform.application.jsonpage decorator. This does 2 things:<br><br>- Arranges that the method can be traversed to,<br><br>- marshals the result to JSON.<br><br>The way results are marshalled to JSON deserves some<br>explanation.  To support automation of ajax calls, we:<br><br>- Always return objects<br>- If there is an error, we include:<br>  - an error property providing an error messahe, and/or<br>  - when handling form submissions, an errors property with am object value<br>    mapping field names to field-specific error messages.<br><br>::<br><br>    &gt;&gt;&gt; import simplejson<br><br>    &gt;&gt;&gt; browser.open('http://localhost/@@calculator.html/value')<br>    &gt;&gt;&gt; simplejson.loads(browser.contents)<br>    {u'value': 0}<br><br>    &gt;&gt;&gt; browser.open('http://localhost/@@calculator.html/add?value=hi')<br>    &gt;&gt;&gt; simplejson.loads(browser.contents)<br>    {u'error': u'The value must be an integer!'}<br><br>Things other than a dictionary can be returned:<br><br>    &gt;&gt;&gt; browser.open('http://localhost/@@calculator.html/about')<br>    &gt;&gt;&gt; simplejson.loads(browser.contents)<br>    u'Calculator 1.0'<br><br>    &gt;&gt;&gt; browser.open('http://localhost/@@calculator.html/operations')<br>    &gt;&gt;&gt; simplejson.loads(browser.contents)<br>    [u'add', u'subtract']<br><br>If you want to marshal JSON yourself, you can use the<br>zc.ajaxform.application.jsonpage decorator:<br><br>    &gt;&gt;&gt; browser.open('http://localhost/@@calculator.html/none')<br><br>An alternative way to return errors is to raise user errors, as is<br>done by the subtract method in our example:<br><br>    &gt;&gt;&gt; browser.open('http://localhost/@@calculator.html/subtract?value=hi')<br>    &gt;&gt;&gt; simplejson.loads(browser.contents)<br>    {u'error': u'The value must be an integer!'}<br><br>This works because there is a view registered for<br>zope.exceptions.interfaces.IUserError, and<br>zc.ajaxform.interfaces.IAjaxRequest.<br><br>Testing support<br>===============<br><br>zc.ajaxform.testing has some helper functions to make it easier to test<br>ajax calls.<br><br>The zc.ajaxform.testing.FormServer class provides some convenience for<br>making ajax calls in which data are sent as form data and returned as<br>JSON.  The class takes a browser and returns an object that can be<br>called to make server calls:<br><br>    &gt;&gt;&gt; import zc.ajaxform.testing, pprint<br>    &gt;&gt;&gt; server = zc.ajaxform.testing.FormServer(browser)<br><br>    &gt;&gt;&gt; pprint.pprint(server('/calculator.html/echo_form',<br>    ...               {'a': 1.0}, b=[1, 2, 3], c=True, d='d', e=u'e\\u1234'<br>    ...               ), width=1)<br>    {u'a': u'1.0',<br>     u'b': [u'1',<br>            u'2',<br>            u'3'],<br>     u'c': u'1',<br>     u'd': u'd',<br>     u'e': u'e\\u1234'}<br><br>When we call the server, we pass a URL to invoke, which may be<br>relative, a optional dictionary of parameter values, and optional<br>keyword arguments.  <br><br>Note that the application will recieve data as strings, which is what<br>we see echoed back in the example above.<br><br>If the application is written using Zope, then we can enable Zope form<br>marshalling, by passing a True value when we create the server:<br><br>    &gt;&gt;&gt; server = zc.ajaxform.testing.FormServer(browser, True)<br>    &gt;&gt;&gt; pprint.pprint(server('/calculator.html/echo_form',<br>    ...               {'a': 1.0}, b=[1, 2, 3], c=True, d='d', e=u'e\\u1234'<br>    ...               ), width=1)<br>    {u'a': 1.0,<br>     u'b': [1,<br>            2,<br>            3],<br>     u'c': True,<br>     u'd': u'd',<br>     u'e': u'e\\u1234'}<br><br>    &gt;&gt;&gt; pprint.pprint(server('/calculator.html/add', {'value': 1}), width=1)<br>    {u'value': 1}<br><br>    &gt;&gt;&gt; pprint.pprint(server('/calculator.html/add', value=1), width=1)<br>    {u'value': 2}<br><br>The methods called are assumed to return JSON and the resulting data<br>is converted back into Python.<br><br>The function pprint method combines pprint and calling:<br><br>    &gt;&gt;&gt; server.pprint('/calculator.html/add', {'value': 1})<br>    {u'value': 3}<br><br>    &gt;&gt;&gt; server.pprint('/calculator.html/add', value=1)<br>    {u'value': 4}<br><br>    &gt;&gt;&gt; server.pprint('/calculator.html/echo_form',<br>    ...               {'a': 1.0}, b=[1, 2, 3], c=True, d='d', e=u'e\\u1234'<br>    ...               )<br>    {u'a': 1.0,<br>     u'b': [1,<br>            2,<br>            3],<br>     u'c': True,<br>     u'd': u'd',<br>     u'e': u'e\\u1234'}<br><br>In the future, there will be versions of these functions that send<br>data as JSON.<br><br>We can include file-upload data by including a 3-tuple with a file<br>name, a content type, and a data string:<br><br>    &gt;&gt;&gt; server.pprint('/calculator.html/echo_form',<br>    ...               b=[1, 2, 3], c=True, d='d',<br>    ...               file=('foo.xml', 'test/xml', '&lt;foo&gt;&lt;/foo&gt;'), <br>    ...               )<br>    {u'b': [1,<br>            2,<br>            3],<br>     u'c': True,<br>     u'd': u'd',<br>     u'file': u\"&lt;File upload name=u'foo.xml' content-type='test/xml' size=11&gt;\"}<br><br>as a convenience, you can pass a URL string to the server constructor,<br>which will create a browser for you that has opened that URL.  You can<br>also omit the brower and an unopened browser will be created.<br><br><br>    &gt;&gt;&gt; server = zc.ajaxform.testing.FormServer(<br>    ...     'http://localhost/calculator.html?login')<br>    &gt;&gt;&gt; server.browser.url<br>    'http://localhost/calculator.html?login'<br><br>    &gt;&gt;&gt; server.pprint('/calculator.html/echo_form', x=1)<br>    {u'x': u'1'}<br><br>    &gt;&gt;&gt; server = zc.ajaxform.testing.FormServer(zope_form_marshalling=True)<br>    &gt;&gt;&gt; server.browser.open('http://localhost/calculator.html?login')<br>    &gt;&gt;&gt; server.pprint('/calculator.html/echo_form', x=1)<br>    {u'x': 1}<br><br>In the example above, we didn't provide a browser, but we provided the<br>zope_form_marshalling flag as a keyword option.<br><br><br>.. Edge case: we can't traverse to undecorated methods:<br><br>    &gt;&gt;&gt; server.pprint('/calculator.html/do_add', value=1)<br>    Traceback (most recent call last):<br>    ...<br>    HTTPError: HTTP Error 404: Not Found<br><br><br>\"Library\" applications<br>======================<br><br>The \"application\" model described above is pretty appealing in its<br>simplicity -- at least to me. :)  Usually, we'd like to make out<br>applications a bit more flexible in their use.  In particular, we<br>often want to assemble applications together. At the Javascript level,<br>this often means having an application return a panel that can be used<br>in some higher-level layout.  At the server level, we need to provide<br>a way to access application logic within some larger context.  There<br>are two parts to this:<br><br>1. The containing application needs to support traversal to the<br>   sub-application.  <br><br>2. The subapplication needs to know how it was traversed to, at least<br>   if it generates URLs.  For example, the form machinery [#forms]_<br>   generates URLs for action handlers.<br><br>Sub-application should expose the URL needed to access then as a<br>base_href attribute. This is usually a relative URL relative to the base<br>application. <br><br>There are a number of classes defined in zc.ajaxform.application that<br>help with creating sub-applications:<br><br>SubApplication<br>    This class, which Application subclasses, provides traversal to<br>    attributes that provide IBrowserPublisher.  It also stamps<br>    IAjaxRequest on the request object when an object is traversed<br>    [#iajaxrequest]_ .<br><br>    (Maybe this request stamping should be done further down the<br>    traversal chain or perhaps only done if X-Requested-With is<br>    xmlhttprequest.)<br><br>PublicTraversable<br>    This class provides security declarations that allow objects to be<br>    traversable publically.  This is appropriate for sub-applications<br>    that want the same protections as the object being traversed.<br><br>Let's look at our calculator example as a subapplication:<br><br>::<br><br>  import zc.ajaxform.application<br>  import zope.exceptions<br>  <br>  class Container(zc.ajaxform.application.Application):<br>  <br>      resource_library_name = None<br>  <br>      @property<br>      def calc(self):<br>          return Calculator(self.context, self.request, base_href='calc')<br>  <br>  <br>  class Calculator(zc.ajaxform.application.Trusted,<br>                   zc.ajaxform.application.SubApplication,<br>                   zc.ajaxform.application.PublicTraversable,<br>                   ):<br>  <br>      @zc.ajaxform.application.jsonpage<br>      def operations(self):<br>          return [['add', self.base_href+'/add'],<br>                  ['add', self.base_href+'/subtract'],<br>                  ]<br>                  <br>      @zc.ajaxform.application.jsonpage<br>      def value(self):<br>          return dict(value=getattr(self.context, 'calculator_value', 0))<br>  <br>      def do_add(self, value):<br>          value += getattr(self.context, 'calculator_value', 0)<br>          self.context.calculator_value = value<br>          return dict(value=value)<br>      <br>      @zc.ajaxform.application.jsonpage<br>      def add(self, value):<br>          if not isinstance(value, int):<br>              return dict(error=\"The value must be an integer!\")<br>          return self.do_add(value)<br>      <br>      @zc.ajaxform.application.jsonpage<br>      def subtract(self, value):<br>          if not isinstance(value, int):<br>              raise zope.exceptions.UserError(<br>                  \"The value must be an integer!\")<br>          return self.do_add(-value)<br>  <br><br><br><br>Here, we've defined a container application that simply provides<br>traversal to a calculator subapplication as a static property.  It<br>creates the calculator with the application's context and request.  It<br>passes a base_href as a keyword argument, which SubApplication's<br>constructor accepts.  Our ZCML configuration is pretty simple:<br><br>::<br><br>  &lt;configure xmlns=\"http://namespaces.zope.org/zope\"&gt;<br>    &lt;include package=\"zope.app.component\" file=\"meta.zcml\" /&gt;<br>    &lt;adapter name=\"container.html\"<br>             factory=\"zc.ajaxform.calculator_subapplication_example.Container\"<br>             permission=\"zope.View\"<br>             /&gt;<br>  &lt;/configure&gt;<br><br><br><br>Using the container application, we access the calculator via the<br>container:<br><br>    &gt;&gt;&gt; server.pprint('http://localhost/@@container.html/calc/add', value=1)<br>    {u'value': 5}<br><br>We've updated the operations method to include the URL for each<br>operation, which is computed based on the base_href:<br><br>    &gt;&gt;&gt; server.pprint('http://localhost/@@container.html/calc/operations')<br>    [[u'add',<br>      u'calc/add'],<br>     [u'add',<br>      u'calc/subtract']]<br><br><br>Note that we didn't make any security declarations for the Calculator<br>class.  We're relying on the protection for the container.  If we<br>restart the browser, we see, indeed, that we can't access the<br>calculator:<br><br>    &gt;&gt;&gt; server = zc.ajaxform.testing.FormServer()<br>    &gt;&gt;&gt; server.pprint('http://localhost/@@container.html/calc/operations')<br>    {u'session_expired': True}<br><br>Dynamic Traversal<br>=================<br><br>In the previous example, we traversed to a sub-application using a<br>static property.  Sometimes, we need to traverse dynamically.  We<br>might have a container application with a variable number of<br>subapplications. Examples include a portlet container and a system for<br>managing user-defined data types.  In the later case, as users define<br>new data types, one or more applications get defined for each type.<br><br>zc.ajaxform.application provides a helper descriptor that allows custom<br>traversers to be implemented with simple Python methods.  Let's look<br>at a simple example.<br><br>    &gt;&gt;&gt; import zc.ajaxform.application   <br>    &gt;&gt;&gt; class Foo:<br>    ...     def __str__(self):<br>    ...         return 'a '+self.__class__.__name__<br>    ...<br>    ...     @zc.ajaxform.application.traverser<br>    ...     def demo_traverse(self, request, name):<br>    ...         return \"traverse: %s %s %s\" % (self, request, name)<br><br>This is a rather silly traverser for demonstration purposes that just<br>returnes a transformed name.<br><br>    &gt;&gt;&gt; foo = Foo()<br>    &gt;&gt;&gt; foo.demo_traverse.publishTraverse(\"a request\", \"xxx\")<br>    'traverse: a Foo a request xxx'<br><br>We can still call the method:<br><br>    &gt;&gt;&gt; foo.demo_traverse(\"a request\", \"xxx\")<br>    'traverse: a Foo a request xxx'<br><br>The method provides IBrowserPublisher:<br><br>    &gt;&gt;&gt; import zope.publisher.interfaces.browser<br>    &gt;&gt;&gt; zope.publisher.interfaces.browser.IBrowserPublisher.providedBy(<br>    ...     foo.demo_traverse)<br>    True<br><br>The descriptor has a security declaration that allows it to be<br>traversed but not called from untrusted code:<br><br>    &gt;&gt;&gt; import zope.security.checker<br>    &gt;&gt;&gt; checker = zope.security.checker.getChecker(<br>    ...     zope.security.checker.ProxyFactory(foo.demo_traverse))<br>    &gt;&gt;&gt; checker.get_permissions<br>    {'publishTraverse': Global(CheckerPublic,zope.security.checker)}<br><br>    &gt;&gt;&gt; checker.set_permissions<br>    {}<br><br>Acquisition<br>===========<br><br>Applications and sub-applications have __parent__ properties that<br>return their context.  This is to support frameworks that ise<br>__parent__ to perform acquisition.<br><br>   &gt;&gt;&gt; class MyApp(zc.ajaxform.application.Application):<br>   ...     pass<br><br>   &gt;&gt;&gt; myapp = MyApp(foo, None)<br>   &gt;&gt;&gt; myapp.__parent__ is foo<br>   True<br><br>   &gt;&gt;&gt; class MySubApp(zc.ajaxform.application.SubApplication):<br>   ...     pass<br><br>   &gt;&gt;&gt; mysubapp = MySubApp(foo, None)<br>   &gt;&gt;&gt; mysubapp.__parent__ is foo<br>   True<br><br><br>System Errors<br>=============<br><br>    System errors will be rendered as json.<br><br>    &gt;&gt;&gt; server = zc.ajaxform.testing.FormServer(<br>    ...     'http://localhost/calculator.html?login')<br>    &gt;&gt;&gt; server('/calculator.html/doh')<br>    Traceback (most recent call last):<br>    ...<br>    HTTPError: HTTP Error 500: Internal Server Error<br><br>    &gt;&gt;&gt; pprint.pprint(simplejson.loads(server.browser.contents), width=1)<br>    {u'error': u'TypeError: Doh!'}<br><br>.. [#ajax] Technically, these aren't really AJAX applications, since<br>   we rarely. if ever, use XML as a serialization format.  To<br>   emphasize this I'll use lower-case \"ajax\" to refer to the generic<br>   approach of making low-level calls from Javascript rather than<br>   doing page loads.<br><br>.. [#jsoninput] In the near future, there will also be support for<br>   JSON method input.  This will provide a number of benefits:<br><br>   - It will provide more automatic marshaling of non-string<br>     data. Now, we either have to de-marshal in the server application<br>     code or embed marshaling data into parameter names in client<br>     code.<br><br>   - It will allow richer data structures than is practical with form data.<br><br>   - It will probably allow faster ajax requests because:<br><br>     - Server-side de-marshalling is done with highly optimized code<br>       in simplejson.<br><br>     - We will assume that data passed are valid method arguments and<br>       avoid method introspection.<br><br>.. [#missing_resource_library_name] A custom attribute error message<br>   is used if this attribute is missing that tries to be more<br>   informative than the default attribute error.<br><br>.. [#sso]  For search-engine optimization, one generally wants a<br>   content page to actually contain its content.  If one depends on<br>   Javascript-enabled browsers, one can improve performance and<br>   search-engine optimization by adding ancilary data in Javascript,<br>   so as not to dilute the content.<br><br>.. [#forms] See form.txt.<br><br>.. [#iajaxrequest] Traversing into a subapplication adds IAjaxRequest to the<br>   list of interfaces provided by the request.<br><br>    &gt;&gt;&gt; import zc.ajaxform.application<br>    &gt;&gt;&gt; import zc.ajaxform.interfaces<br>    &gt;&gt;&gt; import zope.publisher.browser<br>    &gt;&gt;&gt; request = zope.publisher.browser.TestRequest()<br>    &gt;&gt;&gt; class SubApp(zc.ajaxform.application.SubApplication):<br>    ...      @zc.ajaxform.application.jsonpage<br>    ...      def foo(self):<br>    ...          return 'bar'<br>    &gt;&gt;&gt; subapp = SubApp(object(), request)<br><br>  Now let's try traversing into the subapplication:<br><br>    &gt;&gt;&gt; zc.ajaxform.interfaces.IAjaxRequest.providedBy(request)<br>    False<br>    &gt;&gt;&gt; subapp.publishTraverse(request, 'foo')()<br>    '\"bar\"'<br>    &gt;&gt;&gt; zc.ajaxform.interfaces.IAjaxRequest.providedBy(request)<br>    True<br><br>  Note that the request keeps any provided interfaces:<br><br>    &gt;&gt;&gt; request = zope.publisher.browser.TestRequest()<br>    &gt;&gt;&gt; class IMyInterface(zope.interface.Interface):<br>    ...     pass<br>    &gt;&gt;&gt; zope.interface.directlyProvides(request, IMyInterface)<br>    &gt;&gt;&gt; subapp.publishTraverse(request, 'foo')()<br>    '\"bar\"'<br>    &gt;&gt;&gt; IMyInterface.providedBy(request)<br>    True<br><br><br>System Error Logging<br>====================<br><br>When an error is generated, zope.app.publishing checks to see if the<br>error handler provides the System Error interface. If so, zope.app.publishing<br>logs the error.<br><br>Rather than use this indirect method of logging, there is an explicit<br>statement in ExceptionView that imports the logging module and logs and error<br>itself. We can test this with the zope.testing.loggingsupport functions.<br><br>    First we set up loggingsupport. This keeps track of all error messages<br>    written via the module passed as the parameter. In this case, zc.ajaxform.<br><br>    &gt;&gt;&gt; import logging<br>    &gt;&gt;&gt; import zope.testing.loggingsupport<br>    &gt;&gt;&gt; log_handler = zope.testing.loggingsupport.InstalledHandler('zc.ajaxform')<br><br>    Then we create an error.<br><br>    &gt;&gt;&gt; server = zc.ajaxform.testing.FormServer(<br>    ...     'http://localhost/calculator.html?login')<br>    &gt;&gt;&gt; server('/calculator.html/doh')<br>    Traceback (most recent call last):<br>    ...<br>    HTTPError: HTTP Error 500: Internal Server Error<br><br>    ...And check to see that it was logged.<br><br>    &gt;&gt;&gt; print log_handler<br>    zc.ajaxform.application ERROR<br>      SysError created by zc.ajaxform<br><br>Form Processing<br>===============<br><br>zc.ajaxform.form provides support for server-generated forms based on<br>the zope.formlib library.<br><br>Forms are meant to be used as parts of larger applications.  A form<br>provides output of JSON data for building javascript forms.  Forms also<br>provide validation and call actions with validated data to perform<br>actions on form submit.<br><br>To create a form, just create a form class as a subclass of<br>zc.ajaxform.form.Form. This base class provides:<br><br>- an ajax __call__ method that returns a form definition,<br><br>- traversal to form actions, in much the same way that<br>  zc.ajaxform.application.Application [#application]_ provides traversal<br>  to json methods,<br><br>- a definitions method that can be used by ajax methods to get a form<br>  definition as Python data, and<br><br>- a getObjectData method for getting initial form data from an<br>  existing object.<br><br>Here's a simple example:<br><br>::<br><br>  import zc.ajaxform.application<br>  import zc.ajaxform.interfaces<br>  import zc.ajaxform.widgets<br>  import zc.ajaxform.form<br>  import zope.component<br>  import zope.interface<br>  import zope.formlib<br>  import zope.schema<br>  <br>  class IAddress(zope.interface.Interface):<br>  <br>      street = zope.schema.TextLine(<br>          title = u\"Street\",<br>          description = u\"The street\",<br>          )<br>  <br>      city = zope.schema.TextLine(<br>          title = u\"City\",<br>          description = u\"The city\",<br>          )<br>  <br>      awesomeness = zope.schema.Int(<br>          title = u\"Awesomeness\",<br>          description = u\"The awesomeness on a scale of 1 to 10\",<br>          min = 1,<br>          max = 10,<br>          )<br>  <br>  <br>  class Pets(zc.sourcefactory.basic.BasicSourceFactory):<br>  <br>      def getValues(self):<br>          return (u'Dog', u'Cat', u'Fish')<br>  <br>  <br>  class Pet(zope.schema.TextLine):<br>      \"\"\"A textline representing a pet.<br>  <br>      This is just a textline, but we also have a source of common pets that<br>      the user can choose from.<br>      \"\"\"<br>  <br>  class IPerson(zope.interface.Interface):<br>  <br>      first_name = zope.schema.TextLine(<br>          title = u\"First name\",<br>          description = u\"Given name.\",<br>          default= u'Happy'<br>          )<br>  <br>      last_name = zope.schema.TextLine(<br>          title = u\"Last name\",<br>          description = u\"Family name.\",<br>          default= u'Camper'<br>          )<br>  <br>      favorite_color = zope.schema.TextLine(<br>          title = u\"Favorite color\",<br>          required = False,<br>          default= u'Blue'<br>          )<br>  <br>      age = zope.schema.Int(<br>          title = u\"Age\",<br>          description = u\"Age in years\",<br>          min = 0,<br>          max = 200,<br>          default= 23<br>          )<br>  <br>      happy = zope.schema.Bool(<br>          title = u\"Happy\",<br>          description = u\"Are they happy?\",<br>          default= True<br>          )<br>  <br>      pet = Pet(<br>          title=u'Pet',<br>          description=u'This person\\'s best friend.',<br>          required=False,<br>          )<br>  <br>      temperment = zope.schema.Choice(<br>          title = u\"Temperment\",<br>          description = u\"What is the person like?\",<br>          values = ['Nice', 'Mean', 'Ornery', 'Right Neighborly'],<br>          default = u'Right Neighborly'<br>          )<br>  <br>      weight = zope.schema.Decimal(<br>          title = u\"Weight\",<br>          description = u\"Weight in lbs?\"<br>          )<br>  <br>      description = zope.schema.Text(<br>          title = u\"Description\",<br>          description = u\"What do they look like?\",<br>          default = u'10ft tall\\nRazor sharp scales.'<br>          )<br>  <br>      secret = zope.schema.TextLine(<br>          title = u\"Secret Key\",<br>          description = u\"Don't tell anybody\",<br>          default = u'5ecret sauce'<br>          )<br>  <br>      siblings = zope.schema.Int(<br>          title = u\"Siblings\",<br>          description = u\"Number of siblings\",<br>          min = 0,<br>          max = 8,<br>          default = 1<br>          )<br>  <br>      addresses = zope.schema.List(<br>          title = u'Addresses',<br>          description = u\"All my wonderful homes\",<br>          value_type = zope.schema.Object(schema=IAddress),<br>          default= [{'street':'123 fake street',<br>                     'city': 'fakeville',<br>                     'awesomeness': '9'},<br>                    {'street':'345 false street',<br>                     'city': 'falsetown',<br>                     'awesomeness': '9001'}<br>                   ]<br>          )<br>  <br>      other = zope.schema.Text(<br>          title = u\"Other\",<br>          description = u\"Any other notes\",<br>          default = u\"I've got a magic toenail\"<br>          )<br>  <br>  class Person:<br>  <br>      zope.interface.implements(IPerson)<br>  <br>      def __init__(self, first_name, last_name, favorite_color, age, happy,<br>                   pet, temperment, weight, description, secret, siblings,<br>                   addresses, other):<br>          self.first_name = first_name<br>          self.last_name = last_name<br>          self.favorite_color = favorite_color<br>          self.age = age<br>          self.happy = happy<br>          self.pet = pet<br>          self.temperment = temperment<br>          self.weight = weight<br>          self.description = description<br>          self.secret = secret<br>          self.siblings = siblings<br>          self.addresses = addresses<br>          self.other = other<br>  <br>  <br>  class FormExample(zc.ajaxform.application.Application):<br>  <br>      resource_library_name = None<br>  <br>      class ExampleForm(zc.ajaxform.form.Form):<br>  <br>          leftFields = ('first_name', 'last_name', 'age', 'other')<br>          form_fields = zope.formlib.form.Fields(IPerson)<br>          form_fields['secret'].custom_widget = zc.ajaxform.widgets.Hidden<br>          form_fields['siblings'].custom_widget = zc.ajaxform.widgets.NumberSpinner<br>  <br>          @zope.formlib.form.action(\"Register\")<br>          def register(self, action, data):<br>              person = Person(**data)<br>              return dict(<br>                  data = data,<br>                  self_class_name = self.__class__.__name__,<br>                  self_app_class_name = self.app.__class__.__name__,<br>                  self_context_class_name = self.context.__class__.__name__<br>                  )<br>  <br>  <br>  class PetWidget(zc.ajaxform.widgets.ComboBox):<br>      zope.component.adapts(<br>          Pet,<br>          zc.ajaxform.interfaces.IAjaxRequest)<br>      zope.interface.implements(<br>          zc.ajaxform.interfaces.IInputWidget)<br>  <br>      def __init__(self, context, request):<br>          super(PetWidget, self).__init__(context, Pets(), request)<br><br><br><br>Note that we've nested our form definition in an application.  We can<br>define the form class elsewhere and use it, but if a form is only used<br>in an application, then it's often easiest to define it within an<br>application class.  Forms are instantiated by calling them with a<br>single argument.  This argument, the application, becomes the form's `app`<br>attribute.  The application's context becomes the form's context.  Form<br>classes are automatically instantiated when a form class is assigned to<br>an attribute in a class and accessed through an instance<br>[#form_classes_are_descriptors]_.<br><br>Let's try accessing our form, which can be found in its python form<br>in form_example.py:<br><br>    &gt;&gt;&gt; import zope.testbrowser.testing<br>    &gt;&gt;&gt; from zc.ajaxform.testing import call_form, print_form<br>    &gt;&gt;&gt; browser = zope.testbrowser.testing.Browser()<br>    &gt;&gt;&gt; browser.open('http://localhost/form.html?login')<br>    &gt;&gt;&gt; print_form(browser, 'http://localhost/form.html/ExampleForm')<br>    {u'definition': {u'actions': [{u'label': u'Register',<br>                                   u'name': u'ExampleForm.actions.register',<br>                                   u'url': u'ExampleForm/register'}],<br>                     u'left_fields': {u'addresses': False,<br>                                      u'age': True,<br>                                      u'description': False,<br>                                      u'favorite_color': False,<br>                                      u'first_name': True,<br>                                      u'happy': False,<br>                                      u'last_name': True,<br>                                      u'other': True,<br>                                      u'pet': False,<br>                                      u'secret': False,<br>                                      u'siblings': False,<br>                                      u'temperment': False,<br>                                      u'weight': False},<br>                     u'prefix': u'ExampleForm',<br>                     u'widgets': [{u'fieldHint': u'Given name.',<br>                                   u'fieldLabel': u'First name',<br>                                   u'id': u'first_name',<br>                                   u'minLength': 0,<br>                                   u'name': u'first_name',<br>                                   u'required': True,<br>                                   u'value': u'Happy',<br>                                   u'widget_constructor': u'zope.schema.TextLine'},<br>                                  {u'fieldHint': u'Family name.',<br>                                   u'fieldLabel': u'Last name',<br>                                   u'id': u'last_name',<br>                                   u'minLength': 0,<br>                                   u'name': u'last_name',<br>                                   u'required': True,<br>                                   u'value': u'Camper',<br>                                   u'widget_constructor': u'zope.schema.TextLine'},<br>                                  {u'fieldHint': u'',<br>                                   u'fieldLabel': u'Favorite color',<br>                                   u'id': u'favorite_color',<br>                                   u'minLength': 0,<br>                                   u'name': u'favorite_color',<br>                                   u'required': False,<br>                                   u'value': u'Blue',<br>                                   u'widget_constructor': u'zope.schema.TextLine'},<br>                                  {u'allowBlank': False,<br>                                   u'fieldHint': u'Age in years',<br>                                   u'fieldLabel': u'Age',<br>                                   u'field_max': 200,<br>                                   u'field_min': 0,<br>                                   u'id': u'age',<br>                                   u'name': u'age',<br>                                   u'required': True,<br>                                   u'value': u'23',<br>                                   u'widget_constructor': u'zope.schema.Int'},<br>                                  {u'fieldHint': u'Are they happy?',<br>                                   u'fieldLabel': u'Happy',<br>                                   u'id': u'happy',<br>                                   u'name': u'happy',<br>                                   u'required': True,<br>                                   u'value': True,<br>                                   u'widget_constructor': u'zope.schema.Bool'},<br>                                  {u'fieldHint': u\"This person's best friend.\",<br>                                   u'fieldLabel': u'Pet',<br>                                   u'id': u'pet',<br>                                   u'name': u'pet',<br>                                   u'required': False,<br>                                   u'values': [[u'c935d187f0b998ef720390f85014ed1e',<br>                                                u'Dog'],<br>                                               [u'fa3ebd6742c360b2d9652b7f78d9bd7d',<br>                                                u'Cat'],<br>                                               [u'071642fa72ba780ee90ed36350d82745',<br>                                                u'Fish']],<br>                                   u'widget_constructor': u'zc.ajaxform.widgets.ComboBox'},<br>                                  {u'allowBlank': False,<br>                                   u'fieldHint': u'What is the person like?',<br>                                   u'fieldLabel': u'Temperment',<br>                                   u'hiddenName': u'temperment.value',<br>                                   u'id': u'temperment',<br>                                   u'name': u'temperment',<br>                                   u'required': True,<br>                                   u'value': u'Right Neighborly',<br>                                   u'values': [[u'Nice',<br>                                                u'Nice'],<br>                                               [u'Mean',<br>                                                u'Mean'],<br>                                               [u'Ornery',<br>                                                u'Ornery'],<br>                                               [u'Right Neighborly',<br>                                                u'Right Neighborly']],<br>                                   u'widget_constructor': u'zope.schema.Choice'},<br>                                  {u'allowBlank': False,<br>                                   u'fieldHint': u'Weight in lbs?',<br>                                   u'fieldLabel': u'Weight',<br>                                   u'id': u'weight',<br>                                   u'name': u'weight',<br>                                   u'required': True,<br>                                   u'widget_constructor': u'zope.schema.Decimal'},<br>                                  {u'fieldHint': u'What do they look like?',<br>                                   u'fieldLabel': u'Description',<br>                                   u'id': u'description',<br>                                   u'minLength': 0,<br>                                   u'name': u'description',<br>                                   u'required': True,<br>                                   u'value': u'10ft tall\\nRazor sharp scales.',<br>                                   u'widget_constructor': u'zope.schema.Text'},<br>                                  {u'fieldHint': u\"Don't tell anybody\",<br>                                   u'fieldLabel': u'Secret Key',<br>                                   u'id': u'secret',<br>                                   u'name': u'secret',<br>                                   u'required': True,<br>                                   u'value': u'5ecret sauce',<br>                                   u'widget_constructor': u'zc.ajaxform.widgets.Hidden'},<br>                                  {u'allowBlank': False,<br>                                   u'fieldHint': u'Number of siblings',<br>                                   u'fieldLabel': u'Siblings',<br>                                   u'field_max': 8,<br>                                   u'field_min': 0,<br>                                   u'id': u'siblings',<br>                                   u'name': u'siblings',<br>                                   u'required': True,<br>                                   u'value': u'1',<br>                                   u'widget_constructor': u'zc.ajaxform.widgets.NumberSpinner'},<br>                                  {u'fieldHint': u'All my wonderful homes',<br>                                   u'fieldLabel': u'Addresses',<br>                                   u'id': u'addresses',<br>                                   u'name': u'addresses',<br>                                   u'record_schema': {u'readonly': False,<br>                                                      u'widgets': [{u'fieldHint': u'The street',<br>                                                                    u'fieldLabel': u'Street',<br>                                                                    u'id': u'street',<br>                                                                    u'minLength': 0,<br>                                                                    u'name': u'street',<br>                                                                    u'required': True,<br>                                                                    u'widget_constructor': u'zope.schema.TextLine'},<br>                                                                   {u'fieldHint': u'The city',<br>                                                                    u'fieldLabel': u'City',<br>                                                                    u'id': u'city',<br>                                                                    u'minLength': 0,<br>                                                                    u'name': u'city',<br>                                                                    u'required': True,<br>                                                                    u'widget_constructor': u'zope.schema.TextLine'},<br>                                                                   {u'allowBlank': False,<br>                                                                    u'fieldHint': u'The awesomeness on a scale of 1 to 10',<br>                                                                    u'fieldLabel': u'Awesomeness',<br>                                                                    u'field_max': 10,<br>                                                                    u'field_min': 1,<br>                                                                    u'id': u'awesomeness',<br>                                                                    u'name': u'awesomeness',<br>                                                                    u'required': True,<br>                                                                    u'widget_constructor': u'zope.schema.Int'}]},<br>                                   u'required': True,<br>                                   u'value': [{u'awesomeness': u'9',<br>                                               u'city': u'fakeville',<br>                                               u'street': u'123 fake street'},<br>                                              {u'awesomeness': u'9001',<br>                                               u'city': u'falsetown',<br>                                               u'street': u'345 false street'}],<br>                                   u'widget_constructor': u'zope.schema.List'},<br>                                  {u'fieldHint': u'Any other notes',<br>                                   u'fieldLabel': u'Other',<br>                                   u'id': u'other',<br>                                   u'minLength': 0,<br>                                   u'name': u'other',<br>                                   u'required': True,<br>                                   u'value': u\"I've got a magic toenail\",<br>                                   u'widget_constructor': u'zope.schema.Text'}]}}<br><br>Our application is at: \"http://localhost/form.html\". The form is<br>exposed as an ajax method named \"ExampleForm\", which comes from the attribute<br>name in the class definition.<br><br>The form definition contains both action definitions and widget<br>definitions. The widget definitions may be full js field definitions<br>or name a widget_constructor, which is a Javascript helper provided by<br>the zc.ajaxform resource library that provides additional information,<br>like Javascript validators, that can't be expressed in JSON.<br><br>There is an action definition for each action defined in the form.  The<br>action information includes the url to post the result to, relative to<br>the application.<br><br>Note that the name of the form class is used as the form prefix and<br>that the form prefix is used as the prefix for widget and action names<br>and ids [#actionids]_.<br><br>Let's post a result back:<br><br>    &gt;&gt;&gt; print_form(browser, 'http://localhost/form.html/ExampleForm/register',<br>    ...            {'first_name': 'Bob',<br>    ...             'last_name': '',<br>    ...             'favorite_color': '',<br>    ...             'age': '-1',<br>    ...             })<br>    {u'errors': {u'addresses': u'Addresses: Missing Input',<br>                 u'age': u'Value is too small',<br>                 u'description': u'Description: Missing Input',<br>                 u'last_name': u'Last name: Missing Input',<br>                 u'other': u'Other: Missing Input',<br>                 u'secret': u'Secret Key: Missing Input',<br>                 u'siblings': u'Siblings: Missing Input',<br>                 u'temperment': u'Temperment: Missing Input',<br>                 u'weight': u'Weight: Missing Input'}}<br><br>The result had 9 problems:<br><br>- We didn't provide a last name, description, secret key,<br>  number of siblings, temperment, or weight, which are all required<br><br>- In the form we did not specify deleting either of our two current<br>  address records, but also ommitted their data, and the first of them<br>  reported a missing field. Following this we will delete them both and<br>  add a new record.<br><br>- We specified an invalid age.<br><br>Let's pass valid data:<br><br>    &gt;&gt;&gt; print_form(browser, 'http://localhost/form.html/ExampleForm/register',<br>    ...            {'first_name': 'Bob',<br>    ...             'last_name': 'Zope',<br>    ...             'favorite_color': '',<br>    ...             'age': '11',<br>    ...             'addresses.street.0': '123 Fake Ln.',<br>    ...             'addresses.city.0': 'Fakeville',<br>    ...             'addresses.awesomeness.0': 7,<br>    ...             'description': 'Hello',<br>    ...             'other': 'So nice to meet you',<br>    ...             'secret': 'Oh nothing',<br>    ...             'siblings': 1,<br>    ...             'temperment': 'Nice',<br>    ...             'weight': '170.5',<br>    ...             'pet': 'Carrier Pigeon'<br>    ...             })<br>    {u'data': {u'addresses': [{u'awesomeness': 7,<br>                               u'city': u'Fakeville',<br>                               u'street': u'123 Fake Ln.'}],<br>               u'age': 11,<br>               u'description': u'Hello',<br>               u'favorite_color': u'',<br>               u'first_name': u'Bob',<br>               u'happy': False,<br>               u'last_name': u'Zope',<br>               u'other': u'So nice to meet you',<br>               u'pet': u'Carrier Pigeon',<br>               u'secret': u'Oh nothing',<br>               u'siblings': 1,<br>               u'temperment': u'Nice',<br>               u'weight': u'170.5'},<br>     u'self_app_class_name': u'FormExample',<br>     u'self_class_name': u'ExampleForm',<br>     u'self_context_class_name': u'Folder'}<br><br>Here we get a successful result.  Our contrived action in the example<br>simply echoed back the data it was passed,  Note, in particular that:<br><br>- the data keys have the form prefix removed, and<br><br>- the value of the age key is an integer, since the field was an<br>  integer field.<br><br>Note that for the list field, the original request added a prefix of the list<br>field name to prevent collisions with a field with the same name in another<br>list field (if it existed).<br><br>The action also prints out the classes of its self argument, its app<br>and its context. Actions are methods of forms so their `self` argument is the<br>form. The form's `app` is the app through which it is accessed and<br>`context` is the app's context.<br><br>For list widgets if a field in its record is missing and it is required, the<br>error reported lists the field name:<br><br>    &gt;&gt;&gt; print_form(browser, 'http://localhost/form.html/ExampleForm/register',<br>    ...            {'first_name': 'Bob',<br>    ...             'last_name': 'Zope',<br>    ...             'favorite_color': '',<br>    ...             'age': '11',<br>    ...             'addresses.street.0': '123 Fake Ln.',<br>    ...             'addresses.city.0': 'Fakeville',<br>    ...             'addresses.awesomeness.0': 7,<br>    ...             'addresses.street.1': 'The 2nd Missing field St.',<br>    ...             'addresses.awesomeness.1': 3,<br>    ...             'description': 'Hello',<br>    ...             'other': 'So nice to meet you',<br>    ...             'secret': 'Oh nothing',<br>    ...             'siblings': 1,<br>    ...             'temperment': 'Nice',<br>    ...             'weight': '170.5',<br>    ...             'pet': 'Carrier Pigeon'<br>    ...             })<br>    {u'errors': {u'addresses': u'City: Missing Input'}}<br><br>Let's provide this value now:<br><br>    &gt;&gt;&gt; print_form(browser, 'http://localhost/form.html/ExampleForm/register',<br>    ...            {'first_name': 'Bob',<br>    ...             'last_name': 'Zope',<br>    ...             'favorite_color': '',<br>    ...             'age': '11',<br>    ...             'addresses.street.0': '123 Fake Ln.',<br>    ...             'addresses.city.0': 'Fakeville',<br>    ...             'addresses.awesomeness.0': 7,<br>    ...             'addresses.street.1': 'The 2nd Missing field St.',<br>    ...             'addresses.city.1': 'A Void',<br>    ...             'addresses.awesomeness.1': '3',<br>    ...             'description': 'Hello',<br>    ...             'other': 'So nice to meet you',<br>    ...             'secret': 'Oh nothing',<br>    ...             'siblings': 1,<br>    ...             'temperment': 'Nice',<br>    ...             'weight': '170.5',<br>    ...             'pet': 'Carrier Pigeon'<br>    ...             })<br>    {u'data': {u'addresses': [{u'awesomeness': 7,<br>                               u'city': u'Fakeville',<br>                               u'street': u'123 Fake Ln.'},<br>                              {u'awesomeness': 3,<br>                               u'city': u'A Void',<br>                               u'street': u'The 2nd Missing field St.'}],<br>               u'age': 11,<br>               u'description': u'Hello',<br>               u'favorite_color': u'',<br>               u'first_name': u'Bob',<br>               u'happy': False,<br>               u'last_name': u'Zope',<br>               u'other': u'So nice to meet you',<br>               u'pet': u'Carrier Pigeon',<br>               u'secret': u'Oh nothing',<br>               u'siblings': 1,<br>               u'temperment': u'Nice',<br>               u'weight': u'170.5'},<br>     u'self_app_class_name': u'FormExample',<br>     u'self_class_name': u'ExampleForm',<br>     u'self_context_class_name': u'Folder'}<br><br><br>Reordering items in a list is accomplished by reordering the suffix for the<br>record fields:<br><br>    &gt;&gt;&gt; print_form(browser, 'http://localhost/form.html/ExampleForm/register',<br>    ...            {'first_name': 'Bob',<br>    ...             'last_name': 'Zope',<br>    ...             'favorite_color': '',<br>    ...             'age': '11',<br>    ...             'addresses.street.1': '123 Fake Ln.',<br>    ...             'addresses.city.1': 'Fakeville',<br>    ...             'addresses.awesomeness.1': 7,<br>    ...             'addresses.street.0': 'The 2nd Missing field St.',<br>    ...             'addresses.city.0': 'A Void',<br>    ...             'addresses.awesomeness.0': 3,<br>    ...             'description': 'Hello',<br>    ...             'other': 'So nice to meet you',<br>    ...             'secret': 'Oh nothing',<br>    ...             'siblings': 1,<br>    ...             'temperment': 'Nice',<br>    ...             'weight': '170.5',<br>    ...             'pet': 'Carrier Pigeon'<br>    ...             })<br>    {u'data': {u'addresses': [{u'awesomeness': 3,<br>                               u'city': u'A Void',<br>                               u'street': u'The 2nd Missing field St.'},<br>                              {u'awesomeness': 7,<br>                               u'city': u'Fakeville',<br>                               u'street': u'123 Fake Ln.'}],<br>               u'age': 11,<br>               u'description': u'Hello',<br>               u'favorite_color': u'',<br>               u'first_name': u'Bob',<br>               u'happy': False,<br>               u'last_name': u'Zope',<br>               u'other': u'So nice to meet you',<br>               u'pet': u'Carrier Pigeon',<br>               u'secret': u'Oh nothing',<br>               u'siblings': 1,<br>               u'temperment': u'Nice',<br>               u'weight': u'170.5'},<br>     u'self_app_class_name': u'FormExample',<br>     u'self_class_name': u'ExampleForm',<br>     u'self_context_class_name': u'Folder'}<br><br><br><br>Getting definitions from Python<br>-------------------------------<br><br>Sometimes we want to get form definitions from Python.  The form<br>__call__ method returns a JSON string.  We can get Python data by<br>calling get_definition.<br><br>    &gt;&gt;&gt; import zc.ajaxform.form_example<br>    &gt;&gt;&gt; import zope.publisher.browser<br>    &gt;&gt;&gt; request = zope.publisher.browser.TestRequest()<br>    &gt;&gt;&gt; import zc.ajaxform.interfaces<br>    &gt;&gt;&gt; import zope.interface<br>    &gt;&gt;&gt; zope.interface.alsoProvides(<br>    ...     request, zc.ajaxform.interfaces.IAjaxRequest)<br>    &gt;&gt;&gt; ex = zc.ajaxform.form_example.FormExample(None, request)<br>    &gt;&gt;&gt; from pprint import pprint<br>    &gt;&gt;&gt; pprint(ex.ExampleForm.get_definition(), width=1)<br>    {'actions': [{'label': 'Register',<br>                  'name': u'ExampleForm.actions.register',<br>                  'url': u'ExampleForm/register'}],<br>     'left_fields': {'addresses': False,<br>                     'age': True,<br>                     'description': False,<br>                     'favorite_color': False,<br>                     'first_name': True,<br>                     'happy': False,<br>                     'last_name': True,<br>                     'other': True,<br>                     'pet': False,<br>                     'secret': False,<br>                     'siblings': False,<br>                     'temperment': False,<br>                     'weight': False},<br>     'prefix': 'ExampleForm',<br>     'widgets': [{'fieldHint': u'Given name.',<br>                  'fieldLabel': u'First name',<br>                  'id': 'first_name',<br>                  'minLength': 0,<br>                  'name': 'first_name',<br>                  'required': True,<br>                  'value': u'Happy',<br>                  'widget_constructor': 'zope.schema.TextLine'},<br>                 {'fieldHint': u'Family name.',<br>                  'fieldLabel': u'Last name',<br>                  'id': 'last_name',<br>                  'minLength': 0,<br>                  'name': 'last_name',<br>                  'required': True,<br>                  'value': u'Camper',<br>                  'widget_constructor': 'zope.schema.TextLine'},<br>                 {'fieldHint': u'',<br>                  'fieldLabel': u'Favorite color',<br>                  'id': 'favorite_color',<br>                  'minLength': 0,<br>                  'name': 'favorite_color',<br>                  'required': False,<br>                  'value': u'Blue',<br>                  'widget_constructor': 'zope.schema.TextLine'},<br>                 {'allowBlank': False,<br>                  'fieldHint': u'Age in years',<br>                  'fieldLabel': u'Age',<br>                  'field_max': 200,<br>                  'field_min': 0,<br>                  'id': 'age',<br>                  'name': 'age',<br>                  'required': True,<br>                  'value': u'23',<br>                  'widget_constructor': 'zope.schema.Int'},<br>                 {'fieldHint': u'Are they happy?',<br>                  'fieldLabel': u'Happy',<br>                  'id': 'happy',<br>                  'name': 'happy',<br>                  'required': True,<br>                  'value': True,<br>                  'widget_constructor': 'zope.schema.Bool'},<br>                 {'fieldHint': u\"This person's best friend.\",<br>                  'fieldLabel': u'Pet',<br>                  'id': 'pet',<br>                  'name': 'pet',<br>                  'required': False,<br>                  'values': [['c935d187f0b998ef720390f85014ed1e',<br>                              u'Dog'],<br>                             ['fa3ebd6742c360b2d9652b7f78d9bd7d',<br>                              u'Cat'],<br>                             ['071642fa72ba780ee90ed36350d82745',<br>                              u'Fish']],<br>                  'widget_constructor': 'zc.ajaxform.widgets.ComboBox'},<br>                 {'allowBlank': False,<br>                  'fieldHint': u'What is the person like?',<br>                  'fieldLabel': u'Temperment',<br>                  'hiddenName': 'temperment.value',<br>                  'id': 'temperment',<br>                  'name': 'temperment',<br>                  'required': True,<br>                  'value': 'Right Neighborly',<br>                  'values': [['Nice',<br>                              u'Nice'],<br>                             ['Mean',<br>                              u'Mean'],<br>                             ['Ornery',<br>                              u'Ornery'],<br>                             ['Right Neighborly',<br>                              u'Right Neighborly']],<br>                  'widget_constructor': 'zope.schema.Choice'},<br>                 {'allowBlank': False,<br>                  'fieldHint': u'Weight in lbs?',<br>                  'fieldLabel': u'Weight',<br>                  'id': 'weight',<br>                  'name': 'weight',<br>                  'required': True,<br>                  'widget_constructor': 'zope.schema.Decimal'},<br>                 {'fieldHint': u'What do they look like?',<br>                  'fieldLabel': u'Description',<br>                  'id': 'description',<br>                  'minLength': 0,<br>                  'name': 'description',<br>                  'required': True,<br>                  'value': u'10ft tall\\nRazor sharp scales.',<br>                  'widget_constructor': 'zope.schema.Text'},<br>                 {'fieldHint': u\"Don't tell anybody\",<br>                  'fieldLabel': u'Secret Key',<br>                  'id': 'secret',<br>                  'name': 'secret',<br>                  'required': True,<br>                  'value': u'5ecret sauce',<br>                  'widget_constructor': 'zc.ajaxform.widgets.Hidden'},<br>                 {'allowBlank': False,<br>                  'fieldHint': u'Number of siblings',<br>                  'fieldLabel': u'Siblings',<br>                  'field_max': 8,<br>                  'field_min': 0,<br>                  'id': 'siblings',<br>                  'name': 'siblings',<br>                  'required': True,<br>                  'value': u'1',<br>                  'widget_constructor': 'zc.ajaxform.widgets.NumberSpinner'},<br>                 {'fieldHint': u'All my wonderful homes',<br>                  'fieldLabel': u'Addresses',<br>                  'id': 'addresses',<br>                  'name': 'addresses',<br>                  'record_schema': {'readonly': False,<br>                                    'widgets': [{'fieldHint': u'The street',<br>                                                 'fieldLabel': u'Street',<br>                                                 'id': 'street',<br>                                                 'minLength': 0,<br>                                                 'name': 'street',<br>                                                 'required': True,<br>                                                 'widget_constructor': 'zope.schema.TextLine'},<br>                                                {'fieldHint': u'The city',<br>                                                 'fieldLabel': u'City',<br>                                                 'id': 'city',<br>                                                 'minLength': 0,<br>                                                 'name': 'city',<br>                                                 'required': True,<br>                                                 'widget_constructor': 'zope.schema.TextLine'},<br>                                                {'allowBlank': False,<br>                                                 'fieldHint': u'The awesomeness on a scale of 1 to 10',<br>                                                 'fieldLabel': u'Awesomeness',<br>                                                 'field_max': 10,<br>                                                 'field_min': 1,<br>                                                 'id': 'awesomeness',<br>                                                 'name': 'awesomeness',<br>                                                 'required': True,<br>                                                 'widget_constructor': 'zope.schema.Int'}]},<br>                  'required': True,<br>                  'value': [{'awesomeness': u'9',<br>                             'city': u'fakeville',<br>                             'street': u'123 fake street'},<br>                            {'awesomeness': u'9001',<br>                             'city': u'falsetown',<br>                             'street': u'345 false street'}],<br>                  'widget_constructor': 'zope.schema.List'},<br>                 {'fieldHint': u'Any other notes',<br>                  'fieldLabel': u'Other',<br>                  'id': 'other',<br>                  'minLength': 0,<br>                  'name': 'other',<br>                  'required': True,<br>                  'value': u\"I've got a magic toenail\",<br>                  'widget_constructor': 'zope.schema.Text'}]}<br><br>Note that we had to stamp the request with IAjaxRequest.  This is done<br>during application traversal.  We need it so widgets can get looked<br>up.<br><br><br>Base and prefix<br>---------------<br><br>Forms have base_href and prefix variables.  The base_href is used to compute<br>URLs for form actions.  A form's base_href defaults to its class name.<br>The form's base_href also includes the base_href of its app, if its app has<br>a base_href. This is useful for sub-applications. Let's give our sample<br>application a base_href attribute as if it were a sub-application:<br><br>    &gt;&gt;&gt; ex = zc.ajaxform.form_example.FormExample(None, request)<br>    &gt;&gt;&gt; ex.base_href = 'sample'<br>    &gt;&gt;&gt; ex.ExampleForm.base_href<br>    'sample/ExampleForm'<br><br>    &gt;&gt;&gt; pprint(ex.ExampleForm.get_definition(), width=1)<br>    {'actions': [{'label': 'Register',<br>                  'name': u'sample.ExampleForm.actions.register',<br>                  'url': u'sample/ExampleForm/register'}],<br>     'left_fields': {'addresses': False,<br>                     'age': True,<br>                     'description': False,<br>                     'favorite_color': False,<br>                     'first_name': True,<br>                     'happy': False,<br>                     'last_name': True,<br>                     'other': True,<br>                     'pet': False,<br>                     'secret': False,<br>                     'siblings': False,<br>                     'temperment': False,<br>                     'weight': False},<br>     'prefix': 'sample.ExampleForm',<br>     'widgets': [{'fieldHint': u'Given name.',<br>                  'fieldLabel': u'First name',<br>                  'id': 'first_name',<br>                  'minLength': 0,<br>                  'name': 'first_name',<br>                  'required': True,<br>                  'value': u'Happy',<br>                  'widget_constructor': 'zope.schema.TextLine'},<br>                 {'fieldHint': u'Family name.',<br>                  'fieldLabel': u'Last name',<br>                  'id': 'last_name',<br>                  'minLength': 0,<br>                  'name': 'last_name',<br>                  'required': True,<br>                  'value': u'Camper',<br>                  'widget_constructor': 'zope.schema.TextLine'},<br>                 {'fieldHint': u'',<br>                  'fieldLabel': u'Favorite color',<br>                  'id': 'favorite_color',<br>                  'minLength': 0,<br>                  'name': 'favorite_color',<br>                  'required': False,<br>                  'value': u'Blue',<br>                  'widget_constructor': 'zope.schema.TextLine'},<br>                 {'allowBlank': False,<br>                  'fieldHint': u'Age in years',<br>                  'fieldLabel': u'Age',<br>                  'field_max': 200,<br>                  'field_min': 0,<br>                  'id': 'age',<br>                  'name': 'age',<br>                  'required': True,<br>                  'value': u'23',<br>                  'widget_constructor': 'zope.schema.Int'},<br>                 {'fieldHint': u'Are they happy?',<br>                  'fieldLabel': u'Happy',<br>                  'id': 'happy',<br>                  'name': 'happy',<br>                  'required': True,<br>                  'value': True,<br>                  'widget_constructor': 'zope.schema.Bool'},<br>                 {'fieldHint': u\"This person's best friend.\",<br>                  'fieldLabel': u'Pet',<br>                  'id': 'pet',<br>                  'name': 'pet',<br>                  'required': False,<br>                  'values': [['c935d187f0b998ef720390f85014ed1e',<br>                              u'Dog'],<br>                             ['fa3ebd6742c360b2d9652b7f78d9bd7d',<br>                              u'Cat'],<br>                             ['071642fa72ba780ee90ed36350d82745',<br>                              u'Fish']],<br>                  'widget_constructor': 'zc.ajaxform.widgets.ComboBox'},<br>                 {'allowBlank': False,<br>                  'fieldHint': u'What is the person like?',<br>                  'fieldLabel': u'Temperment',<br>                  'hiddenName': 'temperment.value',<br>                  'id': 'temperment',<br>                  'name': 'temperment',<br>                  'required': True,<br>                  'value': 'Right Neighborly',<br>                  'values': [['Nice',<br>                              u'Nice'],<br>                             ['Mean',<br>                              u'Mean'],<br>                             ['Ornery',<br>                              u'Ornery'],<br>                             ['Right Neighborly',<br>                              u'Right Neighborly']],<br>                  'widget_constructor': 'zope.schema.Choice'},<br>                 {'allowBlank': False,<br>                  'fieldHint': u'Weight in lbs?',<br>                  'fieldLabel': u'Weight',<br>                  'id': 'weight',<br>                  'name': 'weight',<br>                  'required': True,<br>                  'widget_constructor': 'zope.schema.Decimal'},<br>                 {'fieldHint': u'What do they look like?',<br>                  'fieldLabel': u'Description',<br>                  'id': 'description',<br>                  'minLength': 0,<br>                  'name': 'description',<br>                  'required': True,<br>                  'value': u'10ft tall\\nRazor sharp scales.',<br>                  'widget_constructor': 'zope.schema.Text'},<br>                 {'fieldHint': u\"Don't tell anybody\",<br>                  'fieldLabel': u'Secret Key',<br>                  'id': 'secret',<br>                  'name': 'secret',<br>                  'required': True,<br>                  'value': u'5ecret sauce',<br>                  'widget_constructor': 'zc.ajaxform.widgets.Hidden'},<br>                 {'allowBlank': False,<br>                  'fieldHint': u'Number of siblings',<br>                  'fieldLabel': u'Siblings',<br>                  'field_max': 8,<br>                  'field_min': 0,<br>                  'id': 'siblings',<br>                  'name': 'siblings',<br>                  'required': True,<br>                  'value': u'1',<br>                  'widget_constructor': 'zc.ajaxform.widgets.NumberSpinner'},<br>                 {'fieldHint': u'All my wonderful homes',<br>                  'fieldLabel': u'Addresses',<br>                  'id': 'addresses',<br>                  'name': 'addresses',<br>                  'record_schema': {'readonly': False,<br>                                    'widgets': [{'fieldHint': u'The street',<br>                                                 'fieldLabel': u'Street',<br>                                                 'id': 'street',<br>                                                 'minLength': 0,<br>                                                 'name': 'street',<br>                                                 'required': True,<br>                                                 'widget_constructor': 'zope.schema.TextLine'},<br>                                                {'fieldHint': u'The city',<br>                                                 'fieldLabel': u'City',<br>                                                 'id': 'city',<br>                                                 'minLength': 0,<br>                                                 'name': 'city',<br>                                                 'required': True,<br>                                                 'widget_constructor': 'zope.schema.TextLine'},<br>                                                {'allowBlank': False,<br>                                                 'fieldHint': u'The awesomeness on a scale of 1 to 10',<br>                                                 'fieldLabel': u'Awesomeness',<br>                                                 'field_max': 10,<br>                                                 'field_min': 1,<br>                                                 'id': 'awesomeness',<br>                                                 'name': 'awesomeness',<br>                                                 'required': True,<br>                                                 'widget_constructor': 'zope.schema.Int'}]},<br>                  'required': True,<br>                  'value': [{'awesomeness': u'9',<br>                             'city': u'fakeville',<br>                             'street': u'123 fake street'},<br>                            {'awesomeness': u'9001',<br>                             'city': u'falsetown',<br>                             'street': u'345 false street'}],<br>                  'widget_constructor': 'zope.schema.List'},<br>                 {'fieldHint': u'Any other notes',<br>                  'fieldLabel': u'Other',<br>                  'id': 'other',<br>                  'minLength': 0,<br>                  'name': 'other',<br>                  'required': True,<br>                  'value': u\"I've got a magic toenail\",<br>                  'widget_constructor': 'zope.schema.Text'}]}<br><br>Note that the action URL now includes \"sample/\" as a prefix.  Also<br>note that the widget and action names have \"\" as a prefix.  The<br>form prefix is simply its base with \"/\"s converted to \".\"s.<br><br>    &gt;&gt;&gt; ex.ExampleForm.prefix<br>    'sample.ExampleForm'<br><br><br>Form data<br>---------<br><br>Ajax forms are a bit different from normal web forms because the data<br>and the form definition can be fetched separately.  For example, we<br>may use the same form to edit multiple objects.  Form objects have a<br>getObjectData method that returns data suitable for editing form field<br>values.  Let's create a person and use out form to get data for them:<br><br>    &gt;&gt;&gt; bob = zc.ajaxform.form_example.Person(<br>    ...     first_name='bob',<br>    ...     last_name='smith',<br>    ...     favorite_color=None,<br>    ...     age=11,<br>    ...     happy=True,<br>    ...     pet=u'Cockatiel',<br>    ...     temperment='Nice',<br>    ...     weight = 175.5,<br>    ...     description = 'A real cool guy',<br>    ...     secret = 'Noone knows!',<br>    ...     siblings = 1,<br>    ...     addresses = [],<br>    ...     other = 'stuff')<br>    &gt;&gt;&gt; pprint(ex.ExampleForm.getObjectData(bob), width=1)<br>    {'addresses': [],<br>     'age': u'11',<br>     'description': u'A real cool guy',<br>     'first_name': u'bob',<br>     'happy': True,<br>     'last_name': u'smith',<br>     'other': u'stuff',<br>     'pet': u'Cockatiel',<br>     'secret': u'Noone knows!',<br>     'siblings': u'1',<br>     'temperment': 'Nice',<br>     'weight': u'175.5'}<br><br>We didn't set the favorite_color for the person, so it is ommitted<br>from the data.<br><br>We can pass in a dictionary of values that take precedence over object data:<br><br>    &gt;&gt;&gt; pprint(ex.ExampleForm.getObjectData(<br>    ...            bob, {'age': u'1'}),<br>    ...        width=1)<br>    {'addresses': [],<br>     'age': u'1',<br>     'description': u'A real cool guy',<br>     'first_name': u'bob',<br>     'happy': True,<br>     'last_name': u'smith',<br>     'other': u'stuff',<br>     'pet': u'Cockatiel',<br>     'secret': u'Noone knows!',<br>     'siblings': u'1',<br>     'temperment': 'Nice',<br>     'weight': u'175.5'}<br><br><br>Display Options<br>---------------<br><br>Additional display options may be sent in the widget definition if the widget<br>can be adapted to `IDisplayOptions`.  The result of the adaptation only need<br>be JSON serializable.<br><br>    &gt;&gt;&gt; import zope.app.form.interfaces<br><br>    &gt;&gt;&gt; def example_options(widget):<br>    ...     field, name = widget.context, widget.context.__name__<br>    ...     if name == 'favorite_color':<br>    ...         return {'picker': 'crayons'}<br>    ...     elif name == 'secret':<br>    ...         return 'super-secret'<br>    ...     else:<br>    ...         return None<br><br>    &gt;&gt;&gt; site_manager = zope.component.getSiteManager()<br>    &gt;&gt;&gt; site_manager.registerAdapter(<br>    ...     example_options,<br>    ...     required=(zope.app.form.interfaces.IWidget,),<br>    ...     provided=zc.ajaxform.interfaces.IDisplayOptions)<br><br>    &gt;&gt;&gt; result = call_form(<br>    ...     browser, 'http://localhost/form.html/ExampleForm')<br><br>    &gt;&gt;&gt; widgets = result['definition']['widgets']<br>    &gt;&gt;&gt; for widget in widgets:<br>    ...     if widget.get('display_options'):<br>    ...         print widget['name'] + ':', widget['display_options']<br>    favorite_color: {u'picker': u'crayons'}<br>    secret: super-secret<br><br>Finally, clean up.<br><br>    &gt;&gt;&gt; site_manager.unregisterAdapter(<br>    ...     example_options,<br>    ...     required=(zope.app.form.interfaces.IWidget,),<br>    ...     provided=zc.ajaxform.interfaces.IDisplayOptions)<br>    True<br><br><br>To-do (maybe)<br>-------------<br><br>More widgets!<br><br>Interface invariants<br><br>Actions:<br><br>- conditions<br><br>- validators<br><br>- failure handlers<br><br><br>.. [#application] See application.txt<br><br>.. [#form_classes_are_descriptors] Form classes are also<br>   descriptors. They get called with the instance they're accessed<br>   through.<br><br>.. [#actionids] The Javascript code that sets up action buttons uses<br>   action name as the button's ID.<br><br>Download<br>********\n          </div>"}, "last_serial": 802157, "releases": {"0.7.0": [{"comment_text": "", "digests": {"md5": "23816783961b2c4c93b7f338e56d1fc1", "sha256": "ff540adc6bac83d3597709cc1a472b83a8ce1440620f45672d1b9476350de3cc"}, "downloads": -1, "filename": "zc.ajaxform-0.7.0.tar.gz", "has_sig": false, "md5_digest": "23816783961b2c4c93b7f338e56d1fc1", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 57127, "upload_time": "2010-04-27T17:53:35", "upload_time_iso_8601": "2010-04-27T17:53:35.338109Z", "url": "https://files.pythonhosted.org/packages/53/a9/46e1974bc7ed48b6ca173c4b2534af9326d483bad3d44279918f9887c6dd/zc.ajaxform-0.7.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "23816783961b2c4c93b7f338e56d1fc1", "sha256": "ff540adc6bac83d3597709cc1a472b83a8ce1440620f45672d1b9476350de3cc"}, "downloads": -1, "filename": "zc.ajaxform-0.7.0.tar.gz", "has_sig": false, "md5_digest": "23816783961b2c4c93b7f338e56d1fc1", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 57127, "upload_time": "2010-04-27T17:53:35", "upload_time_iso_8601": "2010-04-27T17:53:35.338109Z", "url": "https://files.pythonhosted.org/packages/53/a9/46e1974bc7ed48b6ca173c4b2534af9326d483bad3d44279918f9887c6dd/zc.ajaxform-0.7.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:19:33 2020"}