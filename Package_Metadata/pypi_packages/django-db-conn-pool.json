{"info": {"author": "Patrick Zhao", "author_email": "", "bugtrack_url": null, "classifiers": ["Development Status :: 5 - Production/Stable", "Intended Audience :: Developers", "License :: OSI Approved :: Apache Software License", "Natural Language :: English", "Programming Language :: Python", "Programming Language :: Python :: 2.7", "Programming Language :: Python :: Implementation :: CPython"], "description": "Gevent-Friendly Database Connection Pooling in Django\n=====================================================\n\nThanks to SQLAlchemy, we can pool the database connections while using the Gevent's monkey patching.\n\nIt supports MySQL and has been tested under Python 2.7, Django 1.11, Gevent 1.2, and SQLAlchemy 1.2.\n\nBesides, ``DjangoQueuePool`` is a new queue pool extending the SQLAlchemy's ``QueuePool``:\n\n- Reuse the database connections overflowed by burst traffic;\n- Retire the unused database connections gradually over time.\n\nPlease remember to close the unusable or obsolete database connections:\n\n- The closed connections are returned to the pool;\n- It is recommended to close them once a task is done.\n- It is recommended to set ``CONN_MAX_AGE`` as ``0`` if possible;\n- The connections would always be obsolete if ``CONN_MAX_AGE`` is ``0``.\n\n.. code-block:: python\n\n    from django.db import connections\n\n    for conn in connections.all():\n        conn.close_if_unusable_or_obsolete()\n\n\nGetting Started\n---------------\n\n- Install the database connection pool\n\n.. code-block::\n\n    pip install django-db-conn-pool\n\n- Add the pool to the Django database backend\n\n.. code-block:: python\n\n    DATABASES = {\n        'default': {\n            'ENGINE': 'django_db_conn_pool.mysqlalchemy',\n            'CONN_MAX_AGE': 0,\n            'POOL': db_conn_pool,\n            ...\n        }\n    }\n\n- Select and tune the connection pool parameters\n\n.. code-block:: python\n\n    from sqlalchemy.pool import QueuePool\n    from django_db_conn_pool.mysqlalchemy.pool import DjangoQueuePool\n\n\n    db_conn_pool = slow_and_safe = {\n\n        'django_pool_class': QueuePool,         # sqlalchemy's builtin queue pool class\n        'django_pre_ping': True,                # pre ping by django if dialect is None\n        'django_reset_on_return': False,        # use sqlalchemy's reset on conn return\n\n        'pool_size': 5,                         # daily traffic: reuse long connections\n        'max_overflow': 0,                      # burst traffic: do not overload the db\n        'timeout': 30,                          # burst traffic: > external api timeout\n        'recycle': 120,                         # should be smaller than mysql timeout\n        'dialect': None,                        # sqlalchemy's mysql dialect instance\n        'pre_ping': False,                      # sqlalchemy pre ping requires dialect\n        'use_threadlocal': True,                # every thread always get its same conn\n        'reset_on_return': 'rollback',          # reset on every conn return by rollback\n    }\n\n    db_conn_pool = fast_and_sane = {\n\n        'django_pool_class': QueuePool,         # sqlalchemy's builtin queue pool class\n        'django_pre_ping': False,               # no pre ping due to long mysql timeout\n        'django_reset_on_return': True,         # reset by rollback only when necessary\n\n        'pool_size': 5,                         # daily traffic: reuse long connections\n        'max_overflow': 10,                     # burst traffic: do not overload the db\n        'timeout': 30,                          # burst traffic: > external api timeout\n        'recycle': 3600,                        # to be much smaller than mysql timeout\n        'dialect': None,                        # sqlalchemy's mysql dialect instance\n        'pre_ping': False,                      # sqlalchemy pre ping requires dialect\n        'use_threadlocal': False,               # diff threads share the db connections\n        'reset_on_return': None,                # do not use sqlalchemy reset on return\n    }\n\n    db_conn_pool = fast_and_wild = {\n\n        'django_pool_class': DjangoQueuePool,   # customized from sqlalchemy queue pool\n        'django_pre_ping': False,               # no pre ping due to long mysql timeout\n        'django_reset_on_return': True,         # reset by rollback only when necessary\n        'django_core_pool_size': 5,             # retire no conn if achieving core size\n        'django_unload_timeout': 2,             # wait some random time before overload\n        'django_retire_interval': 5,            # retire few non-core conn per interval\n        'django_retire_quantity': 1,            # retire few non-core conn per interval\n\n        'pool_size': 30,                        # daily traffic: recycle or retire conn\n        'max_overflow': 0,                      # burst traffic: put overflow into pool\n        'timeout': 30,                          # burst traffic: > external api timeout\n        'recycle': 3600,                        # to be much smaller than mysql timeout\n        'dialect': None,                        # sqlalchemy's mysql dialect instance\n        'pre_ping': False,                      # sqlalchemy pre ping requires dialect\n        'use_threadlocal': False,               # diff threads share the db connections\n        'reset_on_return': None,                # do not use sqlalchemy reset on return\n    }\n\n\n.. :changelog:\n\nRelease History\n---------------\n\n1.0.0 (2019-05-04)\n++++++++++++++++++\n\n- Birthday\n\n\n", "description_content_type": "text/x-rst", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/shzhao17/django-db-conn-pool", "keywords": "", "license": "Apache 2.0", "maintainer": "", "maintainer_email": "", "name": "django-db-conn-pool", "package_url": "https://pypi.org/project/django-db-conn-pool/", "platform": "", "project_url": "https://pypi.org/project/django-db-conn-pool/", "project_urls": {"Homepage": "https://github.com/shzhao17/django-db-conn-pool"}, "release_url": "https://pypi.org/project/django-db-conn-pool/1.0.0/", "requires_dist": ["six", "typing", "django", "sqlalchemy"], "requires_python": ">=2.7,<3", "summary": "Gevent-Friendly Database Connection Pooling in Django", "version": "1.0.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <p>Thanks to SQLAlchemy, we can pool the database connections while using the Gevent\u2019s monkey patching.</p>\n<p>It supports MySQL and has been tested under Python 2.7, Django 1.11, Gevent 1.2, and SQLAlchemy 1.2.</p>\n<p>Besides, <tt>DjangoQueuePool</tt> is a new queue pool extending the SQLAlchemy\u2019s <tt>QueuePool</tt>:</p>\n<ul>\n<li>Reuse the database connections overflowed by burst traffic;</li>\n<li>Retire the unused database connections gradually over time.</li>\n</ul>\n<p>Please remember to close the unusable or obsolete database connections:</p>\n<ul>\n<li>The closed connections are returned to the pool;</li>\n<li>It is recommended to close them once a task is done.</li>\n<li>It is recommended to set <tt>CONN_MAX_AGE</tt> as <tt>0</tt> if possible;</li>\n<li>The connections would always be obsolete if <tt>CONN_MAX_AGE</tt> is <tt>0</tt>.</li>\n</ul>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">django.db</span> <span class=\"kn\">import</span> <span class=\"n\">connections</span>\n\n<span class=\"k\">for</span> <span class=\"n\">conn</span> <span class=\"ow\">in</span> <span class=\"n\">connections</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">():</span>\n    <span class=\"n\">conn</span><span class=\"o\">.</span><span class=\"n\">close_if_unusable_or_obsolete</span><span class=\"p\">()</span>\n</pre>\n<div id=\"getting-started\">\n<h2>Getting Started</h2>\n<ul>\n<li>Install the database connection pool</li>\n</ul>\n<pre>pip install django-db-conn-pool\n</pre>\n<ul>\n<li>Add the pool to the Django database backend</li>\n</ul>\n<pre><span class=\"n\">DATABASES</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s1\">'default'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s1\">'ENGINE'</span><span class=\"p\">:</span> <span class=\"s1\">'django_db_conn_pool.mysqlalchemy'</span><span class=\"p\">,</span>\n        <span class=\"s1\">'CONN_MAX_AGE'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n        <span class=\"s1\">'POOL'</span><span class=\"p\">:</span> <span class=\"n\">db_conn_pool</span><span class=\"p\">,</span>\n        <span class=\"o\">...</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</pre>\n<ul>\n<li>Select and tune the connection pool parameters</li>\n</ul>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">sqlalchemy.pool</span> <span class=\"kn\">import</span> <span class=\"n\">QueuePool</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django_db_conn_pool.mysqlalchemy.pool</span> <span class=\"kn\">import</span> <span class=\"n\">DjangoQueuePool</span>\n\n\n<span class=\"n\">db_conn_pool</span> <span class=\"o\">=</span> <span class=\"n\">slow_and_safe</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n\n    <span class=\"s1\">'django_pool_class'</span><span class=\"p\">:</span> <span class=\"n\">QueuePool</span><span class=\"p\">,</span>         <span class=\"c1\"># sqlalchemy's builtin queue pool class</span>\n    <span class=\"s1\">'django_pre_ping'</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>                <span class=\"c1\"># pre ping by django if dialect is None</span>\n    <span class=\"s1\">'django_reset_on_return'</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>        <span class=\"c1\"># use sqlalchemy's reset on conn return</span>\n\n    <span class=\"s1\">'pool_size'</span><span class=\"p\">:</span> <span class=\"mi\">5</span><span class=\"p\">,</span>                         <span class=\"c1\"># daily traffic: reuse long connections</span>\n    <span class=\"s1\">'max_overflow'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>                      <span class=\"c1\"># burst traffic: do not overload the db</span>\n    <span class=\"s1\">'timeout'</span><span class=\"p\">:</span> <span class=\"mi\">30</span><span class=\"p\">,</span>                          <span class=\"c1\"># burst traffic: &gt; external api timeout</span>\n    <span class=\"s1\">'recycle'</span><span class=\"p\">:</span> <span class=\"mi\">120</span><span class=\"p\">,</span>                         <span class=\"c1\"># should be smaller than mysql timeout</span>\n    <span class=\"s1\">'dialect'</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>                        <span class=\"c1\"># sqlalchemy's mysql dialect instance</span>\n    <span class=\"s1\">'pre_ping'</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>                      <span class=\"c1\"># sqlalchemy pre ping requires dialect</span>\n    <span class=\"s1\">'use_threadlocal'</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>                <span class=\"c1\"># every thread always get its same conn</span>\n    <span class=\"s1\">'reset_on_return'</span><span class=\"p\">:</span> <span class=\"s1\">'rollback'</span><span class=\"p\">,</span>          <span class=\"c1\"># reset on every conn return by rollback</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">db_conn_pool</span> <span class=\"o\">=</span> <span class=\"n\">fast_and_sane</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n\n    <span class=\"s1\">'django_pool_class'</span><span class=\"p\">:</span> <span class=\"n\">QueuePool</span><span class=\"p\">,</span>         <span class=\"c1\"># sqlalchemy's builtin queue pool class</span>\n    <span class=\"s1\">'django_pre_ping'</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>               <span class=\"c1\"># no pre ping due to long mysql timeout</span>\n    <span class=\"s1\">'django_reset_on_return'</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>         <span class=\"c1\"># reset by rollback only when necessary</span>\n\n    <span class=\"s1\">'pool_size'</span><span class=\"p\">:</span> <span class=\"mi\">5</span><span class=\"p\">,</span>                         <span class=\"c1\"># daily traffic: reuse long connections</span>\n    <span class=\"s1\">'max_overflow'</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">,</span>                     <span class=\"c1\"># burst traffic: do not overload the db</span>\n    <span class=\"s1\">'timeout'</span><span class=\"p\">:</span> <span class=\"mi\">30</span><span class=\"p\">,</span>                          <span class=\"c1\"># burst traffic: &gt; external api timeout</span>\n    <span class=\"s1\">'recycle'</span><span class=\"p\">:</span> <span class=\"mi\">3600</span><span class=\"p\">,</span>                        <span class=\"c1\"># to be much smaller than mysql timeout</span>\n    <span class=\"s1\">'dialect'</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>                        <span class=\"c1\"># sqlalchemy's mysql dialect instance</span>\n    <span class=\"s1\">'pre_ping'</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>                      <span class=\"c1\"># sqlalchemy pre ping requires dialect</span>\n    <span class=\"s1\">'use_threadlocal'</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>               <span class=\"c1\"># diff threads share the db connections</span>\n    <span class=\"s1\">'reset_on_return'</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>                <span class=\"c1\"># do not use sqlalchemy reset on return</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">db_conn_pool</span> <span class=\"o\">=</span> <span class=\"n\">fast_and_wild</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n\n    <span class=\"s1\">'django_pool_class'</span><span class=\"p\">:</span> <span class=\"n\">DjangoQueuePool</span><span class=\"p\">,</span>   <span class=\"c1\"># customized from sqlalchemy queue pool</span>\n    <span class=\"s1\">'django_pre_ping'</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>               <span class=\"c1\"># no pre ping due to long mysql timeout</span>\n    <span class=\"s1\">'django_reset_on_return'</span><span class=\"p\">:</span> <span class=\"kc\">True</span><span class=\"p\">,</span>         <span class=\"c1\"># reset by rollback only when necessary</span>\n    <span class=\"s1\">'django_core_pool_size'</span><span class=\"p\">:</span> <span class=\"mi\">5</span><span class=\"p\">,</span>             <span class=\"c1\"># retire no conn if achieving core size</span>\n    <span class=\"s1\">'django_unload_timeout'</span><span class=\"p\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span>             <span class=\"c1\"># wait some random time before overload</span>\n    <span class=\"s1\">'django_retire_interval'</span><span class=\"p\">:</span> <span class=\"mi\">5</span><span class=\"p\">,</span>            <span class=\"c1\"># retire few non-core conn per interval</span>\n    <span class=\"s1\">'django_retire_quantity'</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>            <span class=\"c1\"># retire few non-core conn per interval</span>\n\n    <span class=\"s1\">'pool_size'</span><span class=\"p\">:</span> <span class=\"mi\">30</span><span class=\"p\">,</span>                        <span class=\"c1\"># daily traffic: recycle or retire conn</span>\n    <span class=\"s1\">'max_overflow'</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>                      <span class=\"c1\"># burst traffic: put overflow into pool</span>\n    <span class=\"s1\">'timeout'</span><span class=\"p\">:</span> <span class=\"mi\">30</span><span class=\"p\">,</span>                          <span class=\"c1\"># burst traffic: &gt; external api timeout</span>\n    <span class=\"s1\">'recycle'</span><span class=\"p\">:</span> <span class=\"mi\">3600</span><span class=\"p\">,</span>                        <span class=\"c1\"># to be much smaller than mysql timeout</span>\n    <span class=\"s1\">'dialect'</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>                        <span class=\"c1\"># sqlalchemy's mysql dialect instance</span>\n    <span class=\"s1\">'pre_ping'</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>                      <span class=\"c1\"># sqlalchemy pre ping requires dialect</span>\n    <span class=\"s1\">'use_threadlocal'</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>               <span class=\"c1\"># diff threads share the db connections</span>\n    <span class=\"s1\">'reset_on_return'</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>                <span class=\"c1\"># do not use sqlalchemy reset on return</span>\n<span class=\"p\">}</span>\n</pre>\n</div>\n<div id=\"release-history\">\n<h2>Release History</h2>\n<h2 id=\"id1\"><span class=\"section-subtitle\">1.0.0 (2019-05-04)</span></h2>\n<ul>\n<li>Birthday</li>\n</ul>\n</div>\n\n          </div>"}, "last_serial": 5224552, "releases": {"1.0.0": [{"comment_text": "", "digests": {"md5": "db9adbb8e7c7211b55694ae1a4a57155", "sha256": "0ddc5233531eb8639f413e150f8e80931d7aad1a99bcd11ad98bc45274bc2df2"}, "downloads": -1, "filename": "django_db_conn_pool-1.0.0-py3-none-any.whl", "has_sig": false, "md5_digest": "db9adbb8e7c7211b55694ae1a4a57155", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=2.7,<3", "size": 11439, "upload_time": "2019-05-04T03:44:35", "upload_time_iso_8601": "2019-05-04T03:44:35.558741Z", "url": "https://files.pythonhosted.org/packages/37/04/58a2a6ce9d3410643e1f719cfef60bd93a988009c856b0cd2f5d085aa420/django_db_conn_pool-1.0.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "b77c6b6c1248f605c20a356173ad7a1c", "sha256": "8bc872847e1c1a74ec6b49203247bed798e8c0ed2864caf7a28b5760feca81e3"}, "downloads": -1, "filename": "django-db-conn-pool-1.0.0.tar.gz", "has_sig": false, "md5_digest": "b77c6b6c1248f605c20a356173ad7a1c", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7,<3", "size": 10639, "upload_time": "2019-05-04T03:44:38", "upload_time_iso_8601": "2019-05-04T03:44:38.080272Z", "url": "https://files.pythonhosted.org/packages/d0/54/dbc861ad54e3600c8a9881e5c34dd26d54ea72c7171e5c5e48e170dab5b4/django-db-conn-pool-1.0.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "db9adbb8e7c7211b55694ae1a4a57155", "sha256": "0ddc5233531eb8639f413e150f8e80931d7aad1a99bcd11ad98bc45274bc2df2"}, "downloads": -1, "filename": "django_db_conn_pool-1.0.0-py3-none-any.whl", "has_sig": false, "md5_digest": "db9adbb8e7c7211b55694ae1a4a57155", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=2.7,<3", "size": 11439, "upload_time": "2019-05-04T03:44:35", "upload_time_iso_8601": "2019-05-04T03:44:35.558741Z", "url": "https://files.pythonhosted.org/packages/37/04/58a2a6ce9d3410643e1f719cfef60bd93a988009c856b0cd2f5d085aa420/django_db_conn_pool-1.0.0-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "b77c6b6c1248f605c20a356173ad7a1c", "sha256": "8bc872847e1c1a74ec6b49203247bed798e8c0ed2864caf7a28b5760feca81e3"}, "downloads": -1, "filename": "django-db-conn-pool-1.0.0.tar.gz", "has_sig": false, "md5_digest": "b77c6b6c1248f605c20a356173ad7a1c", "packagetype": "sdist", "python_version": "source", "requires_python": ">=2.7,<3", "size": 10639, "upload_time": "2019-05-04T03:44:38", "upload_time_iso_8601": "2019-05-04T03:44:38.080272Z", "url": "https://files.pythonhosted.org/packages/d0/54/dbc861ad54e3600c8a9881e5c34dd26d54ea72c7171e5c5e48e170dab5b4/django-db-conn-pool-1.0.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:36:40 2020"}