{"info": {"author": "John Montgomery", "author_email": "john@sensibledevelopment.com", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Environment :: Web Environment", "Framework :: Django", "Intended Audience :: Developers", "License :: OSI Approved :: BSD License", "Operating System :: OS Independent", "Programming Language :: Python", "Topic :: Software Development :: Libraries :: Python Modules"], "description": "===============\nDjango Sendfile\n===============\n\nThis is a wrapper around web-server specific methods for sending files to web clients.  This is useful when Django needs to check permissions associated files, but does not want to serve the actual bytes of the file itself.  i.e. as serving large files is not what Django is made for.\n\nNote this should not be used for regular file serving (e.g. css etc), only for cases where you need Django to do some work before serving the actual file.\n\nThe interface is a single function `sendfile(request, filename, attachment=False, attachment_filename=None)`, which returns a HTTPResponse object.\n\n::\n\n    from sendfile import sendfile\n    \n    # send myfile.pdf to user\n    return sendfile(request, '/home/john/myfile.pdf')\n\n    # send myfile.pdf as an attachment (with name myfile.pdf)\n    return sendfile(request, '/home/john/myfile.pdf', attachment=True)\n    \n    # send myfile.pdf as an attachment with a different name\n    return sendfile(request, '/home/john/myfile.pdf', attachment=True, attachment_filename='full-name.pdf')\n\n\n\nBackends are specified using the setting `SENDFILE_BACKEND`.  Currenly available backends are:\n\n* `sendfile.backends.development` - for use with django development server only. DO NOT USE IN PRODUCTION\n* `sendfile.backends.simple` - \"simple\" backend that uses Django file objects to attempt to stream files from disk (note middleware may cause files to be loaded fully into memory)\n* `sendfile.backends.xsendfile` - sets X-Sendfile header (as used by mod_xsendfile/apache and lighthttpd)\n* `sendfile.backends.mod_wsgi` - sets Location with 200 code to trigger internal redirect (daemon mode mod_wsgi only - see below)\n* `sendfile.backends.nginx` - sets X-Accel-Redirect header to trigger internal redirect to file\n\nIf you want to write your own backend simply create a module with a `sendfile` function matching:\n\n::\n\n   def sendfile(request, filename):\n       '''Return HttpResponse object for serving file'''\n\n\nThen specify the full path to the module in `SENDFILE_BACKEND`.  You only need to implement the sending of the file.  Adding the content-disposition headers etc is done elsewhere.\n\n\nDevelopment backend\n===================\n\nThe Development backend is only meant for use while writing code.  It uses Django's static file serving code to do the job, which is only meant for development.  It reads the whole file into memory and the sends it down the wire - not good for big files, but ok when you are just testing things out.\n\nIt will work with the Django dev server and anywhere else you can run Django.\n\nSimple backend\n==============\n\nThis backend is one step up from the development backend.  It uses Django's `django.core.files.base.File` class to try and stream files from disk.  However some middleware (e.g. GzipMiddleware) that rewrites content will causes the entire file to be loaded into memory.  So only use this backend if you are not using middleware that rewrites content or you only have very small files.\n\n\nxsendfile backend\n=================\n\nInstall either mod_xsendfile_ in Apache_ or use Lighthttpd_.  You may need to configure mod_xsendfile_, but that should be as simple as:\n\n::\n\n    XSendFile On\n\nIn your virtualhost file/conf file.\n\n\nmod_wsgi backend\n================\n\nThe mod_wsgi backend will only work when using mod_wsgi in daemon mode, not in embedded mode.  It requires a bit more work to get it to do the same job as xsendfile though.  However some may find it easier to setup, as they don't need to compile and install mod_xsendfile_.\n\nFirstly there are two more django settings:\n\n* `SENDFILE_ROOT` - this is a directoy where all files that will be used with sendfile must be located\n* `SENDFILE_URL` - internal URL prefix for all files served via sendfile\n\nThese settings are needed as this backend makes mod_wsgi_ send an internal redirect, so we have to convert a file path into a URL.  This means that the files are visible via Apache_ by default too.  So we need to get Apache_ to hide those files from anything that's not an internal redirect.  To so this we can use some mod_rewrite_ magic along these lines:\n\n::\n\n    RewriteEngine On\n    # see if we're on an internal redirect or not\n    RewriteCond %{THE_REQUEST} ^[\\S]+\\ /private/\n    RewriteRule ^/private/ - [F]\n\n    Alias /private/ /home/john/Development/myapp/private/\n    <Directory /home/john/Development/myapp/private/>\n        Order deny,allow\n        Allow from all\n    </Directory>\n\n\nIn this case I have also set:\n\n::\n\n    SENDFILE_ROOT = '/home/john/Development/myapp/private/'\n    SENDFILE_URL = '/private'\n\n\nAll files are stored in a folder called 'private'.  We forbid access to this folder (`RewriteRule ^/private/ - [F]`) if someone tries to access it directly (`RewriteCond %{THE_REQUEST} ^[\\S]+\\ /private/`) by checking the original request (`THE_REQUEST`).\n\nAlledgedly `IS_SUBREQ` can be used to `perform the same job <http://www.mail-archive.com/django-users@googlegroups.com/msg96718.html>`_, but I was unable to get this working.\n\n\nNginx backend\n=============\n\nAs with the mod_wsgi backend you need to set two extra settings:\n\n* `SENDFILE_ROOT` - this is a directoy where all files that will be used with sendfile must be located\n* `SENDFILE_URL` - internal URL prefix for all files served via sendfile\n\nYou then need to configure nginx to only allow internal access to the files you wish to serve.  More details on this are here http://wiki.nginx.org/XSendfile\n\nFor example though, if I use the django settings:\n\n::\n\n    SENDFILE_ROOT = '/home/john/Development/django-sendfile/examples/protected_downloads/protected'\n    SENDFILE_URL = '/protected'\n\nThen the matching location block in nginx.conf would be:\n\n::\n\n    location /protected/ {\n      internal;\n      root   /home/john/Development/django-sendfile/examples/protected_downloads;\n    }\n\nYou need to pay attention to whether you have trailing slashes or not on the SENDFILE_URL and root values, otherwise you may not get the right URL being sent to NGINX and you may get 404s.  You should be able to see what file NGINX is trying to load in the error.log if this happens.  From there it should be fairly easy to work out what the right settings are.\n\n.. _mod_xsendfile: https://tn123.org/mod_xsendfile/\n.. _Apache: http://httpd.apache.org/\n.. _Lighthttpd: http://www.lighttpd.net/\n.. _mod_wsgi: http://code.google.com/p/modwsgi/", "description_content_type": null, "docs_url": null, "download_url": "UNKNOWN", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/johnsensible/django-sendfile", "keywords": null, "license": "BSD", "maintainer": null, "maintainer_email": null, "name": "django-sendfile", "package_url": "https://pypi.org/project/django-sendfile/", "platform": "UNKNOWN", "project_url": "https://pypi.org/project/django-sendfile/", "project_urls": {"Download": "UNKNOWN", "Homepage": "https://github.com/johnsensible/django-sendfile"}, "release_url": "https://pypi.org/project/django-sendfile/0.3.11/", "requires_dist": null, "requires_python": null, "summary": "Abstraction to offload file uploads to web-server (e.g. Apache with mod_xsendfile) once Django has checked permissions etc.", "version": "0.3.11", "yanked": false, "html_description": "<div class=\"project-description\">\n            ===============<br>Django Sendfile<br>===============<br><br>This is a wrapper around web-server specific methods for sending files to web clients.  This is useful when Django needs to check permissions associated files, but does not want to serve the actual bytes of the file itself.  i.e. as serving large files is not what Django is made for.<br><br>Note this should not be used for regular file serving (e.g. css etc), only for cases where you need Django to do some work before serving the actual file.<br><br>The interface is a single function `sendfile(request, filename, attachment=False, attachment_filename=None)`, which returns a HTTPResponse object.<br><br>::<br><br>    from sendfile import sendfile<br>    <br>    # send myfile.pdf to user<br>    return sendfile(request, '/home/john/myfile.pdf')<br><br>    # send myfile.pdf as an attachment (with name myfile.pdf)<br>    return sendfile(request, '/home/john/myfile.pdf', attachment=True)<br>    <br>    # send myfile.pdf as an attachment with a different name<br>    return sendfile(request, '/home/john/myfile.pdf', attachment=True, attachment_filename='full-name.pdf')<br><br><br><br>Backends are specified using the setting `SENDFILE_BACKEND`.  Currenly available backends are:<br><br>* `sendfile.backends.development` - for use with django development server only. DO NOT USE IN PRODUCTION<br>* `sendfile.backends.simple` - \"simple\" backend that uses Django file objects to attempt to stream files from disk (note middleware may cause files to be loaded fully into memory)<br>* `sendfile.backends.xsendfile` - sets X-Sendfile header (as used by mod_xsendfile/apache and lighthttpd)<br>* `sendfile.backends.mod_wsgi` - sets Location with 200 code to trigger internal redirect (daemon mode mod_wsgi only - see below)<br>* `sendfile.backends.nginx` - sets X-Accel-Redirect header to trigger internal redirect to file<br><br>If you want to write your own backend simply create a module with a `sendfile` function matching:<br><br>::<br><br>   def sendfile(request, filename):<br>       '''Return HttpResponse object for serving file'''<br><br><br>Then specify the full path to the module in `SENDFILE_BACKEND`.  You only need to implement the sending of the file.  Adding the content-disposition headers etc is done elsewhere.<br><br><br>Development backend<br>===================<br><br>The Development backend is only meant for use while writing code.  It uses Django's static file serving code to do the job, which is only meant for development.  It reads the whole file into memory and the sends it down the wire - not good for big files, but ok when you are just testing things out.<br><br>It will work with the Django dev server and anywhere else you can run Django.<br><br>Simple backend<br>==============<br><br>This backend is one step up from the development backend.  It uses Django's `django.core.files.base.File` class to try and stream files from disk.  However some middleware (e.g. GzipMiddleware) that rewrites content will causes the entire file to be loaded into memory.  So only use this backend if you are not using middleware that rewrites content or you only have very small files.<br><br><br>xsendfile backend<br>=================<br><br>Install either mod_xsendfile_ in Apache_ or use Lighthttpd_.  You may need to configure mod_xsendfile_, but that should be as simple as:<br><br>::<br><br>    XSendFile On<br><br>In your virtualhost file/conf file.<br><br><br>mod_wsgi backend<br>================<br><br>The mod_wsgi backend will only work when using mod_wsgi in daemon mode, not in embedded mode.  It requires a bit more work to get it to do the same job as xsendfile though.  However some may find it easier to setup, as they don't need to compile and install mod_xsendfile_.<br><br>Firstly there are two more django settings:<br><br>* `SENDFILE_ROOT` - this is a directoy where all files that will be used with sendfile must be located<br>* `SENDFILE_URL` - internal URL prefix for all files served via sendfile<br><br>These settings are needed as this backend makes mod_wsgi_ send an internal redirect, so we have to convert a file path into a URL.  This means that the files are visible via Apache_ by default too.  So we need to get Apache_ to hide those files from anything that's not an internal redirect.  To so this we can use some mod_rewrite_ magic along these lines:<br><br>::<br><br>    RewriteEngine On<br>    # see if we're on an internal redirect or not<br>    RewriteCond %{THE_REQUEST} ^[\\S]+\\ /private/<br>    RewriteRule ^/private/ - [F]<br><br>    Alias /private/ /home/john/Development/myapp/private/<br>    &lt;Directory /home/john/Development/myapp/private/&gt;<br>        Order deny,allow<br>        Allow from all<br>    &lt;/Directory&gt;<br><br><br>In this case I have also set:<br><br>::<br><br>    SENDFILE_ROOT = '/home/john/Development/myapp/private/'<br>    SENDFILE_URL = '/private'<br><br><br>All files are stored in a folder called 'private'.  We forbid access to this folder (`RewriteRule ^/private/ - [F]`) if someone tries to access it directly (`RewriteCond %{THE_REQUEST} ^[\\S]+\\ /private/`) by checking the original request (`THE_REQUEST`).<br><br>Alledgedly `IS_SUBREQ` can be used to `perform the same job &lt;http://www.mail-archive.com/django-users@googlegroups.com/msg96718.html&gt;`_, but I was unable to get this working.<br><br><br>Nginx backend<br>=============<br><br>As with the mod_wsgi backend you need to set two extra settings:<br><br>* `SENDFILE_ROOT` - this is a directoy where all files that will be used with sendfile must be located<br>* `SENDFILE_URL` - internal URL prefix for all files served via sendfile<br><br>You then need to configure nginx to only allow internal access to the files you wish to serve.  More details on this are here http://wiki.nginx.org/XSendfile<br><br>For example though, if I use the django settings:<br><br>::<br><br>    SENDFILE_ROOT = '/home/john/Development/django-sendfile/examples/protected_downloads/protected'<br>    SENDFILE_URL = '/protected'<br><br>Then the matching location block in nginx.conf would be:<br><br>::<br><br>    location /protected/ {<br>      internal;<br>      root   /home/john/Development/django-sendfile/examples/protected_downloads;<br>    }<br><br>You need to pay attention to whether you have trailing slashes or not on the SENDFILE_URL and root values, otherwise you may not get the right URL being sent to NGINX and you may get 404s.  You should be able to see what file NGINX is trying to load in the error.log if this happens.  From there it should be fairly easy to work out what the right settings are.<br><br>.. _mod_xsendfile: https://tn123.org/mod_xsendfile/<br>.. _Apache: http://httpd.apache.org/<br>.. _Lighthttpd: http://www.lighttpd.net/<br>.. _mod_wsgi: http://code.google.com/p/modwsgi/\n          </div>"}, "last_serial": 2309647, "releases": {"0.2.0": [], "0.2.1": [], "0.2.2": [], "0.3.0": [], "0.3.1": [], "0.3.10": [{"comment_text": "", "digests": {"md5": "794f821099ffa0064ecaa02bae2d647a", "sha256": "59d5bb64b96235098419004a201f41d24d6d0b91343fb51ac0d073cb37228bc4"}, "downloads": -1, "filename": "django-sendfile-0.3.10.tar.gz", "has_sig": false, "md5_digest": "794f821099ffa0064ecaa02bae2d647a", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6975, "upload_time": "2015-10-16T13:33:43", "upload_time_iso_8601": "2015-10-16T13:33:43.972706Z", "url": "https://files.pythonhosted.org/packages/95/d9/93b13a285b8f11b80e46fa0275999c50921ec1c26af11193ede8e542c31f/django-sendfile-0.3.10.tar.gz", "yanked": false}], "0.3.11": [{"comment_text": "", "digests": {"md5": "3fb0e91c195aa209e1a877e92888c91f", "sha256": "f3065a55e602d002af327fe785449ff0a619b6f46ad2cb84730ccb49b31a73ca"}, "downloads": -1, "filename": "django-sendfile-0.3.11.tar.gz", "has_sig": false, "md5_digest": "3fb0e91c195aa209e1a877e92888c91f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 7269, "upload_time": "2016-08-28T16:55:45", "upload_time_iso_8601": "2016-08-28T16:55:45.068653Z", "url": "https://files.pythonhosted.org/packages/a3/01/2291deb21fe3036e16a22bb293f2bcbd095e05476f66d9d10eb4b44ff758/django-sendfile-0.3.11.tar.gz", "yanked": false}], "0.3.2": [{"comment_text": "", "digests": {"md5": "2178a74a9c658d77099d2c8096afd816", "sha256": "6e7733f06a1de6dc6d83ae822f67a0007f480d7f4222d6ed3afa0382b38ce38c"}, "downloads": -1, "filename": "django-sendfile-0.3.2.tar.gz", "has_sig": false, "md5_digest": "2178a74a9c658d77099d2c8096afd816", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6598, "upload_time": "2013-05-07T08:35:21", "upload_time_iso_8601": "2013-05-07T08:35:21.439728Z", "url": "https://files.pythonhosted.org/packages/25/14/c0fd225ad7e1b67b628be9240003dfdf9d127833e32e60a022a3840c2559/django-sendfile-0.3.2.tar.gz", "yanked": false}], "0.3.3": [{"comment_text": "", "digests": {"md5": "52509a27118cd5316f611bb4adf4eb08", "sha256": "9553bb697e0b4bd3385d4cdf586b3cc9c5b082da98e555e6bfeb7c2954e2b028"}, "downloads": -1, "filename": "django-sendfile-0.3.3.tar.gz", "has_sig": false, "md5_digest": "52509a27118cd5316f611bb4adf4eb08", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6874, "upload_time": "2013-12-17T09:37:31", "upload_time_iso_8601": "2013-12-17T09:37:31.759369Z", "url": "https://files.pythonhosted.org/packages/86/48/034a9aac4a8934b6292a001e9d41f7c94ed91dd4262cda5ab4323de92e23/django-sendfile-0.3.3.tar.gz", "yanked": false}], "0.3.4": [{"comment_text": "", "digests": {"md5": "c8aedbac91a4d9cc15a5e2a0ea76a230", "sha256": "6800ab9df7e8e8af7a51c08436b05956b70afbace63f76ec70c8dd16c6972779"}, "downloads": -1, "filename": "django-sendfile-0.3.4.tar.gz", "has_sig": false, "md5_digest": "c8aedbac91a4d9cc15a5e2a0ea76a230", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6825, "upload_time": "2013-12-17T09:41:59", "upload_time_iso_8601": "2013-12-17T09:41:59.142812Z", "url": "https://files.pythonhosted.org/packages/fe/c6/e75d7c8dba87455cf6152a18990bacee817be917bac210eb13fe30e44264/django-sendfile-0.3.4.tar.gz", "yanked": false}], "0.3.5": [], "0.3.6": [{"comment_text": "", "digests": {"md5": "87e3834ed671b5ba094e594b9a5425b5", "sha256": "df0071f573357b3f3caef10b812ecab54948ec688acf380162096f80f48a7e83"}, "downloads": -1, "filename": "django-sendfile-0.3.6.tar.gz", "has_sig": false, "md5_digest": "87e3834ed671b5ba094e594b9a5425b5", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6924, "upload_time": "2014-06-20T15:37:37", "upload_time_iso_8601": "2014-06-20T15:37:37.944037Z", "url": "https://files.pythonhosted.org/packages/52/00/974e7a59f2536e6d9a7fe606d135d4aac2e5c4b38fe4fd5c05cdb81840ec/django-sendfile-0.3.6.tar.gz", "yanked": false}], "0.3.7": [{"comment_text": "", "digests": {"md5": "20fe08e2d41788a0b9c73b7af829ff91", "sha256": "f8ef696830caa3627f730ab772f12103550654003fe066461fd17e9e6f611a26"}, "downloads": -1, "filename": "django-sendfile-0.3.7.tar.gz", "has_sig": false, "md5_digest": "20fe08e2d41788a0b9c73b7af829ff91", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6928, "upload_time": "2015-05-05T09:57:02", "upload_time_iso_8601": "2015-05-05T09:57:02.991898Z", "url": "https://files.pythonhosted.org/packages/94/65/7c6b2245b20e0086e3b8095f1aeade9c739c8c09674958ba3ed16294e208/django-sendfile-0.3.7.tar.gz", "yanked": false}], "0.3.8": [{"comment_text": "", "digests": {"md5": "3f5b11da77d1fdecd73caf6cb3ce479a", "sha256": "710b7591afb44795a8a990197ada25db112c2ab5abfa978456883042aa233a38"}, "downloads": -1, "filename": "django-sendfile-0.3.8.tar.gz", "has_sig": false, "md5_digest": "3f5b11da77d1fdecd73caf6cb3ce479a", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6943, "upload_time": "2015-07-09T08:28:04", "upload_time_iso_8601": "2015-07-09T08:28:04.818399Z", "url": "https://files.pythonhosted.org/packages/23/41/c43c7d99a5d741aa93f58cf0e7a93e31a2accec3f5e72a5953dceef1ce60/django-sendfile-0.3.8.tar.gz", "yanked": false}], "0.3.9": [{"comment_text": "", "digests": {"md5": "409125e96ec1e3f65e3bbcce5ecc15b4", "sha256": "db2e44829059d6bc163c80b5a9f2f48eebb2e30e73f02bb3673163f722b1d38c"}, "downloads": -1, "filename": "django-sendfile-0.3.9.tar.gz", "has_sig": false, "md5_digest": "409125e96ec1e3f65e3bbcce5ecc15b4", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 6967, "upload_time": "2015-07-22T14:32:48", "upload_time_iso_8601": "2015-07-22T14:32:48.292102Z", "url": "https://files.pythonhosted.org/packages/41/6f/8e2cc6a6cd2960d9eb0c7e056c58ffb494b9ebdc46a6818b1ff4f53519d9/django-sendfile-0.3.9.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "3fb0e91c195aa209e1a877e92888c91f", "sha256": "f3065a55e602d002af327fe785449ff0a619b6f46ad2cb84730ccb49b31a73ca"}, "downloads": -1, "filename": "django-sendfile-0.3.11.tar.gz", "has_sig": false, "md5_digest": "3fb0e91c195aa209e1a877e92888c91f", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 7269, "upload_time": "2016-08-28T16:55:45", "upload_time_iso_8601": "2016-08-28T16:55:45.068653Z", "url": "https://files.pythonhosted.org/packages/a3/01/2291deb21fe3036e16a22bb293f2bcbd095e05476f66d9d10eb4b44ff758/django-sendfile-0.3.11.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:53:38 2020"}