{"info": {"author": "thuhak", "author_email": "thuhak.zhou@nio.com", "bugtrack_url": null, "classifiers": [], "description": "# \u4f2a\u4e8b\u52a1\u5904\u7406\n\n## \u529f\u80fd\n\n\u5bf9\u4e8e\u4e00\u7ec4\u51fd\u6570\uff0c\u5982\u679c\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u5f02\u5e38, \u6309\u7167\u53cd\u5411\u7684\u8c03\u7528\u987a\u5e8f\u4f9d\u6b21\u8c03\u7528\u5bf9\u5e94\u7684\u9006\u8fc7\u7a0b\n\n\n## \u6817\u5b50\n\n```python\nfrom pytransaction import Transaction\n\n\ndef test1(*args, **kwargs):\n    print('test1 running..', args, kwargs)\n\n\ndef test2(*args, **kwargs):\n    print('test2 running...', args, kwargs)\n    raise ValueError('oops, exception occurs')\n\n\ndef rollback(*args, **kwargs):\n    print('rolling back...', args, kwargs)\n\n\ntry:\n    with Transaction() as t:\n        t.run(test1, rollback, args=(1,2), kwargs={'arg3':3}, rargs=('a', 'b'), rkwargs={'t':'tt'})\n        t.run(test1, rollback, kwargs={'arg3':3})\n        t.run(test1, rollback, args=(4,), kwargs={'a':'aa'}, rargs=(5,6), rkwargs='same')\n        t.run(test2, rollback, args=('stop here',), rargs='same')\n        t.run(test1, rollback, args=('will not run'))\nexcept Exception as e:\n    print('handle exceptions here')\n    raise e\n\n```\n\n\n## \u6ce8\u610f\n\n\u56e0\u4e3a\u9006\u5411\u64cd\u4f5c\u4e5f\u53ef\u80fd\u4f1a\u5931\u8d25\uff0c\u56e0\u6b64\u4e0d\u80fd\u5b8c\u5168\u4fdd\u8bc1\u4e8b\u52a1\u4e00\u5b9a\u5f97\u5230\u5904\u7406", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/thuhak/pytransaction.git", "keywords": "transaction", "license": "", "maintainer": "", "maintainer_email": "", "name": "pytransaction", "package_url": "https://pypi.org/project/pytransaction/", "platform": "", "project_url": "https://pypi.org/project/pytransaction/", "project_urls": {"Homepage": "https://github.com/thuhak/pytransaction.git"}, "release_url": "https://pypi.org/project/pytransaction/1.0.0/", "requires_dist": null, "requires_python": "", "summary": "run revert functions when exception occurs in context", "version": "1.0.0", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>\u4f2a\u4e8b\u52a1\u5904\u7406</h1>\n<h2>\u529f\u80fd</h2>\n<p>\u5bf9\u4e8e\u4e00\u7ec4\u51fd\u6570\uff0c\u5982\u679c\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u5f02\u5e38, \u6309\u7167\u53cd\u5411\u7684\u8c03\u7528\u987a\u5e8f\u4f9d\u6b21\u8c03\u7528\u5bf9\u5e94\u7684\u9006\u8fc7\u7a0b</p>\n<h2>\u6817\u5b50</h2>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">pytransaction</span> <span class=\"kn\">import</span> <span class=\"n\">Transaction</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">test1</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'test1 running..'</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">test2</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'test2 running...'</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"p\">)</span>\n    <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s1\">'oops, exception occurs'</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">rollback</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'rolling back...'</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"k\">with</span> <span class=\"n\">Transaction</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">t</span><span class=\"p\">:</span>\n        <span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">test1</span><span class=\"p\">,</span> <span class=\"n\">rollback</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">),</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'arg3'</span><span class=\"p\">:</span><span class=\"mi\">3</span><span class=\"p\">},</span> <span class=\"n\">rargs</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'a'</span><span class=\"p\">,</span> <span class=\"s1\">'b'</span><span class=\"p\">),</span> <span class=\"n\">rkwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'t'</span><span class=\"p\">:</span><span class=\"s1\">'tt'</span><span class=\"p\">})</span>\n        <span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">test1</span><span class=\"p\">,</span> <span class=\"n\">rollback</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'arg3'</span><span class=\"p\">:</span><span class=\"mi\">3</span><span class=\"p\">})</span>\n        <span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">test1</span><span class=\"p\">,</span> <span class=\"n\">rollback</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">,),</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">'a'</span><span class=\"p\">:</span><span class=\"s1\">'aa'</span><span class=\"p\">},</span> <span class=\"n\">rargs</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"mi\">6</span><span class=\"p\">),</span> <span class=\"n\">rkwargs</span><span class=\"o\">=</span><span class=\"s1\">'same'</span><span class=\"p\">)</span>\n        <span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">test2</span><span class=\"p\">,</span> <span class=\"n\">rollback</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'stop here'</span><span class=\"p\">,),</span> <span class=\"n\">rargs</span><span class=\"o\">=</span><span class=\"s1\">'same'</span><span class=\"p\">)</span>\n        <span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">test1</span><span class=\"p\">,</span> <span class=\"n\">rollback</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"s1\">'will not run'</span><span class=\"p\">))</span>\n<span class=\"k\">except</span> <span class=\"ne\">Exception</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'handle exceptions here'</span><span class=\"p\">)</span>\n    <span class=\"k\">raise</span> <span class=\"n\">e</span>\n</pre>\n<h2>\u6ce8\u610f</h2>\n<p>\u56e0\u4e3a\u9006\u5411\u64cd\u4f5c\u4e5f\u53ef\u80fd\u4f1a\u5931\u8d25\uff0c\u56e0\u6b64\u4e0d\u80fd\u5b8c\u5168\u4fdd\u8bc1\u4e8b\u52a1\u4e00\u5b9a\u5f97\u5230\u5904\u7406</p>\n\n          </div>"}, "last_serial": 4928996, "releases": {"1.0.0": [{"comment_text": "", "digests": {"md5": "5eb9dc268e823e7385f167b0adfb8097", "sha256": "65fb2f8a9374c9d7a5cf054d18f19e71ae01d3bc0ec2b4cdc9405053d5a4feb0"}, "downloads": -1, "filename": "pytransaction-1.0.0.tar.gz", "has_sig": false, "md5_digest": "5eb9dc268e823e7385f167b0adfb8097", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 1886, "upload_time": "2019-03-12T08:23:44", "upload_time_iso_8601": "2019-03-12T08:23:44.770192Z", "url": "https://files.pythonhosted.org/packages/15/1b/113afb1f5cd0a2f140ea59906fb485fffd4d927da3c683f08065b6533d58/pytransaction-1.0.0.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "5eb9dc268e823e7385f167b0adfb8097", "sha256": "65fb2f8a9374c9d7a5cf054d18f19e71ae01d3bc0ec2b4cdc9405053d5a4feb0"}, "downloads": -1, "filename": "pytransaction-1.0.0.tar.gz", "has_sig": false, "md5_digest": "5eb9dc268e823e7385f167b0adfb8097", "packagetype": "sdist", "python_version": "source", "requires_python": null, "size": 1886, "upload_time": "2019-03-12T08:23:44", "upload_time_iso_8601": "2019-03-12T08:23:44.770192Z", "url": "https://files.pythonhosted.org/packages/15/1b/113afb1f5cd0a2f140ea59906fb485fffd4d927da3c683f08065b6533d58/pytransaction-1.0.0.tar.gz", "yanked": false}], "timestamp": "Fri May  8 03:13:22 2020"}