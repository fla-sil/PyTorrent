{"info": {"author": "kiwix", "author_email": "reg@kiwix.org", "bugtrack_url": null, "classifiers": ["Development Status :: 4 - Beta", "Intended Audience :: Developers", "License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)", "Programming Language :: Python", "Programming Language :: Python :: 3.6", "Programming Language :: Python :: 3.7", "Programming Language :: Python :: 3.8"], "description": "kiwixstorage\n============\n\n[![CodeFactor](https://www.codefactor.io/repository/github/kiwix/python_storagelib/badge)](https://www.codefactor.io/repository/github/kiwix/python_storagelib)\n[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)\n[![PyPI version shields.io](https://img.shields.io/pypi/v/kiwixstorage)](https://pypi.org/project/kiwixstorage/)\n\nhelpers for S3 storage, autoconf from URL + Wasabi (wasabisys.com) extras\n\nGoal is mainly to provide a configured s3.client and s3.resource from an URL\nUsers could limit usage to this and use [boto3](https://boto3.amazonaws.com/) directly from there.\n\nA few additional wrappers are in place to simplify common actions.\nAlso, non-S3, wasabi-specific features are exposed directly.\n\n# Usage\n\n``` sh\npip install kiwixstorage\n```\n\n## Connection\n\n``` py\nfrom kiwixstorage import KiwixStorage\nurl = \"https://s3.us-east-1.wasabisys.com/?keyId=x&secretAccessKey=y&bucketName=z\"\ns3 = KiwixStorage(url)\n# test credentials and ensure we can list buckets\nif not s3.check_credentials(list_buckets=True, failsafe=True):\n    return # bad auth\n```\n\n## Scraper use-case\n\n``` py\nonline_url = \"https://xxx\"\nfpath = \"/local/path.ext\"\n# retrieve origin etag\netag = requests.head(online_url, allow_redirects=True).headers.get(\"Etag\")\n# check if we have that very same version in store\nif s3.has_matching_object(key=url, etag=etag)\n    # lastest version in our store, download from there (using progress output)\n    s3.download_file(key=url, fpath=fpath, progress=True)\nelse:\n    # download the origin file using your regular tools\n    download_file(url, fpath)\n    # upload it our storage\n    s3.upload_file(fpath=fpath, key=url)\n# now you have a local file of lastest version and the storage is up to date\n```\n\n# Other use cases\n\n``` py\n# create a bucket\nbucket = s3.create_bucket(\"bucket_name\")\n\n# set auto-delete on bucket\ns3.set_bucket_autodelete_after(nb_days=7)\n\n# allow public downloads from bucket\ns3.allow_public_downloads_on()\n\n# upload a file\ns3.upload_file(fpath, \"some/path/file.img\", meta={\"ENCODER_VERSION\": \"v1\"})\n\n# set autodelete on specific file\ns3.set_object_autodelete_on(key, datetime.datetime.now())\n\n# download a file\ns3.download_file(key, fpath)\n\n# get URL for external download\ns3.get_download_url(key)\n\n```\n\n# Resources:\n\n* https://wasabi.com/wp-content/themes/wasabi/docs/API_Guide\n* https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html\n\n\n", "description_content_type": "text/markdown", "docs_url": null, "download_url": "", "downloads": {"last_day": -1, "last_month": -1, "last_week": -1}, "home_page": "https://github.com/kiwix/python_storagelib", "keywords": "kiwix zim offline aws s3", "license": "GPLv3+", "maintainer": "", "maintainer_email": "", "name": "kiwixstorage", "package_url": "https://pypi.org/project/kiwixstorage/", "platform": "", "project_url": "https://pypi.org/project/kiwixstorage/", "project_urls": {"Homepage": "https://github.com/kiwix/python_storagelib"}, "release_url": "https://pypi.org/project/kiwixstorage/0.2/", "requires_dist": ["boto3 (<1.13,>=1.12.39)", "requests (<3.0,>=2.23)", "aws-requests-auth (<0.5,>=0.4.2)"], "requires_python": ">=3.6", "summary": "Kiwix S3 Cache wrapper to use within Kiwix/OpenZIM projects", "version": "0.2", "yanked": false, "html_description": "<div class=\"project-description\">\n            <h1>kiwixstorage</h1>\n<p><a href=\"https://www.codefactor.io/repository/github/kiwix/python_storagelib\" rel=\"nofollow\"><img alt=\"CodeFactor\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/76ebc9bdec13258e7cf84307d13ca6ad4b658a6f/68747470733a2f2f7777772e636f6465666163746f722e696f2f7265706f7369746f72792f6769746875622f6b697769782f707974686f6e5f73746f726167656c69622f6261646765\"></a>\n<a href=\"https://www.gnu.org/licenses/gpl-3.0\" rel=\"nofollow\"><img alt=\"License: GPL v3\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/8de17537dd1659a5a076ce547de301e27c839e67/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d47504c76332d626c75652e737667\"></a>\n<a href=\"https://pypi.org/project/kiwixstorage/\" rel=\"nofollow\"><img alt=\"PyPI version shields.io\" src=\"https://warehouse-camo.ingress.cmh1.psfhosted.org/04616368111566c4c90b00166548fe0ca7187721/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f6b6977697873746f72616765\"></a></p>\n<p>helpers for S3 storage, autoconf from URL + Wasabi (wasabisys.com) extras</p>\n<p>Goal is mainly to provide a configured s3.client and s3.resource from an URL\nUsers could limit usage to this and use <a href=\"https://boto3.amazonaws.com/\" rel=\"nofollow\">boto3</a> directly from there.</p>\n<p>A few additional wrappers are in place to simplify common actions.\nAlso, non-S3, wasabi-specific features are exposed directly.</p>\n<h1>Usage</h1>\n<pre>pip install kiwixstorage\n</pre>\n<h2>Connection</h2>\n<pre><span class=\"kn\">from</span> <span class=\"nn\">kiwixstorage</span> <span class=\"kn\">import</span> <span class=\"n\">KiwixStorage</span>\n<span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"s2\">\"https://s3.us-east-1.wasabisys.com/?keyId=x&amp;secretAccessKey=y&amp;bucketName=z\"</span>\n<span class=\"n\">s3</span> <span class=\"o\">=</span> <span class=\"n\">KiwixStorage</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">)</span>\n<span class=\"c1\"># test credentials and ensure we can list buckets</span>\n<span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">check_credentials</span><span class=\"p\">(</span><span class=\"n\">list_buckets</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">failsafe</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"c1\"># bad auth</span>\n</pre>\n<h2>Scraper use-case</h2>\n<pre><span class=\"n\">online_url</span> <span class=\"o\">=</span> <span class=\"s2\">\"https://xxx\"</span>\n<span class=\"n\">fpath</span> <span class=\"o\">=</span> <span class=\"s2\">\"/local/path.ext\"</span>\n<span class=\"c1\"># retrieve origin etag</span>\n<span class=\"n\">etag</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"n\">online_url</span><span class=\"p\">,</span> <span class=\"n\">allow_redirects</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">headers</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">\"Etag\"</span><span class=\"p\">)</span>\n<span class=\"c1\"># check if we have that very same version in store</span>\n<span class=\"k\">if</span> <span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">has_matching_object</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"o\">=</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">etag</span><span class=\"o\">=</span><span class=\"n\">etag</span><span class=\"p\">)</span>\n    <span class=\"c1\"># lastest version in our store, download from there (using progress output)</span>\n    <span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">download_file</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"o\">=</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">fpath</span><span class=\"o\">=</span><span class=\"n\">fpath</span><span class=\"p\">,</span> <span class=\"n\">progress</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"k\">else</span><span class=\"p\">:</span>\n    <span class=\"c1\"># download the origin file using your regular tools</span>\n    <span class=\"n\">download_file</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">fpath</span><span class=\"p\">)</span>\n    <span class=\"c1\"># upload it our storage</span>\n    <span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">upload_file</span><span class=\"p\">(</span><span class=\"n\">fpath</span><span class=\"o\">=</span><span class=\"n\">fpath</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"o\">=</span><span class=\"n\">url</span><span class=\"p\">)</span>\n<span class=\"c1\"># now you have a local file of lastest version and the storage is up to date</span>\n</pre>\n<h1>Other use cases</h1>\n<pre><span class=\"c1\"># create a bucket</span>\n<span class=\"n\">bucket</span> <span class=\"o\">=</span> <span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">create_bucket</span><span class=\"p\">(</span><span class=\"s2\">\"bucket_name\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># set auto-delete on bucket</span>\n<span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">set_bucket_autodelete_after</span><span class=\"p\">(</span><span class=\"n\">nb_days</span><span class=\"o\">=</span><span class=\"mi\">7</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># allow public downloads from bucket</span>\n<span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">allow_public_downloads_on</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># upload a file</span>\n<span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">upload_file</span><span class=\"p\">(</span><span class=\"n\">fpath</span><span class=\"p\">,</span> <span class=\"s2\">\"some/path/file.img\"</span><span class=\"p\">,</span> <span class=\"n\">meta</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">\"ENCODER_VERSION\"</span><span class=\"p\">:</span> <span class=\"s2\">\"v1\"</span><span class=\"p\">})</span>\n\n<span class=\"c1\"># set autodelete on specific file</span>\n<span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">set_object_autodelete_on</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">now</span><span class=\"p\">())</span>\n\n<span class=\"c1\"># download a file</span>\n<span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">download_file</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">fpath</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># get URL for external download</span>\n<span class=\"n\">s3</span><span class=\"o\">.</span><span class=\"n\">get_download_url</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">)</span>\n</pre>\n<h1>Resources:</h1>\n<ul>\n<li><a href=\"https://wasabi.com/wp-content/themes/wasabi/docs/API_Guide\" rel=\"nofollow\">https://wasabi.com/wp-content/themes/wasabi/docs/API_Guide</a></li>\n<li><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html\" rel=\"nofollow\">https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html</a></li>\n</ul>\n\n          </div>"}, "last_serial": 7066932, "releases": {"0.1": [{"comment_text": "", "digests": {"md5": "39a38c04645d30f251f6f7d3b7aa1123", "sha256": "1adc553632ce3e18b091b8f1afd9acf6fb386b7da509cb70edfd63d8388cdefe"}, "downloads": -1, "filename": "kiwixstorage-0.1-py3-none-any.whl", "has_sig": false, "md5_digest": "39a38c04645d30f251f6f7d3b7aa1123", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 32019, "upload_time": "2020-04-13T18:03:59", "upload_time_iso_8601": "2020-04-13T18:03:59.413055Z", "url": "https://files.pythonhosted.org/packages/60/3a/bcb440d3fd27fcf127cfd9deb18a18631995b7734f416c72a23bce09c781/kiwixstorage-0.1-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "a464848dccfdc5ba17c8b5c03d6639a8", "sha256": "42f4233d8aaa806ccdbe111f2334dbacaf4aa557bad59891aca0fe36f5282607"}, "downloads": -1, "filename": "kiwixstorage-0.1.tar.gz", "has_sig": false, "md5_digest": "a464848dccfdc5ba17c8b5c03d6639a8", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 31778, "upload_time": "2020-04-13T18:04:02", "upload_time_iso_8601": "2020-04-13T18:04:02.701271Z", "url": "https://files.pythonhosted.org/packages/1e/ab/ab05878b3bb70f696e777a288b71aa54826e9f8242127cbc37e5e3fe577b/kiwixstorage-0.1.tar.gz", "yanked": false}], "0.2": [{"comment_text": "", "digests": {"md5": "eeadf3e9efbe4e4e89c610b6b858736e", "sha256": "bde6da2744b4479ab8b9ef11109d9553137578214cbc0f928ada1ee608fdce90"}, "downloads": -1, "filename": "kiwixstorage-0.2-py3-none-any.whl", "has_sig": false, "md5_digest": "eeadf3e9efbe4e4e89c610b6b858736e", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 33261, "upload_time": "2020-04-21T09:55:40", "upload_time_iso_8601": "2020-04-21T09:55:40.031361Z", "url": "https://files.pythonhosted.org/packages/cf/7b/a31bf548ee99aeacba0188d8a7c0898f1509a4c7dc0c8a0d2b1bf5418938/kiwixstorage-0.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "ebbd70897daec0124280afc63d25ca83", "sha256": "0bad14978fa5ccfaa5ea92e5b124d6798249eeba665aa1e9b74820938d0a4794"}, "downloads": -1, "filename": "kiwixstorage-0.2.tar.gz", "has_sig": false, "md5_digest": "ebbd70897daec0124280afc63d25ca83", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 32892, "upload_time": "2020-04-21T09:55:41", "upload_time_iso_8601": "2020-04-21T09:55:41.804210Z", "url": "https://files.pythonhosted.org/packages/f4/10/12ddc5c76f063e61b798d178694ee0147d2e4f4f49d505351bcecfe31c96/kiwixstorage-0.2.tar.gz", "yanked": false}]}, "urls": [{"comment_text": "", "digests": {"md5": "eeadf3e9efbe4e4e89c610b6b858736e", "sha256": "bde6da2744b4479ab8b9ef11109d9553137578214cbc0f928ada1ee608fdce90"}, "downloads": -1, "filename": "kiwixstorage-0.2-py3-none-any.whl", "has_sig": false, "md5_digest": "eeadf3e9efbe4e4e89c610b6b858736e", "packagetype": "bdist_wheel", "python_version": "py3", "requires_python": ">=3.6", "size": 33261, "upload_time": "2020-04-21T09:55:40", "upload_time_iso_8601": "2020-04-21T09:55:40.031361Z", "url": "https://files.pythonhosted.org/packages/cf/7b/a31bf548ee99aeacba0188d8a7c0898f1509a4c7dc0c8a0d2b1bf5418938/kiwixstorage-0.2-py3-none-any.whl", "yanked": false}, {"comment_text": "", "digests": {"md5": "ebbd70897daec0124280afc63d25ca83", "sha256": "0bad14978fa5ccfaa5ea92e5b124d6798249eeba665aa1e9b74820938d0a4794"}, "downloads": -1, "filename": "kiwixstorage-0.2.tar.gz", "has_sig": false, "md5_digest": "ebbd70897daec0124280afc63d25ca83", "packagetype": "sdist", "python_version": "source", "requires_python": ">=3.6", "size": 32892, "upload_time": "2020-04-21T09:55:41", "upload_time_iso_8601": "2020-04-21T09:55:41.804210Z", "url": "https://files.pythonhosted.org/packages/f4/10/12ddc5c76f063e61b798d178694ee0147d2e4f4f49d505351bcecfe31c96/kiwixstorage-0.2.tar.gz", "yanked": false}], "timestamp": "Fri May  8 00:49:25 2020"}